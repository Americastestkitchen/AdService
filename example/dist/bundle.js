/******/ (() => { // webpackBootstrap
/******/ 	var __webpack_modules__ = ({

/***/ "../dist/index.js":
/*!************************!*\
  !*** ../dist/index.js ***!
  \************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ AdServer)
/* harmony export */ });
/* harmony import */ var _piano_adapter__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./piano-adapter */ "../dist/piano-adapter.js");

/**
 *
 *  When we decide to ad a new ad service we will have to change the type of adServicer
 *  Currently it is just reliant on the PianoAdapter, but it could be any adapter that responds to
 *  .init() and takes the lifecycle methods along with matchers/tags.
 *
 */
class AdServer {
    constructor({ afterAdRender = [], afterAdInit = [], beforeAdInit = [], matchers = [], thirdPartyCallbacks = [], tags = [], adServicer, }) {
        this.afterAdInit = afterAdInit;
        this.afterAdRender = afterAdRender;
        this.beforeAdInit = beforeAdInit;
        this.matchers = matchers;
        this.tags = tags;
        this.thirdPartyCallbacks = thirdPartyCallbacks;
        this.user = this.setUser();
        this.adServicer = this.setAdapter(adServicer);
    }
    /**
     * Sets up the adapter for our Ad Service
     * Adapters api:
     * To render a template it REQUIRES an init() method
     * To interact with third-party services the adapter constructor REQUIRES an interface to receive an array of callbacks.
     * To match on custom variables it MAY have tags, matchers, or user-state
     * Lifecycle methods can be fired from the AdServer class or passed through to the Adapter.
     *
     * @remarks
     * Piano lifecycle methods lives inside the window.tp object so we have to pass through callbacks.
     * @param adServicer
     * @returns Adapter Class
     */
    setAdapter(adServicer) {
        const pianoConfig = {
            afterRenderCallbacks: this.afterAdRender,
            matchers: this.matchers,
            tags: this.tags,
            thirdPartyCallbacks: this.thirdPartyCallbacks,
            user: this.user
        };
        switch (adServicer) {
            case "piano": {
                return new _piano_adapter__WEBPACK_IMPORTED_MODULE_0__["default"](pianoConfig);
            }
            case "atk": {
                //configure in house AdService
            }
            default: {
                return new _piano_adapter__WEBPACK_IMPORTED_MODULE_0__["default"](pianoConfig);
            }
        }
    }
    /**
     * @remarks
     * These methods are private and should be only called through #dispatchAd
     */
    executeBeforeAdInit() {
        this.beforeAdInit.forEach((cb) => cb());
    }
    executeAfterAdRender() {
        this.afterAdRender.forEach((cb) => cb());
    }
    executeAfterAdInit() {
        this.afterAdInit.forEach((cb) => cb());
    }
    /**
     * Gathers needed properties and creates a configuration obj
     *
     * @remarks
     * The user data could come from context or it could come from
     * @returns User
     */
    setUser() {
        return {};
    }
    /**
     * Execute advertisement and lifecycle methods.
     */
    dispatchAd() {
        this.executeBeforeAdInit();
        this.adServicer.init();
        this.executeAfterAdInit();
    }
}
//# sourceMappingURL=index.js.map

/***/ }),

/***/ "../dist/piano-adapter.js":
/*!********************************!*\
  !*** ../dist/piano-adapter.js ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ PianoAdapter)
/* harmony export */ });
/* harmony import */ var _piano__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./piano */ "../dist/piano/index.js");
/* harmony import */ var _piano__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_piano__WEBPACK_IMPORTED_MODULE_0__);
var __awaiter = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __classPrivateFieldGet = (undefined && undefined.__classPrivateFieldGet) || function (receiver, state, kind, f) {
    if (kind === "a" && !f) throw new TypeError("Private accessor was defined without a getter");
    if (typeof state === "function" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError("Cannot read private member from an object whose class did not declare it");
    return kind === "m" ? f : kind === "a" ? f.call(receiver) : f ? f.value : state.get(receiver);
};
var _PianoAdapter_instances, _PianoAdapter_getAid, _PianoAdapter_getUserToken;

class PianoAdapter {
    constructor({ thirdPartyCallbacks = [], afterRenderCallbacks = [], matchers = [], tags = [], user }) {
        _PianoAdapter_instances.add(this);
        this.tp = window.tp || [];
        this.user = this.setUser(user);
        this.setEnvConfig();
        this.setThirdPartyCallbacks(thirdPartyCallbacks);
        this.setCustomVariables(matchers);
        this.setAfterAdRender(afterRenderCallbacks);
        if (!Array.isArray(tags[0])) {
            tags = [tags];
        }
        this.setTags(tags);
    }
    /**
     * Sets required user fields to execute a piano experience.
     *
     * @remarks
     * Piano only needs the custom variable to match, but the user-token has something to do on their side.
     * I am not sure what it does, but to be backwards compatible we will add it in there.
     *
     * We are passing in a user argument just in-case we need additional properties from our
     * context or cookie in a future iteration.
     *
     * @param user
     */
    setUser(user) {
        return {
            aid: __classPrivateFieldGet(this, _PianoAdapter_instances, "m", _PianoAdapter_getAid).call(this),
            token: __classPrivateFieldGet(this, _PianoAdapter_instances, "m", _PianoAdapter_getUserToken).call(this),
        };
    }
    init() {
        /**
        * Initializes the piano experience
        * this is where we could eventually expand our callbacks using the tp api.
        * https://docs.piano.io/callbacks/
        *
        * @typedef {string} Command - Initialization command for piano experience.
        * @typedef {()=>void} Callback - In this callback you can access a lot of user information before initializing the experience.
        * @typedef {[Command, Callback]} InitParams
        * @param {InitParams}
        */
        this.tp.push(["init", () => {
                this.tp.experience.init();
            },]);
    }
    /**
     * Configuration objects carry the necessary data to the third party callback
     * Each configuration object is going to be different based on the 'service'.
     * Required properties are service, and callbacks.
     *
     * @typedef Service {string}
     * @typedef Callbacks {[()=>void]}
     * @typedef {Service, Callbacks} ConfigObj
     * @param thirdPartyConfigs ConfigObj[]
     */
    setThirdPartyCallbacks(thirdPartyConfigs) {
        thirdPartyConfigs.forEach((config) => {
            switch (config.service) {
                case 'mixpanel': {
                    this.setMixpanel(config);
                    break;
                }
                case 'atk': {
                    //do other stuff.
                    break;
                }
                default:
                    this.setMixpanel(config);
                    break;
            }
        });
    }
    /**
     * Configures mixpanel's global api for tracking events with piano template content fields
     *
     * @remarks
     * We are borrowing a pattern from redux, instead of action and payload we have mixpanel properties of status and actions
     * Actions are the event callbacks taking piano content fields and parsing the information we require for each specific event.
     *
     * We are using external events launch these callback. A hacky solution currently but we are injecting a third party iframe into our
     * application. There is a limited scope of interaction we can have with the template. But what we don't want is to couple our code
     * where the template is getting rendered. So hacky > heavily coupled currently.
     *
     * https://docs.piano.io/offer-template-essentials/#externalevent
     *
     * Every action that we want to track with mixpanel we add an additional case and add an external event on the template
     * We have to trigger it with javascript on the template if it is not a user triggered event (until we find a better way).
     *
     * @param ConfigObj
     *
     */
    setMixpanel({ status, action }) {
        /**
         * todo: add all of the available fields we get from the piano params obj and the params.params obj
         * This function maps the params data received from the event we get from piano
         * including custom parameters we have to set up in the external-event data-attributes
         * We can not target traditional data-attributes :frown:
         *
         *
         *@example
         * <span
         * id="mixpanel-params"
         * external-event="presented"
         * external-event-params="{{params}}"
         * external-event-adtype="[%% ad-type %%]"
         * external-event-incode="[%% incode %%]"
         * external-event-deviceType="[%% deviceType %%]"
         * external-event-clickdomain="[%% click-domain %%]"
         * external-event-mdc="[%% mdc %%]"
         * ></span>
         *
         *
         * In the custom script we have to manually trigger an event that is not cause by
         * user interaction. For this example we want to be able to fire a presented event to mixpanel
         * but because it isn't user triggered we will click on the span that will fire the external-event.
         *
         * <div custom-script>
         *   document.getElementById("mixpanel-params").click();
         * </div>
         */
        function trackMixpanel({ action, status, params, customParams: { incode, clickdomain } }) {
            return __awaiter(this, void 0, void 0, function* () {
                let { url } = yield JSON.parse(params);
                // TODO: change 172 to support subdomains
                const [, location = "homepage"] = url.split(":5500/");
                window.mixpanel.track(action, { incode, status, location, type: clickdomain });
            });
        }
        switch (status) {
            case 'Accepted': {
                this.tp.push(["addHandler", "customEvent", function (event) {
                        if ((event === null || event === void 0 ? void 0 : event.eventName) !== 'sign-up-button')
                            return;
                        trackMixpanel({ action, status, params: event.params.params, customParams: event.params });
                    }]);
                break;
            }
            case 'Presented': {
                this.tp.push(["addHandler", "customEvent", function (event) {
                        return __awaiter(this, void 0, void 0, function* () {
                            if ((event === null || event === void 0 ? void 0 : event.eventName) !== 'presented')
                                return;
                            trackMixpanel({ action, status, params: event.params.params, customParams: event.params });
                        });
                    }]);
                break;
            }
            default:
                break;
        }
    }
    /**
     * We attach callbacks that fire before the browser renders the template
     *
     * @remarks
     *  This is not built to support third-party callbacks. Those need to be handled individually by their handlers.
     *
     * @param cbs
     */
    setBeforeAdInit(cbs) {
        cbs.forEach((callback) => {
            if (typeof callback === "function") {
                this.tp.push(["addHandler", "beforeBrowserEvent", callback]);
            }
        });
    }
    /**
     * We attach callbacks that fire after the browser renders the template
     *
     * @remarks
     *  This is not built to support third-party callbacks. Those need to be handled individually by their handlers.
     *
     * @param cbs
     */
    setAfterAdRender(cbs) {
        cbs.forEach((callback) => {
            this.tp.push(["addHandler", "showTemplate", function (templateParams) {
                    callback();
                }]);
        });
    }
    /**
     * Set the user segments that will match on the piano segment
     * in the initial user segments phase of the composer experience
     *
     * i.e. experience rules, initial user segments, events and triggers, actions
     * https://docs.piano.io/track/overview-composer?chapter=5556#menu5556
     *
     * @param matchers
     */
    setCustomVariables(matchers) {
        matchers.forEach((cv) => {
            const [key, value] = cv;
            this.tp.push(["setCustomVariable", key, value]);
        });
    }
    /**
     * Each experience in composer requires proper configuration.
     * This object will set up our configuration object properly to launch the expected experience.
     *
     * @returns PianoConfig
     */
    // debug if non prod
    getConfigProperties() {
        return {
            setAid: this.user.aid,
            setDebug: true,
            setEndpoint: "https://buy.tinypass.com/api/v3",
            setExternalJWT: this.user.token,
            setUsePianoIdUserProvider: true,
            setUseTinypassAccounts: false,
        };
    }
    /**
     * Sets up the window.tp piano object in the specific way it requires.
     *
     * @remarks
     * window.tp expects to push tuples with the proper 'key' (at position tuple[0]).
     * todo: expand explanation
     */
    setEnvConfig() {
        const config = this.getConfigProperties();
        Object.entries(config).forEach((d) => this.tp.push(d));
    }
    /**
     * This configures the window tp object to accept custom tags.
     *
     * @remarks
     * Tags are a way for us to match experiences with great specificity. (Experience Rules Phase)
     * Tags are used in the experience, and can be rendered on the template.
     * Tags can be returned to be used in third-party integrations
     * https://docs.piano.io/content-tracking/#custags
     *
     * @param tags
     */
    setTags(tags) {
        tags.forEach((tag) => {
            if (!Array.isArray(tag)) {
                this.tp.push(["setTags", tag]);
            }
        });
    }
}
_PianoAdapter_instances = new WeakSet(), _PianoAdapter_getAid = function _PianoAdapter_getAid() {
    // const [subdomain, domain] = window.location.hostname.split('.')
    // if(subdomain === 'www'){
    //   return {
    //     "americastestkitchen": "o8it4JKTpu",
    //     "cooksillustrated": "0l4CXRBBpu",
    //     "cookscountry": "vRqttsu1pu",
    //   }[domain]
    // } else {
    //   return {
    //     "americastestkitchen": "P3MUmmU9pu",
    //     "cooksillustrated": "CLRfAMqqpu",
    //     "cookscountry": "rkIgdPatpu",
    //   }[domain]
    // }
    /**
     * example implementation static aid
     */
    return "P3MUmmU9pu";
}, _PianoAdapter_getUserToken = function _PianoAdapter_getUserToken() {
    var c = document.cookie.match("(^|;)\\s*user_token\\s*=\\s*([^;]+)");
    if (c && c.length > 0)
        return c.pop();
    else
        return null;
};
//# sourceMappingURL=piano-adapter.js.map

/***/ }),

/***/ "../dist/piano/index.js":
/*!******************************!*\
  !*** ../dist/piano/index.js ***!
  \******************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

var pianoSDK = __webpack_require__(/*! ./tinypass */ "../dist/piano/tinypass.js");
module.exports = {
    pianoSDK
};
//# sourceMappingURL=index.js.map

/***/ }),

/***/ "../dist/piano/tinypass.js":
/*!*********************************!*\
  !*** ../dist/piano/tinypass.js ***!
  \*********************************/
/***/ (() => {

!function (e) {
    "use strict";
    window.pnFullTPVersion = !0, "function" != typeof Object.assign && Object.defineProperty(Object, "assign", { value: function (e, n) { if (null == e)
            throw new TypeError("Cannot convert undefined or null to object"); for (var t = Object(e), r = 1; r < arguments.length; r++) {
            var o = arguments[r];
            if (null != o)
                for (var i in o)
                    Object.prototype.hasOwnProperty.call(o, i) && (t[i] = o[i]);
        } return t; }, writable: !0, configurable: !0 });
    var n = new WeakMap;
    function t(e, t) { return n.get(e) && n.get(e).get(t); }
    function r(e, n, r) { if (void 0 === n)
        throw new TypeError; var o = t(n, r); return o && o.get(e); }
    function o(e, r, o, i) { if (i && !["string", "symbol"].includes(typeof i))
        throw new TypeError; (t(o, i) || function (e, t) { var r = n.get(e) || new Map; n.set(e, r); var o = r.get(t) || new Map; return r.set(t, o), o; }(o, i)).set(e, r); }
    function i(e, n, t) { return r(e, n, t) ? r(e, n, t) : Object.getPrototypeOf(n) ? i(e, Object.getPrototypeOf(n), t) : void 0; }
    var a, s = { decorate: function (e, n, t, r) { if (!Array.isArray(e) || 0 === e.length)
            throw new TypeError; return void 0 !== t ? function (e, n, t, r) { return e.reverse().forEach((function (e) { r = e(n, t, r) || r; })), r; }(e, n, t, r) : "function" == typeof n ? function (e, n) { return e.reverse().forEach((function (e) { var t = e(n); t && (n = t); })), n; }(e, n) : void 0; }, defineMetadata: function (e, n, t, r) { o(e, n, t, r); }, getMetadata: function (e, n, t) { return i(e, n, t); }, getOwnMetadata: function (e, n, t) { return r(e, n, t); }, hasMetadata: function (e, n, t) { return !!i(e, n, t); }, hasOwnMetadata: function (e, n, t) { return !!r(e, n, t); }, metadata: function (e, n) { return function (t, r) { o(e, n, t, r); }; } };
    window.Reflect = window.Reflect || {}, Object.assign(window.Reflect, s), function (e) { e[e.Transient = 0] = "Transient", e[e.Singleton = 1] = "Singleton", e[e.ResolutionScoped = 2] = "ResolutionScoped", e[e.ContainerScoped = 3] = "ContainerScoped"; }(a || (a = {}));
    var c = a, l = function (e, n) { return l = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, n) { e.__proto__ = n; } || function (e, n) { for (var t in n)
        n.hasOwnProperty(t) && (e[t] = n[t]); }, l(e, n); };
    function u(e, n) { function t() { this.constructor = e; } l(e, n), e.prototype = null === n ? Object.create(n) : (t.prototype = n.prototype, new t); }
    function d(e) { var n = "function" == typeof Symbol && Symbol.iterator, t = n && e[n], r = 0; if (t)
        return t.call(e); if (e && "number" == typeof e.length)
        return { next: function () { return e && r >= e.length && (e = void 0), { value: e && e[r++], done: !e }; } }; throw new TypeError(n ? "Object is not iterable." : "Symbol.iterator is not defined."); }
    function p(e, n) { var t = "function" == typeof Symbol && e[Symbol.iterator]; if (!t)
        return e; var r, o, i = t.call(e), a = []; try {
        for (; (void 0 === n || n-- > 0) && !(r = i.next()).done;)
            a.push(r.value);
    }
    catch (e) {
        o = { error: e };
    }
    finally {
        try {
            r && !r.done && (t = i.return) && t.call(i);
        }
        finally {
            if (o)
                throw o.error;
        }
    } return a; }
    function f() { for (var e = [], n = 0; n < arguments.length; n++)
        e = e.concat(p(arguments[n])); return e; }
    var m = "injectionTokens";
    function g(e) { return !!e.useClass; }
    function v(e) { return !!e.useFactory; }
    var h = function () { function e(e) { this.wrap = e, this.reflectMethods = ["get", "getPrototypeOf", "setPrototypeOf", "getOwnPropertyDescriptor", "defineProperty", "has", "set", "deleteProperty", "apply", "construct", "ownKeys"]; } return e.prototype.createProxy = function (e) { var n, t = this, r = !1; return new Proxy({}, this.createHandler((function () { return r || (n = e(t.wrap()), r = !0), n; }))); }, e.prototype.createHandler = function (e) { var n = {}; return this.reflectMethods.forEach((function (t) { n[t] = function () { for (var n = [], r = 0; r < arguments.length; r++)
        n[r] = arguments[r]; n[0] = e(); var o = Reflect[t]; return o.apply(void 0, f(n)); }; })), n; }, e; }();
    function w(e) { return "string" == typeof e || "symbol" == typeof e; }
    function y(e) { return "object" == typeof e && "token" in e && "transform" in e; }
    function b(e) { return !!e.useToken; }
    function k(e) { return null != e.useValue; }
    var _ = function () { function e() { this._registryMap = new Map; } return e.prototype.entries = function () { return this._registryMap.entries(); }, e.prototype.getAll = function (e) { return this.ensure(e), this._registryMap.get(e); }, e.prototype.get = function (e) { this.ensure(e); var n = this._registryMap.get(e); return n[n.length - 1] || null; }, e.prototype.set = function (e, n) { this.ensure(e), this._registryMap.get(e).push(n); }, e.prototype.setAll = function (e, n) { this._registryMap.set(e, n); }, e.prototype.has = function (e) { return this.ensure(e), this._registryMap.get(e).length > 0; }, e.prototype.clear = function () { this._registryMap.clear(); }, e.prototype.ensure = function (e) { this._registryMap.has(e) || this._registryMap.set(e, []); }, e; }(), C = function (e) { function n() { return null !== e && e.apply(this, arguments) || this; } return u(n, e), n; }(_), I = function () { this.scopedResolutions = new Map; };
    function S(e, n, t) { var r, o, i = p(e.toString().match(/constructor\(([\w, ]+)\)/) || [], 2)[1], a = function (e, n) { return null === e ? "at position #" + n : '"' + e.split(",")[n].trim() + '" at position #' + n; }(void 0 === i ? null : i, n); return r = "Cannot inject the dependency " + a + ' of "' + e.name + '" constructor. Reason:', void 0 === o && (o = "    "), f([r], t.message.split("\n").map((function (e) { return o + e; }))).join("\n"); }
    var x = function (e) { function n() { return null !== e && e.apply(this, arguments) || this; } return u(n, e), n; }(_), P = function (e) { function n() { return null !== e && e.apply(this, arguments) || this; } return u(n, e), n; }(_), E = function () { this.preResolution = new x, this.postResolution = new P; }, T = new Map, A = function () { function e(e) { this.parent = e, this._registry = new C, this.interceptors = new E; } return e.prototype.register = function (e, n, t) { var r; if (void 0 === t && (t = { lifecycle: c.Transient }), r = function (e) { return g(e) || k(e) || b(e) || v(e); }(n) ? n : { useClass: n }, b(r))
        for (var o = [e], i = r; null != i;) {
            var a = i.useToken;
            if (o.includes(a))
                throw new Error("Token registration cycle detected! " + f(o, [a]).join(" -> "));
            o.push(a);
            var s = this._registry.get(a);
            i = s && b(s.provider) ? s.provider : null;
        } if ((t.lifecycle === c.Singleton || t.lifecycle == c.ContainerScoped || t.lifecycle == c.ResolutionScoped) && (k(r) || v(r)))
        throw new Error('Cannot use lifecycle "' + c[t.lifecycle] + '" with ValueProviders or FactoryProviders'); return this._registry.set(e, { provider: r, options: t }), this; }, e.prototype.registerType = function (e, n) { return w(n) ? this.register(e, { useToken: n }) : this.register(e, { useClass: n }); }, e.prototype.registerInstance = function (e, n) { return this.register(e, { useValue: n }); }, e.prototype.registerSingleton = function (e, n) { if (w(e)) {
        if (w(n))
            return this.register(e, { useToken: n }, { lifecycle: c.Singleton });
        if (n)
            return this.register(e, { useClass: n }, { lifecycle: c.Singleton });
        throw new Error('Cannot register a type name as a singleton without a "to" token');
    } var t = e; return n && !w(n) && (t = n), this.register(e, { useClass: t }, { lifecycle: c.Singleton }); }, e.prototype.resolve = function (e, n) { void 0 === n && (n = new I); var t = this.getRegistration(e); if (!t && w(e))
        throw new Error('Attempted to resolve unregistered dependency token: "' + e.toString() + '"'); if (this.executePreResolutionInterceptor(e, "Single"), t) {
        var r = this.resolveRegistration(t, n);
        return this.executePostResolutionInterceptor(e, r, "Single"), r;
    } if (function (e) { return "function" == typeof e || e instanceof h; }(e)) {
        r = this.construct(e, n);
        return this.executePostResolutionInterceptor(e, r, "Single"), r;
    } throw new Error("Attempted to construct an undefined constructor. Could mean a circular dependency problem. Try using `delay` function."); }, e.prototype.executePreResolutionInterceptor = function (e, n) { var t, r; if (this.interceptors.preResolution.has(e)) {
        var o = [];
        try {
            for (var i = d(this.interceptors.preResolution.getAll(e)), a = i.next(); !a.done; a = i.next()) {
                var s = a.value;
                "Once" != s.options.frequency && o.push(s), s.callback(e, n);
            }
        }
        catch (e) {
            t = { error: e };
        }
        finally {
            try {
                a && !a.done && (r = i.return) && r.call(i);
            }
            finally {
                if (t)
                    throw t.error;
            }
        }
        this.interceptors.preResolution.setAll(e, o);
    } }, e.prototype.executePostResolutionInterceptor = function (e, n, t) { var r, o; if (this.interceptors.postResolution.has(e)) {
        var i = [];
        try {
            for (var a = d(this.interceptors.postResolution.getAll(e)), s = a.next(); !s.done; s = a.next()) {
                var c = s.value;
                "Once" != c.options.frequency && i.push(c), c.callback(e, n, t);
            }
        }
        catch (e) {
            r = { error: e };
        }
        finally {
            try {
                s && !s.done && (o = a.return) && o.call(a);
            }
            finally {
                if (r)
                    throw r.error;
            }
        }
        this.interceptors.postResolution.setAll(e, i);
    } }, e.prototype.resolveRegistration = function (e, n) { if (e.options.lifecycle === c.ResolutionScoped && n.scopedResolutions.has(e))
        return n.scopedResolutions.get(e); var t, r = e.options.lifecycle === c.Singleton, o = e.options.lifecycle === c.ContainerScoped, i = r || o; return t = k(e.provider) ? e.provider.useValue : b(e.provider) ? i ? e.instance || (e.instance = this.resolve(e.provider.useToken, n)) : this.resolve(e.provider.useToken, n) : g(e.provider) ? i ? e.instance || (e.instance = this.construct(e.provider.useClass, n)) : this.construct(e.provider.useClass, n) : v(e.provider) ? e.provider.useFactory(this) : this.construct(e.provider, n), e.options.lifecycle === c.ResolutionScoped && n.scopedResolutions.set(e, t), t; }, e.prototype.resolveAll = function (e, n) { var t = this; void 0 === n && (n = new I); var r = this.getAllRegistrations(e); if (!r && w(e))
        throw new Error('Attempted to resolve unregistered dependency token: "' + e.toString() + '"'); if (this.executePreResolutionInterceptor(e, "All"), r) {
        var o = r.map((function (e) { return t.resolveRegistration(e, n); }));
        return this.executePostResolutionInterceptor(e, o, "All"), o;
    } var i = [this.construct(e, n)]; return this.executePostResolutionInterceptor(e, i, "All"), i; }, e.prototype.isRegistered = function (e, n) { return void 0 === n && (n = !1), this._registry.has(e) || n && (this.parent || !1) && this.parent.isRegistered(e, !0); }, e.prototype.reset = function () { this._registry.clear(), this.interceptors.preResolution.clear(), this.interceptors.postResolution.clear(); }, e.prototype.clearInstances = function () { var e, n; try {
        for (var t = d(this._registry.entries()), r = t.next(); !r.done; r = t.next()) {
            var o = p(r.value, 2), i = o[0], a = o[1];
            this._registry.setAll(i, a.filter((function (e) { return !k(e.provider); })).map((function (e) { return e.instance = void 0, e; })));
        }
    }
    catch (n) {
        e = { error: n };
    }
    finally {
        try {
            r && !r.done && (n = t.return) && n.call(t);
        }
        finally {
            if (e)
                throw e.error;
        }
    } }, e.prototype.createChildContainer = function () { var n, t, r = new e(this); try {
        for (var o = d(this._registry.entries()), i = o.next(); !i.done; i = o.next()) {
            var a = p(i.value, 2), s = a[0], l = a[1];
            l.some((function (e) { return e.options.lifecycle === c.ContainerScoped; })) && r._registry.setAll(s, l.map((function (e) { return e.options.lifecycle === c.ContainerScoped ? { provider: e.provider, options: e.options } : e; })));
        }
    }
    catch (e) {
        n = { error: e };
    }
    finally {
        try {
            i && !i.done && (t = o.return) && t.call(o);
        }
        finally {
            if (n)
                throw n.error;
        }
    } return r; }, e.prototype.beforeResolution = function (e, n, t) { void 0 === t && (t = { frequency: "Always" }), this.interceptors.preResolution.set(e, { callback: n, options: t }); }, e.prototype.afterResolution = function (e, n, t) { void 0 === t && (t = { frequency: "Always" }), this.interceptors.postResolution.set(e, { callback: n, options: t }); }, e.prototype.getRegistration = function (e) { return this.isRegistered(e) ? this._registry.get(e) : this.parent ? this.parent.getRegistration(e) : null; }, e.prototype.getAllRegistrations = function (e) { return this.isRegistered(e) ? this._registry.getAll(e) : this.parent ? this.parent.getAllRegistrations(e) : null; }, e.prototype.construct = function (e, n) { var t = this; if (e instanceof h)
        return e.createProxy((function (e) { return t.resolve(e, n); })); var r = T.get(e); if (!r || 0 === r.length) {
        if (0 === e.length)
            return new e;
        throw new Error('TypeInfo not known for "' + e.name + '"');
    } var o = r.map(this.resolveParams(n, e)); return new (e.bind.apply(e, f([void 0], o))); }, e.prototype.resolveParams = function (e, n) { var t = this; return function (r, o) { var i, a, s, c; try {
        return "object" == typeof (c = r) && "token" in c && "multiple" in c ? y(r) ? r.multiple ? (i = t.resolve(r.transform)).transform.apply(i, f([t.resolveAll(r.token)], r.transformArgs)) : (a = t.resolve(r.transform)).transform.apply(a, f([t.resolve(r.token, e)], r.transformArgs)) : r.multiple ? t.resolveAll(r.token) : t.resolve(r.token, e) : y(r) ? (s = t.resolve(r.transform, e)).transform.apply(s, f([t.resolve(r.token, e)], r.transformArgs)) : t.resolve(r, e);
    }
    catch (e) {
        throw new Error(S(n, o, e));
    } }; }, e; }(), M = new A;
    function O() { return function (e) { T.set(e, function (e) { var n = Reflect.getMetadata("design:paramtypes", e) || [], t = Reflect.getOwnMetadata(m, e) || {}; return Object.keys(t).forEach((function (e) { n[+e] = t[e]; })), n; }(e)); }; }
    if ("undefined" == typeof Reflect || !Reflect.getMetadata)
        throw new Error("tsyringe requires a reflect polyfill. Please add 'import \"reflect-metadata\"' to the top of your entry point.");
    if (window.pnInitPerformance = performance.now(), window.pnHasPolyfilled || (window.pnHasPolyfilled = !1), window.pnFullTPVersion || (window.pnFullTPVersion = !1), void 0 !== window.pn && void 0 !== window.pn.container)
        throw new Error("Piano SDK is loaded twice on same page. Try to fix that to prevent the message.");
    if (!window.pnFullTPVersion && "undefined" != typeof Proxy) {
        var R = function () { return L; }, L = new Proxy({}, { get: function (e, n, t) { return "isv" === n || R; }, apply: function (e, n, t) { return L; } });
        M.resolve = new Proxy(M.resolve, { apply: function (e, n, t) { if (M.isRegistered(t[0]))
                return Reflect.apply(e, n, t); M.register(t[0], { useValue: L }); var r = M.resolve(t[0]); return U[t[0]] = r, r; } });
    }
    var N = window.pn || {}, U = window.pn = {};
    U.container = M, U.singleton = function () { return function (e) { O()(e), M.registerSingleton(e); }; }, U.injectable = O, U.inject = function (e) { return n = e, function (e, r, o) { var i = Reflect.getOwnMetadata(m, e) || {}; i[o] = t ? { token: n, transform: t.transformToken, transformArgs: t.args || [] } : n, Reflect.defineMetadata(m, i, e); }; var n, t; }, U.registry = function (e) { return void 0 === e && (e = []), function (n) { return e.forEach((function (e) { var n = e.token, t = e.options, r = function (e, n) { var t = {}; for (var r in e)
        Object.prototype.hasOwnProperty.call(e, r) && n.indexOf(r) < 0 && (t[r] = e[r]); if (null != e && "function" == typeof Object.getOwnPropertySymbols) {
        var o = 0;
        for (r = Object.getOwnPropertySymbols(e); o < r.length; o++)
            n.indexOf(r[o]) < 0 && Object.prototype.propertyIsEnumerable.call(e, r[o]) && (t[r[o]] = e[r[o]]);
    } return t; }(e, ["token", "options"]); return M.register(n, r, t); })), n; }; }, U.instanceCachingFactory = function (e) { var n; return function (t) { return null == n && (n = e(t)), n; }; }, U.predefinedOptions = N, M.register("predefinedOptions", { useValue: N });
    var j = !1;
    try {
        if (!window.pnHasPolyfilled) {
            if ("undefined" == typeof Proxy)
                throw new Error("The browser cannot Proxy");
            if (new Promise((function (e) { })), Object.assign({}, {}), [""].includes(""), !Element.prototype.closest)
                throw new Error("There is no closest method of a DOM element");
        }
    }
    catch (e) {
        j = !0;
    }
    if (j) {
        var D = function () { var e, n = document.querySelectorAll("script"); if (n.length)
            for (var t = 0, r = n; t < r.length; t++) {
                var o = r[t], i = null === (e = null == o ? void 0 : o.src) || void 0 === e ? void 0 : e.match(/^.*?(tinypass.com|piano.io)/i);
                if (i)
                    return i[0];
            } return "https://sandbox.tinypass.com"; }();
        delete window.pn;
        var F = document.createElement("script");
        throw F.type = "text/javascript", F.async = !0, F.src = D + "/api/piano.es5.js", document.getElementsByTagName("head")[0].appendChild(F), new Error("Load full version of piano SDK");
    }
    var B, V = (B = function (e) { return new Promise((function (n, t) { var r = document.createElement("style"); r.type = "text/css", r.innerHTML = e, r.onload = n, r.onerror = t, document.getElementsByTagName("head")[0].appendChild(r); })); }, { name: "css", loadOfferCss: function () { B(".tp-backdrop {\n    display: none;\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background: #121214;\n    z-index: 300000;\n    opacity: 0;\n    transition: opacity .25s linear;\n}\n.tp-backdrop.tp-active {\n    opacity: .9;\n}\n.tp-modal .tp-close.tp-square {\n    background: #ccc;\n    border-radius: 0;\n    border: 0;\n    top: 0;\n    right: -40px;\n}\n.tp-modal .tp-close {\n    display: none;\n    position: absolute;\n    top: -20px;\n    right: -20px;\n    width: 40px;\n    height: 40px;\n    background: #fff url(\"data:image/svg+xml,%3Csvg width='11' height='11' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M11 1.368L9.632 0 5.5 4.142 1.368 0 0 1.368 4.142 5.5 0 9.632 1.368 11 5.5 6.858 9.632 11 11 9.632 6.858 5.5 11 1.368z' fill='%23959595'/%3E%3C/svg%3E\") center center no-repeat;\n    border: none;\n    box-shadow: 0 0 10px 0 rgba(28, 37, 68, 0.15);\n    outline: none;\n    z-index: 300100;\n    border-radius: 40px;\n    opacity: 0;\n    cursor: pointer;\n    transform: scale(.25, .25);\n    -webkit-appearance: none;\n    -moz-appearance: none;\n    appearance: none;\n}\n.tp-modal .tp-close:hover,\n.tp-modal .tp-close:focus {\n    box-shadow: 0 0 10px 2px rgba(28, 37, 68, 0.15);\n}\n.tp-modal .tp-close:focus {\n   border: 1px solid;\n}\n.tp-modal .tp-close.tp-active {\n    display: block;\n    opacity: 1;\n    transform: scale(1, 1);\n}\n.tp-modal .tp-iframe-wrapper[dir=\"rtl\"] .tp-close {\n  right: initial;\n  left: -20px;\n}\n\n.tp-modal .tp-iframe-wrapper.piano-id-modal-ver-2 .tp-close {\n  top: 0;\n  right: 0;\n  width: 64px;\n  height: 64px;\n  box-shadow: none;\n  outline: none;\n  border-radius: 0;\n  border-left: 1px solid rgba(15, 15, 21, 0.2);\n  background: url(\"data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cg %3E%3Cpath d='M3 3L13 13M13 3L3 13' stroke='%230F0F15' stroke-width='2'/%3E%3C/g%3E%3C/svg%3E%0A\") center center no-repeat;\n  opacity: 0.3;\n}\n\n.tp-modal .tp-iframe-wrapper.piano-id-modal-ver-2 .tp-close.tp-active {\n  opacity: 0.3;\n}\n\n.tp-modal .tp-iframe-wrapper.piano-id-modal-ver-2 .tp-close:hover,\n.tp-modal .tp-iframe-wrapper.piano-id-modal-ver-2 .tp-close:focus {\n  box-shadow: none;\n  border: none;\n  border-left: 1px solid rgba(15, 15, 21, 0.06);\n  opacity: 1;\n}\n\n.tp-modal .tp-iframe-wrapper.piano-id-modal-ver-2[dir=\"rtl\"] .tp-close {\n  right: auto;\n  left: 0;\n  border-left: none;\n  border-right: 1px solid rgba(15, 15, 21, 0.2);\n}\n\n.tp-modal .tp-iframe-wrapper.piano-id-modal-ver-2[dir=\"rtl\"] .tp-close:hover,\n.tp-modal .tp-iframe-wrapper.piano-id-modal-ver-2[dir=\"rtl\"] .tp-close:focus {\n  border-left: none;\n  border-right: 1px solid rgba(15, 15, 21, 0.06);\n}\n\n.tp-modal {\n    z-index: 300050;\n}\n@media screen and (max-width: 650px) {\n    .tp-modal .tp-close {\n        right: 0;\n    }\n\n    .tp-modal .tp-iframe-wrapper[dir=\"rtl\"] .tp-close {\n      right: initial;\n      left: 0;\n    }\n}\n.tp-modal .tp-iframe-wrapper.tp-curtain {\n    width: 600px;\n    height: 480px;\n}\n.tp-modal-open {\n    overflow: hidden !important;\n    height: 100vh;\n    -webkit-overflow-scrolling: touch;\n}\n.tp-modal-open.tp-modal-resizing {\n    -webkit-overflow-scrolling: auto;\n}\n/*Bug fix of firefox v57*/\n.tp-modal-close {\n    overflow: auto;\n}\n.tp-modal__margin-100 .tp-iframe-wrapper {\n  margin-bottom: 100px;\n}\n.tp-iframe-wrapper {\n    position: relative;\n    margin: 50px auto;\n    box-shadow: 0 0 10px rgba(0, 0, 0, 0.21);\n}\n.tp-iframe-wrapper.no-shadow {\n  box-shadow: unset;\n}\n.tp-modal {\n    overflow-x: hidden;\n    overflow-y: scroll !important;\n    display: none;\n    position: fixed;\n    top: 0;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    transform: translate3d(0, 0, 0);\n}\n.tp-modal .tp-message {\n    font-family: \"Graphik Web Regular\", Helvetica, Arial, sans-serif;\n    padding: 10px;\n}\n.tp-modal .tp-btn-container {\n    padding-left: 10px;\n    padding-bottom: 10px;\n}\n.tp-cxense-placeholder-modal {\n    width: 100%;\n    background-color: #fff;\n    max-width: 912px;\n    display: block;\n    overflow: hidden;\n    height: auto;\n    opacity: 1;\n}\n.tp-widget-placeholder > div::after {\n    display: block;\n    content: \"\";\n    clear: both;\n}\n.tp-btn {\n    text-decoration: none;\n    cursor: pointer;\n    padding: 0 18px;\n    line-height: 40px;\n    border-collapse: separate;\n    border-radius: 4px;\n    text-align: center;\n    vertical-align: middle;\n    display: inline-block;\n    color: #fff;\n    border: none;\n    box-shadow: inset 0 -1px 0 rgba(216, 218, 221, 0.0);\n    background: #3878D8;\n    background-position: bottom;\n    text-shadow: none;\n    font-family: \"Graphik Web Regular\", Helvetica, Arial, sans-serif;\n    white-space: nowrap;\n    outline: 0;\n}\n.tp-please-wait.tp-active {\n    display: block;\n    opacity: .9;\n    transition: opacity .25s linear;\n}\n.tp-please-wait {\n    position: absolute;\n    top: 0;\n    left: 0;\n    background-color: #999;\n    opacity: 0;\n    width: 100%;\n    height: 100%;\n    display: none;\n    text-align: center;\n    color: #fff;\n    font-weight: lighter;\n    font-family: \"Open Sans\", sans-serif;\n    font-size: 15px;\n}\n.tp-please-wait.tp-overlap {\n  position: fixed;\n  z-index: 300150;\n}\n\n.tp-please-wait.tp-local-overlap {\n  position: absolute;\n}\n\n.tp-please-wait > .tp-icon {\n    width: 80px;\n    height: 80px;\n    margin: 100px auto 20px auto;\n}\n\n.pn-spinner {\n  color: grey;\n  display: inline-block;\n  position: relative;\n  width: 80px;\n  height: 80px;\n}\n.pn-spinner div {\n  transform-origin: 40px 40px;\n  animation: pn-spinner 1.2s linear infinite;\n}\n.pn-spinner div:after {\n  content: \" \";\n  display: block;\n  position: absolute;\n  top: 3px;\n  left: 37px;\n  width: 6px;\n  height: 18px;\n  border-radius: 20%;\n  background: #fff;\n}\n.pn-spinner div:nth-child(1) {\n  transform: rotate(0deg);\n  animation-delay: -1.1s;\n}\n.pn-spinner div:nth-child(2) {\n  transform: rotate(30deg);\n  animation-delay: -1s;\n}\n.pn-spinner div:nth-child(3) {\n  transform: rotate(60deg);\n  animation-delay: -0.9s;\n}\n.pn-spinner div:nth-child(4) {\n  transform: rotate(90deg);\n  animation-delay: -0.8s;\n}\n.pn-spinner div:nth-child(5) {\n  transform: rotate(120deg);\n  animation-delay: -0.7s;\n}\n.pn-spinner div:nth-child(6) {\n  transform: rotate(150deg);\n  animation-delay: -0.6s;\n}\n.pn-spinner div:nth-child(7) {\n  transform: rotate(180deg);\n  animation-delay: -0.5s;\n}\n.pn-spinner div:nth-child(8) {\n  transform: rotate(210deg);\n  animation-delay: -0.4s;\n}\n.pn-spinner div:nth-child(9) {\n  transform: rotate(240deg);\n  animation-delay: -0.3s;\n}\n.pn-spinner div:nth-child(10) {\n  transform: rotate(270deg);\n  animation-delay: -0.2s;\n}\n.pn-spinner div:nth-child(11) {\n  transform: rotate(300deg);\n  animation-delay: -0.1s;\n}\n.pn-spinner div:nth-child(12) {\n  transform: rotate(330deg);\n  animation-delay: 0s;\n}\n@keyframes pn-spinner {\n  0% {\n    opacity: 1;\n  }\n  100% {\n    opacity: 0;\n  }\n}\n\n.tp-please-wait > .tp-icon.tp-centered {\n  margin: 0;\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n}\n.tp-iframe-wrapper.no-width .tp-close,\n.tp-iframe-wrapper.no-height .tp-close,\n.tp-modal.no-width .tp-close,\n.tp-modal.no-height .tp-close {\n    display: none;\n}\n\n.tp-banner {\n  position: fixed;\n  bottom: 0;\n  left: 0;\n  width: 100%;\n}\n\n.tp-banner > .tp-container-inner,\n.tp-banner > .tp-container-inner > iframe {\n  width: inherit !important;\n}\n\n.frozen-mobile-body {\n  width: 100%;\n  margin: 0;\n  position: fixed !important;\n  max-height: -webkit-fill-available;\n  max-height: -moz-available;\n}\n"); } });
    pn.container.register("css", { useValue: V }), pn.css = pn.container.resolve("css");
    var q, z, H = function (e) { return {}.toString.call(e).match(/\s([a-zA-Z]+)/)[1].toLowerCase(); }, W = Math.round(1e4 * Math.random()), J = window.document, G = /^(?:text|application)\/javascript/i, Q = /^(?:text|application)\/xml/i, X = "application/json", $ = "text/html", Y = /^\s*$/, K = function (e) { var n = ce({}, e || {}); for (q in K.settings)
        void 0 === n[q] && (n[q] = K.settings[q]); !function (e) { e.global && 0 == K.active++ && Z(e); }(n), n.crossDomain || (n.crossDomain = /^([\w-]+:)?\/\/([^\/]+)/.test(n.url) && RegExp.$2 != window.location.host); var t = n.dataType, r = /=\?/.test(n.url); if ("jsonp" == t || r)
        return r || (n.url = oe(n.url, "callback=?")), K.JSONP(n); n.url || (n.url = window.location.toString()), ie(n); var o, i = n.accepts[t], a = {}, s = /^([\w-]+:)\/\//.test(n.url) ? RegExp.$1 : window.location.protocol, c = K.settings.xhr(); n.crossDomain || (a["X-Requested-With"] = "XMLHttpRequest"), i && (a.Accept = i, i.indexOf(",") > -1 && (i = i.split(",", 2)[0]), c.overrideMimeType && c.overrideMimeType(i)), (n.contentType || n.data && "GET" != n.type.toUpperCase()) && (a["Content-Type"] = n.contentType || "application/x-www-form-urlencoded"), n.headers = ce(a, n.headers || {}); var l = n.xhrFields && n.xhrFields.withCredentials; l && (c.withCredentials = l), c.onreadystatechange = function () { if (4 == c.readyState) {
        clearTimeout(o);
        var e, r = !1;
        if (c.status >= 200 && c.status < 300 || 304 == c.status || 0 == c.status && "file:" == s) {
            t = t || function (e) { return e && (e == $ ? "html" : e == X ? "json" : G.test(e) ? "script" : Q.test(e) && "xml") || "text"; }(c.getResponseHeader("content-type")), e = c.responseText;
            try {
                "script" == t ? (0, eval)(e) : "xml" == t ? e = c.responseXML : "json" == t && (e = Y.test(e) ? null : JSON.parse(e));
            }
            catch (e) {
                r = e;
            }
            r ? ne(r, "parsererror", c, n) : ee(e, c, n);
        }
        else
            ne(null, "error", c, n);
    } }; var u = !("async" in n) || n.async; for (z in c.open(n.type, n.url, u), n.headers)
        c.setRequestHeader(z, n.headers[z]); return !1 === function (e, n) { var t = n.context; if (!1 === n.beforeSend.call(t, e, n) || !1 === Z(n))
        return !1; Z(n); }(c, n) ? (c.abort(), !1) : (n.timeout > 0 && (o = setTimeout((function () { c.onreadystatechange = re, c.abort(), ne(null, "timeout", c, n); }), n.timeout)), c.send(n.data ? n.data : null), c); };
    function Z(e, n, t, r) { if (e.global)
        return !0; }
    function ee(e, n, t) { var r = t.context, o = "success"; t.success.call(r, e, o, n), Z(t), te(o, n, t); }
    function ne(e, n, t, r) { var o = r.context; r.error.call(o, t, n, e), Z(r), te(n, t, r); }
    function te(e, n, t) { var r = t.context; t.complete.call(r, n, e), Z(t), function (e) { e.global && !--K.active && Z(e); }(t); }
    function re() { }
    function oe(e, n) { return (e + "&" + n).replace(/[&?]{1,2}/, "?"); }
    function ie(e) { var n, t, r; "object" === H(e.data) && (e.data = (n = e.data, (r = []).add = function (e, n) { this.push(ae(e) + "=" + ae(n)); }, se(r, n, t), r.join("&").replace("%20", "+"))), !e.data || e.type && "GET" != e.type.toUpperCase() || (e.url = oe(e.url, e.data)); }
    K.active = 0, K.JSONP = function (e) { if (!("type" in e))
        return K(e); var n, t = "jsonp" + (e.cache ? "Callback" : ++W), r = J.createElement("script"), o = { abort: function () { t in window && (window[t] = re), te("abort", o, e); } }, i = J.getElementsByTagName("head")[0] || J.documentElement; return e.error && (r.onerror = function () { o.abort(), e.error(); }), window[t] = function (r) { clearTimeout(n), delete window[t], ee(r, o, e); }, ie(e), r.src = e.url.replace(/=\?/, "=" + t), i.insertBefore(r, i.firstChild), e.timeout > 0 && (n = setTimeout((function () { o.abort(), te("timeout", o, e); }), e.timeout)), o; }, K.settings = { type: "GET", beforeSend: re, success: re, error: re, complete: re, context: null, global: !0, xhr: function () { return new window.XMLHttpRequest; }, accepts: { script: "text/javascript, application/javascript", json: X, xml: "application/xml, text/xml", html: $, text: "text/plain" }, crossDomain: !1, timeout: 0 }, K.get = function (e, n) { return K({ url: e, success: n }); }, K.post = function (e, n, t, r) { return "function" === H(n) && (r = r || t, t = n, n = null), K({ type: "POST", url: e, data: n, success: t, dataType: r }); }, K.getJSON = function (e, n) { return K({ url: e, success: n, dataType: "json" }); };
    var ae = encodeURIComponent;
    function se(e, n, t, r) { var o = "array" === H(n); for (var i in n) {
        var a = n[i];
        r && (i = t ? r : r + "[" + (o ? "" : i) + "]"), !r && o ? e.add(a.name, a.value) : (t ? "array" === H(a) : "object" === H(a)) ? se(e, a, t, i) : e.add(i, a);
    } }
    function ce(e) { var n = Array.prototype.slice; return n.call(arguments, 1).forEach((function (n) { for (q in n)
        void 0 !== n[q] && (e[q] = n[q]); })), e; }
    var le = K, ue = { request: function (e) { return e.dataType = e.dataType || "json", le(e); } };
    pn.container.register("ajax", { useValue: ue }), pn.ajax = pn.container.resolve("ajax");
    var de = function () { var e = function (e) { return "function" == typeof e; }, n = function (e, n) { return e ? t(e, n)[0] : null; }, t = function (e, n) { if (!e)
        return []; var t = n || document, r = e.split(","), o = []; return r.forEach((function (e) { var n = e.trim(); try {
        o = o.concat(Array.prototype.slice.call(t.querySelectorAll(n)));
    }
    catch (e) {
        var r = n.indexOf(" ") > -1;
        if ("." !== n[0] || r)
            if ("#" !== n[0] || r)
                o = o.concat(Array.prototype.slice.call(t.querySelectorAll(n)));
            else {
                var i = document.getElementById(n.substring(1));
                o = o.concat(i ? [i] : []);
            }
        else
            o = o.concat(Array.prototype.slice.call(t.getElementsByClassName(n.substring(1))));
    } })), o; }, r = function (e, n, t) { t.setAttribute(e, n); }, o = [], i = function () { for (var e = [], n = 0; n < arguments.length; n++)
        e[n] = arguments[n]; for (var t = {}, r = 0, o = function (e) { for (var n in e)
        e.hasOwnProperty(n) && ("[object Object]" === Object.prototype.toString.call(e[n]) ? t[n] = i(t[n], e[n]) : t[n] = e[n]); }; r < e.length; r++)
        o(e[r]); return t; }; return { scrollTop: function () { return window.pageYOffset || document.documentElement.scrollTop; }, winSize: function () { var e = window, n = document, t = n.documentElement, r = n.getElementsByTagName("body")[0], o = e.innerWidth || t.clientWidth || r.clientWidth; return { height: e.innerHeight || t.clientHeight || r.clientHeight, width: o }; }, isPlainObject: function (e) { return "[object Object]" === Object.prototype.toString.call(e); }, isEmptyObject: function (e) { return 0 === Object.keys(e).length && e.constructor === Object; }, isFunction: e, inArray: function (e, n) { return n.indexOf(e); }, type: function (e) { return Object.prototype.toString.call(e).replace(/^\[object (.+)\]$/, "$1").toLowerCase(); }, remove: function (e) { var n; null === (n = e.parentNode) || void 0 === n || n.removeChild(e); }, empty: function (e) { for (; e.firstChild;)
            e.removeChild(e.firstChild); }, queryEl: n, qa: t, filter: function (e, n) { return Array.prototype.filter.call(document.querySelectorAll(e), n); }, addClass: function (e, n) { n.classList.add(e); }, toggleClass: function (e, n) { n.classList.toggle(e); }, removeClass: function (e, n) { n.classList.remove(e); }, getWidth: function (e) { var n = getComputedStyle(e, null), t = n.paddingLeft, r = n.paddingRight, o = e.getBoundingClientRect().width; return o -= parseFloat(t) + parseFloat(r); }, show: function (e) { e.style.display = "block"; }, hide: function (e) { e.style.display = "none"; }, getHeight: function (e) { var n = getComputedStyle(e, null), t = n.paddingTop, r = n.paddingBottom, o = e.getBoundingClientRect().height; return o -= parseFloat(t) + parseFloat(r); }, visible: function (e) { return !!(e.offsetWidth || e.offsetHeight || e.getClientRects().length); }, append: function (e, n) { e.appendChild(n); }, setAttr: r, setAttrs: function (e, n) { Object.keys(e).forEach((function (t) { r(t, e[t], n); })); }, getAttr: function (e, t) { return "string" == typeof e && (e = n(e)), e ? e.getAttribute(t) : null; }, ready: function (e) { "loading" != document.readyState ? e() : document.addEventListener("DOMContentLoaded", (function () { return e(); })); }, delegate: function (e, n, t, r) { var i = function (t) { for (var i = t.target; i && null != i; i = i.parentNode) {
            var a = o.findIndex((function (t) { return t.parentEl === e && t.elementSelector === n; }));
            if (i.matches && i.matches(n) && a >= 0) {
                r.call(i, t);
                break;
            }
        } }; o.push({ parentEl: e, elementSelector: n, handler: i, eventName: t }), e.addEventListener(t, i, !1); }, undelegate: function (e, n) { o = o.filter((function (t) { var r = t.parentEl !== e && t.elementSelector !== n; return r || t.parentEl.removeEventListener(t.eventName, t.handler), r; })); }, on: function (e, n, t) { e.addEventListener(n, (function (e) { t(e); }), !1); }, off: function (e, n, t) { e.removeEventListener(n, t); }, deepExtend: i, param: function (n) { var t = [], r = function (n, t) { return encodeURIComponent(n) + "=" + encodeURIComponent(e(t) ? t() : t || 0 === t || !1 === t ? t : ""); }; return Object.keys(n).forEach((function (e) { Array.isArray(n[e]) ? n[e].forEach((function (n) { t.push(r(e, n)); })) : t.push(r(e, n[e])); })), t.join("&"); } }; };
    pn.container.register("jqUtils", { useValue: de() }), pn.jqUtils = pn.container.resolve("jqUtils");
    var pe = function () { var e = {}, n = /\+/g, t = function (e) { try {
        return decodeURIComponent(e.replace(n, " "));
    }
    catch (e) { } }, r = function (e) { 0 === e.indexOf('"') && (e = e.slice(1, -1).replace(/\\"/g, '"').replace(/\\\\/g, "\\")), e = t(e); try {
        return e;
    }
    catch (e) { } }, o = function (n, o, i) { if (void 0 !== o) {
        if ("number" == typeof (i = Object.assign({}, e, i)).expires) {
            var a = i.expires, s = i.expires = new Date;
            s.setDate(s.getDate() + a);
        }
        return o = String(o), document.cookie = [encodeURIComponent(n), "=", encodeURIComponent(o), i.expires ? "; expires=" + i.expires.toUTCString() : "", i.path ? "; path=" + i.path : "", i.domain ? "; domain=" + i.domain : "", i.secure ? "; secure" : "", i.samesite ? "; samesite=" + i.samesite : ""].join("");
    } for (var c, l = document.cookie ? document.cookie.split("; ") : [], u = 0, d = l.length; u < d; u++) {
        var p = l[u].split("="), f = t(p.shift()), m = p.join("=");
        if (n && n === f) {
            c = r(m);
            break;
        }
        n || void 0 === (m = r(m)) || (c[f] = m);
    } return c; }; return { name: "cookie", defaults: e, raw: !1, json: false, pluses: n, set: function (e, n, t) { o(e, n, t); }, get: function (e) { return o(e); }, remove: function (e, n) { return void 0 !== o(e) && (o(e, "", Object.assign({}, n, { expires: -1 })), !0); } }; }();
    pn.container.register("cookie", { useValue: pe }), pn.cookie = pn.container.resolve("cookie");
    var fe = function (e) { function n(e) { var n, t, r, o = arguments.length, i = window[e], a = arguments, s = a[1]; if (o < 2)
        throw new Error("Minimum 2 arguments must be given"); if (Array.isArray(s)) {
        for (var c in t = {}, s) {
            n = s[c];
            try {
                t[n] = JSON.parse(i.getItem(n));
            }
            catch (e) {
                t[n] = i.getItem(n);
            }
        }
        return t;
    } if (2 != o) {
        try {
            t = JSON.parse(i.getItem(s));
        }
        catch (e) {
            throw new ReferenceError(s + " is not defined in this storage");
        }
        for (c = 2; c < o - 1; c++)
            if (void 0 === (t = t[a[c]]))
                throw new ReferenceError([].slice.call(a, 1, c + 1).join(".") + " is not defined in this storage");
        if (Array.isArray(a[c])) {
            for (var l in r = t, t = {}, a[c])
                t[a[c][l]] = r[a[c][l]];
            return t;
        }
        return t[a[c]];
    } try {
        return JSON.parse(i.getItem(s));
    }
    catch (e) {
        return i.getItem(s);
    } } function t(n) { var t, r, o = arguments.length, i = window[n], a = arguments, s = a[1], c = a[2], l = {}; if (o < 2 || !e.isPlainObject(s) && o < 3)
        throw new Error("Minimum 3 arguments must be given or second parameter must be an object"); if (e.isPlainObject(s)) {
        for (var u in s)
            t = s[u], e.isPlainObject(t) ? i.setItem(u, JSON.stringify(t)) : i.setItem(u, t);
        return s;
    } if (3 == o)
        return "object" == typeof c ? i.setItem(s, JSON.stringify(c)) : i.setItem(s, c), c; try {
        null != (r = i.getItem(s)) && (l = JSON.parse(r));
    }
    catch (e) { } r = l; for (u = 2; u < o - 2; u++)
        r[t = a[u]] && e.isPlainObject(r[t]) || (r[t] = {}), r = r[t]; return r[a[u]] = a[u + 1], i.setItem(s, JSON.stringify(l)), l; } function r(e) { var n, t, r = arguments.length, o = window[e], i = arguments, a = i[1]; if (r < 2)
        throw new Error("Minimum 2 arguments must be given"); if (Array.isArray(a)) {
        for (var s in a)
            o.removeItem(a[s]);
        return !0;
    } if (2 == r)
        return o.removeItem(a), !0; try {
        n = t = JSON.parse(o.getItem(a));
    }
    catch (e) {
        throw new ReferenceError(a + " is not defined in this storage");
    } for (s = 2; s < r - 1; s++)
        if (void 0 === (t = t[i[s]]))
            throw new ReferenceError([].slice.call(i, 1, s).join(".") + " is not defined in this storage"); if (Array.isArray(i[s]))
        for (var c in i[s])
            delete t[i[s][c]];
    else
        delete t[i[s]]; return o.setItem(a, JSON.stringify(n)), !0; } function o(t) { var r = arguments.length, i = arguments, s = i[1]; if (1 == r)
        return 0 == a(t).length; if (Array.isArray(s)) {
        for (var c = 0; c < s.length; c++)
            if (!o(t, s[c]))
                return !1;
        return !0;
    } try {
        var l = n.apply(this, arguments);
        for (var c in Array.isArray(i[r - 1]) || (l = { totest: l }), l)
            if (!(e.isPlainObject(l[c]) && e.isEmptyObject(l[c]) || Array.isArray(l[c]) && !l[c].length) && l[c])
                return !1;
        return !0;
    }
    catch (e) {
        return !0;
    } } function i(e) { var t = arguments.length, r = arguments, o = r[1]; if (t < 2)
        throw new Error("Minimum 2 arguments must be given"); if (Array.isArray(o)) {
        for (var a = 0; a < o.length; a++)
            if (!i(e, o[a]))
                return !1;
        return !0;
    } try {
        var s = n.apply(this, arguments);
        for (var a in Array.isArray(r[t - 1]) || (s = { totest: s }), s)
            if (void 0 === s[a] || null === s[a])
                return !1;
        return !0;
    }
    catch (e) {
        return !1;
    } } function a(t) { var r = arguments.length, o = window[t], i = arguments, a = [], s = {}; if ((s = r > 1 ? n.apply(this, i) : o)._cookie)
        for (var c in e.cookie())
            "" != c && a.push(c.replace(s._prefix, ""));
    else
        for (var l in s)
            a.push(l); return a; } function s(n) { if (!n || "string" != typeof n)
        throw new Error("First parameter must be a string"); c ? (window.localStorage.getItem(n) || window.localStorage.setItem(n, "{}"), window.sessionStorage.getItem(n) || window.sessionStorage.setItem(n, "{}")) : (window.localCookieStorage.getItem(n) || window.localCookieStorage.setItem(n, "{}"), window.sessionCookieStorage.getItem(n) || window.sessionCookieStorage.setItem(n, "{}")); var t = { localStorage: Object.assign({}, e.localStorage, { _ns: n }), sessionStorage: Object.assign({}, e.sessionStorage, { _ns: n }) }; return e.cookie && (window.cookieStorage.getItem(n) || window.cookieStorage.setItem(n, "{}"), t.cookieStorage = Object.assign({}, e.cookieStorage, { _ns: n })), e.namespaceStorages[n] = t, t; } var c = function (e) { var n = "jsapi"; try {
        return !!window[e] && (window[e].setItem(n, n), window[e].removeItem(n), !0);
    }
    catch (e) {
        return !1;
    } }("localStorage"), l = { _type: "", _ns: "", _callMethod: function (e, n) { var t = [this._type], r = (n = Array.prototype.slice.call(n))[0]; return this._ns && t.push(this._ns), "string" == typeof r && -1 !== r.indexOf(".") && (n.shift(), [].unshift.apply(n, r.split("."))), [].push.apply(t, n), e.apply(this, t); }, get: function () { return this._callMethod(n, arguments); }, set: function () { var n = arguments.length, r = arguments, o = r[0]; if (n < 1 || !e.isPlainObject(o) && n < 2)
            throw new Error("Minimum 2 arguments must be given or first parameter must be an object"); if (e.isPlainObject(o) && this._ns) {
            for (var i in o)
                t(this._type, this._ns, i, o[i]);
            return o;
        } var a = this._callMethod(t, r); return this._ns ? a[o.split(".")[0]] : a; }, remove: function () { if (arguments.length < 1)
            throw new Error("Minimum 1 argument must be given"); return this._callMethod(r, arguments); }, removeAll: function (n) { return this._ns ? (t(this._type, this._ns, {}), !0) : function (n, t) { var o = a(n); for (var i in o)
            r(n, o[i]); if (t)
            for (var i in e.namespaceStorages)
                s(i); }(this._type, n); }, isEmpty: function () { return this._callMethod(o, arguments); }, isSet: function () { if (arguments.length < 1)
            throw new Error("Minimum 1 argument must be given"); return this._callMethod(i, arguments); }, keys: function () { return this._callMethod(a, arguments); } }; e.cookie && (window.name || (window.name = Math.floor(1e8 * Math.random()))), e.initNamespaceStorage = function (e) { return s(e); }, c ? (e.localStorage = Object.assign({}, l, { _type: "localStorage" }), e.sessionStorage = Object.assign({}, l, { _type: "sessionStorage" })) : (e.localStorage = Object.assign({}, l, { _type: "localCookieStorage" }), e.sessionStorage = Object.assign({}, l, { _type: "sessionCookieStorage" })), e.namespaceStorages = {}, e.removeAllStorages = function (n) { e.localStorage.removeAll(n), e.sessionStorage.removeAll(n), e.cookieStorage && e.cookieStorage.removeAll(n), n || (e.namespaceStorages = {}); }; }, me = function () { var e = pn.container.resolve("cookie"), n = pn.container.resolve("jqUtils"), t = { cookie: e.set, isPlainObject: n.isPlainObject, isEmptyObject: n.isEmptyObject }; fe(t); return { get: function (e) { if (window.localStorage && "function" == typeof window.localStorage.getItem)
            return t.localStorage.get(e); }, set: function (e, n) { window.localStorage && "function" == typeof window.localStorage.getItem && t.localStorage.set(e, n); }, remove: function (e) { window.localStorage && "function" == typeof window.localStorage.getItem && t.localStorage.remove(e); } }; }();
    pn.container.register("localStorage", { useValue: me }), pn.localStorage = pn.container.resolve("localStorage");
    var ge, ve = (ge = function () { return "14.142.1, server-v14.142.1-TS-edition"; }, window.__tpVersion = "14.142.1, server-v14.142.1-TS-edition", { name: "versionService", getTinypassVersion: ge });
    pn.container.register("versionService", { useValue: ve }), pn.versionService = pn.container.resolve("versionService");
    var he = function () { var e, n = pn.container.resolve("ajax"), t = {}; return { name: "itp", synchronizeCookie: function (r, o, i) { if (pn.cloudflareWorkerUrl) {
            !function (e, n, r) { if (t[e] = { value: n }, !r)
                return; r instanceof Date ? t[e].expires = r : t[e].maxAge = 3600 * r; }(r, o, i), e && clearTimeout(e), e = setTimeout((function () { n.request({ url: pn.cloudflareWorkerUrl + "?maxAge=2628000", type: "POST", data: JSON.stringify(t), crossDomain: !0, xhrFields: { withCredentials: !0 }, error: function (e, n) { console.error(n); } }), t = {}; }), 2500);
        } } }; }();
    pn.container.register("itp", { useValue: he }), pn.itp = pn.container.resolve("itp");
    var we = function (e, n) { return we = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, n) { e.__proto__ = n; } || function (e, n) { for (var t in n)
        Object.prototype.hasOwnProperty.call(n, t) && (e[t] = n[t]); }, we(e, n); };
    var ye = function () { return ye = Object.assign || function (e) { for (var n, t = 1, r = arguments.length; t < r; t++)
        for (var o in n = arguments[t])
            Object.prototype.hasOwnProperty.call(n, o) && (e[o] = n[o]); return e; }, ye.apply(this, arguments); };
    function be(e, n) { return function (t, r) { n(t, r, e); }; }
    function ke(e, n) { if ("object" == typeof Reflect && "function" == typeof Reflect.metadata)
        return Reflect.metadata(e, n); }
    function _e(e, n, t) { if (t || 2 === arguments.length)
        for (var r, o = 0, i = n.length; o < i; o++)
            !r && o in n || (r || (r = Array.prototype.slice.call(n, 0, o)), r[o] = n[o]); return e.concat(r || Array.prototype.slice.call(n)); }
    var Ce = function (e) { void 0 === e && (e = pn.container); var n, t = e.resolve("jqUtils"), r = e.resolve("cookie"), o = e.resolve("versionService"), i = e.resolve("itp"), a = e.resolve("localStorage"), s = "", c = { ENABLED_AFTER_DISABLED: -2, NOT_DETECTED: -1, DISABLED: 0, ENABLED: 1 }; void 0 === "testString".toHex && Object.defineProperty(String.prototype, "toHex", { enumerable: !1, value: function () { for (var e = "", n = 0; n < this.length; ++n)
            e += "" + this.charCodeAt(n).toString(16); return e; } }); var l = function (e, n, t) { var o = { path: "/", expires: 0 }; void 0 !== n && (o.domain = n), void 0 !== t && (o.path = t), r.remove(e, o); }, u = function (e, n, t) { -1 !== n.indexOf("abril.com.br") && l(e, ".abril.com.br", t), -1 !== n.indexOf("scotsman.com") && l(e, ".scotsman.com", t); }, d = function (e) { var n; if (0 === document.cookie.length)
        return null; if (e instanceof RegExp)
        for (var t = document.cookie.split(";"), r = 0; r < t.length; r++) {
            var o = t[r].indexOf("=");
            if (-1 !== o) {
                var i, a = t[r].substr(0, o).trim();
                if (e.test(a)) {
                    i = t[r].substr(o + 1).trim();
                    try {
                        return decodeURIComponent(i);
                    }
                    catch (n) {
                        f('Could not uri-decode cookie "' + e.toString() + '"', n);
                    }
                    return i;
                }
            }
        }
    else {
        var s = ("; " + document.cookie).split("; " + e + "=");
        if (s.length >= 2) {
            var c = null === (n = s.pop()) || void 0 === n ? void 0 : n.split(";").shift();
            if (void 0 === c)
                return null;
            try {
                return decodeURIComponent(c);
            }
            catch (n) {
                f('Could not uri-decode cookie "' + e + '"', n);
            }
            return c;
        }
    } return null; }, p = function (e) { if (0 === document.cookie.length)
        return []; for (var n = [], t = document.cookie.split(";"), r = 0; r < t.length; r++) {
        var o = t[r].indexOf("=");
        if (-1 !== o) {
            var i, a = t[r].substr(0, o).trim();
            if (e instanceof RegExp && e.test(a)) {
                i = t[r].substr(o + 1).replace(/^\s+|\s+$/g, "");
                try {
                    i = decodeURIComponent(i);
                }
                catch (n) {
                    f('Could not uri-decode cookie "' + e.toString() + '"', n);
                }
                n.push({ name: a, value: i });
            }
            else if (a === e) {
                i = t[r].substr(o + 1).replace(/^\s+|\s+$/g, "");
                try {
                    i = decodeURIComponent(i);
                }
                catch (n) {
                    f('Could not uri-decode cookie "' + e + '"', n);
                }
                n.push({ name: a, value: i });
            }
        }
    } return n; }; function f() { for (var e = [], n = 0; n < arguments.length; n++)
        e[n] = arguments[n]; !0 === pn.debug && m.apply(void 0, e); } function m() { for (var e = [], n = 0; n < arguments.length; n++)
        e[n] = arguments[n]; if (window.console && window.console.log && window.console.log.apply && window.console.log.apply.call && void 0 !== window.console && void 0 !== window.console.log) {
        var t = ["TP:"];
        try {
            for (var r = 0; r < e.length; r++)
                t.push(e[r]);
        }
        catch (n) {
            t = e;
        }
        G() && (t = v(t)), "object" == typeof window.console.log ? window.console.log.apply.call(this, console, t) : console.log.apply(console, t);
    } } var g = function () { var e = 0; return window.pageYOffset ? e = window.pageYOffset : e = "number" == typeof (e = document.documentElement || document.body.parentNode).scrollTop ? e.scrollTop : document.body.scrollTop, e; }, v = function (e) { var n = ""; try {
        for (var t = 0; t < e.length; t++)
            try {
                n += JSON.stringify(e[t]) + ", ";
            }
            catch (e) {
                n += "" + e;
            }
        return [n];
    }
    catch (n) {
        return e;
    } }, h = function () { var e, n; return "CSS1Compat" === document.compatMode ? (e = document.documentElement.clientWidth, n = document.documentElement.clientHeight) : (e = document.body.clientWidth, n = document.body.clientHeight), { x: e, y: n }; }, w = function (e) { e = e.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]"); var n = new RegExp("[\\?&]" + e + "=([^&#]*)").exec(location.search); return null === n ? "" : decodeURIComponent(n[1].replace(/\+/g, " ")); }, y = function (e) { var n = e(location.href); if (history && "function" == typeof history.replaceState) {
        var t = "object" == typeof window.next && "object" == typeof window.next.router ? { url: e(history.state.url || ""), as: e(history.state.as || ""), options: history.state.options } : history.state;
        history.replaceState(t, document.title, n);
    }
    else
        location.href = n; }, b = function (e, n, t) { var r = ye({ path: "/", expires: 730 }, t && { domain: t }), o = S(); for (var i in o)
        l(e, o[i]); r.domain && u(e, r.domain), (pn.cookieDomain || pn.cookiePath) && (r.domain = pn.cookieDomain ? pn.cookieDomain : r.domain, l(e, r.domain, r.path), r.path = pn.cookiePath ? pn.cookiePath : r.path, l(e, r.domain, r.path)), l(e), q(e, n, r); }, k = function () { var e, n, t = "get_top_level_domain_cookie", r = document.location.hostname.split("."); for (e = r.length - 1; e >= 0; e--) {
        var o = { path: "/", domain: n = "." + r.slice(e).join(".") };
        if (q(t, n, o), V(t))
            return o.expires = new Date(1), q(t, n, o), n;
    } }, _ = function (e) { return pn.useAidSpecifiedCookies && pn.aid ? e + "_" + pn.aid : e; }, C = function () { var e, n = _("__pls"), t = d(n); if (t)
        try {
            if ((e = JSON.parse(t)) && !Array.isArray(e))
                throw new Error("Push list subscriptions must be an array");
        }
        catch (e) {
            f("Can't get push list subscriptions", e);
        } return e; }, I = function (e) { n = e; var t = k(); q("__pat", n, { path: "/", expires: 30, domain: t }); }, S = function () { var e = []; e.push(document.domain); for (var n = document.domain.split("."); n.length >= 2;)
        e.push("." + n.join(".")), n.shift(); return e; }, x = function (e) { var n = V(e); return "boolean" === t.type(n) || "string" === t.type(n) && n.length ? !0 === n || "true" === n ? c.ENABLED : c.DISABLED : c.NOT_DETECTED; }, P = function () { var e = V("__pnahc"), n = !1; return void 0 === e && (e = "0", n = !0), { cookieValue: parseInt(e, 10), isFirst: n }; }, E = {}, T = function (e) { E[e] ? E[e].counter++ : E[e] = { counter: 1, waiters: [] }; }, A = function (e, n) { if (E[e] && (E[e].counter--, E[e].counter <= 0)) {
        var t = [];
        E[e].waiters.forEach((function (e) { t.push(e); })), delete E[e], t.forEach((function (e) { e(void 0 !== n ? n : {}); }));
    } }, M = function () { return navigator.userAgent || navigator.vendor || window.opera; }, O = function () { return o.getTinypassVersion().indexOf("SNAPSHOT") >= 0; }, R = function () { return "https:" === document.location.protocol; }, L = function (e, n) { var t = [], r = e.indexOf(n); return -1 === r ? t.push(e) : (t.push(e.substr(0, r)), t.push(e.substr(r + 1))), t; }, N = function (e) { var n, t, r = L(e, "="); void 0 !== e && (n = r[0], t = r[1]); var o = ""; return void 0 !== n && (o += encodeURIComponent(decodeURIComponent(n))), void 0 !== t && (o += "=" + encodeURIComponent(decodeURIComponent(t))), o; }, U = function (e) { var n = parseInt(e, 10); return !(isNaN(parseFloat(n)) || n < 0 || n > 255); }, j = function (e) { var n = document.createElement("a"); n.href = /^https?:\/\//i.test(e) ? e : "http://" + e; var t = n.hostname; return 0 === t.indexOf("www.") && (t = t.replace("www.", "")), t; }; var D = function (e, n) { return new RegExp("\\?" + n, "gi").test(e) ? e.split("&").length > 1 ? e.replace(new RegExp(n + "[^&]+&?", "gi"), "") : e.replace(new RegExp("\\?" + n + "[^&]+&?", "gi"), "") : new RegExp("\\&" + n, "gi").test(e) ? e.replace(new RegExp("\\&" + n + "[^&]+", "gi"), "") : e; }, F = function (e, n) { try {
        var t = new Error, r = pn.user.getProvider().getName(), o = JSON.stringify([{ aid: pn.aid, description: "clearing __tp cookie", userProvider: r, accessTokenList: e, userToken: n, url: window.location.href, trace: X(t.stack, 3), tags: ["sdk"] }]);
        pn.api.callApi("/anon/error/log", { log_message: o });
    }
    catch (e) { } }; var B = function (e) { e || (e = 730); var n = pn.getMaxCookieExpirationInDays(); if (null !== n) {
        var t;
        "number" == typeof e ? (t = new Date).setDate(t.getDate() + e) : t = e;
        var r = new Date;
        if (r.setDate(r.getDate() + n), t > r)
            return n;
    } return e; }, V = function (e) { return r.get(e); }, q = function (e, n, t) { t = t || {}, "11C6aYHwtb" === pn.aid ? (t.samesite = "none", t.secure = !0) : t.samesite = "lax", t.expires && (t.expires = B(t.expires)), r.set(e, n, t), void 0 !== i.synchronizeCookie && i.synchronizeCookie(e, n, t.expires); }, z = "__tp-", H = "-expiration", W = function () { return Math.floor((new Date).getTime() / 1e3); }, J = function (e) { var n = z + e; a.remove(n), a.remove(n + H); }, G = function () { var e = ["__webdriver_evaluate", "__selenium_evaluate", "__webdriver_script_function", "__webdriver_script_func", "__webdriver_script_fn", "__fxdriver_evaluate", "__driver_unwrapped", "__webdriver_unwrapped", "__driver_evaluate", "__selenium_unwrapped", "__fxdriver_unwrapped"], n = ["_phantom", "__nightmare", "_selenium", "callPhantom", "callSelenium", "_Selenium_IDE_Recorder"]; for (var t in n) {
        if (window[n[t]])
            return !0;
    } for (var r in e) {
        var o = e[r];
        if (window.document[o])
            return !0;
    } for (var i in window.document)
        if (i.match(/\$[a-z]dc_/) && window.document[i].cache_)
            return !0; return !!(window.external && window.external.toString && window.external.toString() && -1 !== window.external.toString().indexOf("Sequentum")) || (!!window.document.documentElement.getAttribute("selenium") || (!!window.document.documentElement.getAttribute("webdriver") || !!window.document.documentElement.getAttribute("driver"))); }, Q = function () { return V("__tac"); }, X = function (e, n) { return e && e.split("\n").filter((function (e, t) { return t > 0 && t < n + 1; })).map((function (e) { return e.trim(); })).join("\n"); }; return { name: "util", __private__: { getAdjustedCookieExpiration: B }, __protected__: { deleteTLDCookieForSpecificDomains: u, documentReady: function (e) { var n = function () { document.removeEventListener("DOMContentLoaded", n), window.removeEventListener("load", n), e(); }; "complete" === document.readyState || "loading" !== document.readyState && !document.documentElement.doScroll ? window.setTimeout(e) : (document.addEventListener("DOMContentLoaded", n), window.addEventListener("load", n)); }, getCookie: V, setCookie: q, getLocalStorageItem: function (e) { var n = z + e, t = a.get(n), r = a.get(n + H); return r && r < W() ? (J(e), null) : t; }, hasLocalStorage: function () { try {
                return "object" == typeof window.localStorage && "function" == typeof window.localStorage.getItem;
            }
            catch (e) {
                return !1;
            } }, randomStringCxCompatible: function () { for (var e = (new Date).getTime().toString(36); e.length < 16;)
                e += Math.round(2147483647 * Math.random()).toString(36); return e.substr(0, 16); }, setLocalStorageItem: function (e, n, t) { var r = z + e; a.set(r, n), t && a.set(r + H, W() + t); }, removeLocalStorageItem: J, cameFromFbSubscriptions: function () { return 0 === w("redirect_uri").indexOf("https://www.facebook.com/subscriptions/account-linking/confirm/"); }, logRemoveTokens: function (e) { try {
                var n = new Error, t = pn.user.getProvider().getName(), r = JSON.stringify([{ aid: pn.aid, description: "clearing __utp cookie", userProvider: t, userToken: e, url: window.location.href, trace: X(n.stack, 3), tags: ["sdk"] }]);
                pn.api.callApi("/anon/error/log", { log_message: r });
            }
            catch (e) { } }, waitAllPromises: function (e) { return Promise.all(e); }, isInteger: function (e) { return "number" == typeof e && isFinite(e) && Math.floor(e) === e; }, racePromise: function (e) { return Promise.race(e); }, isCxenseBot: function () { var e = M(); return /(cxensebot)/i.test(e); }, isHttpsProtocol: R, isApplePayAllowed: function () { var e = !1; try {
                e = window.ApplePaySession && window.ApplePaySession.canMakePayments();
            }
            catch (e) {
                m("ApplePay error", e);
            } return (O() || R()) && e; }, isDevEndpoint: O }, addScript: function (e, n) { var t, r = document.createElement("script"), o = document.getElementsByTagName("script")[0]; null === (t = o.parentNode) || void 0 === t || t.insertBefore(r, o), r.type = "text/javascript", r.async = !0, r.onload = n, r.src = e; }, fromUnderscoreToCamelCase: function (e) { return e.slice().replace(/_[a-z]/g, (function (e) { return e.replace("_", "").toUpperCase(); })); }, randomString: function (e) { e || (e = 5); var n = "", t = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"; if (window.crypto && window.crypto.getRandomValues && "function" == typeof Uint32Array) {
            var r = new Uint32Array(e);
            window.crypto.getRandomValues(r);
            for (var o = 0; o < e; o++)
                n += t.charAt(r[o] % t.length);
        }
        else
            for (o = 0; o < e; o++)
                n += t.charAt(Math.floor(Math.random() * t.length)); return n; }, log: m, debug: f, error: function () { for (var e, n = [], t = 0; t < arguments.length; t++)
            n[t] = arguments[t]; m.apply(void 0, n), (e = "string" == typeof arguments[0] ? new Error(arguments[0]) : new Error).stack && m(e.stack); }, findCookieByName: d, findCookiesByName: p, removeVoucherCodeFromUrl: function (e) { return D(e, "voucher_code"); }, removeSharedAccountCodeFromUrl: function (e) { return D(e, "shared_account_code"); }, deleteCookie: l, mapArrayIndex: function (e, n) { return n; }, getScroll: g, getPageSize: function () { return { x: Math.max(document.documentElement.clientWidth, document.body.scrollWidth, document.documentElement.scrollWidth, document.body.offsetWidth, document.documentElement.offsetWidth), y: Math.max(document.documentElement.clientHeight, document.body.scrollHeight, document.documentElement.scrollHeight, document.body.offsetHeight, document.documentElement.offsetHeight) }; }, getViewport: h, center: function (e, n) { var t = g(), r = h(); return (r = { x: r.x / 2 - e / 2, y: r.y / 2 - n / 2 + t }).x = Math.max(0, r.x), r.y = Math.max(10, r.y), r; }, centerScreen: function (e, n) { e = e || 0, n = n || 0; var r = void 0 !== window.screenLeft ? window.screenLeft : window.screen.left, o = void 0 !== window.screenTop ? window.screenTop : window.screen.top, i = t.winSize(); return { left: (i.width || document.documentElement.clientWidth || window.screen.width) / 2 - e / 2 + r, top: (i.height || document.documentElement.clientHeight || window.screen.height) / 2 - n / 2 + o }; }, getQueryParamByName: w, hasQueryParamByName: function (e) { var n = {}; return location.search.substr(1).split("&").forEach((function (e) { var t = e.split("="), r = t[0], o = t[1] && decodeURIComponent(t[1]); r in n ? n[r].push(o) : n[r] = [o]; })), n.hasOwnProperty(e); }, removeQueryParamByName: function (e) { y((function (n) { return function (e, n) { var t, r = e.split("#"), o = r[0].split("?"); if (r.length >= 2 && (t = r[1]), n = Array.isArray(n) ? n : [n], o.length >= 2) {
            for (var i = o[1].split(/[&;]/g), a = 0; a < n.length; a++)
                for (var s = encodeURIComponent(n[a]) + "=", c = i.length; c-- > 0;)
                    -1 !== i[c].lastIndexOf(s, 0) && i.splice(c, 1);
            return e = o[0] + (i.length > 0 ? "?" + i.join("&") : ""), t ? e + "#" + t : e;
        } return e; }(n, e); })); }, setAccessTokenListCookie: function (e, n, r) { var o = _("__ut"); if (e && "string" === t.type(e.value)) {
            var i = new Date, a = { domain: undefined, path: "/", expires: 730 };
            e.cookie_domain && "localhost" !== e.cookie_domain && t.inArray(e.cookie_domain, S()) >= 0 && (a.domain = e.cookie_domain), pn.cookieDomain && (a.domain = pn.cookieDomain), pn.cookiePath && (a.path = pn.cookiePath);
            var s = S();
            for (var c in s)
                l("__tac", s[c]), l("__tae", s[c]), l(o, s[c]);
            q("__tac", e.value, a), q("__tae", i.getTime(), a), q(o, n, a), "" !== n || r || F(e, n);
        }
        else {
            var u = S();
            if (u.push(void 0), pn.cookieDomain && u.push(pn.cookieDomain), pn.cookiePath)
                for (var c in u)
                    l("__tac", u[c], pn.cookiePath), l("__tae", u[c], pn.cookiePath), l("__eea", u[c], pn.cookiePath), l(o, u[c], pn.cookiePath);
            for (var c in u)
                l("__tac", u[c]), l("__tae", u[c]), l("__eea", u[c]), l(o, u[c]);
            r || F(e, n);
        } }, setTpccCookies: function () { var e = w("tpcc"); if (e) {
            var n = new Date, t = JSON.stringify({ date: n.getTime() }), r = k();
            /^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(location.hostname) && (r = ""), r || (r = ""), q("tpcc_" + e, t, { path: "/", expires: 90, domain: r });
        } }, getCampaigns: function (e) { p(/^tpcc_.+/).forEach((function (n) { e[n.name] = n.value; })); }, getCustomCookies: function () { var e = {}; return p(/^_pc_.+/).forEach((function (n) { e[decodeURIComponent(n.name)] = n.value; })), e; }, ADBLOCKER_STATUS: c, getAdblockStatus: function () { var e, n, t = c.NOT_DETECTED, r = P(); return pn.adblockerCookieName && (t = x(pn.adblockerCookieName)), t === c.NOT_DETECTED && (t = x("__pac")), t === c.NOT_DETECTED && (t = x("__adblocker")), e = r.cookieValue, e <<= 1, (n = t) === c.ENABLED ? e |= 1 : e &= -2, n !== c.NOT_DETECTED && q("__pnahc", e + "", { path: "/", expires: 90 }), t === c.ENABLED && (r.isFirst || 1 != (r.cookieValue >> 0 & 1) && (t = c.ENABLED_AFTER_DISABLED)), t; }, getAdblockerStatusReason: function () { return void 0 !== window.blockAdBlock ? "1" : "0"; }, getAdblockerHistoryCookieInfo: P, waitCall: function (e, n) { E[e] ? E[e].waiters.push(n) : n(); }, startCall: T, doneCall: A, hasCall: function (e) { return !!E[e]; }, debounce: function (e, n, t) { var r; return function () { var o = this, i = Array.prototype.slice.call(arguments), a = function () { r = null, t || e.apply(o, i); }, s = t && !r; clearTimeout(r), r = setTimeout(a, n), s && e.apply(o, i); }; }, throttle: function (e, n) { var t, r, o = !1; return function i() { if (o)
            return t = arguments, void (r = this); e.apply(this, arguments), o = !0, setTimeout((function () { o = !1, t && (i.apply(r, t), t = r = null); }), n); }; }, profile: function (e) { function n() { return n.__invokeCount++, e.apply(this, arguments); } return Object.defineProperty(n, "__invokeCount", { writable: !0, value: 0 }), Object.defineProperty(n, "invokeCount", { get: function () { return this.__invokeCount; } }), n; }, setTbcCookieFromResponse: function (e) { e.browser && void 0 !== e.browser.tbc && b("__tbc", e.browser.tbc, e.browser.cookie_domain), e.tbc && e.tbc.cookie_value && b("__tbc", e.tbc.cookie_value, e.tbc.cookie_domain); }, setTacCookieFromResponse: function (e) { var n = (new Date).getTime(), t = Q(), r = function (e, r) { e && e !== t && (b("__tac", e, r), b("__tae", n, r)); }; e.browser && r(e.browser.tac, e.browser.cookie_domain), e.tac && r(e.tac.cookie_value, e.tac.cookie_domain); }, getTbcCookie: function () { return V("__tbc"); }, getTacCookie: Q, getAidSpecifiedName: _, getUserTokenCookie: function () { var e = _("__ut"), n = d(e); return void 0 !== n && n && n.length >= 0 ? n : null; }, getPushListsCookie: C, setPushListsCookie: function (e) { if (e) {
            var n = _("__pls"), t = C() || [];
            t.indexOf(e) > -1 || (t.push(e), l(n), q(n, JSON.stringify(t), { path: "/", expires: 730, domain: k() }));
        } }, setAppTimezoneOffsetFromResponse: function (e) { e.browser && void 0 !== e.browser.app_timezone_offset ? I(e.browser.app_timezone_offset) : void 0 !== e.timezone_offset && I(e.timezone_offset); }, setAppTimezoneOffset: I, getAppTimezoneOffset: function () { return null == n && (n = V("__pat")), n || 0; }, getBrowserTimezoneOffset: function () { return -Math.round((new Date).getTimezoneOffset()); }, str2timestamp: function (e) { if (void 0 !== e && 0 !== e.length) {
            if ("string" != typeof e && (e = "" + e), (e = e.trim()).match(/^[0-9]{0,10}$/))
                return parseInt(e);
            if (e.match(/^[0-9]{13,}$/))
                return parseInt(e) / 1e3;
            var n = Date.parse(e);
            if (n)
                return n / 1e3;
            if ((e = (e = (e = (e = e.replace(/00:([0-9]{2}(:[0-9]{2})?\s*[AP]M)/i, "12:$1").replace(/([0-9]{2})([AP|M])/i, "$1 $2")).replace(/\s*(at|@|\-|on|\|)\s*/gi, " ")).replace(/\s*(mon(day)?|tue(s?day)?|wed(nesday)?|thu((rs)?day)?|fri(day)?|sat(urday)?|sun(day)?)\s*/gi, "")).replace(/([0-9]{1,2})(st|nd|rd|th)/, "$1")).match(/\s+ET$/))
                e = 240 === (new Date).getTimezoneOffset() ? e.replace(/\s+ET$/, " EDT") : e.replace(/\s+ET$/, " EST");
            if (e = e.trim(), n = Date.parse(e))
                return n / 1e3;
            var t = e.match(/!^([a-z]+)[-/ ]([0-9]+)[-/ ]([0-9]+)(.*)$!i/);
            return t ? e = t[2] + " " + t[1] + " " + t[3] + t[4] : (t = e.match(/!^([0-9]+)[-/ ]([a-z]+)[-/ ]([0-9]+)(.*)$!i/)) && (e = t[1] + " " + t[2] + " " + t[3] + t[4]), (n = Date.parse(e)) ? n / 1e3 : void 0;
        } }, getPossibleCookieDomains: S, isMobileTabletIOs: function () { var e = M(); return /iPad|iPhone|iPod/.test(e) && !window.MSStream; }, isIphone: function () { var e = M(); return /iPhone/.test(e) && !window.MSStream; }, isIOS: function () { var e = M(); return /iPad|iPhone|iPod/.test(e) && !window.MSStream; }, isIOsUiWebView: function () { var e = M(); return /(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(e); }, isSafariOrIOsUiWebView: function () { var e = M(); return /(iPhone|iPod|iPad).*AppleWebKit/i.test(e); }, isFBOrInstWebView: function () { var e = M(); return e.indexOf("FBAN") > -1 || e.indexOf("FBAV") > -1 || e.indexOf("Instagram") > -1; }, isAndroid: function () { var e = M(); return /(android)/i.test(e); }, isIE: function () { var e = -1 !== (navigator && navigator.appVersion || "").indexOf("MSIE"), n = (navigator && navigator.userAgent || "").indexOf("Trident/") > 0; return e || n; }, isCriOS: function () { return -1 !== (navigator && navigator.userAgent || "").indexOf("CriOS"); }, isRelativeUrl: function (e) { return /^\/(?:\w+|\.{1,2}\/\w+)/.test(e); }, prepareUrlParameter: function (e) { if (!e)
            return ""; var n = function (e) { var n = e.indexOf("?"), t = e.indexOf("#"), r = !1; -1 !== t && (r = !0); var o, i = !1; -1 !== n && (i = !0), r && i && t < n && (i = !1); var a = "", s = ""; if (i) {
            var c = L(e, "?");
            if (o = c[0], r) {
                var l = L(c[1], "#");
                a = l[0], s = l[1];
            }
            else
                a = c[1];
        }
        else if (r) {
            var u = L(e, "#");
            o = u[0], s = u[1];
        }
        else
            o = e; return { schemeDomainAndPath: o, queryString: a, hash: s, hasQueryString: i, hasHash: r }; }(e = e.replace(/^((%20)|\s)+/, "")), t = encodeURI(decodeURI(n.schemeDomainAndPath)); return n.hasQueryString && (t += "?" + function (e) { var n = ""; if (void 0 !== e)
            for (var t = e.split("&"), r = 0; r < t.length; r++)
                r > 0 && (n += "&"), n += N(t[r]); return n; }(n.queryString)), n.hasHash && (t += "#" + encodeURIComponent(decodeURIComponent(n.hash))), t; }, getReferrer: function () { return document.referrer; }, getHostname: j, extractCookieDomain: function (e) { if (e && e.length && "." === e[0])
            return e; var n = e || window.location.href, t = j(n); return function (e) { var n = e.split("."), t = !0; return 4 === n.length && U(n[0]) && U(n[1]) && U(n[2]) && U(n[3]) || (t = !1), t; }(t) ? t : "localhost" === t ? null : "." + t; }, setCurrentDomainFromResponse: function (e) { void 0 !== e.browser && void 0 !== e.browser.cookie_domain && A("domainIsReceived", e.browser.cookie_domain), e.tbc && e.tbc.cookie_domain && A("domainIsReceived", e.tbc.cookie_domain); }, getCurrentDomainFromCookie: function (e) { try {
            return JSON.parse(V(e)).domain;
        }
        catch (e) {
            T("domainIsReceived");
        } }, isBot: G, getAffiliateToken: function (e) { var n = window.location.hash.slice(1); if (n) {
            var t = n.split("="), r = t[0], o = t[1];
            r && o && r === e && (y((function (e) { return e.split("#")[0]; })), s = o);
        } return s; }, removeAffiliateToken: function () { s = ""; } }; };
    pn.container.register("util", { useValue: Ce() }), pn.util = pn.container.resolve("util");
    var Ie = function () { var e, n = pn.container.resolve("jqUtils"), t = pn.container.resolve("util"), r = pn.container.resolve("ajax"), o = t.findCookieByName(/__TP_*/); if (void 0 !== window._tpm && void 0 !== window._tpm.paywallID) {
        var i = window._tpm.paywallID;
        e = t.__protected__.getCookie("umc_" + i);
    } var a = function () { return pn.getApiEndpoint(); }, s = function (n, r) { var i = t.__protected__.getCookie("__tac"); void 0 !== n && n || (n = {}), n.aid = pn.aid, e && (n.umc = e), o && (n.tp_access_token_v2 = o), i && (n.tac = i), n.user_provider || !r || r.isv || (n.user_provider = r.getName()), void 0 !== n.user_token && n.user_token || !r || r.isv || (n.user_token = "string" == typeof r.getToken() ? r.getToken() : ""); var a = t.getAffiliateToken(pn.affiliateTokenName); a && (n.affiliateToken = a); }; function c(e, o, i, c, l, u) { var d; t.debug("Calling API method: " + e), d = void 0 !== c ? c : a(), d += e, void 0 !== o && o || (o = {}); var p, f, m = t.getTbcCookie(); m && (o.tbc = m), pn.user && (p = pn.user.getProvider()), s(o, p), f = function (e) { t.debug("API Response", e), t.setTbcCookieFromResponse(e), t.setAppTimezoneOffsetFromResponse(e), t.setCurrentDomainFromResponse(e), void 0 !== i && i(e); }; var g = function (e) { var n = "/access/list", t = "/access/check"; if (e !== n && e !== t && "/user/access/list" !== e && "/user/access/check.jwt" !== e)
        return null; var r = Math.floor((new Date).getTime() / 1e3); return e === n ? { code: 0, count: 0, data: [], limit: 0, offset: 0, total: 0, ts: r } : e === t ? { code: 0, ts: 1548942314, access: { access_id: null, parent_access_id: null, granted: !1, resource: null, user: null, expire_date: r } } : { code: 403, ts: r, message: "User doesn't have permission to call this method" }; }(e); if (null === g || pn.user.getProvider().isUserValid()) {
        var v;
        !function (e) { pn.isDoubleOptInCheckOnAccessCheckEnabled && "/access/check" === e && pn.doubleOptIn.check(); }(e);
        var h = { dataType: "jsonp" };
        if (u) {
            var w = o.aid;
            delete o.aid, v = "aid=" + w, Object.assign(h, { type: "POST", dataType: "json", data: o });
        }
        else
            o.callApiJsonp = !0, v = n.param(o);
        d += "?" + v, h.url = d, l && (h.async = !1), h.success = function (e) { f(e); }, h.error = function (e) { var n = { code: 503, message: "Error: Received error when requesting API response from URL: " + d }; t.log(n.message), f(n); }, r.request(h);
    }
    else
        f(g); } return { name: "api", callApi: function (e, n, t, r, o, i) { return c(e, n, t, r, o, i); }, getEndpoint: function () { return a(); }, getCallParams: function (e, n) { return s(e, n); } }; }();
    pn.container.register("api", { useValue: Ie }), pn.api = pn.container.resolve("api");
    var Se = function () { var e, n, t, r, o, i, a, s, c, l, u, d = pn.container.resolve("jqUtils"), p = pn.container.resolve("util"), f = {}, m = {}, g = [], v = {}, h = (e = {}, i = 1, a = window, s = !1, l = "addEventListener", u = a[c = "postMessage"], e[c] = function (e, n, t) { n && (e = "string" == typeof e ? e : d.param(e), t = t || parent, u ? t[c](e, n.replace(/([^:]+:\/\/[^\/]+).*/, "$1")) : n && (t.location = n.replace(/#.*$/, "") + "#" + +new Date + i++ + "&" + e)); }, e.receiveMessage = o = function (e, i, c) { u ? (e && (r && o(), r = function (n) { if ("string" == typeof i && n.origin !== i || d.isFunction(i) && i(n.origin) === s)
        return s; e(n); }), a[l] ? a[e ? l : "removeEventListener"]("message", r, s) : a[e ? "attachEvent" : "detachEvent"]("onmessage", r)) : (n && clearInterval(n), n = null, e && (c = "number" == typeof i ? i : "number" == typeof c ? c : 100, n = setInterval((function () { var n = document.location.hash, r = /^#?\d+&/; n !== t && r.test(n) && (t = n, e({ data: n.replace(r, "") })); }), c))); }, e); var w = function (e, n, t) { t && _(t) && !(t in m) ? p.error("Cannot send message to unmanaged iframe: " + t) : t && m[t].element && ("popup" === m[t].config.displayMode || "popup" !== m[t].config.displayMode && m[t].element.contentWindow ? y(e, n, t) : (g.push({ event: e, params: n, recipient: t }), d.on(m[t].element, "load", function (e) { return function () { var n = g.filter((function (n) { return n.recipient === e; })); g = g.filter((function (n) { return n.recipient !== e; })); for (var t = n.length; t--;) {
        var r = n.pop();
        y(r.event, r.params, r.recipient);
    } }; }(t)))); }, y = function (e, n, t) { var r, o = {}, i = "popup" === m[t].config.displayMode ? "opener" : "parent"; o.sender = _(t) ? i : t, o.recipient = _(t) ? t : i, o.event = e, o.params = n; var a = m[t].element; r = "popup" === m[t].config.displayMode ? m[t].container : a && a.contentWindow ? a.contentWindow : a && "[object Window]" === a.toString() ? m[t].element : window[i], h.postMessage(JSON.stringify(o), f[t].postMessageUrl, r); }; var b = function (e) { f[e.iframeId] = { iframeConfig: null, receive: null, postMessageUrl: null, initializedListener: !1, initializedKeystrokeHandler: !1 }, m[e.iframeId] = e; }, k = function (e) { return !(!f[e] || !f[e].iframeConfig); }, _ = function (e) { return !f[e] || !f[e].iframeConfig; }, C = function (e) { var n = I(e); return n.showCloseButton && "inline" !== n.displayMode; }, I = function (e) { var n = f[e], t = n && n.iframeConfig && n.iframeConfig.iframe; return t && t.config; }; function S(e) { var n, t, r, o, i, a, s = !1; try {
        n = JSON.parse(e.data);
    }
    catch (t) {
        try {
            r = e.data, i = {}, a = { true: !0, false: !1, null: null }, r.replace(/\+/g, " ").split("&").forEach((function (e, n) { var t = n.split("="), r = ""; try {
                r = decodeURIComponent(t[0]);
            }
            catch (e) {
                return;
            } var s, c = i, l = 0, u = r.split("]["), d = u.length - 1; if (/\[/.test(u[0]) && /\]$/.test(u[d]) ? (u[d] = u[d].replace(/\]$/, ""), d = (u = u.shift().split("[").concat(u)).length - 1) : d = 0, 2 === t.length)
                if (s = decodeURIComponent(t[1]), o && (s = s && !isNaN(s) ? +s : "undefined" === s ? void 0 : void 0 !== a[s] ? a[s] : s), d)
                    for (; l <= d; l++)
                        c = c[r = "" === u[l] ? c.length : u[l]] = l < d ? c[r] || (u[l + 1] && isNaN(u[l + 1]) ? {} : []) : s;
                else
                    Array.isArray(i[r]) ? i[r].push(s) : void 0 !== i[r] ? i[r] = [i[r], s] : i[r] = s;
            else
                r && (i[r] = o ? void 0 : ""); })), (n = i) && (s = !0);
        }
        catch (n) {
            return void p.debug("Error parsing postMessage: " + e.data);
        }
    } if (x(n), s) {
        var c;
        for (var l in m)
            (t = m[l]).config.isCurtain && (c = !0, t.config.parent && f[t.config.parent].receive && f[t.config.parent].receive(n), f[l].receive && f[l].receive(n));
        c || p.debug("Error parsing postMessage: " + e.data);
    }
    else if (!_(n.sender) || n.sender && n.sender in m) {
        if (p.debug((k(n.sender) ? "iframe(" + n.recipient : "the parent") + ") received event '" + n.event + "' from iframe(" + n.sender + ")", n), f[n.sender].receive && f[n.sender].receive(n), m[n.sender] && (t = m[n.sender]).config.parent && f[t.config.parent].receive) {
            n.sender = t.config.parent, f[t.config.parent].receive(n, !0);
        }
    }
    else
        p.debug("Received message from unmanaged iframe: " + n.sender); } var x = function (e) { (v[e.event] || []).forEach((function (n) { n(e); })); }; return { name: "postmessage", init: function (e, n) { if (b(e.iframe), e.postMessageUrl) {
            if (e.iframe.iframeId) {
                f[e.iframe.iframeId].initializedKeystrokeHandler || (f[e.iframe.iframeId].initializedKeystrokeHandler = !0, d.delegate(window, "#" + e.iframe.iframeId, "keyup", (function (e) { return function (e) { 27 === e.keyCode && k(e.data.iframeId) && C(e.data.iframeId) && w("close", null, e.data.iframeId); }(e); }))), f[e.iframe.iframeId].postMessageUrl = e.postMessageUrl, f[e.iframe.iframeId].initializedListener || (f[e.iframe.iframeId].initializedListener = !0, f[e.iframe.iframeId].receive = e.receive, h.receiveMessage(S)), f[e.iframe.iframeId].iframeConfig = e;
                var t = n || {};
                t.height = document.documentElement.offsetHeight, t.width = e.iframeParams && e.iframeParams.width ? e.iframeParams.width : document.documentElement.offsetWidth, w("loaded", t, e.iframe.iframeId);
            }
        }
        else
            p.error("Must specify postMessageUrl to send and receive postMessages"); }, __protected__: { isIframeManaged: function (e) { var n = m[e]; return n && _(n); } }, send: w, removeIframe: function (e) { delete m[e], delete f[e]; }, broadcast: function (e, n, t) { for (var r in m)
            m.hasOwnProperty(r) && r === t || w(e, n, r); }, subscribe: function (e, n) { v[e] = v[e] || [], v[e].push(n); }, unsubscribe: function (e, n) { v[e] instanceof Array && (v[e] = v[e].filter((function (e) { return e !== n; }))); } }; }();
    pn.container.register("postmessage", { useValue: Se }), pn.postmessage = pn.container.resolve("postmessage");
    var xe = function () { var e = pn.container.resolve("jqUtils"), n = pn.container.resolve("util"), t = pn.container.resolve("postmessage"); return { name: "eventUtils", createEventManager: function (r) { var o, i = {}; for (o = 0; o < r.length; o++)
            i[r[o]] = []; var a = { addEvent: function (e) { void 0 === i[e] && (i[e] = []); }, hasIframeCallback: function (e, n) { var t, r; if (i[e] && i[e].length > 0)
                for (r = 0, t = null; r < i[e].length; ++r)
                    if ("object" == typeof (t = i[e][r]) && n === t.iframeId)
                        return !0; return !1; }, hasCallback: function (e) { return i[e] && i[e].length > 0; }, registerCallback: function (e, t) { var r, o, a, s = "string" == typeof e ? e : null, c = "object" == typeof e ? e : null; if (s) {
                if (r = "function" == typeof t ? t : null, void 0 === i[s])
                    return;
                i[s].push(r);
            } if (c)
                for (a in o = "string" == typeof t ? t : null, i)
                    "function" == typeof c[a] && (n.debug("Registering " + a + " callback for iframe " + o), i[a].push({ iframeId: o, callback: c[a] })); }, fireCallbacks: function (e, n, t, r) { return a.fire(t, e, r, n); }, fire: function (r, o, a, s, c, l) { var u, d, p, f = !1, m = []; s && m.push(s), c && m.push(c), l && m.push(l); var g = s && s.resultCallbackId, v = function (t) { if (a)
                try {
                    if (m.length > 1)
                        return d.apply(null, m);
                    if ("loginRequired" === o) {
                        var i = e.deepExtend({}, t.term);
                        return delete t.term, d(t, r, i);
                    }
                    return d(t, r);
                }
                catch (e) {
                    n.debug(e);
                } }; if (void 0 !== i[o]) {
                for (p = 0, u = null, d = null; p < i[o].length; ++p) {
                    if ("function" == typeof (d = i[o][p]))
                        n.debug("firing callback for event '" + o + "' from iframe(" + r + ")"), u = v(s), f = !0;
                    else if ("object" == typeof d) {
                        if (r !== d.iframeId)
                            continue;
                        n.debug("firing callback for event '" + o + "' from iframe(" + r + ")"), d = d.callback, u = v(s), f = !0;
                    }
                    g && (s.result = u, s.event = o, t.send("resultCallback", s, r));
                }
                return !f && g && (s.callbackNotFound = !0, s.event = o, t.send("resultCallback", s, r)), u;
            } }, fireCallbacksAndStopOnFirstFalse: function (e, t, r, o) { for (var a = [], s = 4; s < arguments.length; s++)
                a[s - 4] = arguments[s]; if (void 0 === i[e])
                return !0; for (var c = !0, l = 0; l < i[e].length; l++) {
                var u = i[e][l];
                if ("function" == typeof u) {
                    n.debug("firing callback for event '" + e + "'");
                    try {
                        var d = [];
                        if (d.push(t), d.push(r), d.push(o), d = d.concat([].slice.call(a)), !1 === u.apply(null, d)) {
                            n.debug("callback for event '" + e + "' returned false"), c = !1;
                            break;
                        }
                    }
                    catch (t) {
                        n.debug("firing callback for event '" + e + "' failed", t);
                    }
                }
            } return c; } }; return a; } }; }();
    pn.container.register("eventUtils", { useValue: xe }), pn.eventUtils = pn.container.resolve("eventUtils");
    var Pe = function () { var e = pn.container.resolve("util"), n = pn.container.resolve("api"), t = pn.container.resolve("eventUtils"), r = pn.container.resolve("localStorage"), o = t.createEventManager(["userChanged", "logout"]), i = "janrain", a = function () { return e.getUserTokenCookie(); }, s = function () { var e = a(); return !!(void 0 !== e && e && e.length >= 0); }, c = !1, l = !1, u = { onCaptureSessionCreated: [] }, d = { loginRequiredScreen: "signIn", appName: null, appId: null, clientId: null, settings: null, disableLogout: !1, startCapture: !1 }, p = { register: "traditionalRegistration", login: "signIn" }; var f = function (e) { return e && p.hasOwnProperty(e.startScreen) ? p[e.startScreen] : d.loginRequiredScreen; }; var m = function () { d.disableLogout || e.setAccessTokenListCookie(void 0, void 0, !0); }, g = !0, v = function () { var e = window.janrain; return e && e.capture && e.capture.ui && e.capture.ui.hasActiveSession(); }; function h() { e.log("JANRAIN:", "Processing janrain user"), g ? g = !1 : e.startCall("refreshUserToken"), e.log("JANRAIN:", "hasActiveSession:" + v()); var t = w(); if (!v())
        return e.log("JANRAIN:", "No token found.  Done processing user"), m(), void e.doneCall("refreshUserToken"); if (s())
        return e.log("JANRAIN:", "Using __ut.  Done processing user"), void e.doneCall("refreshUserToken"); var r = { janrain_capture_token: t, url: e.prepareUrlParameter(window.location.href) }; n.callApi("/anon/janrain/verifyAccountInfo", r, (function (n) { if (n && n.access)
        try {
            e.log("JANRAIN:", "Verify success.  Done processing user"), e.setAccessTokenListCookie(n.access.access_token, n.access.user_token);
            var t = { access_token: n.access.access_token, user_token: n.access.user_token };
            n.access.user && (t.user = { uid: n.access.user.uid, email: n.access.user.email, firstName: n.access.user.first_name, lastName: n.access.user.last_name, valid: n.access.user.valid }), function (e, n) { if (void 0 !== u[e] && 0 !== u[e].length)
                for (var t = 0; t < u[e].length; ++t)
                    u[e][t].apply(null, arguments); }("onCaptureSessionCreated", t), o.fireCallbacks("userChanged", t, void 0, !0);
        }
        finally {
            e.doneCall("refreshUserToken");
        }
    else
        e.log("JANRAIN:", "Verify failed"); })); } var w = function () { return r.get("janrainCaptureToken"); }, y = function () { var n = window.janrain; n.events.onProviderLogoutComplete.addHandler((function () { m(); })), n.events.onCaptureSessionEnded.addHandler((function (n) { e.log("JANRAIN: Events received for logout", n), m(); })), b(); }, b = function () { if (v())
        return e.log("JANRAIN:", "Found early active session via function"), void h(); if (!v() && !s() && !w())
        return e.log("JANRAIN:", "not found __ut cookie and janrain token"), void h(); var n = !1, t = window.janrain; t.events.onCaptureSessionFound.addHandler((function (t) { k() ? n && (e.log("JANRAIN: Events received for logged in user", t), h()) : h(); })), t.events.onCaptureSessionNotFound.addHandler((function (t) { k() ? n && (e.log("JANRAIN: Events received for logged out user", t), h()) : h(); })), t.events.onCaptureFederateNoLogin.addHandler((function (e) { n = e; })), t.events.onCaptureFederateLogin.addHandler((function (n) { e.log("JANRAIN: Events received for SSO login", n), h(); })); }, k = function () { var e = window.janrain; return e && e.settings && e.settings.capture && e.settings.capture.federate; }; function _(e, n) { if (!c)
        throw "Janrain is not configured"; var t = 0; !function r() { var o = window.janrain; if (l)
        o.events[e].addHandler((function (e) { n(e); }));
    else {
        if (t > 100)
            throw "Janrain is not initialized";
        t++, window.setTimeout(r, 100);
    } }(); } return { name: i, isv: !1, init: function (n) { if (!c) {
            if (!n.appName || !n.appId || !n.clientId)
                throw "Must specify appName, appId, and clientId to initialize janrain";
            for (var t in d)
                void 0 !== n[t] && (d[t] = n[t]);
            if (n.settings && (d.settings = n.settings), n.loginRequiredScreen && (d.loginRequiredScreen = n.loginRequiredScreen), d.settings) {
                "object" != typeof window.janrain && (window.janrain = {}), "object" != typeof window.janrain.settings && (window.janrain.settings = {});
                var r = window.janrain;
                r.settings = d.settings, "object" != typeof window.janrain.settings.capture && (window.janrain.settings.capture = {}), r.settings.appUrl = "https://" + d.appName + ".rpxnow.com", r.settings.capture.captureServer = "https://" + d.appName + ".janraincapture.com", r.settings.capture.appId = d.appId, r.settings.capture.clientId = d.clientId;
                var o, i = d.appName.replace(/\./g, "-"), a = "http://widget-cdn.rpxnow.com/load/" + i, s = "https://rpxnow.com/load/" + i;
                o = e.__protected__.isHttpsProtocol() ? s : a, pn.push(["addExternalLibrary", o, function () { r.ready = !0; }]);
            }
            e.log("JANRAIN:", "start refresh user token"), e.startCall("refreshUserToken", 3e4), e.waitCall("refreshUserToken", (function () { e.log("JANRAIN:", "end refresh user token"); })), function () { var n = 100, t = 0; function r() { var o = window.janrain; if (window.janrain && window.janrain.ready && window.janrain.capture && window.janrain.capture.ui && window.janrain.capture.ui.hasActiveSession)
                !function () { var n = window.janrain, t = function (t) { n.events[t].addHandler((function () { for (var n = [], r = 0; r < arguments.length; r++)
                    n[r] = arguments[r]; e.log("JANRAIN: ", t, n); })); }; pn.debug && n.events.captureEvents.forEach(t); }(), y(), d.startCapture && o.capture.ui.start(), l = !0;
            else {
                if (t > n)
                    throw "Janrain is not initialized";
                t++, window.setTimeout(r, 100);
            } } r(); }(), c = !0, pn.zIndexes = { backdrop: 900, modal: 950, close: 990 };
            var u = function (n) { e.log("JANRAIN: onLogin"), window.janrain.capture.ui.modal.close(), h(); };
            _("onCaptureLoginSuccess", u), _("onCaptureRegistrationSuccess", u);
        } }, isUserValid: s, getToken: a, getName: function () { return i; }, onLoginSuccess: function (n) { e.setAccessTokenListCookie({ value: n.token_list, cookie_domain: n.cookie_domain }, n.user_token); }, login: function (e, n) { if (!c)
            throw "Janrain is not configured"; var t = 0, r = function () { if (l)
            try {
                window.janrain.capture.ui.renderScreen(f(n)), "function" == typeof e && function (e, n) { u[e] = [], u[e].push(n); }("onCaptureSessionCreated", e);
            }
            catch (e) {
                return t++, void window.setTimeout(r, 100);
            }
        else {
            if (t > 100)
                throw "Janrain is not initialized";
            t++, window.setTimeout(r, 100);
        } }; r(); }, logout: function (e) { if (!c)
            throw "Janrain is not configured"; var n = 0, t = 0; function r() { t > 100 ? e() : v() ? (t++, window.setTimeout(r, 100)) : e(); } m(), function t() { if (l) {
            var i = window.janrain;
            i.capture.ui.modal.close(), i.capture.ui.endCaptureSession(), o.fireCallbacks("logout", null, void 0, !0), e && r();
        }
        else {
            if (n > 100)
                throw "Janrain is not initialized";
            n++, window.setTimeout(t, 100);
        } }(); }, isConfigured: function () { return c; }, getLoginRequiredScreen: f, addEventHandler: _, registerCallback: function (e, n) { o.addEvent(e), o.registerCallback(e, (function (e) { n(e); })); } }; }();
    pn.container.register("janrain", { useValue: Pe }), pn.janrain = pn.container.resolve("janrain");
    var Ee = { name: "sha1", hash: function (e, n) { function t(e, n) { return e << n | e >>> 32 - n; } function r(e) { var n, t = ""; for (n = 7; n >= 0; n--)
            t += (e >>> 4 * n & 15).toString(16); return t; } var o, i, a; n = n || 32; var s, c, l, u, d, p, f = new Array(80), m = 1732584193, g = 4023233417, v = 2562383102, h = 271733878, w = 3285377520, y = (e = function (e) { e = e.replace(/\r\n/g, "\n"); for (var n = "", t = 0; t < e.length; t++) {
            var r = e.charCodeAt(t);
            r < 128 ? n += String.fromCharCode(r) : r > 127 && r < 2048 ? (n += String.fromCharCode(r >> 6 | 192), n += String.fromCharCode(63 & r | 128)) : (n += String.fromCharCode(r >> 12 | 224), n += String.fromCharCode(r >> 6 & 63 | 128), n += String.fromCharCode(63 & r | 128));
        } return n; }(e)).length, b = new Array; for (i = 0; i < y - 3; i += 4)
            a = e.charCodeAt(i) << 24 | e.charCodeAt(i + 1) << 16 | e.charCodeAt(i + 2) << 8 | e.charCodeAt(i + 3), b.push(a); switch (y % 4) {
            case 0:
                i = 2147483648;
                break;
            case 1:
                i = e.charCodeAt(y - 1) << 24 | 8388608;
                break;
            case 2:
                i = e.charCodeAt(y - 2) << 24 | e.charCodeAt(y - 1) << 16 | 32768;
                break;
            case 3: i = e.charCodeAt(y - 3) << 24 | e.charCodeAt(y - 2) << 16 | e.charCodeAt(y - 1) << 8 | 128;
        } for (b.push(i); b.length % 16 != 14;)
            b.push(0); for (b.push(y >>> 29), b.push(y << 3 & 4294967295), o = 0; o < b.length; o += 16) {
            for (i = 0; i < 16; i++)
                f[i] = b[o + i];
            for (i = 16; i <= 79; i++)
                f[i] = t(f[i - 3] ^ f[i - 8] ^ f[i - 14] ^ f[i - 16], 1);
            for (s = m, c = g, l = v, u = h, d = w, i = 0; i <= 19; i++)
                p = t(s, 5) + (c & l | ~c & u) + d + f[i] + 1518500249 & 4294967295, d = u, u = l, l = t(c, 30), c = s, s = p;
            for (i = 20; i <= 39; i++)
                p = t(s, 5) + (c ^ l ^ u) + d + f[i] + 1859775393 & 4294967295, d = u, u = l, l = t(c, 30), c = s, s = p;
            for (i = 40; i <= 59; i++)
                p = t(s, 5) + (c & l | c & u | l & u) + d + f[i] + 2400959708 & 4294967295, d = u, u = l, l = t(c, 30), c = s, s = p;
            for (i = 60; i <= 79; i++)
                p = t(s, 5) + (c ^ l ^ u) + d + f[i] + 3395469782 & 4294967295, d = u, u = l, l = t(c, 30), c = s, s = p;
            m = m + s & 4294967295, g = g + c & 4294967295, v = v + l & 4294967295, h = h + u & 4294967295, w = w + d & 4294967295;
        } return (p = r(m) + r(g) + r(v) + r(h) + r(w)).toLowerCase().slice(0, n); } };
    pn.sha1 = Ee, pn.container.register("sha1", { useValue: Ee });
    var Te = function () { function e(e, n) { this._isActive = !1, this.targets = [], this.timeout = 200, this.util = n, this.callback = e; } return e.prototype._mutationSearch = function () { var e = this; this.targets.forEach((function (n) { var t = e._getState(n.element); !t === n.currentState && (n.currentState = t, e.callback([{ target: n.element }])); })), this._isActive && setTimeout(this._mutationSearch.bind(this), this.timeout); }, e.prototype._getState = function (e) { var n = [].slice.call(e.attributes).reduce((function (n, t) { return n[t.name] = e.getAttribute(t.name), n; }), {}); return JSON.stringify(n); }, e.prototype.observe = function (e) { this.targets.push({ id: this.util.randomString(), element: e, currentState: this._getState(e) }), this._isActive || (this._isActive = !0, this._mutationSearch()); }, e.prototype.disconnect = function () { this._isActive = !1, this.targets = []; }, e; }(), Ae = function () { pn.container.resolve("jqUtils"); var e = pn.container.resolve("util"), n = window.MutationObserver || window.WebKitMutationObserver || window.MozMutationObserver, t = { attributes: !0 }; return { name: "observer", create: function (r, o) { r || e.error("element must be NODE"); var i = new (n || Te)((function (e) { var n = e.map((function (e) { return e.target; })); return "function" == typeof o && o(n); }), e); return i.observe(r, t), i; } }; }();
    pn.container.register("observer", { useValue: Ae }), pn.observer = pn.container.resolve("observer");
    var Me = function () { var e, n, t = pn.container.resolve("jqUtils"), r = pn.container.resolve("util"), o = pn.container.resolve("postmessage"), i = pn.container.resolve("eventUtils"), a = pn.container.resolve("sha1"), s = {}, c = {}, l = i.createEventManager(["close"]), u = "tp-container-inner", d = new Map, p = [], f = "frozen-mobile-body", m = { _initialScrollPosition: { x: 0, y: 0 }, applyFix: function () { var e = window.visualViewport ? Math.max(window.scrollY, document.documentElement.scrollTop, window.visualViewport.pageTop) : Math.max(window.scrollY, document.documentElement.scrollTop), t = pn.dontScrollTopModal ? e : 0; this.saveInitialScroll(window.scrollX, e), n && (pn.dontScrollTopModal ? (document.body.style.touchAction = "none", document.documentElement.style.touchAction = "none", this.addEvents("scroll"), this.addEvents("touchmove")) : (v(), g(0, 0)), setTimeout((function () { var e = { overscrollBehavior: "contain", position: "absolute", top: t + "px", height: "100%", width: "100%", overflowX: "unset", overflowY: "scroll" }; Object.keys(e).forEach((function (t) { n.style[t] = e[t]; })), n.scrollHeight > document.documentElement.clientHeight && n.classList.add("tp-modal__margin-100"); }), 500)); }, addEvents: function (e) { document.body.addEventListener(e, this.scrollRevert, { passive: !1 }), document.addEventListener(e, this.scrollRevert, { passive: !1 }); }, removeEvents: function (e) { document.body.removeEventListener(e, this.scrollRevert, !1), document.removeEventListener(e, this.scrollRevert, !1); }, removeFix: function () { document.querySelectorAll(".tp-iframe-wrapper.tp-active").length || (pn.dontScrollTopModal ? (document.body.style.removeProperty("touch-action"), document.documentElement.style.removeProperty("touch-action"), this.removeEvents("scroll"), this.removeEvents("touchmove")) : (h(), this._scrollBack())); }, _scrollBack: function () { (this._initialScrollPosition.y || this._initialScrollPosition.x) && g(this._initialScrollPosition.x, this._initialScrollPosition.y); }, scrollRevert: function (e) { var n = e || window.event; return n.preventDefault && n.cancelable && n.preventDefault(), m._scrollBack(), !1; }, saveInitialScroll: function (e, n) { this._initialScrollPosition.x = e, this._initialScrollPosition.y = n; }, modalOpened: function () { this.applyFix(); }, modalClosed: function () { this.removeFix(); } }, g = function (e, n) { function t(e) { return /\{\s*\[native code\]\s*\}/.test("" + e); } try {
        if (t(window.scrollTo))
            return void window.scrollTo(e, n);
        if (t(window.scroll))
            return void window.scroll(e, n);
        document.body && (document.body.scrollTop = 0);
    }
    catch (e) {
        console.warn("Can not perform scroll: " + e.message);
    } }, v = function () { document.body.classList.contains(f) || document.body.classList.add(f); }, h = function () { document.body.classList.contains(f) && document.body.classList.remove(f); }; t.on(window, "resize", (function () { var e; if (q(), r.isAndroid()) {
        var n = null === (e = document.querySelector(".tp-iframe-wrapper.tp-active")) || void 0 === e ? void 0 : e.closest(".tp-modal");
        n && n.scrollBy(0, 1);
    } })), r.isIOS() && t.on(window, "orientationchange", (function () { setTimeout((function () { return q(); }), 100); })), o.subscribe("close", (function () { m.modalClosed(); })), o.subscribe("toggleIframeShadow", (function (e) { b(e.params.isEnabled); })), o.subscribe("toggleLoadingContainer", (function (e) { if (e.params.isEnabled)
        return J(); G(); })); var w, y, b = function (e) { var n = document.querySelector(".tp-iframe-wrapper"); if (n)
        return e ? n.classList.contains("no-shadow") && n.classList.remove("no-shadow") : void n.classList.add("no-shadow"); }, k = function (e) { !function (e) { o.send("checkProccessesForClose", {}, e.iframeId); }(e), "popup" === e.config.displayMode ? e.container.close() : function (e) { if (r.debug("Removing iframe", e), e.element && (t.hide(e.element), "inline" === e.config.displayMode)) {
        var n = e.element.parentElement;
        n && t.hide(n);
    } e.resizeObserver && e.resizeObserver.disconnect(), "modal" !== e.config.displayMode && "inline" !== e.config.displayMode || (e.waitFinishProcesses = !0); }(e); }, _ = function () { for (var e in s) {
        var n = s[e];
        if ("modal" === n.config.displayMode && !n.waitFinishProcesses && !n.config.isPreload)
            return !0;
    } return !1; }, C = function (e) { return s[e]; }, I = function () { function e(e, n, t) { this.$ = e, this._operationWithContainer = t, this.util = n, this._initModalContainer(), this.iOSBottomToolbarHeight = 90; } return e.prototype._initModalContainer = function () { var e = this; return this.container || (this.container = document.createElement("div"), this.element = this.container, this.$.addClass("tp-modal", this.container), this.close = document.createElement("button"), this.$.setAttr("type", "button", this.close), this.$.setAttr("aria-label", "Close", this.close), this.$.addClass("tp-close", this.close), this.iframeWrapper = document.createElement("div"), this.$.addClass("tp-iframe-wrapper", this.iframeWrapper), this.$.append(this.iframeWrapper, this.close), this.container.style.zIndex = pn.zIndexes.modal + "", this.close.style.zIndex = pn.zIndexes.close + "", this.$.on(this.close, "click", (function () { "function" == typeof e.closeClick && e.closeClick(); })), this.util.isIOS() && !this.util.isFBOrInstWebView() && (this.iframeWrapper.style.marginBottom = this.iOSBottomToolbarHeight + "px"), this.$.append(this.container, this.iframeWrapper), this._operationWithContainer("body", (function (n) { e.$.append(n, e.container); }))), this.container; }, e.prototype.getContainer = function (e, n) { return this._initModalContainer(), this.closeClick = n, void 0 === e && (e = !0), e ? this.showCloseButton() : this.hideCloseButton(), this.iframeWrapper; }, e.prototype.show = function (e) { this._initModalContainer(), void 0 === e && (e = !0), e ? this.showCloseButton() : this.hideCloseButton(), this.$.addClass("tp-active", this.container); }, e.prototype.hide = function () { this._initModalContainer(), this.$.removeClass("tp-active", this.container); }, e.prototype.showCloseButton = function () { this._initModalContainer(), this.$.addClass("tp-active", this.close); }, e.prototype.hideCloseButton = function () { this._initModalContainer(), this.$.removeClass("tp-active", this.close); }, e; }(), S = function (e, n, t) { for (var o in r.debug("Search container to close", e, n, t), s) {
        var i = s[o];
        e && o !== e || (t && "inline" === i.config.displayMode || t && i.config.isPreload || (k(i), "modal" === i.config.displayMode && x(i)));
    } l.fireCallbacks("close", null, e, !0); }, x = function (e) { var r = p.shift(); w && !r && t.removeClass("tp-active", w), e.iframeParams.shown = !1, t.removeClass("tp-active", e.container), r ? (t.hide(n), n = r, t.show(n)) : (P(), T()); }, P = function () { n && (L("body", (function (e) { t.addClass("tp-modal-close", e), t.removeClass("tp-modal-open", e), e.classList.contains("body-fixed") && t.removeClass("body-fixed", e); })), t.hide(n)); }, E = function (e, o, i) { if (function () { if (w)
        return w; var e = document.createElement("div"); t.addClass("tp-backdrop", e), e.style.zIndex = pn.zIndexes.backdrop + "", L("body", (function (n) { t.append(n, e); })), w = e; }(), t.visible(w)) {
        var a = t.qa(".tp-modal").find((function (e) { return t.visible(e); }));
        o && !i ? (a && (t.hide(a), p.unshift(a)), e && t.show(e)) : o && (a ? (e && p.push(e), n = a) : e && t.show(e));
    }
    else
        e && function (e) { t.visible(e) || (L("body", (function (e) { t.removeClass("tp-modal-close", e), t.addClass("tp-modal-open", e); })), t.show(e), (r.isIphone() || r.isSafariOrIOsUiWebView() || r.isAndroid()) && m.modalOpened()); }(e), t.show(w), y = window.setTimeout((function () { t.addClass("tp-active", w); }), 50); }, T = function () { w && (t.removeClass("tp-active", w), t.hide(w), clearTimeout(y)), m.modalClosed(); }, A = function (e) { w && (w.style.height = "100%"); var n = t.queryEl(".tp-close", e); n && t.removeClass("tp-square", n); }, M = function (e, n) { if (e) {
        z(e.element, n);
        var r = Object.assign({}, n, { animate: !1 });
        switch (e.config.displayMode) {
            case "modal":
                z(e.container, r), L("body", (function (e) { t.addClass("tp-modal-resizing", e), setTimeout((function () { t.removeClass("tp-modal-resizing", e); }), 50); }));
                break;
            case "inline":
                var o = t.queryEl(".tp-container-inner", e.container);
                o && z(o, n);
        }
    } }, O = function (e, r, o) { var i = e.container, a = i.parentElement; a && a.classList.contains("tp-modal") ? n = a : a = n, e.iframeParams = e.iframeParams || {}, e.iframeParams.shown || (e.iframeParams.shown = !0, E(a, r, o), o || (i.classList.contains("tp-active") || t.addClass("tp-active", i), A(i))); }, R = {}, L = function (e, n) { var r = t.queryEl(e); R[e] || (R[e] = 0), r ? (delete R[e], n(r)) : R[e] < 100 && (R[e] += 1, setTimeout((function () { L(e, n); }), 50)); }, N = function (e, o) { if (void 0 === e.showCloseButton && (e.showCloseButton = !0), e.container)
        return e.container; var i = new I(t, r, L); return e.isPreload || (n = i.element), i.getContainer(e.showCloseButton, o); }, U = function (e) { var n = { container: null, containerReady: !1 }; if (!e.iframeParams.containerSelector)
        return r.log("Inline offer must have a valid containerSelector"), n; if (n.container = e.singleContainer || t.queryEl(e.iframeParams.containerSelector), !n.container)
        return r.log("Invalid containerSelector"), n; var o = e.config, i = "object" == typeof o && null !== o; return t.empty(n.container), i ? !0 == !!o.preview || (e.iframeParams.width = t.getWidth(n.container)) : e.iframeParams.width = e.iframeParams.width || t.getWidth(n.container), n.containerReady = !0, n; }, j = function (e) { var n = t.winSize(), o = e.width ? e.width : n.width, i = e.height ? e.height : n.height, a = r.centerScreen(o, i); return { width: o, height: i, top: a.top, left: a.left }; }, D = function (e, n) { var t = j(e), o = window.open(n, r.randomString(16), "scrollbars=yes,location=yes,status=0,toolbar=0,resizable=1, width=" + t.width + ", height=" + t.height + ", top=" + t.top + ", left=" + t.left); return window.focus && o && o.focus(), o; }, F = 1, B = function (e, n, o) { var i = "iframe-" + F++ + "-" + r.randomString(); n.iframeId && (i = n.iframeId); var a = document.createElement("iframe"), s = { id: i, name: i, title: i, scrolling: "no", allowtransparency: "true", src: o, allow: "payment" }; Object.keys(s).forEach((function (e) { t.setAttr(e, s[e], a); })); var c = { overflow: "hidden", backgroundColor: "transparent", border: "0", width: "inline" === e.displayMode ? n.width + "px" : "0px", height: "0px" }; Object.keys(c).forEach((function (e) { a.style[e] = c[e]; })); try {
        t.setAttr("frameBorder", "0", a);
    }
    catch (e) {
        r.log(e);
    } return a; }, V = function (e, n) { var r = setInterval((function () { t.empty(e); }), 150); t.ready((function () { clearInterval(r), t.append(e, n); })); }, q = function () { for (var e in s) {
        var n = s[e];
        if (!n.config.preview && "inline" === n.config.displayMode && n.container && M(n, { width: t.getWidth(n.container) }), "modal" === n.config.displayMode && n.container) {
            var r = Math.max(document.documentElement.clientWidth, document.body.offsetWidth, document.documentElement.offsetWidth);
            o.send("RESIZE_MODAL_CHECKOUT", { iframe: n, width: r }, n.iframeId);
        }
    } }, z = function (e, n) { e && (void 0 !== n.width && (e.style.width = n.width + "px", (0 === n.width && !e.classList.contains("no-width") || 0 !== n.width && e.classList.contains("no-width")) && t.toggleClass("no-width", e)), void 0 !== n.height && (n.animate, e.style.height = n.height + "px", (0 === n.height && !e.classList.contains("no-height") || 0 !== n.height && e.classList.contains("no-height")) && t.toggleClass("no-height", e))); }, H = function (e) { var n = document.createElement("div"); return n.innerHTML = e.trim(), n.firstChild; }, W = function (e) { return void 0 === e && (e = ""), '<div class="tp-please-wait tp-active tp-overlap ' + e + '"><div class="tp-icon tp-centered"><div class="pn-spinner"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div></div>'; }, J = function () { e || (e = H(W())) && document.body.appendChild(e); }, G = function () { e && (document.body.removeChild(e), e = null); }; function Q(e) { if (e && e.container) {
        !function (e) { if (e && (null == e ? void 0 : e.container) && !d.has(e.iframeId)) {
            var n = H(W("tp-local-overlap"));
            n && (e.container.appendChild(n), d.set(e.iframeId, n));
        } }(e);
        e.container.addEventListener("load", (function () { !function (e) { if (e && (null == e ? void 0 : e.container) && d.has(e.iframeId)) {
            var n = d.get(e.iframeId);
            n && (e.container.removeChild(n), d.delete(e.iframeId));
        } }(e); }), { once: !0, capture: !0 });
    } } function X(e) { e && e.element && (function (e) { var n; if (!e)
        return !1; return !!(null === (n = null == e ? void 0 : e.element.getBoundingClientRect()) || void 0 === n ? void 0 : n.width); }(e) && Q(e), e.element.src = e.element.src); } function $() { for (var e in s) {
        var n = s[e];
        n && X(n);
    } } return { name: "containerUtils", fakeOfferId: "fakeOfferId", createContainer: function (e) { var n, i, d, p = !0, f = e.iframeParams; if ("inline" === f.displayMode || f.width || (f.width = window.innerWidth), i = e.config.buildQueryStringFn ? function (n) { return e.config.buildQueryStringFn(n, t); } : function (e) { var n = t.param(e); return n + "&_qh=" + a.hash(n, 10); }, "popup" === f.displayMode) {
            f.width || (f.width = window.innerWidth);
            var m = e.url + "?" + i(f);
            n = D(f, m);
            try {
                d = n.document;
            }
            catch (e) {
                try {
                    d = n;
                }
                catch (e) {
                    d = null, console.warn("Unable to get popup element");
                }
            }
            c[f.iframeId] = { container: n, interval: setInterval((function () { c[f.iframeId].container.closed && (clearInterval(c[f.iframeId].interval), c[f.iframeId].container.close(), e.onCloseCallback && e.onCloseCallback()); }), 100) };
        }
        else {
            if ("inline" === f.displayMode) {
                void 0 !== e.config.showCloseButton && delete e.config.showCloseButton;
                var g = U(e);
                n = g.container, p = !!g.containerReady;
            }
            else
                n = N(e.config, (function () { S(f.iframeId, e.parent); }));
            var v = e.url + "?" + i(f);
            d = B(e.config, f, v);
        } l.registerCallback(e, f.iframeId); var h = s[f.iframeId] = { iframeId: f.iframeId, config: e.config, element: d, container: n, iframeParams: f, containerReady: p }; if (o.init({ postMessageUrl: e.postMessageUrl, parent: e.parent, receive: e.receive, iframe: h, iframeParams: f }), t.on(document, "keyup", (function (e) { })), "modal" === f.displayMode)
            t.on(window, "resize", (function () { A(n); })), t.append(n, d);
        else if ("inline" === f.displayMode) {
            if (s[f.iframeId].containerReady) {
                var w = document.createElement("div");
                t.addClass(u, w), t.append(w, d), e.config.isPreload && t.hide(w), ("complete" === document.readyState || "loading" !== document.readyState && !document.documentElement.doScroll) && n ? (t.empty(n), t.append(n, w)) : V(n, w);
            }
            else {
                var y = document.createElement("div");
                t.setAttr("id", "temp-inline-" + f.iframeId, y), t.hide(y), L("body", (function (e) { t.append(e, y); })), t.append(y, d);
            }
            if (window.ResizeObserver) {
                var b = new ResizeObserver((function (e) { var n = t.getWidth(h.container); n > 0 && M(h, { width: n }); }));
                b.observe(h.container), h.resizeObserver = b;
            }
        } return r.debug("creating iframe: ", e), h; }, showPreloadedContainer: function (e) { if ("modal" === e.config.displayMode) {
            if (_())
                return void r.log("Modal is already shown; must be one modal per time");
            !function (e) { (n = e.container.closest(".tp-modal")) ? n = n : r.error("there is no such modal container"), O(e, !0, !0); }(e);
        }
        else
            "inline" === e.config.displayMode ? function (e) { t.show(e.container); var n = t.queryEl(".tp-container-inner", e.container); n && t.show(n), M(e, { width: t.getWidth(e.container) }); }(e) : r.log("Unexpected displayMode of preloaded iframe\n"); return e.config.isPreload = !1, e.iframeParams.isPreload = !1, r.debug("show preloaded iframe: ", e.config), e; }, redirectContainer: function (e, n) { var r = n.url + "?" + t.param(n.iframeParams), i = s[e]; if ("popup" === i.config.displayMode)
            i.container.location = r;
        else {
            var a = i.element;
            (a.contentWindow || a).location = r;
        } i.config = n.config, o.init({ postMessageUrl: n.postMessageUrl, receive: n.receive, iframe: s[n.iframeParams.iframeId], iframeParams: n.iframeParams }); }, hasModalIframe: _, getIframe: C, generateIframe: B, generateIframeWrapper: function () { var e = document.createElement("div"), n = { overflow: "hidden", backgroundColor: "transparent", border: "0", width: "0px", height: "0px", position: "absolute", display: "block", top: "-1px", left: "-1px" }; return Object.keys(n).forEach((function (t) { e.style[t] = n[t]; })), e; }, getPopupPosition: j, generatePopup: D, initInlineContainer: U, getModalContainer: N, centerBackdrop: function (e) { if (w) {
            var n = t.winSize();
            e.offsetHeight > n.height ? w.style.height = n.height + "" : w.style.height = "100%";
        } }, showBackdrop: E, hideBackdrop: T, checkBackdropAndContainer: O, resizeIframe: M, centerIt: A, operationWithContainer: L, closeContainer: S, closeModalContainer: function (e, n) { S(e, n, !0); }, purgeIframe: function (e, n) { r.debug("Purging iframe", e); var i = s[e]; try {
            if (i.resizeObserver && i.resizeObserver.disconnect(), o.removeIframe(i.iframeId), t.remove(i.element), "inline" === i.config.displayMode) {
                var a = t.queryEl(".tp-container-inner", i.container);
                a && t.remove(a);
            }
        }
        catch (e) { } delete s[e]; }, hideModalContainer: function (e) { var n = []; for (var r in s) {
            var o = s[r];
            e && r !== e || "inline" !== o.config.displayMode && "modal" === o.config.displayMode && (x(o), t.hide(o.container), n.push(r));
        } return n; }, closeModal: x, hideCloseButton: function (e) { if (e) {
            var n = t.queryEl(".tp-close", e);
            n && n.classList.contains("tp-active") && t.removeClass("tp-active", n);
        } }, activateContainers: function (e) { if (e && e.length)
            for (var n in s)
                for (var r = s[n], o = 0; o < e.length; o++)
                    if (n === e[o]) {
                        var i = r.container, a = i.parentElement;
                        a && E(a), t.addClass("tp-active", i), t.show(i);
                    } }, showWaitPanel: J, hideWaitPanel: G, addClassToContainer: function (e, n) { t.addClass(n, e.container); }, turnOnRTL: function (e) { e.container && e.container.setAttribute && e.container.setAttribute("dir", "rtl"); }, turnOffRTL: function (e) { e.container && e.container.removeAttribute && e.container.removeAttribute("dir"); }, setIframesPopstateHandlers: function () { (r.isIphone() || r.isSafariOrIOsUiWebView()) && window.addEventListener("popstate", $); }, __protected__: { setElementSizes: z, closeInlineContainers: function (e) { Array.prototype.slice.call(document.querySelectorAll(e + " > ." + "tp-container-inner > iframe")).forEach((function (e) { var n, t; e.id && (n = e.id, (t = C(n)).config.child && S(t.config.child), S(n)); })); }, addChildToInlineIframe: function (e, n) { if (e) {
                var t = C(n);
                t && t.config && (t.config.child = e.iframeId);
            } }, closeAndRemoveIframe: k }, __private__: { mobileModalFix: m } }; }();
    pn.container.register("containerUtils", { useValue: Me }), pn.containerUtils = pn.container.resolve("containerUtils");
    var Oe = function (e) { void 0 === e && (e = pn.container); var n = e.resolve("ajax"), t = e.resolve("util"); e.resolve("postmessage").subscribe("iframeLogRequest", (function (e) { o(e.url, e.queryParams); })); var r = function (e) { var n = []; for (var t in e) {
        var r = e[t];
        n.push(encodeURIComponent(t) + "=" + encodeURIComponent("object" == typeof r ? JSON.stringify(r) : r));
    } return n.join("&"); }, o = function (e, o) { var i = r(o); t.isRelativeUrl(e.trim()) ? i.length > 6e3 ? n.request({ type: "POST", url: pn.getTrackingEndpoint() + e, data: i }) : n.request({ url: pn.getTrackingEndpoint() + e + "?" + i, dataType: "jsonp" }) : t.log("Url parameter is incorrect"); }, i = function (e, n, r, i, a) { e ? r ? n ? o("/api/v3/conversion/logEspMicroConversion", { tracking_id: e, esp_widget_id: n, event_type: i, event_group_id: r, custom_params: a || "" }) : t.log("Parameter espWidgetId is required to log esp micro conversion.") : t.log("Parameter eventGroupId is required to log esp micro conversion.") : t.log("Parameter trackingId is required to log esp micro conversion."); }, a = function (e, n, r, i, a, s, c, l) { var u = { tracking_id: e, term_id: n, term_name: r }; e ? n ? r ? (void 0 !== i && (u.step_number = i), void 0 !== a && (u.amount = a), void 0 !== s && (u.currency = s), void 0 !== c && (u.custom_params = c), void 0 !== l && (u.conversion_category = l), o("/api/v3/conversion/log", u)) : t.log("Parameter termName is required to log conversion.") : t.log("Parameter termId is required to log conversion.") : t.log("Parameter trackingId is required to log conversion."); }, s = function (e, o) { if (!(i = window.doNotTrack || window.navigator.doNotTrack || window.navigator.msDoNotTrack) || "1" !== i.charAt(0) && "yes" !== i) {
        var i, a, s = r(o), c = e + "?" + s;
        if (navigator.sendBeacon)
            if (c.length > 6e3) {
                var l = new Blob([s], { type: "application/x-www-form-urlencoded" });
                navigator.sendBeacon(e, l);
            }
            else
                navigator.sendBeacon(c);
        else
            (a = -1 !== navigator.appVersion.indexOf("MSIE 9") ? { dataType: "jsonp", url: c } : { type: "post", url: c, async: !1, xhrFields: { withCredentials: !0 } }).error = function () { for (var e = [], n = 0; n < arguments.length; n++)
                e[n] = arguments[n]; t.debug.apply(t, _e(["Beacon request has been failed"], e, !1)); }, n.request(a);
    } }; return { name: "log", logMicroConversion: function (e, n, r) { e ? n ? o("/api/v3/conversion/logMicroConversion", { tracking_id: e, event_group_id: n, custom_params: r || "" }) : t.log("Parameter eventGroupId is required to log micro conversion.") : t.log("Parameter trackingId is required to log micro conversion."); }, logConversion: function (e, n, t, r, o, i, s, c) { if ("object" == typeof e) {
            var l = e;
            a(l.tracking_id, l.term_id, l.term_name, l.step_number, l.amount, l.currency, l.custom_params, l.conversion_category);
        }
        else
            a(e, n, t, r, o, i, s, c); }, logFunnelStep: function (e, n, r, i) { e ? n ? r ? o("/api/v3/conversion/logFunnelStep", { tracking_id: e, step_number: n, step_name: r, custom_params: i || "" }) : t.log("Parameter stepName is required to log funnel step.") : t.log("Parameter stepNumber is required to log funnel step.") : t.log("Parameter trackingId is required to log funnel step."); }, logEspMicroConversion: i, logBeaconRequest: s, __protected__: { logCustomFormImpression: function (e, n, r) { n || t.log("Parameter formName is required to log impression."), r || t.log("Parameter source is required to log impression."); var i = { aid: pn.aid, pageview_id: pn.main.fetchPageViewId(), custom_form_name: n, custom_form_source: r }, a = pn.user.getProvider().getToken(); return a && (i.user_token = a), e && (i.tracking_id = e), o("/api/v3/customform/log/impression", i); }, logCustomFormSubmission: function (e, n, r) { n || t.log("Parameter formName is required to log submission."), r || t.log("Parameter source is required to log submission."); var i = { aid: pn.aid, pageview_id: pn.main.fetchPageViewId(), custom_form_name: n, custom_form_source: r }, a = pn.user.getProvider().getToken(); return a && (i.user_token = a), e && (i.tracking_id = e), o("/api/v3/customform/log/submission", i); }, logEspMicroConversion: i }, __private__: { doLog: o, logBeaconRequest: s } }; };
    pn.container.register("log", { useValue: Oe() }), pn.log = pn.container.resolve("log");
    var Re = function () { var e = pn.container.resolve("log"), n = pn.container.resolve("api"), t = { completeInit: 0, expExec: 0, idShow: 0, myAccountShow: 0, offerShow: 0, templateShow: 0, tpAccShow: 0, track: 0 }; setTimeout((function () { r(); }), 1e4); var r = function (r) { if (Math.floor(500 * Math.random()) + 1 === 255) {
        var o = r || (pn.fullTPVersion ? "ts_c" : "ts_s"), i = { completeInit: t.completeInit, track: t.track, expExec: t.expExec, idShow: t.idShow, myAccountShow: t.myAccountShow, offerShow: t.offerShow, templateShow: t.templateShow, tpAccShow: t.tpAccShow, aid: pn.aid, type: o };
        e.logBeaconRequest(n.getEndpoint() + "/internal/anon/telemetry/ux/init/time/log", i);
    } }; return { name: "logging", setTime: function (e) { 0 === t[e] && (t[e] = Math.round(performance.now() - window.pnInitPerformance)); } }; }();
    pn.container.register("logging", { useValue: Re }), pn.logging = pn.container.resolve("logging");
    var Le;
    !function (e) { e.AUTO = "A", e.MANUAL = "M"; }(Le || (Le = {}));
    var Ne = function () { var e = pn.container.resolve("util"), n = pn.container.resolve("ajax"), t = pn.container.resolve("jqUtils"), r = pn.container.resolve("eventUtils"), o = function (e) { return Object.entries(e).reduce((function (e, n) { var t = n[0], r = n[1]; return (r || 0 === r) && (e[t] = r), e; }), {}); }, i = r.createEventManager([]), a = function (r, i, a) { return new Promise((function (s, c) { var l = a ? "?" + t.param(a) : "", u = pn.getExperienceEndpoint(!1) + "/" + pn.aid + r + l, d = o({ xbc: e.__protected__.getCookie("xbc") || void 0, tbc: e.getTbcCookie() || void 0 }), p = o(ye(ye({}, d), i)); if (!(p.cid && p.itemId && p.xbc)) {
        var f = "credit: Error: Required params are absent";
        e.debug(f), c({ code: 0, message: f });
    } n.request({ type: "post", url: u, data: ye(ye({}, d), i), xhrFields: { withCredentials: !0 }, error: function (n) { var t = "credit: Error: Received error:" + n.status + " " + n.responseText; e.debug(t), c({ code: n.status, message: n.responseText }); }, success: function (e) { s(e); } }); })); }, s = function (e, n, t, r) { var o = function (e) { return function (n) { return i.fire(void 0, e, !0, n), n; }; }, s = o("string" == typeof e ? e : e.success), c = o("string" == typeof e ? e : e.failure); return a(n, t, r).then(s).catch(c); }; return { redeem: function (e) { return s("manualCreditRedeemed", "/execution/credit/redeem", e); }, check: function (e) { return s("creditChecked", "/execution/credit/check", e); }, registerCallback: function (e, n) { i.addEvent(e), i.registerCallback(e, n); } }; }();
    pn.container.register("credit", { useValue: Ne }), pn.credit = pn.container.resolve("credit");
    var Ue = function () { var e, n = pn.container.resolve("postmessage"), t = pn.container.resolve("containerUtils"), r = pn.container.resolve("util"), o = pn.container.resolve("eventUtils"), i = pn.container.resolve("logging"), a = o.createEventManager(["resize", "loginSuccess", "logout"]), s = function () { return pn.getEndpointRoot(!0) + "/checkout/user/loginShow"; }; function c(o) { r.debug("Login event received", o.event, o.params, o); var i = !t.getIframe(o.sender).config.parent; switch (o.event) {
        case "loaded":
            e = !1;
            break;
        case "close":
            t.closeModalContainer(), a.fireCallbacks(o.event, o.params, o.sender, i);
            break;
        case "cancel":
        case "error":
        case "customEvent":
            a.fireCallbacks(o.event, o.params, o.sender, i);
            break;
        case "loginSuccess":
            !function (e, n, o, i) { var s = t.getIframe(o); r.setAccessTokenListCookie({ value: n.token_list, cookie_domain: n.cookie_domain }, n.user_token), s.config.userToken = n.user_token, s && s.config && s.config.loginSuccess && s.config.loginSuccess(n.event, n.params, n.sender); a.fireCallbacks(e, n, o, i), s && s.config && s.config.closeAfterSuccess && t.closeModalContainer(o); var c = { reloadAfterLogin: !0, userToken: n.user_token, user: n.user }; u(c); }(o.event, o.params, o.sender, i);
            break;
        case "logoutSuccess":
            !function (e, n, t, o) { a.fireCallbacks("logout", null, void 0, !0), r.setAccessTokenListCookie({ value: n.token_list, cookie_domain: n.cookie_domain }, n.user_token, !0); }(o.event, o.params, o.sender);
            break;
        case "readyToSubmitStats":
            var s = { pageViewId: pn.main.fetchPageViewId(), tbc: r.getTbcCookie() };
            n.send("submitStats", s, o.sender);
            break;
        default: return void r.debug("Received invalid event type: " + o.event);
    } } var l, u = function (e) { n.broadcast("reloadOffer", e); }; function d(e) { l && t.closeModalContainer(l); var n = {}; Object.assign(n, { closeAfterSuccess: !0 }, e), n.displayMode = "popup", n.width = 360, n.height = 660, n.state = n.state ? n.state : "login"; var o, i = function (e) { var n = {}; return ["displayMode", "aid", "width", "height", "state"].forEach((function (t) { e[t] && (n[t] = e[t]); })), n; }(n); i.iframeId = r.randomString(16), i.url = window.location.href, i.host_url = window.location.href, l = i.iframeId, function (e) { ["aid", "gaClientId", "tags", "contentSection", "contentAuthor"].forEach((function (n) { pn[n] && (e[n] = pn[n]); })), pn.contentCreated && (e.contentCreated = pn.contentCreated); }(i), i.user_provider = "tinypass_accounts", e.userToken && (i.user_token = e.userToken), r.getCampaigns(i); var u = { url: s(), config: n, postMessageUrl: s(), receive: c, iframeParams: i }; return n.iframeId ? (u.iframeParams.iframeId = n.iframeId, o = t.redirectContainer(n.iframeId, u)) : o = t.createContainer(u), a.registerCallback(n, i.iframeId), o; } return { name: "tinypassLogin", show: function (n) { if (e)
            return !1; e = !0, setTimeout((function () { e = !1; }), 1e4), d(n) || r.error("Could not initialize login; check configuration"), i.setTime("tpAccShow"); }, close: function () { t.closeModalContainer(); }, showBackdrop: function () { t.showBackdrop(); }, hideBackdrop: function () { t.hideBackdrop(); }, centerBackdrop: function (e) { t.centerBackdrop(e); }, registerCallback: function (e, n) { a.registerCallback(e, n); }, listenLogin: function (e) { !function (e) { a.registerCallback(e, e.iframeId); var t = { iframeId: e.iframeId, config: e, iframeParams: e }; n.init({ postMessageUrl: s(), receive: c, iframe: t, iframeParams: {} }); }(e); } }; }();
    pn.container.register("tinypassLogin", { useValue: Ue }), pn.tinypassLogin = pn.container.resolve("tinypassLogin");
    var je = function () { var e = pn.container.resolve("ajax"), n = pn.container.resolve("jqUtils"), t = pn.container.resolve("util"), r = pn.container.resolve("tinypassLogin"), o = pn.container.resolve("eventUtils").createEventManager(["logout"]), i = function () { return t.getUserTokenCookie() || null; }; return { name: "tinypassAccounts", isv: !1, isUserValid: function () { return !!t.getUserTokenCookie(); }, getToken: i, getName: function () { return "tinypass_accounts"; }, onLoginSuccess: function (e) { t.setAccessTokenListCookie({ value: e.token_list, cookie_domain: e.cookie_domain }, e.user_token); }, isConfigured: function () { return !0 === pn.useTinypassAccounts || "string" == typeof pn.useTinypassAccounts && "true" === pn.useTinypassAccounts; }, login: function (e) { return (e = e || {}).userToken = i(), r.show(e); }, logout: function (r) { var i = { aid: pn.aid, url: document.location.href }, a = pn.getEndpointRoot(!0) + "/checkout/user/logout?" + n.param(i); t.setAccessTokenListCookie({ value: null }, void 0, !0), e.request({ url: a, dataType: "jsonp", success: function (e) { t.setAccessTokenListCookie({ value: "", cookie_domain: e.models.cookie_domain }, e.models.user_token, !0), o.fireCallbacks("logout", null, void 0, !0), r && r(e); }, error: function (e) { t.setAccessTokenListCookie(null, void 0, !0), o.fireCallbacks("logout", null, void 0, !0), r && r(e); } }); }, registerCallback: function (e, n) { o.addEvent(e), o.registerCallback(e, n); } }; }();
    pn.container.register("tinypassAccounts", { useValue: je }), pn.tinypassAccounts = pn.container.resolve("tinypassAccounts");
    var De = function () { var e = pn.container.resolve("jqUtils"), n = pn.container.resolve("cookie"), t = pn.container.resolve("util"), r = pn.container.resolve("eventUtils").createEventManager(["logout"]); return { isv: !1, name: "condeUserProvider", getName: function () { return "conde"; }, isUserValid: function () { return !!t.getUserTokenCookie(); }, getToken: function () { var e = t.findCookieByName("amg_user_partner"); return void 0 !== e && e && e.length >= 0 ? e : null; }, onLoginSuccess: function (r) { t.setAccessTokenListCookie({ value: r.token_list, cookie_domain: r.cookie_domain }, r.user_token); var o = { path: "/", expires: 730 }; r.cookie_domain && "localhost" !== r.cookie_domain && e.inArray(r.cookie_domain, t.getPossibleCookieDomains()) >= 0 && (o.domain = r.cookie_domain), n.raw = !0, t.__protected__.setCookie(r.params.cookieName, r.params.cookieValue, o), t.__protected__.setCookie("amg_user_partner", r.params.externalId, o), t.__protected__.setCookie("amg_user_info", r.params.userName, o), t.__protected__.setCookie("amg_user_ext", r.params.siteUserId, o), r.params.updateToken && t.__protected__.setCookie("amg_user_update", r.params.updateToken, o), n.raw = !1; }, logout: function (e) { t.setAccessTokenListCookie({ value: null }, void 0, !0); var n = t.getPossibleCookieDomains(); for (var o in n)
            t.deleteCookie("amg_user", n[o]), t.deleteCookie("amg_user_partner", n[o]), t.deleteCookie("amg_user_info", n[o]), t.deleteCookie("amg_user_ext", n[o]), t.deleteCookie("amg_user_update", n[o]); t.deleteCookie("amg_user"), t.deleteCookie("amg_user_partner"), t.deleteCookie("amg_user_info"), t.deleteCookie("amg_user_ext"), t.deleteCookie("amg_user_update"), r.fireCallbacks("logout", null, void 0, !0), e && e(); }, isConfigured: function () { return !0 === pn.useCondeUserProvider || "string" == typeof pn.useCondeUserProvider && "true" === pn.useCondeUserProvider; }, registerCallback: function (e, n) { r.addEvent(e), r.registerCallback(e, n); } }; }();
    pn.container.register("condeUserProvider", { useValue: De }), pn.condeUserProvider = pn.container.resolve("condeUserProvider");
    var Fe = function () { var e = pn.container.resolve("util"), n = pn.container.resolve("api"), t = pn.container.resolve("eventUtils"), r = pn.container.resolve("jqUtils"), o = !1; var i = t.createEventManager(["userChanged", "onHide", "logout"]), a = { apiKey: null, screenSet: "Default-RegistrationLogin", startScreen: null, enabledProviders: null, lang: null }; function s() { var n = e.getUserTokenCookie(); if (n && e.findCookieByName("glt_" + a.apiKey) === e.findCookieByName("__utg_" + a.apiKey))
        return n; return null; } var c = []; function l(t, s) { if (!o)
        throw "Gigya is not configured"; d(); (e.findCookieByName("glt_" + a.apiKey) !== e.findCookieByName("__utg_" + a.apiKey) || t) && (c.push(s), 1 === c.length && window.gigya.accounts.getAccountInfo({ callback: function (t) { if (0 === t.errorCode) {
            var o = { uid: t.UID, signature: t.UIDSignature, signature_timestamp: t.signatureTimestamp, url: e.prepareUrlParameter(window.location.href) };
            e.startCall("refreshUserToken"), n.callApi("/anon/gigya/verifyAccountInfo", o, (function (n) { if (n && n.result) {
                e.setAccessTokenListCookie(n.result.access_token, n.result.user_token);
                var t = { path: "/", expires: 730 };
                if (n.result.access_token) {
                    var o = n.result.access_token.cookie_domain;
                    o && "localhost" !== o && r.inArray(o, e.getPossibleCookieDomains()) >= 0 && (t.domain = o);
                }
                var s = e.findCookieByName("glt_" + a.apiKey);
                e.__protected__.setCookie("__utg_" + a.apiKey, s, t);
                for (var l = 0; l < c.length; l++) {
                    var u = c[l];
                    u && u(n.result);
                }
                n.result.user && (n.result.user = { uid: n.result.user.uid, email: n.result.user.email, firstName: n.result.user.first_name, lastName: n.result.user.last_name, valid: n.result.user.valid }), i.fireCallbacks("userChanged", n.result, void 0, !0);
            }
            else
                e.log("Can't verify gigya user: may be the configuration of gigya user provider is invalid"), e.setAccessTokenListCookie(); c = [], e.doneCall("refreshUserToken"); }));
        }
        else
            e.setAccessTokenListCookie(), c = []; } })); } var u = !1; function d() { if (!window.gigya || !window.gigya.__initialized)
        throw "Gigya is not initialized"; } return { isv: !1, name: "gigya", init: function (n) { if (!o) {
            for (var t in n)
                void 0 !== n[t] && (a[t] = n[t]);
            if (!a.screenSet)
                throw "Gigya is not configured: screenSet parameter required";
            if (!a.apiKey)
                throw "Gigya is not configured: apiKey parameter required";
            d(), window.gigya.accounts.addEventHandlers({ onLogin: function () { u = !0, l(); }, onLogout: function () { e.setAccessTokenListCookie({ value: null }, void 0, !0), i.fireCallbacks("logout", null, void 0, !0); } }), o = !0, l();
        } }, isUserValid: function () { var e = s(); return !!(void 0 !== e && e && e.length >= 0); }, getToken: s, getName: function () { return "gigya"; }, onLoginSuccess: function (n) { e.setAccessTokenListCookie({ value: n.token_list, cookie_domain: n.cookie_domain }, n.user_token); }, login: function (e) { if (!o)
            throw "Gigya is not configured"; d(), e && window.gigya.accounts.addEventHandlers({ onLogin: function () { l(!0, e); } }); var n = { screenSet: a.screenSet, onHide: function () { i.fireCallbacks("onHide", { afterLogin: u }, void 0, !0); } }, t = ["apiKey", "screenSet"]; for (var r in a) {
            r in t || (n[r] = a[r]);
        } u = !1, window.gigya.accounts.showScreenSet(n); }, logout: function (n) { if (!o)
            throw "Gigya is not configured"; d(), window.gigya.accounts.logout({ callback: function () { i.fireCallbacks("logout", null, void 0, !0), n && n(), e.setAccessTokenListCookie({ value: null }, void 0, !0); } }), e.setAccessTokenListCookie({ value: null }, void 0, !0); }, isConfigured: function () { return !0 === pn.useGigyaUserProvider || "string" == typeof pn.useGigyaUserProvider && "true" === pn.useGigyaUserProvider; }, registerCallback: function (e, n) { i.addEvent(e), i.registerCallback(e, (function (e) { return n(e); })); }, loginByPasswordless: function (n) { if (!n)
            throw "Session info is empty"; var t = n.accessTokenName, r = n.accessToken; e.__protected__.setCookie(t, r); var o = "glt_" + a.apiKey; e.__protected__.setCookie(o, r), l(!0); } }; }();
    pn.container.register("gigya", { useValue: Fe }), pn.gigya = pn.container.resolve("gigya");
    var Be = function () { var e = function (e) { function n() { return null !== e && e.apply(this, arguments) || this; } return function (e, n) { if ("function" != typeof n && null !== n)
        throw new TypeError("Class extends value " + String(n) + " is not a constructor or null"); function t() { this.constructor = e; } we(e, n), e.prototype = null === n ? Object.create(n) : (t.prototype = n.prototype, new t); }(n, e), n.prototype.construct = function (e) { this.message = e, this.name = "InvalidCharacterError"; }, n; }(Error); function n(n) { var t = String(n).replace(/=+$/, ""); if (t.length % 4 == 1)
        throw new e("'atob' failed: The string to be decoded is not correctly encoded."); for (var r, o, i = 0, a = 0, s = ""; o = t.charAt(a++); ~o && (r = i % 4 ? 64 * r + o : o, i++ % 4) ? s += String.fromCharCode(255 & r >> (-2 * i & 6)) : 0)
        o = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(o); return s; } try {
        var t = window.atob && window.atob.bind(window) || n;
    }
    catch (e) {
        t = n;
    } var r = function (e) { var n = e.replace(/-/g, "+").replace(/_/g, "/"); switch (n.length % 4) {
        case 0: break;
        case 2:
            n += "==";
            break;
        case 3:
            n += "=";
            break;
        default: throw "Illegal base64url string!";
    } try {
        return function (e) { return decodeURIComponent(t(e).replace(/(.)/g, (function (e, n) { var t = n.charCodeAt(0).toString(16).toUpperCase(); return t.length < 2 && (t = "0" + t), "%" + t; }))); }(n);
    }
    catch (e) {
        return t(n);
    } }; return function (e, n) { if ("string" != typeof e)
        throw new Error("Invalid token specified"); var t = !0 === (n = n || {}).header ? 0 : 1; return JSON.parse(r(e.split(".")[t])); }; }();
    pn.jwtDecode = Be, pn.container.register("jwtDecode", { useValue: Be });
    var Ve = function () { var e, n = pn.container.resolve("util"), t = pn.container.resolve("api"), r = pn.container.resolve("postmessage"), o = "pianoTracker", i = "gaAccount", a = "metricsGAAccount", s = "trackOnlyAids", c = "disabled", l = 86400, u = { gaAccount: void 0, trackerName: o, trackOnlyAids: [], metricsGAAccount: void 0, isGAEnabled: !1, isGAAppended: !1, isMetricsEnabled: !1, isTrackerAppended: !1, isMetricsTrackerAppended: !1 }, d = [], p = !1, f = !0, m = !1, g = !1, v = []; function h() { m || (f ? setTimeout((function () { f = !1, w(); }), 3e3) : w()); } function w() { m = !0, S(), u.gaAccount ? E().catch((function () { })) : new Promise((function (e, n) { t.callApi("/anon/assets/gaAccount", { aid: tp.aid }, (function (t) { 0 === t.code ? (x(t.data), e(null)) : n(); })); })).then((function () { return E(); })).catch((function () { })); } var y = function (e, n) { d.push({ action: e, params: n }); }, b = function () { if (window.ga && u.isTrackerAppended)
        for (; d.length;) {
            var e = d.pop();
            C(e.action, e.params);
        } }, k = function (e, n) { v.push({ action: e, params: n }); }, _ = function () { if (window.ga && u.isMetricsTrackerAppended)
        for (; v.length;) {
            var e = v.pop();
            I(e.action, e.params);
        } }, C = function (e, n) { window.ga && u.isTrackerAppended ? window.ga(u.trackerName + "." + e, n) : y(e, n); }, I = function (e, n) { u.isMetricsEnabled && (window.ga && u.isMetricsTrackerAppended ? window.ga("performanceTracker." + e, n) : k(e, n)); }, S = function () { if (!p) {
        if (tp.gaClientId && (e = tp.gaClientId), n.__protected__.hasLocalStorage()) {
            var t = n.__protected__.getLocalStorageItem(i), r = n.__protected__.getLocalStorageItem(a), o = n.__protected__.getLocalStorageItem(s);
            u.isGAEnabled = !!t && t !== c, u.isMetricsEnabled = !!r && r !== c, u.gaAccount = t, u.metricsGAAccount = r, u.trackOnlyAids = o || [];
        }
        p = !0;
    } }; var x = function (e) { u.isGAEnabled = !!e, u.gaAccount = e || c, n.__protected__.setLocalStorageItem(i, u.gaAccount, l); }, P = function (e) { u.isMetricsEnabled = JSON.parse(e.is_enabled), u.metricsGAAccount = u.isMetricsEnabled ? e.ga_account : c, u.trackOnlyAids = u.isMetricsEnabled ? JSON.parse(e.track_only_aids) : [], n.__protected__.setLocalStorageItem(s, u.trackOnlyAids, l), n.__protected__.setLocalStorageItem(a, u.metricsGAAccount, l); }; function E() { return new Promise((function (n, t) { u.isGAEnabled ? A().then((function () { if (u.isGAAppended)
        if (u.isTrackerAppended)
            n(null);
        else
            try {
                var r = document.createElement("script");
                r.innerHTML = function () { var n = new RegExp("^UA-[0-9a-zA-Z]*-[0-9a-zA-Z]*$").test(u.gaAccount), t = new RegExp("([{]?[0-9a-fA-F]{8}-([0-9a-fA-F]{4}-){3}[0-9a-fA-F]{12}[}]?)|([0-9]*\\.[0-9]*)").test(e || ""); if (!n)
                    return ""; var r = "ga(function() {\n        ga('create', '" + u.gaAccount + "', 'auto', '" + "pianoTracker'"; r += e && t ? ", { clientId: '" + e + "' });" : ");\n        tp.gaService.setClientId(ga.getByName('pianoTracker').get('clientId'));"; return r += "tp.gaService.trackerAppended(); });"; }(), document.head.appendChild(r), u.isTrackerAppended = !0, n(null);
            }
            catch (e) {
                t();
            }
    else
        t(); })).catch((function (e) { })) : t(); })); } function T() { return new Promise((function (e, n) { u.isMetricsEnabled ? A().then((function () { if (u.isGAAppended)
        if (u.isMetricsTrackerAppended)
            e(null);
        else
            try {
                var t = !u.trackOnlyAids.length || u.trackOnlyAids.contains(tp.aid), r = document.createElement("script");
                if (!new RegExp("^UA-[0-9a-zA-Z]*-[0-9a-zA-Z]*$").test(u.metricsGAAccount))
                    return void n();
                r.innerHTML = "\nga(function() {\n  if (" + t + ") {\n    ga('create', '" + u.metricsGAAccount + "', 'auto', '" + "performanceTracker', { storage: 'none' });\n    tp.gaService.metricsTrackerAppended();\n  }\n});\n", document.head.appendChild(r), u.isMetricsTrackerAppended = !0, e(null);
            }
            catch (e) {
                n();
            }
    else
        n(); })) : e("isMetricsEnabled !== true"); })); } function A() { return new Promise((function (e, n) { if (u.isGAAppended)
        e(null);
    else
        try {
            var t = document.createElement("script");
            t.innerHTML = "\n            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){\n            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),\n            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)\n            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');\n          ", document.head.appendChild(t), u.isGAAppended = !0, e(null);
        }
        catch (e) {
            n();
        } })); } return { name: "gaService", emitEvent: function (e) { if (e.hitType = "event", !u.isTrackerAppended)
            return y("send", e), void h(); u.isGAEnabled && (window.ga && u.isTrackerAppended ? (d.length && b(), C("send", e)) : y("send", e)); }, emitMetricsEvent: function (e) { if (e.hitType = "timing", !u.isMetricsTrackerAppended)
            return k("send", e), void function () { if (g)
                return; if (g = !0, S(), !u.metricsGAAccount)
                return void new Promise((function (e, n) { t.callApi("/anon/assets/performanceMetrics", null, (function (t) { 0 === t.code ? (P(t.performance_metrics_dto), e(null)) : n(); })); })).then((function () { return T(); })).catch((function (e) { n.error("PN catch: something vent wrong with GA injection: " + e); })); T().catch((function (e) { n.error("PN catch: something vent wrong with GA injection: " + e); })); }(); u.isMetricsEnabled && (window.ga && u.isMetricsTrackerAppended ? (v.length && _(), I("send", e)) : k("send", e)); }, getClientId: function () { return e; }, getGAAccount: function () { return u.gaAccount; }, metricsTrackerAppended: function () { u.isMetricsTrackerAppended = !0, g = !1, _(); }, recreateWithClientId: function (n) { e = n, h(); }, setClientId: function (n) { e = n; }, setTrackerName: function (e) { u.trackerName = e; }, trackerAppended: function () { u.isTrackerAppended = !0, r.broadcast("gaAppended", { clientId: e, gaAccount: u.gaAccount }), m = !1, b(); } }; }();
    pn.container.register("gaService", { useValue: Ve }), pn.gaService = pn.container.resolve("gaService");
    var qe = function (e) { void 0 === e && (e = pn.container); var n, t, r, o, i, a = e.resolve("cookie"), s = e.resolve("jqUtils"), c = e.resolve("ajax"), l = e.resolve("jwtDecode"), u = e.resolve("util"), d = e.resolve("containerUtils"), p = e.resolve("postmessage"), f = e.resolve("log"), m = e.resolve("observer"), g = e.resolve("gaService"), v = e.resolve("api"), h = e.resolve("logging"), w = e.resolve("localStorage"), y = "piano_social_token", b = u.getAidSpecifiedName("__utp"), k = "__pil", _ = "__pid", C = "__idr", I = "__eea", S = "PIANOID", x = "show_form", P = "registration", E = "checkout", T = 300, A = "pnid-tc-string", M = ["he_IL", "ar_EG"], O = {}, R = [], L = { loggedIn: [], loggedOut: [], loginSuccess: [], registrationSuccess: [], profileUpdate: [], langChange: [], langChangeFromIframe: {}, fire_loginSuccess: [], loginDisplayed: [], registerDisplayed: [], loginFailed: [], registrationFailed: [], onShow: [], layoutReady: [] }, N = {}, U = {}, j = [], D = !1, F = ["G18rIJWQ2G", "45L2BaS6pu"]; s.on(window, "resize", (function () { return B(); })); var B = function (e) { R.filter((function (e) { return "inline" === e.config.displayMode; })).filter((function (n) { return !e || e.some((function (e) { return n.container === e; })); })).forEach((function (e) { var n = s.getWidth(e.container); d.resizeIframe(e, { width: n }), p.send("resize", { width: n }, e.iframeId); })); }, V = function (e) { if (r && !e)
        return r; var n; O = Object.assign({}, e), r = new Promise((function (e) { n = e; })), Qe() || pn.setUsePianoIdUserProvider(!0), ae(O); var t = u.getQueryParamByName("reset_token"); void 0 === O.resetPasswordToken && t && (O.resetPasswordToken = t); var o = u.getQueryParamByName("passwordless_token"); void 0 === O.passwordlessToken && o && (O.passwordlessToken = o); var i = u.getQueryParamByName("verification_code"); void 0 === O.verification_code && i && (O.verification_code = i); var a = u.getQueryParamByName(y); return a && (u.removeQueryParamByName(y), Oe() || (pn.inappBrowserReturn = !0, function (e, n) { var t = l(e); t.rememberMe = !!n, Se({ user: t, token: e }); }(a, !0))), setTimeout((function () { return n(); }), 50), r; }, q = function (e, n) { if (t && !e)
        return t; var r; t = new Promise((function (e) { r = e; })); var o = function () { u.doneCall("refreshUserToken"), t = null, r(); }; return e && e.preview ? (setTimeout((function () { return r(); }), 10), t) : (u.startCall("refreshUserToken"), V(e).then((function () { return O.passwordlessToken ? J() : n ? Promise.resolve() : Re(); })).then(o, o), t); }, z = function (e) { var t = !Oe(); q().then((function () { var r = Object.assign({}, O, e, { isRegistration: !0 }), o = Oe(); o ? (ne(r, { emitGlobalLoginSuccessEvent: t && o }), D && !Xe() && (ae(e), se(r), _e(r))) : n ? (ae(e), u.log("Modal login window already shown")) : (ae(e), se(r), _e(r)); h.setTime("idShow"); })); }, H = function () { var e = "email_is_not_confirmed", n = u.getQueryParamByName(e); if (n) {
        u.removeQueryParamByName(e);
        var t = "registration" === n ? "email_is_not_confirmed" : "email_confirmation_required", r = Te();
        W({ screen: t, email: r && r.email });
    } }, W = function (e) { if (n)
        u.log("Modal window already shown");
    else {
        e || (e = {});
        var t = Object.assign({}, e, O);
        e.customEvents && "object" == typeof e.customEvents && (N = e.customEvents), se(t), ae(e), _e(t);
    } }, J = function () { return new Promise((function (e, n) { c.request({ url: he() + "api/v1/identity/passwordless/authorization/code", dataType: "jsonp", data: { aid: O.aid || pn.aid, passwordless_token: O.passwordlessToken }, success: function (t) { t.error ? (Q(t), n()) : (G(t), e(null)); }, xhrFields: { withCredentials: !0 }, crossDomain: !0 }); })); }, G = function (e) { !e.error && e.access_token && (X(e), Me({ source: S, token: e.access_token, user: l(e.access_token), extendExpiredAccessEnabled: e.extend_expired_access_enabled }, !1, !0), delete O.passwordlessToken, u.removeQueryParamByName("passwordless_token")), u.doneCall("refreshUserToken"); }, Q = function (e) { W({ screen: "passwordless_confirmation", jsonpError: e }), delete O.passwordlessToken, u.removeQueryParamByName("passwordless_token"); }, X = function (e) { var n = { aid: O.aid || pn.aid, login_token_id: e.login_token_id, user_token: e.access_token }, t = { passwordlessToken: e.passwordless_token, redirectUri: e.direction_url }; $(n, t); }, $ = function (e, n) { d.showWaitPanel(), v.callApi("/anon/passwordless/complete", e, (function (e) { if (e.result && e.result.polling_enabled)
        return Y(e).then((function (e) { Z(e, n); })); Z(e, n); })); }, Y = function (e) { return new Promise((function (n) { var t = { aid: pn.aid, oid: e.result.oid, process_id: e.result.process_id, user_token: pn.user.getProvider().getToken() }; K(t, 0, e.result.polling_timeouts, n); })); }, K = function (e, n, t, r) { v.callApi("/anon/passwordless/check", e, (function (o) { n++, o && o.result && "waiting" !== o.result.poll_status ? r(o) : !o.result && o.message ? (u.error("Passwordless purchase failed", o.message), r()) : n <= t.length ? setTimeout((function () { K(e, n, t, r); }), t[n - 1]) : r(); })); }, Z = function (e, n) { try {
        var t = e.result.resource || {}, r = JSON.parse(e.result.show_offer_params), o = ee(n);
        if (!Object.keys(t).length && !Object.keys(r).length)
            return W(o);
        o = t.name ? ee(n, { customParams: { resourceName: t.name } }) : ee(n, { customEvents: { checkoutContinue: function () { Ce(), d.closeModalContainer(), pn.offer.show(r); } } }), W(o);
    }
    catch (e) {
        W(ee(n));
    }
    finally {
        d.hideWaitPanel();
    } }, ee = function (e, n) { var t = { screen: "passwordless_confirmation" }; return e && (t.passwordlessToken = e.passwordlessToken, t.redirectUri = e.redirectUri), n ? Object.assign(t, n) : Object.assign(t, { passwordlessSuccess: !0 }); }, ne = function (e, n) { n = n || {}; var t = Te(); if (t) {
        var r = { token: Pe(), user: t, source: n.source, stage: n.stage }, i = { event: "loginSuccess", source: n.source, params: r.user, user_token: r.token, registration: o, stage: n.stage };
        e ? (e.loggedIn && e.loggedIn(r), n.emitGlobalLoginSuccessEvent && oe("loginSuccess", i)) : (re("loggedIn", r), re("loginSuccess", r), n.source === S && (re("fire_loginSuccess", i), oe("loginSuccess", i)));
    } }, te = function (e, n) { ie({ login: "loginDisplayed", register: "registerDisplayed" }[e], {}, n); }, re = function (e, n) { L[e] && L[e].forEach((function (e) { e(n); })); }, oe = function (e, n) { U[e] && U[e].forEach((function (e) { e(n); })); }, ie = function (e, n, t) { !t && re(e, n), oe(e, n); }, ae = function (e) { e && Object.keys(L).forEach((function (n) { e[n] && L[n].push(e[n]); })); }, se = function (e) { e.aid || (e.aid = pn.aid), e.displayMode || (e.displayMode = "modal"), "popup" === e.displayMode ? (e.width = parseInt(e.width) || le(), e.height = parseInt(e.height) || 460) : "modal" === e.displayMode && (e.width = parseInt(e.width) || le()), e.accessToken = Pe(); }, ce = function (e) { T = e; }, le = function () { var e = window.innerWidth || document.documentElement.clientWidth || window.screen.width; return Math.min(e, 400); }, ue = function (e, n, t) { o = !1, Ee(), w.remove(A), u.setAccessTokenListCookie({ value: null }, void 0, !0), Ue().then((function () { t || function (e) { var n = { source: e }; re("loggedOut", n), oe("logout", n); }(n), e && e(); })), Ye(); }; function de(e) { return function (n) { var t, r, o = e.config.trackingId, i = e.config.formName; switch (n.event) {
        case "loaded":
            "modal" === e.config.displayMode && d.checkBackdropAndContainer(e, !0), e.config.loadedCallback && e.config.loadedCallback(e);
            break;
        case "stateReady":
            e.config.readyCallback && e.config.readyCallback(e);
            break;
        case "resize":
            d.resizeIframe(e, n.params);
            break;
        case "restoreSize":
            "inline" === e.config.displayMode && d.resizeIframe(e, { width: s.getWidth(e.container) });
            break;
        case "loginSuccess":
            ve(n, (function () { e.config.callback && e.config.callback(), pn.user.refreshAccessToken(!0), p.broadcast("pianoIdLoginSuccess", n.params); }));
            break;
        case "loginFailed":
            ie("loginFailed", n.params);
            break;
        case "registrationSuccess":
            ve(n, (function () { ie("registrationSuccess", n.params), p.broadcast("pianoIdLoginSuccess", n.params); }));
            break;
        case "registrationFailed":
            ie("registrationFailed", n.params);
            break;
        case "lang":
            Be(n.params.lang, !0), Ge(n.params.lang, e);
            break;
        case "customEvent":
            t = e.config, r = n.params, t && t.customEvent && t.customEvent(r), oe("customEvent", r);
            break;
        case "closed":
            De(e, !0), e.config.closedCallback && e.config.closedCallback(e);
            break;
        case "cfFormSubmission":
            f.__protected__.logCustomFormSubmission(o, i, x);
            break;
        case "formSend":
        case "formSkip":
            De(e);
            break;
        case "cfAppImpression":
            f.__protected__.logCustomFormImpression(o, i, P);
            break;
        case "cfAppSubmission":
            f.__protected__.logCustomFormSubmission(o, i, P);
            break;
        case "cfFormImpression":
            f.__protected__.logCustomFormImpression(o, i, x);
            break;
        case "changeScreen":
            te(n.params.screen);
            break;
        case "screenReady":
            ie("onShow");
            break;
        case "layoutReady":
            ie("layoutReady", n.params);
            break;
        case "confirmationEmailSent":
            "inline" === e.config.displayMode || n.params.isDOI || n.params.isPasswordlessDigitalCode || De(e);
            break;
        case "verificationCodeStartCheckout":
            var a = {};
            try {
                a = JSON.parse(n.params.startCheckoutParams);
            }
            catch (e) {
                u.log("error parse start checkout params"), a = {};
            }
            De(e, !0), Re(!0, !0), u.waitCall("refreshUserToken", (function () { pn.offer.show(a); }));
            break;
        case "removeParamFromGlobalConfig":
            fe(n);
            break;
        case "verifyCode":
            me(n, e);
            break;
        case "openPasswordlessLoginWithCreatingUser":
            pe();
            break;
        case "fireCustomEvent":
            !function (e) { N && "function" == typeof N[e] && N[e](); }(n.params.name);
            break;
        case "passwordRestored":
            u.removeQueryParamByName("reset_token"), O.resetPasswordToken = void 0;
            break;
        case "emitGAEvent":
            g.emitEvent(n.params);
            break;
        case "redirect":
            document.location.href = n.params.url;
            break;
        case "designVersion":
            d.addClassToContainer(e, "piano-id-modal-ver-" + n.params.version);
            break;
        case "profileUpdated":
            re("profileUpdate", n.params);
            break;
        case "logout":
            ue();
            break;
        default: u.debug("Received invalid event type: " + n.event);
    } }; } var pe = function () { z({ createPasswordlessUser: !0 }); }, fe = function (e) { var n = e.params.name, t = u.fromUnderscoreToCamelCase(n); delete O[t], e.params.removeFromUrl && u.removeQueryParamByName(n); }, me = function (e, n) { var t = e.params.verificationCode, r = e.params.locale, o = O.aid || pn.aid, i = Ae(), a = document.location.href; c.request({ url: he() + "api/v1/identity/verification/code", dataType: "jsonp", data: { client_id: o, access_token: i, site: a, verification_code: t, lang: r }, success: function (e) { e.error || ge(e, n); }, xhrFields: { withCredentials: !0 }, crossDomain: !0 }); }, ge = function (e, n) { !e.error && e.access_token && Se({ token: e.access_token, user: l(e.access_token), cookie_domain: e.site_cookie_domain }), p.send("verificationCodeComplete", e, n.iframeId); }, ve = function (e, n) { e && e.params && !e.params.areCookiesSet ? (e.params.source = S, o = !!e.params.registration, Me(e.params).then((function (e) { n(e); }))) : "function" == typeof n && n(), $e(); }, he = function () { return function () { var e = pn.sandbox || pn.isNonProdEndpoint(), n = O.iframeUrl || pn.pianoIdUrl || !e && "https://id.tinypass.com" || "/"; return "/" === n && (n = pn.getEndpointRoot(!0)), n.replace(/\/$/, ""); }() + "/id/"; }, we = function () { var e = O.aid || pn.aid; return F.indexOf(e) >= 0; }, be = function (e, n, t, r) { e.match("proxy.html") || (e += we() ? "index3.html" : ""); var o = { client_id: n.aid, sender: t.iframeId, origin: r || window.location.origin || window.location.href, site: window.location.href, display_mode: n.displayMode, pageViewId: pn.main.fetchPageViewId(), tbc: u.getTbcCookie() }, i = Ve(); if (i && (o.lang = i), g.getClientId() && (o.ga_client_id = g.getClientId()), g.getGAAccount() && (o.ga = g.getGAAccount()), n.disableSignUp && (o.disable_sign_up = !0), n.screen && (o.screen = n.screen), n.resetPasswordToken && (o.reset = n.resetPasswordToken), n.verification_code && (o.verification_code = n.verification_code), n.stage && (o.stage = n.stage), n.resetPasswordLandingUrl && (o.reset_uri = n.resetPasswordLandingUrl), n.width && "modal" === n.displayMode && (o.width = n.width), n.formName && (o.form_name = n.formName), ke(n, e) && (e += "form"), "profile" === n.template && (e += "profile"), n.hideIfComplete && (o.hide_if_complete = n.hideIfComplete), n.preview && (o.preview = n.preview), n.templateVersion && (o.templateVersion = n.templateVersion), n.template && (o.template = n.template), n.accessToken && (o.access_token = n.accessToken), n.email && (o.email = n.email), n.singleStep && (o.single_step = !0), n.createPasswordlessUser && (o.create_passwordless_user = !0), n.customParams && (o.custom_params = JSON.stringify(n.customParams)), n.customEvents) {
        var a = [];
        Object.keys(n.customEvents).forEach((function (e) { a.push(e); })), a.length && (o.custom_events = JSON.stringify(a));
    } return n.jsonpError && (o.jsonp_error = JSON.stringify(n.jsonpError)), n.passwordlessSuccess && (o.passwordless_success = !0), n.passwordlessToken && (o.passwordless_token = n.passwordlessToken), n.redirectUri && (o.redirect_uri = n.redirectUri), t.iframeUrl && (o.url = t.iframeUrl), n.returnBack && (o.return_back = n.returnBack), t.pos && (o.width = t.pos.width, o.height = t.pos.height, o.top = t.pos.top, o.left = t.pos.left), n.templateId && (o.template_id = n.templateId), n.variantId && (o.variant_id = n.variantId), [e, s.param(o)].join("?"); }, ke = function (e, n) { var t = we(), r = !e.isRegistration, o = !/\.html$/.test(n) || t; return e.formName && o && r; }, _e = function (e) { var t = s.queryEl(e.containerSelector), r = "piano-id-" + (e.isRegistration ? "" : "form-") + u.randomString(); e.singleContainer = t; var o, i, a, c = { iframeId: r, containerSelector: e.containerSelector, width: e.width, height: e.height }, l = be(he(), e, c), f = he(), g = !0; if (e.iframeParams = c, "inline" === e.displayMode) {
        var v = d.initInlineContainer(e);
        if (!(o = v.container))
            return;
        i = d.generateIframe(e, c, l), g = !!v.containerReady, e.observeContainer && (a = m.create(o, B));
    }
    else if ("modal" === e.displayMode)
        o = d.getModalContainer(e, (function () { return De(n); })), i = d.generateIframe(e, c, l);
    else if ("popup" === e.displayMode)
        if (u.isIE()) {
            o = d.generateIframeWrapper(), l = be(he(), e, c, he() + "proxy.html"), c.iframeUrl = l, c.pos = d.getPopupPosition(c);
            var h = be(he() + "proxy.html", e, c);
            e.displayMode = "inlinePopup", i = d.generateIframe({}, c, h);
        }
        else {
            o = d.generatePopup(c, l);
            try {
                try {
                    i = o.document;
                }
                catch (e) {
                    i = o;
                }
            }
            catch (e) {
                i = window.document;
            }
        } var w = { iframeId: c.iframeId, config: e, element: i, container: o, iframeParams: c, containerReady: g }, y = { center: u.centerScreen(), originUrl: document.location.href }; if (p.init({ postMessageUrl: f, receive: de(w), iframe: w, iframeParams: c }, y), "inline" === e.displayMode) {
        var b = document.createElement("div");
        s.addClass("piano-id-container", b), s.append(b, i), s.append(o, b);
    }
    else
        "modal" === e.displayMode ? s.append(o, i) : "inlinePopup" === e.displayMode && (s.append(o, i), s.append(document.body, o)); if (u.debug("creating iframe: ", e), R.push(w), "modal" === e.displayMode) {
        (n = w).observer = a, (u.isIphone() || u.isSafariOrIOsUiWebView() || u.isAndroid()) && d.__private__.mobileModalFix.modalOpened();
        var k = Ve();
        Ge(k, w);
    } return w; }, Ce = function (e) { if (n) {
        var t = d.__private__.mobileModalFix;
        d.closeModal(n), s.remove(n.element), n.observer && n.observer.disconnect(), t.isIphoneCaretFixed && t.modalClosed(), n = void 0;
    } }, Ie = function (e) { var n = { path: "/" }, t = u.__protected__.getCookie(_), r = u.extractCookieDomain(e || t); return r && (n.domain = r), (pn.cookieDomain || pn.cookiePath) && (n.domain = pn.cookieDomain ? pn.cookieDomain : n.domain, n.path = pn.cookiePath ? pn.cookiePath : n.path), n; }, Se = function (e) { if (e && e.user && e.token) {
        Ee(null, !0, !0);
        var n = Ie(e.cookie_domain);
        e.extendExpiredAccessEnabled && xe(e.extendExpiredAccessEnabled, e.cookie_domain), (e.user.rememberMe || He()) && (n.expires = new Date(1e3 * e.user.exp), qe(n));
        var t = u.getPossibleCookieDomains();
        for (var r in t)
            u.deleteCookie(b, t[r]);
        u.__protected__.setCookie(b, e.token, n), e.cookie_domain && (n.expires = 30, u.__protected__.setCookie(_, e.cookie_domain, n));
    } }, xe = function (e, n) { Je("setExtendExpiredAccess", e, "broadcast"); var t = Ie(n); t.expires = 30, u.__protected__.setCookie(I, e ? "true" : "false", t); }, Pe = function () { var e = u.findCookieByName(b); return e || null; }, Ee = function (e, n, t) { var r = Ie(), o = u.getPossibleCookieDomains(r.domain); e && u.__protected__.logRemoveTokens(e), o.forEach((function (e) { var o = ye(ye({}, r), { domain: e }); a.remove(b, o), t || a.remove(I, o), n || ze(o); })); }, Te = function () { var e = null, n = Pe(); if (n)
        try {
            if (e = l(n)) {
                e.firstName = e.given_name, e.lastName = e.family_name, e.valid = !0, e.uid = e.sub, e.confirmed = !e.email_confirmation_required;
                var t = new Date;
                new Date(1e3 * e.exp) < t && (u.log("Removing expired tokens"), Ee(n), e = null);
            }
        }
        catch (e) { } return e; }, Ae = function () { return pn.externalJWT && Qe() ? pn.externalJWT : Pe(); }, Me = function (e, n, t) { Se(e); var r = je(e).then((function () { !n && ne(null, { stage: e.stage, source: e.source }); })); if (!(t = t || e.withoutCloseModal)) {
        var o = e && e.user && e.user.email_confirmation_required, i = O.verification_code;
        o || i ? d.hideCloseButton() : Fe();
    } return r; }, Oe = function () { return Qe() ? !!pn.externalJWT : !!Te(); }, Re = function (e, n) { return new Promise((function (t, r) { u.startCall("refreshUserToken"); var o = function (e) { var n = void 0 === e ? {} : e, o = n.isSuccessful, i = n.gmSSOEnabled; o ? t(null) : r(), u.doneCall("refreshUserToken"), o && (D = i) && !Xe() && z({ screen: "sso_confirm" }); }, i = function (t) { !t.error && t.access_token ? Me({ token: t.access_token, user: l(t.access_token), cookie_domain: t.site_cookie_domain, extendExpiredAccessEnabled: t.extend_expired_access_enabled }, e, n).then((function () { return o({ isSuccessful: !0, gmSSOEnabled: t.authorized_by_sso }); })) : (Ee(Ae()), o({ isSuccessful: !1 })); }, a = Ae() || void 0, s = { client_id: O.aid || pn.aid, site: document.location.origin || document.location.href }, d = Le(); d && (s.tcf = d), a ? c.request({ url: he() + "api/v1/identity/token/validation", data: s, headers: { Authorization: a }, success: function (e) { i(e), e.access_token && Ne(d); }, error: o }) : c.request({ url: he() + "api/v1/identity/token/verify", data: s, success: function (e) { i(e), e.access_token && Ne(d); }, error: o, dataType: "jsonp", xhrFields: { withCredentials: !0 }, crossDomain: !0 }), setTimeout(o, 10 * T); })); }, Le = function () { var e, n = window; return function (e) { if (!e)
        return !1; var n = e; if (!n || !n.tcString || !n.date)
        return !1; var t = new Date, r = new Date(n.date), o = Math.abs(r.getTime() - t.getTime()); return Math.ceil(o / 864e5) <= 1; }(w.get(A)) ? null : (e = null, n.__tcfapi && n.__tcfapi("getTCData", 2, (function (n, t) { t && n.tcString && (e = n.tcString); }), [412]), e); }, Ne = function (e) { if (e) {
        var n = { date: (new Date).toString(), tcString: e };
        w.set(A, JSON.stringify(n));
    } }, Ue = function () { return new Promise((function (e) { c.request({ url: he() + "api/v1/identity/logout", data: { client_id: O.aid || pn.aid }, dataType: "jsonp", complete: e, xhrFields: { withCredentials: !0 }, crossDomain: !0 }), setTimeout(e, T); })); }, je = function (e) { return new Promise((function (n) { var t = !(e && e.user && e.user.rememberMe || He()); c.request({ url: he() + "api/v1/identity/vxauth/cookie", data: { client_id: O.aid || pn.aid, session_cookie: t }, headers: { Authorization: e.token || void 0 }, complete: n }), setTimeout(n, T); })); }, De = function (e, n) { e && (n ? e.closed || (e.closed = !0, "inline" === e.config.displayMode ? s.empty(e.container) : "popup" === e.config.displayMode ? e.container.close() : "modal" === e.config.displayMode && (Ce(), s.remove(e.container.parentElement)), D && Ae() && $e()) : (p.send("close", {}, e.iframeId), R = R.filter((function (n) { return n.iframeId !== e.iframeId; })), setTimeout((function () { De(e, !0); }), 600))); }, Fe = function () { R.forEach((function (e) { De(e); })), R = []; }, Be = function (e, n) { var t = Ie(); t.expires = 30, u.__protected__.setCookie(k, e, t), n || R.forEach((function (n) { p.send("lang", { lang: e }, n.iframeId); })), Object.keys(L.langChangeFromIframe).forEach((function (n) { var t = L.langChangeFromIframe[n]; p.__protected__.isIframeManaged(n) && t ? t(e) : delete L.langChangeFromIframe[n]; })), ie("langChange", e); }, Ve = function () { return pn.locale || u.__protected__.getCookie(k) || ""; }, qe = function (e) { u.__protected__.setCookie(C, 1, e); }, ze = function (e) { e && a.remove(C, e); }, He = function () { return !!u.__protected__.getCookie(C); }, We = function (e) { return new Promise((function (n) { var t = Object.assign({}, O, e); c.request({ url: he() + "api/v1/identity/userinfo", data: { client_id: O.aid || pn.aid, form_name: t.formName }, headers: { Authorization: Ae() || void 0 }, success: n, complete: function () { return n(null); } }), setTimeout(n, 10 * T); })); }, Je = function (e, n, t) { j.push({ type: t, name: e, data: n }); }, Ge = function (e, n) { M.includes(e) ? d.turnOnRTL(n) : d.turnOffRTL(n); }, Qe = function () { return !0 === pn.usePianoIdLiteUserProvider || "string" == typeof pn.usePianoIdLiteUserProvider && "true" === pn.usePianoIdLiteUserProvider; }, Xe = function () { return !!w.get("piano-id-initial-gm-sso-shown-" + (O.aid || pn.aid)); }, $e = function () { w.set("piano-id-initial-gm-sso-shown-" + (O.aid || pn.aid), "1"); }, Ye = function () { w.remove("piano-id-initial-gm-sso-shown-" + (O.aid || pn.aid)); }; return { name: "pianoId", isv: !1, init: q, prepare: function () { return V(); }, show: z, showForm: function (e) { q().then((function () { var t = Object.assign({}, O, e, { isRegistration: !1 }); if (!t.formName)
            throw new Error('Form name should be specified, like\ntp.pianosId.showForm({formName: "..."});'); var r = function () { if (n)
            u.log("Modal login window already shown");
        else {
            if (se(t), ae(e), !t.preview && o)
                return void u.log("Skip show form, register new user");
            if (!t.hideIfComplete)
                return Object.assign(t, { readyCallback: function (e) { p.send("setToken", Ae(), e.iframeId); } }), _e(t);
            We(t).then((function (e) { if (e && e.has_all_custom_field_values_filled && t.hideIfComplete)
                u.log("Skip show form, all fields are completed");
            else {
                var n = Object.assign({}, t, { readyCallback: function (n) { p.send("userData", e, n.iframeId); } });
                _e(n);
            } }));
        } }; if (e.preview || Oe())
            r();
        else {
            var i = Object.assign({}, e, { closedCallback: function () { Oe() && r(); } });
            z(i);
        } })); }, checkAndShowEmailIsNotConfirmed: H, showEmailConfirmationRequired: function (e) { n ? u.log("Modal window already shown") : q().then((function () { var n = Object.assign({ screen: "email_confirmation_required" }, O, e); ae(e), se(n), _e(n); })); }, submitLoginForm: function () { p.send("submitLoginForm", null, null == n ? void 0 : n.iframeId); }, loginByToken: function (e) { var n = l(e); Me({ user: n, token: e }); }, logout: ue, getToken: Ae, getUser: Te, loadExtendedUser: function (e) { var n = Object.assign({}, O, e); We(n).then((function (e) { var t = Object.assign({}, e); e && Array.isArray(e.custom_field_values) && (e.custom_field_values = e.custom_field_values.map((function (e) { var n; try {
            n = JSON.parse(e.value);
        }
        catch (t) {
            n = e.value;
        } return { field_name: e.field_name, value: n, created: e.created }; }))), "function" == typeof n.extendedUserLoaded && n.extendedUserLoaded(t), oe("extendedUserLoaded", t); })); }, getName: function () { return "piano_id"; }, isConfigured: function () { return !0 === pn.usePianoIdUserProvider || "string" == typeof pn.usePianoIdUserProvider && "true" === pn.usePianoIdUserProvider; }, onLoginSuccess: function (e) { if (!i) {
            i = !0;
            var n = { source: e.source, token: e.user_token, user: e.params, cookie_domain: e.cookie_domain, stage: e.stage };
            u.setAccessTokenListCookie({ value: e.token_list, cookie_domain: e.cookie_domain }, e.user_token), Me(n).then((function () { i = !1; }));
        } }, onProfileUpdate: function (e, n) { var t = { token: e.token, user: e.user, cookie_domain: e.cookie_domain }; Me(t, !0).then((function () { n(), function (e) { re("profileUpdate", e); }(t); })); }, onExtendedUserLoginRequired: function () { W(); }, isUserValid: Oe, setCallbacks: ae, getIframeUrl: function () { return he(); }, updateLang: Be, onLangChange: function (e, n) { return L.langChangeFromIframe[n] = e, function () { delete L.langChangeFromIframe[n]; }; }, getLang: Ve, isAot: function () { R.forEach((function (e) { p.send("isAOT", {}, e.iframeId); })); }, registerCallback: function (e, n) { U[e] = U[e] || [], U[e].push(n); }, setRequestTimeout: ce, __protected__: { offerMessageReceiver: function (e) { switch (e.params.event) {
                case "cfAppImpression":
                case "cfFormImpression":
                    f.__protected__.logCustomFormImpression(e.params.trackingId, e.params.trackingId, E);
                    break;
                case "cfFormSubmission":
                    f.__protected__.logCustomFormSubmission(e.params.trackingId, e.params.trackingId, E);
                    break;
                case "changeScreen":
                    te(e.params.params.screen, !0);
                    break;
                case "loginFailed":
                case "registrationFailed":
                case "registrationSuccess":
                case "customEvent":
                    ie(e.params.event, e.params.params, !0);
                    break;
                case "emitGAEvent":
                    g.emitEvent(e.params.params);
                    break;
                default: return void u.debug("Received invalid event type: " + e.params.event);
            } }, showEmailConfirmation: function (e) { n ? u.log("Modal window already shown") : q().then((function () { var n = Object.assign({ screen: "email_confirmation" }, O, e); ae(e), se(n), _e(n); })); }, checkAndShowEmailIsNotConfirmed: H, closeModalContainer: Ce, executePostMessagesBatch: function () { for (; j.length;) {
                var e = j.pop();
                "broadcast" === e.type ? p.broadcast(e.name, e.data) : p.send(e.name, e.data);
            } } }, __private__: { prepareConfig: se, extendUserToken: function () { var e = Pe(); if (e) {
                var n = (new Date).getTime(), t = u.__protected__.getCookie(I), r = n - l(e).login_timestamp > 864e5;
                t && r && Re(!1, !0);
            } }, setRequestTimeout: ce } }; };
    pn.container.register("pianoId", { useValue: qe() }), pn.pianoId = pn.container.resolve("pianoId");
    var ze = function () { var e = pn.container.resolve("util"), n = pn.container.resolve("pianoId"), t = pn.container.resolve("eventUtils").createEventManager(["userChanged", "onHide"]), r = e.getAidSpecifiedName("__utp"), o = function () { return pn.externalJWT || i(); }, i = function () { return e.findCookieByName(r) || null; }; return { name: "pianoIdLite", isv: !1, isConfigured: function () { return !0 === pn.usePianoIdLiteUserProvider || "string" == typeof pn.usePianoIdLiteUserProvider && "true" === pn.usePianoIdLiteUserProvider; }, isUserValid: function () { return !!o(); }, getToken: o, getName: function () { return "piano_id_lite"; }, onLoginSuccess: function (n) { e.setAccessTokenListCookie({ value: n.token_list, cookie_domain: n.cookie_domain }, n.user_token); }, registerCallback: function (e, n) { t.addEvent(e), t.registerCallback(e, n); }, loginByToken: function (e) { n.loginByToken(e); }, logout: function (n) { e.waitCall("refreshUserToken", (function () { "function" == typeof n && n(); })); } }; }();
    pn.container.register("pianoIdLite", { useValue: ze }), pn.pianoIdLite = pn.container.resolve("pianoIdLite");
    var He = function (e) { void 0 === e && (e = pn.container); var n = e.resolve("api"), t = e.resolve("util"), r = e.resolve("janrain"), o = e.resolve("tinypassAccounts"), i = e.resolve("condeUserProvider"), a = e.resolve("gigya"), s = e.resolve("pianoId"), c = e.resolve("pianoIdLite"), l = e.resolve("eventUtils").createEventManager([]), u = { isv: !1, getName: function () { return "publisher_user_ref"; }, getToken: function () { return pn.userRef ? pn.userRef.constructor === "".constructor ? pn.userRef : pn.userRef.constructor === {}.constructor ? "{jox}" + JSON.stringify(pn.userRef) : pn.userRef : null; }, isUserValid: function () { return !!(void 0 !== pn.userRef && pn.userRef && pn.userRef.length > 0); }, onLoginSuccess: function (e) { t.setAccessTokenListCookie({ value: e.token_list, cookie_domain: e.cookie_domain }, e.user_token); }, logout: function (e) { t.setAccessTokenListCookie(), e && e(); } }, d = function () { var e = [r, o, i, a, s, c].find((function (e) { return e.isConfigured() && !e.isv; })); return e || u; }; return { name: "user", getProvider: d, providerInit: function (e) { void 0 !== e && e || (e = function () { }); var n = d(); "function" == typeof n.prepare ? "prepare" in n && n.prepare().then(e, e) : e(); }, refreshAccessToken: function (e, r) { void 0 !== r && r || (r = function () { }); var o = !1; if (void 0 !== e && e)
            o = !0;
        else {
            var i = t.__protected__.getCookie("__tae");
            if (void 0 !== i && i) {
                var a = new Date(parseInt(i));
                (new Date).getTime() - a.getTime() > 864e5 && (o = !0);
            }
            else
                o = !0;
        } o ? t.waitCall("refreshUserToken", (function () { t.waitCall("offerCreate", (function () { t.waitCall("experienceExecute", (function () { if (d().isUserValid()) {
            t.startCall("refreshAccessTokenList");
            var e = { url: t.prepareUrlParameter(window.location.href) };
            n.callApi("/access/token/list", e, (function (e) { t.doneCall("refreshAccessTokenList"), void 0 !== e.access_token_list ? (t.setAccessTokenListCookie(e.access_token_list), r && r(e.access_token_list.value)) : r && r(null); }), void 0, void 0, !0);
        }
        else
            r && r(""); })); })); })) : r(null); }, showLogin: function (e) { var n = d().getName(); if ("tinypass_accounts" === n)
            o.login(e);
        else if ("piano_id" === n) {
            var t = e || {};
            s.show(t);
        }
        else
            "publisher_user_ref" === n && l.fireCallbacks("loginRequired", {}, void 0, !0); }, isUserValid: function () { return d().isUserValid(); }, logout: function (e, n) { d().logout(e, n); }, registerCallback: function (e, n) { l.addEvent(e), l.registerCallback(e, n); }, getUserInfoParams: function (e) { var n = e.userToken; if (!n) {
            var r = d().getToken();
            n = r && r.length > 0 ? r : "";
        } return { user_token: n, user_lang: t.__protected__.getCookie("LANG") || "", is_preview: e.preview, is_non_logged_user: e.previewNonLoggedUser }; } }; };
    pn.container.register("user", { useValue: He() }), pn.user = pn.container.resolve("user");
    var We = function () { var e = pn.container.resolve("jqUtils"), n = pn.container.resolve("util"), t = "viewport-exit-activated", r = "viewport-exit-prepared", o = !1, i = !1, a = 0, s = 0, c = ["top", "right", "bottom", "left"], l = !0, u = !1, d = !1, p = [], f = { top: { visited: !1, value: 1 }, right: { visited: !1, value: 2 }, bottom: { visited: !1, value: 4 }, left: { visited: !1, value: 8 } }, m = 0, g = function () { if (!u) {
        u = !0, m = 0;
        var n = /(?:Firefox|Safari)[\/\s](\d+\.\d+)/.test(navigator.userAgent) ? document.body : document;
        e.on(n, "mouseleave", (function (e) { return v(e); })), e.on(document, "mousemove", (function (e) { return h(e); }));
    } }; var v = function (t) { var r, o, l, u, d, p, g; (r = function (e) { return e.clientX === e.clientY && e.clientX < 0 && e.clientX >= -1; }(t) ? "" : (o = t.clientX, l = t.clientY, u = e.winSize(), d = u.width, p = u.height, g = "", o >= d && (g = "right"), l >= p && (g = "bottom"), o <= 0 && (g = "left"), l <= 0 && (g = "top"), g)) || (r = function () { if (!i)
        return ""; var n = e.winSize(), t = n.width, r = n.height; return c[function (e) { if (0 === e.length)
        return -1; for (var n = e[0], t = 0, r = 1; r < e.length; r++)
        e[r] < n && (t = r, n = e[r]); return t; }([s, t - a, r - s, a])]; }(), r || n.debug("viewportExit: the detect of the exit side failed")), r && function (e) { -1 !== c.indexOf(e) ? f[e].visited || (f[e].visited = !0, m += f[e].value) : n.debug("viewportExit: the detect of the exit side failed"); }(r), w("all"), "top" === r && w("top"); }, h = function (e) { i = !0, s = e.clientY, a = e.clientX; }, w = function (e) { if (l) {
        for (var t, r = [], o = [], i = 0; i < p.length; i++)
            ((t = p[i]).detectExitMode === e || "back" === e && t.detectBackButtonForMobile) && t.consumeEventFn() ? r.push(t) : o.push(t);
        r.length && n.debug("viewportExit: listeners was run fire with type: ", e), p = o;
        for (i = 0; i < r.length; i++)
            (t = r[i]).callback();
    } }; return { name: "viewportExit", initialize: g, isInitialized: function () { return u; }, addListener: function (e, n, i) { "mobile" !== n.clientDevice && "tablet" !== n.clientDevice || !n.detectBackButtonForMobile || function () { if (!d) {
            d = !0, window.addEventListener("popstate", (function (e) { o && e.state && e.state.pianoViewportExitState === t && (o = !1, w("back")); }));
            var e = window.history.state || {};
            e && e.pianoViewportExitState !== r && (e.pianoViewportExitState !== t && (e.pianoViewportExitState = t, window.history.replaceState(e, document.title)), window.history.pushState({ pianoViewportExitState: r }, document.title)), o = !0;
        } }(), g(), "function" != typeof i && (i = function () { return !0; }), p.push({ callback: e, detectExitMode: n.detectExitMode, detectBackButtonForMobile: n.detectBackButtonForMobile, consumeEventFn: i }); }, resetSumOfCodesDirectionToDefault: function () { m = 0; }, getSumOfCodesDirection: function () { return m; }, removeListeners: function () { p = []; }, enable: function () { l = !0; }, disable: function () { l = !1; } }; }();
    pn.container.register("viewportExit", { useValue: We }), pn.viewportExit = pn.container.resolve("viewportExit");
    var Je = function () { var e = pn.container.resolve("postmessage"), n = pn.container.resolve("containerUtils"), t = pn.container.resolve("user"), r = pn.container.resolve("api"); pn.container.resolve("util"); function o(e) { return a(e, "/checkout/template/show"); } function i(e) { return e.initContextLoadPromise = function (e, n) { e.contextLoadingPromise = s(e, n); }, a(e, "/checkout/template/cacheableShow"); } var a = function (e, n) { var t = pn.getEndpointRoot(!0) + n; return e.iframeUrl = t, e.postMessageUrl = t, e.widget = "template", pn.offer.createOfferIframe(e); }, s = function (e, n) { var o = t.getUserInfoParams(e); return o.tracking_id = e.trackingId, o.templateId = e.templateId, o.templateVariantId = e.templateVariantId, o.aid = pn.aid, o.preload = e.isPreload, e.affiliateState && (o.affiliateState = JSON.stringify(e.affiliateState)), Object.keys(n).forEach((function (e) { o[e] = n[e]; })), new Promise((function (e, n) { r.callApi("/anon/template/loadTemplateContext", o, (function (t) { var r = t.code, o = t.templateContext, i = t.message; 0 === r ? e(o) : n(i); }), void 0, void 0, !0); })); }, c = function (e, n) { var t = {}; return ["aid", "templateId", "templateVariantId", "previewTemplateVersion", "preload", "preview", "previewUncached", "deploymentItemId", "gaClientId", "zuoraSelectedRatePlanIds", "newscycleSelectedIds", "addNewsletterAssets", "offerId", "experienceId", "iframeId", "displayMode", "debug", "pianoIdUrl", "widget", "url"].forEach((function (n) { e[n] && (t[n] = e[n]); })), n.param(t); }; function l(e) { pn.getCacheableShowTemplate() ? (!function (e) { e.deferredContextLoading = !0, e.buildQueryStringFn = c; }(e), e.createIframeFn = i) : e.createIframeFn = o; } return { name: "template", show: function (e) { return e.offerId = n.fakeOfferId, e.trackStatsOnShow = !0, l(e), pn.offer.show(e); }, deferredShow: function (e) { return e.offerId = n.fakeOfferId, l(e), pn.offer.deferredShow(e); }, close: function () { n.closeModalContainer(); }, closeInline: function (e) { n.__protected__.closeInlineContainers(e); }, createTemplateIframe: o, showBackdrop: function () { n.showBackdrop(); }, hideBackdrop: function () { n.hideBackdrop(); }, centerBackdrop: function (e) { n.centerBackdrop(e); }, registerCallback: function (e, n) { }, refreshUser: function (n) { t.refreshAccessToken(!0, (function () { e.send("externalLoginSuccess", { user_token: t.getProvider().getToken() }, n); })); } }; }();
    pn.container.register("template", { useValue: Je }), pn.template = pn.container.resolve("template");
    var Ge = function (e) { void 0 === e && (e = pn.container); var n, t, r = e.resolve("jqUtils"), o = e.resolve("util"), i = e.resolve("postmessage"), a = e.resolve("user"), s = e.resolve("containerUtils"), c = e.resolve("eventUtils"), l = e.resolve("viewportExit"), u = e.resolve("gaService"), d = e.resolve("sha1"), p = e.resolve("logging"), f = e.resolve("template"), m = {}, g = 0, v = "close", h = "OFFER", w = !1, y = !1, b = !1, k = {}, _ = new Map, C = {}, I = ["he_IL", "ar_EG"], S = c.createEventManager(["complete", "cancel", "close", "error", "loginRequired", "loginSuccess", "loaded", "customEvent", "startCheckout", "resize", "onMeterExpired", "onMeterActive", "onAccessGranted", "onShowOffer", "pianoIdEvent", "parentSize", "redeemCredit", "onStartCreditRedemption"]); s.setIframesPopstateHandlers(); var x = function () { return pn.offerBaseUrl ? pn.offerBaseUrl : pn.getEndpointRoot() + "/checkout/offer/show"; }; function P(e, n) { var c = s.getIframe(e.sender), d = !0; switch (c && c.config && (d = !c.config.parent), e.event) {
        case "initContext":
            if (e.params && e.params.resultCallbackId) {
                var p = { resultCallbackId: e.params.resultCallbackId, affiliateState: c.config.affiliateState };
                i.send("resultCallback", p, e.sender);
            }
            break;
        case "storeCustomVariables":
            tp.saveCustomVariablesToLocalStorage(300);
            break;
        case "fullRedirectThreeDS":
            window.location.href = e.params.bankSecureUrl;
            break;
        case "resize":
            if (e.params.iframeId === e.sender) {
                var f = void 0 === e.params.width ? ye(ye({}, e.params), { width: r.getWidth(c.container) }) : e.params;
                s.resizeIframe(c, f), "modal" === c.config.displayMode && ("boilerplate" === e.params.closeButtonType && s.hideCloseButton(c.container), s.centerIt(c.container)), i.send("afterResize", {}, c.iframeId);
            }
            S.fireCallbacks(e.event, e.params, e.sender, d);
            break;
        case "startCheckout":
            if (e.params.width = null, "inline" === e.displayMode) {
                e.params.closeOnLogout = !0;
                var m = q(e.params, c.statParams);
                m.browserId = c.browserId, m.isOpenedFromInlineCheckout = !0, K(m, e.sender);
            }
            e.params.iframeId === e.sender && S.fireCallbacks(e.event, e.params, e.sender, d);
            break;
        case "loaded":
            if (e.params.iframeId === e.sender) {
                if (i.send("setupCustomVariables", k[e.params.iframeId], e.params.iframeId), i.send("setupEVTFields", c.config.externalVerificationFields, e.params.iframeId), c.config.deferredContextLoading && T(c, e), c.waitFinishProcesses)
                    return void s.__protected__.closeAndRemoveIframe(c);
                "pianoId" === a.getProvider().name && pn.pianoId.__protected__.executePostMessagesBatch(), "modal" === c.config.displayMode && (s.resizeIframe(c, e.params), c.config.isPreload || s.checkBackdropAndContainer(c, !0)), "popup" === c.config.displayMode && s.resizeIframe(c, e.params), c.config.isPreload || c.config.trackStatsOnShow || B(c), V(c), S.fireCallbacks(e.event, e.params, e.sender, d), "inline" === c.config.displayMode && (c.containerReady ? s.resizeIframe(c, e.params) : s.operationWithContainer(c.iframeParams.containerSelector, (function (n) { var t = r.queryEl("#temp-inline-" + c.iframeId); t && (n.innerHTML = t.innerHTML, r.remove(t)), c.element = r.queryEl("iframe", n), c.containerReady = !0, s.resizeIframe(c, e.params); }))), R(c.config), o.doneCall("offerCreate");
            }
            break;
        case "downForMaintenance":
            s.resizeIframe(c, { width: 300, height: 200 }), "modal" === c.config.displayMode && (c.config.isPreload || s.checkBackdropAndContainer(c));
            break;
        case "removeQueryParamByName":
            e && e.params && Array.isArray(e.params.paramsToRemove) && e.params.paramsToRemove.forEach((function (e) { o.removeQueryParamByName(e); }));
            break;
        case "purge":
            n || (e && e.params && e.params.alreadyPurchased && (v = "alreadyHasAccess"), e && e.params && e.params.completePayment && (v = "checkoutCompleted"), s.purgeIframe(e.sender, c.config.parent), R(c.config));
            break;
        case "close":
            n || (e && e.params && e.params.alreadyPurchased && (v = "alreadyHasAccess"), e && e.params && e.params.completePayment && (v = "checkoutCompleted"), o.hasQueryParamByName("voucher_code") && (v = "voucherRedemptionCompleted"), s.closeContainer(e.sender, c.config.parent), R(c.config));
            break;
        case "closeAndRefresh":
            var g = e.params;
            g ? window.location.assign(g) : window.location.reload();
            break;
        case "selectTerm":
            v = e && e.params && e.params.alreadyPurchased ? "alreadyHasAccess" : "close";
            break;
        case "submitPayment":
        case "checkoutSelectTerm":
            S.fireCallbacks(e.event, q(e.params, { offerId: c.iframeParams.offerId }), e.sender, d);
            break;
        case "complete":
            if (void 0 !== e.params.token_list) {
                var h = e.params.user_token;
                !h && a.isUserValid() && "pianoId" === a.getProvider().name && (h = a.getProvider().getToken()), o.setAccessTokenListCookie({ value: e.params.token_list, cookie_domain: e.params.cookie_domain }, h);
            }
            var y = q(e.params, { offerId: c.iframeParams.offerId });
            S.fireCallbacks(e.event, y, e.sender, d), v = "checkoutCompleted";
            break;
        case "checkoutStateChange":
        case "checkoutPaymentError":
        case "alreadyPurchased":
        case "startThreeDBankSecure":
        case "cancel":
        case "error":
        case "customEvent":
            S.fireCallbacks(e.event, e.params, e.sender, d);
            break;
        case "loginRequired":
            w = !0, S.fireCallbacks(e.event, ne(c, e.params), e.sender, d);
            break;
        case "logout":
            A(e.event, e.params, e.sender, c.config.parent);
            break;
        case "loginSuccess":
            M(e.event, e.params, e.sender, d);
            break;
        case "inputFocus":
            var b = r.queryEl(".tp-modal");
            b && (b.style.zIndex = pn.zIndexes.modal + 1 + "", b.style.zIndex = pn.zIndexes.modal + "");
            break;
        case "inputBlur":
            var _ = r.queryEl(".tp-modal");
            _ && (_.style.zIndex = pn.zIndexes.modal + 1 + "", _.style.zIndex = pn.zIndexes.modal + "");
            break;
        case "getLocation":
            e.params && e.params.resultCallbackId && (e.params.result = window.location.href, i.send("resultCallback", e.params, e.sender));
            break;
        case "setLocationHash":
            e.params && e.params.hash && (window.location.hash = e.params.hash);
            break;
        case "langChangedWithinOffer":
            pn.pianoId.isConfigured() && pn.pianoId.updateLang(e.params.lang), I.indexOf(e.params.lang) >= 0 ? s.turnOnRTL(c) : s.turnOffRTL(c);
            break;
        case "loginStart":
            l.disable();
            break;
        case "loginEnd":
            l.enable();
            break;
        case "pianoIdEvent":
            e.params.iframeId === e.sender && ("closed" === e.params.event && s.closeContainer(e.sender), pn.pianoId.__protected__.offerMessageReceiver(e)), E(e.params, e.sender);
            break;
        case "swgCheckoutStart": break;
        case "sharedAccountsSuccessfullyAdded":
            i.broadcast("refreshMyAccount", { userToken: a.getProvider().getToken() });
            break;
        case "newsletterSignupImpression":
        case "newsletterSignupSubmission":
            pn.pianoEsp.__protected__.offerMessageReceiver(e), S.fireCallbacks(e.event, e.params, e.sender, d);
            break;
        case "parentSize":
            var C = r.winSize(), x = { width: C.width, height: C.height };
            i.send("parentSize", x, e.sender);
            break;
        case "gigyaPasswordlessLogin":
            e.params.iframeId === e.sender && (t = e.params.iframeId, pn.gigya.loginByPasswordless(e.params));
            break;
        case "emitGAEvent": return void (!n && u.emitEvent(e.params));
        case "emitMetricsEvent":
            !n && u.emitMetricsEvent(e.params);
            break;
        case "bannerInit":
            c.config.singleContainer.classList.add("tp-banner");
            break;
        case "bannerDestroy":
            c.config.singleContainer.classList.remove("tp-banner");
            break;
        case "redeemCredit":
            var P = S.fireCallbacks("onStartCreditRedemption", e.params, e.sender, d);
            P && P.then && P.then((function (n) { i.send("successfullyCreditRedeem", n, e.sender); }), (function (n) { i.send("creditRedeemFailed", n, e.sender); }));
            break;
        default: return void o.debug("Received invalid event type: " + e.event);
    } } var E = function (e, n) { "successDOI" === e.event && (e.iframeId !== n && s.closeContainer(e.iframeId), i.send("afterSuccessDOI", e.params, n)); }, T = function (e, n) { e.config.contextLoadingPromise.then((function (t) { var r = { iframeParams: e.iframeParams, userContext: t }; r.iframeParams.url = o.prepareUrlParameter(window.location.href), i.send("userDataContextLoaded", r, n.params.iframeId); })); }, A = function (e, n, t, r, o) { a.logout((function () { var e = {}; e.userProvider = a.getProvider().getName(), e.userToken = a.getProvider().getToken() && a.getProvider().getToken().length > 0 ? a.getProvider().getToken() : "", e.noNeedStartCheckout = !0, ee(e); }), h), n.closeOnLogout && s.closeModalContainer(t, r); }, M = function (e, n, t, r) { if (n.source = h, a.getProvider().onLoginSuccess(n), S.fireCallbacks("loginSuccess", n, t, r), !b) {
        var o = { userToken: n.user_token, user: n.user, reloadAfterLogin: !0 };
        ee(o, t);
    } }, O = function (e) { var n = e.displayMode || "modal"; return [e.offerId, n, e.containerSelector].join("|"); }, R = function (e) { var n = O(e); delete m[n]; }, L = function (e) { if (v = "close", Q(e), void 0 === e.displayMode)
        e.displayMode = "modal";
    else if ("modal" !== e.displayMode && "inline" !== e.displayMode && "popup" !== e.displayMode)
        return o.log("Invalid offer displayMode; must be one of: modal, inline, popup"), void R(e); if ("modal" === e.displayMode && !e.isPreload && s.hasModalIframe())
        return o.log("Modal offer is already shown; must be one modal offer per time"), void R(e); if ("modal" !== e.displayMode) {
        var n, t = r.qa(e.containerSelector);
        if (!e.isPreload)
            if (t.forEach((function (t) { var r = q({}, e); r.singleContainer = t, n = N(r); })), n)
                return n;
        var i = t[t.length - 1];
        i && (e.singleContainer = i);
    } return N(e); }; function N(e, c) { var l = function (e) { var n = {}; e.termIds && (e.termIds instanceof Array || (e.termIds = [e.termIds])); var t = e.additionalParamNames ? e.additionalParamNames : []; ["displayMode", "containerSelector", "templateId", "templateVariantId", "offerId", "termId", "termIds", "rid", "aid", "isCheckout", "isOpenedFromInlineCheckout", "pw_id", "paywallId", "width", "preview", "previewUncached", "previewTemplateType", "previewTemplateVersion", "tokenType", "janrainCaptureToken", "closeOnLogout", "voucherCode", "isRedemption", "allowReturnToStartState", "startFromInlineCheckout", "formNameByTermId", "hideCompletedFields", "startFromInlineCheckout", "reloadAfterLogin", "preventReloadAfterLogin", "isAuth", "authStartScreen", "showCloseButton", "closeButtonType", "checkoutFlowId", "offerState", "oid", "promoCode", "promoCodeId", "promoCodeTermId", "rurl_3ds", "thirdPartyParams", "termId3ds", "providerId", "deploymentItemId", "sharedAccountCode", "targetedTermId", "widget"].concat(["trackingId", "experienceId", "activeMeters"], t).forEach((function (t) { e[t] && (n[t] = e[t]), "showCloseButton" === t && (void 0 === e[t] ? n[t] = !0 : n[t] = e[t]); })); var r = decodeURIComponent(o.getQueryParamByName("_ptid")); return r && (n.trackingId = r), e.preview && (n.activeMeters = JSON.stringify([{ meterName: "preview-meter", views: 10, viewsLeft: 5, maxViews: 20, totalViews: 20 }])), n; }(e); l.widget || (l.widget = "offer"); var d = o.getTbcCookie(); d && d.length > 0 && (l.tbc = d), e.deferredContextLoading ? (l.iframeId = U(e), l.url = window.location.origin) : (l.iframeId = "offer-" + g++ + "-" + o.randomString(), l.url = o.prepareUrlParameter(window.location.href)); var f = r.winSize(); l.parentDualScreenLeft = void 0 !== window.screenLeft ? window.screenLeft : screen.left, l.parentDualScreenTop = void 0 !== window.screenTop ? window.screenTop : screen.top, l.parentWidth = f.width ? f.width : document.documentElement.clientWidth ? document.documentElement.clientWidth : screen.width, l.parentHeight = f.height ? f.height : document.documentElement.clientHeight ? document.documentElement.clientHeight : screen.height, l.parentOuterHeight = window.outerHeight, e.previewNonLoggedUser && (l.previewNonLoggedUser = e.previewNonLoggedUser), e.isPreload && (l.preload = 1), pn.locale && (l.lang = pn.locale), u.getClientId() && (l.gaClientId = u.getClientId()), u.getGAAccount() && (l.gaAccount = u.getGAAccount()), function (e) { ["debug", "aid", "gaClientId", "tags", "contentSection", "contentAuthor", "debug", "zone"].forEach((function (n) { pn[n] && (e[n] = pn[n]); })), pn.customVariables && (k[e.iframeId] = JSON.stringify(pn.customVariables)); var n = pn.contentCreated; n && (e.contentCreated = n), pn && pn.main && (e.pageViewId = pn.main.fetchPageViewId(), e.visitId = pn.main.fetchVisitId()); }(l); var m = S.hasCallback("loginRequired"); if (!pn.janrain.isConfigured() || void 0 !== e.loginRequired && e.loginRequired)
        if (!pn.gigya.isConfigured() || void 0 !== e.loginRequired && e.loginRequired)
            if (pn.pianoId.isConfigured()) {
                void 0 !== e.loginRequired && e.loginRequired || (e.loginRequired = function (e) { if (!e.preventExternalLogin)
                    return n = e.termId, t = l.iframeId, pn.pianoId.show({ screen: e.startScreen }), !1; }), W(), l.pianoIdUrl = pn.pianoId.getIframeUrl();
                var h = pn.pianoId.getLang();
                h && (l.lang = h), pn.pianoId.onLangChange((function (e) { i.send("langChanged", { lang: e }, l.iframeId); }), l.iframeId);
            }
            else
                pn.pianoIdLite.isConfigured() && (l.pianoIdUrl = pn.pianoId.getIframeUrl());
        else {
            b = [];
            pn.gigya.registerCallback("onHide", (function (e) { s.activateContainers(b), i.send("gigyaHide", e, t); })), z(), e.loginRequired = function (e) { return y = e.allowReturnToStartState, w = !1, b = s.hideModalContainer(), n = e.termId, t = l.iframeId, o.waitCall("refreshUserToken", (function () { pn.gigya.login(); })), !1; };
        }
    else {
        var b = [];
        pn.janrain.addEventHandler("onModalClose", (function () { s.activateContainers(b); })), H(), e.loginRequired = function (e) { return b = s.hideModalContainer(), y = e.allowReturnToStartState, w = !1, n = e.termId, t = l.iframeId, o.waitCall("refreshUserToken", (function () { pn.janrain.login(void 0, e); })), !1; };
    } l.userProvider = a.getProvider().getName(), e.userToken ? l.userToken = e.userToken : l.userToken = a.getProvider().getToken() && a.getProvider().getToken().length > 0 ? a.getProvider().getToken() : "", o.getCampaigns(l), l.customCookies = JSON.stringify(o.getCustomCookies()), S.registerCallback(e, l.iframeId), l.hasLoginRequiredCallback = S.hasIframeCallback("loginRequired", l.iframeId) || m, l.initMode = "context", j(l); var _ = e.iframeUrl ? e.iframeUrl : l.isCheckout ? pn.getEndpointRoot(!0) + "/checkout/offer/show" : x(), I = e.postMessageUrl ? e.postMessageUrl : x(); e.deferredContextLoading && e.initContextLoadPromise(e, D(l)); var E = F(l, e), T = s.createContainer({ url: _, config: e, parent: e.parent, postMessageUrl: I, receive: P, iframeParams: l, singleContainer: e.singleContainer, close: function () { S.fireCallbacks("close", { state: v }, l.iframeId, !0); } }), A = _.indexOf("/offer/") ? "offerShow" : "templateShow"; return p.setTime(A), C = _.indexOf("/template/") && l.offerId === s.fakeOfferId ? l : C, T.statParams = E, T.browserId = e.browserId, T; } var U = function (e) { var n = 0, t = "offer_" + d.hash(e.iframeUrl + "?" + e.buildQueryStringFn(e, r), 20); return _.has(t) && (n = _.get(t) + 1), _.set(t, n), t + "-" + n; }, j = function (e) { var n = o.getQueryParamByName("termId"), t = o.getQueryParamByName("paySource"); n && (e.termId = n), t && (e.paySource = t); }, D = function (e) { var n = {}; return ["tbc", "trackingId", "pageViewId", "visitId", "tags", "contentCreated", "contentSection", "contentAuthor"].forEach((function (t) { e[t] && (n[t] = e[t]); })), Object.keys(e).forEach((function (t) { 0 === t.indexOf("tpcc_") && (n[t] = e[t]); })), n; }, F = function (e, n) { var t = {}; return n.trackStatsOnShow || n.deferredContextLoading || (t = D(e), Object.keys(t).forEach((function (n) { delete e[n]; }))), t; }, B = function (e) { var n = q(e.iframeParams, e.statParams); e.config.affiliateState && (n.affiliateState = e.config.affiliateState), i.send("trackStat", n, e.iframeId); }, V = function (e) { var n = { browserId: e.browserId }; i.send("passBrowserId", n, e.iframeId); }, q = function (e, n) { var t = {}; return Object.keys(e).forEach((function (n) { t[n] = e[n]; })), Object.keys(n).forEach((function (e) { t[e] = n[e]; })), t; }, z = function () { b || (pn.gigya.registerCallback("userChanged", (function (e) { if (e && e.user_token) {
        var r = { token_list: e.access_token.value, user_token: e.user_token, userToken: e.user_token, cookie_domain: e.access_token.cookie_domain, user: e.user, allowReturnToStartState: y, termId: n };
        if (t)
            s.getIframe(t) ? (i.send("externalLoginSuccess", r, t), delete r.termId, ee(r, t)) : ee(r);
        else
            ee(r);
    } })), pn.gigya.registerCallback("logout", (function () { var e, r = {}; r.userProvider = a.getProvider().getName(), r.userToken = a.getProvider().getToken() && a.getProvider().getToken().length > 0 ? a.getProvider().getToken() : "", r.noNeedStartCheckout = !0, t && (e = s.getIframe(t)), e && "inline" === e.config.displayMode && s.closeModalContainer(), n = "", t = "", y = !1, ee(r); })), b = !0); }, H = function () { b || (pn.janrain.registerCallback("userChanged", (function (e) { if (e && e.user_token) {
        var r = { token_list: e.access_token.value, user_token: e.user_token, userToken: e.user_token, cookie_domain: e.access_token.cookie_domain, user: e.user, allowReturnToStartState: y, termId: n };
        if (t)
            s.getIframe(t) ? (i.send("externalLoginSuccess", r, t), delete r.termId, ee(r, t)) : ee(r);
        else
            ee(r);
    } })), pn.janrain.addEventHandler("onCaptureSessionEnded", (function () { var e, r = {}; r.userProvider = a.getProvider().getName(), r.userToken = a.getProvider().getToken() && a.getProvider().getToken().length > 0 ? a.getProvider().getToken() : "", r.noNeedStartCheckout = !0, t && (e = s.getIframe(t)), e && "inline" === e.config.displayMode && s.closeModalContainer(), n = "", t = "", y = !1, ee(r); })), b = !0); }, W = function () { b || (pn.pianoId.setCallbacks({ loggedIn: function (e) { o.log("offer.js - piano id user logged in"); var r = { user_token: e.token, userToken: e.token, user: e.user, reloadAfterLogin: !0, termId: n }; t ? s.getIframe(t) ? (i.send("externalLoginSuccess", r, t), Z(t, r), delete r.termId, ee(r, t)) : ee(r) : ee(r); }, loggedOut: function (e) { if (e.source !== h) {
            var r = {};
            r.userProvider = a.getProvider().getName(), r.userToken = a.getProvider().getToken() && a.getProvider().getToken().length > 0 ? a.getProvider().getToken() : "", r.noNeedStartCheckout = !0, ee(r);
        } n = "", t = ""; } }), b = !0); }; function J(e) { return s.showPreloadedContainer(e); } var G = function (e) { var n = e.offerId === s.fakeOfferId ? "showTemplate" : "showOffer"; S.hasCallback(n) && S.fireCallbacks(n, e, void 0, !0); }, Q = function (e) { [{ queryParam: "promo_code", configParam: "promoCode" }].forEach((function (n) { var t = o.getQueryParamByName(n.queryParam); t.length && (e[n.configParam] = t); })); }, X = function (e) { if (e.offerId || !0 === e.preview) {
        if (function (e) { var n = O(e); return !!m[n]; }(e))
            return !1;
        e.preview || function (e) { var n = O(e); m[n] = !0; }(e), setTimeout((function () { R(e); }), 1e4), o.waitCall("refreshUserToken", (function () { o.waitCall("refreshAccessTokenList", (function () { o.waitCall("myAccountLogin", (function () { var n; if (o.startCall("offerCreate"), e.createIframeFn ? (Q(e), n = e.createIframeFn(e)) : n = L(e), !n)
            return o.doneCall("offerCreate"), void o.error("Could not initialize offer; check configuration"); $(e) && Y(n.iframeId), G(e); })); })); }));
    }
    else
        o.error("Must specify offerId"); }; var $ = function (e) { return !!e.directCheckout && "inline" !== e.displayMode; }, Y = function (e) { o.waitCall("offerCreate", (function () { i.send("startDirectCheckout", {}, e); })); }, K = function (e, n) { if (!function (e) { return !e.offerId && !e.isRedemption && !e.preview; }(e)) {
        var t = S.hasCallback("loginRequired");
        e.isSiteLicensing && t && (te() || re()) ? f.refreshUser(C.iframeId) : (s.hasModalIframe() && s.closeModalContainer(), o.debug("creating checkout: ", e), e.displayMode = "popup" === e.displayMode ? "popup" : "modal", e.isCheckout = !0, e.parent = n, o.waitCall("refreshUserToken", (function () { o.waitCall("refreshAccessTokenList", (function () { var t; o.startCall("offerCreate"), t = e.createIframeFn ? e.createIframeFn(e) : L(e), s.__protected__.addChildToInlineIframe(t, n), t ? w && o.waitCall("offerCreate", (function () { w = !1; var e = {}; e.userProvider = a.getProvider().getName(), a.getProvider().getToken() && a.getProvider().getToken().length > 0 ? e.userToken = a.getProvider().getToken() : e.userToken = "", e.noNeedStartCheckout = !0, e.noNeedStartCheckoutAfterLogin = !0, ee(e, t.iframeId); })) : (o.doneCall("offerCreate"), o.error("Could not start checkout; check configuration")); })); })));
    } }, Z = function (e, n) { i.send("reloadOffer", n, e); }, ee = function (e, n) { i.broadcast("reloadOffer", e, n); }, ne = function (e, n) { var t = { reloadAfterLogin: !0 }; return Object.assign(t, e.config), t.singleContainer && delete t.singleContainer, n.termId && (t.termId = n.termId), n.term && (t.term = {}, t.term = q(t.term, n.term)), n.startScreen && (t.startScreen = n.startScreen), n.isRedemption && (t.isRedemption = n.isRedemption, t.voucherCode = n.redemption && n.redemption.form && n.redemption.form.redeemCode, t.termId = null), n && n.currentState && "modal" === e.config.displayMode && (t.allowReturnToStartState = !0), n.preventExternalLogin && (t.preventExternalLogin = n.preventExternalLogin), n.sharedAccountCode && (t.sharedAccountCode = n.sharedAccountCode), n.isSiteLicensing && (t.isSiteLicensing = n.isSiteLicensing), n.campaignCode && (t.campaignCode = n.campaignCode), n.campaignGroupId && (t.campaignGroupId = n.campaignGroupId), t.displayMode = "modal", t; }, te = function () { return "publisher_user_ref" === a.getProvider().getName(); }, re = function () { return "piano_id_lite" === a.getProvider().getName(); }; return { name: "offer", show: function (e) { "inline" === e.displayMode ? s.operationWithContainer(e.containerSelector, (function () { X(e); })) : X(e); }, deferredShow: function (e) { return function (e) { var n, t, r, i = new Promise((function (e, r) { n = e, t = r; })), a = new Promise((function (e, n) { r = e; })); return "popup" !== e.displayMode && e.offerId ? o.waitCall("refreshAccessTokenList", (function () { var i; e.isPreload = !0, o.startCall("offerCreate"), e.createIframeFn ? (Q(e), i = e.createIframeFn(e)) : i = L(e), i ? (i.element.onload = function () { r(i); }, n(i)) : (o.doneCall("offerCreate"), o.error("Could not initialize offer; check configuration"), t()); })) : t(), { promise: i, show: function () { i.then(J).then((function () { return a; })).then((function (n) { B(n), $(e) && Y(n.iframeId), G(e); }), (function () { X(e), delete e.isPreload; })); } }; }(e); }, close: function () { s.closeModalContainer(); }, closeInline: function (e) { s.__protected__.closeInlineContainers(e); }, startCheckout: K, startRedeemVoucher: function (e, n) { s.closeModalContainer(), e || (e = {}), e.isRedemption = !0, o.debug("starting redeem voucher: ", e), e.displayMode = "popup" === e.displayMode ? "popup" : "modal", e.isCheckout = !1, e.parent = n, o.waitCall("refreshAccessTokenList", (function () { o.startCall("offerCreate"), (e.createIframeFn ? e.createIframeFn(e) : L(e)) || (o.doneCall("offerCreate"), o.error("Could not start redeem; check configuration")); })); }, createOfferIframe: L, showBackdrop: function () { s.showBackdrop(); }, hideBackdrop: function () { s.hideBackdrop(); }, centerBackdrop: function (e) { s.centerBackdrop(e); }, registerCallback: function (e, n) { S.addEvent(e), S.registerCallback(e, n); }, reload: Z, reloadAll: function (e, n) { var t = e || {}; o.waitCall("refreshUserToken", (function () { ee(Object.assign(t, { userToken: pn.user.getProvider().getToken() }), n); })); }, resetUserAndReloadAll: function (e, n) { var t = e || {}; ee(Object.assign(t, { userToken: "" }), n); }, checkThreeDSRedirect: function () { var e = "pn_rurl_3ds", n = o.getQueryParamByName(e); if (n) {
            var t = { offerId: "pn_offer_id", oid: "pn_oid", termId3ds: "pn_term_id", providerId: "pn_provider_id", thirdPartyParams: "third_party_params" }, r = [e], i = Object.keys(t).reduce((function (e, n) { var i = Object.assign({}, e); return i[n] = o.getQueryParamByName(t[n]), r.push(t[n]), i; }), {});
            o.removeQueryParamByName(r), X(Object.assign({ displayMode: "modal", rurl_3ds: n }, i));
        } } }; };
    pn.container.register("offer", { useValue: Ge() }), pn.offer = pn.container.resolve("offer");
    var Qe = function () { var e, n = pn.container.resolve("jqUtils"), t = pn.container.resolve("util"), r = pn.container.resolve("postmessage"), o = pn.container.resolve("offer"), i = pn.container.resolve("user"), a = pn.container.resolve("containerUtils"), s = pn.container.resolve("pianoId"), c = pn.container.resolve("logging"), l = {}, u = !1, d = { loginRequired: [], loginSuccess: [] }, p = function () { return pn.getEndpointRoot() + "/checkout/myaccount/show"; }, f = function (e, n) { e.element.style.height = (e.config.maxHeight ? Math.min(n.height, e.config.maxHeight) : n.height) + "px", e.container.style.height = (e.config.maxHeight ? Math.min(n.height, e.config.maxHeight) : n.height) + "px", e.element.style.width = n.width + "px", "modal" === e.config.displayMode && (e.container.style.width = n.width + "px"), r.send("resized", { height: e.config.maxHeight ? Math.min(n.height, e.config.maxHeight) : n.height, width: n.width }, e.iframeId); }, m = function (t, r, i) { return function () { e && (n.removeClass("tp-active", e), o.hideBackdrop(), window.setTimeout((function () { n.remove(e); }), 250), r.result = i, t(r)); }; }, g = function (e) { var t = n.winSize(); e.offsetHeight > t.height ? (!1 === u && (e.style.position = "absolute", u = !0), e.style.marginTop = window.scrollY - .5 * t.height + "") : (!0 === u && (e.style.position = "fixed", u = !1), e.style.marginTop = 0 - .5 * e.offsetHeight + ""), o.centerBackdrop(e), e.style.marginLeft = 0 - .5 * e.offsetWidth + ""; }, v = function (t, i) { !function (t, r) { var i = document.createElement("div"); n.addClass("tp-modal", i); var a = document.createElement("div"); n.addClass("tp-close", a); var s = document.createElement("div"); n.addClass("tp-message", s), i.style.width = (t.width ? t.width : 400) + "px", s.innerHTML = t.message; var c = document.createElement("div"); n.addClass("tp-btn-container", c); var l = document.createElement("button"); n.addClass("tp-btn", l), n.addClass("tp-ok-btn", l), l.innerHTML = t.ok ? t.ok : "Ok"; var u = document.createElement("button"); n.addClass("tp-btn", u), n.addClass("tp-cancel-btn", u), u.innerHTML = t.cancel ? t.cancel : "Cancel", n.on(a, "click", m(r, t, "cancel")), n.on(u, "click", m(r, t, "cancel")), n.on(l, "click", m(r, t, "ok")), n.append(i, a), n.append(i, s), n.append(c, l), n.append(c, u), n.append(i, c), n.append(document.body, i), o.showBackdrop(), n.addClass("tp-active", i), g(i), e = i; }(i.params, (function (e) { r.send("closeDialog", e, l[i.sender].iframeId); })); }, h = function (e, n) { d[e] = d[e] || [], d[e].push(n); }, w = function (e, n, o) { if (t.debug("received event: " + e, n), void 0 !== d[e]) {
        for (var i = 0; i < d[e].length; ++i) {
            t.debug("firing callback for event: " + e);
            var a = d[e][i](n);
            n && n.resultCallbackId && (n.result = a, n.event = e, r.send("resultCallback", n, o));
        }
        !d[e].length && n && n.resultCallbackId && (n.callbackNotFound = !0, n.event = e, r.send("resultCallback", n, o));
    } }, y = function (e) { switch (t.log("*** My account event received", e.event, e.params), e.event) {
        case "resize":
            t.debug("*** Resize event", e.params.width, e.params.height), f(l[e.sender], e.params), "modal" === l[e.sender].config.displayMode && g(l[e.sender].container);
            break;
        case "loaded":
            r.send("initMaxHeight", { height: l[e.sender].config.maxHeight }, l[e.sender].iframeId), f(l[e.sender], e.params), "pianoId" === i.getProvider().name && s.__protected__.executePostMessagesBatch(), "modal" === l[e.sender].config.displayMode && window.setTimeout((function () { n.addClass("tp-active", l[e.sender].container), g(l[e.sender].container); }), 25);
            break;
        case "cancel":
        case "complete":
        case "error":
        case "loginRequired":
        case "customEvent":
            w(e.event, e.params, e.sender);
            break;
        case "openDialog":
            v(e.event, e);
            break;
        case "pianoIdProfileUpdated":
            s.onProfileUpdate(e.params, (function () { var n = e.params; n && n.resultCallbackId && r.send("resultCallback", n, e.sender); var t = { userToken: e.params.token, user: e.params.user }; b(t); }));
            break;
        case "extendedUserLoginRequired":
            s.onExtendedUserLoginRequired();
            break;
        case "loginSuccess":
            i.getProvider().onLoginSuccess(e.params);
            var o = { reloadAfterLogin: !0, userToken: e.params.user_token, user: e.params.user };
            b(o), w(e.event, e.params, e.sender);
            break;
        case "logout":
            i.logout((function () { var e = {}; e.userProvider = i.getProvider().getName(), e.userToken = i.getProvider().getToken() && i.getProvider().getToken().length > 0 ? i.getProvider().getToken() : "", b(e); })), w(e.event, e.params, e.sender);
            break;
        case "userProfileUpdateSuccess":
            var a = e, c = a.event, u = a.params, d = a.sender;
            i.getProvider().onLoginSuccess(u);
            var p = { userProvider: u.user_provider, userToken: u.user_token };
            for (var m in b(p), w(c, u, d), l)
                if (l.hasOwnProperty(m)) {
                    var h = l[m].config;
                    h.hasOwnProperty("userToken") && delete h.userToken, I(h);
                }
            break;
        case "langChangedWithinMyAccount":
            s.isConfigured() && s.updateLang(e.params.lang);
            break;
        case "requestScrollData":
            k(e.sender);
            break;
        case "downForMaintenance":
            f(l[e.sender], { width: 300, height: 200 });
            break;
        case "removeQueryParamByName":
            Array.isArray(e.params.paramsToRemove) && e.params.paramsToRemove.forEach((function (e) { t.removeQueryParamByName(e); }));
            break;
        case "getTrackingData":
            r.send("getTrackingDataResponseEvent", { pageViewId: pn.main.fetchPageViewId(), tbc: t.getTbcCookie() }, e.sender);
            break;
        default: return void t.log("Received invalid event type: " + e.event);
    } }, b = function (e) { r.broadcast("reloadOffer", e); }, k = function (e) { var n = l[e].element.getBoundingClientRect(), t = { iframeRect: { bottom: n.bottom, height: n.height, left: n.left, right: n.right, top: n.top, width: n.width } }; r.send("returnScrollData", t, e); }; function _(e) { var o = { widget: "myaccount" }; if (e.templateId && (o.templateId = e.templateId), void 0 === e.displayMode)
        e.displayMode = "inline";
    else if ("modal" !== e.displayMode && "inline" !== e.displayMode)
        return void t.log("Invalid offer displayMode; must be one of: modal, inline"); if (o.displayMode = e.displayMode, o.iframeId = t.randomString(16), o.url = window.location.href, o.initialWidth = e.width, o.initialHeight = e.height, o.maxHeight = e.maxHeight, pn.locale && (o.lang = pn.locale), !pn.janrain.isConfigured() || void 0 !== e.loginRequired && e.loginRequired)
        if (!pn.gigya.isConfigured() || void 0 !== e.loginRequired && e.loginRequired)
            if (pn.pianoId.isConfigured()) {
                v = e;
                if (pn.pianoId.setCallbacks({ loggedIn: function (n) { var t; o.userToken !== n.token && (e.loginSuccess && (t = e.loginSuccess(n)), (void 0 === t || t) && (v.userToken = n.token, I(v))); }, loggedOut: function () { var e = {}; e.userProvider = i.getProvider().getName(), e.userToken = i.getProvider().getToken() && i.getProvider().getToken().length > 0 ? i.getProvider().getToken() : "", b(e); } }), void 0 === e.loginRequired || !e.loginRequired) {
                    var s = 0;
                    e.loginRequired = function () { if (++s > 10)
                        t.log("Too many attemps to login for myAccount");
                    else {
                        var e = t.getQueryParamByName("verification_code");
                        pn.pianoId.show({ verificationCode: e });
                    } };
                }
                o.pianoIdUrl = pn.pianoId.getIframeUrl();
                var u = pn.pianoId.getLang();
                u && (o.lang = u), pn.pianoId.onLangChange((function (e) { r.send("langChanged", { lang: e }, o.iframeId); }), o.iframeId);
            }
            else
                pn.pianoIdLite.isConfigured() && (o.pianoIdUrl = pn.pianoId.getIframeUrl());
        else {
            m = [];
            pn.gigya.registerCallback("onHide", (function () { a.activateContainers(m), t.doneCall("myAccountLogin"); })), e.loginRequired = function () { var n = e; t.waitCall("refreshAccessTokenList", (function () { t.waitCall("offerCreate", (function () { t.startCall("myAccountLogin"), m = a.hideModalContainer(), pn.gigya.login((function (t) { var r; e.loginSuccess && (r = e.loginSuccess(t)), (void 0 === r || r) && (n.userToken = t.user_token, I(n)); })); })); })); };
        }
    else {
        var m = [], v = e;
        pn.janrain.addEventHandler("onModalClose", (function () { a.activateContainers(m), t.doneCall("myAccountLogin"); })), pn.janrain.registerCallback("userChanged", (function (n) { var t; n && n.user_token && (e.loginSuccess && (t = e.loginSuccess(n)), (void 0 === t || t) && (v.userToken = n.user_token, I(v))); })), pn.janrain.addEventHandler("onCaptureSessionEnded", (function (n) { var t; e.loginSuccess && (t = e.loginSuccess(n)), (void 0 === t || t) && (v.userToken = null, I(v)); })), e.loginRequired = function () { return t.waitCall("refreshAccessTokenList", (function () { t.waitCall("offerCreate", (function () { t.startCall("myAccountLogin"), m = a.hideModalContainer(), pn.janrain.login(); })); })), !1; };
    } return new Promise((function (a) { t.waitCall("refreshUserToken", (function () { var s, u = {}; if ("inline" === e.displayMode) {
        if (!e.containerSelector)
            return void t.log("My account must have a valid containerSelector");
        if (!(s = n.queryEl(e.containerSelector)))
            return void t.log("My account must have a valid containerSelector");
        o.width = n.getWidth(s);
    }
    else
        s = function () { var e = document.createElement("div"); n.addClass("tp-modal", e); var t = document.createElement("div"); return n.addClass("tp-close", t), n.append(e, t), n.append(document.body, e), e; }(); for (var m in o.pageViewId = pn.main.fetchPageViewId(), o.tbc = t.getTbcCookie(), o.userProvider = i.getProvider().getName(), e.userToken ? o.userToken = e.userToken : o.userToken = i.getProvider().getToken(), d)
        "function" == typeof e[m] && (t.debug("Registering " + m + " callback for iframe " + o.iframeId), h(m, e[m])); o.aid = pn.aid, pn.isSensitiveDataProtectionEnabled && (u = { userToken: o.userToken, iframeId: o.iframeId }, delete o.userToken); var v = p() + "?" + n.param(o), w = document.createElement("iframe"), b = { scrolling: "no", allowtransparency: "true", name: o.iframeId, id: o.iframeId, allow: "payment" }; pn.isSensitiveDataProtectionEnabled || (b.src = v), Object.keys(b).forEach((function (e) { n.setAttr(e, b[e], w); })); var k = { overflow: "hidden", border: "0", height: "0" }; if ("inline" === e.displayMode ? k.width = o.width + "px" : k.width = 0, Object.keys(k).forEach((function (e) { w.style[e] = k[e]; })), l[o.iframeId] = { iframeId: o.iframeId, config: e, element: w, container: s, containerWidth: n.getWidth(s), containerHeight: n.getHeight(s) }, r.init({ postMessageUrl: p(), receive: y, iframe: l[o.iframeId] }), n.on(window, "keyup", (function (e) { })), "modal" === e.displayMode && n.on(window, "resize", (function () { g(s); })), "modal" === e.displayMode ? g(s) : n.empty(s), pn.isSensitiveDataProtectionEnabled) {
        u.iframeSrc = v;
        var _ = C(u);
        n.append(s, w), n.append(s, _), _.submit();
    }
    else
        n.append(s, w); if (n.on(window, "resize", (function () { !function () { for (var e in l) {
        var t = l[e], o = !1, i = n.getWidth(t.container);
        i !== t.containerWidth && (t.element.style.width = i + "", t.containerWidth = i, o = !0);
        var a = n.getHeight(t.container);
        a !== t.containerHeight && (t.element.style.height = a + "", t.containerHeight = a, o = !0), o && r.send("resize", { width: i, height: a }, e);
    } }(); })), "inline" === e.displayMode && window.ResizeObserver) {
        var I = new ResizeObserver((function (e) { var t = n.getWidth(s); t > 0 && f(l[o.iframeId], { width: t }); }));
        I.observe(s), l[o.iframeId].resizeObserver = I;
    } pn.offer && pn.offer.registerCallback("complete", (function () { r.send("refreshNow", {}, o.iframeId); })), a(l[o.iframeId]), c.setTime("myAccountShow"); })); })); } var C = function (e) { var t = document.createElement("form"), r = { id: "form_" + e.iframeId, method: "post", action: e.iframeSrc, target: e.iframeId }; return n.setAttrs(r, t), [{ name: "userToken", value: e.userToken }].forEach((function (e) { var r = document.createElement("input"), o = { type: "hidden", name: e.name }; n.setAttrs(o, r), r.value = e.value, n.append(t, r); })), t; }, I = function (e) { t.waitCall("offerCreate", (function () { t.waitCall("refreshAccessTokenList", (function () { var n; null === (n = _(e)) || void 0 === n || n.then((function (e) { e || t.log("Could not initialize my account; check configuration"); })); })); })); }; return { name: "myaccount", show: I, registerCallback: h }; }();
    pn.container.register("myaccount", { useValue: Qe }), pn.myaccount = pn.container.resolve("myaccount");
    var Xe = function () { var e = pn.container.resolve("jqUtils"), n = pn.container.resolve("util"), t = pn.container.resolve("api"), r = pn.container.resolve("offer"), o = pn.container.resolve("eventUtils").createEventManager(["onCheckoutSuccess", "onMeterExpired", "onMeterError", "onAccessGranted", "onMeterActive", "onMeterInactive", "meterSelector"]), i = { state: "ok", views_left: null, offer_id: "", curtain_template_id: "", reminder_template_id: "", cookie_name: "", cookie_value: "", cookie_expires: "", show_reminder: !1, show_close_button: !1 }, a = function (e, t) { return o.fire(void 0, e, !0, t), !u[e] || "function" != typeof u[e] || (n.debug("_customCaller called with " + e), u[e](t)); }, s = function (n) { (n = n || {}).offerId || (n.offerId = i.offer_id), n.templateId || (n.templateId = i.curtain_template_id), n.displayMode || (n.displayMode = u.displayMode), n.containerSelector || (n.containerSelector = u.containerSelector), n.showCloseButton || (n.showCloseButton = i.show_close_button), "function" === e.type(u.close) && (n.close = u.close), "function" === e.type(u.loginRequired) && (n.loginRequired = u.loginRequired), "function" === e.type(u.customEvent) && (n.customEvent = u.customEvent), "function" === e.type(u.onCheckoutSuccess) && (n.complete = u.onCheckoutSuccess), r.createOfferIframe(n); }, c = function (e) { if (a("___onProcessMeter", e), !e.user_meter)
        return n.log("Could not load meter", e), void a("onMeterError", e); if ((i = e.user_meter) && i.cookie_name && i.cookie_value && i.cookie_expires) {
        var t = { path: "/", expires: i.cookie_expires };
        i.cookie_domain && (t.domain = i.cookie_domain), n.__protected__.setCookie(i.cookie_name, i.cookie_value, t);
    } "ok" === i.state ? function (e) { n.debug("_handleMeterActive", e), e.show_reminder && e.reminder_template_id && e.track_page_view && a("onShowOffer", e) && s({ templateId: e.reminder_template_id }), a("onMeterActive", e); }(i) : "ap" === i.state ? function (e) { n.debug("_handleAccessGranted", e), a("onAccessGranted", e); }(i) : "ia" === i.state ? function (e) { n.debug("_handleMeterInactive", e), a("onMeterInactive", e); }(i) : function (e) { n.debug("_handleExpired", e), a("onMeterExpired", e), e.track_page_view && a("onShowOffer", e) && s(); }(i); }, l = function (e, r, o) { if (null !== u.paywallId && "" !== u.paywallId) {
        var i = document.URL;
        e && "function" == typeof e.getAttribute && e.getAttribute("href") ? i = e.getAttribute("href") : e && "function" == typeof e.attr && e.attr("href") && (i = e.attr("href"));
        var a = u.trackPageview;
        a && delete u.trackPageview;
        var s = u.meterSelector();
        s || (s = "");
        var l = { paywall_id: u.paywallId, url: encodeURI(i), referer: encodeURI(u.referer), track_page_view: a, meter_name: s, pageview_id: pn.main.fetchPageViewId() };
        r && (l.transaction_id = r), u.referer = "";
        var d = n.__protected__.getCookie("umc");
        if (d)
            l.umc = d;
        else {
            var p = n.__protected__.getCookie("umc_" + u.paywallId);
            p && (l.umc = p);
        }
        t.callApi("/anon/meter/load", l, (function (e) { c(e), "function" == typeof o && o(); }));
    }
    else
        n.debug("You must specify a paywallId in your configuration"); }, u = { paywallId: null, trackPageview: !0, trackExternalReferrer: !0, referer: document.referrer, offerURL: "", displayMode: "modal", containerSelector: "", onCheckoutSuccess: function () { }, onMeterExpired: function () { }, onMeterError: function () { }, onAccessGranted: function () { }, onMeterActive: function () { }, onMeterInactive: function () { }, meterSelector: function () { } }; return { name: "meter", init: function (e) { if (void 0 !== e)
            if (void 0 !== e.paywallID || void 0 !== e.paywallId) {
                for (var t in void 0 === e.paywallId && (e.paywallId = e.paywallID), e)
                    u[t] = e[t];
                u.referer = document.referrer, n.debug("Initializing paywall: " + u.paywallId), l();
            }
            else
                n.error("Must specify paywallId to load Piano paywall");
        else
            n.error("Must specify paywall configuration to load Piano paywall"); }, isExpired: function () { return i.state && "ex" === i.state; }, isExpiredNextClick: function () { return void 0 !== i.views_left && 0 === i.views_left; }, checkMeter: function (e) { u.trackPageview = !0, l(e); }, showCurtain: s, last: function () { return i; }, registerCallback: function (e, n) { o.addEvent(e), o.registerCallback(e, n); } }; }();
    pn.container.register("meter", { useValue: Xe }), pn.meter = pn.container.resolve("meter");
    var $e = function () { var e = pn.container.resolve("util"), n = pn.container.resolve("sha1"), t = "", r = function () { var e = ""; return ["ShockwaveFlash.ShockwaveFlash.6", "ShockwaveFlash.ShockwaveFlash.7", "SWCt1.SWCt1.9", "SWCtl.SWCtl", "Adobe.SVGCtl", "WMPlayer.OCX", "AgControl.AgControl", "AcroPDF.PDF", "PDF.PdfCtrl", "RealPlayer.RealPlayer(tm) ActiveX Control (32-bit)", "RealPlayer", "Skype.Detection", "3dmlw.IEPlugin", "GoogleTalk.Plugin", "GoogleTalk.Plugin.1"].map((function (n) { try {
        new window.ActiveXObject(n), e += n + "|";
    }
    catch (e) { } })), e; }, o = function () { if (t)
        return t; var o = function () { try {
        var e;
        return e = window.navigator.userLanguage || window.navigator.language, (new Date).getTimezoneOffset() + ":" + e;
    }
    catch (e) {
        return "";
    } }(); return o += function () { if (window.ActiveXObject)
        return r(); try {
        var e = "", n = navigator.plugins.length;
        if (n > 0)
            for (var t = 0; t < n; t++)
                e += navigator.plugins[t].name + "|";
        return e;
    }
    catch (e) {
        return "";
    } }(), o += function () { try {
        return screen.height + "x" + screen.width + "+" + screen.colorDepth;
    }
    catch (e) {
        return "";
    } }(), o += navigator.userAgent, o += function () { var e = ""; try {
        e += document.getElementById ? 1 : 0, e += window.getComputedStyle ? 1 : 0, e += screen.globalStorage ? 1 : 0, e += window.localStorage ? 1 : 0, e += window.sessionStorage ? 1 : 0, e += document.getElementsByClassName ? 1 : 0, e += document.querySelector ? 1 : 0, e += document.all ? 1 : 0, e += window.attachEvent ? 1 : 0, e += window.createPopup ? 1 : 0, e += window.XMLHttpRequest ? 1 : 0, e += window.ActiveXObject ? 1 : 0, e += window.XDomainRequest ? 1 : 0, e += window.msPerformance ? 1 : 0, e += document.documentMode ? 1 : 0, e += navigator.cpuClass ? 1 : 0, e += navigator.browserLanguage ? 1 : 0, e += window.opera ? 1 : 0, e += window.chrome ? 1 : 0;
    }
    catch (e) { } return e; }(), t = n.hash(o), e.debug("Current browser fingerprint is: " + t), t; }; return o(), { name: "fingerprint", getFingerprint: o }; }();
    pn.container.register("fingerprint", { useValue: $e }), pn.fingerprint = pn.container.resolve("fingerprint");
    var Ye = function () { var e, n = pn.container.resolve("jqUtils"), t = 0, r = 0, o = 200, i = 0, a = []; n.on(window, "scroll", (function () { c(); })); var s = function () { var e = n.scrollTop(); e > i && (i = e); }, c = function () { s(), u(); }, l = function (e) { if (e.consumeEventFn())
        return "pixels" === e.measureType ? e.position <= i : "percentage" === e.measureType ? i / (t - n.winSize().height) >= e.position / 100 : void 0; }, u = function () { for (var e, n = [], t = [], r = 0; r < a.length; r++)
        e = a[r], l(e) ? n.push(e) : t.push(e); a = t; for (r = 0; r < n.length; r++)
        n[r].callback(); }; return { name: "scrollDepth", initialize: function (i) { var a = document; i && i > 0 && (o = i || o); var s = function () { var i = a.body || {}, c = a.documentElement || {}, l = Math.max(i.scrollHeight, c.scrollHeight, i.offsetHeight, c.offsetHeight, i.clientHeight, c.clientHeight); l > t && (t = l); var u = n.scrollTop() + n.winSize().height; u > r && (r = u) > t && (t = r), e && clearTimeout(e), e = setTimeout(s, o); }; s(); }, getMaxScrollDepth: function () { return r; }, getMaxDocumentHeight: function () { return t; }, addListener: function (e, n, t) { "function" != typeof t && (t = function () { return !0; }), a.push({ callback: e, position: n.scrollDepth, measureType: n.measureType, repeat: "once", consumeEventFn: t }), s(), u(); }, removeListeners: function () { a = []; }, clearMaxScrolledPosition: function () { i = 0; } }; }();
    pn.container.register("scrollDepth", { useValue: Ye }), pn.scrollDepth = pn.container.resolve("scrollDepth");
    var Ke = function () { var e, n = pn.container.resolve("util"), t = pn.container.resolve("jqUtils"), r = !1, o = []; function i() { r || (r = !0, t.on(document, "mousemove", (function () { return s(); })), t.on(document, "keypress", (function () { return s(); })), t.on(window, "scroll", (function () { return s(); }))); } function a() { o.length && function () { for (var e, t, r = [], i = [], a = Date.now(), s = 0; s < o.length; s++)
        t = !1, a - (e = o[s]).startTime >= e.idleTime && (e.consumeEventFn() ? t = !0 : e.startTime = a), t ? r.push(e) : i.push(e); r.length && n.debug("idle: run fire"); o = i; for (s = 0; s < r.length; s++)
        (e = r[s]).callback(); }(), e && clearTimeout(e), o.length && (e = setTimeout((function () { return a(); }), 200)); } function s() { for (var n = Date.now(), t = 0; t < o.length; t++)
        o[t].startTime = n; clearTimeout(e), o.length && (e = setTimeout((function () { return a(); }), 200)); } return { name: "idle", initialize: i, addListener: function (n, t, r) { i(), "function" != typeof r && (r = function () { return !0; }), o.push({ callback: n, idleTime: 1e3 * t, startTime: Date.now(), consumeEventFn: r }), e || (e = setTimeout((function () { return a(); }), 200)); }, removeListeners: function () { o = []; } }; }();
    pn.container.register("idle", { useValue: Ke }), pn.idle = pn.container.resolve("idle");
    var Ze = function () { var e = pn.container.resolve("util"), n = pn.container.resolve("jqUtils"), t = []; return { name: "interaction", bind: function (r, o, i) { var a = function (e) { for (var n = { click: "click", doubleClick: "dblclick", rightClick: "contextmenu", mouseOut: "mouseout", mouseIn: "mouseover" }, t = [], r = 0; r < e.length; r++) {
            var o = e[r];
            t.push(n[o]);
        } return t; }; "function" != typeof i && (i = function () { return !0; }), e.__protected__.documentReady((function () { for (var e = 0; e < o.length; e++) {
            var s = o[e], c = a(s.elementActions).join(" "), l = s.elementSelector, u = s.repetitive;
            c.trim().length && function (e, o, a) { var s = function () { i() && (a || n.undelegate(document.body, e), r()); }; n.delegate(document.body, e, o, s), t.push({ action: c, selector: l, func: s }); }(l, c, u);
        } })); }, unbindAll: function () { t.forEach((function (e) { n.undelegate(document.body, e.selector); })), t = []; } }; }();
    pn.container.register("interaction", { useValue: Ze }), pn.interaction = pn.container.resolve("interaction");
    var en = function () { var e = pn.container.resolve("jqUtils"), n = pn.container.resolve("util"), t = pn.container.resolve("containerUtils"), r = function (e) { return "inline" === e.displayMode; }, o = function (e) { return "modal" === e.displayMode; }; return { name: "recWidgetService", __protected__: { getInstance: function () { var i, a = []; function s(n) { var s = n || {}, c = s.widget || {}; r(c.config) ? e.empty(c.container) : o(c.config) && (!function (n) { if (!i)
                return; t.closeModal(i), e.empty(i.container); var r = t.__private__.mobileModalFix; r.isIphoneCaretFixed && r.modalClosed(); i = null; }(), e.remove(c.container)), !s.skipOnclose && e.isFunction(c.onclose) && c.onclose(), a = a.filter((function (e) { return e.uuid !== c.uuid; })); } function c(e) { return a.filter((function (n) { return e === n.widgetId; }))[0]; } return { showRecommendation: function (l) { var u = l.widgetConfig || {}, d = l.createPlaceholderFn, p = u.widgetId; if (!p)
                    throw new Error("widgetId should be specified"); if (c(p))
                    n.log("widget with id " + u.widgetId + " already initialize");
                else if (o(u) && i)
                    n.log("modal widget already shown");
                else {
                    var f = function (t) { var r = e.queryEl(t.containerSelector), o = "widget-id-" + n.randomString(), i = { singleContainer: r || void 0, displayMode: t.displayMode || "modal", showCloseButton: t.showCloseButton, iframeParams: { iframeId: o, containerSelector: t.containerSelector, width: t.width, height: t.height } }; return { uuid: o, widgetId: t.widgetId, placeholder: t.placeholder, trackingId: t.trackingId, config: i }; }(u), m = f.config, g = d();
                    if (f.container = function (e, n) { var i; return r(e) ? i = t.initInlineContainer(e).container : o(e) && (i = t.getModalContainer(e, (function () { n instanceof Function && n(); }))), i; }(m, (function () { s({ widget: f }); })), f.container)
                        return e.append(f.container, g), f.element = g, o(m) && (i = f, (n.isIphone() || n.isSafariOrIOsUiWebView() || n.isAndroid()) && t.__private__.mobileModalFix.modalOpened()), function (n, t) { void 0 === t && (t = {}), Object.keys(t).forEach((function (r) { e.isFunction(t[r]) && (n[r] = t[r](n)); })); }(f, l.widgetCallbacks), a.push(f), f;
                    n.log('widget has invalid selector "' + m.iframeParams.containerSelector + '"');
                } }, fireWidgetCallback: function (n, t, r) { a.forEach((function (o) { if (o.widgetId === t.toString()) {
                    var i = o["on" + n];
                    e.isFunction(i) && i(r);
                } })); }, findWidget: c, clearWidgets: function () { a = [], i = null; }, closeWidget: s, fixWidgetModalWidth: function (n, r) { if (!n || o(n.config)) {
                    var i = n.container, a = r ? e.queryEl("iframe", i) : e.queryEl(".tp-widget-placeholder", i);
                    t.checkBackdropAndContainer(n, !0, !0), setTimeout((function () { a && t.__protected__.setElementSizes(i, { width: e.getWidth(a) }); }), 100);
                } } }; }, insertWidgetLib: function (n) { var t = document.getElementsByTagName("script")[0], r = document.createElement("script"); n.id && r.setAttribute("id", n.id), e.isFunction(n.onerror) && (r.onerror = n.onerror), e.isFunction(n.onload) && (r.onload = n.onload), n.defer && (r.defer = !0), r.type = "text/javascript", r.src = n.src, t && t.parentNode && t.parentNode.insertBefore(r, t); } } }; }();
    pn.container.register("recWidgetService", { useValue: en }), pn.recWidgetService = pn.container.resolve("recWidgetService");
    var nn = function () { pn.container.resolve("predefinedOptions"); return { testPianoOption: "" }; }();
    pn.container.register("piano", { useValue: nn });
    var tn = pn.container.resolve("piano");
    for (var rn in tn)
        pn[rn] = tn[rn];
    var on = function (e) { void 0 === e && (e = pn.container); var n = e.resolve("util"), t = e.resolve("log"), r = e.resolve("user"); e.resolve("api"); var o, i = e.resolve("jqUtils"), a = e.resolve("recWidgetService"), s = "__pnml", c = "EXTERNAL_EVENT", l = { granted: "ALLOWED", default: "UNKNOWN", denied: "FORBIDDEN" }, u = a.__protected__.getInstance(); function d() { return o || (o = new Promise((function (e, t) { var r = window.PianoESPConfig || {}; r.id ? (Object.assign(r, { onload: function () { return e(null); }, widget_init_on_event: { rec: !0, "opt-in": !1 }, onclick: function (e) { u.fireWidgetCallback("click", e.widgetId, e); }, onwidgetinit: function (e) { u.fireWidgetCallback("init", e.widgetId, e); }, onrecsloaded: function (e) { u.fireWidgetCallback("recsloaded", e.widgetId, e); } }), window.PianoESPConfig = r, n.debug("pianoESP: loading PianoESP with config:", window.PianoESPConfig), a.__protected__.insertWidgetLib({ id: "pnesplucidsdksel", src: p() + "/public/sdk/v04/sdk.js?v=" + (localStorage && localStorage.lucidsdkver || "xxx"), onerror: function () { return t(); } })) : t(); }))); } setTimeout((function () { pn.addHandler("logout", (function () { m([]); })); var e = r.getProvider(); e.registerCallback && e.registerCallback("logout", (function () { m([]); })); }), 300); var p = function () { var e = "//api-esp.piano.io"; return pn.espEndpoint ? e = pn.espEndpoint : pn.isSandbox() && (e = "//sandbox-api-esp.piano.io"), e; }, f = function (e, r) { d().then((function () { window.PianoESP.getCurrentPushState().then((function (e) { "prompt" === e && t.logMicroConversion(r, "showPrompt"); })), window.PianoESP.subscribeToPushSquads([e]).then((function (o) { var i = o || {}; !0 === i.result ? (n.setPushListsCookie(e), n.debug("pianoESP: Push notification was set:", i), t.logMicroConversion(r, "enrollPushCampaign")) : !1 === i.result && ("closed" === i.reason ? t.logMicroConversion(r, "closePrompt") : t.logMicroConversion(r, "declineEnrollPushCampaign")); })).catch((function (e) { n.log("pianoESP: Push notification error:", e); })); })); }, m = function (e) { try {
        var t = JSON.stringify(e);
        localStorage.setItem(s, t);
    }
    catch (e) {
        n.debug("can't save mailing lists to storage", e);
    } }, g = function () { var e = []; try {
        var t = localStorage.getItem(s);
        if (!t)
            throw new Error("MAINLING_LIST should be array");
        if (e = JSON.parse(t), !Array.isArray(e))
            throw new Error("MAINLING_LIST should be array");
    }
    catch (e) {
        n.debug("can't load mailing lists from storage", e);
    } return e || []; }; var v = function (e) { return function () { var n = document.createElement("pnespwgtplaceholder"); return i.setAttr("holdername", e, n), n; }; }; function h() { return { onrecsloaded: function (e) { return function (r) { 0 !== r.countOfRecs ? (u.fixWidgetModalWidth(e, !0), t.logEspMicroConversion(e.trackingId, e.widgetId, "init", c), n.debug("creating recommendation widget: ", e.config)) : u.closeWidget({ widget: e, skipOnclose: !0 }); }; }, onclick: function (e) { return function (n) { var r = { href: n.url }; t.logEspMicroConversion(e.trackingId, e.widgetId, "click", "EXTERNAL_LINK", r); }; }, onclose: function (e) { return function () { t.logEspMicroConversion(e.trackingId, e.widgetId, "close", c, { event: "widgetClosed" }); }; } }; } return { name: "pianoEsp", __protected__: { init: d, setVisitorId: function (e) { window.PianoESPConfig = Object.assign({}, window.PianoESPConfig, { visitor: e }); }, showRecommendation: function (e) { var n = h(); return u.showRecommendation({ widgetConfig: e, widgetCallbacks: n, createPlaceholderFn: v(e.placeholder) }), d().then((function () { window.PianoESP.initWidget(parseInt(e.widgetId)); })); }, showPushSignup: function (e) { var n = e || {}; n.templateId ? (t.__protected__.logCustomFormImpression(n.trackingId, "pushSignup", "show_form"), pn.template.show({ templateId: n.templateId, templateVariantId: n.templateVariantId, displayMode: "modal", customEvent: function (e) { switch (e.eventName) {
                    case "push-allow":
                        t.logMicroConversion(n.trackingId, "allowSoftEnrollPushCampaign"), f(n.pushListId, n.trackingId);
                        break;
                    case "push-dont-allow":
                        t.logMicroConversion(n.trackingId, "declineSoftEnrollPushCampaign");
                        break;
                    case "push-close": t.logMicroConversion(n.trackingId, "close");
                } } })) : f(n.pushListId, n.trackingId); }, getNotificationStatus: function () { if (window.Notification)
                return l[window.Notification.permission] || l.default; }, showNewsletterSignup: function (e) { if (e && e.mailingListIds) {
                var t = g().indexOf(e.mailingListIds) > -1;
                e.notShowIfFilled && t ? n.log("Mailing list with ids " + e.mailingListIds + " already shown") : pn.template.show(e);
            }
            else
                n.log("mailingListIds should be specified"); }, offerMessageReceiver: function (e) { if ("newsletterSignupSubmission" === e.event) {
                var n = g();
                -1 === n.indexOf(e.params.mailingListIds) && (n.push(e.params.mailingListIds), m(n));
            } }, loadCompleteMailingLists: g }, __private__: { removeWidgetsAndSdk: function () { u.clearWidgets(), o = null, delete window.PianoESP; }, getWidgetCallbacks: h, onInit: function (e) { o && "function" == typeof e && o.then(e); } } }; };
    pn.container.register("pianoEsp", { useValue: on() }), pn.pianoEsp = pn.container.resolve("pianoEsp");
    var an = function () { var e, n = pn.container.resolve("postmessage"), t = pn.container.resolve("user"), r = pn.container.resolve("util"), o = pn.container.resolve("eventUtils"), i = "externalCheckoutComplete", a = "loginPrompt", s = "deferredAccountCreation", c = "buy", l = o.createEventManager([i]), u = !1, d = !1; window.SWG = window.SWG || [], window.SWG.push((function (n) { n.setOnPaymentResponse((function (n) { d || (r.debug("swg: onPaymentResponse is triggered"), d = !0, n.then((function (n) { r.debug("swg: onPaymentResponse", n), e && g(n, n.purchaseData, n.userData, e, c); })).catch((function (e) { r.log("swg: onPaymentResponse failed", e); }))); })); })), n.subscribe("swgCheckoutStart", (function (n) { u || r.log("swg: incorrect SwG configuration. Please make sure that Experience user segment is configured properly. Details at https://docs.piano.io/subscribe-with-google/#SwGscript"); var t = n.params.sku; e = n.params.termId, window.SWG.push((function (e) { e.subscribe(t); })); })); var p = function (e) { if (l.hasCallback(i)) {
        var n = { type: "swg", flow: e };
        l.fireCallbacks(i, n, void 0, !0);
    } }, f = function (e) { return new Promise((function (n, t) { pn.api.callApi("/swg/check", { entitlement: JSON.stringify(e) }, (function (e) { 0 !== e.code && (r.log("swg: check subscription response - " + e.message), t()), n(e.CheckSubscriptionResponse); })); })); }, m = function (e) { return new Promise((function (n, t) { pn.api.callApi("/swg/check/external", { entitlements: JSON.stringify(e) }, (function (e) { 0 !== e.code && (r.log("swg: check external entitlement response - " + e.message), t()); var o = e.data; o || (r.log("swg: check external entitlement empty response"), t()), n(o); })); })); }, g = function (e, t, o, i, a) { pn.api.callApi("/swg/subscribe", { term_id: i, purchase_data: JSON.stringify(t), user_data: JSON.stringify(o) }, (function (t) { if (0 === t.code) {
        var o = t.data;
        v(o), n.broadcast("swgCheckoutComplete"), e.complete().then((function () { p(a); })).catch((function (e) { r.log("swg: complete failed:", e); }));
    }
    else
        r.log("swg: subscribe response - " + t.message); })); }, v = function (e) { e && t.getProvider().loginByToken && t.getProvider().loginByToken(e); }, h = !1, w = !1; return { name: "swg", __protected__: { injectMarkup: function (e) { var n; if (!h && e) {
                r.debug("swg: rendering swg markup with config:", e);
                var t = '{\n   "@context": "http://schema.org",\n   "@type": "CreativeWork",\n   "isAccessibleForFree": ' + e.isAccessibleForFree;
                !1 === e.isAccessibleForFree && e.productId && (t = t + ',\n   "isPartOf": {\n       "@type": ["CreativeWork", "Product"],\n       "name" : "' + e.resourceName + '",\n       "productID": "' + e.productId + '"\n   }'), t += "\n}";
                var o = document.createElement("script");
                o.type = "application/ld+json", o.innerHTML = t, null === (n = document.getElementsByTagName("script")[0].parentNode) || void 0 === n || n.appendChild(o), h = !0;
            } }, addLibrary: function () { var e; if (!w) {
                r.debug("swg: adding swg.js library");
                var n = document.createElement("script");
                n.type = "text/javascript", n.setAttribute("subscriptions-control", "manual"), n.async = !0, n.src = "https://news.google.com/swg/js/v1/swg.js", null === (e = document.getElementsByTagName("script")[0].parentNode) || void 0 === e || e.appendChild(n), w = !0;
            } }, initSwgFlow: function () { window.SWG.push((function (e) { e.getEntitlements().then((function (n) { if (u = !0, r.debug("swg: getEntitlements", n), n.enablesThis()) {
                var o = n.getEntitlementForSource("google");
                if (!o) {
                    var i = n.entitlements;
                    return void (i && m(i).then((function () { r.debug("swg: checkExternalEntitlement"), n.ack(); }), (function () { r.log("swg: checkExternalEntitlement failed"); })));
                }
                f(o).then((function (o) { if (d)
                    r.debug("swg: onPaymentResponse is already triggered. Skipping entitlements flow.");
                else if (o)
                    switch (o.type) {
                        case "USER_FOUND":
                            if (t.isUserValid())
                                return void r.error("swg: user found, but not valid");
                            r.debug("swg: user found, initiate login prompt");
                            var i = o.user_token;
                            e.showLoginPrompt().then((function () { v(i), p(a); })).catch((function (e) { r.log("swg: showLoginPrompt failed", e); }));
                            break;
                        case "TERM_FOUND":
                            r.debug("swg: term found, initiate deferred account creation");
                            var c = o.term_id;
                            e.completeDeferredAccountCreation({ entitlements: n, consent: !0 }).then((function (e) { r.debug("swg: completeDeferredAccountCreation", e), g(e, e.purchaseData, e.userData, c, s); })).catch((function (e) { r.log("swg: completeDeferredAccountCreation failed", e); }));
                            break;
                        default: r.debug("swg: check subscription response type " + o.type + ". Nothing to do");
                    } }), (function () { r.log("swg: checkSubscription failed"); })), n.ack();
            } })).catch((function (e) { r.log("swg: get entitlements failed", e); })); })); } }, registerCallback: function (e, n) { l.addEvent(e), l.registerCallback(e, n); } }; }();
    pn.container.register("swg", { useValue: an }), pn.swg = pn.container.resolve("swg");
    var sn = function () { var e = pn.container.resolve("util"), n = !1, t = function (t, r, o) { n ? (o || (o = {}), e.log("fbpixel: Track Facebook Pixel event", r, o), window.fbq(t, r, o)) : e.log("fbpixel: Skip tracking event - Facebook Pixel is not initalized", r, o); }, r = function () { return n; }; return { name: "fbpixel", isInitialized: r, __private__: { isInitialized: r }, __protected__: { init: function () { if (!n) {
                var t, r, o, i, a, s, c = pn.getFbPixelId();
                if (c)
                    e.log("fbpixel: Initialize Facebook Pixel tracking", c), t = window, r = document, o = "script", t.fbq || (i = t.fbq = function () { i.callMethod ? i.callMethod.apply(i, arguments) : i.queue.push(arguments); }, t._fbq || (t._fbq = i), i.push = i, i.loaded = !0, i.version = "2.0", i.queue = [], (a = r.createElement(o)).async = !0, a.src = "https://connect.facebook.net/en_US/fbevents.js", (s = r.getElementsByTagName(o)[0]).parentNode.insertBefore(a, s)), window.fbq("set", "autoConfig", "false", c), window.fbq("init", c), n = !0;
                else
                    e.error("fbpixel: Facebook Pixel ID is not defined");
            } } }, trackEvent: function (e, n) { t("track", e, n); }, trackCustomEvent: function (e, n) { t("trackCustom", e, n); } }; }();
    pn.container.register("fbpixel", { useValue: sn }), pn.fbpixel = pn.container.resolve("fbpixel");
    var cn = function () { var e = pn.container.resolve("util"), n = pn.container.resolve("fbpixel"), t = pn.container.resolve("offer"), r = pn.container.resolve("user"), o = pn.container.resolve("api"), i = !1, a = "", s = {}, c = {}; function l(n) { return new Promise((function (t) { var i = { aid: pn.aid, rid: "", account_linking_token: e.getQueryParamByName("account_linking_token"), user_token: r.getProvider().getToken(), user_provider: r.getProvider().getName() }; n && (i.rid = n), o.callApi("/fbia/subscriptionPayload/generate", i, (function (e) { e && e.data && (a = e.data), t(null); })); })); } var u = function () { l().then((function () { a && p(); })); }, d = function (n) { if (n) {
        var t = new Promise((function (e) { setTimeout((function () { e(null); }), 1e3 * pn.redirectToFbTimeout); })), r = l(n);
        e.__protected__.waitAllPromises([t, r]).then((function () { p(); }));
    }
    else
        e.error("fbsubscriptions: 'rid' could not be empty on generating subscription payload"); }, p = function () { var n = e.getQueryParamByName("account_linking_token"), t = e.getQueryParamByName("redirect_uri") + "?account_linking_token=" + encodeURIComponent(n); a && (t += "&subscription_payload=" + encodeURIComponent(a)), window.location.href = t; }, f = function (e, t) { s[e] || (s[e] = !0, n.trackEvent(e, t)); }, m = function (e, t) { c[e] || (c[e] = !0, n.trackCustomEvent(e, t)); }, g = function () { return i; }; return { name: "fbsubscriptions", checkUserAccessAndRedirectToFb: function () { l().then((function () { p(); })); }, isInitialized: g, __private__: { isInitialized: g }, __protected__: { init: function () { if (!i) {
                n.__protected__.init(), t.registerCallback("loaded", (function () { var n = e.getQueryParamByName("surface"); "meter_limit_reached" !== n && "locked_article" !== n || pn.inappBrowserReturn || m("ViewPaywall", { surface: "IA" }); }));
                pn.addHandler("loginSuccess", (function (e) { l().then((function () { e.registration ? m("CreateAccount") : m("LogIntoAccount", { is_subscriber: !!a }), a && setTimeout((function () { p(); }), 200); })); })), pn.addHandler("experienceExecute", (function () { r.isUserValid() && u(); })), t.registerCallback("alreadyPurchased", (function (e) { d(e.rid); })), t.registerCallback("startCheckout", (function (e) { f("InitiateCheckout", { offer_code: e.offerId, campaign_code: e.termId }); })), t.registerCallback("complete", (function (e) { e.hasOwnProperty("chargeCurrency") && e.hasOwnProperty("chargeAmount") && f("Purchase", { currency: e.chargeCurrency, value: e.chargeAmount, offer_code: e.offerId, campaign_code: e.termId }), d(e.rid); })), t.registerCallback("close", (function () { p(); })), i = !0;
            } } } }; }();
    pn.container.register("fbsubscriptions", { useValue: cn }), pn.fbsubscriptions = pn.container.resolve("fbsubscriptions");
    var ln = function (e) { void 0 === e && (e = pn.container); var n = e.resolve("jqUtils"), t = e.resolve("util"), r = e.resolve("recWidgetService").__protected__.getInstance(), o = [], i = function () { return void 0 !== pn.cxCdnUrl && "" !== pn.cxCdnUrl ? pn.cxCdnUrl : "https://cdn.cxense.com"; }, a = function () { return void 0 !== pn.cxenseSiteId && "" !== pn.cxenseSiteId; }, s = function (e) { return void 0 !== window.cX && void 0 !== window.cX.library && (e || void 0 !== window.cX.CCE && void 0 !== window.cX.CCE.library); }, c = function (e) { return void 0 !== e.cxenseCustomerPrefix && "" !== e.cxenseCustomerPrefix; }, l = function (e) { var n, r, o = window.cX = window.cX || {}; o.callQueue = o.callQueue || []; var i = "anon"; e.uid && "anon" !== e.uid && "" !== e.uid && (i = !!(null === (r = null === (n = e.eventExecutionContext) || void 0 === n ? void 0 : n.accessList) || void 0 === r ? void 0 : r.length) ? "hasActiveAccess" : "registered", o.callQueue.push(["addExternalId", { id: e.uid, type: e.cxenseCustomerPrefix }]), t.debug("c1x: adding externalId", { uid: e.uid, prefix: e.cxenseCustomerPrefix })); o.callQueue.push(["setCustomParameters", { userState: i }]), t.debug("c1x: adding CustomParameters userState", { userState: i }), d(!1, e.browserId, e.pageViewId, pn.cxenseSiteId), t.debug("c1x: sending pageview event"), o.callQueue.push(["sendPageViewEvent"]); }, u = function (e, n, t, r) { t && (!0 === r ? e.callQueue.unshift([n, t]) : e.callQueue.push([n, t])); }, d = function (e, n, r, o) { var i = window.cX = window.cX || {}; i.callQueue = i.callQueue || [], u(i, "setSiteId", o, e), n && u(i, "invoke", (function () { window.cXNative = { getUserId: function () { return n; } }; }), e), u(i, "setRandomId", r, e), t.debug("c1x: injecting ids", { browserId: n, pageViewId: r, siteId: o }); }, p = function (e) { var n = null, t = []; function r() { n && clearTimeout(n), n = null, e(t), t = []; } return function (e) { n || (n = setTimeout(r, 10)), t.push(e); }; }((function (e) { if (a()) {
        for (var n = [], i = function () { var t = e[s] || {}; r.showRecommendation({ widgetConfig: t, createPlaceholderFn: f(t.widgetId, t.displayMode) }) && n.push({ widgetParams: { widgetId: t.widgetId, targetElementId: "cxense-" + t.widgetId, experienceId: t.experienceId }, widgetCallback: function (e) { var n = e && e.response; if (n && !e.response.error) {
                "modal" === t.displayMode && r.fixWidgetModalWidth(r.findWidget(t.widgetId));
                for (var i = 0; i < n.items.length; i++) {
                    var a = n.items[i].id;
                    -1 === o.indexOf(a) && o.push(a);
                }
            } } }); }, s = 0; s < e.length; s++)
            i();
        m((function () { var e; e = pn.cxenseSiteId, t.debug("c1x: setting siteId: ", e), window.cX.setSiteId(e), window.cX.CCE.runMulti(n, ["id"], o); }));
    }
    else
        t.debug("c1x: can not show recommendation because siteId is not configured using `setCxenseSiteId`"); })), f = function (e, t) { return function () { var r = document.createElement("div"); n.addClass("tp-cxense-placeholder-" + t, r), n.addClass("tp-widget-placeholder", r); var o = document.createElement("div"); return o.id = "cxense-" + e, r.appendChild(o), r; }; }, m = function (e) { window.cX = window.cX || {}, window.cX.CCE = window.cX.CCE || {}, window.cX.CCE.callQueue = window.cX.CCE.callQueue || [], window.cX.CCE.callQueue.push(["invoke", e]); }, g = function (e) { return s(e); }; return { name: "cxense", __protected__: { showRecommendation: p, sendPageViewEvent: function (e) { (a() || c(e)) && (a() || !c(e) ? !a() || c(e) ? l(e) : t.debug("cxense: can not send pageview because customer prefix is not configured in app settings") : t.debug("cxense: can not send pageview because siteId is not configured using `setCxenseSiteId`")); }, isActivated: a, isCustomerPrefixConfigured: c, isConfiguredPollingAsync: function (e, n, t) { n = n || 0, t = t || 0; var r = 0; return new Promise((function (o, i) { var a = function () { g(e) ? o(!0) : r >= t ? i(e ? "c1x: cX object is not found after " + t + " retries with " + n + "ms interval" : "c1x: cX and cX.CCE objects are not found after " + t + " retries with " + n + "ms interval") : (r++, setTimeout(a, n)); }; g(e) ? o(!0) : setTimeout(a, n); })); }, invokeCxenseFn: m, getC1XIntegrationVersion: function () { return void 0 !== pn.c1XIntegrationVersion && "" !== pn.cxenseSiteId ? pn.c1XIntegrationVersion : "N/A"; }, getOrGenerateCxCompatibleBid: function () { var e = t.__protected__.getCookie("cX_P"), n = null; try {
                t.__protected__.hasLocalStorage() && (n = localStorage.getItem("_cX_P"));
            }
            catch (e) { } var r = e || n; return r ? (t.debug("c1x: existing cX_P value has been found: ", r), r) : (t.debug("c1x: can not find existing cX_P value, generating a new one"), t.__protected__.randomStringCxCompatible()); }, loadCxLibIfNeeded: function () { var e; if (!a() || !s(!0)) {
                var n = document.getElementsByTagName("script")[0], r = document.createElement("script");
                r.onerror = function (e) { t.debug("c1x: error during load of cx.js. ", e); }, r.onload = function () { t.debug("c1x: cx.js has been successfully loaded"); }, r.async = !0, r.type = "text/javascript", pn.c1XLoadCce ? r.src = i() + "/cx.cce.js" : r.src = i() + "/cx.js", t.debug("c1x: start loading cx.js on the page..."), null === (e = n.parentNode) || void 0 === e || e.insertBefore(r, n);
            } }, setCxBidCookie: function (e, n) { var r; r = { path: "/", expires: 730 }, n && (r.domain = n, t.__protected__.deleteTLDCookieForSpecificDomains("cX_P", n)), t.deleteCookie("cX_P"), t.__protected__.setCookie("cX_P", e, r); }, tryToGetCxPageViewId: function (e) { var n, t, r = window.cX; return (null === (t = null === (n = null == r ? void 0 : r.getPageContext) || void 0 === n ? void 0 : n.call(r)) || void 0 === t ? void 0 : t.pageViewRandom) || e; }, injectIds: d } }; };
    pn.container.register("cxense", { useValue: ln() }), pn.cxense = pn.container.resolve("cxense");
    var un = function (e) { void 0 === e && (e = pn.container); var n, t, r = e.resolve("jqUtils"), o = e.resolve("util"), i = e.resolve("api"), a = e.resolve("eventUtils"), s = e.resolve("scrollDepth"), c = e.resolve("log"), l = e.resolve("ajax"), u = e.resolve("viewportExit"), d = e.resolve("idle"), p = e.resolve("interaction"), f = e.resolve("pianoEsp"), m = e.resolve("swg"), g = e.resolve("fbsubscriptions"), v = e.resolve("user"), h = e.resolve("cxense"), w = e.resolve("logging"), y = [], b = {}, k = "", _ = !1, C = "reader_id", I = !1, S = {}, x = (n = { applyCss: { fn: function (e) { e.eventParams.ruleList.forEach((function (e) { var n, t = e.classes, i = e.elements; t && (t = t.replace(/[,.]/g, " ").split(" ").filter((function (e) { return "" !== e; })), "add" === e.type && (n = r.qa(i)) && n.length && n.forEach((function (e) { t.forEach((function (n) { r.addClass(n, e); })); })), "remove" === e.type && (n = r.qa(i)) && n.length && n.forEach((function (e) { t.forEach((function (n) { r.removeClass(n, e); })); }))); o.debug("exp: css applied with rule:", e); })); }, isAction: !0, shouldFireCallback: !0 }, runJs: { fn: function (e) { if (e.eventParams && e.eventParams.snippet) {
                var n = e.eventParams.snippet;
                o.debug("exp: run js with snippet:", n);
                var t = e.eventExecutionContext;
                o.debug("exp: set publisher's context and custom:", t), fe("var context = " + JSON.stringify(t) + ";\nvar custom = " + JSON.stringify(pn.customVariables) + ";\n" + n);
            } }, isAction: !0, shouldFireCallback: !0 }, setCookie: { fn: function (e) { var n = e.eventParams; if (n && void 0 !== n.cookieName && void 0 !== n.cookieValue) {
                o.debug("exp: set cookie with parameters:", n);
                var t = (n.isReadableCookie ? "_pc_" : "") + n.cookieName, r = { domain: n.cookieDomain, path: n.cookiePath };
                if (!n.isSessionCookie) {
                    var i = new Date;
                    switch (n.expirationUnit) {
                        case "seconds":
                            i.setSeconds(i.getSeconds() + n.expirationValue);
                            break;
                        case "minutes":
                            i.setMinutes(i.getMinutes() + n.expirationValue);
                            break;
                        case "hours":
                            i.setHours(i.getHours() + n.expirationValue);
                            break;
                        case "days":
                            i.setDate(i.getDate() + n.expirationValue);
                            break;
                        case "months":
                            i.setMonth(i.getMonth() + n.expirationValue);
                            break;
                        case "years":
                            i.setFullYear(i.getFullYear() + n.expirationValue);
                            break;
                        default: o.log("Wrong eventParams.expirationUnit : ", n.expirationUnit);
                    }
                    r.expires = i;
                }
                o.__protected__.setCookie(t, n.cookieValue, r);
            } }, isAction: !0, shouldFireCallback: !0 }, nonSite: { fn: function (e) { o.debug("exp: non-site action:", e); }, isAction: !0, shouldFireCallback: !0 }, showForm: { fn: function (e) { var n = e.eventParams; if (n && n.formName) {
                var t = { formName: n.formName, hideIfComplete: n.hideCompletedFields, trackingId: e.eventExecutionContext.trackingId, displayMode: n.displayMode, containerSelector: n.containerSelector, showCloseButton: n.showCloseButton, accessToken: v.getProvider().getToken() };
                n.formWidth && n.formWidth.enabled && (t = r.deepExtend({}, { width: n.formWidth.width }, t)), o.debug("exp: show form with params:", n), pn.pianoId.showForm(t);
            } }, isAction: !0, shouldFireCallback: !0 }, showRecommendations: { fn: function (e) { return me(e, function (e) { return { ESP: f.__protected__.showRecommendation.bind(f), CXENSE: h.__protected__.showRecommendation.bind(h) }[e] || function () { }; }(e.eventParams.type)); }, isAction: !0, shouldFireCallback: !0 }, showOffer: { fn: function (e) { return me(e, (function (e) { return pn.offer.show(e); })); }, isAction: !0, shouldFireCallback: !1 }, showTemplate: { fn: ge, isAction: !0, shouldFireCallback: !1 }, showZuoraOffer: { fn: ge, isAction: !0, shouldFireCallback: !1 }, showNewscycleOffer: { fn: ge, isAction: !0, shouldFireCallback: !1 }, showNewsletterSignup: { fn: function (e) { return me(e, (function (e) { return f.__protected__.showNewsletterSignup(e); })); }, isAction: !0, shouldFireCallback: !1 }, showPushSignUp: { fn: function (e) { return me(e, (function (e) { return f.__protected__.showPushSignup(e); })); }, isAction: !0, shouldFireCallback: !1 }, showLogin: { fn: function () { v.showLogin({}); }, isAction: !0, shouldFireCallback: !0 }, continueExecution: { fn: function (e, n) { o.debug("exp: continue execution action:", e, "with requestParameters", n); var t = n || {}; t.experience_id = e.eventExecutionContext.experienceId, t.experience_version = e.eventExecutionContext.experienceVersion, t.context_data = e.eventParams.contextData, Q("auto", t, !0); }, shouldFireCallback: !0 }, continueExecutionCompleted: { fn: be, shouldFireCallback: !0 }, meterActive: { fn: be, shouldFireCallback: !0 }, meterExpired: { fn: be, shouldFireCallback: !0 }, userSegmentTrue: { fn: pe, shouldFireCallback: !0 }, userSegmentFalse: { fn: pe, shouldFireCallback: !0 }, experienceExecutionFailed: { fn: be, shouldFireCallback: !0 }, log: { fn: function (e) { ee(e.eventModuleParams.moduleId, e); }, shouldFireCallback: !1 }, experienceExecute: { fn: function (e, n, t) { e.eventParams.result = t; }, shouldFireCallback: !0 }, setResponseVariable: { fn: function (e) { return e.eventParams; }, isAction: !0, shouldFireCallback: !0 }, creditRedeemed: { fn: function (e) { o.debug("exp: credit redeemed action:", e); }, isAction: !0, shouldFireCallback: !0 } }, t = {}, Object.keys(n).forEach((function (e) { if ("function" != typeof n[e].fn)
        throw new Error("Unsupported config for " + e + " handler"); t[e] = function (e, n) { return function (t, r, i) { if (e.isAction) {
        var a = function (e) { var n = e.eventParams, t = e.eventModuleParams, r = e.eventExecutionContext; return o.debug("exp: fire event 'beforeComposerAction' with eventParams:", n, ", moduleParams:", t, ", context:", r), B.fireCallbacksAndStopOnFirstFalse("beforeComposerAction", n, t, r); }(t);
        if (!a)
            return;
        var s = re(t), c = te(t);
        (s || c) && ee(t.eventModuleParams.moduleId, t);
    } var l, u = t.eventModuleParams.moduleId; S[u] || "N/A" === u || (S[u] = { experienceId: t.eventExecutionContext.experienceId, moduleName: t.eventModuleParams.moduleName }), e.fn(t, r, i), e.shouldFireCallback && (l = n, function (e) { var n = e.eventParams.callback, t = e.eventParams, r = e.eventModuleParams, i = e.eventExecutionContext; o.debug("exp: fire event ", l, " with eventParams:", t, ", moduleParams:", r, ", context:", i), B.fire("experience", l, !0, t, r, i), n && l !== n && (o.debug("exp: execute event ", l, " with callback: ", n), fe(n)); })(t); }; }(n[e], e); })), t), P = { showOffer: function (e) { return ve(e, (function (e) { return pn.offer.deferredShow(e); })); }, showTemplate: he, showZuoraOffer: he, showNewscycleOffer: he }, E = o.profile((function (e) { Q("manual", e, !1); })), T = function (e, n) { B.addEvent(e), B.registerCallback(e, n); }, A = "xbc", M = {}, O = "", R = "", L = "", N = [], U = "handler", j = "eventCondition", D = "innerEventCondition", F = "preload", B = a.createEventManager([]), V = ["showOffer", "showZuoraOffer", "showNewscycleOffer", "showTemplate"]; var q, z = function () { return y; }, H = function () { y = []; }, W = function () { return pn.getTrackingEndpoint(pn.composerHost) + "/api/v3"; }, J = function () { g.__protected__.init(); }, G = function (e) { var n = z(); n.length && (c.logBeaconRequest(W() + "/composer/logExecutionStats", { aid: pn.aid, items: JSON.stringify(n), execution_stats_context: k, ts: (new Date).getTime(), source: e }), H()), window.clearTimeout(q), q = window.setTimeout((function () { G("timer" + q); }), 2e3); }, Q = function (e, n, t) { void 0 === pn.main.appHasApplePay() && B.fireCallbacks("experienceFlow", null, "experience", !0); var i = new Promise((function (e) { setTimeout((function () { e({}); }), 3e4); })); return Promise.race([pn.main.externalResourcesDelay(), i]).then((function (i) { if (r.isPlainObject(i) || (o.error("exp: error get external resources ", i), i = {}), h.__protected__.isActivated()) {
        o.debug("c1x: integration is activated"), h.__protected__.loadCxLibIfNeeded();
        var a = r.deepExtend({}, n, i, { c1x_integration_version: "v2", new_bid: pn.main.fetchCxBrowserId() });
        X(e, a, t);
    }
    else
        X(e, r.deepExtend({}, n, i), t); })).catch((function (e) { })); }, X = function (e, n, t) { n = n || {}; var a = r.deepExtend({}, { protocol_version: 1 }, n); $(a), Y(a), o.hasQueryParamByName(C) && (a.reader_id = o.getQueryParamByName(C)), o.waitCall("refreshUserToken", (function () { if (t)
        a.executed_nodes = JSON.stringify(S);
    else {
        pn.main.trackPageUnloadIfNecessary(), K(a), i.getCallParams(a, v.getProvider()), o.removeAffiliateToken();
        var n = { url: window.location.href, tags: pn.tags, submitType: e };
        pn.main.buildPageTrackParams(a, n);
    } o.debug("exp: Experience initialized with params:", a), o.waitCall("refreshAccessTokenList", (function () { o.startCall("experienceExecute"); var e, n, i = (o.__protected__.cameFromFbSubscriptions() ? (e = "/xbuilder/experience/executeFbia", J()) : e = "/xbuilder/experience/execute", pn.getExperienceEndpoint(!1) + e); if (-1 !== navigator.appVersion.indexOf("MSIE 9"))
        n = { dataType: "jsonp", url: i + "?" + r.param(a) };
    else {
        var s = "?" + r.param({ aid: a.aid });
        n = { type: "post", url: i + s, data: a, xhrFields: { withCredentials: !0 } };
    } n.success = function (e) { o.doneCall("experienceExecute"); var n = r.deepExtend({}, a); t || (we(), pn.main.registerTrackUnload()), Z(e.errors), de(e.models, n); }, n.error = function () { o.doneCall("experienceExecute"), t || we(); var e = { code: 503, message: "Error: Received error when requesting API response from URL: " + i }; o.debug(e.message); }, l.request(n); })); })); }, $ = function (e) { var n = o.__protected__.getCookie(A); n && (e.xbc = n); var t = o.getTbcCookie(); t && t.length > 0 && (e.tbc = t), o.getCampaigns(e), e.custom_cookies = JSON.stringify(o.getCustomCookies()); }, Y = function (e) { var n = o.getPushListsCookie(), t = f.__protected__.getNotificationStatus(); n && n.length > 0 && (e.push_list_subscriptions = JSON.stringify(n)), t && (e.push_notification_settings = t); }, K = function (e) { return [{ property: "debug", parameter: "debug" }, { property: "trackPageView", parameter: "increment_pageview_meter" }].forEach((function (n) { void 0 !== pn[n.property] && (e[n.parameter] = pn[n.property]); })), e; }, Z = function (e) { Array.isArray(e) && (e.length && o.debug("exp: composer execution has been failed with errors"), e.forEach((function (e) { o.debug("exp: " + e.msg); }))); }, ee = function (e, n) { var t; t = { mId: e, eId: n.eventExecutionContext.experienceId, eV: n.eventExecutionContext.experienceVersion, eeId: n.eventExecutionContext.executionId }, y.push(t); }; function ne(e, n, t, r) { return { type: U, eventType: n.eventType, children: [], run: function () { e.bind(this, n, t, r)(); } }; } var te = function (e) { var n, t = e.eventParams.delayBy || {}; return t.value && ("time" === t.type ? n = { type: "timer", timer: t.value } : "scroll" === t.type && (n = { type: "scrollDepth", scrollDepth: t.value, measureType: "pixels" })), n; }, re = function (e) { return e.eventConditions && Array.isArray(e.eventConditions) ? e.eventConditions.length : 0; }, oe = function (e, n) { return r = !1, { type: F, eventType: n.eventType, children: [], run: function () { !1 === r && (t = e(n), r = !0); }, getPreloadResult: function () { return t; } }; var t, r; }; function ie(e, n) { var t = function () { return B.fireCallbacksAndStopOnFirstFalse("beforeBrowserEvent", e); }; switch (e.type) {
        case "viewportExit":
            u.addListener(n, { detectExitMode: e.detectExitMode, detectBackButtonForMobile: e.detectBackButtonForMobile, clientDevice: e.clientDevice }, t);
            break;
        case "scrollDepth":
            s.addListener(n, { scrollDepth: e.scrollDepth, measureType: e.measureType }, t);
            break;
        case "timer":
            var r = setTimeout((function () { t() && n(); }), 1e3 * e.timer);
            N.push(r);
            break;
        case "interaction":
            p.bind(n, e.interactions, t);
            break;
        case "idle": d.addListener(n, e.idleTime, t);
    } } var ae = function (e) { return e.type === U && -1 === ["continueExecution", "meterActive", "meterExpired"].indexOf(e.eventType); }; function se(e, n) { return t = !1, r = function () { ee(e.moduleId, n); for (var r = b[e.moduleId].children, i = 0; i < r.length; i++) {
        var a = r[i], s = b[a];
        if (!1 === t || ae(s))
            try {
                s.run();
            }
            catch (e) {
                o.error("exp: error execute chain event", s, e);
            }
    } t = !0, _ && G("chain"); }, { type: j, children: [], run: function () { ie(e, r); } }; var t, r; } function ce(e, n) { return t = !1, r = function () { for (var e = b[n + D].children, r = 0; r < e.length; r++) {
        var i = e[r], a = b[i];
        if (!1 === t || ae(a))
            try {
                a.run();
            }
            catch (e) {
                o.error("exp: error execute chain event", a, e);
            }
    } t = !0; }, { type: D, children: [n], run: function () { ie(e, r); } }; var t, r; } var le = function (e) { var n; e.swgMarkupData && (o.debug("exp: swg markup data :", e.swgMarkupData), n = e.swgMarkupData, m.__protected__.injectMarkup(n), e.swgMarkupData.isAccessibleForFree || m.__protected__.addLibrary()), e.swgEnabled && m.__protected__.initSwgFlow(); }, ue = function (e) { if (e) {
        for (var n = {}, t = 0; t < e.events.length; t++) {
            var i = e.events[t];
            try {
                "experienceExecute" === i.eventType && ((n = r.deepExtend({}, i.eventExecutionContext)).result = r.deepExtend({}, e));
            }
            catch (e) {
                o.error("exp: error on execute event: ", i, e);
            }
        }
        return n;
    } o.debug("exp: no composer execution result"); }, de = function (e, n) { if (e) {
        var t, i;
        if (o.setTbcCookieFromResponse(e), o.setTacCookieFromResponse(e), t = e, h.__protected__.isActivated() && h.__protected__.isCustomerPrefixConfigured(t) && t && t.bid && h.__protected__.setCxBidCookie(t.bid, null === (i = t.tbc) || void 0 === i ? void 0 : i.cookie_domain), o.setAppTimezoneOffsetFromResponse(e), o.setCurrentDomainFromResponse(e), function (e) { f.__protected__.setVisitorId(e.bid); }(e), function (e) { h.__protected__.sendPageViewEvent({ browserId: e.bid, uid: e.uid, cxenseCustomerPrefix: e.cxenseCustomerPrefix, pageViewId: pn.main.fetchPageViewId(), eventExecutionContext: ue(e.result) }); }(e), function (e) { O = e.bid; }(e), function (e) { e.iss && (R = e.iss); }(e), function (e) { L = e.itemId; }(e), e.xbc && e.xbc.cookie_value) {
            var a = { path: "/", expires: 730 };
            if (e.xbc.cookie_domain && "localhost" !== e.xbc.cookie_domain && (a.domain = e.xbc.cookie_domain, o.__protected__.deleteTLDCookieForSpecificDomains(A, e.xbc.cookie_domain)), pn.cookieDomain || pn.cookiePath) {
                var s = o.getPossibleCookieDomains();
                for (var c in s)
                    o.deleteCookie(A, s[c]);
                a.domain = pn.cookieDomain ? pn.cookieDomain : a.domain, o.__protected__.deleteTLDCookieForSpecificDomains(A, a.domain, a.path), a.path = pn.cookiePath ? pn.cookiePath : a.path, o.__protected__.deleteTLDCookieForSpecificDomains(A, a.domain, a.path);
            }
            o.deleteCookie(A), o.__protected__.setCookie(A, e.xbc.cookie_value, a);
        }
        var l = e.result, u = {};
        if (l) {
            le(l), o.debug("exp: processed experiences :", l.experiences), k = e.executionStatsContext, l.debugMessages.forEach((function (e) { o.debug("exp: execute :", e); }));
            for (var d, p = function (e, n, t) { for (var r = e.eventConditions, i = 0; i < r.length; i++) {
                var a = r[i], s = a.moduleId, c = r[i - 1], l = !r[i + 1];
                if (b[s] || (b[s] = se(a, e)), l)
                    if (b[s].children.push(n), -1 !== V.indexOf(e.eventType) && "viewportExit" === a.type && !te(e)) {
                        var u = P[e.eventType];
                        if (!u) {
                            o.error("exp: not found preload handler for event: ", e);
                            continue;
                        }
                        var d = n + F;
                        b[d] = oe(u, e), c ? b[c.moduleId].children.push(d) : t.push(d);
                    }
                c && -1 === b[c.moduleId].children.indexOf(s) && b[c.moduleId].children.push(s);
            } }, m = [], g = 0, v = 0; v < l.events.length; v++) {
                var w = l.events[v];
                try {
                    var y = w.eventType, C = w.eventModuleParams || {};
                    if (o.debug("exp: process event '" + y + "' (" + C.moduleId + ")"), "experienceExecute" === y && ((u = r.deepExtend({}, w.eventExecutionContext)).result = r.deepExtend({}, l)), !(d = C.moduleId)) {
                        o.error("exp: not found moduleId for linked node event: ", w);
                        continue;
                    }
                    var I = x[y];
                    if (!I) {
                        o.error("exp: not found handler for event: ", w);
                        continue;
                    }
                    b[d] = ne(I, w, n, l);
                    var S = re(w), E = te(w);
                    if (S || E) {
                        var T = d;
                        if (E) {
                            var N = ce(E, d);
                            b[T = d + D] = N;
                        }
                        S ? -1 === m.indexOf(w.eventConditions[0].moduleId) && m.push(w.eventConditions[0].moduleId) : E && m.push(T), p(w, T, m), g++;
                    }
                    else
                        m.push(d);
                }
                catch (e) {
                    o.error("exp: error on execute event: ", w, e);
                }
            }
            g <= 3 && (_ = !0);
            for (var U = 0; U < m.length; U++)
                d = m[U], b[d] && b[d].run();
            window.clearTimeout(q), q = window.setTimeout((function () { G("rootTimer" + q); }), 2e3), M = u;
        }
        else
            o.debug("exp: no composer execution result");
    } }; function pe(e) { re(e) && ee(e.eventModuleParams.moduleId, e); } function fe(e) { try {
        eval.call(window, "(function () {" + e + "\n})();");
    }
    catch (e) {
        o.log("Error occurred in RunJS\n", e);
    } } function me(e, n) { var t = b[e.eventModuleParams.moduleId + F]; return t && t.getPreloadResult ? t.getPreloadResult().show() : ye(e, n); } function ge(e) { return me(e, (function (e) { return pn.template.show(e); })); } function ve(e, n) { return o.debug("exp: run preloading for:", e), ye(e, (function (e) { return n(e); })); } function he(e) { return ve(e, (function (e) { return pn.template.deferredShow(e); })); } function we() { G("reset"), N.forEach((function (e, n) { clearTimeout(n); })), N = [], u.removeListeners(), d.removeListeners(), s.removeListeners(), p.unbindAll(), b = {}, S = {}; } function ye(e, n) { var t = r.deepExtend({}, e.eventParams), i = e.eventExecutionContext.splitTests, a = e.eventExecutionContext.activeMeters, s = e.eventParams.formNameByTermId, c = e.eventParams.hideCompletedFields, l = function (e) { var n; if (!R)
        return null; var t = e || {}; return { issuerId: R, premium: t.user && t.user.premium || null, redemptionCandidateItemId: L || null, creditStates: t.creditStates || null, userId: (null === (n = t.user) || void 0 === n ? void 0 : n.uid) || null, targetGroups: { l1: "target", l2: null } }; }(e.eventExecutionContext); if (t.trackingId = e.eventExecutionContext.trackingId, t.experienceId = e.eventExecutionContext.experienceId, t.experienceExecutionId = e.eventExecutionContext.executionId, t.experienceActionId = e.eventModuleParams.moduleId, t.experienceConditions = e.eventConditions, t.browserId = O, t.onStartCreditRedemption = function (n) { var t = r.deepExtend({}, n), o = "https://www.piano.io" === R, i = e.eventExecutionContext.user && "anon" !== e.eventExecutionContext.uid; return t.trackingId = e.eventExecutionContext.trackingId || void 0, o && i && (t.uid = e.eventExecutionContext.user.uid || void 0), pn.credit.redeem(t); }, i && i.length > 0) {
        var u = i.map((function (e) { return e.variantId; }));
        t.splitTestIds = JSON.stringify(u);
    } if (t.additionalParamNames = [], a && a.length > 0 && (t.activeMeters = JSON.stringify(a)), "showZuoraOffer" === e.eventType) {
        var d = e.eventParams.ratePlanIds;
        d && d.length > 0 && (t.zuoraSelectedRatePlanIds = JSON.stringify(d), t.additionalParamNames.push("zuoraSelectedRatePlanIds"));
    } if ("showNewscycleOffer" === e.eventType) {
        var p = e.eventParams.ids;
        p && p.length > 0 && (t.newscycleSelectedIds = JSON.stringify(p), t.additionalParamNames.push("newscycleSelectedIds", "campaignCode", "campaignGroupId"));
    } if ("showNewsletterSignup" === e.eventType) {
        var f = e.eventParams.mailingListIds, m = e.eventParams.siteId;
        f && f.length > 0 && (t.mailingListIds = JSON.stringify(f), t.siteId = m, t.additionalParamNames.push("mailingListIds", "siteId"));
    } return "showRecommendations" === e.eventType && (t.widgetId = e.eventParams.widgetId, t.placeholder = e.eventParams.placeholder), s && (t.formNameByTermId = JSON.stringify(s), t.hideCompletedFields = c), l && (t.affiliateState = l), o.debug("exp: show with params:", t), n(t); } function be() { return function () { }; } return { name: "experience", init: function () { if (!I && !o.__protected__.isCxenseBot()) {
            I = !0;
            var e = !0;
            if (pn.customPreChecks && pn.customPreChecks.length)
                for (var n = null, t = pn.customPreChecks.length; t--;)
                    try {
                        1 !== (n = pn.customPreChecks[t]()) && !0 !== n && (e = !1);
                    }
                    catch (e) { }
            e && Q("auto").then((function () { w.setTime("expExec"); }));
        } }, execute: E, _getLastExecutionResult: function () { return M; }, registerCallback: T, __private__: { handlers: x, executedNodes: y, linkedNodes: b, processResult: de, processErrors: Z, show: ye, getTrackingEndpoint: W, initialized: I, registerCallback: T }, __protected__: { sendStatisticsExecutedNodes: G } }; };
    pn.container.register("experience", { useValue: un() }), pn.experience = pn.container.resolve("experience");
    var dn = function () { var e, n, t, r, o, i = 0, a = document, s = !1, c = "active", l = 6e4, u = (r = {}, t = "__ceGUID", { add: function (e, n, o) { return e[t] = void 0, e[t] || (e[t] = "ifvisible.object.event.identifier"), r[e[t]] || (r[e[t]] = {}), r[e[t]][n] || (r[e[t]][n] = []), r[e[t]][n].push(o); }, remove: function (e, n, o) { var i, a, s, c, l; if (o) {
            if (e[t] && r[e[t]] && r[e[t]][n])
                for (a = s = 0, c = (l = r[e[t]][n]).length; s < c; a = ++s)
                    if ((i = l[a]) === o)
                        return r[e[t]][n].splice(a, 1), i;
        }
        else if (e[t] && r[e[t]] && r[e[t]][n])
            return delete r[e[t]][n]; }, fire: function (e, n, o) { var i, a, s, c, l; if (e[t] && r[e[t]] && r[e[t]][n]) {
            for (l = [], a = 0, s = (c = r[e[t]][n]).length; a < s; a++)
                i = c[a], l.push(i(o || {}));
            return l;
        } } }), d = function (e, n, t) { return o || (o = e.addEventListener ? function (e, n, t) { return e.addEventListener(n, t.bind(dn), !1); } : e.attachEvent ? function (e, n, t) { return e.attachEvent("on" + n, t, !1); } : function (e, n, t) { return e["on" + n] = t; }), o(e, n, t); }, p = function () { var e, n = a.createElement("div"), t = n.getElementsByTagName("i"), r = 3; for (e = function () { return n.innerHTML = "\x3c!--[if gt IE " + ++r + "]><i></i><![endif]--\x3e", t[0]; }; e();)
        ; return r > 4 ? r : void 0; }(); function f() { var t, r, o; return !!s || (e ? d(a, n, (function () { return a.hidden ? g() : m(); }), !1) : (t = "blur", p && p < 9 && (t = "focusout"), d(window, t, (function () { return dn.blur(); })), d(window, "focus", (function () { return dn.focus(); }))), s = !0, (o = function () { return clearTimeout(r), "active" !== c && h(), i = +new Date, r = setTimeout((function () { if ("active" === c)
        return v(); }), l); })(), d(a, "mousemove", o), d(a, "mouseup", o), d(a, "keyup", o), d(a, "touchstart", o), d(window, "scroll", o), d(window, "resize", o), m(o), h(o)); } void 0 !== a.hidden ? (e = "hidden", n = "visibilitychange") : void 0 !== a.mozHidden ? (e = "mozHidden", n = "mozvisibilitychange") : void 0 !== a.msHidden ? (e = "msHidden", n = "msvisibilitychange") : void 0 !== a.webkitHidden && (e = "webkitHidden", n = "webkitvisibilitychange"); function m(e) { return "function" == typeof e ? w("focus", (function (n) { e(n); })) : (c = "active", u.fire(dn, "focus"), u.fire(dn, "wakeup"), u.fire(dn, "statusChanged", { status: c })), dn; } function g(e) { return "function" == typeof e ? w("blur", (function (n) { e(n); })) : (c = "hidden", u.fire(dn, "blur"), u.fire(dn, "idle"), u.fire(dn, "statusChanged", { status: c })), dn; } function v(e) { return "function" == typeof e ? w("idle", (function (n) { e(n); })) : (c = "idle", u.fire(dn, "idle"), u.fire(dn, "statusChanged", { status: c })), dn; } function h(e) { return "function" == typeof e ? w("wakeup", (function (n) { return e(n); })) : (c = "active", u.fire(dn, "wakeup"), u.fire(dn, "statusChanged", { status: c })), dn; } function w(e, n) { return f(), u.add(dn, e, n), dn; } return { name: "ifvisible", setIdleDuration: function (e) { return l = 1e3 * e; }, getIdleDuration: function () { return l; }, getIdleInfo: function () { var e, n; return e = +new Date, n = {}, "idle" === c ? (n.isIdle = !0, n.idleFor = e - i, n.timeLeft = 0, n.timeLeftPer = 100) : (n.isIdle = !1, n.idleFor = e - i, n.timeLeft = i + l - e, n.timeLeftPer = (100 - 100 * n.timeLeft / l).toFixed(2)), n; }, wakeup: h, idle: v, focus: m, blur: g, on: w, off: function (e, n) { return f(), u.remove(dn, e, n), dn; }, onEvery: function (e, n) { var t, r = !1; return f(), n && (t = setInterval((function () { if ("active" === c && !r)
            return n(); }), 1e3 * e)), { stop: function () { return clearInterval(t); }, pause: function () { return r = !0; }, resume: function () { return r = !1; }, code: t, callback: n }; }, now: function (e) { return f(), c === (e || "active"); } }; }();
    pn.container.register("ifvisible", { useValue: dn }), pn.ifvisible = pn.container.resolve("ifvisible");
    var fn = function () { var e, n = pn.container.resolve("jqUtils"), t = pn.container.resolve("ifvisible"), r = 0, o = [], i = 60, a = !0, s = function () { m(); var e = o[o.length - 1]; void 0 !== e && void 0 === e.stopTime || o.push({ startTime: new Date, startMinute: r, stopTime: void 0 }); }, c = function () { if (0 !== o.length && !a)
        if (d())
            f();
        else {
            var e = o[o.length - 1];
            void 0 === e.stopTime && (e.stopTime = new Date, e.stopMinute = r);
        } }, l = function (e, n, t, r) { var o = Math.abs(e.getTime() - n.getTime()), i = t - r; return o > 6e4 * (i + 10) && (o = 6e4 * i), o; }, u = function (e) { var n = parseFloat(e); if (isNaN(n))
        throw { name: "InvalidDurationException", message: "An invalid duration time (" + e + ") was provided." }; t.setIdleDuration(n), i = n; }, d = function () { return !!(e = n.filter("video,audio", (function (e) { return !e.paused; }))).length; }, p = function () { setTimeout((function () { c(); }), 15e3); }, f = function () { e && e.forEach((function (e) { n.on(e, "pause", p); })); }, m = function () { e && e.forEach((function (e) { n.off(e, "pause", p); })); }; return { name: "activetimer", setIdleDurationInSeconds: u, getActiveTimeInSeconds: function () { for (var e = 0, n = 0; n < o.length; n++) {
            var t = o[n].startTime, i = o[n].stopTime, a = o[n].startMinute, s = o[n].stopMinute;
            void 0 === i && (i = new Date, s = r), e += l(i, t, s, a);
        } return Math.floor(e / 1e3); }, getTotalTimeInSeconds: function () { var e = 0, n = o[0]; if (void 0 !== n) {
            var t = n.startTime, i = n.startMinute, a = new Date;
            e = l(a, t, r, i);
        } return Math.floor(e / 1e3); }, resetRecordedTime: function () { o = [], s(); }, startTimer: s, stopTimer: c, initialize: function (e) { e && u(e), t.on("blur", (function () { a = !1, c(); })), t.on("focus", (function () { a = !0, s(); })), t.on("idle", (function () { i > 0 && (a = !1, c()); })), t.on("wakeup", (function () { i > 0 && (a = !0, s()); })), s(), setInterval((function () { r++; }), 6e4); } }; }();
    pn.container.register("activetimer", { useValue: fn }), pn.activetimer = pn.container.resolve("activetimer");
    var mn = function () { var e, n = {}, t = [], r = !1, o = 1, i = 2, a = 3; function s(e) { e && (u(), r = !1), function () { if (r)
        return !1; r = !0; try {
        var e = window.googletag = window.googletag || {};
        e.cmd = e.cmd || [], e.cmd.push((function () { e.pubads().addEventListener("slotRenderEnded", f), e.pubads().addEventListener("impressionViewable", m), e.companionAds().addEventListener("slotRenderEnded", f), e.companionAds().addEventListener("impressionViewable", m); })), e.apiReady && e.cmd.push((function () { d(e.pubads().getSlots()), d(e.companionAds().getSlots()); }));
    }
    catch (e) {
        return v(e), !1;
    } }(); } function c(n, t) { "function" == typeof e && e(n, t); } function l(e) { return e && void 0 !== n[e] && null !== n[e] && n.hasOwnProperty(e); } function u() { n = {}, t = []; } function d(e) { for (var n = 0; n < e.length; n++) {
        var t = e[n];
        f({ eventSource: a, slot: t });
    } } function p(e) { var n; try {
        var t = e.serviceName, r = e.slot;
        if (!t) {
            var o = e.slot.getServices();
            o && o.length && (t = o[0].getName());
        }
        var i = r.getResponseInformation() || {}, a = r.getSlotId ? r.getSlotId() : {}, s = r.getSlotElementId ? r.getSlotElementId() : a.getDomId ? a.getDomId() : null;
        n = { companion: !!t && "companion_ads" === t, adUnit: r.getAdUnitPath ? r.getAdUnitPath() : 0, isEmpty: e.isEmpty, elementId: s, advertiserId: e.advertiserId || i.advertiserId, campaignId: e.campaignId || i.campaignId, lineItemId: e.lineItemId || i.lineItemId, creativeId: e.creativeId || i.creativeId, eventSource: e.eventSource || null, size: e.size && e.size.slice(0, 2) || null, viewed: !1, position: null };
        var c = document.getElementById(s);
        if (s && c && (n.position = { top: c.offsetTop, left: c.offsetLeft }, void 0 === e.isEmpty && (n.isEmpty = c.offsetWidth <= 0 && c.offsetHeight <= 0, !n.isEmpty && !n.size))) {
            var l = r.getSizes();
            l && l.length && (n.size = "object" == typeof l[0] ? [l[0].getWidth(), l[0].getHeight()] : l[0]);
        }
    }
    catch (e) {
        v(e);
    } return n; } function f(e) { e.eventSource = e.eventSource || o; var r = p(e), i = g(e.slot); i && (n[i] ? r.viewed = n[i].viewed : t.push(i), n[i] = r, c(r, i)); } function m(e) { var r = g(e.slot); if (r) {
        var o = n[r] || p(e);
        l(r) || (n[r] = o, t.push(r)), void 0 === o.companion && (o.companion = "companion_ads" === e.serviceName), (!o.eventSource || o.eventSource > i) && (o.eventSource = i), o.viewed = !0, c(o, r);
    } } function g(e) { try {
        var n = e.getSlotId ? e.getSlotId() : {}, t = e.getSlotElementId ? e.getSlotElementId() : n.getDomId ? n.getDomId() : null, r = e.getAdUnitPath ? e.getAdUnitPath() : 0;
        return [t, n.getId ? n.getId() : 0, r].join(":");
    }
    catch (e) {
        v(e);
    } } function v(e) { pn && pn.util && pn.util.error && pn.util.error("DFP module error: ", e); } return s(), { name: "doubleClickForPublisher", initialize: s, setCustomHandler: function (n) { e = n; }, getAds: function (e) { var r, o = [], i = 0, a = t.length; e && ("number" == typeof (r = e) && isFinite(r) && Math.floor(r) === r) && e > 0 && e < a && (i = a - e); for (var s = i; s < a; s++) {
            var c = t[s];
            l(c) && o.push(n[c]);
        } return o; }, resetAds: u }; }();
    pn.container.register("doubleClickForPublisher", { useValue: mn }), pn.doubleClickForPublisher = pn.container.resolve("doubleClickForPublisher");
    var gn = function () { var e, n, t, r, o, i, a = pn.container.resolve("postmessage"), s = pn.container.resolve("util"), c = "https://js.braintreegateway.com/web/3.79.1/js/client.min.js", l = "https://js.braintreegateway.com/web/3.79.1/js/apple-pay.min.js", u = ""; a.subscribe("loaded", (function () { d(); })), a.subscribe("startCheckout", (function () { d(); })), a.subscribe("applePayBtClientToken", (function (e) { g(e.params.clientToken); })), a.subscribe("applePayBtCheckoutFlowProperties", (function (e) { r = e.params.requestEmail, o = e.params.requestPostalAddress; })), a.subscribe("applyTaxFailed", (function (n) { e.abort(); })), a.subscribe("checkApplePayBtInstance", (function (e) { n && a.broadcast("applePayInit", {}); })), a.subscribe("applyTaxCompleted", (function (e) { m(e.params.nonce); })), a.subscribe("applePayBtBeginSession", (function (i) { var s = {}, c = i.params; c.resourceTitle && (s = c), c.termId && (u = c.termId || ""); var l = { currencyCode: c.currencyCode, total: { label: c.resourceTitle, amount: c.chargeAmount } }; p(l); try {
        t = n.createPaymentRequest(l);
    }
    catch (e) {
        a.broadcast("payment-error", { errorCode: 101 });
    } (e = new window.ApplePaySession(2, t)).onvalidatemerchant = function (t) { n.performValidation({ validationURL: t.validationURL, displayName: c.resourceTitle || s.resourceTitle }, (function (n, t) { if (n)
        return e.abort(), void a.broadcast("payment-error", { errorCode: 102 }); e.completeMerchantValidation(t); })); }, e.onpaymentauthorized = function (t) { n.tokenize({ token: t.payment.token }, (function (n, i) { if (n)
        return a.broadcast("payment-error", { errorCode: 103 }), void e.completePayment(window.ApplePaySession.STATUS_FAILURE); var s = { nonce: i.nonce }; r || o ? f(t, s) : m(s); })); }, e.begin(); })); var d = function () { var e = s.__protected__.isApplePayAllowed(); a.broadcast("EVENT_APPLE_PAY_CAN_MAKE_PAYMENTS", { canMakePayments: e }); }, p = function (e) { r && (e.requiredShippingContactFields = ["email"]), o && (e.requiredBillingContactFields = ["postalAddress"]); }, f = function (e, n) { e.payment.shippingContact && (n.user = { email: e.payment.shippingContact.emailAddress }); var t = e.payment.billingContact, r = { countryCode: t.countryCode ? t.countryCode.toUpperCase() : t.countryCode, zipCode: t.postalCode, billingZipCode: t.postalCode, nonce: n }; a.broadcast("applePayPaymentAuthorized" + u, r); }, m = function (n) { e.completePayment(window.ApplePaySession.STATUS_SUCCESS), a.broadcast("applePayNonce" + u, n); }, g = function (e) { i = e, v(); }, v = function () { y() || w(c, (function () { h(); })); }, h = function () { b() || w(l, (function () { window.braintree.client.create({ authorization: i }).then((function (e) { window.braintree.applePay.create({ client: e }, (function (e, t) { e ? a.broadcast("payment-error", { errorCode: 101 }) : (n = t, a.broadcast("applePayInit", {})); })); })).catch((function (e) { if (e)
        return a.broadcast("payment-error", { errorCode: 100 }), void s.error("[TP] Client error: " + e.message); })); })); }, w = function (e, n) { s.addScript(e, n); }, y = function () { for (var e = document.getElementsByTagName("script"), n = 0, t = e.length; n < t; n++)
        if (e[n].src.indexOf(c) > -1)
            return !0; }, b = function () { for (var e = document.getElementsByTagName("script"), n = 0, t = e.length; n < t; n++)
        if (e[n].src.indexOf(l) > -1)
            return !0; }; return { name: "applePay" }; }();
    pn.container.register("applePay", { useValue: gn }), pn.applePay = pn.container.resolve("applePay");
    var vn = function () { var e = pn.container.resolve("postmessage"), n = pn.container.resolve("util"), t = "", r = { environment: "", billingRequestFlowId: "" }, o = { customer: "", mandate: "", bank_account_ending: "", bank_account_holder: "", bank_name: "", currency: "" }, i = !1, a = "https://pay.gocardless.com/billing/static/dropin/v2/initialise.js"; e.subscribe("loaded", (function (e) { t = e.sender, i || "inline" === e.displayMode || c(a, (function () { i = !0; })); })), e.subscribe("LOAD_GOCARDLESS_DROPIN", (function (n) { t = n.sender, i ? e.send("GOCARDLESS_DROPIN_LOADED", null, t) : c(a, (function () { i = !0, e.send("GOCARDLESS_DROPIN_LOADED", null, t); })); })), e.subscribe("GOCARDLESS_DROPIN_MANDATE_CREATION_INIT", (function (e) { r = e.params, i && s(); })); var s = function () { window.GoCardlessDropin.create({ billingRequestFlowID: r.billingRequestFlowId, environment: r.environment, onSuccess: function (n) { var r = n.links, i = r.customer, a = r.mandate_request_mandate, s = n.resources.customer_bank_account, c = s.account_number_ending, l = s.account_holder_name, u = s.bank_name, d = n.mandate_request.currency; o = { customer: i, mandate: a, bank_account_ending: c, bank_account_holder: l, bank_name: u, currency: d }, e.send("GOCARDLESS_DROPIN_MANDATE_CREATION_COMPLETE", o, t); }, onExit: function (n) { n ? e.send("payment-error", { message: n }, t) : e.send("GOCARDLESS_DROPIN_ENABLE_PLUGIN", null, t); } }).open(); }, c = function (e, t) { n.addScript(e, t); }; return { name: "goCardlessDropin" }; }();
    pn.container.register("goCardlessDropin", { useValue: vn }), pn.goCardlessDropin = pn.container.resolve("goCardlessDropin");
    var hn = function () { var e, n, t, r = pn.container.resolve("postmessage"), o = pn.container.resolve("util"), i = !1; return { name: "applePayIntegrationService", initialize: function () { var a = function () { i = o.__protected__.isApplePayAllowed(), r.broadcast("EVENT_APPLE_PAY_CAN_MAKE_PAYMENTS", { canMakePayments: i }); }; r.subscribe("provider-component-initiated", (function () { i && r.broadcast("apple-pay-init", {}); })), r.subscribe("initPwApplePay", (function () { a(); })), r.subscribe("startCheckout", (function () { a(); })), r.subscribe("pay-session-received", (function (e) { try {
            n.completeMerchantValidation(e.params.applePaySession);
        }
        catch (e) {
            r.broadcast("payment-error", { errorCode: 111, errors: e });
        } })), r.subscribe("apple-pay-complete-payment", (function (e) { var r; (r = e.params.termId, t && t !== r) || n.completePayment(e.params.status, e.params.errors); })), r.subscribe("start-purchase", (function (o) { t = o.params.termId || "", e = o.params.resourceName, n = new window.ApplePaySession(3, function (e) { return { countryCode: e.params.countryCode, currencyCode: e.params.currencyCode, supportedNetworks: ["visa", "masterCard", "amex", "discover"], merchantCapabilities: ["supports3DS"], requiredShippingContactFields: e.params.requiredShippingContactFields || [], requiredBillingContactFields: e.params.requiredBillingContactFields || [], total: { label: e.params.resourceName, amount: e.params.chargeAmount } }; }(o)), n.onvalidatemerchant = function (n) { var o, i; o = n.validationURL, i = { validationUrl: o, displayedCaption: e, userToken: null, userProvider: null, userRef: null, janrainCaptureToken: null, domainName: window.location.hostname, aid: null, termId: t }, r.broadcast("apple-pay-pay-session-request", i); }, n.onpaymentauthorized = function (e) { try {
            r.broadcast("apple-pay-payment-authorized", { paymentData: e.payment, termId: t });
        }
        catch (e) {
            r.broadcast("payment-error", { errorCode: 110, error: e });
        } }; try {
            n.begin();
        }
        catch (e) {
            r.broadcast("payment-error", { errorCode: 112, error: e, termId: t });
        } })), r.subscribe("abort-apple-pay-session", (function () { !function () { try {
            n.abort();
        }
        catch (e) {
            o.error(e);
        } }(); })); }, __protected__: { applePayCanMakePaymentsWithActiveCard: function () { var e = { then: function (e) { return e(null); }, catch: function () { } }; return pn.applePayMerchantId && o.__protected__.isApplePayAllowed() && pn.applePayMerchantId ? window.ApplePaySession.canMakePaymentsWithActiveCard(pn.applePayMerchantId) : e; } } }; }();
    pn.container.register("applePayIntegrationService", { useValue: hn }), pn.applePayIntegrationService = pn.container.resolve("applePayIntegrationService");
    var wn = function () { var e, n, t = pn.container.resolve("postmessage"), r = pn.container.resolve("util"), o = pn.container.resolve("ajax"), i = "datatrans-applepay-button", a = null, s = null, c = !1, l = function (n) { e = n.sender, m().then(g).then(v); }, u = function (n) { var r = null; n || (r = { message: n }), t.send("datatrans-applepay-service-error", r, e); }, d = function (e) { n = e.params, m().then(g).then(p).catch((function () { u("Apple Pay button init error"); })); }, p = function () { PaymentButton.init(n.applePayConfig); }, f = function () { var e = document.getElementById(i); null !== e && null !== e.firstElementChild ? e.firstElementChild.click() : u("Could not process with Apple Pay. Please, try again."); }, m = function () { return null !== s ? s : s = new Promise((function (e) { o.request({ url: tp.getApiEndpoint() + "/anon/datatrans/applepay/config", data: { aid: tp.aid }, dataType: "jsonp", jsonpCallback: "jsonpCallback", success: function (n) { var t = n.config; e(t.url); } }); })); }, g = function (e) { if (null !== a)
        return a; var n = "datatrans-apple-pay"; if (!document.getElementById(n)) {
        var t = document.createElement("script");
        return t.src = e, t.id = n, document.body.appendChild(t), a = new Promise((function (e) { t.onload = function () { e(null); }; }));
    } }, v = function () { c || (PaymentButton.on("init", h), PaymentButton.on("create", w), PaymentButton.on("token", y), PaymentButton.on("abort", (function () { u(null); })), PaymentButton.on("unsupported", (function () { u("No payment method is supported"); })), PaymentButton.on("error", (function (e) { e && (r.error("datatransApplePayIntegrationService. apple pay button error: " + e), u("Could not process with Apple Pay. Please, try again.")); })), c = !0); }, h = function () { var e = b(); PaymentButton.create(e, n.paymentConfig).catch((function () { u("Apple Pay button create error"); })); }, w = function () { r.log("datatransApplePayIntegrationService paymentButtonOnCreate"), t.send("datatrans-applepay-service-ready", null, e); }, y = function (n) { r.log("datatransApplePayIntegrationService paymentButtonOnToken"), t.send("datatrans-applepay-service-token", n.token.details.token, e); }, b = function () { var e = document.getElementById(i); return null === e && ((e = document.createElement("div")).setAttribute("id", i), e.style.display = "none", document.body.appendChild(e)), e.innerHTML = "", e; }; return { name: "datatransApplePayIntegrationService", initialize: function () { r.__protected__.isApplePayAllowed() && (t.subscribe("datatrans-applepay-loaded", l), t.subscribe("datatrans-applepay-checkout-initiate-purchase", d), t.subscribe("datatrans-applepay-make-purchase", f)); } }; }();
    pn.container.register("datatransApplePayIntegrationService", { useValue: wn }), pn.datatransApplePayIntegrationService = pn.container.resolve("datatransApplePayIntegrationService");
    var yn = function () { var e, n = pn.container.resolve("postmessage"), t = pn.container.resolve("util"), r = null, o = null, i = !1, a = ""; n.subscribe("stripe-applepay-initialized", (function () { s(); })), n.subscribe("stripe-applepay-initiate-purchase", (function (e) { s().then((function () { var n = e.params.apiKey; null === r && (r = window.Stripe(n)); var t = e.params.paymentRequestPayload; return r.paymentRequest(t); })).then((function (e) { return o = e, e.canMakePayment(); })).then((function (e) { i = e && e.applePay, n.broadcast("stripe-applepay-initiate-purchase-complete", { canMakePayment: i }), i && (o.on("cancel", (function () { n.broadcast("stripe-applepay-start-purchase-complete" + a, { status: "fail" }); })), o.on("paymentmethod", (function (e) { var t = e.paymentMethod.billing_details.address, r = { countryCode: t.country, zipCode: t.postal_code, billingZipCode: t.postal_code }, o = e.paymentMethod.id; n.broadcast("stripe-applepay-start-purchase-complete" + a, { status: "success", paymentMethodId: o, payerEmail: e.payerEmail, billingAddress: r }), e.complete("success"); }))); })).catch((function (e) { t.error(e), n.broadcast("stripe-applepay-initiate-purchase-complete", { canMakePayment: !1 }); })); })), n.subscribe("stripe-applepay-start-purchase", (function (e) { a = e.params.termId || ""; var n = e.params.paymentRequestPayload; o.update(n), o.show(); })), n.subscribe("stripe-applepay-abort-request", (function () { o && o.abort(), n.broadcast("stripe-applepay-reopen-request"); })); var s = function () { if (null != e)
        return e; if (!document.getElementById("stripe.js")) {
        var n = document.createElement("script");
        return n.src = "https://js.stripe.com/v3/", n.id = "stripe.js", document.body.appendChild(n), e = new Promise((function (e) { n.onload = function () { e(null); }; }));
    } }; return { name: "stripeApplePayIntegrationService" }; }();
    pn.container.register("stripeApplePayIntegrationService", { useValue: yn }), pn.stripeApplePayIntegrationService = pn.container.resolve("stripeApplePayIntegrationService");
    var bn = function () { var e = pn.container.resolve("postmessage"), n = pn.container.resolve("util"); e.subscribe("obi-handle-3ds-challenge", (function (e) { var r = e.params; if (window.obick)
        t(r);
    else {
        if (-1 === ["https://jsl.qat.obi.aol.com/obipmservice/obick.umd.js", "https://jsl.prod.obi.aol.com/obipmservice/obick.umd.js"].indexOf(r.obickUrl))
            return void n.error("Untrusted obickUrl detected: " + r.obickUrl);
        var o = document.createElement("script");
        o.src = r.obickUrl, o.id = "obick.js", document.body.appendChild(o), o.onload = function () { n.log(o.id + " onload"), t(r); };
    } })); var t = function (t) { if (t.stepUpUrl && 0 !== t.stepUpUrl.indexOf("http"))
        n.error("There is no link in params.stepUpUrl for OBI");
    else {
        var r = { stepUpUrl: t.stepUpUrl, jwt: t.jwt, transactionId: t.transactionId, zIndex: t.zIndex };
        window.obick.handle3dsChallenge(r).then((function (t) { n.debug(t), e.broadcast("obi-3ds-challenge-complete", { threeDSTransactionId: t.threeDSTransactionId, challengeStatus: t.challengeStatus }); })).catch((function (t) { n.error(t), e.broadcast("obi-3ds-challenge-complete", { error: "challenge-error", payload: t }); }));
    } }; return { name: "obi3DSChallenge" }; }();
    pn.container.register("obi3DSChallenge", { useValue: bn }), pn.obi3DSChallenge = pn.container.resolve("obi3DSChallenge");
    var kn = function () { var e = pn.container.resolve("jqUtils"), n = pn.container.resolve("util"), t = pn.container.resolve("api"), r = pn.container.resolve("user"), o = pn.container.resolve("pianoId"), i = { displayMode: "inline", containerSelector: "body", loginSuccess: d }, a = "reader_id", s = function () { return "/" + pn.aid + "/execution/amp"; }, c = function () { window.location.href = n.getQueryParamByName("return") + "#success=true"; }; var l = function (e) { return /^\w+$/i.test(e); }, u = function (e) { var r = {}; if (r.reader_id = n.getQueryParamByName(a), r.reader_id) {
        var o = pn.getExperienceEndpoint(!1);
        t.callApi(s() + "/logout", r, e, o, !1, !0);
    }
    else
        n.log("reader_id cannot be empty"); }; function d(e, r) { var o = e || {}; if (o.reader_id || (o.reader_id = n.getQueryParamByName(a)), o.reader_id) {
        var i = pn.getExperienceEndpoint(!1);
        t.callApi(s() + "/login", o, r, i, !1, !0);
    }
    else
        n.log("reader_id cannot be empty"); } return { name: "amp", showLogin: function (t) { t = t || {}; var a = r.getProvider(); if (a.getName() === o.getName()) {
            var s;
            s = t.loginSuccess && e.isFunction(t.loginSuccess) ? t.loginSuccess : c;
            var l = function () { d({}, s); }, u = Object.assign({}, i, t);
            r.isUserValid() ? l() : (u.loginSuccess = l, o.show(u));
        }
        else
            n.log("Current user provider" + a.name + " is not allowed for amp"); }, logout: function (n) { n = e.isFunction(n) ? n : c, r.getProvider().getName() === o.getName() ? o.logout((function () { u(n); })) : u(n); }, login: function (t) { var i = r.getProvider().getName(); i === o.getName() && (t = t ? e.deepExtend({}, t, { userProvider: i }) : { userProvider: i }); var a = { user_transient: !0, user_provider: "publisher_user" }; if (t && t.readerId && (a.reader_id = t.readerId), t && t.userToken && (a.user_token = t.userToken), t && t.userProvider && (a.user_provider = t.userProvider, a.user_transient = !1), !function (t) { if (t && t.userState && e.isPlainObject(t.userState)) {
            var r = Object.keys(t.userState);
            if (r.filter(l).length !== r.length)
                return n.error("user_state accept only contain letters, numbers and underscore"), !1;
        } return !0; }(t))
            return !1; t && t.userState && (a.user_state = JSON.stringify(t.userState)); d(a, (function (n) { 0 === n.code ? t.loginSuccess && e.isFunction(t.loginSuccess) && t.loginSuccess() : t.loginFail && e.isFunction(t.loginFail) && t.loginFail(); })); } }; }();
    pn.container.register("amp", { useValue: kn }), pn.amp = pn.container.resolve("amp");
    var _n = function () { var e, n = pn.container.resolve("postmessage"), t = [{ resourceRegExp: new RegExp("/checkout/offer/show"), label: "showOffer" }, { resourceRegExp: new RegExp("tinypass.min.js$"), label: "tinypassMinJS" }, { resourceRegExp: new RegExp("/xbuilder/experience/execute"), label: "experienceExecute" }], r = !1, o = []; function i(e) { e.forEach((function (e) { !function (e) { if (!function (e) { return t.some((function (n) { return e.name.match(n.resourceRegExp); })); }(e))
        return; !function (e) { if (!a())
        return void o.push(e); o.push(e), s(); }(e); }(e); })); } function a() { return r && e; } function s() { a() && (o.forEach((function (t) { n.send("EVENT_TP_PERFORMANCE_DATA", { entry: t }, e); })), o = []); } return function () { if (window.performance && window.PerformanceObserver && "function" == typeof performance.getEntries) {
        var t = window.PerformanceObserver.prototype.observe;
        window.PerformanceObserver.prototype.observe = function () { for (var e = [], n = 0; n < arguments.length; n++)
            e[n] = arguments[n]; try {
            t.apply(this, e);
        }
        catch (e) { } }, n.subscribe("EVENT_LOGGER_READY", (function (n) { e = n.sender, r = !0, s(); })), i(performance.getEntries()), new PerformanceObserver((function (e) { i(e.getEntries()); })).observe({ entryTypes: ["measure", "resource"] });
    } }(), { name: "performanceMetrics" }; }();
    pn.container.register("performanceMetrics", { useValue: _n }), pn.performanceMetrics = pn.container.resolve("performanceMetrics");
    var Cn = function () { var e = pn.container.resolve("api"), n = pn.container.resolve("pianoId"); return { name: "doubleOptIn", check: function () { pn.user.isUserValid() && new Promise((function (n) { e.callApi("/email/confirmation/check", {}, (function (e) { n(e); })); })).then((function (e) { e && !1 === e.data && n.showEmailConfirmationRequired(); })); } }; }();
    pn.container.register("doubleOptIn", { useValue: Cn }), pn.doubleOptIn = pn.container.resolve("doubleOptIn");
    var In = function () { var e = pn.container.resolve("api"), n = pn.container.resolve("postmessage"), t = pn.container.resolve("util"), r = t.debounce((function () { new Promise((function (n, t) { var r = { aid: pn.aid }; e.callApi(o, r, (function (e) { e && e.data && n(e.data), t(e.message); })); })).then(i, a); }), 1500), o = "/externalVerification/synchronizeSubscriptions", i = function (e) { n.broadcast("NEWSCYCLE_HAS_BEEN_SYNCHRONIZED_SUCCESS", { data: e }); }, a = function (e) { t.error("newscycle module: sync request failed with error: " + e); }; return { name: "newscycle", syncSubscriptions: r }; }();
    pn.container.register("newscycle", { useValue: In }), pn.newscycle = pn.container.resolve("newscycle");
    var Sn = function () { var e = pn.container.resolve("ajax"), n = pn.container.resolve("postmessage"), t = pn.container.resolve("util"), r = { enabled: !1, captcha3_site_key: "", aid: "" }, o = function (n) { e.request({ url: tp.getApiEndpoint() + "/anon/captcha/get.js", data: { aid: tp.aid }, dataType: "jsonp", jsonpCallback: "jsonpCallback", cache: !0, success: function (e) { !function (e, n) { e.config && e.config.enabled ? (r = e.config, n && n()) : e.message && t.error(e.message); }(e, n); } }); }; function i() { window.grecaptcha.ready(a), c(); } var a = function () { var e = document.createElement("div"); e.id = "tp-recaptcha", document.body.appendChild(e), window.grecaptcha.render("tp-recaptcha", { sitekey: r.captcha3_site_key, size: "invisible", "error-callback": function () { e.style.display = "none"; } }); }, s = function () { window.onCaptchaV3Load = i; var e = document.createElement("script"); e.src = "https://www.google.com/recaptcha/api.js?onload=onCaptchaV3Load&render=explicit", e.type = "text/javascript", e.async = !0, e.defer = !0, document.head.appendChild(e); }, c = function () { n.subscribe("get-captcha-v3-enabled", (function () { l(); })), n.subscribe("get-captcha-v3-token", (function (e) { window.grecaptcha.ready((function () { return u(e.params.action); })); })); }, l = function () { n.broadcast("captcha-v3-enabled-value", { isEnabled: r.enabled }); }, u = function (e) { window.grecaptcha.execute({ action: e }).then((function (e) { n.broadcast("captcha-v3-token", { token: e }); })).catch((function () { n.broadcast("captcha-v3-token", { token: "" }); })); }; return { name: "captchaV3", addCaptchaV3: function () { o(s); } }; }();
    pn.container.register("captchaV3", { useValue: Sn }), pn.captchaV3 = pn.container.resolve("captchaV3");
    var xn = function (e) { void 0 === e && (e = pn.container); var n = e.resolve("log"), t = e.resolve("postmessage"), r = e.resolve("api"), o = e.resolve("util"), i = e.resolve("versionService"), a = "EVENT_TP_ERROR_HANDLER", s = "sdk", c = [], l = !0, u = function (e) { if (h() && !g(c, e)) {
        e.tags || (e.tags = ["unknown"]), e.aid = pn.aid, e.v = i.getTinypassVersion();
        var n = { details: e };
        c.push(n);
    } }; var d = function (e) { var n = e.params; Array.isArray(n) && n.forEach((function (e) { u(e); })); }; function p(e) { var n, t; if (e.message.toLowerCase().indexOf("script error") > -1)
        u({ message: "Probably that is Piano error.", url: window.location.href, tags: [s] });
    else {
        var r = null == e ? void 0 : e.error;
        if (v(null == r ? void 0 : r.stack))
            return !1;
        u({ stack: null !== (n = null == r ? void 0 : r.stack) && void 0 !== n ? n : "n/a", message: null !== (t = null == r ? void 0 : r.message) && void 0 !== t ? t : "n/a", userAgent: navigator.userAgent, tags: [s] });
    } return !1; } var f = function () { setInterval((function () { m(), l = !1; }), 15e3); }, m = function () { var e = c.filter((function (e) { return !e.send; })); if (0 !== e.length) {
        var t = e.map((function (e) { return e.details; })), o = { type: "console-error-message", srcType: "ts", log_message: JSON.stringify(t) };
        n.logBeaconRequest(r.getEndpoint() + "/anon/error/log", o), e.forEach((function (e) { return e.send = !0; }));
    } }, g = function (e, n) { var t = e.map((function (e) { return JSON.stringify(e.details); })), r = JSON.stringify(n); return -1 !== t.indexOf(r); }, v = function (e) { return -1 === (null == e ? void 0 : e.indexOf("tinypass")); }, h = function () { return !!o.__protected__.getLocalStorageItem("tinypassErrorHandlerTestMode") || 0 === w(0, 1e3); }, w = function (e, n) { var t = e - .5 + Math.random() * (n - e + 1); return Math.round(t); }, y = function (e, n) { return void 0 === e && (e = []), n ? e.concat(n) : e; }; return { name: "tinypassErrorHandler", addError: function (e, n) { try {
            var t = { place: n, tags: [s] };
            e instanceof Error ? (t.stack = e.stack, t.message = e.message) : t.stack = JSON.stringify(e), l && (t.tags = y(t.tags, "initError")), u(t);
        }
        catch (e) { } }, initialize: function () { try {
            pn.isSandbox() || (t.subscribe(a, d), null === (e = window.addEventListener) || void 0 === e || e.call(window, "error", p), f());
        }
        catch (e) {
            console.warn("Cannot start watching errors", e);
        } var e; } }; };
    pn.container.register("tinypassErrorHandler", { useValue: xn() }), pn.tinypassErrorHandler = pn.container.resolve("tinypassErrorHandler");
    var Pn = function (e) { void 0 === e && (e = pn.container); var n = e.resolve("api"), t = e.resolve("cookie"), r = e.resolve("log"), o = e.resolve("jqUtils"), i = e.resolve("util"), a = e.resolve("logging"), s = e.resolve("fingerprint"), c = e.resolve("user"), l = e.resolve("sha1"), u = e.resolve("activetimer"), d = e.resolve("scrollDepth"), p = e.resolve("doubleClickForPublisher"), f = e.resolve("offer"), m = e.resolve("viewportExit"), g = e.resolve("idle"), v = e.resolve("experience"), h = e.resolve("pianoId"), w = e.resolve("pianoEsp"), y = e.resolve("applePayIntegrationService"), b = e.resolve("datatransApplePayIntegrationService"), k = e.resolve("cxense"); e.resolve("tinypassErrorHandler"); var _ = e.resolve("captchaV3"), C = pn.container.resolve("postmessage"), I = "exrs", S = null, x = "voucher_code", P = "__pvi", E = !1, T = !1, A = {}, M = null, O = k.__protected__.getOrGenerateCxCompatibleBid(), R = { APPLE_PAY_BT: 25, APPLE_PAY_SS: 38, APPLE_PAY_STRIPE: 41, APPLE_PAY_PW: 42, DATATRANS_APPLE_PAY: 61 }, L = new Set(Object.values(R)), N = void 0, U = [], j = !1, D = !1, F = function () { if ("iP" === navigator.platform.substr(0, 2)) {
        var e = /constructor/i.test(window.HTMLElement), n = window.navigator, t = n.userAgent, r = !!window.indexedDB;
        if (-1 === t.indexOf("Safari") || -1 === t.indexOf("Version") || n.standalone) {
            if (!r && e || !window.statusbar.visible)
                ;
            else if (window.webkit && window.webkit.messageHandlers || !e || r)
                return !0;
        }
        else
            ;
    } return !1; }(); var B, V, q, z = function () { var e; try {
        e = JSON.parse(i.__protected__.getCookie(P));
    }
    catch (n) {
        e = {};
    } return e; }, H = function () { return i.getCurrentDomainFromCookie(P); }, W = function (e, n) { var t = A; A = {}; var r = {}; for (var o in t)
        if (t.hasOwnProperty(o))
            for (var i in r[o] = r[o] || [], t[o])
                t[o].hasOwnProperty(i) && r[o].push(t[o][i]); be(r, e, n); }, J = function () { if (v.execute.invokeCount > 0) {
        var e = G();
        return Ce() && Ie(re(), e, pn.cxenseSiteId), e;
    } return Ce() ? k.__protected__.tryToGetCxPageViewId(Se()) : G(); }; function G() { function e(e, n, t) { t = t || "0"; var r = String(e); return r.length >= n ? r : new Array(n - r.length + 1).join(t) + r; } if (Ce())
        return Se(); var n = i.randomString(16), t = l.hash([s.getFingerprint(), window.location.href].join("")), r = new Date; return [[e(r.getFullYear(), 4), e(r.getMonth() + 1, 2), e(r.getDate(), 2), e(r.getHours(), 2), e(r.getMinutes(), 2), e(r.getSeconds(), 2), e(r.getMilliseconds(), 3)].join("-"), n, t].join("-"); } var Q = function (e) { var n = { path: "/", expires: 1, domain: V.currentDomain }; return e && (n.domain = e), n; }, X = function (e, n) { e.domain = n.domain, e.time = (new Date).getTime(), i.__protected__.setCookie(P, JSON.stringify(e), n); }, $ = function (e) { var n = (new Date).getTime(), t = 6e4 * i.getBrowserTimezoneOffset(), r = i.getAppTimezoneOffset(), o = new Date(e.time).setHours(0, 0, 0, 0) + 864e5 - t - r; return e.time + 18e5 < n || n >= o; }, Y = function () { if (i.__protected__.cameFromFbSubscriptions())
        return !1; if (!V.currentDomain)
        return !1; var e = i.getReferrer(); if (M && M === e)
        return !1; var n = i.getHostname(e), t = new RegExp(V.currentDomain.replace(/\./g, "\\.").replace(/^\\./, "\\.?") + "$").test(n); return Boolean(n) && !t; }, K = function () { var e = z(); (!e || !e.id || !e.time || $(e) || Y()) && (e.id = "v-" + G()), function (e) { var n = Q(); e.domain || V.currentDomain ? X(e, n) : i.waitCall("domainIsReceived", (function (t) { ce(t), n.domain = t, X(e, n); })); }(e), V.visit = e; }, Z = function (e, n, t) { var r, a, c = "manual"; if (void 0 === n)
        n = window.location.href;
    else {
        if ("object" != typeof n)
            throw new Error("First parameter to track page must be a URL or an object");
        var l = n;
        if (void 0 === l.url)
            throw new Error("Must supply url property");
        n = l.url, void 0 !== l.tags && (t = l.tags), void 0 !== l.submitType && (c = l.submitType);
    } t || (t = pn.tags), pn.customPageUrl && (e.custom_page_url = i.prepareUrlParameter(pn.customPageUrl)), void 0 !== t ? "[object Array]" !== Object.prototype.toString.call(t) && "[object String]" !== Object.prototype.toString.call(t) ? (i.log("Tags must be an array or a comma-separated string, ignoring supplied tags"), t = "") : t instanceof Array && (t = t.join(",")) : t = "", q.track(), e.page_session_id = q.pageSessionId, e.track_count = q.trackCount, we(e), pn.contentCreated ? a = pn.contentCreated : pn.contentCreatedSelector && o.queryEl(pn.contentCreatedSelector) && (a = null === (r = o.queryEl(pn.contentCreatedSelector)) || void 0 === r ? void 0 : r.innerHTML), a && (e.content_created = a), "boolean" == typeof pn.contentIsNative && (e.content_is_native = pn.contentIsNative), pn.zone && (e.zone = pn.zone), pn.itemId && (e.item_id = pn.itemId); var u = pn.contentSection || se("section"); u && (e.content_section = u); var d = pn.contentAuthor || se("author"); d && (e.content_author = d); var p = pn.contentId || se("id"); p && (e.content_id = p); var f, m = i.__protected__.getCookie("sailthru_hid"); m && (e.sailthru_hid = m), M && M === i.getReferrer() ? f = "" : (f = i.getReferrer(), M = f), e.referer = i.prepareUrlParameter(f), t && (e.tags = t), e.url = i.prepareUrlParameter(n), e.fingerprint = s.getFingerprint(), e.adblocker = i.getAdblockStatus(), e.adblocker !== i.ADBLOCKER_STATUS.ENABLED_AFTER_DISABLED && e.adblocker !== i.ADBLOCKER_STATUS.ENABLED || (pn.setCustomParam("_abr", i.getAdblockerStatusReason(), "user", !0), pn.setCustomParam("_absh", i.getAdblockerHistoryCookieInfo().cookieValue + "", "user", !0)), e.timezone_offset = i.getBrowserTimezoneOffset(), e.submit_type = c; var g = ae(); return e.visit_id = g, e.new_visit = oe(g), e.keywords = o.getAttr('meta[name="keywords"]', "content") || o.getAttr('meta[name="news_keywords"]', "content") || "", e.title = o.getAttr('meta[property="og:title"]', "content") || "", e.description = o.getAttr('meta[property="og:description"]', "content") || "", e.content_type = o.getAttr('meta[property="og:type"]', "content") || "", ["keywords", "title", "description", "content_type"].forEach((function (n) { e[n] = e[n].substr(0, 8192); })), e.custom_variables = JSON.stringify(pn.customVariables), ne(e), e; }, ee = function () { var e = { aid: pn.aid }, n = i.getTbcCookie(), t = { active: u.getActiveTimeInSeconds(), total: u.getTotalTimeInSeconds() }; n && (e.tbc = n), t.total < t.active && (t.total = t.active), e.time_spent = JSON.stringify(t), e.scroll = JSON.stringify({ max_page_height: d.getMaxDocumentHeight(), max_depth: d.getMaxScrollDepth() }), e.viewport_exit = m.getSumOfCodesDirection(), e.url = i.prepareUrlParameter(window.location.href), we(e), e.visit_id = ae(), ie(); var r = {}, a = p.getAds(200); return a.length && (r.dfp = a), o.isEmptyObject(r) || (e.ads = JSON.stringify(r)), e; }, ne = function (e) { var n = {}; return pn.customParams && (n = o.deepExtend({}, pn.customParams)), o.isEmptyObject(n) || (e.custom_params = JSON.stringify(n)), e; }, te = function () { return q.id; }, re = function () { return O; }, oe = function (e) { var n = V.lastTrackedVisitId !== e; return V.lastTrackedVisitId = e, n; }, ie = function () { V.checkForRefresh = !0; }, ae = function () { return V.checkForRefresh && (K(), V.checkForRefresh = !1), V.visit.id; }, se = function (e) { return (document.head.querySelector("meta[name=" + e + "]") || {}).content; }, ce = function (e) { V.currentDomain = e; }, le = function () { return !(pn.endpoint && pn.endpoint.match(/sandbox/)); }, ue = function (e, t, r, o) { pn.aid && 0 !== pn.aid.length ? le() && i.waitCall("refreshAccessTokenList", (function () { i.waitCall("offerCreate", (function () { a.setTime("track"), i.startCall("pageTrack"), n.callApi(e, t, (function (e) { i.doneCall("pageTrack"), r && r(e); }), pn.getTrackingEndpoint() + "/api/v3", o); })); })) : i.log("Must supply a valid tp.aid before calling tp.init()"); }, de = function () { E && q.trackCount > 0 && (pe(), he()); }, pe = function (e) { if (le())
        try {
            var n = ee();
            m.isInitialized() && m.resetSumOfCodesDirectionToDefault(), r.logBeaconRequest(pn.getTrackingEndpoint() + "/api/v3/page/unload", n), ge();
        }
        catch (e) {
            i.error("main: error on tracking page unload event: ", e);
        } }, fe = function () { T || (T = !0, pe()); }, me = function () { E = !0; }, ge = function () { E = !1; }, ve = function () { E && fe(), W(!0, "beacon_request"), v.__protected__.sendStatisticsExecutedNodes("unload"); }, he = function () { u.resetRecordedTime(); }, we = function (e) { e && (e.pageview_id = te()); }, ye = function (e, n) { if (le())
        try {
            de();
            var t = Z({}, e, n);
            ue("/page/track", t), me();
        }
        catch (e) {
            i.error("main: error on page tracking event: ", e);
        } }, be = function (e, n, t) { }, ke = function () { var e = i.getQueryParamByName(x); e && f.startRedeemVoucher({ voucherCode: e }); }, _e = function () { return S || (S = new Promise((function (e) { if (null !== i.__protected__.getLocalStorageItem(I) && e({ has_active_apple_pay_card: i.__protected__.getLocalStorageItem(I) }), !pn.applePayMerchantId)
        return e({ has_active_apple_pay_card: null }), S; Pe().then((function (n) { var t = function (n) { e({ has_active_apple_pay_card: n }), i.__protected__.setLocalStorageItem(I, n, 7200); }; n ? y.__protected__.applePayCanMakePaymentsWithActiveCard().then(t) : t(null); })); })), S); }; function Ce() { return k.__protected__.isActivated(); } var Ie = function (e, n, t) { return k.__protected__.injectIds(!1, e, n, t); }, Se = function () { return i.__protected__.randomStringCxCompatible(); }; function xe(e) { return function (n) { var t = n.params; void 0 === N && (N = function (e) { if (!Array.isArray(e) || !e.length)
        return !1; for (var n = 0, t = e; n < t.length; n++) {
        var r = t[n];
        if (L.has(r))
            return !0;
    } return !1; }(t)), U = t || [], e(N); }; } function Pe() { return void 0 !== N ? Promise.resolve(N) : F ? (N = !1, Promise.resolve(!1)) : new Promise((function (e) { v.registerCallback("experienceFlow", (function () { N = !0, e(!0); })), C.subscribe("ACTIVE_PAYMENT_METHODS_IDS_INITIALIZED", xe(e)), C.subscribe("MY_ACCOUNT_ACTIVE_PAYMENT_METHODS_IDS_INITIALIZED", xe(e)); })); } return { name: "main", fetchVisitId: ae, trackPageUnloadIfNecessary: de, externalResourcesDelay: _e, pageTrack: ye, trackPage: function (e, n) { return ye(e, n); }, buildPageTrackParams: Z, fetchPageViewId: te, fetchCxBrowserId: re, trackPageUnload: pe, registerTrackUnload: me, isRegisteredTrackUnload: function () { return E; }, unregisterTrackUnload: ge, resetTimer: he, resetAds: function () { p.resetAds(); }, trackAd: function (e, n, t) { A[e] || (A[e] = {}), A[e][n] = t, B(); }, init: function () { if (pn.aid && 0 !== pn.aid.length) {
            var e, n, t;
            B = i.debounce(W, 3e3), V = { currentDomain: H(), lastTrackedVisitId: z().id, visit: {}, checkForRefresh: !1 }, q = { id: J(), pageSessionId: "s-" + G(), trackCount: 0, tracked: !1, track: function () { q.tracked ? q.id = J() : q.tracked = !0, q.trackCount++; } }, Ce() && (e = re(), n = te(), t = pn.cxenseSiteId, k.__protected__.injectIds(!0, e, n, t)), K(), pn.isMockMode || (o.isFunction(p.initialize) && p.initialize(), o.isFunction(u.initialize) && u.initialize(), o.isFunction(d.initialize) && d.initialize()), o.isFunction(g.initialize) && g.initialize(), Pe().then((function (e) { e && (!j && o.isFunction(y.initialize) && (j = !0, y.initialize()), D || -1 !== U.indexOf(R.DATATRANS_APPLE_PAY) && o.isFunction(b.initialize) && (D = !0, b.initialize())); })), o.isFunction(w.__protected__.init) && setTimeout((function () { w.__protected__.init().catch((function () { })); }), 5e3), o.isFunction(c.refreshAccessToken) && c.refreshAccessToken(), _e();
            var r = c.getProvider();
            r && o.isFunction(r.extendUserToken) && r.extendUserToken(), o.on(window, "beforeunload", (function () { return ve(); })), o.on(window, "unload", (function () { return ve(); })), _.addCaptchaV3();
        }
        else
            i.log("Must supply a valid tp.aid before calling tp.init()"); }, checkToRunWidgetImmediately: function () { var e; ke(), (e = i.getQueryParamByName("verification_code")) && "pianoId" === c.getProvider().name && i.waitCall("offerCreate", (function () { h.isUserValid() ? h.__protected__.showEmailConfirmation({ verification_code: e }) : h.show({ verification_code: e }); })), h.checkAndShowEmailIsNotConfirmed(), o.isFunction(f.checkThreeDSRedirect) && f.checkThreeDSRedirect(); }, trackAds: be, appHasApplePay: function () { return N; }, __private__: { VISIT_ID_COOKIE: P, VOUCHER_QUERY: x, collectedAds: A, unloadRegistered: E, unloadTriggered: T, getPageView: function () { return q; }, getVisitContainer: function () { return V; }, track: ue, checkVoucher: ke, setPageViewId: we, currentEnvironmentSupportsPageTrack: le, buildPageUnloadParams: ee, invalidateLastVisit: function () { var e = Q(); t.remove(P, e); }, getCurrentDomain: H, loadLastVisit: z, setVisitCurrentDomain: ce, saveVisitCookie: X, getVisitCookieOptions: Q, isTimeExpired: $, refreshVisit: K, generatePageViewId: G, trackCollectedAds: W, unloadHandler: ve, unloadAction: fe, buildPageCustomParams: ne, hasExternalReferrer: Y } }; };
    pn.container.register("main", { useValue: Pn() }), pn.main = pn.container.resolve("main");
    var En = { predefineValues: [] };
    window.tp && window.tp.length && (En.predefineValues = _e([], window.tp || [], !0)), pn.tpPredefinedOptions = En, pn.container.register("tpPredefinedOptions", { useValue: En });
    var Tn = function () { function e(e, n, t, r, o) { this.tpPredefinedOptions = e, this.css = n, this.tinypassErrorHandler = t, this.gaService = r, this.utilService = o, this.fullTPVersion = !1, this.isInitialized = !1, this.aid = "", this.isSensitiveDataProtectionEnabled = !1, this.affiliateTokenName = "affiliateToken", this.cxCdnUrl = "https://cdn.cxense.com", this.c1XLoadCce = !0, this.c1XIntegrationVersion = "v2", this.cxenseLibAwaitingTimeout = 0, this.cxenseLibAwaitingRetryCount = 0, this.trackPages = !0, this.debug = !1, this.userRef = "", this.usePianoIdLiteUserProvider = !1, this.useTinypassAccounts = !1, this.useCondeUserProvider = !1, this.useGigyaUserProvider = !1, this.usePianoIdUserProvider = !1, this.useAidSpecifiedCookies = !1, this.sandbox = !1, this.zIndexes = { backdrop: 3e5, modal: 300050, close: 300100 }, this.customPreChecks = [], this.customParams = {}, this.externalLibraries = [], this.externalLibrariesCallbacks = [], this.customVariables = {}, this.locale = "", this.trackPageView = !0, this.redirectToFbTimeout = 3, this.isDoubleOptInCheckOnAccessCheckEnabled = !1, this.isMockMode = !1, this.inappBrowserReturn = !1, this.events = [], this.appList = [], this.cacheableShowTemplate = !0, this.initCallbacks = [], this.mainModuleInited = !1, this.restCallbacks = [], this.initTries = 0, this.callbacks = [], n.loadOfferCss(); } return e.prototype.initTp = function () { var e = this; try {
        var n = this.tpPredefinedOptions.predefineValues;
        if (this.tpPredefinedOptions.predefineValues = [], n.forEach((function (n) { "function" == typeof n[1] ? "init" === n[0] ? e.initCallbacks.push(n[1]) : e.restCallbacks.push(n) : "init" === n[1] && "function" == typeof n[2] ? e.initCallbacks.push(n[2]) : e.push(n); })), !this.aid && this.initTries < 10)
            return this.initTries++, void setTimeout((function () { return e.initTp(); }), 50);
        if (!this.aid)
            return;
        for (this.tinypassErrorHandler.initialize(); this.restCallbacks.length;)
            try {
                var t = this.restCallbacks.shift();
                this.push(t);
            }
            catch (e) {
                console.error(e), pn.tinypassErrorHandler.addError(e);
            }
        this._init(), this.externalLibraries.length && this.realizeExternalLibraries(), this.isInitialized = !0, window.___tp = function () { };
    }
    catch (e) {
        pn.tinypassErrorHandler.addError(e, "initTP");
    } }, e.prototype.realizeExternalLibraries = function () { var e = this, n = []; this.externalLibraries.forEach((function (t) { var r = e.requireJsFile(t); n.push(r); })), Promise.all(n).then((function () { if (e.externalLibraries = [], e.externalLibrariesCallbacks)
        for (var n = 0; n < e.externalLibrariesCallbacks.length; ++n)
            Mn.externalLibrariesCallbacks[n](); Mn.externalLibrariesCallbacks = []; })); }, e.prototype.push = function () { for (var e, n, t, r = [], o = 0; o < arguments.length; o++)
        r[o] = arguments[o]; for (e = 0; e < r.length; e++)
        if ("string" == typeof (n = (t = r[e]).shift()) || n instanceof String) {
            if (!this[n])
                return void console.error("Undefined method " + n);
            this[n].apply(this, t);
        }
        else
            n.apply(this, t); }, e.prototype.init = function (e) { this.isInitialized ? (this.mainModuleInited || (this.mainModuleInited = !0, this.initMainModuleAfterInitCbk()), e && e()) : (e && this.tpPredefinedOptions.predefineValues.push(["init", e]), this.initTp()); }, e.prototype._init = function () { if (pn.util && pn.util.hasQueryParamByName && pn.util.hasQueryParamByName("xpdebug") && pn.setDebug(!0), pn.util.setTpccCookies(), pn.util.isSafariOrIOsUiWebView() && !pn.user.isUserValid() && pn.util.getQueryParamByName("userToken")) {
        var e = pn.util.getQueryParamByName("cookieDomain"), n = pn.util.getQueryParamByName("userToken"), t = pn.util.getQueryParamByName("tokenListValue");
        pn.util.setAccessTokenListCookie({ cookie_domain: e, value: t }, n), pn.util.removeQueryParamByName("userToken"), pn.util.removeQueryParamByName("cookieDomain"), pn.util.removeQueryParamByName("tokenListValue");
    } if (this.mainModuleInited || (this.mainModuleInited = !0, this.initMainModuleAfterInitCbk()), !this.aid) {
        var r = new Error("Incorrect aid integration: " + Mn.aid + " url: " + window.location.href);
        this.tinypassErrorHandler.addError(r);
    } pn.logging.setTime("completeInit"); }, e.prototype.initMainModuleAfterInitCbk = function () { for (pn.user.providerInit(), this.appList.indexOf(this.aid) < 0 && (this.appList.push(this.aid), pn.main.init()); this.initCallbacks.length;)
        try {
            this.initCallbacks.shift()();
        }
        catch (e) {
            console.error(e), pn.tinypassErrorHandler.addError(e);
        } if (pn.main.checkToRunWidgetImmediately(), this.events) {
        for (var e = 0; e < this.events.length; e++)
            this.events[e]();
        this.events = [];
    } }, e.prototype.requireJsFile = function (e) { return new Promise((function (n, t) { var r = document.createElement("script"); r.onload = n, r.onerror = n, r.type = "text/javascript", r.charset = "utf-8", r.async = !0, r.src = e, document.getElementsByTagName("head")[0].appendChild(r); })); }, e.prototype.setAid = function (e) { this.aid = e; }, e.prototype.enableSensitiveDataProtection = function (e) { this.isSensitiveDataProtectionEnabled = e; }, e.prototype.reload = function () { location.href = pn.util.removeVoucherCodeFromUrl(location.href); }, e.prototype.removeSharedAccountCodeFromUrl = function () { location.href = pn.util.removeSharedAccountCodeFromUrl(location.href); }, e.prototype.setGAClientId = function (e) { this.gaClientId = e, this.gaService.recreateWithClientId(e); }, e.prototype.getGAClientId = function () { return this.gaClientId; }, e.prototype.enableGACrossDomainLinking = function (e) { var n = this; this.gaCrossDomainLinking = !0; var t = Date.now(), r = function () { var o = window.ga; if (o && "function" == typeof o)
        try {
            o((function (t) { if (void 0 !== t && void 0 === e)
                n.setGAClientId(t.get("clientId"));
            else if (void 0 !== e)
                for (var r = o.getAll(), i = 0; i < r.length; i++) {
                    var a = r[i];
                    if (a.get("trackingId") === e) {
                        n.setGAClientId(a.get("clientId"));
                        break;
                    }
                } }));
        }
        catch (e) { }
    else
        Date.now() - t < 6e4 && setTimeout(r, 500); }; r(); }, e.prototype.setTags = function (e) { this.tags = e instanceof Array ? e.join(",") : e; }, e.prototype.setCookieDomain = function (e) { "." !== e[0] && (e = "." + e), this.cookieDomain = e; }, e.prototype.setCookiePath = function (e) { this.cookiePath = e; }, e.prototype.setDontScrollTopModal = function (e) { this.dontScrollTopModal = e; }, e.prototype.setUseExperience = function (e) { this.useExperience = e; }, e.prototype.setExperimentalIosModal = function (e) { this.experimentalIosModal = e; }, e.prototype.setApplePayMerchantId = function (e) { this.applePayMerchantId = e; }, e.prototype.setContentIsNative = function (e) { this.contentIsNative = e; }, e.prototype.setComposerHost = function (e) { this.composerHost = e; }, e.prototype.setEndpoint = function (e) { this.endpoint = e; }, e.prototype.setAffiliateTokenName = function (e) { this.affiliateTokenName = e; }, e.prototype.setEspEndpoint = function (e) { this.espEndpoint = e; }, e.prototype.setCxCdnUrl = function (e) { this.cxCdnUrl = e; }, e.prototype.setC1XLoadCce = function (e) { this.c1XLoadCce = e; }, e.prototype.setC1XIntegrationVersion = function (e) { this.c1XIntegrationVersion = e; }, e.prototype.setCxenseSiteId = function (e) { this.cxenseSiteId = e; }, e.prototype.setCxenseLibAwaitingTimeout = function (e) { this.cxenseLibAwaitingTimeout = e; }, e.prototype.setCxenseLibAwaitingRetryCount = function (e) { this.cxenseLibAwaitingRetryCount = e; }, e.prototype.setContentId = function (e) { this.contentId = e; }, e.prototype.setTrackPages = function (e) { this.trackPages = e; }, e.prototype.setDebug = function (e) { this.debug = e; }, e.prototype.setUserRef = function (e) { this.userRef = e; }, e.prototype.setUsePianoIdLiteUserProvider = function (e) { this.usePianoIdLiteUserProvider = e; }, e.prototype.setExternalJWT = function (e) { this.externalJWT = e; }, e.prototype.getExternalJWT = function () { return this.externalJWT; }, e.prototype.setUseTinypassAccounts = function (e) { this.useTinypassAccounts = e; }, e.prototype.setUseCondeUserProvider = function (e) { this.useCondeUserProvider = e; }, e.prototype.setUseGigyaUserProvider = function (e) { this.useGigyaUserProvider = e; }, e.prototype.setUsePianoIdUserProvider = function (e) { this.usePianoIdUserProvider = e; }, e.prototype.setPianoIdUrl = function (e) { this.pianoIdUrl = e; }, e.prototype.setItemId = function (e) { this.itemId = e; }, e.prototype.setUseAidSpecifiedCookies = function (e) { this.useAidSpecifiedCookies = e; }, e.prototype.setSandbox = function (e) { this.sandbox = e; }, e.prototype.setContentCreatedSelector = function (e) { this.contentCreatedSelector = e; }, e.prototype.setContentCreated = function (e) { this.contentCreated = e; }, e.prototype.setContentAuthor = function (e) { this.contentAuthor = e; }, e.prototype.setContentSection = function (e) { this.contentSection = e; }, e.prototype.setZone = function (e) { this.zone = e || ""; }, e.prototype.isNonProdEndpoint = function () { return "sandbox" === this.endpoint || /^https?:\/\/(.*sandbox.*|\d+\.dev)\.(tinypass\.com|piano\.io)/i.test(this.endpoint); }, e.prototype.setZIndexes = function (e) { this.zIndexes = e; }, e.prototype.setCustomPreCheck = function (e) { this.customPreChecks.push(e); }, e.prototype.setCustomParam = function (e, n, t, r) { var o = ["content", "user", "request"]; if (t || (t = "content"), t = t.toLowerCase(), o.indexOf(t) < 0)
        throw new Error("Undefined scope " + t + "\nAvailable scopes: " + o.join(", ")); void 0 === this.customParams[t] && (this.customParams[t] = {}), (void 0 === this.customParams[t][e] || r) && (this.customParams[t][e] = []); for (var i = [].concat(n), a = 0; a < i.length; a++) {
        if ("string" != typeof i[a])
            throw new Error("setCustomParam accept only string values or array of strings");
        this.customParams[t][e].push(i[a]);
    } }, e.prototype.resetCustomParam = function (e) { e || (e = "content"), delete this.customParams[e]; }, e.prototype.addExternalLibrary = function (e, n) { if ("string" == typeof e)
        this.externalLibraries.push(e);
    else
        for (var t = 0; t < e.length; ++t)
            this.externalLibraries.push(e[t]); n && this.externalLibrariesCallbacks.push(n), this.isInitialized && this.realizeExternalLibraries(); }, e.prototype.setCustomVariable = function (e, n) { this.customVariables[e] = n; }, e.prototype.saveCustomVariablesToLocalStorage = function (e) { if (this.customVariables && "localStorage" in window && null !== window.localStorage) {
        var n = "__tp-customVariables";
        window.localStorage.setItem(n, JSON.stringify(this.customVariables)), e && window.localStorage.setItem(n + "-expiration", Math.floor((new Date).getTime() / 1e3) + e + "");
    } }, e.prototype.restoreCustomVaribalesFromLocalstorage = function () { if ("localStorage" in window && null !== window.localStorage) {
        var e = Mn.util.__protected__.getLocalStorageItem("customVariables");
        if (Mn.util.__protected__.removeLocalStorageItem("customVariables"), e)
            for (var n in e)
                this.customVariables[n] = e[n];
    } }, e.prototype.handler = function (e, n) { var t = this.registerPrefixedEvents; return function () { for (var r, o = [pn.offer, pn.template, pn.meter, pn.experience, pn.myaccount, pn.pianoId, pn.tinypassLogin, pn.swg, pn.user, pn.credit], i = 0; i < o.length; i++) {
        var a = o[i];
        if (a) {
            var s = a.registerCallback(e, n);
            void 0 !== s && (r = s), void 0 !== (s = t(a, e, n)) && (r = s);
        }
    } return r; }; }, e.prototype.registerPrefixedEvents = function (e, n, t) { for (var r, o, i, a = [{ module: "offer", prefix: "checkout" }, { module: "pianoId", prefix: "pianoId" }], s = 0; s < a.length; s++) {
        var c = a[s];
        e.name === c.module && n.substring(0, c.prefix.length) === c.prefix && (r = n.substring(c.prefix.length, c.prefix.length + 1).toLowerCase() + n.substring(c.prefix.length + 1, n.length), void 0 !== (o = e.registerCallback(r, t)) && (i = o));
    } return i; }, e.prototype.addHandler = function (e, n) { var t = this.handler(e, n); this.isInitialized ? t() : this.events.push(t); }, e.prototype.setTrackPageview = function (e) { this.trackPageView = e; }, e.prototype.setLocale = function (e) { var n = this; this.locale = e, this.utilService.__protected__.setCookie("LANG", this.locale), this.isInitialized ? this.changeLocale(e) : this.initCallbacks.push((function () { n.changeLocale(e); })); }, e.prototype.setPageURL = function (e) { this.customPageUrl = e; }, e.prototype.setAdblockerCookieName = function (e) { this.adblockerCookieName = e; }, e.prototype.setMaxCookieExpirationInDays = function (e) { var n = "string" == typeof e ? parseInt(e, 10) : e; if (!(isFinite(n) && n > 0))
        throw new Error("maxCookieExpirationInDays must be a positive number"); this.maxCookieExpirationInDays = n; }, e.prototype.getMaxCookieExpirationInDays = function () { return this.maxCookieExpirationInDays; }, e.prototype.setFbPixelId = function (e) { this.fbPixelId = e; }, e.prototype.getFbPixelId = function () { return this.fbPixelId; }, e.prototype.setRedirectToFbTimeout = function (e) { this.redirectToFbTimeout = e; }, e.prototype.enableDoubleOptInCheckOnAccessCheck = function () { this.isDoubleOptInCheckOnAccessCheckEnabled = !0; }, e.prototype.setCloudflareWorkerUrl = function (e) { this.cloudflareWorkerUrl = e; }, e.prototype.getEndpoint = function (e, n) { return e.lastIndexOf("/") === e.length - 1 && (e = e.substr(0, e.length - 1)), e.match(/\/v3$/) && (e = e.substr(0, e.lastIndexOf("/v3"))), e.match(/\/api$/) && (e = e.substr(0, e.lastIndexOf("/api"))), e.match(/^(http[s]?:)?\/\//) || (e = "//" + e), void 0 !== n && n && !e.match(/^http[s]?:/) && (e = "https:" + e), e; }, e.prototype._getEndpointRoot = function (e) { var n = "https://buy.tinypass.com"; return !0 === this.sandbox && (this.endpoint = "sandbox"), this.endpoint && ("sandbox" === this.endpoint ? n = "https://sandbox.tinypass.com" : "prod" !== this.endpoint && "production" !== this.endpoint && (n = this.endpoint)), this.getEndpoint(n, e); }, e.prototype._getApiEndpoint = function () { return this._getEndpointRoot() + "/api/v3"; }, e.prototype._getTrackingEndpoint = function (e) { void 0 === e && (e = ""); var n = e || this.endpoint; return !0 === this.sandbox ? n = "https://sandbox.tinypass.com" : (void 0 === this.endpoint || null === this.endpoint || "" === this.endpoint || "prod" === this.endpoint || "production" === this.endpoint || this.endpoint.match(/(buy|api|api-v3)\.tinypass\.com/)) && (n = e || "https://api-v3.tinypass.com"), this.getEndpoint(n, !0); }, e.prototype._getExperienceEndpoint = function (e) { var n = "https://c2.piano.io"; return this.composerHost ? n = this.composerHost : (!0 === this.sandbox && (this.endpoint = "sandbox"), this.endpoint && ("sandbox" === this.endpoint ? n = "https://c2-sandbox.piano.io" : "prod" !== this.endpoint && "production" !== this.endpoint && (n = (n = (n = (n = (n = (n = (n = (n = (n = (n = (n = (n = (n = (n = (n = (n = (n = (n = this.endpoint).replace("//buy.tinypass.com", "//c2.piano.io")).replace("//api.tinypass.com", "//c2.piano.io")).replace("//buy-au.piano.io", "//c2-au.piano.io")).replace("//api-au.piano.io", "//c2-au.piano.io")).replace("//buy-ap.piano.io", "//c2-ap.piano.io")).replace("//api-ap.piano.io", "//c2-ap.piano.io")).replace("//buy-eu.piano.io", "//c2-eu.piano.io")).replace("//api-eu.piano.io", "//c2-eu.piano.io")).replace("//sandbox.tinypass.com", "//c2-sandbox.piano.io")).replace("//sandbox.piano.io", "//c2-sandbox.piano.io")).replace("//experience-au.piano.io", "//c2-au.piano.io")).replace("//experience-eu.piano.io", "//c2-eu.piano.io")).replace("//experience-ap.piano.io", "//c2-ap.piano.io")).replace("//experience.tinypass.com", "//c2.piano.io")).replace("//buy.piano.io", "//c2.piano.io")).replace("//api.piano.io", "//c2.piano.io")).replace("//experience.piano.io", "//c2.piano.io")))), this.getEndpoint(n, e); }, e.prototype._isSandbox = function () { return this.sandbox || "sandbox" === this.endpoint || !!this.endpoint && -1 !== this.endpoint.indexOf("//sandbox.tinypass.com"); }, e.prototype.changeLocale = function (e) { pn.pianoId.isConfigured() && pn.pianoId.updateLang(e), pn.postmessage.broadcast("langChanged", { lang: e }); }, e.prototype.pageTrack = function (e, n) { pn.main.pageTrack(e, n); }, e.prototype.trackPage = function (e, n) { pn.main.pageTrack(e, n); }, e.prototype.trackPageUnload = function () { pn.main.trackPageUnload(); }, e.prototype.trackAds = function (e) { pn.main.trackAds(e); }, e.prototype.trackAd = function (e, n, t) { pn.main.trackAd(e, n, t); }, e.prototype.onLoad = function (e) { this.callbacks.push(e); }, e.prototype.getEndpointRoot = function (e) { return this._getEndpointRoot(e); }, e.prototype.getExperienceEndpoint = function (e) { return this._getExperienceEndpoint(e); }, e.prototype.getApiEndpoint = function () { return this._getApiEndpoint(); }, e.prototype.getTrackingEndpoint = function (e) { return void 0 === e && (e = ""), this._getTrackingEndpoint(e); }, e.prototype.isSandbox = function () { return this._isSandbox(); }, e.prototype.setCacheableShowTemplate = function (e) { this.cacheableShowTemplate = e; }, e.prototype.getCacheableShowTemplate = function () { return this.cacheableShowTemplate; }, e = function (e, n, t, r) { var o, i = arguments.length, a = i < 3 ? n : null === r ? r = Object.getOwnPropertyDescriptor(n, t) : r; if ("object" == typeof Reflect && "function" == typeof Reflect.decorate)
        a = Reflect.decorate(e, n, t, r);
    else
        for (var s = e.length - 1; s >= 0; s--)
            (o = e[s]) && (a = (i < 3 ? o(a) : i > 3 ? o(n, t, a) : o(n, t)) || a); return i > 3 && a && Object.defineProperty(n, t, a), a; }([pn.singleton(), be(0, pn.inject("tpPredefinedOptions")), be(1, pn.inject("css")), be(2, pn.inject("tinypassErrorHandler")), be(3, pn.inject("gaService")), be(4, pn.inject("util")), ke("design:paramtypes", [Object, Object, Object, Object, Object])], e), e; }();
    pn.container.registerSingleton("tinypass", Tn);
    var An = pn.container.resolve("tinypass");
    [{ n: "polyfill", hM: !1 }, { n: "predefine", hM: !1 }, { n: "predefineTinypass", hM: !1 }, { n: "checkTinypass", hM: !1 }, { n: "css", hM: !0 }, { n: "ajax", hM: !0 }, { n: "jqUtils", hM: !0 }, { n: "cookie", hM: !0 }, { n: "localStorage", hM: !0 }, { n: "versionService", hM: !0 }, { n: "itp", hM: !0 }, { n: "util", hM: !0 }, { n: "api", hM: !0 }, { n: "postmessage", hM: !0 }, { n: "eventUtils", hM: !0 }, { n: "janrain", hM: !0 }, { n: "sha1", hM: !0 }, { n: "containerUtils", hM: !0 }, { n: "tinypassLogin", hM: !0 }, { n: "tinypassAccounts", hM: !0 }, { n: "condeUserProvider", hM: !0 }, { n: "gigya", hM: !0 }, { n: "jwtDecode", hM: !0 }, { n: "log", hM: !0 }, { n: "logging", hM: !0 }, { n: "observer", hM: !0 }, { n: "gaService", hM: !0 }, { n: "pianoIdLite", hM: !0 }, { n: "pianoId", hM: !0 }, { n: "user", hM: !0 }, { n: "viewportExit", hM: !0 }, { n: "template", hM: !0 }, { n: "offer", hM: !0 }, { n: "myaccount", hM: !0 }, { n: "meter", hM: !0 }, { n: "fingerprint", hM: !0 }, { n: "scrollDepth", hM: !0 }, { n: "idle", hM: !0 }, { n: "interaction", hM: !0 }, { n: "recWidgetService", hM: !0 }, { n: "piano", hM: !0 }, { n: "pianoEsp", hM: !0 }, { n: "swg", hM: !0 }, { n: "fbpixel", hM: !0 }, { n: "fbsubscriptions", hM: !0 }, { n: "cxense", hM: !0 }, { n: "experience", hM: !0 }, { n: "ifvisible", hM: !0 }, { n: "activetimer", hM: !0 }, { n: "doubleClickForPublisher", hM: !0 }, { n: "applePay", hM: !0 }, { n: "goCardlessDropin", hM: !0 }, { n: "applePayIntegrationService", hM: !0 }, { n: "datatransApplePayIntegrationService", hM: !0 }, { n: "stripeApplePayIntegrationService", hM: !0 }, { n: "obi3DSChallenge", hM: !0 }, { n: "amp", hM: !0 }, { n: "performanceMetrics", hM: !0 }, { n: "doubleOptIn", hM: !0 }, { n: "newscycle", hM: !0 }, { n: "captchaV3", hM: !0 }, { n: "main", hM: !0 }, { n: "tinypassErrorHandler", hM: !0 }, { n: "tinypass", hM: !0 }, { n: "postProcessing", hM: !1 }].forEach((function (e) { e.hM && !pn.container.isRegistered(e.n) && pn.container.resolve(e.n); })), Object.assign(pn, An), Object.setPrototypeOf(pn, Tn.prototype);
    var Mn = window.tp = pn;
    pn.initTp(), console.log("Piano SDK 2.0 loaded.");
    e.cxense = ln, e.experience = un, e.jqUtils = de, e.log = Oe, e.main = Pn, e.offer = Ge, e.pianoEsp = on, e.pianoId = qe, e.postProcessing = "postProcessing", e.tinypassErrorHandler = xn, e.user = He, e.util = Ce, Object.defineProperty(e, "__esModule", { value: !0 });
}({});
//# sourceMappingURL=tinypass.js.map

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/compat get default export */
/******/ 	(() => {
/******/ 		// getDefaultExport function for compatibility with non-harmony modules
/******/ 		__webpack_require__.n = (module) => {
/******/ 			var getter = module && module.__esModule ?
/******/ 				() => (module['default']) :
/******/ 				() => (module);
/******/ 			__webpack_require__.d(getter, { a: getter });
/******/ 			return getter;
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/define property getters */
/******/ 	(() => {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = (exports, definition) => {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	(() => {
/******/ 		__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	(() => {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = (exports) => {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	})();
/******/ 	
/************************************************************************/
var __webpack_exports__ = {};
// This entry need to be wrapped in an IIFE because it need to be in strict mode.
(() => {
"use strict";
/*!*****************!*\
  !*** ./main.js ***!
  \*****************/
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _dist_index__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../dist/index */ "../dist/index.js");


const mixpanelPresented = {
    service: 'mixpanel',
    action: 'Membership Block',
    status: 'Presented',
};
const mixpanelAccepted = {
    service: 'mixpanel',
    action: 'Membership Block',
    status: 'Accepted',
};

const anon = [["userSegment", 'demon']];

const piano = new _dist_index__WEBPACK_IMPORTED_MODULE_0__["default"]({
    adServicer: 'piano',
    matchers: anon,
    thirdPartyCallbacks: [
        mixpanelPresented,
        mixpanelAccepted,
    ],
    tags: [["testing"]],
});

piano.dispatchAd();
})();

/******/ })()
;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnVuZGxlLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUEyQztBQUMzQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNlO0FBQ2Ysa0JBQWtCLDBIQUEwSDtBQUM1STtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLHNEQUFZO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsc0RBQVk7QUFDdkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7Ozs7OztBQ3BGQSxpQkFBaUIsU0FBSSxJQUFJLFNBQUk7QUFDN0IsNEJBQTRCLCtEQUErRCxpQkFBaUI7QUFDNUc7QUFDQSxvQ0FBb0MsTUFBTSwrQkFBK0IsWUFBWTtBQUNyRixtQ0FBbUMsTUFBTSxtQ0FBbUMsWUFBWTtBQUN4RixnQ0FBZ0M7QUFDaEM7QUFDQSxLQUFLO0FBQ0w7QUFDQSw4QkFBOEIsU0FBSSxJQUFJLFNBQUk7QUFDMUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNpQjtBQUNGO0FBQ2Ysa0JBQWtCLHFGQUFxRjtBQUN2RztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsUUFBUTtBQUM1QixvQkFBb0IsVUFBVTtBQUM5QixvQkFBb0IscUJBQXFCO0FBQ3pDLGtCQUFrQjtBQUNsQjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCLDJCQUEyQjtBQUMzQixpQkFBaUIsb0JBQW9CO0FBQ3JDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQixnQkFBZ0I7QUFDbEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9DQUFvQyxRQUFRO0FBQzVDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDLHdDQUF3Qyx1QkFBdUI7QUFDaEc7QUFDQSxzQkFBc0IsTUFBTTtBQUM1QjtBQUNBO0FBQ0EsZ0RBQWdELDZDQUE2QztBQUM3RixhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0NBQXdDLHlFQUF5RTtBQUNqSCxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0Q0FBNEMseUVBQXlFO0FBQ3JILHlCQUF5QjtBQUN6QixxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakIsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRCx1Q0FBdUMsNEJBQTRCO0FBQ25FO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7OztBQy9SQSxlQUFlLG1CQUFPLENBQUMsNkNBQVk7QUFDbkM7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7QUNKQTtBQUNBO0FBQ0EsaUhBQWlILHlCQUF5QjtBQUMxSSwrRUFBK0UsK0JBQStCLHNCQUFzQjtBQUNwSTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVUsV0FBVyxrQ0FBa0M7QUFDdkQ7QUFDQSx1QkFBdUI7QUFDdkIsMEJBQTBCO0FBQzFCLDZCQUE2QixpQkFBaUI7QUFDOUMsNkJBQTZCO0FBQzdCLDZCQUE2Qiw4QkFBOEIsNkJBQTZCLGFBQWEsNkJBQTZCLHdCQUF3QjtBQUMxSiwwQkFBMEI7QUFDMUIsaUJBQWlCLGtDQUFrQztBQUNuRCxpQ0FBaUMsOENBQThDLDJDQUEyQyxzQkFBc0IsUUFBUSwwREFBMEQsMkNBQTJDLGNBQWMsZUFBZSxRQUFRLGtCQUFrQiwwQ0FBMEMsZ0JBQWdCLG9DQUFvQyxvQkFBb0IsdUNBQXVDLG9CQUFvQixvQ0FBb0Msc0JBQXNCLHVDQUF1QyxzQkFBc0IsOEJBQThCLHlCQUF5QjtBQUMvb0IseUNBQXlDLG1EQUFtRCxtS0FBbUssYUFBYTtBQUM1USxxQ0FBcUMsc0NBQXNDLGdCQUFnQixzQ0FBc0MsbUJBQW1CLHFCQUFxQjtBQUN6SywrQ0FBK0M7QUFDL0MsdUJBQXVCLGVBQWUsd0JBQXdCO0FBQzlELG9CQUFvQiw4RUFBOEU7QUFDbEcsMEJBQTBCO0FBQzFCLGlCQUFpQixvQkFBb0IsNkNBQTZDLHFDQUFxQztBQUN2SCx1QkFBdUIsMkRBQTJEO0FBQ2xGLGtCQUFrQixpQ0FBaUM7QUFDbkQsZUFBZSxrREFBa0Q7QUFDakU7QUFDQTtBQUNBO0FBQ0EsY0FBYztBQUNkO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTixtQkFBbUIsd0JBQXdCLHNCQUFzQjtBQUNqRSx1Q0FBdUM7QUFDdkM7QUFDQSxvQkFBb0I7QUFDcEIsb0JBQW9CO0FBQ3BCLDBCQUEwQixnQkFBZ0IsbU1BQW1NLGdEQUFnRCx5QkFBeUIsbUJBQW1CLG9DQUFvQywyQ0FBMkMsTUFBTSw2Q0FBNkMsWUFBWSxtREFBbUQscUJBQXFCLHdCQUF3QixzQkFBc0I7QUFDN2tCLDZCQUE2QixZQUFZLG9CQUFvQixrQ0FBa0MsUUFBUSxNQUFNO0FBQzdHLG9CQUFvQjtBQUNwQixvQkFBb0I7QUFDcEIsb0JBQW9CO0FBQ3BCLG9CQUFvQjtBQUNwQiwwQkFBMEIsZUFBZSwrQkFBK0IsMkNBQTJDLHFDQUFxQyxzQ0FBc0Msa0RBQWtELG1DQUFtQyxnQkFBZ0Isa0NBQWtDLGlDQUFpQyxzQ0FBc0MsbURBQW1ELHlDQUF5Qyw4QkFBOEIsbUNBQW1DLDZEQUE2RCxvQ0FBb0MsNEJBQTRCLHNDQUFzQywyREFBMkQsTUFBTSx1QkFBdUIsZUFBZSx5REFBeUQsb0JBQW9CLHVCQUF1QjtBQUN2NUIsMEJBQTBCLG1HQUFtRyxpR0FBaUcsOEJBQThCLDZLQUE2SyxlQUFlO0FBQ3hiLDJCQUEyQixlQUFlLHlEQUF5RCxvQkFBb0Isd0JBQXdCLGVBQWUseURBQXlELG9CQUFvQix1QkFBdUIsMERBQTBELGlDQUFpQyxnQkFBZ0Isc0VBQXNFLG1EQUFtRCxPQUFPLDJCQUEyQix3QkFBd0Isc0JBQXNCLHNDQUFzQyxZQUFZLGFBQWE7QUFDcm5CLGlDQUFpQyxVQUFVO0FBQzNDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVixrSEFBa0gsK0JBQStCLHlCQUF5QixVQUFVLCtDQUErQyxpQ0FBaUMsYUFBYSx1QkFBdUIsYUFBYSxJQUFJLG1EQUFtRCwwQkFBMEIsYUFBYSxJQUFJLG9EQUFvRDtBQUMzYztBQUNBLHNDQUFzQyxhQUFhLElBQUksd0JBQXdCO0FBQy9FO0FBQ0Esc0NBQXNDLGFBQWEsSUFBSSx3QkFBd0I7QUFDL0U7QUFDQSxNQUFNLFdBQVcsaURBQWlELGFBQWEsSUFBSSx3QkFBd0IsSUFBSSwwQ0FBMEMsNkJBQTZCLGlDQUFpQztBQUN2Tix1R0FBdUc7QUFDdkc7QUFDQTtBQUNBLE1BQU0sbUJBQW1CLGtEQUFrRDtBQUMzRTtBQUNBO0FBQ0EsTUFBTSw0SUFBNEksa0VBQWtFLFVBQVU7QUFDOU47QUFDQTtBQUNBLHFGQUFxRixTQUFTO0FBQzlGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0I7QUFDbEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU8sc0VBQXNFLFVBQVU7QUFDdkY7QUFDQTtBQUNBLHNGQUFzRixTQUFTO0FBQy9GO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0I7QUFDbEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU8sc0RBQXNEO0FBQzdELDJDQUEyQywyR0FBMkcsaWRBQWlkLDZDQUE2QyxjQUFjLDZCQUE2QixxQ0FBcUM7QUFDcHVCLHVHQUF1RztBQUN2RyxzQ0FBc0MscUNBQXFDO0FBQzNFO0FBQ0EsTUFBTSxnQ0FBZ0MsK0RBQStELCtDQUErQyx3SEFBd0gsb0NBQW9DLDRHQUE0Ryw2Q0FBNkMsVUFBVTtBQUNuZCxnRUFBZ0UsU0FBUztBQUN6RTtBQUNBLDhEQUE4RCx3QkFBd0IsdUJBQXVCLGdDQUFnQztBQUM3STtBQUNBO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTyxtREFBbUQsMkJBQTJCO0FBQ3JGLGdFQUFnRSxTQUFTO0FBQ3pFO0FBQ0EsbUNBQW1DLG1EQUFtRCxrREFBa0QscURBQXFELDJDQUEyQyxNQUFNO0FBQzlPO0FBQ0E7QUFDQTtBQUNBLGNBQWM7QUFDZDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNLFdBQVcsc0RBQXNELHVCQUF1QixxQkFBcUIsNENBQTRDLHlCQUF5QixJQUFJLHFEQUFxRCx1QkFBdUIscUJBQXFCLDZDQUE2Qyx5QkFBeUIsSUFBSSwrQ0FBK0MsNEdBQTRHLG1EQUFtRCxtSEFBbUgsNENBQTRDLGNBQWM7QUFDbHVCLDZDQUE2Qyx5QkFBeUIsSUFBSSxrQkFBa0I7QUFDNUY7QUFDQTtBQUNBO0FBQ0EsTUFBTSx5Q0FBeUMsK0NBQStDLGdEQUFnRCxjQUFjLHlCQUF5QixnQkFBZ0I7QUFDck07QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVLE1BQU07QUFDaEIsbUJBQW1CLHNCQUFzQix3QkFBd0IsbUdBQW1HLDhDQUE4QyxlQUFlLFFBQVE7QUFDek87QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhCQUE4QixXQUFXLGtCQUFrQixJQUFJLDBCQUEwQiwwQkFBMEIsOEJBQThCLGFBQWE7QUFDOUosMkNBQTJDLDRCQUE0QjtBQUN2RSwrQ0FBK0MsbUJBQW1CLGFBQWEsR0FBRyx5QkFBeUIsMEJBQTBCO0FBQ3JJO0FBQ0EsMkJBQTJCO0FBQzNCLGlEQUFpRCxzQkFBc0Isb0NBQW9DLDhDQUE4QyxtQ0FBbUMsNENBQTRDLGFBQWEscUVBQXFFLHlDQUF5QyxXQUFXLDhCQUE4QixnREFBZ0QsaUNBQWlDLHNEQUFzRCxZQUFZO0FBQy9oQix5RkFBeUY7QUFDekY7QUFDQSxrREFBa0QsY0FBYztBQUNoRTtBQUNBLE1BQU0sV0FBVywyQkFBMkIsNkJBQTZCLFdBQVcsNENBQTRDLE9BQU8sc0JBQXNCLHVDQUF1Qyw2REFBNkQsYUFBYTtBQUM5UTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkNBQTZDLG9CQUFvQixJQUFJO0FBQ3JFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEJBQThCLGdEQUFnRDtBQUM5RSxtQ0FBbUMsY0FBYztBQUNqRDtBQUNBO0FBQ0E7QUFDQSxjQUFjLHdDQUF3QztBQUN0RDtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1DQUFtQyxzQ0FBc0MseUNBQXlDLDZIQUE2SCxLQUFLLElBQUkseUNBQXlDLGlCQUFpQixvQkFBb0Isc0JBQXNCLGFBQWEsY0FBYyxlQUFlLGdCQUFnQiwwQkFBMEIsc0JBQXNCLGlCQUFpQixzQ0FBc0MsR0FBRywwQkFBMEIsa0JBQWtCLEdBQUcsaUNBQWlDLHVCQUF1Qix1QkFBdUIsZ0JBQWdCLGFBQWEsbUJBQW1CLEdBQUcsdUJBQXVCLG9CQUFvQix5QkFBeUIsaUJBQWlCLG1CQUFtQixrQkFBa0IsbUJBQW1CLG9XQUFvVyxtQkFBbUIsb0RBQW9ELG9CQUFvQixzQkFBc0IsMEJBQTBCLGlCQUFpQixzQkFBc0IsaUNBQWlDLCtCQUErQiw0QkFBNEIsdUJBQXVCLEdBQUcseURBQXlELHNEQUFzRCxHQUFHLDZCQUE2Qix1QkFBdUIsR0FBRyxpQ0FBaUMscUJBQXFCLGlCQUFpQiw2QkFBNkIsR0FBRyx1REFBdUQsbUJBQW1CLGdCQUFnQixHQUFHLGlFQUFpRSxXQUFXLGFBQWEsZ0JBQWdCLGlCQUFpQixxQkFBcUIsa0JBQWtCLHFCQUFxQixpREFBaUQsNlFBQTZRLGlCQUFpQixHQUFHLDJFQUEyRSxpQkFBaUIsR0FBRywySUFBMkkscUJBQXFCLGlCQUFpQixrREFBa0QsZUFBZSxHQUFHLDhFQUE4RSxnQkFBZ0IsWUFBWSxzQkFBc0Isa0RBQWtELEdBQUcscUtBQXFLLHNCQUFzQixtREFBbUQsR0FBRyxlQUFlLHNCQUFzQixHQUFHLHdDQUF3QywyQkFBMkIsbUJBQW1CLE9BQU8sNkRBQTZELHVCQUF1QixnQkFBZ0IsT0FBTyxHQUFHLDJDQUEyQyxtQkFBbUIsb0JBQW9CLEdBQUcsa0JBQWtCLGtDQUFrQyxvQkFBb0Isd0NBQXdDLEdBQUcsb0NBQW9DLHVDQUF1QyxHQUFHLCtDQUErQyxxQkFBcUIsR0FBRyw0Q0FBNEMseUJBQXlCLEdBQUcsc0JBQXNCLHlCQUF5Qix3QkFBd0IsK0NBQStDLEdBQUcsZ0NBQWdDLHNCQUFzQixHQUFHLGFBQWEseUJBQXlCLG9DQUFvQyxvQkFBb0Isc0JBQXNCLGFBQWEsZ0JBQWdCLGNBQWMsZUFBZSxzQ0FBc0MsR0FBRyx5QkFBeUIseUVBQXlFLG9CQUFvQixHQUFHLCtCQUErQix5QkFBeUIsMkJBQTJCLEdBQUcsZ0NBQWdDLGtCQUFrQiw2QkFBNkIsdUJBQXVCLHFCQUFxQix1QkFBdUIsbUJBQW1CLGlCQUFpQixHQUFHLHVDQUF1QyxxQkFBcUIsb0JBQW9CLGtCQUFrQixHQUFHLFdBQVcsNEJBQTRCLHNCQUFzQixzQkFBc0Isd0JBQXdCLGdDQUFnQyx5QkFBeUIseUJBQXlCLDZCQUE2Qiw0QkFBNEIsa0JBQWtCLG1CQUFtQiwwREFBMEQsMEJBQTBCLGtDQUFrQyx3QkFBd0IseUVBQXlFLDBCQUEwQixpQkFBaUIsR0FBRyw2QkFBNkIscUJBQXFCLGtCQUFrQixzQ0FBc0MsR0FBRyxtQkFBbUIseUJBQXlCLGFBQWEsY0FBYyw2QkFBNkIsaUJBQWlCLGtCQUFrQixtQkFBbUIsb0JBQW9CLHlCQUF5QixrQkFBa0IsMkJBQTJCLDZDQUE2QyxzQkFBc0IsR0FBRyw4QkFBOEIsb0JBQW9CLG9CQUFvQixHQUFHLHNDQUFzQyx1QkFBdUIsR0FBRyxnQ0FBZ0Msa0JBQWtCLG1CQUFtQixtQ0FBbUMsR0FBRyxpQkFBaUIsZ0JBQWdCLDBCQUEwQix1QkFBdUIsZ0JBQWdCLGlCQUFpQixHQUFHLG1CQUFtQixnQ0FBZ0MsK0NBQStDLEdBQUcseUJBQXlCLG1CQUFtQixtQkFBbUIsdUJBQXVCLGFBQWEsZUFBZSxlQUFlLGlCQUFpQix1QkFBdUIscUJBQXFCLEdBQUcsZ0NBQWdDLDRCQUE0QiwyQkFBMkIsR0FBRyxnQ0FBZ0MsNkJBQTZCLHlCQUF5QixHQUFHLGdDQUFnQyw2QkFBNkIsMkJBQTJCLEdBQUcsZ0NBQWdDLDZCQUE2QiwyQkFBMkIsR0FBRyxnQ0FBZ0MsOEJBQThCLDJCQUEyQixHQUFHLGdDQUFnQyw4QkFBOEIsMkJBQTJCLEdBQUcsZ0NBQWdDLDhCQUE4QiwyQkFBMkIsR0FBRyxnQ0FBZ0MsOEJBQThCLDJCQUEyQixHQUFHLGdDQUFnQyw4QkFBOEIsMkJBQTJCLEdBQUcsaUNBQWlDLDhCQUE4QiwyQkFBMkIsR0FBRyxpQ0FBaUMsOEJBQThCLDJCQUEyQixHQUFHLGlDQUFpQyw4QkFBOEIsd0JBQXdCLEdBQUcseUJBQXlCLFFBQVEsaUJBQWlCLEtBQUssVUFBVSxpQkFBaUIsS0FBSyxHQUFHLDRDQUE0QyxjQUFjLHVCQUF1QixhQUFhLGNBQWMscUNBQXFDLEdBQUcsaUpBQWlKLG9CQUFvQixHQUFHLGdCQUFnQixvQkFBb0IsY0FBYyxZQUFZLGdCQUFnQixHQUFHLGtGQUFrRiw4QkFBOEIsR0FBRyx5QkFBeUIsZ0JBQWdCLGNBQWMsK0JBQStCLHVDQUF1QywrQkFBK0IsR0FBRyxTQUFTO0FBQ3orUCxtQ0FBbUMsYUFBYTtBQUNoRCxpQ0FBaUMsU0FBUyw0REFBNEQsa05BQWtOLGFBQWEsU0FBUyxHQUFHO0FBQ2pWLG1EQUFtRCxnQkFBZ0Isc0NBQXNDLG9IQUFvSCwyQ0FBMkM7QUFDeFEsbUVBQW1FLHNEQUFzRCwrQkFBK0IsaUdBQWlHLDJWQUEyVixHQUFHLG9EQUFvRCxtRUFBbUU7QUFDOXNCO0FBQ0E7QUFDQTtBQUNBLG9DQUFvQyx3R0FBd0c7QUFDNUk7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTLG9DQUFvQztBQUM3Qyw2Q0FBNkMsZ0NBQWdDLG1CQUFtQjtBQUNoRyxtQkFBbUIsT0FBTyw0RUFBNEUsa0VBQWtFO0FBQ3hLLDZCQUE2QjtBQUM3QjtBQUNBLDJCQUEyQixrQ0FBa0M7QUFDN0QsOEJBQThCLG1CQUFtQjtBQUNqRCwyQkFBMkIsbUJBQW1CLCtDQUErQyxrQ0FBa0M7QUFDL0g7QUFDQSx3QkFBd0IsbUNBQW1DLElBQUk7QUFDL0QscUJBQXFCLGFBQWEsa0ZBQWtGLGlDQUFpQztBQUNySiwyQ0FBMkM7QUFDM0MscUJBQXFCLHdGQUF3RixxQkFBcUIsdURBQXVELDhEQUE4RCw2Q0FBNkMsdUJBQXVCLDhCQUE4QixpREFBaUQsaUlBQWlJLGlDQUFpQyxvQkFBb0IsaUJBQWlCLGlIQUFpSCxtQ0FBbUMsYUFBYSwySEFBMkgsK0JBQStCLDRCQUE0QixXQUFXLG9CQUFvQixJQUFJLG1DQUFtQyxpRUFBaUUsd0RBQXdELElBQUksZ0NBQWdDLFdBQVcsc0NBQXNDO0FBQzVyQztBQUNBLDhCQUE4QiwwQkFBMEI7QUFDeEQ7QUFDQTtBQUNBO0FBQ0EscUJBQXFCLCtCQUErQixvREFBb0Q7QUFDeEcsMkNBQTJDO0FBQzNDLHVCQUF1Qix3QkFBd0I7QUFDL0Msb0NBQW9DLGNBQWM7QUFDbEQsMkJBQTJCLHVCQUF1QixnQ0FBZ0Msd0JBQXdCLCtCQUErQix3QkFBd0I7QUFDakssbUJBQW1CLGlEQUFpRCxpQ0FBaUMsa0JBQWtCO0FBQ3ZIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTyxRQUFRLDJCQUEyQix1QkFBdUIsNEJBQTRCLHdCQUF3QixzQkFBc0I7QUFDM0ksNkJBQTZCLGVBQWUsNEJBQTRCO0FBQ3hFLHFJQUFxSSxjQUFjO0FBQ25KLGlCQUFpQixhQUFhLFNBQVMseUJBQXlCLGtFQUFrRSx5QkFBeUIsZ0pBQWdKLFNBQVMsd0VBQXdFLGdDQUFnQyxpRUFBaUUsZ0NBQWdDLGlFQUFpRSw0Q0FBNEMsc0JBQXNCLHVCQUF1Qiw0RkFBNEYseUJBQXlCLE9BQU8sa0VBQWtFLHdCQUF3QixPQUFPLGFBQWE7QUFDajRCLDBDQUEwQywrQ0FBK0Msc0VBQXNFLDhCQUE4QixxQkFBcUIsaUNBQWlDLHdCQUF3QixpQ0FBaUMsd0JBQXdCLDJCQUEyQiwrR0FBK0csNENBQTRDLHVCQUF1Qiw0QkFBNEIsdUJBQXVCLDJCQUEyQiw0QkFBNEIsZ0hBQWdILDRDQUE0QywwQkFBMEIsMEVBQTBFLDRCQUE0QixtQkFBbUIsMENBQTBDLHVDQUF1QyxnQkFBZ0IsS0FBSyw2QkFBNkIsMEVBQTBFLHdCQUF3QixzR0FBc0csYUFBYSxLQUFLLG9DQUFvQyx1QkFBdUIsdUJBQXVCLGdCQUFnQjtBQUN6MkMsZ0RBQWdELHFEQUFxRDtBQUNyRztBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWEsU0FBUywyREFBMkQsa0NBQWtDLGdDQUFnQyw2QkFBNkIscURBQXFELHdFQUF3RSxLQUFLLDJCQUEyQixzQ0FBc0MsT0FBTyxTQUFTLDRCQUE0Qiw4QkFBOEIsdUNBQXVDLGtDQUFrQyw0R0FBNEcsOENBQThDLG1EQUFtRCxrQkFBa0IsMEJBQTBCO0FBQy92Qix1Q0FBdUMsZ0JBQWdCO0FBQ3ZELDJCQUEyQixVQUFVLGdDQUFnQztBQUNyRTtBQUNBO0FBQ0EsbUJBQW1CLHFCQUFxQixvR0FBb0c7QUFDNUk7QUFDQTtBQUNBLG1CQUFtQiwyQkFBMkI7QUFDOUMsb0RBQW9EO0FBQ3BEO0FBQ0E7QUFDQTtBQUNBLG1IQUFtSCxzREFBc0Qsb0NBQW9DLHdDQUF3Qyw4QkFBOEI7QUFDblIsTUFBTSwyREFBMkQsOEJBQThCLE9BQU87QUFDdEc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTSxhQUFhLFNBQVMsd0ZBQXdGLGFBQWEsc0JBQXNCLGNBQWMsNEJBQTRCLG9EQUFvRCxPQUFPLGFBQWEsZUFBZTtBQUN4UixzQ0FBc0MsY0FBYztBQUNwRCw0QkFBNEIsZ0JBQWdCLDJFQUEyRTtBQUN2SCw4REFBOEQ7QUFDOUQsNEJBQTRCO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsV0FBVztBQUMvQjtBQUNBO0FBQ0E7QUFDQSx1Q0FBdUM7QUFDdkM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRLGdCQUFnQiwwRkFBMEY7QUFDbEgsb0dBQW9HO0FBQ3BHO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTiw0RkFBNEY7QUFDNUY7QUFDQTtBQUNBLGtCQUFrQixPQUFPLFlBQVksV0FBVztBQUNoRCwwREFBMEQsYUFBYSxpRUFBaUUsZ0JBQWdCLHdFQUF3RTtBQUNoTyw4REFBOEQ7QUFDOUQ7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOLG9DQUFvQztBQUNwQztBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU0sWUFBWSxXQUFXO0FBQzdCO0FBQ0EsNEdBQTRHO0FBQzVHO0FBQ0E7QUFDQTtBQUNBLHdCQUF3Qiw4Q0FBOEMsZ0JBQWdCLG1EQUFtRDtBQUN6SSxpQ0FBaUM7QUFDakMsd0JBQXdCLGNBQWM7QUFDdEM7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0Esd0RBQXdELFdBQVc7QUFDbkU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUSxnQkFBZ0IsbURBQW1EO0FBQzNFLDhEQUE4RDtBQUM5RCx3QkFBd0IsY0FBYztBQUN0QztBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQSx3REFBd0QsV0FBVztBQUNuRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRLGdCQUFnQix3RUFBd0U7QUFDaEc7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsWUFBWSxnQkFBZ0I7QUFDbkQsNkRBQTZELHlFQUF5RSw0RUFBNEUsdUZBQXVGLHdGQUF3RixLQUFLLFVBQVUsOEJBQThCLG9CQUFvQixRQUFRLG1DQUFtQyxzQkFBc0IsUUFBUSxLQUFLLDBGQUEwRixzQ0FBc0MscUJBQXFCLFFBQVEscUNBQXFDLHVCQUF1QixpQkFBaUI7QUFDMXZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTyx3QkFBd0IsbURBQW1ELGtFQUFrRSw4S0FBOEsscUJBQXFCLHdDQUF3QyxxQkFBcUIsbURBQW1EO0FBQ3ZjLHVHQUF1RztBQUN2RztBQUNBO0FBQ0E7QUFDQSxVQUFVLGdDQUFnQywyQ0FBMkMsd0JBQXdCO0FBQzdHLGlFQUFpRSx3Q0FBd0MsNEJBQTRCLDZDQUE2QywyQkFBMkIsY0FBYztBQUMzTix3QkFBd0I7QUFDeEI7QUFDQSx1QkFBdUIsa0JBQWtCLHlCQUF5Qix3Q0FBd0MsdUJBQXVCO0FBQ2pJLGlFQUFpRSx3Q0FBd0Msc0JBQXNCLDRDQUE0QyxzSEFBc0gsY0FBYyx3Q0FBd0MsT0FBTyx1QkFBdUIsc0NBQXNDLE9BQU8seUJBQXlCLHVDQUF1QyxPQUFPLDZCQUE2QixzQ0FBc0MsT0FBTywrQkFBK0IsNEJBQTRCLHVDQUF1QywySUFBMkksT0FBTyxxQkFBcUIsbUZBQW1GLGlGQUFpRixPQUFPLFNBQVMsb0JBQW9CO0FBQ3BnQywyQ0FBMkMseUJBQXlCLHNHQUFzRyx5QkFBeUIsMkdBQTJHO0FBQzlTLDRDQUE0QyxjQUFjO0FBQzFELHFDQUFxQyxpREFBaUQsa0VBQWtFLGdEQUFnRDtBQUN4TSw4Q0FBOEMsY0FBYztBQUM1RCwyQkFBMkIsaURBQWlELFNBQVMscURBQXFEO0FBQzFJLGtDQUFrQyxhQUFhLFVBQVU7QUFDekQsd0JBQXdCLGdFQUFnRSwrREFBK0QsWUFBWSxzSEFBc0gscUJBQXFCLDJCQUEyQixxQkFBcUIsWUFBWTtBQUMxVyxnQkFBZ0I7QUFDaEIsbUNBQW1DLGNBQWM7QUFDakQsK0JBQStCLHVDQUF1QyxnQkFBZ0Isc0NBQXNDLG1CQUFtQixxQkFBcUI7QUFDcEssc0VBQXNFO0FBQ3RFLDJCQUEyQiw0Q0FBNEMseUNBQXlDLE9BQU87QUFDdkg7QUFDQSx5RUFBeUUsV0FBVztBQUNwRix3QkFBd0IseUJBQXlCO0FBQ2pELHdCQUF3QjtBQUN4QjtBQUNBLDJCQUEyQjtBQUMzQix5Q0FBeUMsT0FBTztBQUNoRCwyRkFBMkY7QUFDM0YsNEJBQTRCLG9DQUFvQyw4SkFBOEoseUVBQXlFLG9GQUFvRixxQ0FBcUMsd0JBQXdCLGlCQUFpQjtBQUN6Yyx1REFBdUQsYUFBYSxHQUFHLDZCQUE2QixVQUFVLHlCQUF5QiwrRUFBK0UsMkJBQTJCLDZIQUE2SCxxQkFBcUIsT0FBTztBQUMxWSxxQkFBcUI7QUFDckIsNkNBQTZDLFdBQVcsY0FBYztBQUN0RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQiw4QkFBOEI7QUFDbEQ7QUFDQSxnRkFBZ0Y7QUFDaEY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNLGNBQWMscUJBQXFCO0FBQ3pDLG1CQUFtQiw2Q0FBNkMsV0FBVyxjQUFjO0FBQ3pGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUIsbUJBQW1CO0FBQzVDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QixtQkFBbUI7QUFDNUM7QUFDQTtBQUNBLE1BQU0sYUFBYSxlQUFlLHdCQUF3QixzQkFBc0I7QUFDaEYsNkJBQTZCLHlDQUF5QyxlQUFlLHdCQUF3QixzQkFBc0I7QUFDbkksNkJBQTZCO0FBQzdCO0FBQ0E7QUFDQSw0QkFBNEIsY0FBYztBQUMxQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRLHNCQUFzQixXQUFXLDhMQUE4TCxxQkFBcUIsWUFBWTtBQUN4USx3QkFBd0IsY0FBYztBQUN0QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU8sb0JBQW9CLFVBQVUseU1BQXlNLGVBQWUscUJBQXFCLHFEQUFxRCxzRUFBc0Usd0VBQXdFLHFCQUFxQiwwQkFBMEI7QUFDcGdCLDRGQUE0RixpR0FBaUc7QUFDN0w7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLDJCQUEyQixhQUFhLHlCQUF5QixTQUFTLFdBQVcsWUFBWTtBQUM3SCxvQkFBb0IsaVBBQWlQLG9CQUFvQix3RkFBd0YsdUJBQXVCLFFBQVE7QUFDaFosa0JBQWtCO0FBQ2xCO0FBQ0E7QUFDQSxPQUFPLHFCQUFxQixvRUFBb0Usb0JBQW9CLGlDQUFpQztBQUNySjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVLFdBQVcscUJBQXFCLE9BQU8sYUFBYSxnQkFBZ0IsbUNBQW1DLElBQUksb0JBQW9CLFlBQVkseUJBQXlCLHlDQUF5QyxjQUFjO0FBQ3JPLDhDQUE4QyxXQUFXLHFCQUFxQixjQUFjLDRJQUE0SSxvQkFBb0IsOEJBQThCLDRDQUE0Qyw2Q0FBNkMsUUFBUSxxQkFBcUIsaUNBQWlDLDRCQUE0Qix3QkFBd0I7QUFDcmU7QUFDQSw2Q0FBNkMsWUFBWSwyQ0FBMkMsdUJBQXVCLElBQUk7QUFDL0gsT0FBTyxvQkFBb0IsaUVBQWlFLG9CQUFvQix5REFBeUQsb0JBQW9CLGlEQUFpRCx3QkFBd0IsOEJBQThCLHFGQUFxRixxQkFBcUIseUJBQXlCLHNDQUFzQyxZQUFZLHFKQUFxSixxQkFBcUIseUJBQXlCLHFEQUFxRCxxQkFBcUIscUNBQXFDLHNEQUFzRCxvQkFBb0IscUVBQXFFLDBCQUEwQixrUkFBa1Isd0JBQXdCO0FBQzl0QyxzRkFBc0YscUtBQXFLO0FBQzNQLDRDQUE0QyxnQkFBZ0I7QUFDNUQ7QUFDQSxxQkFBcUIsdUJBQXVCLGdCQUFnQiwyQ0FBMkM7QUFDdkc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU0sV0FBVyxxQkFBcUIsa0JBQWtCLDJCQUEyQixXQUFXLHlOQUF5TixvREFBb0QsZ0RBQWdELHFCQUFxQixlQUFlLCtCQUErQixvQkFBb0IsOFhBQThYO0FBQ2gzQjtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBLHVCQUF1Qiw4VUFBOFUsb0JBQW9CLG9CQUFvQix3QkFBd0Isb0RBQW9ELDRCQUE0Qix1QkFBdUIsa0JBQWtCLGtCQUFrQixTQUFTLDZCQUE2QixnQ0FBZ0MsbUJBQW1CLG9FQUFvRSxzQkFBc0Isb0dBQW9HLGdPQUFnTyxrRUFBa0UsK0NBQStDLHlDQUF5QyxpQ0FBaUM7QUFDbHVDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZSwwQ0FBMEMsZ0RBQWdELGNBQWM7QUFDdkgsMEVBQTBFLHlCQUF5Qiw0Q0FBNEMsZUFBZSwwQ0FBMEMsb0VBQW9FLDRHQUE0RyxrQ0FBa0M7QUFDMVosOEZBQThGLGtKQUFrSjtBQUNoUCxvREFBb0QsZ0JBQWdCO0FBQ3BFO0FBQ0EsMkJBQTJCLGtDQUFrQyx3QkFBd0IsNEJBQTRCLG9FQUFvRSw4QkFBOEIseUJBQXlCLDZCQUE2QixhQUFhLGdDQUFnQyx1REFBdUQsWUFBWTtBQUN6WDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWMsMkJBQTJCLG9CQUFvQiwrQkFBK0IsNkZBQTZGLHlJQUF5SSw0Q0FBNEMsb0RBQW9ELDBDQUEwQyxLQUFLLCtCQUErQixjQUFjLGtGQUFrRjtBQUNobEI7QUFDQTtBQUNBLDRCQUE0QixPQUFPO0FBQ25DO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixPQUFPO0FBQy9CLHFFQUFxRSxXQUFXLHlDQUF5QywyQkFBMkIsc0JBQXNCO0FBQzFLLGlDQUFpQyxzSEFBc0gsc0ZBQXNGLDhCQUE4QixpREFBaUQscUNBQXFDLG9EQUFvRCxXQUFXLDJDQUEyQyxTQUFTLGtYQUFrWCw0Q0FBNEMsc0JBQXNCLGNBQWMsNENBQTRDLHFEQUFxRCxrQ0FBa0Msd0JBQXdCLHdLQUF3SyxTQUFTLHFNQUFxTSw4REFBOEQsWUFBWSxvRUFBb0Usc0VBQXNFLHFDQUFxQywwQkFBMEIseUNBQXlDLGtCQUFrQix5QkFBeUIsOENBQThDO0FBQzV6RCx3Q0FBd0MsYUFBYSxjQUFjO0FBQ25FLDJFQUEyRSxRQUFRO0FBQ25GO0FBQ0E7QUFDQSxVQUFVLFdBQVcsU0FBUyxLQUFLLGlEQUFpRCxtQkFBbUI7QUFDdkcsb0NBQW9DO0FBQ3BDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXLGdDQUFnQyxtQkFBbUI7QUFDOUQsbURBQW1ELG1CQUFtQjtBQUN0RSx1UEFBdVAsbUNBQW1DO0FBQzFSLFdBQVcsK0JBQStCLHNDQUFzQyxzQkFBc0IsS0FBSyxrQ0FBa0MsWUFBWSw0Q0FBNEMsMENBQTBDLFFBQVEsdURBQXVELHVDQUF1QyxpUkFBaVIsd0JBQXdCLDBHQUEwRywwQ0FBMEMsb0RBQW9ELGdFQUFnRSxvQ0FBb0MscURBQXFELGdCQUFnQixpQ0FBaUMsT0FBTyxxQkFBcUIsMkVBQTJFLCtCQUErQixlQUFlLCtEQUErRCw4QkFBOEIsa0JBQWtCLHNCQUFzQjtBQUMxeUMsbURBQW1ELDREQUE0RCw2Q0FBNkMsV0FBVywwQkFBMEIsZUFBZSxzREFBc0QsbURBQW1ELHdCQUF3Qiw2Q0FBNkMsbUJBQW1CLDhCQUE4QixPQUFPLDJDQUEyQyxrTEFBa0wsMkNBQTJDLDZEQUE2RCx5REFBeUQsOEdBQThHLDhCQUE4QixvQkFBb0IsNkVBQTZFLDZCQUE2Qix1REFBdUQsNERBQTREO0FBQ2pyQztBQUNBLDZFQUE2RSxzQ0FBc0M7QUFDbkgsV0FBVyxtREFBbUQsa0pBQWtKLCtEQUErRCwrQ0FBK0MsMENBQTBDLHFEQUFxRCxnQ0FBZ0M7QUFDN2IsbUZBQW1GLEtBQUs7QUFDeEY7QUFDQSxnQ0FBZ0MsSUFBSTtBQUNwQztBQUNBO0FBQ0E7QUFDQTtBQUNBLHlEQUF5RCxFQUFFLFFBQVEsRUFBRSx3Q0FBd0MsRUFBRSw0TEFBNEwsSUFBSTtBQUMvUztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVyxnRUFBZ0UsYUFBYSx3REFBd0QsMEJBQTBCLGFBQWEsOENBQThDLHVCQUF1QixhQUFhLHdEQUF3RCxnQ0FBZ0MsYUFBYSxnRUFBZ0Usd0NBQXdDLGFBQWEsb0RBQW9ELG1DQUFtQyxhQUFhLHlGQUF5RiwyQkFBMkIsYUFBYSw4QkFBOEIsc0JBQXNCLGdKQUFnSixnQkFBZ0IseUJBQXlCLDBFQUEwRSxnQ0FBZ0MscUJBQXFCLElBQUksa0JBQWtCLHNDQUFzQztBQUNobkMsdUJBQXVCLHVCQUF1QixvREFBb0Qsc0JBQXNCLGVBQWUsbURBQW1ELG9CQUFvQjtBQUM5TTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQixTQUFTLG1GQUFtRixzRkFBc0Ysc0RBQXNELFlBQVk7QUFDdlEsOENBQThDLGNBQWM7QUFDNUQsbURBQW1ELFdBQVcsZ0dBQWdHLDZCQUE2QiwyQkFBMkIsc0RBQXNEO0FBQzVRLHNCQUFzQiw2Q0FBNkMsc0JBQXNCLDhCQUE4QixtRkFBbUYsK0NBQStDLCtDQUErQywyTEFBMkwsNkNBQTZDO0FBQ2hoQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVcsOENBQThDLHVDQUF1QztBQUNoRztBQUNBLG9EQUFvRCx5QkFBeUI7QUFDN0UsVUFBVSxXQUFXLHNDQUFzQztBQUMzRCxvQ0FBb0MsZ0JBQWdCO0FBQ3BELDJCQUEyQixrSkFBa0o7QUFDN0s7QUFDQTtBQUNBLE1BQU0sc0JBQXNCLDZCQUE2Qix3QkFBd0IsNENBQTRDLDRCQUE0QiwyUkFBMlIsb0RBQW9ELGdDQUFnQywrQkFBK0IsT0FBTyxxR0FBcUcsR0FBRyxnQ0FBZ0Msc0ZBQXNGLDhKQUE4Six1QkFBdUIsNkNBQTZDO0FBQzkrQixxQkFBcUIsZ0RBQWdELG1CQUFtQixvRUFBb0UsY0FBYyxtQ0FBbUMscUdBQXFHLElBQUksa0ZBQWtGLEtBQUs7QUFDN1k7QUFDQSx3QkFBd0IsK0ZBQStGO0FBQ3ZILGtCQUFrQjtBQUNsQjtBQUNBO0FBQ0EsNkRBQTZELHlDQUF5QztBQUN0RztBQUNBO0FBQ0E7QUFDQSxpRkFBaUYsT0FBTywyQkFBMkIsVUFBVSwyRkFBMkYseUJBQXlCO0FBQ2pQO0FBQ0E7QUFDQSxnQkFBZ0IsU0FBUyxvREFBb0QsNkJBQTZCLDZCQUE2QixhQUFhLG1DQUFtQyxzQkFBc0I7QUFDN00sbUNBQW1DLGNBQWM7QUFDakQsMkJBQTJCLGtIQUFrSCxRQUFRLGdCQUFnQixhQUFhLDJHQUEyRyx3TUFBd00sOENBQThDLHdDQUF3QztBQUMzakIsa0JBQWtCLE9BQU8sNFBBQTRQLCtDQUErQyxvQ0FBb0Msd0JBQXdCLEtBQUssVUFBVSxNQUFNLDZCQUE2Qiw0T0FBNE8sbUNBQW1DLDZDQUE2QyxxQkFBcUIsaUNBQWlDLDJCQUEyQixJQUFJLDZCQUE2QiwyQkFBMkIsSUFBSSx1QkFBdUIsSUFBSTtBQUMxNUI7QUFDQTtBQUNBLFVBQVUsU0FBUywyQkFBMkIsYUFBYSxpRUFBaUUsZ0ZBQWdGLHNCQUFzQixxT0FBcU8sdUJBQXVCLGtCQUFrQixtSEFBbUgsc0JBQXNCLHFCQUFxQix3Q0FBd0MscUJBQXFCLHFDQUFxQyxxQkFBcUIsY0FBYyx5REFBeUQscUJBQXFCLGdFQUFnRSx5QkFBeUIsZ0JBQWdCLDhCQUE4QjtBQUN4K0I7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4QkFBOEIsUUFBUSxpQ0FBaUMsOERBQThELDhCQUE4QjtBQUNuSztBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWMsMERBQTBEO0FBQ3hFO0FBQ0EsMkJBQTJCLFFBQVE7QUFDbkMscUhBQXFIO0FBQ3JIO0FBQ0E7QUFDQTtBQUNBLGdEQUFnRDtBQUNoRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEVBQTBFLHVCQUF1QiwyQ0FBMkMsT0FBTyxPQUFPLFNBQVMsNkNBQTZDO0FBQ2hOO0FBQ0EsaU1BQWlNLHNCQUFzQixvR0FBb0csTUFBTTtBQUNqVTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0ZBQXNGLG1CQUFtQixnQ0FBZ0MsY0FBYyxxQkFBcUIsd0NBQXdDLDJCQUEyQixrQ0FBa0M7QUFDalIsMkRBQTJELCtCQUErQixrQ0FBa0MsaUNBQWlDLDZEQUE2RCxpQkFBaUIsV0FBVztBQUN0UCwyQ0FBMkMsY0FBYztBQUN6RCwyQkFBMkIsb0hBQW9ILFNBQVMsdURBQXVELGVBQWUsWUFBWSxjQUFjO0FBQ3hQLDBCQUEwQixVQUFVLHlCQUF5QixpQ0FBaUMsdUNBQXVDLFVBQVU7QUFDL0ksc0NBQXNDLGlCQUFpQjtBQUN2RDtBQUNBLG1DQUFtQyxZQUFZLDhCQUE4QixpQ0FBaUMsc0NBQXNDLHVGQUF1RjtBQUMzTztBQUNBO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQSx5SEFBeUgsNkJBQTZCLEtBQUsseUNBQXlDLDRCQUE0QixzQ0FBc0MsNkJBQTZCLGdEQUFnRCxvREFBb0Q7QUFDdlk7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQ0FBK0M7QUFDL0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCLGdEQUFnRCxpQkFBaUI7QUFDakU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlLDREQUE0RCx3QkFBd0Isc0JBQXNCO0FBQ3pILHlDQUF5QztBQUN6QywyQkFBMkIsd0JBQXdCLGlCQUFpQjtBQUNwRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYyxlQUFlLGdCQUFnQjtBQUM3QywwQ0FBMEMsY0FBYztBQUN4RCwyQkFBMkIsK09BQStPLGdDQUFnQyxvQkFBb0IsYUFBYSxnREFBZ0Qsd0JBQXdCLDZCQUE2QixRQUFRLGdJQUFnSSxRQUFRLHdEQUF3RCx1QkFBdUIsMkZBQTJGLHNCQUFzQixvRUFBb0UsNEJBQTRCLHdCQUF3Qiw2RUFBNkUsZUFBZSwwSUFBMEksYUFBYTtBQUMzbUMscUhBQXFIO0FBQ3JILDRHQUE0RyxVQUFVLDhFQUE4RSxnRUFBZ0U7QUFDcFE7QUFDQTtBQUNBLHNCQUFzQjtBQUN0Qix5Q0FBeUMsd0pBQXdKLHFCQUFxQjtBQUN0TixnQ0FBZ0MsaUJBQWlCO0FBQ2pELHFEQUFxRDtBQUNyRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkNBQTZDLE1BQU0sc0JBQXNCLHNDQUFzQyxvQkFBb0Isd0JBQXdCLDREQUE0RCxNQUFNLDhEQUE4RCx1REFBdUQsVUFBVSxvQkFBb0I7QUFDaFgsdUZBQXVGO0FBQ3ZGLHVGQUF1RixnQ0FBZ0MsMERBQTBELGtGQUFrRixpRUFBaUUsbUZBQW1GLGlFQUFpRSxRQUFRLCtEQUErRCwwREFBMEQsS0FBSyxvQkFBb0Isd0JBQXdCLGdGQUFnRixtQkFBbUI7QUFDN3VCLDJDQUEyQyxXQUFXLGdCQUFnQix3QkFBd0I7QUFDOUYsK0NBQStDLE9BQU87QUFDdEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPLE1BQU0sU0FBUyx1Q0FBdUM7QUFDN0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlFQUF5RSw4RUFBOEU7QUFDdko7QUFDQSxvSUFBb0k7QUFDcEk7QUFDQSwrR0FBK0csZUFBZTtBQUM5SDtBQUNBLCtJQUErSSw4Q0FBOEMsa0JBQWtCLG9CQUFvQixlQUFlLHdCQUF3QjtBQUMxUSwrQkFBK0IsMkNBQTJDLHNDQUFzQyx3QkFBd0Isc0JBQXNCO0FBQzlKLHlDQUF5QywyQkFBMkIsT0FBTyxnREFBZ0Q7QUFDM0g7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsTUFBTSw0QkFBNEI7QUFDbEQsbUNBQW1DO0FBQ25DO0FBQ0EsV0FBVyxzREFBc0QsV0FBVyxpQ0FBaUMsNkJBQTZCLHFEQUFxRCxrQkFBa0IsMkJBQTJCO0FBQzVPLCtDQUErQyw2QkFBNkI7QUFDNUU7QUFDQSwwR0FBMEcsMEJBQTBCO0FBQ3BJO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhLE1BQU0seUJBQXlCO0FBQzVDLCtDQUErQyxrQkFBa0IsZUFBZSxnRUFBZ0Usb0JBQW9CO0FBQ3BLO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVyxLQUFLLDhCQUE4QixXQUFXLHFGQUFxRixxREFBcUQsT0FBTyxVQUFVO0FBQ3BOLHVDQUF1QyxjQUFjO0FBQ3JELGVBQWUsc0NBQXNDLG1CQUFtQixnQ0FBZ0MsZ0JBQWdCLGVBQWUsWUFBWSxRQUFRO0FBQzNKLGtEQUFrRCxZQUFZLGFBQWEsYUFBYSxnSkFBZ0osOEJBQThCLHdCQUF3QixjQUFjO0FBQzVTO0FBQ0E7QUFDQSxVQUFVLFdBQVcsNEJBQTRCLFlBQVksV0FBVztBQUN4RSwrSEFBK0g7QUFDL0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVLGdCQUFnQixvQkFBb0I7QUFDOUMsdUJBQXVCLDJEQUEyRCxjQUFjO0FBQ2hHLHdCQUF3QixRQUFRO0FBQ2hDO0FBQ0EseUJBQXlCLFNBQVM7QUFDbEM7QUFDQSwyREFBMkQsU0FBUztBQUNwRTtBQUNBLHlCQUF5QixTQUFTO0FBQ2xDO0FBQ0EseUJBQXlCLFNBQVM7QUFDbEM7QUFDQSx5QkFBeUIsU0FBUztBQUNsQztBQUNBO0FBQ0EsVUFBVTtBQUNWLGtEQUFrRCxjQUFjO0FBQ2hFLDJCQUEyQixtQkFBbUIsZ0dBQWdHLG1EQUFtRCxjQUFjLHFDQUFxQyxnQ0FBZ0MsNERBQTRELG1CQUFtQixNQUFNLGtGQUFrRix5Q0FBeUMsOERBQThELCtDQUErQyxLQUFLLEdBQUcsMkJBQTJCLHVDQUF1QyxvQkFBb0IsMkVBQTJFLHFFQUFxRSx5Q0FBeUMseUNBQXlDLE1BQU0sdUJBQXVCLGlDQUFpQyx3SUFBd0ksa0JBQWtCLFNBQVMsNENBQTRDLHNDQUFzQyxzQ0FBc0MsOEJBQThCLGtCQUFrQixJQUFJLHdDQUF3QyxPQUFPLGlDQUFpQztBQUM5MkMsd0NBQXdDLGNBQWM7QUFDdEQsMkJBQTJCLDBNQUEwTSxRQUFRLHNIQUFzSCwwQkFBMEIsWUFBWSwwQkFBMEIsK05BQStOLDRRQUE0USxVQUFVLDhJQUE4SSx1Q0FBdUMsb0JBQW9CLHdHQUF3RyxXQUFXLDRCQUE0Qix1REFBdUQsYUFBYSxxREFBcUQsYUFBYSxJQUFJLCtCQUErQixzSEFBc0gsMkJBQTJCLDZTQUE2Uyw2QkFBNkIsc0lBQXNJLCtCQUErQiwyQkFBMkIscUZBQXFGLHVDQUF1Qyx1RUFBdUUsNkJBQTZCLGtCQUFrQiw2QkFBNkIscUJBQXFCLHdCQUF3QixnQkFBZ0IsVUFBVSx1QkFBdUIsa0JBQWtCO0FBQ243RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTyxvQkFBb0Isd0VBQXdFLG9CQUFvQiw2RUFBNkUsc0NBQXNDLE9BQU87QUFDalA7QUFDQTtBQUNBLE9BQU8sa0VBQWtFLDBCQUEwQixhQUFhLFVBQVUsd0NBQXdDLGtCQUFrQixzREFBc0Qsd0JBQXdCLDBEQUEwRDtBQUM1VCxvQkFBb0IsTUFBTSxJQUFJLDZCQUE2QixzREFBc0Q7QUFDakgsOEhBQThILHFCQUFxQixnQkFBZ0Isb0NBQW9DLGdCQUFnQiw2RUFBNkU7QUFDcFM7QUFDQTtBQUNBLE1BQU0sMkpBQTJKLE1BQU0sb0JBQW9CO0FBQzNMO0FBQ0E7QUFDQTtBQUNBLE1BQU0sWUFBWSxxQkFBcUIsY0FBYyxvQkFBb0Isc0JBQXNCLDZIQUE2SCx1REFBdUQsY0FBYyxrb0JBQWtvQixzREFBc0QsaVBBQWlQLDZCQUE2QixzQkFBc0IsK0NBQStDLDRKQUE0SixvQ0FBb0MsMEpBQTBKLG1DQUFtQyw4RUFBOEUsOENBQThDLHVFQUF1RSw4Q0FBOEMsMEVBQTBFLE1BQU0sNkJBQTZCO0FBQ3ZnRTtBQUNBO0FBQ0EsTUFBTSx3Q0FBd0MscUJBQXFCLG1CQUFtQiwrSkFBK0osb0JBQW9CLGdDQUFnQywySUFBMkksaUJBQWlCLDJCQUEyQixrQkFBa0I7QUFDbGYsa0JBQWtCLHVDQUF1QyxvR0FBb0csaUJBQWlCLFlBQVk7QUFDMUwsdURBQXVELHNCQUFzQjtBQUM3RTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsMkNBQTJDLHFFQUFxRSxtR0FBbUcscURBQXFELDZCQUE2QixTQUFTLG9CQUFvQixvRkFBb0YscUJBQXFCLGdDQUFnQyxtQ0FBbUMscUNBQXFDLHdCQUF3QjtBQUN2a0I7QUFDQSxnQ0FBZ0MsT0FBTyxhQUFhO0FBQ3BEO0FBQ0E7QUFDQSw2REFBNkQsOERBQThELHdDQUF3QyxTQUFTO0FBQzVLO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPLDJCQUEyQiwwQ0FBMEMsNEZBQTRGLGtKQUFrSixRQUFRLHdCQUF3QixzQkFBc0Isa0dBQWtHLFVBQVUsVUFBVSx3QkFBd0I7QUFDOWYsNEJBQTRCLHdCQUF3Qiw4RUFBOEUscUJBQXFCLFVBQVUsdUNBQXVDO0FBQ3hNLDZFQUE2RTtBQUM3RSxzREFBc0QsMERBQTBELDRNQUE0TSxxQkFBcUIsb0hBQW9ILFNBQVMsa0RBQWtELHdCQUF3Qix1TUFBdU0sMkNBQTJDLGtDQUFrQyxrREFBa0QsZ0NBQWdDLGdEQUFnRCxrR0FBa0csdUNBQXVDLHdCQUF3QixJQUFJLFVBQVUsOElBQThJLHVDQUF1QyxvQkFBb0IsSUFBSTtBQUMxeUM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNLFdBQVcsd0JBQXdCLG1DQUFtQyxhQUFhLFNBQVMsdUJBQXVCLG1DQUFtQyxLQUFLLG9CQUFvQjtBQUNyTDtBQUNBLDRGQUE0RixnQ0FBZ0M7QUFDNUg7QUFDQSw4Q0FBOEMscUJBQXFCO0FBQ25FO0FBQ0EsT0FBTyx3QkFBd0IsaWFBQWlhLHFCQUFxQix1Q0FBdUMsOENBQThDLHFCQUFxQixnVEFBZ1Qsb0JBQW9CLG9EQUFvRCxvQkFBb0Isa0RBQWtELGdCQUFnQjtBQUM3Z0Msd0JBQXdCO0FBQ3hCO0FBQ0E7QUFDQSxXQUFXO0FBQ1gsNERBQTRELGdCQUFnQjtBQUM1RTtBQUNBO0FBQ0EsV0FBVyxNQUFNLEtBQUssdUJBQXVCO0FBQzdDLFFBQVEsZ0JBQWdCLGtDQUFrQyxPQUFPO0FBQ2pFLG1CQUFtQixzSEFBc0gsK0NBQStDLGVBQWU7QUFDdk07QUFDQTtBQUNBLFFBQVEsU0FBUyxvRkFBb0YseUNBQXlDLDZIQUE2SCw0Q0FBNEMsaUJBQWlCLG9CQUFvQixxQ0FBcUM7QUFDalk7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhCQUE4QixtREFBbUQsdUpBQXVKO0FBQ3hPO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQ0FBK0MsMEJBQTBCO0FBQ3pFO0FBQ0E7QUFDQSxVQUFVLG1DQUFtQywwQkFBMEIsd0dBQXdHLGFBQWEsb0dBQW9HLDRDQUE0QztBQUM1VSxrREFBa0QsT0FBTztBQUN6RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNHQUFzRyxpQkFBaUI7QUFDdkg7QUFDQTtBQUNBLDJEQUEyRCxpQ0FBaUMsZ0JBQWdCLFVBQVUsSUFBSTtBQUMxSDtBQUNBO0FBQ0EsVUFBVSw0Q0FBNEMseUNBQXlDO0FBQy9GO0FBQ0EsMkRBQTJEO0FBQzNELDRCQUE0Qiw2R0FBNkc7QUFDekk7QUFDQTtBQUNBLCtEQUErRCxxQkFBcUIsdURBQXVELHVCQUF1QixnQ0FBZ0MsSUFBSSw2REFBNkQsaUhBQWlILHVDQUF1Qyx5REFBeUQ7QUFDcGQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVLDhCQUE4Qix3SEFBd0gsSUFBSSwyRkFBMkYsNkNBQTZDLG1LQUFtSyw4Q0FBOEMsb0JBQW9CLFFBQVEsc0hBQXNIO0FBQy9vQjtBQUNBO0FBQ0EsV0FBVyxxTEFBcUwsY0FBYyxpQ0FBaUMsOEJBQThCLGNBQWM7QUFDM1I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFzQixjQUFjLHFDQUFxQyxZQUFZO0FBQ3JGO0FBQ0E7QUFDQSxVQUFVLFdBQVcsaURBQWlEO0FBQ3RFO0FBQ0E7QUFDQSxXQUFXLHFDQUFxQztBQUNoRDtBQUNBLDBDQUEwQyxjQUFjO0FBQ3hEO0FBQ0E7QUFDQTtBQUNBLHVCQUF1Qiw2RUFBNkUsNkJBQTZCLDRCQUE0QixvRkFBb0YsNkJBQTZCLG1GQUFtRiw0Q0FBNEMseUZBQXlGLG1CQUFtQiwwREFBMEQsMEhBQTBILFVBQVUseUVBQXlFLEtBQUssNENBQTRDO0FBQ2p6QjtBQUNBO0FBQ0EsZUFBZSwyQkFBMkIsaUJBQWlCLHdCQUF3QjtBQUNuRiw4Q0FBOEMsY0FBYztBQUM1RCw0QkFBNEIsb0NBQW9DLGtEQUFrRCx1RUFBdUUsMEJBQTBCLElBQUksdUJBQXVCLFlBQVk7QUFDMVA7QUFDQTtBQUNBLE1BQU0scUJBQXFCLHdCQUF3QixjQUFjLHlEQUF5RCwwREFBMEQsZ0JBQWdCLGdFQUFnRSwwQ0FBMEMsaUNBQWlDLDREQUE0RCw0RkFBNEYsa09BQWtPLDBDQUEwQyxVQUFVLDRDQUE0QyxpYUFBaWEsd0JBQXdCO0FBQ2x1QztBQUNBO0FBQ0E7QUFDQSx3Q0FBd0MsMkNBQTJDO0FBQ25GO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtRUFBbUUsNEJBQTRCLElBQUksOENBQThDLHVCQUF1Qix3QkFBd0Isd0JBQXdCLHNCQUFzQjtBQUM5TyxxQ0FBcUMsa0VBQWtFO0FBQ3ZHLFNBQVMsU0FBUyxzREFBc0QscURBQXFELDJEQUEyRCxnSkFBZ0oscURBQXFEO0FBQzdYO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0NBQXdDLHlDQUF5QyxvREFBb0Qsc0VBQXNFLGtNQUFrTSxrRUFBa0UsOENBQThDLGdJQUFnSSxVQUFVLGlHQUFpRyx3Q0FBd0Msc0dBQXNHLGdEQUFnRCxnSUFBZ0ksVUFBVSxpR0FBaUcsd0NBQXdDLHNHQUFzRyw0QkFBNEIsaUJBQWlCO0FBQzUwQyxtQ0FBbUMsZ0JBQWdCO0FBQ25ELDJCQUEyQiw0RUFBNEUsbUhBQW1ILDBCQUEwQixNQUFNLFNBQVMsdUJBQXVCO0FBQzFSLGlFQUFpRTtBQUNqRTtBQUNBLFNBQVMsU0FBUyx5Q0FBeUMsdUZBQXVGO0FBQ2xKLHVDQUF1QyxjQUFjO0FBQ3JEO0FBQ0Esb0JBQW9CLCtCQUErQixlQUFlO0FBQ2xFLDJCQUEyQix3S0FBd0ssbURBQW1ELHdCQUF3Qix5Q0FBeUMsS0FBSyxJQUFJLHlEQUF5RCxzQ0FBc0Msb0dBQW9HLGtGQUFrRixpQkFBaUIsV0FBVztBQUNqbkI7QUFDQSx3QkFBd0IscUJBQXFCO0FBQzdDLE1BQU0sWUFBWSxvQ0FBb0MsdUJBQXVCLHFCQUFxQix3QkFBd0IsNEVBQTRFLGdCQUFnQix5Q0FBeUMsSUFBSSwwQkFBMEIsU0FBUyxJQUFJLEtBQUssOEJBQThCLHVCQUF1QixzQkFBc0Isd0NBQXdDLDRGQUE0Rix1Q0FBdUMsU0FBUyx1QkFBdUIsa0VBQWtFLHdCQUF3QiwwREFBMEQsc0NBQXNDLCtDQUErQztBQUM5eUIsc0NBQXNDLGNBQWM7QUFDcEQsMkJBQTJCLDZSQUE2UiwrREFBK0QsZ0JBQWdCLHVEQUF1RCw4Q0FBOEM7QUFDNWU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUNBQXFDLHdCQUF3Qiw2QkFBNkIscURBQXFELGtKQUFrSixzR0FBc0csVUFBVSwrREFBK0QsT0FBTztBQUN2ZDtBQUNBO0FBQ0EscUNBQXFDLDBFQUEwRSxxREFBcUQsc0JBQXNCO0FBQzFMO0FBQ0E7QUFDQSxzQkFBc0I7QUFDdEI7QUFDQTtBQUNBO0FBQ0EsUUFBUSwwQkFBMEIsa0NBQWtDLGdCQUFnQiwrQkFBK0IsWUFBWSxtQkFBbUIsdUJBQXVCLHFHQUFxRywwQkFBMEIsWUFBWSxrRkFBa0Ysd0JBQXdCLFFBQVEsS0FBSyxpSUFBaUkseUZBQXlGLDBCQUEwQixrRUFBa0UsNEdBQTRHLFVBQVUseUVBQXlFLHVLQUF1SyxTQUFTLDRDQUE0QztBQUM1bkMsdUJBQXVCLGtDQUFrQyxTQUFTLHNEQUFzRCxnREFBZ0QsdUJBQXVCLDBCQUEwQiw4QkFBOEIsbUJBQW1CLDhCQUE4QixtQkFBbUIsaUNBQWlDLHNCQUFzQixzQ0FBc0MsMkJBQTJCLDhCQUE4QixnQkFBZ0IsbUNBQW1DLFVBQVUsb0RBQW9ELFNBQVMsOERBQThELElBQUksV0FBVztBQUN4cEIsNkNBQTZDLGNBQWM7QUFDM0QsMkJBQTJCLGlQQUFpUCwwQ0FBMEMsU0FBUyw4REFBOEQsa0NBQWtDLHNDQUFzQyw2QkFBNkIsaUNBQWlDLDZCQUE2QixxREFBcUQsa0JBQWtCLDhCQUE4Qix5SEFBeUgsd0JBQXdCLG1CQUFtQiwrQkFBK0IseUJBQXlCLFVBQVUsMENBQTBDLHNFQUFzRSw2QkFBNkIsYUFBYSwyQkFBMkIsbURBQW1ELDZCQUE2QixrREFBa0QscUZBQXFGLHdCQUF3Qix5R0FBeUcsSUFBSSxzQ0FBc0MsK0NBQStDO0FBQ2o5QyxnREFBZ0QsY0FBYztBQUM5RCwyQkFBMkIsc0xBQXNMLFNBQVMsMkRBQTJELGlCQUFpQiw2QkFBNkIsa0NBQWtDLDBCQUEwQixnREFBZ0QsdURBQXVELGlDQUFpQyw2QkFBNkIscURBQXFELGlCQUFpQixVQUFVLDJCQUEyQixraUJBQWtpQix5QkFBeUIsNkJBQTZCLGFBQWEsZUFBZSxzQ0FBc0M7QUFDenlDLDhNQUE4TSw0TkFBNE4sOEJBQThCLDRIQUE0SCxzQ0FBc0MsK0NBQStDO0FBQ3pwQixpREFBaUQsY0FBYztBQUMvRCwyQkFBMkIsNEpBQTRKLHlFQUF5RSwrR0FBK0csZUFBZSxnQ0FBZ0M7QUFDOVosa0JBQWtCLGVBQWUsWUFBWSxtQkFBbUI7QUFDaEUseUNBQXlDLEtBQUssaUtBQWlLLHlCQUF5QjtBQUN4TyxzQkFBc0I7QUFDdEIsMkdBQTJHO0FBQzNHO0FBQ0EsMEJBQTBCO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQyxjQUFjO0FBQzlDO0FBQ0E7QUFDQTtBQUNBLG9EQUFvRCx3SkFBd0o7QUFDNU07QUFDQTtBQUNBLDRJQUE0SSx5Q0FBeUM7QUFDckw7QUFDQTtBQUNBLHFEQUFxRCxNQUFNLFlBQVksZUFBZTtBQUN0Riw0Q0FBNEMsU0FBUyw2Q0FBNkM7QUFDbEc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMERBQTBELHVCQUF1QixjQUFjLDBCQUEwQiw2QkFBNkIsYUFBYSwrREFBK0Q7QUFDbE8sV0FBVyw2QkFBNkIsYUFBYSxnREFBZ0Qsc0NBQXNDLGlCQUFpQixpQ0FBaUMsNkJBQTZCLHFEQUFxRCxrQkFBa0Isd0JBQXdCO0FBQ3pULDZDQUE2QyxtREFBbUQsdUJBQXVCLGFBQWEsR0FBRyxVQUFVLDhDQUE4Qyw0QkFBNEIsZUFBZSxrQkFBa0IsK0JBQStCO0FBQzNSO0FBQ0EsVUFBVSxpREFBaUQseUJBQXlCO0FBQ3BGLDZDQUE2QyxvQ0FBb0Msd0JBQXdCLG9GQUFvRixhQUFhLGtCQUFrQixnQ0FBZ0MsYUFBYSxnQkFBZ0IsOEJBQThCLDRIQUE0SCxzQ0FBc0MscURBQXFELGNBQWMsS0FBSyxzQ0FBc0M7QUFDdmtCLDJDQUEyQyw4Q0FBOEMsaUNBQWlDLDJCQUEyQiw4Q0FBOEM7QUFDbk0scUNBQXFDLGNBQWM7QUFDbkQsMkJBQTJCLHVCQUF1QixlQUFlLHlEQUF5RCx5QkFBeUI7QUFDbkosbUdBQW1HLGVBQWUsd0JBQXdCLDZGQUE2RiwrQ0FBK0Msd0RBQXdELE1BQU0sU0FBUyxnQkFBZ0Isc0NBQXNDO0FBQ25aLDBGQUEwRixxQ0FBcUMsbUJBQW1CO0FBQ2xKLDRGQUE0RixZQUFZO0FBQ3hHO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTSx1QkFBdUIsaURBQWlEO0FBQzlFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ04sOEJBQThCLGtFQUFrRSxvREFBb0QsZ0RBQWdELE1BQU07QUFDMU07QUFDQTtBQUNBO0FBQ0EsU0FBUyx5QkFBeUI7QUFDbEMsb0RBQW9ELDJCQUEyQixrQkFBa0IsMkNBQTJDO0FBQzVJLDREQUE0RCxjQUFjO0FBQzFFLDJCQUEyQixzT0FBc08sOExBQThMLGtEQUFrRCxlQUFlLG9DQUFvQyxjQUFjLGtCQUFrQixlQUFlLHFEQUFxRCxvQ0FBb0Msc0NBQXNDLGFBQWEsa0JBQWtCLDRDQUE0QyxLQUFLLHVCQUF1QixhQUFhLHlCQUF5QixNQUFNLDBCQUEwQixTQUFTLHNCQUFzQixJQUFJLG9CQUFvQjtBQUN0N0IsZUFBZSxTQUFTO0FBQ3hCO0FBQ0E7QUFDQSxXQUFXLHdCQUF3QixTQUFTLHNCQUFzQixJQUFJLG9CQUFvQjtBQUMxRixlQUFlLFNBQVM7QUFDeEI7QUFDQTtBQUNBLFdBQVcsd0JBQXdCLHFGQUFxRix3QkFBd0Isc0hBQXNILG9CQUFvQjtBQUMxUjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUyx1QkFBdUIsb0dBQW9HLHFCQUFxQixvVEFBb1QsZUFBZSxzQ0FBc0Msd0NBQXdDO0FBQzFpQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNENBQTRDLDJGQUEyRixjQUFjLEVBQUUsY0FBYyxFQUFFLEdBQUcsRUFBRSxZQUFZLEdBQUcsRUFBRSx1Q0FBdUM7QUFDcE8sK0JBQStCLHdCQUF3Qiw0RUFBNEUsbUJBQW1CLHVCQUF1QixFQUFFLE9BQU8saUZBQWlGLEdBQUcsOENBQThDLEVBQUUsSUFBSTtBQUM5VDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYywwQkFBMEIsV0FBVyxNQUFNLGVBQWUsc0NBQXNDLDZDQUE2QztBQUMzSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdEQUFnRCxvQkFBb0Isc0ZBQXNGLGlCQUFpQixFQUFFLDRDQUE0QyxLQUFLLEdBQUcsRUFBRTtBQUNuTztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYyxzQ0FBc0MsTUFBTSxlQUFlLHNDQUFzQztBQUMvRztBQUNBO0FBQ0E7QUFDQTtBQUNBLGtFQUFrRSw2QkFBNkIsc0JBQXNCLGtEQUFrRCxxQkFBcUIsa0VBQWtFLFVBQVUsUUFBUSw2Q0FBNkMsaUZBQWlGO0FBQzlZO0FBQ0E7QUFDQTtBQUNBLFdBQVcsTUFBTSxTQUFTLDZDQUE2QztBQUN2RSwyQ0FBMkMsdUdBQXVHLG1DQUFtQztBQUNyTCxvREFBb0Q7QUFDcEQsd0JBQXdCO0FBQ3hCLDJEQUEyRCxtRUFBbUUsK0RBQStELEtBQUssdUJBQXVCLGFBQWEseUJBQXlCLG9FQUFvRSxJQUFJLDBCQUEwQixvRUFBb0UsS0FBSyxJQUFJLG1IQUFtSCw2QkFBNkIsV0FBVyw4QkFBOEIscUJBQXFCLHdDQUF3QywrQ0FBK0MsdUNBQXVDLGFBQWEsOEJBQThCLFFBQVEsaUNBQWlDLG9CQUFvQixpQ0FBaUMsc0RBQXNELHFDQUFxQyxzQkFBc0I7QUFDcC9CLHlDQUF5QyxjQUFjO0FBQ3ZELDRCQUE0QixvQ0FBb0MsOGxCQUE4bEIsZ0JBQWdCLG1JQUFtSSwwSUFBMEksUUFBUSxRQUFRLG9EQUFvRCxzQ0FBc0MsYUFBYSxJQUFJLHVCQUF1Qix5QkFBeUIsMkNBQTJDLDBCQUEwQixvQ0FBb0MsMkJBQTJCLEtBQUssMkJBQTJCLGlDQUFpQyxvQkFBb0IsVUFBVSxzQkFBc0IsVUFBVSxnQkFBZ0IsS0FBSyxxQkFBcUI7QUFDbjVDLGtCQUFrQixPQUFPLG9CQUFvQixzQ0FBc0MsUUFBUSxxREFBcUQsOENBQThDLG9FQUFvRSxxREFBcUQsa0VBQWtFLG9EQUFvRCxrRUFBa0Usa0NBQWtDLGlHQUFpRyxjQUFjLHlCQUF5QixtQkFBbUIsSUFBSSxxQ0FBcUMsYUFBYSxZQUFZLHdCQUF3QjtBQUN0d0Isa0JBQWtCLE9BQU8sZ0NBQWdDLFFBQVEsSUFBSSxzQkFBc0Isa0RBQWtELG1EQUFtRCxhQUFhLHdFQUF3RSxrRUFBa0Usb0JBQW9CLHFCQUFxQixlQUFlLHdCQUF3Qix3QkFBd0IsVUFBVSxvQkFBb0IsYUFBYSxhQUFhLHFDQUFxQywwSEFBMEgsc0JBQXNCLEtBQUssb0JBQW9CLGdFQUFnRTtBQUNyd0I7QUFDQTtBQUNBLFlBQVksZ0NBQWdDO0FBQzVDLE9BQU8scUJBQXFCO0FBQzVCO0FBQ0E7QUFDQSxvQkFBb0I7QUFDcEIsZ0NBQWdDO0FBQ2hDO0FBQ0EsT0FBTyxvQkFBb0Isc0NBQXNDLFlBQVksMEZBQTBGLCtEQUErRCwwQkFBMEIsMENBQTBDLGVBQWUscUJBQXFCLG1CQUFtQixJQUFJLEtBQUsscUJBQXFCLDBDQUEwQyx3SEFBd0gseUhBQXlILHFCQUFxQixJQUFJLG9EQUFvRCxnRkFBZ0YscUJBQXFCLFVBQVUsb0ZBQW9GLFFBQVEseUVBQXlFLFVBQVUsd0JBQXdCLCtFQUErRTtBQUM1bUMseUNBQXlDLFVBQVUsSUFBSSxVQUFVLEtBQUsscUJBQXFCLG1DQUFtQyxVQUFVLGlIQUFpSCx3Q0FBd0MsS0FBSyw4QkFBOEIseURBQXlELGlNQUFpTSxnQkFBZ0IscUJBQXFCLEtBQUssd0JBQXdCO0FBQ2hvQix1Q0FBdUM7QUFDdkM7QUFDQTtBQUNBLDZCQUE2QixnQkFBZ0Isd0JBQXdCLFlBQVksZ0JBQWdCLGdDQUFnQyxzREFBc0Q7QUFDdkw7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTyx5QkFBeUIsVUFBVSx1Q0FBdUMscUlBQXFJLHlCQUF5QixJQUFJLHlCQUF5QixhQUFhLGNBQWM7QUFDdlMsa0JBQWtCLHdEQUF3RCxRQUFRO0FBQ2xGO0FBQ0EsT0FBTyx5QkFBeUIsS0FBSyx3REFBd0QsT0FBTyxPQUFPLHlCQUF5QixxQ0FBcUMsT0FBTyxLQUFLLHlCQUF5QixxQ0FBcUMsT0FBTyxLQUFLLDRCQUE0QiwyQkFBMkIsc0JBQXNCLDRDQUE0QywwQkFBMEIsS0FBSyxzQkFBc0IsNFFBQTRRLHNCQUFzQixRQUFRLHFCQUFxQiwwRkFBMEYsMEJBQTBCLDRCQUE0Qix3REFBd0QsYUFBYSx3Q0FBd0Msb0JBQW9CLFVBQVUsYUFBYSxzQ0FBc0MsZ0JBQWdCLGFBQWEsaUJBQWlCLHNCQUFzQiwwREFBMEQ7QUFDeHJDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUVBQXFFLGdDQUFnQztBQUNyRztBQUNBO0FBQ0EsaUNBQWlDLHlIQUF5SDtBQUMxSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDLG9GQUFvRjtBQUNySDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlGQUFpRixtQkFBbUI7QUFDcEc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0QiwyQ0FBMkM7QUFDdkU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVcsdUJBQXVCLElBQUksNEJBQTRCLElBQUksc0JBQXNCLDJEQUEyRCxxRUFBcUUseUJBQXlCLG1IQUFtSCxZQUFZLDRFQUE0RSx1RUFBdUUsMEJBQTBCLHNCQUFzQixlQUFlLHFCQUFxQixtQkFBbUIsSUFBSSx5QkFBeUIsbUNBQW1DLHFGQUFxRix1REFBdUQseUJBQXlCLGdJQUFnSSxPQUFPLDRDQUE0QyxxQkFBcUIscUJBQXFCLDBIQUEwSCx5RUFBeUUsY0FBYyxxQkFBcUIseUJBQXlCLDJCQUEyQiwrQkFBK0IsMkRBQTJELFVBQVUsME5BQTBOLFlBQVk7QUFDcHBEO0FBQ0EsNERBQTRELFlBQVk7QUFDeEUsTUFBTSx5aUJBQXlpQix5QkFBeUIsa0VBQWtFLDhCQUE4QixzQkFBc0IsZ0hBQWdILHVCQUF1QixtQkFBbUIsdUZBQXVGLHdDQUF3QztBQUN2OUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0RBQWtELGVBQWU7QUFDakU7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrRUFBa0U7QUFDbEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVUsVUFBVSwrRkFBK0YsUUFBUSwrREFBK0QsYUFBYSwrREFBK0Q7QUFDdFE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzSUFBc0k7QUFDdEk7QUFDQTtBQUNBO0FBQ0EsTUFBTSxXQUFXLHNCQUFzQjtBQUN2QztBQUNBO0FBQ0EsT0FBTyxzQkFBc0IsVUFBVSxXQUFXLHVFQUF1RSxrTEFBa0wsc0JBQXNCO0FBQ2pVO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTyx5QkFBeUIsOENBQThDLGVBQWUsd0VBQXdFLHFCQUFxQiwrQkFBK0IsbUJBQW1CLDRCQUE0Qix3REFBd0QsbUVBQW1FLGdCQUFnQixRQUFRLFdBQVcsR0FBRyxrREFBa0QsS0FBSyxxQkFBcUIsd0JBQXdCO0FBQzdnQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFzQixXQUFXLHFCQUFxQix3REFBd0QsNEJBQTRCLE9BQU8sa0NBQWtDLGlCQUFpQixrQ0FBa0MsSUFBSSxJQUFJO0FBQzlPO0FBQ0E7QUFDQSxNQUFNLFdBQVcscUJBQXFCLDBDQUEwQyx5QkFBeUIsc0NBQXNDLGlDQUFpQyx1QkFBdUIsMEJBQTBCLDZDQUE2QyxnRkFBZ0YsdUJBQXVCLElBQUkscUJBQXFCLGtDQUFrQyxrSkFBa0osNEJBQTRCLFdBQVcscURBQXFELElBQUksb0JBQW9CLGtCQUFrQixLQUFLLDRCQUE0QixzRkFBc0YsWUFBWSxrQ0FBa0Msb0VBQW9FLGtCQUFrQiwwQkFBMEIsZ0NBQWdDLFlBQVksZ0JBQWdCLDZFQUE2RSxnQ0FBZ0MsNENBQTRDLHFCQUFxQixtQkFBbUIsMkJBQTJCLEtBQUsscUJBQXFCLG1CQUFtQixzQkFBc0I7QUFDeHpDLG1CQUFtQixXQUFXO0FBQzlCLG1CQUFtQixpRkFBaUYsbUNBQW1DLDJGQUEyRixzQ0FBc0MsZ0JBQWdCLHNCQUFzQjtBQUM5UyxrQkFBa0I7QUFDbEI7QUFDQSxPQUFPLHFCQUFxQixtQ0FBbUMsWUFBWSw4Q0FBOEMsNEJBQTRCLCtDQUErQyxxQkFBcUIsbUJBQW1CLHNCQUFzQixLQUFLLHNCQUFzQixtQ0FBbUMscURBQXFELFlBQVkscURBQXFELCtDQUErQyxhQUFhLGtDQUFrQyxlQUFlLHNCQUFzQixLQUFLLHlCQUF5QixtUkFBbVIsNENBQTRDLG1DQUFtQyw4QkFBOEIsWUFBWSxZQUFZLHFCQUFxQiwwQkFBMEIsUUFBUSxhQUFhLHlCQUF5QixjQUFjLG1GQUFtRixpQkFBaUIsU0FBUyxnQkFBZ0IsZ0VBQWdFLG1DQUFtQyxvRkFBb0YsMEJBQTBCLHFCQUFxQix5REFBeUQsc0JBQXNCLHFDQUFxQyxzQkFBc0Isc0JBQXNCLHFCQUFxQix3Q0FBd0Msc0JBQXNCLG1DQUFtQyx3QkFBd0IsU0FBUyxZQUFZLGdEQUFnRCxtREFBbUQsYUFBYSwrQkFBK0Isc0NBQXNDLG1CQUFtQiwyQkFBMkIsS0FBSyw0QkFBNEIsU0FBUywyQkFBMkIsSUFBSSx5QkFBeUIsbURBQW1ELHFCQUFxQiw4SUFBOEkscUJBQXFCLHVFQUF1RSxxQkFBcUIsbUVBQW1FLHFCQUFxQixtRUFBbUUsU0FBUywwREFBMEQsYUFBYSxvQ0FBb0Msd0JBQXdCLHdCQUF3QixVQUFVLG9CQUFvQixHQUFHO0FBQzV1Rix3RkFBd0YsZ0JBQWdCLEVBQUUsSUFBSSxzQkFBc0I7QUFDcEk7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBDQUEwQyw4QkFBOEIseUNBQXlDO0FBQ2pILHVDQUF1QztBQUN2QztBQUNBO0FBQ0Esd0NBQXdDLE9BQU8sOEJBQThCLHNDQUFzQztBQUNuSDtBQUNBLGVBQWU7QUFDZixhQUFhO0FBQ2I7QUFDQTtBQUNBLG9DQUFvQyxPQUFPLDhCQUE4QixnQkFBZ0I7QUFDekY7QUFDQSxXQUFXLEtBQUssb0ZBQW9GLGtFQUFrRSx3QkFBd0IsdUNBQXVDLFNBQVMsc0JBQXNCLEtBQUssaUNBQWlDLG1FQUFtRSwrQkFBK0IsY0FBYyxLQUFLLG1CQUFtQixJQUFJLDBFQUEwRSx3QkFBd0IsU0FBUywyQkFBMkIsd0JBQXdCLE1BQU0sZ0hBQWdILE9BQU87QUFDanRCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVSxTQUFTLDJEQUEyRCx5R0FBeUcsS0FBSyx5QkFBeUIsb0JBQW9CLDhCQUE4QixrSUFBa0ksaUNBQWlDO0FBQzFhO0FBQ0Esc0JBQXNCO0FBQ3RCLHlDQUF5QyxxREFBcUQsMkNBQTJDLFNBQVM7QUFDbEosV0FBVyxxQ0FBcUMsVUFBVSxnRUFBZ0UsOEJBQThCLG9CQUFvQix5QkFBeUIsTUFBTSxLQUFLLDZDQUE2QyxNQUFNLGlFQUFpRSxjQUFjLGtEQUFrRCxvREFBb0Qsc0NBQXNDLG9DQUFvQywwQkFBMEIsa0JBQWtCLGdCQUFnQixLQUFLLHNDQUFzQyxrQ0FBa0MsMENBQTBDLHFDQUFxQztBQUMxdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWUsd0NBQXdDLGtFQUFrRSx3QkFBd0IsOEJBQThCLFNBQVMsc0JBQXNCLEtBQUssdUdBQXVHLE9BQU8sU0FBUztBQUMxVTtBQUNBO0FBQ0EsaUJBQWlCLGlCQUFpQixrREFBa0QsY0FBYztBQUNsRztBQUNBO0FBQ0EsZUFBZTtBQUNmLHVDQUF1QyxnQkFBZ0I7QUFDdkQsMkJBQTJCLHVOQUF1TiwrQkFBK0Isb0JBQW9CLHlDQUF5QyxTQUFTLDBEQUEwRCw4SUFBOEksNkJBQTZCLGVBQWUsc0NBQXNDLHlCQUF5QixpQ0FBaUMsNkJBQTZCLHFEQUFxRCxrQkFBa0Isc0NBQXNDLDBDQUEwQywrQkFBK0Isb0JBQW9CLHlCQUF5Qiw4Q0FBOEMsZ0NBQWdDLFVBQVU7QUFDbmdDLDJDQUEyQyxjQUFjO0FBQ3pELDRCQUE0QixvQ0FBb0MsNFJBQTRSLGdDQUFnQyw4QkFBOEIsMEJBQTBCLDBHQUEwRyxpQkFBaUIsSUFBSSxxREFBcUQsNkJBQTZCLDBFQUEwRSxpQ0FBaUMsNkJBQTZCLHFEQUFxRCxrQkFBa0IseUJBQXlCLDJDQUEyQyxvQkFBb0IsZ0RBQWdELG9DQUFvQyxJQUFJLGtCQUFrQixTQUFTLDJEQUEyRCx5Q0FBeUMsR0FBRyxhQUFhLGtGQUFrRix3Q0FBd0MseUNBQXlDLEdBQUcsWUFBWTtBQUNyMEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVSxrREFBa0QseUNBQXlDLCtDQUErQztBQUNwSjtBQUNBLHNCQUFzQjtBQUN0QiwrREFBK0QsNktBQTZLO0FBQzVPO0FBQ0E7QUFDQSx5QkFBeUIsS0FBSyxLQUFLLGVBQWUsNEJBQTRCLHVCQUF1QjtBQUNyRztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2RUFBNkUsZ0JBQWdCLDZCQUE2QiwyQkFBMkIsNEJBQTRCLG1CQUFtQixzQ0FBc0MsMENBQTBDLG9DQUFvQyxxQkFBcUI7QUFDN1U7QUFDQTtBQUNBLFVBQVUsU0FBUztBQUNuQixvQ0FBb0MsZ0JBQWdCO0FBQ3BELDJCQUEyQixvUEFBb1AsT0FBTyx1QkFBdUIsV0FBVyx1QkFBdUIsWUFBWSx1QkFBdUIsVUFBVSx5QkFBeUIsMkJBQTJCO0FBQ2hiO0FBQ0E7QUFDQSw4Q0FBOEMsY0FBYyxnREFBZ0QsY0FBYztBQUMxSCxTQUFTLHVCQUF1Qix5QkFBeUIsb0JBQW9CLHFFQUFxRSwwTkFBME47QUFDNVcsbUJBQW1CLGdEQUFnRCx3QkFBd0I7QUFDM0YsbUJBQW1CLGlDQUFpQyxjQUFjO0FBQ2xFLHVDQUF1QyxXQUFXLDBCQUEwQiwyRkFBMkYsMklBQTJJLHlDQUF5QyxxQkFBcUIsdUNBQXVDLHFCQUFxQjtBQUM1YSwyQ0FBMkMsY0FBYztBQUN6RDtBQUNBO0FBQ0Esb0JBQW9CLGNBQWM7QUFDbEM7QUFDQSxTQUFTLFNBQVMsa0VBQWtFLFdBQVcsb0NBQW9DLDRHQUE0RztBQUMvTyx3RUFBd0UsOEVBQThFO0FBQ3RKO0FBQ0EsaU1BQWlNLDJCQUEyQjtBQUM1TixXQUFXLHNEQUFzRCxZQUFZLFlBQVksMEhBQTBILElBQUksbURBQW1ELFFBQVEsd0NBQXdDLFdBQVcsaUNBQWlDLFNBQVMsd0JBQXdCLFNBQVMseUJBQXlCLGNBQWM7QUFDdmIsNENBQTRDLGNBQWM7QUFDMUQsMkJBQTJCLDRKQUE0Siw4QkFBOEIsZ0JBQWdCLDBDQUEwQyxnQkFBZ0Isb0RBQW9ELG9DQUFvQyw4Q0FBOEMsMEJBQTBCLG9DQUFvQyxxR0FBcUcsd0JBQXdCLGdDQUFnQyx3UUFBd1EsY0FBYyxtQ0FBbUMsbUVBQW1FLHNEQUFzRCx3QkFBd0IseUJBQXlCLEtBQUssd0JBQXdCLFlBQVksd1ZBQXdWLHdCQUF3QixtQkFBbUIsZ0JBQWdCLGlEQUFpRCwwREFBMEQscURBQXFELFNBQVMsdUNBQXVDLG9GQUFvRiwrQkFBK0IsbUVBQW1FLHVCQUF1QiwwQkFBMEIsOEJBQThCLDJDQUEyQyx1REFBdUQsbUJBQW1CLDhCQUE4QixtQkFBbUIsaUNBQWlDLHNCQUFzQix1Q0FBdUMsOEJBQThCLHdDQUF3QyxpQ0FBaUMsd0NBQXdDLE9BQU8sVUFBVTtBQUN4NUUsd0NBQXdDLGNBQWM7QUFDdEQsNEJBQTRCLG9DQUFvQywyVEFBMlQsaUVBQWlFLHFCQUFxQixpVUFBaVUsZ0NBQWdDLHNCQUFzQiw2RkFBNkYsbUJBQW1CLHVDQUF1QztBQUMvOUI7QUFDQTtBQUNBLDBCQUEwQjtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNERBQTRELGVBQWUsZ0NBQWdDO0FBQzNHLDJNQUEyTTtBQUMzTTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyakJBQTJqQixpREFBaUQsd0lBQXdJO0FBQ3B2QjtBQUNBO0FBQ0E7QUFDQSxnQ0FBZ0MseUJBQXlCO0FBQ3pEO0FBQ0E7QUFDQSx1SEFBdUgsOEJBQThCO0FBQ3JKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbURBQW1ELGlDQUFpQztBQUNwRjtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhJQUE4SSxtRUFBbUU7QUFDak47QUFDQSxrQ0FBa0MsaUNBQWlDO0FBQ25FO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhDQUE4Qyx1Q0FBdUM7QUFDckY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUNBQXVDO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrREFBa0Qsa0RBQWtELG1CQUFtQiw0Q0FBNEM7QUFDbks7QUFDQTtBQUNBLFFBQVEsMEJBQTBCLHlIQUF5SCx3QkFBd0Isb0RBQW9ELFVBQVUsZ0RBQWdELDBIQUEwSCxLQUFLLGlDQUFpQyx3QkFBd0IsWUFBWSxxTUFBcU0sd0RBQXdELDhCQUE4QjtBQUNod0Isa0JBQWtCO0FBQ2xCO0FBQ0EsT0FBTyxxQkFBcUIsa0NBQWtDLHVEQUF1RCxxQkFBcUIsY0FBYyxjQUFjLHFCQUFxQjtBQUMzTDtBQUNBO0FBQ0EsaURBQWlELG1EQUFtRDtBQUNwRyxvREFBb0QsK0NBQStDO0FBQ25HO0FBQ0E7QUFDQSwwQ0FBMEMsWUFBWSxNQUFNLGtDQUFrQztBQUM5RjtBQUNBO0FBQ0E7QUFDQSxNQUFNLGdCQUFnQixtQkFBbUIsdUJBQXVCLFlBQVksd0VBQXdFLDhEQUE4RCwwM0JBQTAzQixnR0FBZ0csSUFBSSw0REFBNEQsaUZBQWlGLG1GQUFtRixTQUFTLEtBQUssa0NBQWtDLDBCQUEwQixnT0FBZ08scUJBQXFCLHd1QkFBd3VCLG1IQUFtSCwwQkFBMEIsZ0ZBQWdGLDJCQUEyQiwrSEFBK0gsS0FBSyx3Q0FBd0M7QUFDMzFGO0FBQ0E7QUFDQSxtR0FBbUc7QUFDbkcsMkVBQTJFLHVCQUF1QixRQUFRO0FBQzFHO0FBQ0EsMkVBQTJFLHdCQUF3QixTQUFTLGdCQUFnQjtBQUM1SDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0VBQWdFLHFEQUFxRCwwQ0FBMEMsc0pBQXNKLG1CQUFtQjtBQUN4VTtBQUNBO0FBQ0E7QUFDQSxrRUFBa0UsMEJBQTBCLDBDQUEwQyxzSkFBc0osOEJBQThCO0FBQzFULE1BQU0sMmFBQTJhLHlKQUF5SiwrREFBK0QseUNBQXlDLDhJQUE4SSwyQkFBMkIsVUFBVSxzQkFBc0IsNERBQTRELDJJQUEySSx1QkFBdUIsc0ZBQXNGLGtFQUFrRSxxQkFBcUIsaUZBQWlGLDhDQUE4QyxxQkFBcUIsWUFBWSwySUFBMkksd0JBQXdCLDJDQUEyQyw0Q0FBNEMsUUFBUSx3QkFBd0IsWUFBWSwyR0FBMkcsY0FBYyxTQUFTLHFCQUFxQix5Q0FBeUMsOEdBQThHLHFCQUFxQixVQUFVLDBCQUEwQix5Q0FBeUMsd0JBQXdCLFlBQVksOENBQThDLGNBQWMsMkNBQTJDLGNBQWMsUUFBUSxvQkFBb0IsK0RBQStEO0FBQ2gxRSxrQkFBa0I7QUFDbEI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPLHVEQUF1RCxlQUFlLDJUQUEyVCxjQUFjLG9CQUFvQixpRUFBaUU7QUFDM2Usa0JBQWtCO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTyx1RUFBdUUsZUFBZSwyVEFBMlQsY0FBYyxvQkFBb0IsZ0NBQWdDLHlCQUF5Qiw2Q0FBNkMsVUFBVSwwRkFBMEYsa0hBQWtILDRCQUE0QjtBQUNseEI7QUFDQTtBQUNBLFVBQVUsbUJBQW1CLGVBQWUsZ0JBQWdCLHNDQUFzQyx1QkFBdUIsb0VBQW9FLHdEQUF3RCxxQkFBcUIsR0FBRyxvREFBb0QsMEJBQTBCLDZDQUE2QyxxQ0FBcUMsS0FBSyxxQkFBcUI7QUFDdmMsMkJBQTJCLGNBQWMsZ0JBQWdCO0FBQ3pEO0FBQ0Esb0NBQW9DLGNBQWMsWUFBWSwrQkFBK0IsT0FBTyx1REFBdUQsb0RBQW9ELDRDQUE0QyxPQUFPO0FBQ2xRLHdGQUF3Rix1QkFBdUIsOEJBQThCLEtBQUssS0FBSztBQUN2SjtBQUNBO0FBQ0EsNENBQTRDLHVCQUF1QiwwREFBMEQscUJBQXFCLHlDQUF5QyxnQ0FBZ0MsT0FBTyxLQUFLLHdCQUF3QixvQkFBb0IscURBQXFEO0FBQ3hVO0FBQ0EsZ1RBQWdULG9EQUFvRCxPQUFPLCtLQUErSyxRQUFRLFlBQVkscVFBQXFRLG9FQUFvRSx5QkFBeUIsS0FBSztBQUNyNUIsT0FBTyx3QkFBd0IsOEJBQThCLHlCQUF5QixtQ0FBbUMseUJBQXlCLFVBQVUsd0JBQXdCLDJJQUEySSxzcUJBQXNxQixxQkFBcUIsNERBQTRELHFCQUFxQix5REFBeUQsU0FBUyxvQ0FBb0MsMEZBQTBGLE9BQU8sWUFBWSwrQkFBK0Isc0JBQXNCLGdEQUFnRCxlQUFlLHVDQUF1QyxRQUFRLElBQUksb0dBQW9HLE9BQU8sbUpBQW1KLE9BQU8sMkVBQTJFLDhCQUE4QixZQUFZLGdDQUFnQyw4QkFBOEIsV0FBVyx3QkFBd0Isb0NBQW9DLGtCQUFrQiwyQkFBMkIsVUFBVSxNQUFNLHVCQUF1QiwwQkFBMEIsOEJBQThCLDJDQUEyQywwREFBMEQscUNBQXFDLHFOQUFxTiw0SUFBNEkseUJBQXlCLEtBQUssb0RBQW9ELG1CQUFtQiw4QkFBOEIsbUJBQW1CLGlDQUFpQyxzQkFBc0Isc0NBQXNDLDBDQUEwQywwQ0FBMEMsaUJBQWlCLDhDQUE4QyxzQkFBc0IsNkNBQTZDLFFBQVEsS0FBSywyQ0FBMkMsaUJBQWlCLHNCQUFzQixlQUFlLFFBQVEsc0NBQXNDLHFEQUFxRDtBQUNydEcsc0JBQXNCLHNJQUFzSSx3REFBd0Qsd0JBQXdCLE1BQU0sNkRBQTZELEtBQUs7QUFDcFQsMkRBQTJELG1DQUFtQztBQUM5RjtBQUNBLHFDQUFxQyxnQkFBZ0I7QUFDckQsMkJBQTJCLHdUQUF3VCxnQkFBZ0IscUNBQXFDLG9CQUFvQiwyREFBMkQsd0JBQXdCLGtXQUFrVyxnR0FBZ0csZ0JBQWdCLDJCQUEyQixxQkFBcUIsd0ZBQXdGLGNBQWMsa0NBQWtDLHFCQUFxQixxQkFBcUIsMlRBQTJULHdCQUF3QixtQkFBbUIsdUNBQXVDLDJCQUEyQix1Q0FBdUMsMkJBQTJCLHVDQUF1Qyx3R0FBd0csdUNBQXVDLG1DQUFtQywwQ0FBMEMsdUZBQXVGLDBDQUEwQywwWEFBMFgsMkJBQTJCLGlEQUFpRCxLQUFLLHdCQUF3QixrQ0FBa0MsMkJBQTJCO0FBQ2pqRix3QkFBd0IsaUJBQWlCO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPLHFCQUFxQjtBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNDQUFzQyxzQ0FBc0Msb05BQW9OLDJFQUEyRTtBQUMzVztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1REFBdUQsa0JBQWtCLGtFQUFrRSxVQUFVLGtEQUFrRCxPQUFPO0FBQzlNO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFzQjtBQUN0QjtBQUNBO0FBQ0E7QUFDQSxvQ0FBb0MsWUFBWSx3S0FBd0s7QUFDeE47QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQkFBc0I7QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2QkFBNkIseUJBQXlCO0FBQ3REO0FBQ0E7QUFDQSxzR0FBc0csOEJBQThCO0FBQ3BJO0FBQ0E7QUFDQSxxREFBcUQsOERBQThEO0FBQ25IO0FBQ0E7QUFDQSxPQUFPLHFCQUFxQixnQ0FBZ0MscUJBQXFCLG9EQUFvRCxjQUFjLGtHQUFrRyxxQ0FBcUMsZ0JBQWdCLFVBQVUsdUJBQXVCO0FBQzNVO0FBQ0E7QUFDQSxzREFBc0QsaUNBQWlDO0FBQ3ZGO0FBQ0E7QUFDQTtBQUNBLDhDQUE4Qyx5QkFBeUIsT0FBTywrSEFBK0gsMkJBQTJCLFlBQVksMEtBQTBLO0FBQzlaO0FBQ0Esb0RBQW9EO0FBQ3BEO0FBQ0E7QUFDQTtBQUNBLDBDQUEwQyxxQkFBcUI7QUFDL0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyRUFBMkUsd0JBQXdCLFNBQVMsZ0JBQWdCO0FBQzVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrREFBK0Qsd0RBQXdELG9DQUFvQyxXQUFXLG9EQUFvRCx5Q0FBeUMsMEZBQTBGLE9BQU8sdUdBQXVHLEtBQUssS0FBSztBQUNyZDtBQUNBO0FBQ0E7QUFDQSxrRUFBa0Usd0RBQXdELCtEQUErRCxPQUFPLDhIQUE4SCx3RUFBd0UsT0FBTywrRkFBK0Ysb0NBQW9DLDJEQUEyRCx5Q0FBeUMsZ0ZBQWdGLEtBQUs7QUFDenNCLE1BQU0sbUNBQW1DLDhDQUE4QyxlQUFlO0FBQ3RHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEJBQTBCLHVDQUF1QywyQkFBMkIsdUNBQXVDLGtGQUFrRixJQUFJO0FBQ3pOLHVIQUF1SCw4REFBOEQsOENBQThDLHVCQUF1Qiw0RUFBNEUsa0dBQWtHLDJGQUEyRix3QkFBd0IsSUFBSSxVQUFVLGdEQUFnRCxnSEFBZ0gsb0JBQW9CLHNCQUFzQiwySEFBMkgsV0FBVyx3REFBd0QsMENBQTBDLHVFQUF1RSxPQUFPO0FBQ3ppQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLDBDQUEwQyxlQUFlO0FBQ2pGO0FBQ0E7QUFDQTtBQUNBLDZIQUE2SCxxQkFBcUI7QUFDbEosT0FBTyxLQUFLO0FBQ1osbURBQW1ELHVCQUF1Qiw0QkFBNEIsVUFBVSxJQUFJO0FBQ3BIO0FBQ0EsTUFBTSxpRUFBaUUsdUJBQXVCLGdCQUFnQixtREFBbUQsS0FBSyxNQUFNLHVCQUF1Qiw4Q0FBOEMscUZBQXFGLDRCQUE0Qix1Q0FBdUMsMEJBQTBCLCtDQUErQyxnQ0FBZ0Msc0RBQXNELFFBQVEscUJBQXFCLHlDQUF5QyxvREFBb0QsT0FBTyw4REFBOEQsNkNBQTZDLHdCQUF3QixLQUFLLEtBQUssT0FBTyxTQUFTLG9EQUFvRDtBQUMxM0IseUNBQXlDLGNBQWM7QUFDdkQsMkJBQTJCLGlWQUFpVixpTUFBaU0sd0JBQXdCLDhIQUE4SCxxQkFBcUIsWUFBWSwra0JBQStrQixxQkFBcUI7QUFDeDBDLDRFQUE0RTtBQUM1RSxrQkFBa0I7QUFDbEI7QUFDQSxNQUFNLGtDQUFrQywrSEFBK0gsb0NBQW9DLDJCQUEyQix3Q0FBd0MsOERBQThELHdDQUF3Qyw4REFBOEQscUJBQXFCLHdHQUF3RyxNQUFNLDJCQUEyQjtBQUNobEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5REFBeUQsc0NBQXNDO0FBQy9GO0FBQ0E7QUFDQSx3RUFBd0UsUUFBUSx3TEFBd0wsaUNBQWlDLCtCQUErQixrQ0FBa0MsZ0NBQWdDLGtDQUFrQyxvQ0FBb0MsU0FBUyxvQ0FBb0M7QUFDN2Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtGQUFrRiwyQkFBMkIscUNBQXFDLG9DQUFvQyx1REFBdUQsNkJBQTZCLDZCQUE2QixzQ0FBc0MsV0FBVyxzQ0FBc0MsK0NBQStDO0FBQzdhLHFDQUFxQyxjQUFjO0FBQ25ELDJCQUEyQixrR0FBa0csWUFBWSw0V0FBNFc7QUFDcmY7QUFDQTtBQUNBLG1CQUFtQixRQUFRLG9CQUFvQjtBQUMvQyxrQkFBa0Isc0JBQXNCO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPLElBQUksMEJBQTBCO0FBQ3JDLG9CQUFvQjtBQUNwQjtBQUNBO0FBQ0EsNEJBQTRCLE9BQU87QUFDbkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU8sdUJBQXVCO0FBQzlCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTyxpREFBaUQsWUFBWTtBQUNwRTtBQUNBO0FBQ0Esa0JBQWtCLFdBQVcsMEVBQTBFLGNBQWMsMkNBQTJDO0FBQ2hLLDJDQUEyQyxjQUFjO0FBQ3pELDJCQUEyQixrRkFBa0Ysc0NBQXNDLE1BQU0sSUFBSSxzQkFBc0IsdUJBQXVCLG1CQUFtQixvQkFBb0IsV0FBVyxxQkFBcUI7QUFDalIsMkpBQTJKLG9CQUFvQixtQ0FBbUMsY0FBYztBQUNoTyxnREFBZ0QsT0FBTyxZQUFZLGNBQWM7QUFDakYsNEJBQTRCLFNBQVMsZ0RBQWdELGtCQUFrQiw0QkFBNEIsc0JBQXNCLG9CQUFvQiw2QkFBNkIsZ0hBQWdILGtCQUFrQiw0Q0FBNEMsZ0ZBQWdGLE1BQU0sbUNBQW1DLFdBQVcsc0NBQXNDLFdBQVcsb0NBQW9DLDZDQUE2QyxZQUFZLFlBQVkscUdBQXFHLGNBQWMsaUNBQWlDLFNBQVMsMENBQTBDLGFBQWE7QUFDMTJCLDJDQUEyQyxjQUFjO0FBQ3pELDJCQUEyQiw4RkFBOEYsZUFBZSx5REFBeUQsYUFBYSw4Q0FBOEMsYUFBYSwwQ0FBMEMsYUFBYSxPQUFPLGVBQWUsMEJBQTBCLHNEQUFzRCxjQUFjO0FBQ3BiLHNJQUFzSSx1Q0FBdUMsT0FBTyxZQUFZLGNBQWM7QUFDOU0sZ0NBQWdDLHFFQUFxRSxhQUFhLFlBQVksZUFBZSxnQ0FBZ0MsY0FBYztBQUMzTCw0QkFBNEIsNERBQTRELGFBQWEsWUFBWSxTQUFTLCtEQUErRCxrREFBa0QsWUFBWSxZQUFZLDBFQUEwRSx1Q0FBdUMsYUFBYSxXQUFXLGlDQUFpQyxjQUFjO0FBQzNiLG9DQUFvQyxjQUFjO0FBQ2xELDJCQUEyQixtRkFBbUYsU0FBUyxnREFBZ0QsdUJBQXVCLGVBQWUsZ0hBQWdILGlCQUFpQixjQUFjO0FBQzVWO0FBQ0E7QUFDQSxVQUFVLGFBQWEsNkNBQTZDLFlBQVksZ0RBQWdELGdCQUFnQixjQUFjO0FBQzlKO0FBQ0Esb0RBQW9ELHNCQUFzQixzREFBc0QsNkNBQTZDLGlDQUFpQyxJQUFJO0FBQ2xOLFdBQVcsS0FBSywyQkFBMkIsMEJBQTBCLDBDQUEwQyxrQkFBa0I7QUFDakksMkNBQTJDLGNBQWM7QUFDekQsMkJBQTJCLDBJQUEwSSxvQ0FBb0MscUJBQXFCLHFDQUFxQyxTQUFTLDJDQUEyQywyQkFBMkIsZUFBZSxnQkFBZ0IsZUFBZSxzQkFBc0IscUVBQXFFO0FBQzNkLHdCQUF3Qix1Q0FBdUMsc0NBQXNDLHlDQUF5QyxXQUFXLG1IQUFtSCwyQkFBMkIsTUFBTSxnQkFBZ0IsZ0NBQWdDLDBCQUEwQixTQUFTLFNBQVMsbUNBQW1DLDRCQUE0Qiw2Q0FBNkM7QUFDcmYscUVBQXFFO0FBQ3JFO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkNBQTJDLG1GQUFtRix5SEFBeUgsMkZBQTJGLFNBQVMsbUdBQW1HO0FBQzliLHdEQUF3RCxPQUFPLDBHQUEwRywrQkFBK0IsU0FBUyxtQkFBbUIsSUFBSSxXQUFXLElBQUk7QUFDdlAsd05BQXdOLHVCQUF1QiwwQ0FBMEMseUNBQXlDLEtBQUs7QUFDdlU7QUFDQSxtQkFBbUIsMkNBQTJDLDBCQUEwQjtBQUN4RjtBQUNBO0FBQ0EsbUJBQW1CLEtBQUssNkNBQTZDLG1CQUFtQix5REFBeUQ7QUFDako7QUFDQSxzRkFBc0YsMENBQTBDLHNCQUFzQixJQUFJO0FBQzFKLHdCQUF3QixrQ0FBa0MsMEZBQTBGLDZRQUE2UTtBQUNqYSxnREFBZ0QsY0FBYztBQUM5RCwyQkFBMkIsMkNBQTJDLFNBQVMsd0JBQXdCO0FBQ3ZHLHFDQUFxQyxjQUFjO0FBQ25EO0FBQ0E7QUFDQTtBQUNBLDRCQUE0QixvQ0FBb0Msd0VBQXdFLGtCQUFrQiw4R0FBOEcsNkRBQTZELHFDQUFxQyxlQUFlLGdEQUFnRCxxQ0FBcUMsMkJBQTJCLHNCQUFzQixpQkFBaUIsMEJBQTBCLHVCQUF1QiwwQkFBMEIsK0NBQStDLCtCQUErQiw4Q0FBOEMsK0JBQStCLHNEQUFzRCwySUFBMkksNklBQTZJLGVBQWUsV0FBVyxPQUFPLDBCQUEwQix1Q0FBdUMsUUFBUSxJQUFJLHlCQUF5QixrRUFBa0UsUUFBUSxLQUFLLFNBQVMsc0JBQXNCLDhCQUE4Qix1R0FBdUcsd0JBQXdCLHdCQUF3QiwyREFBMkQsMERBQTBELG9FQUFvRSxpQkFBaUIsOFJBQThSLHlCQUF5QixpREFBaUQsS0FBSyxLQUFLLHFCQUFxQjtBQUMvakU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU8sb0JBQW9CLFlBQVk7QUFDdkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU0sbUJBQW1CLHVCQUF1QixxQkFBcUIsdURBQXVELCtDQUErQyxlQUFlLFNBQVMsNkJBQTZCLHNCQUFzQiw0TEFBNEwsNEJBQTRCLE9BQU8sMEJBQTBCLHNCQUFzQixVQUFVLGVBQWUsb0ZBQW9GLDBCQUEwQixxQkFBcUIsZ0VBQWdFLHVCQUF1QixhQUFhLFNBQVMsbUNBQW1DLHNDQUFzQyx3Q0FBd0MsMkJBQTJCLFlBQVksSUFBSSxxQ0FBcUMsYUFBYSw4QkFBOEIsNEVBQTRFLDJCQUEyQixtREFBbUQsS0FBSyxpQ0FBaUMsaUJBQWlCLHFIQUFxSCxvSEFBb0g7QUFDcDdDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCLHFDQUFxQyx1Q0FBdUM7QUFDakcsd0VBQXdFLHVDQUF1QztBQUMvRztBQUNBO0FBQ0E7QUFDQTtBQUNBLDhEQUE4RCx1Q0FBdUM7QUFDckc7QUFDQTtBQUNBLGVBQWUsK0JBQStCLGlCQUFpQixtQ0FBbUMscURBQXFELGdEQUFnRDtBQUN2TSx3Q0FBd0MsZ0JBQWdCO0FBQ3hELDJCQUEyQix3U0FBd1MsK0RBQStELHVDQUF1QyxxRkFBcUYsb0ZBQW9GLHlCQUF5Qiw0Q0FBNEMsTUFBTSxLQUFLLG9EQUFvRCx5TEFBeUwsc0JBQXNCLHFEQUFxRCxpQkFBaUIsS0FBSyxJQUFJLHVCQUF1QjtBQUMzZ0Msa0JBQWtCO0FBQ2xCO0FBQ0EsT0FBTyxxQkFBcUIsc0NBQXNDLCtCQUErQixnQ0FBZ0Msa0JBQWtCLGtIQUFrSCxLQUFLLEtBQUsscUJBQXFCLHNDQUFzQyx3Q0FBd0MsaUNBQWlDLGtCQUFrQix5RkFBeUYsZ0JBQWdCLDRFQUE0RSxLQUFLLEtBQUssaUNBQWlDLG1DQUFtQyw0RUFBNEUsa0JBQWtCO0FBQ3R3QjtBQUNBLG1GQUFtRixPQUFPLHlCQUF5QixvQ0FBb0M7QUFDdko7QUFDQTtBQUNBLDBEQUEwRCxLQUFLLHFCQUFxQix1RUFBdUUsa0JBQWtCLFNBQVMsOEJBQThCLDZCQUE2QixPQUFPO0FBQ3hQO0FBQ0EsMEJBQTBCO0FBQzFCLDRGQUE0RiwwSUFBMEksYUFBYTtBQUNuUDtBQUNBO0FBQ0EsZUFBZSw0QkFBNEIsT0FBTztBQUNsRDtBQUNBO0FBQ0E7QUFDQSxlQUFlLDZCQUE2QixnQ0FBZ0MseUNBQXlDO0FBQ3JIO0FBQ0E7QUFDQTtBQUNBLCtEQUErRCxvREFBb0Qsa0JBQWtCLGdEQUFnRDtBQUNyTDtBQUNBLDBDQUEwQztBQUMxQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0VBQW9FLGFBQWEseUJBQXlCLDBDQUEwQztBQUNwSjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdFQUFnRSw4QkFBOEIsdUJBQXVCLDZGQUE2Rix5QkFBeUIsMERBQTBEO0FBQ3JTO0FBQ0E7QUFDQSx1QkFBdUIsa0JBQWtCLHlDQUF5QztBQUNsRixlQUFlLHlCQUF5QiwyQ0FBMkMsS0FBSyxPQUFPLHNDQUFzQywrQ0FBK0M7QUFDcEwsbUNBQW1DLGNBQWM7QUFDakQsMkJBQTJCLHVFQUF1RSxpQkFBaUIsK0pBQStKLG9CQUFvQixhQUFhLFNBQVMsa0RBQWtELGtCQUFrQixtQkFBbUIsb0JBQW9CO0FBQ3ZhO0FBQ0E7QUFDQSx5SkFBeUosNEVBQTRFO0FBQ3JPO0FBQ0E7QUFDQSxpQkFBaUIsZ0NBQWdDLG1CQUFtQixzQ0FBc0MsOEJBQThCO0FBQ3hJLHVDQUF1QyxjQUFjO0FBQ3JELDJCQUEyQix1TUFBdU0sVUFBVSxnQkFBZ0IsbUNBQW1DLFVBQVUsaUxBQWlMLHFGQUFxRix1Q0FBdUMsS0FBSyxNQUFNLHNCQUFzQix3QkFBd0IsV0FBVyxLQUFLLHFCQUFxQjtBQUNwckIsNENBQTRDLDBCQUEwQixVQUFVLG1DQUFtQztBQUNuSCxvRUFBb0UsTUFBTTtBQUMxRTtBQUNBO0FBQ0Esa0dBQWtHLG9CQUFvQix1SkFBdUoseUZBQXlGLHdCQUF3QiwwQ0FBMEMsd0JBQXdCLGdEQUFnRCxvQkFBb0IsYUFBYSxTQUFTLHVFQUF1RSx3QkFBd0IsTUFBTSxLQUFLLG1DQUFtQyxrQkFBa0IsbUJBQW1CLG9CQUFvQjtBQUNodUIsb0ZBQW9GLDBDQUEwQyxxR0FBcUcsZUFBZSxJQUFJO0FBQ3RQLDhEQUE4RCx3QkFBd0IsNERBQTRELG9CQUFvQixrQ0FBa0MsTUFBTSxVQUFVLEtBQUssc0RBQXNELHlCQUF5QiwyREFBMkQsV0FBVyx3REFBd0Qsd0JBQXdCLGdEQUFnRCxJQUFJLG1EQUFtRCwwRkFBMEYsbUdBQW1HLGNBQWMsK0NBQStDLE1BQU07QUFDenlCLHNCQUFzQjtBQUN0QiwrQ0FBK0MsY0FBYztBQUM3RCw0QkFBNEIsb0NBQW9DLDhJQUE4SSwrRkFBK0Ysb0JBQW9CLDhEQUE4RCxxQkFBcUIscUlBQXFJLHFCQUFxQiw0RUFBNEUscUJBQXFCLDJDQUEyQyxpQ0FBaUMsZ0JBQWdCLGlRQUFpUSx5Q0FBeUMsd0NBQXdDLDRDQUE0QyxJQUFJLDJDQUEyQyxjQUFjLHdEQUF3RCxjQUFjLHdJQUF3SSw4QkFBOEIsMkVBQTJFLDhCQUE4QixxQ0FBcUMsNkZBQTZGLG9CQUFvQix5QkFBeUIsZ0JBQWdCLGtFQUFrRSx3Q0FBd0MsSUFBSSxxQkFBcUIsc0JBQXNCLGVBQWUsZ0RBQWdELHNCQUFzQiw2Q0FBNkMsaUJBQWlCO0FBQ3QrRCwyQ0FBMkMsb0JBQW9CLHVCQUF1QixvRUFBb0UsY0FBYyxnQkFBZ0IsNkZBQTZGLGlDQUFpQyx5QkFBeUI7QUFDL1U7QUFDQSxnQ0FBZ0Msb0JBQW9CO0FBQ3BEO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQixJQUFJLFNBQVMsY0FBYztBQUM1QztBQUNBLHlCQUF5QixPQUFPLHlIQUF5SDtBQUN6SjtBQUNBO0FBQ0EsK0dBQStHLDBCQUEwQixxQkFBcUIsdUNBQXVDLHFGQUFxRix1Q0FBdUMsc0RBQXNELHFCQUFxQiwyQkFBMkIscUNBQXFDLHlHQUF5RyxxQkFBcUIsZ0JBQWdCLFNBQVMsaUNBQWlDLHlEQUF5RCxpUUFBaVEsZ0dBQWdHLHdCQUF3QixXQUFXLHNDQUFzQyxzQkFBc0IsNE9BQTRPLGtDQUFrQyxLQUFLLDZEQUE2RCwwR0FBMEcsOENBQThDLHFEQUFxRDtBQUMxcEQ7QUFDQTtBQUNBLDBCQUEwQixnQkFBZ0IsaU1BQWlNLG1DQUFtQyxPQUFPO0FBQ3JSO0FBQ0EsMkNBQTJDLGtEQUFrRCwyQkFBMkIscURBQXFEO0FBQzdLLGVBQWUsb0NBQW9DLE9BQU8sTUFBTSx5QkFBeUIsdUpBQXVKLHVDQUF1Qyx5QkFBeUIscUtBQXFLO0FBQ3JkLHNDQUFzQyxnQkFBZ0I7QUFDdEQsNEJBQTRCLG9DQUFvQyx3YkFBd2IsaURBQWlELGFBQWEsWUFBWSxtQkFBbUIsK0NBQStDLHNDQUFzQyxvRUFBb0Usa0JBQWtCLCtFQUErRSwwQkFBMEIsbUJBQW1CLEtBQUssa0ZBQWtGLDBCQUEwQixzQkFBc0IsS0FBSyxLQUFLLDRDQUE0QyxLQUFLLHdDQUF3QyxXQUFXLG1CQUFtQjtBQUNwb0M7QUFDQTtBQUNBO0FBQ0Esb0hBQW9ILDBEQUEwRDtBQUM5SyxlQUFlLHdDQUF3QyxlQUFlLG1CQUFtQix1QkFBdUI7QUFDaEg7QUFDQSxpRkFBaUY7QUFDakY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWUsd0NBQXdDLGFBQWEsbUJBQW1CLHNDQUFzQyx3Q0FBd0MsY0FBYyxtQkFBbUIsdUJBQXVCO0FBQzdOLDBCQUEwQjtBQUMxQiwwRUFBMEUsSUFBSSwwQkFBMEI7QUFDeEcsZUFBZSx3Q0FBd0MseUJBQXlCLG1CQUFtQiw0QkFBNEIsU0FBUyxxR0FBcUcseUJBQXlCLHdCQUF3Qix3Q0FBd0MsZUFBZSxtQkFBbUIsNkJBQTZCLDBCQUEwQixLQUFLLHdDQUF3QyxrQkFBa0IsOENBQThDLG9CQUFvQiw4Q0FBOEMsd0JBQXdCLDhDQUE4QywwQkFBMEIsbUJBQW1CLDZCQUE2QixpREFBaUQsS0FBSyx3Q0FBd0Msb0JBQW9CLG1CQUFtQiw2QkFBNkIsMkNBQTJDLEtBQUssd0NBQXdDLGVBQWUsa0JBQWtCLGNBQWMsSUFBSSx3Q0FBd0MsdUJBQXVCLHNCQUFzQiw0RUFBNEUsaUJBQWlCLHlMQUF5TCwwQkFBMEIsZ0NBQWdDLGdDQUFnQyxpQkFBaUIsZ0NBQWdDLGtCQUFrQixnQ0FBZ0MscUJBQXFCLGdDQUFnQyxzQkFBc0IsZ0NBQWdDLCtCQUErQixnQ0FBZ0MsU0FBUyxtQkFBbUIsc0NBQXNDLDBCQUEwQix1QkFBdUIseUJBQXlCLDJCQUEyQiwwQkFBMEIseUJBQXlCLG1CQUFtQix1QkFBdUIsd0NBQXdDLG9CQUFvQixtQkFBbUIsNkNBQTZDLDBDQUEwQyxRQUFRLHlDQUF5QztBQUN4ckUscUVBQXFFLHlCQUF5Qiw0QkFBNEI7QUFDMUgsK0JBQStCLDZFQUE2RSw0TEFBNEw7QUFDeFM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNLHlDQUF5QyxpQ0FBaUMsZ0dBQWdHLGlFQUFpRSx5R0FBeUcsME5BQTBOLFVBQVUsWUFBWSxjQUFjLDBCQUEwQiw2QkFBNkIsa0NBQWtDLEtBQUssZ0VBQWdFLGdDQUFnQyxxQkFBcUIsMEJBQTBCLDBDQUEwQyxtQkFBbUIsME5BQTBOLHlCQUF5QixXQUFXLG9CQUFvQixTQUFTLG9CQUFvQiw2REFBNkQsb0JBQW9CLHlCQUF5QixxQkFBcUIsYUFBYSx1RUFBdUUsd0dBQXdHLHNFQUFzRSxpQkFBaUIsVUFBVSwyQkFBMkIsa0dBQWtHLG9DQUFvQywwQkFBMEIsSUFBSSxJQUFJLFVBQVUsSUFBSSxnRkFBZ0YsbUZBQW1GO0FBQ2o4RDtBQUNBLCtCQUErQixVQUFVLG9FQUFvRTtBQUM3RztBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsY0FBYywwQkFBMEIsS0FBSywyQkFBMkIsYUFBYSx1QkFBdUIsSUFBSSxxQkFBcUIsTUFBTSxnSUFBZ0k7QUFDdlM7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCO0FBQ2xCO0FBQ0EsTUFBTSw0R0FBNEcsa0NBQWtDLGtMQUFrTDtBQUN0VSxjQUFjO0FBQ2Q7QUFDQSxnQ0FBZ0MsWUFBWTtBQUM1QyxjQUFjLGdEQUFnRDtBQUM5RCxNQUFNLDJCQUEyQixpQ0FBaUMsdUJBQXVCLE1BQU0sMkVBQTJFLDBCQUEwQiw0Q0FBNEMsVUFBVSwyRkFBMkYscUJBQXFCLGlCQUFpQixLQUFLLEtBQUsscUJBQXFCLHNDQUFzQyxrQkFBa0IsMEJBQTBCLCtHQUErRyxxQkFBcUIsNkVBQTZFLGdIQUFnSCxxQkFBcUIsVUFBVSx1Q0FBdUMsSUFBSSxrRUFBa0UsMEJBQTBCLGlFQUFpRSxRQUFRLHFCQUFxQiwySEFBMkgsMkJBQTJCLE1BQU0seUJBQXlCLE9BQU8sTUFBTSw2SUFBNkksZ0JBQWdCLDBCQUEwQixTQUFTLGtFQUFrRSxnQ0FBZ0Msd0JBQXdCLHdDQUF3Qyw2Q0FBNkMsZ0NBQWdDLGdDQUFnQyxrRUFBa0UsUUFBUSxzQkFBc0IsOEZBQThGLHlCQUF5QixpQkFBaUIsa0VBQWtFLGlDQUFpQyxrQ0FBa0MsZUFBZSxhQUFhLG9CQUFvQixzQkFBc0IsdUVBQXVFO0FBQzVyRTtBQUNBLCtCQUErQix3SEFBd0g7QUFDdko7QUFDQTtBQUNBLCtCQUErQix3REFBd0Q7QUFDdkY7QUFDQTtBQUNBLDhDQUE4QyxhQUFhO0FBQzNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVEsd0JBQXdCLDRHQUE0RyxvQkFBb0IsaUNBQWlDLG1CQUFtQiw0Q0FBNEMsY0FBYztBQUM5UTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTSwwQkFBMEIsSUFBSSwwQ0FBMEMsZUFBZSxZQUFZLG9CQUFvQixpQ0FBaUMsdUNBQXVDLGNBQWM7QUFDbk47QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU0sU0FBUyxJQUFJLDJDQUEyQyxlQUFlLFlBQVksd0JBQXdCLE9BQU8sb1BBQW9QLHNCQUFzQjtBQUNsWSx1QkFBdUIsU0FBUyxxQkFBcUI7QUFDckQ7QUFDQTtBQUNBLDRFQUE0RSxvREFBb0Q7QUFDaEk7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTSwrQ0FBK0MseUJBQXlCO0FBQzlFO0FBQ0Esa1hBQWtYLHNDQUFzQyxvQkFBb0Isb0NBQW9DLHdKQUF3SixJQUFJLG9CQUFvQixZQUFZLG9CQUFvQix1QkFBdUIsb0JBQW9CLGVBQWU7QUFDMXRCLHNCQUFzQjtBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdKQUFnSiwrQkFBK0I7QUFDL0ssaURBQWlELHVDQUF1QyxjQUFjO0FBQ3RHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWUsd0JBQXdCLHFCQUFxQjtBQUM1RDtBQUNBO0FBQ0E7QUFDQSwwSUFBMEksb0RBQW9EO0FBQzlMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsY0FBYztBQUMxQztBQUNBLHlFQUF5RSxxQkFBcUI7QUFDOUY7QUFDQTtBQUNBO0FBQ0EsU0FBUyxpQkFBaUIsZ0RBQWdELGlCQUFpQjtBQUMzRix5Q0FBeUMsWUFBWSxJQUFJO0FBQ3pEO0FBQ0E7QUFDQTtBQUNBLFFBQVEsb0JBQW9CLDZDQUE2QywyRUFBMkUsaUJBQWlCLDZCQUE2Qiw2QkFBNkIsTUFBTSxvQkFBb0IscUVBQXFFLGNBQWMsTUFBTSxpQkFBaUIsNkJBQTZCLHFDQUFxQyxNQUFNLGdCQUFnQix5Q0FBeUMsa0JBQWtCLGdHQUFnRyxZQUFZLG9CQUFvQix1QkFBdUIsa01BQWtNLE9BQU87QUFDdDFCLHFCQUFxQixpQkFBaUIsU0FBUyw4TkFBOE4sNkJBQTZCLDJCQUEyQiwwVUFBMFUsdUJBQXVCLG9IQUFvSCwwSkFBMEo7QUFDcDdCLHNDQUFzQyxxQkFBcUI7QUFDM0Q7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQSxNQUFNLHVSQUF1UixnQkFBZ0IsMEJBQTBCLFNBQVMsd0NBQXdDO0FBQ3hYO0FBQ0E7QUFDQTtBQUNBLGtFQUFrRSxJQUFJO0FBQ3RFO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0NBQStDLHVCQUF1QjtBQUN0RSxXQUFXLHFEQUFxRCxXQUFXLHNDQUFzQywySkFBMkosbUJBQW1CO0FBQy9SLDBDQUEwQyxnQkFBZ0I7QUFDMUQsMkJBQTJCLGtGQUFrRixvQkFBb0IsMEJBQTBCLG9HQUFvRyx5REFBeUQsK0JBQStCLG1CQUFtQjtBQUMxVztBQUNBLDZEQUE2RCxPQUFPO0FBQ3BFO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUNBQXVDLDZCQUE2QixtQkFBbUI7QUFDdkYsNkRBQTZELE9BQU87QUFDcEUsMENBQTBDO0FBQzFDO0FBQ0EsYUFBYSw0QkFBNEIsMkRBQTJELGdEQUFnRCx1Q0FBdUMseUNBQXlDLHVCQUF1Qix5QkFBeUIsZ0JBQWdCLG9CQUFvQiwyRUFBMkUsdUJBQXVCLHNGQUFzRixJQUFJO0FBQ3BmLFVBQVUsNEJBQTRCLElBQUksZUFBZSxhQUFhLDBDQUEwQyw4QkFBOEIsa0ZBQWtGLG1CQUFtQixzQ0FBc0Msb0JBQW9CLGdDQUFnQyw0RkFBNEY7QUFDemEscUJBQXFCLFFBQVEsdUpBQXVKLDZSQUE2UixnQkFBZ0IsMkRBQTJELE9BQU8sNkZBQTZGLFdBQVcsVUFBVSxnQkFBZ0IsMERBQTBELE9BQU8sMEZBQTBGLFdBQVcsVUFBVSxnQkFBZ0IsMERBQTBELE9BQU8sb0VBQW9FLFdBQVcsVUFBVSxnQkFBZ0IsNERBQTRELGNBQWMsd0VBQXdFLFdBQVcsVUFBVSxtQkFBbUIsbUNBQW1DLFNBQVMsbURBQW1ELHFCQUFxQixpQ0FBaUMsV0FBVyw2QkFBNkIsVUFBVSw0QkFBNEIsb05BQW9OLHVFQUF1RSxxQ0FBcUMsNkJBQTZCLGVBQWUsaURBQWlEO0FBQ3owRCx5QkFBeUIsZ0JBQWdCLG9CQUFvQiwwQkFBMEIsdUJBQXVCLGdCQUFnQix3QkFBd0IsZ0JBQWdCLDJCQUEyQixzQkFBc0IseUNBQXlDO0FBQ2hRLHlDQUF5QyxjQUFjO0FBQ3ZELDJCQUEyQixvSUFBb0ksS0FBSyx5QkFBeUIsa0RBQWtELHVEQUF1RCxJQUFJLG9CQUFvQjtBQUM5VDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVyw4QkFBOEIsd0RBQXdELGdEQUFnRCxxQkFBcUIsdUJBQXVCO0FBQzdMLGdCQUFnQixtR0FBbUcsOEJBQThCLG9CQUFvQixzREFBc0QsbUJBQW1CLGFBQWEsb0JBQW9CLDBCQUEwQixNQUFNLFdBQVcsb0JBQW9CLCtCQUErQixzQkFBc0IsS0FBSyxvQkFBb0IsK0JBQStCLHVCQUF1QixPQUFPLFNBQVMsd0ZBQXdGLHVCQUF1QixjQUFjO0FBQy9sQjtBQUNBO0FBQ0EsVUFBVSw2QkFBNkIsdUNBQXVDLHFCQUFxQjtBQUNuRztBQUNBO0FBQ0EsVUFBVSw2QkFBNkIsbUNBQW1DLGNBQWMsMERBQTBELHVDQUF1QyxjQUFjLGlDQUFpQyxjQUFjLGdDQUFnQyx5QkFBeUIsa0NBQWtDLHlCQUF5QixvQ0FBb0MsTUFBTSxlQUFlO0FBQ25hLDJDQUEyQyxjQUFjO0FBQ3pELDJCQUEyQixhQUFhLHVDQUF1QyxnQkFBZ0Isa0NBQWtDO0FBQ2pJLG1CQUFtQixRQUFRO0FBQzNCO0FBQ0EsdURBQXVELCtOQUErTiw0Q0FBNEMsMkRBQTJEO0FBQzdYO0FBQ0E7QUFDQTtBQUNBLE9BQU8sTUFBTSxtQkFBbUIscUNBQXFDLGdCQUFnQix1RUFBdUUsZUFBZSxNQUFNLFlBQVksZ0JBQWdCLGdCQUFnQixjQUFjO0FBQzNPO0FBQ0EsWUFBWSx5QkFBeUI7QUFDckMsUUFBUSxnQkFBZ0IsT0FBTztBQUMvQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0RBQWdELHNDQUFzQztBQUN0RixjQUFjO0FBQ2Q7QUFDQSxzQ0FBc0Msc0NBQXNDO0FBQzVFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU0sWUFBWSxnQkFBZ0Isb0NBQW9DLDZCQUE2Qix1RUFBdUUsZ0JBQWdCLG1CQUFtQjtBQUM3TTtBQUNBO0FBQ0EsUUFBUSxnQkFBZ0I7QUFDeEIsZ0RBQWdEO0FBQ2hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUSxnQkFBZ0IsNEVBQTRFLGNBQWMsaUZBQWlGLFFBQVEseUJBQXlCLG9DQUFvQywwR0FBMEcsZ0JBQWdCLE9BQU87QUFDelk7QUFDQTtBQUNBLFVBQVUsV0FBVyxrQkFBa0I7QUFDdkMsdURBQXVELGNBQWM7QUFDckUsMkJBQTJCLGtQQUFrUCxxQ0FBcUMsTUFBTSxnREFBZ0QsTUFBTSx5REFBeUQsMEJBQTBCLG9FQUFvRSwrREFBK0Qsa0RBQWtELFlBQVksMkRBQTJELG1DQUFtQyxJQUFJLHFEQUFxRCxvQkFBb0IsMERBQTBELFVBQVUsZ0JBQWdCLDhEQUE4RCxVQUFVLHVDQUF1QyxvREFBb0QsTUFBTTtBQUMxaUM7QUFDQTtBQUNBO0FBQ0EsdUNBQXVDLGdCQUFnQjtBQUN2RCxNQUFNLDJFQUEyRSxzQkFBc0IsaUZBQWlGLHFCQUFxQjtBQUM3TSw4REFBOEQsZ0JBQWdCLEdBQUcsa0NBQWtDLEtBQUsseUNBQXlDLGFBQWEsd0JBQXdCLHFCQUFxQjtBQUMzTiw4Q0FBOEMsZ0JBQWdCLGtFQUFrRSxVQUFVLGtCQUFrQiwwQkFBMEIsS0FBSyxjQUFjLElBQUksc0JBQXNCLDZDQUE2QyxtREFBbUQsb0JBQW9CLElBQUkscUJBQXFCLGdIQUFnSCx3QkFBd0IseUNBQXlDLCtDQUErQyxHQUFHLHdDQUF3QywySUFBMkksa0RBQWtELHFCQUFxQixnR0FBZ0cscUJBQXFCLGFBQWEsb0JBQW9CLDJCQUEyQixNQUFNLEtBQUssb0JBQW9CLDJCQUEyQixpQ0FBaUMsa0JBQWtCLHVCQUF1QixtQ0FBbUMsV0FBVyxxQkFBcUIsbUNBQW1DLGdCQUFnQiwwQ0FBMEMsS0FBSyxLQUFLLHlCQUF5QjtBQUNyMEMsOENBQThDLGdCQUFnQixxREFBcUQsS0FBSyxLQUFLLHdCQUF3QixvQkFBb0Isb0JBQW9CLDJFQUEyRSxPQUFPO0FBQy9RO0FBQ0Esd0JBQXdCLG9CQUFvQiwyRUFBMkUsT0FBTztBQUM5SDtBQUNBLDBCQUEwQixTQUFTLHFCQUFxQjtBQUN4RCx3Q0FBd0MsY0FBYztBQUN0RCwyQkFBMkIsNkZBQTZGLDJDQUEyQyxRQUFRLDBHQUEwRyxtRkFBbUYsc0NBQXNDLHFFQUFxRSxTQUFTLEtBQUssMERBQTBELG9GQUFvRixzREFBc0QsS0FBSywyRUFBMkUseUJBQXlCLElBQUksc0JBQXNCLGlDQUFpQyxvR0FBb0csZ05BQWdOLE1BQU0sb0dBQW9HLGdFQUFnRSx5QkFBeUIsOEJBQThCLFlBQVksOERBQThELFdBQVcsd0JBQXdCLHNCQUFzQixTQUFTLDZCQUE2QjtBQUN2Z0QsZ0RBQWdELGNBQWM7QUFDOUQsMkJBQTJCLGdHQUFnRyxTQUFTLDhEQUE4RCxzQkFBc0IsNEZBQTRGLG9CQUFvQixNQUFNLDJEQUEyRCxxQ0FBcUMsSUFBSSxpREFBaUQsTUFBTSxnREFBZ0QsTUFBTSx3REFBd0Q7QUFDdmxCO0FBQ0E7QUFDQTtBQUNBLDJDQUEyQywyQkFBMkI7QUFDdEUsV0FBVyw4REFBOEQsT0FBTyw2RkFBNkYsa0RBQWtELHVHQUF1RyxTQUFTLCtVQUErVSxrRUFBa0UsNENBQTRDLFVBQVUsMkJBQTJCLGtMQUFrTCxvREFBb0QseUNBQXlDO0FBQ2hrQywwREFBMEQsbUNBQW1DO0FBQzdGO0FBQ0E7QUFDQSwyQ0FBMkMsMEJBQTBCO0FBQ3JFLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSwyQ0FBMkMscUNBQXFDO0FBQ2hGLFdBQVcsMERBQTBELGVBQWU7QUFDcEY7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXLEtBQUssS0FBSyxtQkFBbUIscURBQXFELFVBQVUscUJBQXFCLGlCQUFpQiw0QkFBNEIsd0xBQXdMO0FBQ2pXLDBEQUEwRCxjQUFjO0FBQ3hFLDJCQUEyQix1TUFBdU0sb0NBQW9DLHFCQUFxQixjQUFjLFlBQVksWUFBWSxzREFBc0QscUJBQXFCLHVEQUF1RCxtQ0FBbUMsS0FBSyxvQkFBb0IsdUNBQXVDLG9CQUFvQixvQ0FBb0MsdUlBQXVJLG9CQUFvQix3REFBd0QsWUFBWSxzRUFBc0UsYUFBYSw2RUFBNkUsa0JBQWtCLGFBQWEsSUFBSSxLQUFLLHFCQUFxQjtBQUMxaEMsa0JBQWtCLCtCQUErQjtBQUNqRDtBQUNBLGtHQUFrRyx5QkFBeUIsYUFBYTtBQUN4SSxPQUFPLG9CQUFvQix5SUFBeUksVUFBVSxtREFBbUQsc0NBQXNDLDhDQUE4QyxpSkFBaUosY0FBYyxvQkFBb0IsYUFBYSw4REFBOEQscUNBQXFDLEtBQUssb0JBQW9CLDBIQUEwSCxxQkFBcUIsMElBQTBJLG9CQUFvQixvQ0FBb0Msa0tBQWtLLFNBQVMsdUVBQXVFLGlOQUFpTjtBQUNyNEMsbUVBQW1FLGNBQWM7QUFDakYsMkJBQTJCLHNIQUFzSCwwREFBMEQsTUFBTSxxRUFBcUUsd0JBQXdCLHlCQUF5QixzQ0FBc0Msd0NBQXdDLDZCQUE2Qix3QkFBd0IsbUNBQW1DLHdCQUF3QixpRkFBaUYsbUJBQW1CLHVDQUF1Qyw2REFBNkQsZ0JBQWdCLElBQUksMENBQTBDLHVEQUF1RCwrRUFBK0UsMEJBQTBCLDZEQUE2RCxvRkFBb0YsMkJBQTJCLE1BQU0seUJBQXlCLHdFQUF3RSxvQkFBb0IsSUFBSSxLQUFLLGtFQUFrRSwyQkFBMkIsd0NBQXdDLHdCQUF3QixnRUFBZ0UsZ0VBQWdFLElBQUksc0JBQXNCO0FBQ2xoRCxrQkFBa0I7QUFDbEI7QUFDQSxzSUFBc0kseUJBQXlCLGFBQWE7QUFDNUssU0FBUyxTQUFTLDZDQUE2QztBQUMvRCxnRUFBZ0UsY0FBYztBQUM5RSwyQkFBMkIsK0VBQStFLHdEQUF3RCxrQkFBa0I7QUFDcEw7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNHQUFzRztBQUN0RyxPQUFPLElBQUksdUJBQXVCO0FBQ2xDO0FBQ0E7QUFDQSxrQkFBa0I7QUFDbEIsZ0VBQWdFLHdEQUF3RCxrRkFBa0YsSUFBSSx5QkFBeUIsd0RBQXdELHNDQUFzQyxJQUFJO0FBQ3pVLFNBQVMsU0FBUyw0QkFBNEI7QUFDOUMsK0NBQStDLGNBQWM7QUFDN0QsMkJBQTJCLHlMQUF5TCxtRUFBbUUscUNBQXFDLHlDQUF5QyxvQkFBb0IsNkVBQTZFLHVCQUF1QiwwQkFBMEIscUJBQXFCLFlBQVk7QUFDeGhCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0NBQStDLG1CQUFtQixpQkFBaUI7QUFDbkY7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4Q0FBOEMsU0FBUyx1Q0FBdUMsYUFBYSx5QkFBeUI7QUFDcEk7QUFDQTtBQUNBLGtDQUFrQyxJQUFJLE9BQU8sc0JBQXNCO0FBQ25FO0FBQ0E7QUFDQTtBQUNBLGtGQUFrRix5QkFBeUIsaUdBQWlHLE9BQU8sWUFBWSx3QkFBd0IsbUNBQW1DLDZDQUE2QyxPQUFPLGlCQUFpQixNQUFNLGlCQUFpQixHQUFHLFVBQVUsdURBQXVELHVNQUF1TTtBQUNqb0I7QUFDQTtBQUNBO0FBQ0EsVUFBVSxZQUFZO0FBQ3RCLHVCQUF1QixrRUFBa0UscUJBQXFCLGdKQUFnSixVQUFVO0FBQ3hRLG1DQUFtQyxjQUFjO0FBQ2pELDJCQUEyQix1REFBdUQsd0VBQXdFLElBQUksd0VBQXdFLElBQUksd0ZBQXdGLG1CQUFtQixnQkFBZ0IsMEJBQTBCLGdCQUFnQixvQkFBb0IsOEJBQThCLHdDQUF3QyxLQUFLO0FBQzllLGdCQUFnQixnQkFBZ0I7QUFDaEMsK0JBQStCLGlCQUFpQixNQUFNLE1BQU0sTUFBTSxlQUFlLGlCQUFpQixlQUFlLGtDQUFrQyxzQ0FBc0MsVUFBVSxPQUFPLGVBQWUscUJBQXFCO0FBQzlPO0FBQ0EscUVBQXFFLHdCQUF3QixzQkFBc0I7QUFDbkgsaUNBQWlDO0FBQ2pDO0FBQ0E7QUFDQSx1QkFBdUIsb0RBQW9ELDRCQUE0Qix5RUFBeUUsb0JBQW9CLGFBQWEscUNBQXFDO0FBQ3RQLE9BQU8sTUFBTSwrQkFBK0I7QUFDNUMsa0RBQWtELGNBQWM7QUFDaEUsMkJBQTJCLDBFQUEwRSxTQUFTLDBDQUEwQyxxREFBcUQseUNBQXlDLGtCQUFrQixPQUFPLEtBQUssd0JBQXdCLDBEQUEwRCxVQUFVO0FBQ2hYLDJDQUEyQyxjQUFjO0FBQ3pELDJCQUEyQiw4SUFBOEksK0JBQStCLFVBQVUsZUFBZSxnQ0FBZ0MseUNBQXlDLEtBQUssZ0JBQWdCLG1GQUFtRix5REFBeUQsU0FBUyxJQUFJLHFCQUFxQixzRUFBc0UsU0FBUyw0Q0FBNEM7QUFDeG1CLHlDQUF5QyxjQUFjO0FBQ3ZELDJCQUEyQix1SEFBdUgsNkNBQTZDLHFCQUFxQixZQUFZLDJEQUEyRCxhQUFhLHdGQUF3RixtQkFBbUIsNEZBQTRGLFdBQVcsTUFBTSxlQUFlLG1DQUFtQyxzQkFBc0IsdUNBQXVDLGdHQUFnRyxpRkFBaUYsNkJBQTZCLElBQUksb0JBQW9CLDRCQUE0QiwwQ0FBMEMsaUxBQWlMLG9CQUFvQixxREFBcUQsTUFBTSx3REFBd0QsdUNBQXVDLDRCQUE0QixLQUFLLEtBQUssb0JBQW9CLDBDQUEwQyxzQkFBc0IsSUFBSSxxQkFBcUIsNEJBQTRCLFdBQVcsdUJBQXVCLGtDQUFrQyxVQUFVLElBQUksd0JBQXdCLGtDQUFrQyxXQUFXLElBQUksT0FBTyxTQUFTLCtDQUErQyxZQUFZO0FBQy9vRCx5Q0FBeUMsY0FBYztBQUN2RCw0QkFBNEIsb0NBQW9DLGtOQUFrTjtBQUNsUjtBQUNBLGtCQUFrQjtBQUNsQjtBQUNBLFNBQVMsdUJBQXVCLGtCQUFrQiw4Q0FBOEMsT0FBTyxPQUFPLGdCQUFnQixVQUFVO0FBQ3hJLFlBQVksZ0ZBQWdGO0FBQzVGO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSwrTUFBK007QUFDM04sTUFBTSxhQUFhLHNCQUFzQiwyQkFBMkIsY0FBYyxXQUFXLG9CQUFvQixpQ0FBaUMsaUJBQWlCLElBQUk7QUFDdkssc0NBQXNDLG1CQUFtQixVQUFVO0FBQ25FLDhGQUE4RixxQkFBcUI7QUFDbkgsT0FBTyx3QkFBd0IsOEJBQThCLG1DQUFtQywyQkFBMkIsNkJBQTZCLHFCQUFxQiw2REFBNkQsb0JBQW9CLGtHQUFrRyx3QkFBd0IsOENBQThDLHVCQUF1Qix3QkFBd0IseURBQXlELFNBQVMsMERBQTBEO0FBQ2psQixzQkFBc0I7QUFDdEI7QUFDQTtBQUNBLHVCQUF1Qiw0QkFBNEI7QUFDbkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Ysb0RBQW9ELGdCQUFnQjtBQUNwRSw0QkFBNEIsb0NBQW9DLGttQkFBa21CLG1DQUFtQyxzSkFBc0osc0VBQXNFLHFHQUFxRyx1RkFBdUY7QUFDN2xDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU0sWUFBWSxJQUFJLCtCQUErQixPQUFPO0FBQzVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTSxXQUFXLG9CQUFvQix5Q0FBeUMsd0JBQXdCLFdBQVcsUUFBUSxZQUFZO0FBQ3JJO0FBQ0E7QUFDQSw4REFBOEQsY0FBYyxvQkFBb0I7QUFDaEc7QUFDQTtBQUNBLE1BQU0sbUVBQW1FLGVBQWUsc0JBQXNCLGNBQWMsbUJBQW1CLHNFQUFzRTtBQUNyTixxQkFBcUIsMkdBQTJHLG9NQUFvTSx1QkFBdUIsVUFBVSxrREFBa0QsZ0NBQWdDLHdCQUF3Qix5R0FBeUcscUJBQXFCLCtKQUErSixxQ0FBcUMsb0JBQW9CO0FBQ3J5QixtQkFBbUI7QUFDbkIsbUJBQW1CLHlCQUF5QjtBQUM1QyxtQkFBbUIsdUhBQXVILDBCQUEwQixvQkFBb0IsYUFBYSwrRUFBK0UsYUFBYSx1RkFBdUYsK0JBQStCLEtBQUssbUJBQW1CLDJCQUEyQix3QkFBd0I7QUFDbGU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU0sNDFCQUE0MUIsNENBQTRDLDhCQUE4QiwwQ0FBMEMsNkJBQTZCLGtDQUFrQyx5QkFBeUIsc0RBQXNELHFsQkFBcWxCLGNBQWMsNGNBQTRjLDhCQUE4Qix3RUFBd0UscUJBQXFCLFVBQVUsYUFBYSw4QkFBOEIsd0VBQXdFLDRIQUE0SCw2RUFBNkUsc0lBQXNJLFVBQVUscUJBQXFCLHVGQUF1RixzQkFBc0IsWUFBWSw4Q0FBOEMsc0ZBQXNGLHFCQUFxQixjQUFjLHFCQUFxQixXQUFXLHNCQUFzQixvQ0FBb0MscUNBQXFDLHFCQUFxQix5QkFBeUIscUJBQXFCLHdFQUF3RSxzQkFBc0IsaUVBQWlFLFlBQVksc0JBQXNCLHNCQUFzQixxQkFBcUIsd0RBQXdELCtCQUErQiw0RkFBNEYseUNBQXlDLDhFQUE4RSxxQ0FBcUMsOENBQThDLEtBQUssb0VBQW9FLHFCQUFxQix3Q0FBd0Msc0JBQXNCO0FBQ2grSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXLHFCQUFxQixzQkFBc0IscUJBQXFCLFNBQVMscUJBQXFCLFNBQVMscUJBQXFCLDRGQUE0RixxQkFBcUIsd0JBQXdCLHNCQUFzQiw4QkFBOEIseUJBQXlCO0FBQzdWO0FBQ0E7QUFDQSx3QkFBd0I7QUFDeEI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXLDZCQUE2QixxQkFBcUIsa0NBQWtDLDRCQUE0QixnQkFBZ0IsSUFBSSxxQkFBcUIsNkNBQTZDLDJEQUEyRCxtRUFBbUU7QUFDL1UsbUJBQW1CLGlDQUFpQyxNQUFNLDBCQUEwQix1QkFBdUIsSUFBSSw4QkFBOEIsdURBQXVELGdGQUFnRixLQUFLLFdBQVcsZ0JBQWdCLHdDQUF3Qyw4QkFBOEIsZ0RBQWdELHFCQUFxQixzREFBc0QsaUJBQWlCLHNCQUFzQixrQkFBa0Isb0NBQW9DO0FBQ2xsQixtQkFBbUIsdUJBQXVCLGNBQWM7QUFDeEQ7QUFDQTtBQUNBO0FBQ0EsTUFBTSxZQUFZLDhCQUE4QixnQkFBZ0IsMkdBQTJHLG9EQUFvRCxnQkFBZ0IsNElBQTRJLE1BQU0sU0FBUyx3SUFBd0ksa0JBQWtCLDJKQUEySixXQUFXLHFFQUFxRSxlQUFlLGdDQUFnQyxrQkFBa0Isc0JBQXNCLHNCQUFzQjtBQUM1M0I7QUFDQSwwQ0FBMEMseURBQXlELHVCQUF1QixRQUFRLHFGQUFxRiw0REFBNEQsdVVBQXVVLDhLQUE4SyxvRUFBb0UsNkNBQTZDLEtBQUs7QUFDOTNCO0FBQ0EscUhBQXFILGNBQWMsMENBQTBDLGNBQWM7QUFDM0w7QUFDQTtBQUNBLDJFQUEyRSw2Q0FBNkMsT0FBTyx5SUFBeUksMERBQTBELHNCQUFzQixhQUFhLHNCQUFzQixJQUFJLDRHQUE0Ryw4Q0FBOEMsV0FBVyxpQkFBaUIsMkhBQTJILFdBQVcsbUNBQW1DLFdBQVcseUpBQXlKLGFBQWEsaUJBQWlCO0FBQ2g2QixvQ0FBb0MsZ0JBQWdCO0FBQ3BELGVBQWU7QUFDZixxS0FBcUssY0FBYztBQUNuTCwyQkFBMkIsNEJBQTRCLGt1QkFBa3VCLDZDQUE2QyxtREFBbUQsOEZBQThGLGtZQUFrWSwwQ0FBMEMsY0FBYztBQUNqNUM7QUFDQSxxRkFBcUYsNkxBQTZMO0FBQ2xSLG9FQUFvRSxvQkFBb0I7QUFDeEY7QUFDQTtBQUNBLHFEQUFxRCwwQkFBMEI7QUFDL0U7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU8sdURBQXVELHNCQUFzQiwrQ0FBK0MsNEJBQTRCLFlBQVksdUNBQXVDO0FBQ2xOLHdCQUF3Qix5Q0FBeUM7QUFDakUsZ0RBQWdELHFDQUFxQyxLQUFLLG1DQUFtQyxpQ0FBaUMsc0JBQXNCO0FBQ3BMLDZCQUE2QixZQUFZLGNBQWM7QUFDdkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0JBQStCLG9DQUFvQywrTUFBK00sb0NBQW9DO0FBQ3RUO0FBQ0EsMkNBQTJDLDRCQUE0QjtBQUN2RSxNQUFNO0FBQ047QUFDQTtBQUNBLE1BQU0scUNBQXFDLHlEQUF5RCxrSEFBa0gsMEJBQTBCO0FBQ2hQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Ysd0JBQXdCLHdCQUF3QjtBQUNoRDtBQUNBO0FBQ0EsT0FBTyw2Q0FBNkMsc0NBQXNDLDBDQUEwQyxpS0FBaUssS0FBSyxzQ0FBc0MsZUFBZSw2REFBNkQsNENBQTRDLHFDQUFxQyxrRUFBa0UsNkRBQTZELHdFQUF3RSw2Q0FBNkMsOERBQThELDRDQUE0Qyx5QkFBeUIsMERBQTBELGNBQWMsZ0NBQWdDLHNDQUFzQyxtQkFBbUI7QUFDcmdDO0FBQ0EsOEJBQThCO0FBQzlCO0FBQ0E7QUFDQSxnREFBZ0QsY0FBYztBQUM5RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CO0FBQ25CO0FBQ0E7QUFDQTtBQUNBLHVEQUF1RCxNQUFNLHVDQUF1QyxtREFBbUQsK0NBQStDLHVEQUF1RCw2Q0FBNkMsc0JBQXNCLHFEQUFxRCw4QkFBOEIsZ0RBQWdELHlCQUF5Qix1REFBdUQsZ0NBQWdDLHFEQUFxRCw4QkFBOEIsa0RBQWtELDJCQUEyQiwrQ0FBK0Msd0JBQXdCLDJDQUEyQyxvQkFBb0IscURBQXFELDhCQUE4Qiw4Q0FBOEMsdUJBQXVCLDJDQUEyQyxvQkFBb0IsNkNBQTZDLHNCQUFzQix3REFBd0QsaUNBQWlDLCtDQUErQyx3QkFBd0IsMkRBQTJELG9DQUFvQyw4REFBOEQsdUNBQXVDLDRDQUE0QyxxQkFBcUIsNkNBQTZDLHNCQUFzQix3Q0FBd0MsaUJBQWlCLDBDQUEwQyxtQkFBbUIsNkRBQTZELHNDQUFzQyw4Q0FBOEMsdUJBQXVCLDZDQUE2QywwQkFBMEIsc0RBQXNELCtCQUErQix1REFBdUQsZ0NBQWdDLHVEQUF1RCxnQ0FBZ0MseURBQXlELGtDQUFrQyw2Q0FBNkMsc0JBQXNCLHlDQUF5QyxrQkFBa0IseURBQXlELGtDQUFrQywwQ0FBMEMsbUJBQW1CLHlEQUF5RCxrQ0FBa0MsaURBQWlELDBCQUEwQixnREFBZ0QseUJBQXlCLGlEQUFpRCwwQkFBMEIsdUNBQXVDLHNCQUFzQixnREFBZ0QsNkhBQTZILDJDQUEyQyxvQkFBb0IsaURBQWlELCtCQUErQix1REFBdUQsd0NBQXdDO0FBQ3QwRyx5RkFBeUYsNkRBQTZELGdGQUFnRixrQ0FBa0MsY0FBYztBQUN0UjtBQUNBO0FBQ0E7QUFDQSxPQUFPLGdEQUFnRCxvREFBb0QscURBQXFEO0FBQ2hLO0FBQ0E7QUFDQSx3QkFBd0IsY0FBYztBQUN0QywrQ0FBK0Msc0dBQXNHLG9EQUFvRCw4QkFBOEIsaUVBQWlFO0FBQ3hTO0FBQ0E7QUFDQSxPQUFPLHFFQUFxRTtBQUM1RTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU8sMENBQTBDLHFDQUFxQyxxQkFBcUIsaUpBQWlKLGNBQWM7QUFDMVE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU0sY0FBYyw0REFBNEQseUJBQXlCLHFDQUFxQyxJQUFJLHNDQUFzQyxVQUFVLGNBQWM7QUFDaE47QUFDQTtBQUNBLE1BQU0sV0FBVyw2Q0FBNkMsNEJBQTRCLGlEQUFpRCxnREFBZ0QseUJBQXlCLHlDQUF5QyxjQUFjLG1LQUFtSyxvQkFBb0IsS0FBSywwQ0FBMEMseUJBQXlCLHNEQUFzRCwrQkFBK0IsNERBQTRELG9EQUFvRDtBQUMvc0IsZ0ZBQWdGLHFDQUFxQywyREFBMkQsd0NBQXdDLDRDQUE0QyxxQkFBcUIsMkNBQTJDLHdCQUF3QixzREFBc0QsK0JBQStCLGtFQUFrRSxtREFBbUQsc0RBQXNELCtCQUErQiw4Q0FBOEMsa1VBQWtVLGdEQUFnRCxvQ0FBb0MsNlBBQTZQLDhDQUE4Qyw2Q0FBNkMsb0RBQW9ELDBCQUEwQiw0QkFBNEIsOFVBQThVLHNEQUFzRCwrQkFBK0IsNHVDQUE0dUMseUNBQXlDLGtJQUFrSSw0Q0FBNEMsaUdBQWlHLFNBQVMsSUFBSSw0Q0FBNEMsMEJBQTBCLDRDQUE0QywwQkFBMEIsOENBQThDLDRCQUE0Qix3Q0FBd0Msc0JBQXNCLDZDQUE2QywyQkFBMkIsc0NBQXNDLHlCQUF5QiwrQ0FBK0Msa0NBQWtDLHFEQUFxRCx3Q0FBd0MsNkNBQTZDLGdDQUFnQyxtREFBbUQsZ0VBQWdFLHdDQUF3QywyQkFBMkIsd0RBQXdELGlDQUFpQyx1REFBdUQsb0NBQW9DLDhCQUE4Qix5R0FBeUc7QUFDNWxKO0FBQ0E7QUFDQSxtQ0FBbUMsUUFBUTtBQUMzQyxvRkFBb0YseURBQXlELG1RQUFtUTtBQUNoWjtBQUNBO0FBQ0EsT0FBTyx1QkFBdUIsSUFBSSx3QkFBd0IsSUFBSSxnQ0FBZ0MsSUFBSSw0QkFBNEIsSUFBSSxrQkFBa0IsSUFBSSxtQkFBbUIsSUFBSSxzQkFBc0IsSUFBSSxxQkFBcUIsSUFBSSwyQkFBMkIsSUFBSSw2QkFBNkIsSUFBSSxrQkFBa0IsSUFBSSxtQkFBbUIsSUFBSSxrQkFBa0IsSUFBSSwwQkFBMEIsSUFBSSx5QkFBeUIsSUFBSSxzQkFBc0IsSUFBSSxtQkFBbUIsSUFBSSw2QkFBNkIsSUFBSSw0QkFBNEIsSUFBSSwrQkFBK0IsSUFBSSxnQ0FBZ0MsSUFBSSxvQkFBb0IsSUFBSSx3QkFBd0IsSUFBSSxrQkFBa0IsSUFBSSxzQkFBc0IsSUFBSSx1QkFBdUIsSUFBSSx3QkFBd0IsSUFBSSwwQkFBMEIsSUFBSSxzQkFBc0IsSUFBSSxtQkFBbUIsSUFBSSwyQkFBMkIsSUFBSSx1QkFBdUIsSUFBSSxvQkFBb0IsSUFBSSx3QkFBd0IsSUFBSSxvQkFBb0IsSUFBSSwwQkFBMEIsSUFBSSwwQkFBMEIsSUFBSSxtQkFBbUIsSUFBSSwwQkFBMEIsSUFBSSwrQkFBK0IsSUFBSSxvQkFBb0IsSUFBSSx1QkFBdUIsSUFBSSxrQkFBa0IsSUFBSSxzQkFBc0IsSUFBSSw4QkFBOEIsSUFBSSxxQkFBcUIsSUFBSSx5QkFBeUIsSUFBSSx3QkFBd0IsSUFBSSwwQkFBMEIsSUFBSSxzQ0FBc0MsSUFBSSx1QkFBdUIsSUFBSSwrQkFBK0IsSUFBSSx5Q0FBeUMsSUFBSSxrREFBa0QsSUFBSSwrQ0FBK0MsSUFBSSw4QkFBOEIsSUFBSSxrQkFBa0IsSUFBSSxpQ0FBaUMsSUFBSSwwQkFBMEIsSUFBSSx3QkFBd0IsSUFBSSx3QkFBd0IsSUFBSSxtQkFBbUIsSUFBSSxtQ0FBbUMsSUFBSSx1QkFBdUIsSUFBSSw2QkFBNkIsMEJBQTBCLHVFQUF1RTtBQUMxOUQ7QUFDQTtBQUNBLG1RQUFtUSxXQUFXO0FBQzlRLENBQUMsR0FBRztBQUNKOzs7Ozs7VUNyakZBO1VBQ0E7O1VBRUE7VUFDQTtVQUNBO1VBQ0E7VUFDQTtVQUNBO1VBQ0E7VUFDQTtVQUNBO1VBQ0E7VUFDQTtVQUNBO1VBQ0E7O1VBRUE7VUFDQTs7VUFFQTtVQUNBO1VBQ0E7Ozs7O1dDdEJBO1dBQ0E7V0FDQTtXQUNBO1dBQ0E7V0FDQSxpQ0FBaUMsV0FBVztXQUM1QztXQUNBOzs7OztXQ1BBO1dBQ0E7V0FDQTtXQUNBO1dBQ0EseUNBQXlDLHdDQUF3QztXQUNqRjtXQUNBO1dBQ0E7Ozs7O1dDUEE7Ozs7O1dDQUE7V0FDQTtXQUNBO1dBQ0EsdURBQXVELGlCQUFpQjtXQUN4RTtXQUNBLGdEQUFnRCxhQUFhO1dBQzdEOzs7Ozs7Ozs7Ozs7O0FDTnFDOztBQUVyQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQSxrQkFBa0IsbURBQVE7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDOztBQUVELG1CIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZXhhbXBsZS8uLi9kaXN0L2luZGV4LmpzIiwid2VicGFjazovL2V4YW1wbGUvLi4vZGlzdC9waWFuby1hZGFwdGVyLmpzIiwid2VicGFjazovL2V4YW1wbGUvLi4vZGlzdC9waWFuby9pbmRleC5qcyIsIndlYnBhY2s6Ly9leGFtcGxlLy4uL2Rpc3QvcGlhbm8vdGlueXBhc3MuanMiLCJ3ZWJwYWNrOi8vZXhhbXBsZS93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9leGFtcGxlL3dlYnBhY2svcnVudGltZS9jb21wYXQgZ2V0IGRlZmF1bHQgZXhwb3J0Iiwid2VicGFjazovL2V4YW1wbGUvd2VicGFjay9ydW50aW1lL2RlZmluZSBwcm9wZXJ0eSBnZXR0ZXJzIiwid2VicGFjazovL2V4YW1wbGUvd2VicGFjay9ydW50aW1lL2hhc093blByb3BlcnR5IHNob3J0aGFuZCIsIndlYnBhY2s6Ly9leGFtcGxlL3dlYnBhY2svcnVudGltZS9tYWtlIG5hbWVzcGFjZSBvYmplY3QiLCJ3ZWJwYWNrOi8vZXhhbXBsZS8uL21haW4uanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFBpYW5vQWRhcHRlciBmcm9tIFwiLi9waWFuby1hZGFwdGVyXCI7XG4vKipcbiAqXG4gKiAgV2hlbiB3ZSBkZWNpZGUgdG8gYWQgYSBuZXcgYWQgc2VydmljZSB3ZSB3aWxsIGhhdmUgdG8gY2hhbmdlIHRoZSB0eXBlIG9mIGFkU2VydmljZXJcbiAqICBDdXJyZW50bHkgaXQgaXMganVzdCByZWxpYW50IG9uIHRoZSBQaWFub0FkYXB0ZXIsIGJ1dCBpdCBjb3VsZCBiZSBhbnkgYWRhcHRlciB0aGF0IHJlc3BvbmRzIHRvXG4gKiAgLmluaXQoKSBhbmQgdGFrZXMgdGhlIGxpZmVjeWNsZSBtZXRob2RzIGFsb25nIHdpdGggbWF0Y2hlcnMvdGFncy5cbiAqXG4gKi9cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEFkU2VydmVyIHtcbiAgICBjb25zdHJ1Y3Rvcih7IGFmdGVyQWRSZW5kZXIgPSBbXSwgYWZ0ZXJBZEluaXQgPSBbXSwgYmVmb3JlQWRJbml0ID0gW10sIG1hdGNoZXJzID0gW10sIHRoaXJkUGFydHlDYWxsYmFja3MgPSBbXSwgdGFncyA9IFtdLCBhZFNlcnZpY2VyLCB9KSB7XG4gICAgICAgIHRoaXMuYWZ0ZXJBZEluaXQgPSBhZnRlckFkSW5pdDtcbiAgICAgICAgdGhpcy5hZnRlckFkUmVuZGVyID0gYWZ0ZXJBZFJlbmRlcjtcbiAgICAgICAgdGhpcy5iZWZvcmVBZEluaXQgPSBiZWZvcmVBZEluaXQ7XG4gICAgICAgIHRoaXMubWF0Y2hlcnMgPSBtYXRjaGVycztcbiAgICAgICAgdGhpcy50YWdzID0gdGFncztcbiAgICAgICAgdGhpcy50aGlyZFBhcnR5Q2FsbGJhY2tzID0gdGhpcmRQYXJ0eUNhbGxiYWNrcztcbiAgICAgICAgdGhpcy51c2VyID0gdGhpcy5zZXRVc2VyKCk7XG4gICAgICAgIHRoaXMuYWRTZXJ2aWNlciA9IHRoaXMuc2V0QWRhcHRlcihhZFNlcnZpY2VyKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogU2V0cyB1cCB0aGUgYWRhcHRlciBmb3Igb3VyIEFkIFNlcnZpY2VcbiAgICAgKiBBZGFwdGVycyBhcGk6XG4gICAgICogVG8gcmVuZGVyIGEgdGVtcGxhdGUgaXQgUkVRVUlSRVMgYW4gaW5pdCgpIG1ldGhvZFxuICAgICAqIFRvIGludGVyYWN0IHdpdGggdGhpcmQtcGFydHkgc2VydmljZXMgdGhlIGFkYXB0ZXIgY29uc3RydWN0b3IgUkVRVUlSRVMgYW4gaW50ZXJmYWNlIHRvIHJlY2VpdmUgYW4gYXJyYXkgb2YgY2FsbGJhY2tzLlxuICAgICAqIFRvIG1hdGNoIG9uIGN1c3RvbSB2YXJpYWJsZXMgaXQgTUFZIGhhdmUgdGFncywgbWF0Y2hlcnMsIG9yIHVzZXItc3RhdGVcbiAgICAgKiBMaWZlY3ljbGUgbWV0aG9kcyBjYW4gYmUgZmlyZWQgZnJvbSB0aGUgQWRTZXJ2ZXIgY2xhc3Mgb3IgcGFzc2VkIHRocm91Z2ggdG8gdGhlIEFkYXB0ZXIuXG4gICAgICpcbiAgICAgKiBAcmVtYXJrc1xuICAgICAqIFBpYW5vIGxpZmVjeWNsZSBtZXRob2RzIGxpdmVzIGluc2lkZSB0aGUgd2luZG93LnRwIG9iamVjdCBzbyB3ZSBoYXZlIHRvIHBhc3MgdGhyb3VnaCBjYWxsYmFja3MuXG4gICAgICogQHBhcmFtIGFkU2VydmljZXJcbiAgICAgKiBAcmV0dXJucyBBZGFwdGVyIENsYXNzXG4gICAgICovXG4gICAgc2V0QWRhcHRlcihhZFNlcnZpY2VyKSB7XG4gICAgICAgIGNvbnN0IHBpYW5vQ29uZmlnID0ge1xuICAgICAgICAgICAgYWZ0ZXJSZW5kZXJDYWxsYmFja3M6IHRoaXMuYWZ0ZXJBZFJlbmRlcixcbiAgICAgICAgICAgIG1hdGNoZXJzOiB0aGlzLm1hdGNoZXJzLFxuICAgICAgICAgICAgdGFnczogdGhpcy50YWdzLFxuICAgICAgICAgICAgdGhpcmRQYXJ0eUNhbGxiYWNrczogdGhpcy50aGlyZFBhcnR5Q2FsbGJhY2tzLFxuICAgICAgICAgICAgdXNlcjogdGhpcy51c2VyXG4gICAgICAgIH07XG4gICAgICAgIHN3aXRjaCAoYWRTZXJ2aWNlcikge1xuICAgICAgICAgICAgY2FzZSBcInBpYW5vXCI6IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFBpYW5vQWRhcHRlcihwaWFub0NvbmZpZyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXNlIFwiYXRrXCI6IHtcbiAgICAgICAgICAgICAgICAvL2NvbmZpZ3VyZSBpbiBob3VzZSBBZFNlcnZpY2VcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFBpYW5vQWRhcHRlcihwaWFub0NvbmZpZyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogQHJlbWFya3NcbiAgICAgKiBUaGVzZSBtZXRob2RzIGFyZSBwcml2YXRlIGFuZCBzaG91bGQgYmUgb25seSBjYWxsZWQgdGhyb3VnaCAjZGlzcGF0Y2hBZFxuICAgICAqL1xuICAgIGV4ZWN1dGVCZWZvcmVBZEluaXQoKSB7XG4gICAgICAgIHRoaXMuYmVmb3JlQWRJbml0LmZvckVhY2goKGNiKSA9PiBjYigpKTtcbiAgICB9XG4gICAgZXhlY3V0ZUFmdGVyQWRSZW5kZXIoKSB7XG4gICAgICAgIHRoaXMuYWZ0ZXJBZFJlbmRlci5mb3JFYWNoKChjYikgPT4gY2IoKSk7XG4gICAgfVxuICAgIGV4ZWN1dGVBZnRlckFkSW5pdCgpIHtcbiAgICAgICAgdGhpcy5hZnRlckFkSW5pdC5mb3JFYWNoKChjYikgPT4gY2IoKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEdhdGhlcnMgbmVlZGVkIHByb3BlcnRpZXMgYW5kIGNyZWF0ZXMgYSBjb25maWd1cmF0aW9uIG9ialxuICAgICAqXG4gICAgICogQHJlbWFya3NcbiAgICAgKiBUaGUgdXNlciBkYXRhIGNvdWxkIGNvbWUgZnJvbSBjb250ZXh0IG9yIGl0IGNvdWxkIGNvbWUgZnJvbVxuICAgICAqIEByZXR1cm5zIFVzZXJcbiAgICAgKi9cbiAgICBzZXRVc2VyKCkge1xuICAgICAgICByZXR1cm4ge307XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEV4ZWN1dGUgYWR2ZXJ0aXNlbWVudCBhbmQgbGlmZWN5Y2xlIG1ldGhvZHMuXG4gICAgICovXG4gICAgZGlzcGF0Y2hBZCgpIHtcbiAgICAgICAgdGhpcy5leGVjdXRlQmVmb3JlQWRJbml0KCk7XG4gICAgICAgIHRoaXMuYWRTZXJ2aWNlci5pbml0KCk7XG4gICAgICAgIHRoaXMuZXhlY3V0ZUFmdGVyQWRJbml0KCk7XG4gICAgfVxufVxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguanMubWFwIiwidmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG52YXIgX19jbGFzc1ByaXZhdGVGaWVsZEdldCA9ICh0aGlzICYmIHRoaXMuX19jbGFzc1ByaXZhdGVGaWVsZEdldCkgfHwgZnVuY3Rpb24gKHJlY2VpdmVyLCBzdGF0ZSwga2luZCwgZikge1xuICAgIGlmIChraW5kID09PSBcImFcIiAmJiAhZikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlByaXZhdGUgYWNjZXNzb3Igd2FzIGRlZmluZWQgd2l0aG91dCBhIGdldHRlclwiKTtcbiAgICBpZiAodHlwZW9mIHN0YXRlID09PSBcImZ1bmN0aW9uXCIgPyByZWNlaXZlciAhPT0gc3RhdGUgfHwgIWYgOiAhc3RhdGUuaGFzKHJlY2VpdmVyKSkgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCByZWFkIHByaXZhdGUgbWVtYmVyIGZyb20gYW4gb2JqZWN0IHdob3NlIGNsYXNzIGRpZCBub3QgZGVjbGFyZSBpdFwiKTtcbiAgICByZXR1cm4ga2luZCA9PT0gXCJtXCIgPyBmIDoga2luZCA9PT0gXCJhXCIgPyBmLmNhbGwocmVjZWl2ZXIpIDogZiA/IGYudmFsdWUgOiBzdGF0ZS5nZXQocmVjZWl2ZXIpO1xufTtcbnZhciBfUGlhbm9BZGFwdGVyX2luc3RhbmNlcywgX1BpYW5vQWRhcHRlcl9nZXRBaWQsIF9QaWFub0FkYXB0ZXJfZ2V0VXNlclRva2VuO1xuaW1wb3J0IFwiLi9waWFub1wiO1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUGlhbm9BZGFwdGVyIHtcbiAgICBjb25zdHJ1Y3Rvcih7IHRoaXJkUGFydHlDYWxsYmFja3MgPSBbXSwgYWZ0ZXJSZW5kZXJDYWxsYmFja3MgPSBbXSwgbWF0Y2hlcnMgPSBbXSwgdGFncyA9IFtdLCB1c2VyIH0pIHtcbiAgICAgICAgX1BpYW5vQWRhcHRlcl9pbnN0YW5jZXMuYWRkKHRoaXMpO1xuICAgICAgICB0aGlzLnRwID0gd2luZG93LnRwIHx8IFtdO1xuICAgICAgICB0aGlzLnVzZXIgPSB0aGlzLnNldFVzZXIodXNlcik7XG4gICAgICAgIHRoaXMuc2V0RW52Q29uZmlnKCk7XG4gICAgICAgIHRoaXMuc2V0VGhpcmRQYXJ0eUNhbGxiYWNrcyh0aGlyZFBhcnR5Q2FsbGJhY2tzKTtcbiAgICAgICAgdGhpcy5zZXRDdXN0b21WYXJpYWJsZXMobWF0Y2hlcnMpO1xuICAgICAgICB0aGlzLnNldEFmdGVyQWRSZW5kZXIoYWZ0ZXJSZW5kZXJDYWxsYmFja3MpO1xuICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkodGFnc1swXSkpIHtcbiAgICAgICAgICAgIHRhZ3MgPSBbdGFnc107XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zZXRUYWdzKHRhZ3MpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBTZXRzIHJlcXVpcmVkIHVzZXIgZmllbGRzIHRvIGV4ZWN1dGUgYSBwaWFubyBleHBlcmllbmNlLlxuICAgICAqXG4gICAgICogQHJlbWFya3NcbiAgICAgKiBQaWFubyBvbmx5IG5lZWRzIHRoZSBjdXN0b20gdmFyaWFibGUgdG8gbWF0Y2gsIGJ1dCB0aGUgdXNlci10b2tlbiBoYXMgc29tZXRoaW5nIHRvIGRvIG9uIHRoZWlyIHNpZGUuXG4gICAgICogSSBhbSBub3Qgc3VyZSB3aGF0IGl0IGRvZXMsIGJ1dCB0byBiZSBiYWNrd2FyZHMgY29tcGF0aWJsZSB3ZSB3aWxsIGFkZCBpdCBpbiB0aGVyZS5cbiAgICAgKlxuICAgICAqIFdlIGFyZSBwYXNzaW5nIGluIGEgdXNlciBhcmd1bWVudCBqdXN0IGluLWNhc2Ugd2UgbmVlZCBhZGRpdGlvbmFsIHByb3BlcnRpZXMgZnJvbSBvdXJcbiAgICAgKiBjb250ZXh0IG9yIGNvb2tpZSBpbiBhIGZ1dHVyZSBpdGVyYXRpb24uXG4gICAgICpcbiAgICAgKiBAcGFyYW0gdXNlclxuICAgICAqL1xuICAgIHNldFVzZXIodXNlcikge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgYWlkOiBfX2NsYXNzUHJpdmF0ZUZpZWxkR2V0KHRoaXMsIF9QaWFub0FkYXB0ZXJfaW5zdGFuY2VzLCBcIm1cIiwgX1BpYW5vQWRhcHRlcl9nZXRBaWQpLmNhbGwodGhpcyksXG4gICAgICAgICAgICB0b2tlbjogX19jbGFzc1ByaXZhdGVGaWVsZEdldCh0aGlzLCBfUGlhbm9BZGFwdGVyX2luc3RhbmNlcywgXCJtXCIsIF9QaWFub0FkYXB0ZXJfZ2V0VXNlclRva2VuKS5jYWxsKHRoaXMpLFxuICAgICAgICB9O1xuICAgIH1cbiAgICBpbml0KCkge1xuICAgICAgICAvKipcbiAgICAgICAgKiBJbml0aWFsaXplcyB0aGUgcGlhbm8gZXhwZXJpZW5jZVxuICAgICAgICAqIHRoaXMgaXMgd2hlcmUgd2UgY291bGQgZXZlbnR1YWxseSBleHBhbmQgb3VyIGNhbGxiYWNrcyB1c2luZyB0aGUgdHAgYXBpLlxuICAgICAgICAqIGh0dHBzOi8vZG9jcy5waWFuby5pby9jYWxsYmFja3MvXG4gICAgICAgICpcbiAgICAgICAgKiBAdHlwZWRlZiB7c3RyaW5nfSBDb21tYW5kIC0gSW5pdGlhbGl6YXRpb24gY29tbWFuZCBmb3IgcGlhbm8gZXhwZXJpZW5jZS5cbiAgICAgICAgKiBAdHlwZWRlZiB7KCk9PnZvaWR9IENhbGxiYWNrIC0gSW4gdGhpcyBjYWxsYmFjayB5b3UgY2FuIGFjY2VzcyBhIGxvdCBvZiB1c2VyIGluZm9ybWF0aW9uIGJlZm9yZSBpbml0aWFsaXppbmcgdGhlIGV4cGVyaWVuY2UuXG4gICAgICAgICogQHR5cGVkZWYge1tDb21tYW5kLCBDYWxsYmFja119IEluaXRQYXJhbXNcbiAgICAgICAgKiBAcGFyYW0ge0luaXRQYXJhbXN9XG4gICAgICAgICovXG4gICAgICAgIHRoaXMudHAucHVzaChbXCJpbml0XCIsICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnRwLmV4cGVyaWVuY2UuaW5pdCgpO1xuICAgICAgICAgICAgfSxdKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ29uZmlndXJhdGlvbiBvYmplY3RzIGNhcnJ5IHRoZSBuZWNlc3NhcnkgZGF0YSB0byB0aGUgdGhpcmQgcGFydHkgY2FsbGJhY2tcbiAgICAgKiBFYWNoIGNvbmZpZ3VyYXRpb24gb2JqZWN0IGlzIGdvaW5nIHRvIGJlIGRpZmZlcmVudCBiYXNlZCBvbiB0aGUgJ3NlcnZpY2UnLlxuICAgICAqIFJlcXVpcmVkIHByb3BlcnRpZXMgYXJlIHNlcnZpY2UsIGFuZCBjYWxsYmFja3MuXG4gICAgICpcbiAgICAgKiBAdHlwZWRlZiBTZXJ2aWNlIHtzdHJpbmd9XG4gICAgICogQHR5cGVkZWYgQ2FsbGJhY2tzIHtbKCk9PnZvaWRdfVxuICAgICAqIEB0eXBlZGVmIHtTZXJ2aWNlLCBDYWxsYmFja3N9IENvbmZpZ09ialxuICAgICAqIEBwYXJhbSB0aGlyZFBhcnR5Q29uZmlncyBDb25maWdPYmpbXVxuICAgICAqL1xuICAgIHNldFRoaXJkUGFydHlDYWxsYmFja3ModGhpcmRQYXJ0eUNvbmZpZ3MpIHtcbiAgICAgICAgdGhpcmRQYXJ0eUNvbmZpZ3MuZm9yRWFjaCgoY29uZmlnKSA9PiB7XG4gICAgICAgICAgICBzd2l0Y2ggKGNvbmZpZy5zZXJ2aWNlKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnbWl4cGFuZWwnOiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0TWl4cGFuZWwoY29uZmlnKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhc2UgJ2F0ayc6IHtcbiAgICAgICAgICAgICAgICAgICAgLy9kbyBvdGhlciBzdHVmZi5cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0TWl4cGFuZWwoY29uZmlnKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDb25maWd1cmVzIG1peHBhbmVsJ3MgZ2xvYmFsIGFwaSBmb3IgdHJhY2tpbmcgZXZlbnRzIHdpdGggcGlhbm8gdGVtcGxhdGUgY29udGVudCBmaWVsZHNcbiAgICAgKlxuICAgICAqIEByZW1hcmtzXG4gICAgICogV2UgYXJlIGJvcnJvd2luZyBhIHBhdHRlcm4gZnJvbSByZWR1eCwgaW5zdGVhZCBvZiBhY3Rpb24gYW5kIHBheWxvYWQgd2UgaGF2ZSBtaXhwYW5lbCBwcm9wZXJ0aWVzIG9mIHN0YXR1cyBhbmQgYWN0aW9uc1xuICAgICAqIEFjdGlvbnMgYXJlIHRoZSBldmVudCBjYWxsYmFja3MgdGFraW5nIHBpYW5vIGNvbnRlbnQgZmllbGRzIGFuZCBwYXJzaW5nIHRoZSBpbmZvcm1hdGlvbiB3ZSByZXF1aXJlIGZvciBlYWNoIHNwZWNpZmljIGV2ZW50LlxuICAgICAqXG4gICAgICogV2UgYXJlIHVzaW5nIGV4dGVybmFsIGV2ZW50cyBsYXVuY2ggdGhlc2UgY2FsbGJhY2suIEEgaGFja3kgc29sdXRpb24gY3VycmVudGx5IGJ1dCB3ZSBhcmUgaW5qZWN0aW5nIGEgdGhpcmQgcGFydHkgaWZyYW1lIGludG8gb3VyXG4gICAgICogYXBwbGljYXRpb24uIFRoZXJlIGlzIGEgbGltaXRlZCBzY29wZSBvZiBpbnRlcmFjdGlvbiB3ZSBjYW4gaGF2ZSB3aXRoIHRoZSB0ZW1wbGF0ZS4gQnV0IHdoYXQgd2UgZG9uJ3Qgd2FudCBpcyB0byBjb3VwbGUgb3VyIGNvZGVcbiAgICAgKiB3aGVyZSB0aGUgdGVtcGxhdGUgaXMgZ2V0dGluZyByZW5kZXJlZC4gU28gaGFja3kgPiBoZWF2aWx5IGNvdXBsZWQgY3VycmVudGx5LlxuICAgICAqXG4gICAgICogaHR0cHM6Ly9kb2NzLnBpYW5vLmlvL29mZmVyLXRlbXBsYXRlLWVzc2VudGlhbHMvI2V4dGVybmFsZXZlbnRcbiAgICAgKlxuICAgICAqIEV2ZXJ5IGFjdGlvbiB0aGF0IHdlIHdhbnQgdG8gdHJhY2sgd2l0aCBtaXhwYW5lbCB3ZSBhZGQgYW4gYWRkaXRpb25hbCBjYXNlIGFuZCBhZGQgYW4gZXh0ZXJuYWwgZXZlbnQgb24gdGhlIHRlbXBsYXRlXG4gICAgICogV2UgaGF2ZSB0byB0cmlnZ2VyIGl0IHdpdGggamF2YXNjcmlwdCBvbiB0aGUgdGVtcGxhdGUgaWYgaXQgaXMgbm90IGEgdXNlciB0cmlnZ2VyZWQgZXZlbnQgKHVudGlsIHdlIGZpbmQgYSBiZXR0ZXIgd2F5KS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBDb25maWdPYmpcbiAgICAgKlxuICAgICAqL1xuICAgIHNldE1peHBhbmVsKHsgc3RhdHVzLCBhY3Rpb24gfSkge1xuICAgICAgICAvKipcbiAgICAgICAgICogdG9kbzogYWRkIGFsbCBvZiB0aGUgYXZhaWxhYmxlIGZpZWxkcyB3ZSBnZXQgZnJvbSB0aGUgcGlhbm8gcGFyYW1zIG9iaiBhbmQgdGhlIHBhcmFtcy5wYXJhbXMgb2JqXG4gICAgICAgICAqIFRoaXMgZnVuY3Rpb24gbWFwcyB0aGUgcGFyYW1zIGRhdGEgcmVjZWl2ZWQgZnJvbSB0aGUgZXZlbnQgd2UgZ2V0IGZyb20gcGlhbm9cbiAgICAgICAgICogaW5jbHVkaW5nIGN1c3RvbSBwYXJhbWV0ZXJzIHdlIGhhdmUgdG8gc2V0IHVwIGluIHRoZSBleHRlcm5hbC1ldmVudCBkYXRhLWF0dHJpYnV0ZXNcbiAgICAgICAgICogV2UgY2FuIG5vdCB0YXJnZXQgdHJhZGl0aW9uYWwgZGF0YS1hdHRyaWJ1dGVzIDpmcm93bjpcbiAgICAgICAgICpcbiAgICAgICAgICpcbiAgICAgICAgICpAZXhhbXBsZVxuICAgICAgICAgKiA8c3BhblxuICAgICAgICAgKiBpZD1cIm1peHBhbmVsLXBhcmFtc1wiXG4gICAgICAgICAqIGV4dGVybmFsLWV2ZW50PVwicHJlc2VudGVkXCJcbiAgICAgICAgICogZXh0ZXJuYWwtZXZlbnQtcGFyYW1zPVwie3twYXJhbXN9fVwiXG4gICAgICAgICAqIGV4dGVybmFsLWV2ZW50LWFkdHlwZT1cIlslJSBhZC10eXBlICUlXVwiXG4gICAgICAgICAqIGV4dGVybmFsLWV2ZW50LWluY29kZT1cIlslJSBpbmNvZGUgJSVdXCJcbiAgICAgICAgICogZXh0ZXJuYWwtZXZlbnQtZGV2aWNlVHlwZT1cIlslJSBkZXZpY2VUeXBlICUlXVwiXG4gICAgICAgICAqIGV4dGVybmFsLWV2ZW50LWNsaWNrZG9tYWluPVwiWyUlIGNsaWNrLWRvbWFpbiAlJV1cIlxuICAgICAgICAgKiBleHRlcm5hbC1ldmVudC1tZGM9XCJbJSUgbWRjICUlXVwiXG4gICAgICAgICAqID48L3NwYW4+XG4gICAgICAgICAqXG4gICAgICAgICAqXG4gICAgICAgICAqIEluIHRoZSBjdXN0b20gc2NyaXB0IHdlIGhhdmUgdG8gbWFudWFsbHkgdHJpZ2dlciBhbiBldmVudCB0aGF0IGlzIG5vdCBjYXVzZSBieVxuICAgICAgICAgKiB1c2VyIGludGVyYWN0aW9uLiBGb3IgdGhpcyBleGFtcGxlIHdlIHdhbnQgdG8gYmUgYWJsZSB0byBmaXJlIGEgcHJlc2VudGVkIGV2ZW50IHRvIG1peHBhbmVsXG4gICAgICAgICAqIGJ1dCBiZWNhdXNlIGl0IGlzbid0IHVzZXIgdHJpZ2dlcmVkIHdlIHdpbGwgY2xpY2sgb24gdGhlIHNwYW4gdGhhdCB3aWxsIGZpcmUgdGhlIGV4dGVybmFsLWV2ZW50LlxuICAgICAgICAgKlxuICAgICAgICAgKiA8ZGl2IGN1c3RvbS1zY3JpcHQ+XG4gICAgICAgICAqICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJtaXhwYW5lbC1wYXJhbXNcIikuY2xpY2soKTtcbiAgICAgICAgICogPC9kaXY+XG4gICAgICAgICAqL1xuICAgICAgICBmdW5jdGlvbiB0cmFja01peHBhbmVsKHsgYWN0aW9uLCBzdGF0dXMsIHBhcmFtcywgY3VzdG9tUGFyYW1zOiB7IGluY29kZSwgY2xpY2tkb21haW4gfSB9KSB7XG4gICAgICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgICAgIGxldCB7IHVybCB9ID0geWllbGQgSlNPTi5wYXJzZShwYXJhbXMpO1xuICAgICAgICAgICAgICAgIC8vIFRPRE86IGNoYW5nZSAxNzIgdG8gc3VwcG9ydCBzdWJkb21haW5zXG4gICAgICAgICAgICAgICAgY29uc3QgWywgbG9jYXRpb24gPSBcImhvbWVwYWdlXCJdID0gdXJsLnNwbGl0KFwiOjU1MDAvXCIpO1xuICAgICAgICAgICAgICAgIHdpbmRvdy5taXhwYW5lbC50cmFjayhhY3Rpb24sIHsgaW5jb2RlLCBzdGF0dXMsIGxvY2F0aW9uLCB0eXBlOiBjbGlja2RvbWFpbiB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHN3aXRjaCAoc3RhdHVzKSB7XG4gICAgICAgICAgICBjYXNlICdBY2NlcHRlZCc6IHtcbiAgICAgICAgICAgICAgICB0aGlzLnRwLnB1c2goW1wiYWRkSGFuZGxlclwiLCBcImN1c3RvbUV2ZW50XCIsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChldmVudCA9PT0gbnVsbCB8fCBldmVudCA9PT0gdm9pZCAwID8gdm9pZCAwIDogZXZlbnQuZXZlbnROYW1lKSAhPT0gJ3NpZ24tdXAtYnV0dG9uJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICB0cmFja01peHBhbmVsKHsgYWN0aW9uLCBzdGF0dXMsIHBhcmFtczogZXZlbnQucGFyYW1zLnBhcmFtcywgY3VzdG9tUGFyYW1zOiBldmVudC5wYXJhbXMgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1dKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhc2UgJ1ByZXNlbnRlZCc6IHtcbiAgICAgICAgICAgICAgICB0aGlzLnRwLnB1c2goW1wiYWRkSGFuZGxlclwiLCBcImN1c3RvbUV2ZW50XCIsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKGV2ZW50ID09PSBudWxsIHx8IGV2ZW50ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBldmVudC5ldmVudE5hbWUpICE9PSAncHJlc2VudGVkJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYWNrTWl4cGFuZWwoeyBhY3Rpb24sIHN0YXR1cywgcGFyYW1zOiBldmVudC5wYXJhbXMucGFyYW1zLCBjdXN0b21QYXJhbXM6IGV2ZW50LnBhcmFtcyB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFdlIGF0dGFjaCBjYWxsYmFja3MgdGhhdCBmaXJlIGJlZm9yZSB0aGUgYnJvd3NlciByZW5kZXJzIHRoZSB0ZW1wbGF0ZVxuICAgICAqXG4gICAgICogQHJlbWFya3NcbiAgICAgKiAgVGhpcyBpcyBub3QgYnVpbHQgdG8gc3VwcG9ydCB0aGlyZC1wYXJ0eSBjYWxsYmFja3MuIFRob3NlIG5lZWQgdG8gYmUgaGFuZGxlZCBpbmRpdmlkdWFsbHkgYnkgdGhlaXIgaGFuZGxlcnMuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gY2JzXG4gICAgICovXG4gICAgc2V0QmVmb3JlQWRJbml0KGNicykge1xuICAgICAgICBjYnMuZm9yRWFjaCgoY2FsbGJhY2spID0+IHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgY2FsbGJhY2sgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICAgICAgICAgIHRoaXMudHAucHVzaChbXCJhZGRIYW5kbGVyXCIsIFwiYmVmb3JlQnJvd3NlckV2ZW50XCIsIGNhbGxiYWNrXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBXZSBhdHRhY2ggY2FsbGJhY2tzIHRoYXQgZmlyZSBhZnRlciB0aGUgYnJvd3NlciByZW5kZXJzIHRoZSB0ZW1wbGF0ZVxuICAgICAqXG4gICAgICogQHJlbWFya3NcbiAgICAgKiAgVGhpcyBpcyBub3QgYnVpbHQgdG8gc3VwcG9ydCB0aGlyZC1wYXJ0eSBjYWxsYmFja3MuIFRob3NlIG5lZWQgdG8gYmUgaGFuZGxlZCBpbmRpdmlkdWFsbHkgYnkgdGhlaXIgaGFuZGxlcnMuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gY2JzXG4gICAgICovXG4gICAgc2V0QWZ0ZXJBZFJlbmRlcihjYnMpIHtcbiAgICAgICAgY2JzLmZvckVhY2goKGNhbGxiYWNrKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnRwLnB1c2goW1wiYWRkSGFuZGxlclwiLCBcInNob3dUZW1wbGF0ZVwiLCBmdW5jdGlvbiAodGVtcGxhdGVQYXJhbXMpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgICAgICAgICB9XSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBTZXQgdGhlIHVzZXIgc2VnbWVudHMgdGhhdCB3aWxsIG1hdGNoIG9uIHRoZSBwaWFubyBzZWdtZW50XG4gICAgICogaW4gdGhlIGluaXRpYWwgdXNlciBzZWdtZW50cyBwaGFzZSBvZiB0aGUgY29tcG9zZXIgZXhwZXJpZW5jZVxuICAgICAqXG4gICAgICogaS5lLiBleHBlcmllbmNlIHJ1bGVzLCBpbml0aWFsIHVzZXIgc2VnbWVudHMsIGV2ZW50cyBhbmQgdHJpZ2dlcnMsIGFjdGlvbnNcbiAgICAgKiBodHRwczovL2RvY3MucGlhbm8uaW8vdHJhY2svb3ZlcnZpZXctY29tcG9zZXI/Y2hhcHRlcj01NTU2I21lbnU1NTU2XG4gICAgICpcbiAgICAgKiBAcGFyYW0gbWF0Y2hlcnNcbiAgICAgKi9cbiAgICBzZXRDdXN0b21WYXJpYWJsZXMobWF0Y2hlcnMpIHtcbiAgICAgICAgbWF0Y2hlcnMuZm9yRWFjaCgoY3YpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IFtrZXksIHZhbHVlXSA9IGN2O1xuICAgICAgICAgICAgdGhpcy50cC5wdXNoKFtcInNldEN1c3RvbVZhcmlhYmxlXCIsIGtleSwgdmFsdWVdKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEVhY2ggZXhwZXJpZW5jZSBpbiBjb21wb3NlciByZXF1aXJlcyBwcm9wZXIgY29uZmlndXJhdGlvbi5cbiAgICAgKiBUaGlzIG9iamVjdCB3aWxsIHNldCB1cCBvdXIgY29uZmlndXJhdGlvbiBvYmplY3QgcHJvcGVybHkgdG8gbGF1bmNoIHRoZSBleHBlY3RlZCBleHBlcmllbmNlLlxuICAgICAqXG4gICAgICogQHJldHVybnMgUGlhbm9Db25maWdcbiAgICAgKi9cbiAgICAvLyBkZWJ1ZyBpZiBub24gcHJvZFxuICAgIGdldENvbmZpZ1Byb3BlcnRpZXMoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBzZXRBaWQ6IHRoaXMudXNlci5haWQsXG4gICAgICAgICAgICBzZXREZWJ1ZzogdHJ1ZSxcbiAgICAgICAgICAgIHNldEVuZHBvaW50OiBcImh0dHBzOi8vYnV5LnRpbnlwYXNzLmNvbS9hcGkvdjNcIixcbiAgICAgICAgICAgIHNldEV4dGVybmFsSldUOiB0aGlzLnVzZXIudG9rZW4sXG4gICAgICAgICAgICBzZXRVc2VQaWFub0lkVXNlclByb3ZpZGVyOiB0cnVlLFxuICAgICAgICAgICAgc2V0VXNlVGlueXBhc3NBY2NvdW50czogZmFsc2UsXG4gICAgICAgIH07XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNldHMgdXAgdGhlIHdpbmRvdy50cCBwaWFubyBvYmplY3QgaW4gdGhlIHNwZWNpZmljIHdheSBpdCByZXF1aXJlcy5cbiAgICAgKlxuICAgICAqIEByZW1hcmtzXG4gICAgICogd2luZG93LnRwIGV4cGVjdHMgdG8gcHVzaCB0dXBsZXMgd2l0aCB0aGUgcHJvcGVyICdrZXknIChhdCBwb3NpdGlvbiB0dXBsZVswXSkuXG4gICAgICogdG9kbzogZXhwYW5kIGV4cGxhbmF0aW9uXG4gICAgICovXG4gICAgc2V0RW52Q29uZmlnKCkge1xuICAgICAgICBjb25zdCBjb25maWcgPSB0aGlzLmdldENvbmZpZ1Byb3BlcnRpZXMoKTtcbiAgICAgICAgT2JqZWN0LmVudHJpZXMoY29uZmlnKS5mb3JFYWNoKChkKSA9PiB0aGlzLnRwLnB1c2goZCkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBUaGlzIGNvbmZpZ3VyZXMgdGhlIHdpbmRvdyB0cCBvYmplY3QgdG8gYWNjZXB0IGN1c3RvbSB0YWdzLlxuICAgICAqXG4gICAgICogQHJlbWFya3NcbiAgICAgKiBUYWdzIGFyZSBhIHdheSBmb3IgdXMgdG8gbWF0Y2ggZXhwZXJpZW5jZXMgd2l0aCBncmVhdCBzcGVjaWZpY2l0eS4gKEV4cGVyaWVuY2UgUnVsZXMgUGhhc2UpXG4gICAgICogVGFncyBhcmUgdXNlZCBpbiB0aGUgZXhwZXJpZW5jZSwgYW5kIGNhbiBiZSByZW5kZXJlZCBvbiB0aGUgdGVtcGxhdGUuXG4gICAgICogVGFncyBjYW4gYmUgcmV0dXJuZWQgdG8gYmUgdXNlZCBpbiB0aGlyZC1wYXJ0eSBpbnRlZ3JhdGlvbnNcbiAgICAgKiBodHRwczovL2RvY3MucGlhbm8uaW8vY29udGVudC10cmFja2luZy8jY3VzdGFnc1xuICAgICAqXG4gICAgICogQHBhcmFtIHRhZ3NcbiAgICAgKi9cbiAgICBzZXRUYWdzKHRhZ3MpIHtcbiAgICAgICAgdGFncy5mb3JFYWNoKCh0YWcpID0+IHtcbiAgICAgICAgICAgIGlmICghQXJyYXkuaXNBcnJheSh0YWcpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy50cC5wdXNoKFtcInNldFRhZ3NcIiwgdGFnXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbl9QaWFub0FkYXB0ZXJfaW5zdGFuY2VzID0gbmV3IFdlYWtTZXQoKSwgX1BpYW5vQWRhcHRlcl9nZXRBaWQgPSBmdW5jdGlvbiBfUGlhbm9BZGFwdGVyX2dldEFpZCgpIHtcbiAgICAvLyBjb25zdCBbc3ViZG9tYWluLCBkb21haW5dID0gd2luZG93LmxvY2F0aW9uLmhvc3RuYW1lLnNwbGl0KCcuJylcbiAgICAvLyBpZihzdWJkb21haW4gPT09ICd3d3cnKXtcbiAgICAvLyAgIHJldHVybiB7XG4gICAgLy8gICAgIFwiYW1lcmljYXN0ZXN0a2l0Y2hlblwiOiBcIm84aXQ0SktUcHVcIixcbiAgICAvLyAgICAgXCJjb29rc2lsbHVzdHJhdGVkXCI6IFwiMGw0Q1hSQkJwdVwiLFxuICAgIC8vICAgICBcImNvb2tzY291bnRyeVwiOiBcInZScXR0c3UxcHVcIixcbiAgICAvLyAgIH1bZG9tYWluXVxuICAgIC8vIH0gZWxzZSB7XG4gICAgLy8gICByZXR1cm4ge1xuICAgIC8vICAgICBcImFtZXJpY2FzdGVzdGtpdGNoZW5cIjogXCJQM01VbW1VOXB1XCIsXG4gICAgLy8gICAgIFwiY29va3NpbGx1c3RyYXRlZFwiOiBcIkNMUmZBTXFxcHVcIixcbiAgICAvLyAgICAgXCJjb29rc2NvdW50cnlcIjogXCJya0lnZFBhdHB1XCIsXG4gICAgLy8gICB9W2RvbWFpbl1cbiAgICAvLyB9XG4gICAgLyoqXG4gICAgICogZXhhbXBsZSBpbXBsZW1lbnRhdGlvbiBzdGF0aWMgYWlkXG4gICAgICovXG4gICAgcmV0dXJuIFwiUDNNVW1tVTlwdVwiO1xufSwgX1BpYW5vQWRhcHRlcl9nZXRVc2VyVG9rZW4gPSBmdW5jdGlvbiBfUGlhbm9BZGFwdGVyX2dldFVzZXJUb2tlbigpIHtcbiAgICB2YXIgYyA9IGRvY3VtZW50LmNvb2tpZS5tYXRjaChcIihefDspXFxcXHMqdXNlcl90b2tlblxcXFxzKj1cXFxccyooW147XSspXCIpO1xuICAgIGlmIChjICYmIGMubGVuZ3RoID4gMClcbiAgICAgICAgcmV0dXJuIGMucG9wKCk7XG4gICAgZWxzZVxuICAgICAgICByZXR1cm4gbnVsbDtcbn07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1waWFuby1hZGFwdGVyLmpzLm1hcCIsInZhciBwaWFub1NESyA9IHJlcXVpcmUoJy4vdGlueXBhc3MnKTtcbm1vZHVsZS5leHBvcnRzID0ge1xuICAgIHBpYW5vU0RLXG59O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguanMubWFwIiwiIWZ1bmN0aW9uIChlKSB7XG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgd2luZG93LnBuRnVsbFRQVmVyc2lvbiA9ICEwLCBcImZ1bmN0aW9uXCIgIT0gdHlwZW9mIE9iamVjdC5hc3NpZ24gJiYgT2JqZWN0LmRlZmluZVByb3BlcnR5KE9iamVjdCwgXCJhc3NpZ25cIiwgeyB2YWx1ZTogZnVuY3Rpb24gKGUsIG4pIHsgaWYgKG51bGwgPT0gZSlcbiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW5ub3QgY29udmVydCB1bmRlZmluZWQgb3IgbnVsbCB0byBvYmplY3RcIik7IGZvciAodmFyIHQgPSBPYmplY3QoZSksIHIgPSAxOyByIDwgYXJndW1lbnRzLmxlbmd0aDsgcisrKSB7XG4gICAgICAgICAgICB2YXIgbyA9IGFyZ3VtZW50c1tyXTtcbiAgICAgICAgICAgIGlmIChudWxsICE9IG8pXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSBpbiBvKVxuICAgICAgICAgICAgICAgICAgICBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobywgaSkgJiYgKHRbaV0gPSBvW2ldKTtcbiAgICAgICAgfSByZXR1cm4gdDsgfSwgd3JpdGFibGU6ICEwLCBjb25maWd1cmFibGU6ICEwIH0pO1xuICAgIHZhciBuID0gbmV3IFdlYWtNYXA7XG4gICAgZnVuY3Rpb24gdChlLCB0KSB7IHJldHVybiBuLmdldChlKSAmJiBuLmdldChlKS5nZXQodCk7IH1cbiAgICBmdW5jdGlvbiByKGUsIG4sIHIpIHsgaWYgKHZvaWQgMCA9PT0gbilcbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcjsgdmFyIG8gPSB0KG4sIHIpOyByZXR1cm4gbyAmJiBvLmdldChlKTsgfVxuICAgIGZ1bmN0aW9uIG8oZSwgciwgbywgaSkgeyBpZiAoaSAmJiAhW1wic3RyaW5nXCIsIFwic3ltYm9sXCJdLmluY2x1ZGVzKHR5cGVvZiBpKSlcbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcjsgKHQobywgaSkgfHwgZnVuY3Rpb24gKGUsIHQpIHsgdmFyIHIgPSBuLmdldChlKSB8fCBuZXcgTWFwOyBuLnNldChlLCByKTsgdmFyIG8gPSByLmdldCh0KSB8fCBuZXcgTWFwOyByZXR1cm4gci5zZXQodCwgbyksIG87IH0obywgaSkpLnNldChlLCByKTsgfVxuICAgIGZ1bmN0aW9uIGkoZSwgbiwgdCkgeyByZXR1cm4gcihlLCBuLCB0KSA/IHIoZSwgbiwgdCkgOiBPYmplY3QuZ2V0UHJvdG90eXBlT2YobikgPyBpKGUsIE9iamVjdC5nZXRQcm90b3R5cGVPZihuKSwgdCkgOiB2b2lkIDA7IH1cbiAgICB2YXIgYSwgcyA9IHsgZGVjb3JhdGU6IGZ1bmN0aW9uIChlLCBuLCB0LCByKSB7IGlmICghQXJyYXkuaXNBcnJheShlKSB8fCAwID09PSBlLmxlbmd0aClcbiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3I7IHJldHVybiB2b2lkIDAgIT09IHQgPyBmdW5jdGlvbiAoZSwgbiwgdCwgcikgeyByZXR1cm4gZS5yZXZlcnNlKCkuZm9yRWFjaCgoZnVuY3Rpb24gKGUpIHsgciA9IGUobiwgdCwgcikgfHwgcjsgfSkpLCByOyB9KGUsIG4sIHQsIHIpIDogXCJmdW5jdGlvblwiID09IHR5cGVvZiBuID8gZnVuY3Rpb24gKGUsIG4pIHsgcmV0dXJuIGUucmV2ZXJzZSgpLmZvckVhY2goKGZ1bmN0aW9uIChlKSB7IHZhciB0ID0gZShuKTsgdCAmJiAobiA9IHQpOyB9KSksIG47IH0oZSwgbikgOiB2b2lkIDA7IH0sIGRlZmluZU1ldGFkYXRhOiBmdW5jdGlvbiAoZSwgbiwgdCwgcikgeyBvKGUsIG4sIHQsIHIpOyB9LCBnZXRNZXRhZGF0YTogZnVuY3Rpb24gKGUsIG4sIHQpIHsgcmV0dXJuIGkoZSwgbiwgdCk7IH0sIGdldE93bk1ldGFkYXRhOiBmdW5jdGlvbiAoZSwgbiwgdCkgeyByZXR1cm4gcihlLCBuLCB0KTsgfSwgaGFzTWV0YWRhdGE6IGZ1bmN0aW9uIChlLCBuLCB0KSB7IHJldHVybiAhIWkoZSwgbiwgdCk7IH0sIGhhc093bk1ldGFkYXRhOiBmdW5jdGlvbiAoZSwgbiwgdCkgeyByZXR1cm4gISFyKGUsIG4sIHQpOyB9LCBtZXRhZGF0YTogZnVuY3Rpb24gKGUsIG4pIHsgcmV0dXJuIGZ1bmN0aW9uICh0LCByKSB7IG8oZSwgbiwgdCwgcik7IH07IH0gfTtcbiAgICB3aW5kb3cuUmVmbGVjdCA9IHdpbmRvdy5SZWZsZWN0IHx8IHt9LCBPYmplY3QuYXNzaWduKHdpbmRvdy5SZWZsZWN0LCBzKSwgZnVuY3Rpb24gKGUpIHsgZVtlLlRyYW5zaWVudCA9IDBdID0gXCJUcmFuc2llbnRcIiwgZVtlLlNpbmdsZXRvbiA9IDFdID0gXCJTaW5nbGV0b25cIiwgZVtlLlJlc29sdXRpb25TY29wZWQgPSAyXSA9IFwiUmVzb2x1dGlvblNjb3BlZFwiLCBlW2UuQ29udGFpbmVyU2NvcGVkID0gM10gPSBcIkNvbnRhaW5lclNjb3BlZFwiOyB9KGEgfHwgKGEgPSB7fSkpO1xuICAgIHZhciBjID0gYSwgbCA9IGZ1bmN0aW9uIChlLCBuKSB7IHJldHVybiBsID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8IHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGUsIG4pIHsgZS5fX3Byb3RvX18gPSBuOyB9IHx8IGZ1bmN0aW9uIChlLCBuKSB7IGZvciAodmFyIHQgaW4gbilcbiAgICAgICAgbi5oYXNPd25Qcm9wZXJ0eSh0KSAmJiAoZVt0XSA9IG5bdF0pOyB9LCBsKGUsIG4pOyB9O1xuICAgIGZ1bmN0aW9uIHUoZSwgbikgeyBmdW5jdGlvbiB0KCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZTsgfSBsKGUsIG4pLCBlLnByb3RvdHlwZSA9IG51bGwgPT09IG4gPyBPYmplY3QuY3JlYXRlKG4pIDogKHQucHJvdG90eXBlID0gbi5wcm90b3R5cGUsIG5ldyB0KTsgfVxuICAgIGZ1bmN0aW9uIGQoZSkgeyB2YXIgbiA9IFwiZnVuY3Rpb25cIiA9PSB0eXBlb2YgU3ltYm9sICYmIFN5bWJvbC5pdGVyYXRvciwgdCA9IG4gJiYgZVtuXSwgciA9IDA7IGlmICh0KVxuICAgICAgICByZXR1cm4gdC5jYWxsKGUpOyBpZiAoZSAmJiBcIm51bWJlclwiID09IHR5cGVvZiBlLmxlbmd0aClcbiAgICAgICAgcmV0dXJuIHsgbmV4dDogZnVuY3Rpb24gKCkgeyByZXR1cm4gZSAmJiByID49IGUubGVuZ3RoICYmIChlID0gdm9pZCAwKSwgeyB2YWx1ZTogZSAmJiBlW3IrK10sIGRvbmU6ICFlIH07IH0gfTsgdGhyb3cgbmV3IFR5cGVFcnJvcihuID8gXCJPYmplY3QgaXMgbm90IGl0ZXJhYmxlLlwiIDogXCJTeW1ib2wuaXRlcmF0b3IgaXMgbm90IGRlZmluZWQuXCIpOyB9XG4gICAgZnVuY3Rpb24gcChlLCBuKSB7IHZhciB0ID0gXCJmdW5jdGlvblwiID09IHR5cGVvZiBTeW1ib2wgJiYgZVtTeW1ib2wuaXRlcmF0b3JdOyBpZiAoIXQpXG4gICAgICAgIHJldHVybiBlOyB2YXIgciwgbywgaSA9IHQuY2FsbChlKSwgYSA9IFtdOyB0cnkge1xuICAgICAgICBmb3IgKDsgKHZvaWQgMCA9PT0gbiB8fCBuLS0gPiAwKSAmJiAhKHIgPSBpLm5leHQoKSkuZG9uZTspXG4gICAgICAgICAgICBhLnB1c2goci52YWx1ZSk7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIG8gPSB7IGVycm9yOiBlIH07XG4gICAgfVxuICAgIGZpbmFsbHkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgciAmJiAhci5kb25lICYmICh0ID0gaS5yZXR1cm4pICYmIHQuY2FsbChpKTtcbiAgICAgICAgfVxuICAgICAgICBmaW5hbGx5IHtcbiAgICAgICAgICAgIGlmIChvKVxuICAgICAgICAgICAgICAgIHRocm93IG8uZXJyb3I7XG4gICAgICAgIH1cbiAgICB9IHJldHVybiBhOyB9XG4gICAgZnVuY3Rpb24gZigpIHsgZm9yICh2YXIgZSA9IFtdLCBuID0gMDsgbiA8IGFyZ3VtZW50cy5sZW5ndGg7IG4rKylcbiAgICAgICAgZSA9IGUuY29uY2F0KHAoYXJndW1lbnRzW25dKSk7IHJldHVybiBlOyB9XG4gICAgdmFyIG0gPSBcImluamVjdGlvblRva2Vuc1wiO1xuICAgIGZ1bmN0aW9uIGcoZSkgeyByZXR1cm4gISFlLnVzZUNsYXNzOyB9XG4gICAgZnVuY3Rpb24gdihlKSB7IHJldHVybiAhIWUudXNlRmFjdG9yeTsgfVxuICAgIHZhciBoID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiBlKGUpIHsgdGhpcy53cmFwID0gZSwgdGhpcy5yZWZsZWN0TWV0aG9kcyA9IFtcImdldFwiLCBcImdldFByb3RvdHlwZU9mXCIsIFwic2V0UHJvdG90eXBlT2ZcIiwgXCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JcIiwgXCJkZWZpbmVQcm9wZXJ0eVwiLCBcImhhc1wiLCBcInNldFwiLCBcImRlbGV0ZVByb3BlcnR5XCIsIFwiYXBwbHlcIiwgXCJjb25zdHJ1Y3RcIiwgXCJvd25LZXlzXCJdOyB9IHJldHVybiBlLnByb3RvdHlwZS5jcmVhdGVQcm94eSA9IGZ1bmN0aW9uIChlKSB7IHZhciBuLCB0ID0gdGhpcywgciA9ICExOyByZXR1cm4gbmV3IFByb3h5KHt9LCB0aGlzLmNyZWF0ZUhhbmRsZXIoKGZ1bmN0aW9uICgpIHsgcmV0dXJuIHIgfHwgKG4gPSBlKHQud3JhcCgpKSwgciA9ICEwKSwgbjsgfSkpKTsgfSwgZS5wcm90b3R5cGUuY3JlYXRlSGFuZGxlciA9IGZ1bmN0aW9uIChlKSB7IHZhciBuID0ge307IHJldHVybiB0aGlzLnJlZmxlY3RNZXRob2RzLmZvckVhY2goKGZ1bmN0aW9uICh0KSB7IG5bdF0gPSBmdW5jdGlvbiAoKSB7IGZvciAodmFyIG4gPSBbXSwgciA9IDA7IHIgPCBhcmd1bWVudHMubGVuZ3RoOyByKyspXG4gICAgICAgIG5bcl0gPSBhcmd1bWVudHNbcl07IG5bMF0gPSBlKCk7IHZhciBvID0gUmVmbGVjdFt0XTsgcmV0dXJuIG8uYXBwbHkodm9pZCAwLCBmKG4pKTsgfTsgfSkpLCBuOyB9LCBlOyB9KCk7XG4gICAgZnVuY3Rpb24gdyhlKSB7IHJldHVybiBcInN0cmluZ1wiID09IHR5cGVvZiBlIHx8IFwic3ltYm9sXCIgPT0gdHlwZW9mIGU7IH1cbiAgICBmdW5jdGlvbiB5KGUpIHsgcmV0dXJuIFwib2JqZWN0XCIgPT0gdHlwZW9mIGUgJiYgXCJ0b2tlblwiIGluIGUgJiYgXCJ0cmFuc2Zvcm1cIiBpbiBlOyB9XG4gICAgZnVuY3Rpb24gYihlKSB7IHJldHVybiAhIWUudXNlVG9rZW47IH1cbiAgICBmdW5jdGlvbiBrKGUpIHsgcmV0dXJuIG51bGwgIT0gZS51c2VWYWx1ZTsgfVxuICAgIHZhciBfID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiBlKCkgeyB0aGlzLl9yZWdpc3RyeU1hcCA9IG5ldyBNYXA7IH0gcmV0dXJuIGUucHJvdG90eXBlLmVudHJpZXMgPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLl9yZWdpc3RyeU1hcC5lbnRyaWVzKCk7IH0sIGUucHJvdG90eXBlLmdldEFsbCA9IGZ1bmN0aW9uIChlKSB7IHJldHVybiB0aGlzLmVuc3VyZShlKSwgdGhpcy5fcmVnaXN0cnlNYXAuZ2V0KGUpOyB9LCBlLnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbiAoZSkgeyB0aGlzLmVuc3VyZShlKTsgdmFyIG4gPSB0aGlzLl9yZWdpc3RyeU1hcC5nZXQoZSk7IHJldHVybiBuW24ubGVuZ3RoIC0gMV0gfHwgbnVsbDsgfSwgZS5wcm90b3R5cGUuc2V0ID0gZnVuY3Rpb24gKGUsIG4pIHsgdGhpcy5lbnN1cmUoZSksIHRoaXMuX3JlZ2lzdHJ5TWFwLmdldChlKS5wdXNoKG4pOyB9LCBlLnByb3RvdHlwZS5zZXRBbGwgPSBmdW5jdGlvbiAoZSwgbikgeyB0aGlzLl9yZWdpc3RyeU1hcC5zZXQoZSwgbik7IH0sIGUucHJvdG90eXBlLmhhcyA9IGZ1bmN0aW9uIChlKSB7IHJldHVybiB0aGlzLmVuc3VyZShlKSwgdGhpcy5fcmVnaXN0cnlNYXAuZ2V0KGUpLmxlbmd0aCA+IDA7IH0sIGUucHJvdG90eXBlLmNsZWFyID0gZnVuY3Rpb24gKCkgeyB0aGlzLl9yZWdpc3RyeU1hcC5jbGVhcigpOyB9LCBlLnByb3RvdHlwZS5lbnN1cmUgPSBmdW5jdGlvbiAoZSkgeyB0aGlzLl9yZWdpc3RyeU1hcC5oYXMoZSkgfHwgdGhpcy5fcmVnaXN0cnlNYXAuc2V0KGUsIFtdKTsgfSwgZTsgfSgpLCBDID0gZnVuY3Rpb24gKGUpIHsgZnVuY3Rpb24gbigpIHsgcmV0dXJuIG51bGwgIT09IGUgJiYgZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7IH0gcmV0dXJuIHUobiwgZSksIG47IH0oXyksIEkgPSBmdW5jdGlvbiAoKSB7IHRoaXMuc2NvcGVkUmVzb2x1dGlvbnMgPSBuZXcgTWFwOyB9O1xuICAgIGZ1bmN0aW9uIFMoZSwgbiwgdCkgeyB2YXIgciwgbywgaSA9IHAoZS50b1N0cmluZygpLm1hdGNoKC9jb25zdHJ1Y3RvclxcKChbXFx3LCBdKylcXCkvKSB8fCBbXSwgMilbMV0sIGEgPSBmdW5jdGlvbiAoZSwgbikgeyByZXR1cm4gbnVsbCA9PT0gZSA/IFwiYXQgcG9zaXRpb24gI1wiICsgbiA6ICdcIicgKyBlLnNwbGl0KFwiLFwiKVtuXS50cmltKCkgKyAnXCIgYXQgcG9zaXRpb24gIycgKyBuOyB9KHZvaWQgMCA9PT0gaSA/IG51bGwgOiBpLCBuKTsgcmV0dXJuIHIgPSBcIkNhbm5vdCBpbmplY3QgdGhlIGRlcGVuZGVuY3kgXCIgKyBhICsgJyBvZiBcIicgKyBlLm5hbWUgKyAnXCIgY29uc3RydWN0b3IuIFJlYXNvbjonLCB2b2lkIDAgPT09IG8gJiYgKG8gPSBcIiAgICBcIiksIGYoW3JdLCB0Lm1lc3NhZ2Uuc3BsaXQoXCJcXG5cIikubWFwKChmdW5jdGlvbiAoZSkgeyByZXR1cm4gbyArIGU7IH0pKSkuam9pbihcIlxcblwiKTsgfVxuICAgIHZhciB4ID0gZnVuY3Rpb24gKGUpIHsgZnVuY3Rpb24gbigpIHsgcmV0dXJuIG51bGwgIT09IGUgJiYgZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7IH0gcmV0dXJuIHUobiwgZSksIG47IH0oXyksIFAgPSBmdW5jdGlvbiAoZSkgeyBmdW5jdGlvbiBuKCkgeyByZXR1cm4gbnVsbCAhPT0gZSAmJiBlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpczsgfSByZXR1cm4gdShuLCBlKSwgbjsgfShfKSwgRSA9IGZ1bmN0aW9uICgpIHsgdGhpcy5wcmVSZXNvbHV0aW9uID0gbmV3IHgsIHRoaXMucG9zdFJlc29sdXRpb24gPSBuZXcgUDsgfSwgVCA9IG5ldyBNYXAsIEEgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGUoZSkgeyB0aGlzLnBhcmVudCA9IGUsIHRoaXMuX3JlZ2lzdHJ5ID0gbmV3IEMsIHRoaXMuaW50ZXJjZXB0b3JzID0gbmV3IEU7IH0gcmV0dXJuIGUucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIG4sIHQpIHsgdmFyIHI7IGlmICh2b2lkIDAgPT09IHQgJiYgKHQgPSB7IGxpZmVjeWNsZTogYy5UcmFuc2llbnQgfSksIHIgPSBmdW5jdGlvbiAoZSkgeyByZXR1cm4gZyhlKSB8fCBrKGUpIHx8IGIoZSkgfHwgdihlKTsgfShuKSA/IG4gOiB7IHVzZUNsYXNzOiBuIH0sIGIocikpXG4gICAgICAgIGZvciAodmFyIG8gPSBbZV0sIGkgPSByOyBudWxsICE9IGk7KSB7XG4gICAgICAgICAgICB2YXIgYSA9IGkudXNlVG9rZW47XG4gICAgICAgICAgICBpZiAoby5pbmNsdWRlcyhhKSlcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJUb2tlbiByZWdpc3RyYXRpb24gY3ljbGUgZGV0ZWN0ZWQhIFwiICsgZihvLCBbYV0pLmpvaW4oXCIgLT4gXCIpKTtcbiAgICAgICAgICAgIG8ucHVzaChhKTtcbiAgICAgICAgICAgIHZhciBzID0gdGhpcy5fcmVnaXN0cnkuZ2V0KGEpO1xuICAgICAgICAgICAgaSA9IHMgJiYgYihzLnByb3ZpZGVyKSA/IHMucHJvdmlkZXIgOiBudWxsO1xuICAgICAgICB9IGlmICgodC5saWZlY3ljbGUgPT09IGMuU2luZ2xldG9uIHx8IHQubGlmZWN5Y2xlID09IGMuQ29udGFpbmVyU2NvcGVkIHx8IHQubGlmZWN5Y2xlID09IGMuUmVzb2x1dGlvblNjb3BlZCkgJiYgKGsocikgfHwgdihyKSkpXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignQ2Fubm90IHVzZSBsaWZlY3ljbGUgXCInICsgY1t0LmxpZmVjeWNsZV0gKyAnXCIgd2l0aCBWYWx1ZVByb3ZpZGVycyBvciBGYWN0b3J5UHJvdmlkZXJzJyk7IHJldHVybiB0aGlzLl9yZWdpc3RyeS5zZXQoZSwgeyBwcm92aWRlcjogciwgb3B0aW9uczogdCB9KSwgdGhpczsgfSwgZS5wcm90b3R5cGUucmVnaXN0ZXJUeXBlID0gZnVuY3Rpb24gKGUsIG4pIHsgcmV0dXJuIHcobikgPyB0aGlzLnJlZ2lzdGVyKGUsIHsgdXNlVG9rZW46IG4gfSkgOiB0aGlzLnJlZ2lzdGVyKGUsIHsgdXNlQ2xhc3M6IG4gfSk7IH0sIGUucHJvdG90eXBlLnJlZ2lzdGVySW5zdGFuY2UgPSBmdW5jdGlvbiAoZSwgbikgeyByZXR1cm4gdGhpcy5yZWdpc3RlcihlLCB7IHVzZVZhbHVlOiBuIH0pOyB9LCBlLnByb3RvdHlwZS5yZWdpc3RlclNpbmdsZXRvbiA9IGZ1bmN0aW9uIChlLCBuKSB7IGlmICh3KGUpKSB7XG4gICAgICAgIGlmICh3KG4pKVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVnaXN0ZXIoZSwgeyB1c2VUb2tlbjogbiB9LCB7IGxpZmVjeWNsZTogYy5TaW5nbGV0b24gfSk7XG4gICAgICAgIGlmIChuKVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVnaXN0ZXIoZSwgeyB1c2VDbGFzczogbiB9LCB7IGxpZmVjeWNsZTogYy5TaW5nbGV0b24gfSk7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignQ2Fubm90IHJlZ2lzdGVyIGEgdHlwZSBuYW1lIGFzIGEgc2luZ2xldG9uIHdpdGhvdXQgYSBcInRvXCIgdG9rZW4nKTtcbiAgICB9IHZhciB0ID0gZTsgcmV0dXJuIG4gJiYgIXcobikgJiYgKHQgPSBuKSwgdGhpcy5yZWdpc3RlcihlLCB7IHVzZUNsYXNzOiB0IH0sIHsgbGlmZWN5Y2xlOiBjLlNpbmdsZXRvbiB9KTsgfSwgZS5wcm90b3R5cGUucmVzb2x2ZSA9IGZ1bmN0aW9uIChlLCBuKSB7IHZvaWQgMCA9PT0gbiAmJiAobiA9IG5ldyBJKTsgdmFyIHQgPSB0aGlzLmdldFJlZ2lzdHJhdGlvbihlKTsgaWYgKCF0ICYmIHcoZSkpXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignQXR0ZW1wdGVkIHRvIHJlc29sdmUgdW5yZWdpc3RlcmVkIGRlcGVuZGVuY3kgdG9rZW46IFwiJyArIGUudG9TdHJpbmcoKSArICdcIicpOyBpZiAodGhpcy5leGVjdXRlUHJlUmVzb2x1dGlvbkludGVyY2VwdG9yKGUsIFwiU2luZ2xlXCIpLCB0KSB7XG4gICAgICAgIHZhciByID0gdGhpcy5yZXNvbHZlUmVnaXN0cmF0aW9uKHQsIG4pO1xuICAgICAgICByZXR1cm4gdGhpcy5leGVjdXRlUG9zdFJlc29sdXRpb25JbnRlcmNlcHRvcihlLCByLCBcIlNpbmdsZVwiKSwgcjtcbiAgICB9IGlmIChmdW5jdGlvbiAoZSkgeyByZXR1cm4gXCJmdW5jdGlvblwiID09IHR5cGVvZiBlIHx8IGUgaW5zdGFuY2VvZiBoOyB9KGUpKSB7XG4gICAgICAgIHIgPSB0aGlzLmNvbnN0cnVjdChlLCBuKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuZXhlY3V0ZVBvc3RSZXNvbHV0aW9uSW50ZXJjZXB0b3IoZSwgciwgXCJTaW5nbGVcIiksIHI7XG4gICAgfSB0aHJvdyBuZXcgRXJyb3IoXCJBdHRlbXB0ZWQgdG8gY29uc3RydWN0IGFuIHVuZGVmaW5lZCBjb25zdHJ1Y3Rvci4gQ291bGQgbWVhbiBhIGNpcmN1bGFyIGRlcGVuZGVuY3kgcHJvYmxlbS4gVHJ5IHVzaW5nIGBkZWxheWAgZnVuY3Rpb24uXCIpOyB9LCBlLnByb3RvdHlwZS5leGVjdXRlUHJlUmVzb2x1dGlvbkludGVyY2VwdG9yID0gZnVuY3Rpb24gKGUsIG4pIHsgdmFyIHQsIHI7IGlmICh0aGlzLmludGVyY2VwdG9ycy5wcmVSZXNvbHV0aW9uLmhhcyhlKSkge1xuICAgICAgICB2YXIgbyA9IFtdO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IGQodGhpcy5pbnRlcmNlcHRvcnMucHJlUmVzb2x1dGlvbi5nZXRBbGwoZSkpLCBhID0gaS5uZXh0KCk7ICFhLmRvbmU7IGEgPSBpLm5leHQoKSkge1xuICAgICAgICAgICAgICAgIHZhciBzID0gYS52YWx1ZTtcbiAgICAgICAgICAgICAgICBcIk9uY2VcIiAhPSBzLm9wdGlvbnMuZnJlcXVlbmN5ICYmIG8ucHVzaChzKSwgcy5jYWxsYmFjayhlLCBuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgdCA9IHsgZXJyb3I6IGUgfTtcbiAgICAgICAgfVxuICAgICAgICBmaW5hbGx5IHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgYSAmJiAhYS5kb25lICYmIChyID0gaS5yZXR1cm4pICYmIHIuY2FsbChpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZpbmFsbHkge1xuICAgICAgICAgICAgICAgIGlmICh0KVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyB0LmVycm9yO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuaW50ZXJjZXB0b3JzLnByZVJlc29sdXRpb24uc2V0QWxsKGUsIG8pO1xuICAgIH0gfSwgZS5wcm90b3R5cGUuZXhlY3V0ZVBvc3RSZXNvbHV0aW9uSW50ZXJjZXB0b3IgPSBmdW5jdGlvbiAoZSwgbiwgdCkgeyB2YXIgciwgbzsgaWYgKHRoaXMuaW50ZXJjZXB0b3JzLnBvc3RSZXNvbHV0aW9uLmhhcyhlKSkge1xuICAgICAgICB2YXIgaSA9IFtdO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgZm9yICh2YXIgYSA9IGQodGhpcy5pbnRlcmNlcHRvcnMucG9zdFJlc29sdXRpb24uZ2V0QWxsKGUpKSwgcyA9IGEubmV4dCgpOyAhcy5kb25lOyBzID0gYS5uZXh0KCkpIHtcbiAgICAgICAgICAgICAgICB2YXIgYyA9IHMudmFsdWU7XG4gICAgICAgICAgICAgICAgXCJPbmNlXCIgIT0gYy5vcHRpb25zLmZyZXF1ZW5jeSAmJiBpLnB1c2goYyksIGMuY2FsbGJhY2soZSwgbiwgdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHIgPSB7IGVycm9yOiBlIH07XG4gICAgICAgIH1cbiAgICAgICAgZmluYWxseSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHMgJiYgIXMuZG9uZSAmJiAobyA9IGEucmV0dXJuKSAmJiBvLmNhbGwoYSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmaW5hbGx5IHtcbiAgICAgICAgICAgICAgICBpZiAocilcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgci5lcnJvcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLmludGVyY2VwdG9ycy5wb3N0UmVzb2x1dGlvbi5zZXRBbGwoZSwgaSk7XG4gICAgfSB9LCBlLnByb3RvdHlwZS5yZXNvbHZlUmVnaXN0cmF0aW9uID0gZnVuY3Rpb24gKGUsIG4pIHsgaWYgKGUub3B0aW9ucy5saWZlY3ljbGUgPT09IGMuUmVzb2x1dGlvblNjb3BlZCAmJiBuLnNjb3BlZFJlc29sdXRpb25zLmhhcyhlKSlcbiAgICAgICAgcmV0dXJuIG4uc2NvcGVkUmVzb2x1dGlvbnMuZ2V0KGUpOyB2YXIgdCwgciA9IGUub3B0aW9ucy5saWZlY3ljbGUgPT09IGMuU2luZ2xldG9uLCBvID0gZS5vcHRpb25zLmxpZmVjeWNsZSA9PT0gYy5Db250YWluZXJTY29wZWQsIGkgPSByIHx8IG87IHJldHVybiB0ID0gayhlLnByb3ZpZGVyKSA/IGUucHJvdmlkZXIudXNlVmFsdWUgOiBiKGUucHJvdmlkZXIpID8gaSA/IGUuaW5zdGFuY2UgfHwgKGUuaW5zdGFuY2UgPSB0aGlzLnJlc29sdmUoZS5wcm92aWRlci51c2VUb2tlbiwgbikpIDogdGhpcy5yZXNvbHZlKGUucHJvdmlkZXIudXNlVG9rZW4sIG4pIDogZyhlLnByb3ZpZGVyKSA/IGkgPyBlLmluc3RhbmNlIHx8IChlLmluc3RhbmNlID0gdGhpcy5jb25zdHJ1Y3QoZS5wcm92aWRlci51c2VDbGFzcywgbikpIDogdGhpcy5jb25zdHJ1Y3QoZS5wcm92aWRlci51c2VDbGFzcywgbikgOiB2KGUucHJvdmlkZXIpID8gZS5wcm92aWRlci51c2VGYWN0b3J5KHRoaXMpIDogdGhpcy5jb25zdHJ1Y3QoZS5wcm92aWRlciwgbiksIGUub3B0aW9ucy5saWZlY3ljbGUgPT09IGMuUmVzb2x1dGlvblNjb3BlZCAmJiBuLnNjb3BlZFJlc29sdXRpb25zLnNldChlLCB0KSwgdDsgfSwgZS5wcm90b3R5cGUucmVzb2x2ZUFsbCA9IGZ1bmN0aW9uIChlLCBuKSB7IHZhciB0ID0gdGhpczsgdm9pZCAwID09PSBuICYmIChuID0gbmV3IEkpOyB2YXIgciA9IHRoaXMuZ2V0QWxsUmVnaXN0cmF0aW9ucyhlKTsgaWYgKCFyICYmIHcoZSkpXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignQXR0ZW1wdGVkIHRvIHJlc29sdmUgdW5yZWdpc3RlcmVkIGRlcGVuZGVuY3kgdG9rZW46IFwiJyArIGUudG9TdHJpbmcoKSArICdcIicpOyBpZiAodGhpcy5leGVjdXRlUHJlUmVzb2x1dGlvbkludGVyY2VwdG9yKGUsIFwiQWxsXCIpLCByKSB7XG4gICAgICAgIHZhciBvID0gci5tYXAoKGZ1bmN0aW9uIChlKSB7IHJldHVybiB0LnJlc29sdmVSZWdpc3RyYXRpb24oZSwgbik7IH0pKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuZXhlY3V0ZVBvc3RSZXNvbHV0aW9uSW50ZXJjZXB0b3IoZSwgbywgXCJBbGxcIiksIG87XG4gICAgfSB2YXIgaSA9IFt0aGlzLmNvbnN0cnVjdChlLCBuKV07IHJldHVybiB0aGlzLmV4ZWN1dGVQb3N0UmVzb2x1dGlvbkludGVyY2VwdG9yKGUsIGksIFwiQWxsXCIpLCBpOyB9LCBlLnByb3RvdHlwZS5pc1JlZ2lzdGVyZWQgPSBmdW5jdGlvbiAoZSwgbikgeyByZXR1cm4gdm9pZCAwID09PSBuICYmIChuID0gITEpLCB0aGlzLl9yZWdpc3RyeS5oYXMoZSkgfHwgbiAmJiAodGhpcy5wYXJlbnQgfHwgITEpICYmIHRoaXMucGFyZW50LmlzUmVnaXN0ZXJlZChlLCAhMCk7IH0sIGUucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24gKCkgeyB0aGlzLl9yZWdpc3RyeS5jbGVhcigpLCB0aGlzLmludGVyY2VwdG9ycy5wcmVSZXNvbHV0aW9uLmNsZWFyKCksIHRoaXMuaW50ZXJjZXB0b3JzLnBvc3RSZXNvbHV0aW9uLmNsZWFyKCk7IH0sIGUucHJvdG90eXBlLmNsZWFySW5zdGFuY2VzID0gZnVuY3Rpb24gKCkgeyB2YXIgZSwgbjsgdHJ5IHtcbiAgICAgICAgZm9yICh2YXIgdCA9IGQodGhpcy5fcmVnaXN0cnkuZW50cmllcygpKSwgciA9IHQubmV4dCgpOyAhci5kb25lOyByID0gdC5uZXh0KCkpIHtcbiAgICAgICAgICAgIHZhciBvID0gcChyLnZhbHVlLCAyKSwgaSA9IG9bMF0sIGEgPSBvWzFdO1xuICAgICAgICAgICAgdGhpcy5fcmVnaXN0cnkuc2V0QWxsKGksIGEuZmlsdGVyKChmdW5jdGlvbiAoZSkgeyByZXR1cm4gIWsoZS5wcm92aWRlcik7IH0pKS5tYXAoKGZ1bmN0aW9uIChlKSB7IHJldHVybiBlLmluc3RhbmNlID0gdm9pZCAwLCBlOyB9KSkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNhdGNoIChuKSB7XG4gICAgICAgIGUgPSB7IGVycm9yOiBuIH07XG4gICAgfVxuICAgIGZpbmFsbHkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgciAmJiAhci5kb25lICYmIChuID0gdC5yZXR1cm4pICYmIG4uY2FsbCh0KTtcbiAgICAgICAgfVxuICAgICAgICBmaW5hbGx5IHtcbiAgICAgICAgICAgIGlmIChlKVxuICAgICAgICAgICAgICAgIHRocm93IGUuZXJyb3I7XG4gICAgICAgIH1cbiAgICB9IH0sIGUucHJvdG90eXBlLmNyZWF0ZUNoaWxkQ29udGFpbmVyID0gZnVuY3Rpb24gKCkgeyB2YXIgbiwgdCwgciA9IG5ldyBlKHRoaXMpOyB0cnkge1xuICAgICAgICBmb3IgKHZhciBvID0gZCh0aGlzLl9yZWdpc3RyeS5lbnRyaWVzKCkpLCBpID0gby5uZXh0KCk7ICFpLmRvbmU7IGkgPSBvLm5leHQoKSkge1xuICAgICAgICAgICAgdmFyIGEgPSBwKGkudmFsdWUsIDIpLCBzID0gYVswXSwgbCA9IGFbMV07XG4gICAgICAgICAgICBsLnNvbWUoKGZ1bmN0aW9uIChlKSB7IHJldHVybiBlLm9wdGlvbnMubGlmZWN5Y2xlID09PSBjLkNvbnRhaW5lclNjb3BlZDsgfSkpICYmIHIuX3JlZ2lzdHJ5LnNldEFsbChzLCBsLm1hcCgoZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGUub3B0aW9ucy5saWZlY3ljbGUgPT09IGMuQ29udGFpbmVyU2NvcGVkID8geyBwcm92aWRlcjogZS5wcm92aWRlciwgb3B0aW9uczogZS5vcHRpb25zIH0gOiBlOyB9KSkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIG4gPSB7IGVycm9yOiBlIH07XG4gICAgfVxuICAgIGZpbmFsbHkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgaSAmJiAhaS5kb25lICYmICh0ID0gby5yZXR1cm4pICYmIHQuY2FsbChvKTtcbiAgICAgICAgfVxuICAgICAgICBmaW5hbGx5IHtcbiAgICAgICAgICAgIGlmIChuKVxuICAgICAgICAgICAgICAgIHRocm93IG4uZXJyb3I7XG4gICAgICAgIH1cbiAgICB9IHJldHVybiByOyB9LCBlLnByb3RvdHlwZS5iZWZvcmVSZXNvbHV0aW9uID0gZnVuY3Rpb24gKGUsIG4sIHQpIHsgdm9pZCAwID09PSB0ICYmICh0ID0geyBmcmVxdWVuY3k6IFwiQWx3YXlzXCIgfSksIHRoaXMuaW50ZXJjZXB0b3JzLnByZVJlc29sdXRpb24uc2V0KGUsIHsgY2FsbGJhY2s6IG4sIG9wdGlvbnM6IHQgfSk7IH0sIGUucHJvdG90eXBlLmFmdGVyUmVzb2x1dGlvbiA9IGZ1bmN0aW9uIChlLCBuLCB0KSB7IHZvaWQgMCA9PT0gdCAmJiAodCA9IHsgZnJlcXVlbmN5OiBcIkFsd2F5c1wiIH0pLCB0aGlzLmludGVyY2VwdG9ycy5wb3N0UmVzb2x1dGlvbi5zZXQoZSwgeyBjYWxsYmFjazogbiwgb3B0aW9uczogdCB9KTsgfSwgZS5wcm90b3R5cGUuZ2V0UmVnaXN0cmF0aW9uID0gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIHRoaXMuaXNSZWdpc3RlcmVkKGUpID8gdGhpcy5fcmVnaXN0cnkuZ2V0KGUpIDogdGhpcy5wYXJlbnQgPyB0aGlzLnBhcmVudC5nZXRSZWdpc3RyYXRpb24oZSkgOiBudWxsOyB9LCBlLnByb3RvdHlwZS5nZXRBbGxSZWdpc3RyYXRpb25zID0gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIHRoaXMuaXNSZWdpc3RlcmVkKGUpID8gdGhpcy5fcmVnaXN0cnkuZ2V0QWxsKGUpIDogdGhpcy5wYXJlbnQgPyB0aGlzLnBhcmVudC5nZXRBbGxSZWdpc3RyYXRpb25zKGUpIDogbnVsbDsgfSwgZS5wcm90b3R5cGUuY29uc3RydWN0ID0gZnVuY3Rpb24gKGUsIG4pIHsgdmFyIHQgPSB0aGlzOyBpZiAoZSBpbnN0YW5jZW9mIGgpXG4gICAgICAgIHJldHVybiBlLmNyZWF0ZVByb3h5KChmdW5jdGlvbiAoZSkgeyByZXR1cm4gdC5yZXNvbHZlKGUsIG4pOyB9KSk7IHZhciByID0gVC5nZXQoZSk7IGlmICghciB8fCAwID09PSByLmxlbmd0aCkge1xuICAgICAgICBpZiAoMCA9PT0gZS5sZW5ndGgpXG4gICAgICAgICAgICByZXR1cm4gbmV3IGU7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignVHlwZUluZm8gbm90IGtub3duIGZvciBcIicgKyBlLm5hbWUgKyAnXCInKTtcbiAgICB9IHZhciBvID0gci5tYXAodGhpcy5yZXNvbHZlUGFyYW1zKG4sIGUpKTsgcmV0dXJuIG5ldyAoZS5iaW5kLmFwcGx5KGUsIGYoW3ZvaWQgMF0sIG8pKSk7IH0sIGUucHJvdG90eXBlLnJlc29sdmVQYXJhbXMgPSBmdW5jdGlvbiAoZSwgbikgeyB2YXIgdCA9IHRoaXM7IHJldHVybiBmdW5jdGlvbiAociwgbykgeyB2YXIgaSwgYSwgcywgYzsgdHJ5IHtcbiAgICAgICAgcmV0dXJuIFwib2JqZWN0XCIgPT0gdHlwZW9mIChjID0gcikgJiYgXCJ0b2tlblwiIGluIGMgJiYgXCJtdWx0aXBsZVwiIGluIGMgPyB5KHIpID8gci5tdWx0aXBsZSA/IChpID0gdC5yZXNvbHZlKHIudHJhbnNmb3JtKSkudHJhbnNmb3JtLmFwcGx5KGksIGYoW3QucmVzb2x2ZUFsbChyLnRva2VuKV0sIHIudHJhbnNmb3JtQXJncykpIDogKGEgPSB0LnJlc29sdmUoci50cmFuc2Zvcm0pKS50cmFuc2Zvcm0uYXBwbHkoYSwgZihbdC5yZXNvbHZlKHIudG9rZW4sIGUpXSwgci50cmFuc2Zvcm1BcmdzKSkgOiByLm11bHRpcGxlID8gdC5yZXNvbHZlQWxsKHIudG9rZW4pIDogdC5yZXNvbHZlKHIudG9rZW4sIGUpIDogeShyKSA/IChzID0gdC5yZXNvbHZlKHIudHJhbnNmb3JtLCBlKSkudHJhbnNmb3JtLmFwcGx5KHMsIGYoW3QucmVzb2x2ZShyLnRva2VuLCBlKV0sIHIudHJhbnNmb3JtQXJncykpIDogdC5yZXNvbHZlKHIsIGUpO1xuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoUyhuLCBvLCBlKSk7XG4gICAgfSB9OyB9LCBlOyB9KCksIE0gPSBuZXcgQTtcbiAgICBmdW5jdGlvbiBPKCkgeyByZXR1cm4gZnVuY3Rpb24gKGUpIHsgVC5zZXQoZSwgZnVuY3Rpb24gKGUpIHsgdmFyIG4gPSBSZWZsZWN0LmdldE1ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgZSkgfHwgW10sIHQgPSBSZWZsZWN0LmdldE93bk1ldGFkYXRhKG0sIGUpIHx8IHt9OyByZXR1cm4gT2JqZWN0LmtleXModCkuZm9yRWFjaCgoZnVuY3Rpb24gKGUpIHsgblsrZV0gPSB0W2VdOyB9KSksIG47IH0oZSkpOyB9OyB9XG4gICAgaWYgKFwidW5kZWZpbmVkXCIgPT0gdHlwZW9mIFJlZmxlY3QgfHwgIVJlZmxlY3QuZ2V0TWV0YWRhdGEpXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcInRzeXJpbmdlIHJlcXVpcmVzIGEgcmVmbGVjdCBwb2x5ZmlsbC4gUGxlYXNlIGFkZCAnaW1wb3J0IFxcXCJyZWZsZWN0LW1ldGFkYXRhXFxcIicgdG8gdGhlIHRvcCBvZiB5b3VyIGVudHJ5IHBvaW50LlwiKTtcbiAgICBpZiAod2luZG93LnBuSW5pdFBlcmZvcm1hbmNlID0gcGVyZm9ybWFuY2Uubm93KCksIHdpbmRvdy5wbkhhc1BvbHlmaWxsZWQgfHwgKHdpbmRvdy5wbkhhc1BvbHlmaWxsZWQgPSAhMSksIHdpbmRvdy5wbkZ1bGxUUFZlcnNpb24gfHwgKHdpbmRvdy5wbkZ1bGxUUFZlcnNpb24gPSAhMSksIHZvaWQgMCAhPT0gd2luZG93LnBuICYmIHZvaWQgMCAhPT0gd2luZG93LnBuLmNvbnRhaW5lcilcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiUGlhbm8gU0RLIGlzIGxvYWRlZCB0d2ljZSBvbiBzYW1lIHBhZ2UuIFRyeSB0byBmaXggdGhhdCB0byBwcmV2ZW50IHRoZSBtZXNzYWdlLlwiKTtcbiAgICBpZiAoIXdpbmRvdy5wbkZ1bGxUUFZlcnNpb24gJiYgXCJ1bmRlZmluZWRcIiAhPSB0eXBlb2YgUHJveHkpIHtcbiAgICAgICAgdmFyIFIgPSBmdW5jdGlvbiAoKSB7IHJldHVybiBMOyB9LCBMID0gbmV3IFByb3h5KHt9LCB7IGdldDogZnVuY3Rpb24gKGUsIG4sIHQpIHsgcmV0dXJuIFwiaXN2XCIgPT09IG4gfHwgUjsgfSwgYXBwbHk6IGZ1bmN0aW9uIChlLCBuLCB0KSB7IHJldHVybiBMOyB9IH0pO1xuICAgICAgICBNLnJlc29sdmUgPSBuZXcgUHJveHkoTS5yZXNvbHZlLCB7IGFwcGx5OiBmdW5jdGlvbiAoZSwgbiwgdCkgeyBpZiAoTS5pc1JlZ2lzdGVyZWQodFswXSkpXG4gICAgICAgICAgICAgICAgcmV0dXJuIFJlZmxlY3QuYXBwbHkoZSwgbiwgdCk7IE0ucmVnaXN0ZXIodFswXSwgeyB1c2VWYWx1ZTogTCB9KTsgdmFyIHIgPSBNLnJlc29sdmUodFswXSk7IHJldHVybiBVW3RbMF1dID0gciwgcjsgfSB9KTtcbiAgICB9XG4gICAgdmFyIE4gPSB3aW5kb3cucG4gfHwge30sIFUgPSB3aW5kb3cucG4gPSB7fTtcbiAgICBVLmNvbnRhaW5lciA9IE0sIFUuc2luZ2xldG9uID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gZnVuY3Rpb24gKGUpIHsgTygpKGUpLCBNLnJlZ2lzdGVyU2luZ2xldG9uKGUpOyB9OyB9LCBVLmluamVjdGFibGUgPSBPLCBVLmluamVjdCA9IGZ1bmN0aW9uIChlKSB7IHJldHVybiBuID0gZSwgZnVuY3Rpb24gKGUsIHIsIG8pIHsgdmFyIGkgPSBSZWZsZWN0LmdldE93bk1ldGFkYXRhKG0sIGUpIHx8IHt9OyBpW29dID0gdCA/IHsgdG9rZW46IG4sIHRyYW5zZm9ybTogdC50cmFuc2Zvcm1Ub2tlbiwgdHJhbnNmb3JtQXJnczogdC5hcmdzIHx8IFtdIH0gOiBuLCBSZWZsZWN0LmRlZmluZU1ldGFkYXRhKG0sIGksIGUpOyB9OyB2YXIgbiwgdDsgfSwgVS5yZWdpc3RyeSA9IGZ1bmN0aW9uIChlKSB7IHJldHVybiB2b2lkIDAgPT09IGUgJiYgKGUgPSBbXSksIGZ1bmN0aW9uIChuKSB7IHJldHVybiBlLmZvckVhY2goKGZ1bmN0aW9uIChlKSB7IHZhciBuID0gZS50b2tlbiwgdCA9IGUub3B0aW9ucywgciA9IGZ1bmN0aW9uIChlLCBuKSB7IHZhciB0ID0ge307IGZvciAodmFyIHIgaW4gZSlcbiAgICAgICAgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHIpICYmIG4uaW5kZXhPZihyKSA8IDAgJiYgKHRbcl0gPSBlW3JdKTsgaWYgKG51bGwgIT0gZSAmJiBcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHtcbiAgICAgICAgdmFyIG8gPSAwO1xuICAgICAgICBmb3IgKHIgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKGUpOyBvIDwgci5sZW5ndGg7IG8rKylcbiAgICAgICAgICAgIG4uaW5kZXhPZihyW29dKSA8IDAgJiYgT2JqZWN0LnByb3RvdHlwZS5wcm9wZXJ0eUlzRW51bWVyYWJsZS5jYWxsKGUsIHJbb10pICYmICh0W3Jbb11dID0gZVtyW29dXSk7XG4gICAgfSByZXR1cm4gdDsgfShlLCBbXCJ0b2tlblwiLCBcIm9wdGlvbnNcIl0pOyByZXR1cm4gTS5yZWdpc3RlcihuLCByLCB0KTsgfSkpLCBuOyB9OyB9LCBVLmluc3RhbmNlQ2FjaGluZ0ZhY3RvcnkgPSBmdW5jdGlvbiAoZSkgeyB2YXIgbjsgcmV0dXJuIGZ1bmN0aW9uICh0KSB7IHJldHVybiBudWxsID09IG4gJiYgKG4gPSBlKHQpKSwgbjsgfTsgfSwgVS5wcmVkZWZpbmVkT3B0aW9ucyA9IE4sIE0ucmVnaXN0ZXIoXCJwcmVkZWZpbmVkT3B0aW9uc1wiLCB7IHVzZVZhbHVlOiBOIH0pO1xuICAgIHZhciBqID0gITE7XG4gICAgdHJ5IHtcbiAgICAgICAgaWYgKCF3aW5kb3cucG5IYXNQb2x5ZmlsbGVkKSB7XG4gICAgICAgICAgICBpZiAoXCJ1bmRlZmluZWRcIiA9PSB0eXBlb2YgUHJveHkpXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVGhlIGJyb3dzZXIgY2Fubm90IFByb3h5XCIpO1xuICAgICAgICAgICAgaWYgKG5ldyBQcm9taXNlKChmdW5jdGlvbiAoZSkgeyB9KSksIE9iamVjdC5hc3NpZ24oe30sIHt9KSwgW1wiXCJdLmluY2x1ZGVzKFwiXCIpLCAhRWxlbWVudC5wcm90b3R5cGUuY2xvc2VzdClcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJUaGVyZSBpcyBubyBjbG9zZXN0IG1ldGhvZCBvZiBhIERPTSBlbGVtZW50XCIpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIGogPSAhMDtcbiAgICB9XG4gICAgaWYgKGopIHtcbiAgICAgICAgdmFyIEQgPSBmdW5jdGlvbiAoKSB7IHZhciBlLCBuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcInNjcmlwdFwiKTsgaWYgKG4ubGVuZ3RoKVxuICAgICAgICAgICAgZm9yICh2YXIgdCA9IDAsIHIgPSBuOyB0IDwgci5sZW5ndGg7IHQrKykge1xuICAgICAgICAgICAgICAgIHZhciBvID0gclt0XSwgaSA9IG51bGwgPT09IChlID0gbnVsbCA9PSBvID8gdm9pZCAwIDogby5zcmMpIHx8IHZvaWQgMCA9PT0gZSA/IHZvaWQgMCA6IGUubWF0Y2goL14uKj8odGlueXBhc3MuY29tfHBpYW5vLmlvKS9pKTtcbiAgICAgICAgICAgICAgICBpZiAoaSlcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlbMF07XG4gICAgICAgICAgICB9IHJldHVybiBcImh0dHBzOi8vc2FuZGJveC50aW55cGFzcy5jb21cIjsgfSgpO1xuICAgICAgICBkZWxldGUgd2luZG93LnBuO1xuICAgICAgICB2YXIgRiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzY3JpcHRcIik7XG4gICAgICAgIHRocm93IEYudHlwZSA9IFwidGV4dC9qYXZhc2NyaXB0XCIsIEYuYXN5bmMgPSAhMCwgRi5zcmMgPSBEICsgXCIvYXBpL3BpYW5vLmVzNS5qc1wiLCBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZShcImhlYWRcIilbMF0uYXBwZW5kQ2hpbGQoRiksIG5ldyBFcnJvcihcIkxvYWQgZnVsbCB2ZXJzaW9uIG9mIHBpYW5vIFNES1wiKTtcbiAgICB9XG4gICAgdmFyIEIsIFYgPSAoQiA9IGZ1bmN0aW9uIChlKSB7IHJldHVybiBuZXcgUHJvbWlzZSgoZnVuY3Rpb24gKG4sIHQpIHsgdmFyIHIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3R5bGVcIik7IHIudHlwZSA9IFwidGV4dC9jc3NcIiwgci5pbm5lckhUTUwgPSBlLCByLm9ubG9hZCA9IG4sIHIub25lcnJvciA9IHQsIGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiaGVhZFwiKVswXS5hcHBlbmRDaGlsZChyKTsgfSkpOyB9LCB7IG5hbWU6IFwiY3NzXCIsIGxvYWRPZmZlckNzczogZnVuY3Rpb24gKCkgeyBCKFwiLnRwLWJhY2tkcm9wIHtcXG4gICAgZGlzcGxheTogbm9uZTtcXG4gICAgcG9zaXRpb246IGZpeGVkO1xcbiAgICB0b3A6IDA7XFxuICAgIGxlZnQ6IDA7XFxuICAgIHJpZ2h0OiAwO1xcbiAgICBib3R0b206IDA7XFxuICAgIGJhY2tncm91bmQ6ICMxMjEyMTQ7XFxuICAgIHotaW5kZXg6IDMwMDAwMDtcXG4gICAgb3BhY2l0eTogMDtcXG4gICAgdHJhbnNpdGlvbjogb3BhY2l0eSAuMjVzIGxpbmVhcjtcXG59XFxuLnRwLWJhY2tkcm9wLnRwLWFjdGl2ZSB7XFxuICAgIG9wYWNpdHk6IC45O1xcbn1cXG4udHAtbW9kYWwgLnRwLWNsb3NlLnRwLXNxdWFyZSB7XFxuICAgIGJhY2tncm91bmQ6ICNjY2M7XFxuICAgIGJvcmRlci1yYWRpdXM6IDA7XFxuICAgIGJvcmRlcjogMDtcXG4gICAgdG9wOiAwO1xcbiAgICByaWdodDogLTQwcHg7XFxufVxcbi50cC1tb2RhbCAudHAtY2xvc2Uge1xcbiAgICBkaXNwbGF5OiBub25lO1xcbiAgICBwb3NpdGlvbjogYWJzb2x1dGU7XFxuICAgIHRvcDogLTIwcHg7XFxuICAgIHJpZ2h0OiAtMjBweDtcXG4gICAgd2lkdGg6IDQwcHg7XFxuICAgIGhlaWdodDogNDBweDtcXG4gICAgYmFja2dyb3VuZDogI2ZmZiB1cmwoXFxcImRhdGE6aW1hZ2Uvc3ZnK3htbCwlM0Nzdmcgd2lkdGg9JzExJyBoZWlnaHQ9JzExJyBmaWxsPSdub25lJyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnJTNFJTNDcGF0aCBmaWxsLXJ1bGU9J2V2ZW5vZGQnIGNsaXAtcnVsZT0nZXZlbm9kZCcgZD0nTTExIDEuMzY4TDkuNjMyIDAgNS41IDQuMTQyIDEuMzY4IDAgMCAxLjM2OCA0LjE0MiA1LjUgMCA5LjYzMiAxLjM2OCAxMSA1LjUgNi44NTggOS42MzIgMTEgMTEgOS42MzIgNi44NTggNS41IDExIDEuMzY4eicgZmlsbD0nJTIzOTU5NTk1Jy8lM0UlM0Mvc3ZnJTNFXFxcIikgY2VudGVyIGNlbnRlciBuby1yZXBlYXQ7XFxuICAgIGJvcmRlcjogbm9uZTtcXG4gICAgYm94LXNoYWRvdzogMCAwIDEwcHggMCByZ2JhKDI4LCAzNywgNjgsIDAuMTUpO1xcbiAgICBvdXRsaW5lOiBub25lO1xcbiAgICB6LWluZGV4OiAzMDAxMDA7XFxuICAgIGJvcmRlci1yYWRpdXM6IDQwcHg7XFxuICAgIG9wYWNpdHk6IDA7XFxuICAgIGN1cnNvcjogcG9pbnRlcjtcXG4gICAgdHJhbnNmb3JtOiBzY2FsZSguMjUsIC4yNSk7XFxuICAgIC13ZWJraXQtYXBwZWFyYW5jZTogbm9uZTtcXG4gICAgLW1vei1hcHBlYXJhbmNlOiBub25lO1xcbiAgICBhcHBlYXJhbmNlOiBub25lO1xcbn1cXG4udHAtbW9kYWwgLnRwLWNsb3NlOmhvdmVyLFxcbi50cC1tb2RhbCAudHAtY2xvc2U6Zm9jdXMge1xcbiAgICBib3gtc2hhZG93OiAwIDAgMTBweCAycHggcmdiYSgyOCwgMzcsIDY4LCAwLjE1KTtcXG59XFxuLnRwLW1vZGFsIC50cC1jbG9zZTpmb2N1cyB7XFxuICAgYm9yZGVyOiAxcHggc29saWQ7XFxufVxcbi50cC1tb2RhbCAudHAtY2xvc2UudHAtYWN0aXZlIHtcXG4gICAgZGlzcGxheTogYmxvY2s7XFxuICAgIG9wYWNpdHk6IDE7XFxuICAgIHRyYW5zZm9ybTogc2NhbGUoMSwgMSk7XFxufVxcbi50cC1tb2RhbCAudHAtaWZyYW1lLXdyYXBwZXJbZGlyPVxcXCJydGxcXFwiXSAudHAtY2xvc2Uge1xcbiAgcmlnaHQ6IGluaXRpYWw7XFxuICBsZWZ0OiAtMjBweDtcXG59XFxuXFxuLnRwLW1vZGFsIC50cC1pZnJhbWUtd3JhcHBlci5waWFuby1pZC1tb2RhbC12ZXItMiAudHAtY2xvc2Uge1xcbiAgdG9wOiAwO1xcbiAgcmlnaHQ6IDA7XFxuICB3aWR0aDogNjRweDtcXG4gIGhlaWdodDogNjRweDtcXG4gIGJveC1zaGFkb3c6IG5vbmU7XFxuICBvdXRsaW5lOiBub25lO1xcbiAgYm9yZGVyLXJhZGl1czogMDtcXG4gIGJvcmRlci1sZWZ0OiAxcHggc29saWQgcmdiYSgxNSwgMTUsIDIxLCAwLjIpO1xcbiAgYmFja2dyb3VuZDogdXJsKFxcXCJkYXRhOmltYWdlL3N2Zyt4bWwsJTNDc3ZnIHdpZHRoPScxNicgaGVpZ2h0PScxNicgdmlld0JveD0nMCAwIDE2IDE2JyBmaWxsPSdub25lJyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnJTNFJTNDZyAlM0UlM0NwYXRoIGQ9J00zIDNMMTMgMTNNMTMgM0wzIDEzJyBzdHJva2U9JyUyMzBGMEYxNScgc3Ryb2tlLXdpZHRoPScyJy8lM0UlM0MvZyUzRSUzQy9zdmclM0UlMEFcXFwiKSBjZW50ZXIgY2VudGVyIG5vLXJlcGVhdDtcXG4gIG9wYWNpdHk6IDAuMztcXG59XFxuXFxuLnRwLW1vZGFsIC50cC1pZnJhbWUtd3JhcHBlci5waWFuby1pZC1tb2RhbC12ZXItMiAudHAtY2xvc2UudHAtYWN0aXZlIHtcXG4gIG9wYWNpdHk6IDAuMztcXG59XFxuXFxuLnRwLW1vZGFsIC50cC1pZnJhbWUtd3JhcHBlci5waWFuby1pZC1tb2RhbC12ZXItMiAudHAtY2xvc2U6aG92ZXIsXFxuLnRwLW1vZGFsIC50cC1pZnJhbWUtd3JhcHBlci5waWFuby1pZC1tb2RhbC12ZXItMiAudHAtY2xvc2U6Zm9jdXMge1xcbiAgYm94LXNoYWRvdzogbm9uZTtcXG4gIGJvcmRlcjogbm9uZTtcXG4gIGJvcmRlci1sZWZ0OiAxcHggc29saWQgcmdiYSgxNSwgMTUsIDIxLCAwLjA2KTtcXG4gIG9wYWNpdHk6IDE7XFxufVxcblxcbi50cC1tb2RhbCAudHAtaWZyYW1lLXdyYXBwZXIucGlhbm8taWQtbW9kYWwtdmVyLTJbZGlyPVxcXCJydGxcXFwiXSAudHAtY2xvc2Uge1xcbiAgcmlnaHQ6IGF1dG87XFxuICBsZWZ0OiAwO1xcbiAgYm9yZGVyLWxlZnQ6IG5vbmU7XFxuICBib3JkZXItcmlnaHQ6IDFweCBzb2xpZCByZ2JhKDE1LCAxNSwgMjEsIDAuMik7XFxufVxcblxcbi50cC1tb2RhbCAudHAtaWZyYW1lLXdyYXBwZXIucGlhbm8taWQtbW9kYWwtdmVyLTJbZGlyPVxcXCJydGxcXFwiXSAudHAtY2xvc2U6aG92ZXIsXFxuLnRwLW1vZGFsIC50cC1pZnJhbWUtd3JhcHBlci5waWFuby1pZC1tb2RhbC12ZXItMltkaXI9XFxcInJ0bFxcXCJdIC50cC1jbG9zZTpmb2N1cyB7XFxuICBib3JkZXItbGVmdDogbm9uZTtcXG4gIGJvcmRlci1yaWdodDogMXB4IHNvbGlkIHJnYmEoMTUsIDE1LCAyMSwgMC4wNik7XFxufVxcblxcbi50cC1tb2RhbCB7XFxuICAgIHotaW5kZXg6IDMwMDA1MDtcXG59XFxuQG1lZGlhIHNjcmVlbiBhbmQgKG1heC13aWR0aDogNjUwcHgpIHtcXG4gICAgLnRwLW1vZGFsIC50cC1jbG9zZSB7XFxuICAgICAgICByaWdodDogMDtcXG4gICAgfVxcblxcbiAgICAudHAtbW9kYWwgLnRwLWlmcmFtZS13cmFwcGVyW2Rpcj1cXFwicnRsXFxcIl0gLnRwLWNsb3NlIHtcXG4gICAgICByaWdodDogaW5pdGlhbDtcXG4gICAgICBsZWZ0OiAwO1xcbiAgICB9XFxufVxcbi50cC1tb2RhbCAudHAtaWZyYW1lLXdyYXBwZXIudHAtY3VydGFpbiB7XFxuICAgIHdpZHRoOiA2MDBweDtcXG4gICAgaGVpZ2h0OiA0ODBweDtcXG59XFxuLnRwLW1vZGFsLW9wZW4ge1xcbiAgICBvdmVyZmxvdzogaGlkZGVuICFpbXBvcnRhbnQ7XFxuICAgIGhlaWdodDogMTAwdmg7XFxuICAgIC13ZWJraXQtb3ZlcmZsb3ctc2Nyb2xsaW5nOiB0b3VjaDtcXG59XFxuLnRwLW1vZGFsLW9wZW4udHAtbW9kYWwtcmVzaXppbmcge1xcbiAgICAtd2Via2l0LW92ZXJmbG93LXNjcm9sbGluZzogYXV0bztcXG59XFxuLypCdWcgZml4IG9mIGZpcmVmb3ggdjU3Ki9cXG4udHAtbW9kYWwtY2xvc2Uge1xcbiAgICBvdmVyZmxvdzogYXV0bztcXG59XFxuLnRwLW1vZGFsX19tYXJnaW4tMTAwIC50cC1pZnJhbWUtd3JhcHBlciB7XFxuICBtYXJnaW4tYm90dG9tOiAxMDBweDtcXG59XFxuLnRwLWlmcmFtZS13cmFwcGVyIHtcXG4gICAgcG9zaXRpb246IHJlbGF0aXZlO1xcbiAgICBtYXJnaW46IDUwcHggYXV0bztcXG4gICAgYm94LXNoYWRvdzogMCAwIDEwcHggcmdiYSgwLCAwLCAwLCAwLjIxKTtcXG59XFxuLnRwLWlmcmFtZS13cmFwcGVyLm5vLXNoYWRvdyB7XFxuICBib3gtc2hhZG93OiB1bnNldDtcXG59XFxuLnRwLW1vZGFsIHtcXG4gICAgb3ZlcmZsb3cteDogaGlkZGVuO1xcbiAgICBvdmVyZmxvdy15OiBzY3JvbGwgIWltcG9ydGFudDtcXG4gICAgZGlzcGxheTogbm9uZTtcXG4gICAgcG9zaXRpb246IGZpeGVkO1xcbiAgICB0b3A6IDA7XFxuICAgIGJvdHRvbTogMDtcXG4gICAgbGVmdDogMDtcXG4gICAgcmlnaHQ6IDA7XFxuICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlM2QoMCwgMCwgMCk7XFxufVxcbi50cC1tb2RhbCAudHAtbWVzc2FnZSB7XFxuICAgIGZvbnQtZmFtaWx5OiBcXFwiR3JhcGhpayBXZWIgUmVndWxhclxcXCIsIEhlbHZldGljYSwgQXJpYWwsIHNhbnMtc2VyaWY7XFxuICAgIHBhZGRpbmc6IDEwcHg7XFxufVxcbi50cC1tb2RhbCAudHAtYnRuLWNvbnRhaW5lciB7XFxuICAgIHBhZGRpbmctbGVmdDogMTBweDtcXG4gICAgcGFkZGluZy1ib3R0b206IDEwcHg7XFxufVxcbi50cC1jeGVuc2UtcGxhY2Vob2xkZXItbW9kYWwge1xcbiAgICB3aWR0aDogMTAwJTtcXG4gICAgYmFja2dyb3VuZC1jb2xvcjogI2ZmZjtcXG4gICAgbWF4LXdpZHRoOiA5MTJweDtcXG4gICAgZGlzcGxheTogYmxvY2s7XFxuICAgIG92ZXJmbG93OiBoaWRkZW47XFxuICAgIGhlaWdodDogYXV0bztcXG4gICAgb3BhY2l0eTogMTtcXG59XFxuLnRwLXdpZGdldC1wbGFjZWhvbGRlciA+IGRpdjo6YWZ0ZXIge1xcbiAgICBkaXNwbGF5OiBibG9jaztcXG4gICAgY29udGVudDogXFxcIlxcXCI7XFxuICAgIGNsZWFyOiBib3RoO1xcbn1cXG4udHAtYnRuIHtcXG4gICAgdGV4dC1kZWNvcmF0aW9uOiBub25lO1xcbiAgICBjdXJzb3I6IHBvaW50ZXI7XFxuICAgIHBhZGRpbmc6IDAgMThweDtcXG4gICAgbGluZS1oZWlnaHQ6IDQwcHg7XFxuICAgIGJvcmRlci1jb2xsYXBzZTogc2VwYXJhdGU7XFxuICAgIGJvcmRlci1yYWRpdXM6IDRweDtcXG4gICAgdGV4dC1hbGlnbjogY2VudGVyO1xcbiAgICB2ZXJ0aWNhbC1hbGlnbjogbWlkZGxlO1xcbiAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7XFxuICAgIGNvbG9yOiAjZmZmO1xcbiAgICBib3JkZXI6IG5vbmU7XFxuICAgIGJveC1zaGFkb3c6IGluc2V0IDAgLTFweCAwIHJnYmEoMjE2LCAyMTgsIDIyMSwgMC4wKTtcXG4gICAgYmFja2dyb3VuZDogIzM4NzhEODtcXG4gICAgYmFja2dyb3VuZC1wb3NpdGlvbjogYm90dG9tO1xcbiAgICB0ZXh0LXNoYWRvdzogbm9uZTtcXG4gICAgZm9udC1mYW1pbHk6IFxcXCJHcmFwaGlrIFdlYiBSZWd1bGFyXFxcIiwgSGVsdmV0aWNhLCBBcmlhbCwgc2Fucy1zZXJpZjtcXG4gICAgd2hpdGUtc3BhY2U6IG5vd3JhcDtcXG4gICAgb3V0bGluZTogMDtcXG59XFxuLnRwLXBsZWFzZS13YWl0LnRwLWFjdGl2ZSB7XFxuICAgIGRpc3BsYXk6IGJsb2NrO1xcbiAgICBvcGFjaXR5OiAuOTtcXG4gICAgdHJhbnNpdGlvbjogb3BhY2l0eSAuMjVzIGxpbmVhcjtcXG59XFxuLnRwLXBsZWFzZS13YWl0IHtcXG4gICAgcG9zaXRpb246IGFic29sdXRlO1xcbiAgICB0b3A6IDA7XFxuICAgIGxlZnQ6IDA7XFxuICAgIGJhY2tncm91bmQtY29sb3I6ICM5OTk7XFxuICAgIG9wYWNpdHk6IDA7XFxuICAgIHdpZHRoOiAxMDAlO1xcbiAgICBoZWlnaHQ6IDEwMCU7XFxuICAgIGRpc3BsYXk6IG5vbmU7XFxuICAgIHRleHQtYWxpZ246IGNlbnRlcjtcXG4gICAgY29sb3I6ICNmZmY7XFxuICAgIGZvbnQtd2VpZ2h0OiBsaWdodGVyO1xcbiAgICBmb250LWZhbWlseTogXFxcIk9wZW4gU2Fuc1xcXCIsIHNhbnMtc2VyaWY7XFxuICAgIGZvbnQtc2l6ZTogMTVweDtcXG59XFxuLnRwLXBsZWFzZS13YWl0LnRwLW92ZXJsYXAge1xcbiAgcG9zaXRpb246IGZpeGVkO1xcbiAgei1pbmRleDogMzAwMTUwO1xcbn1cXG5cXG4udHAtcGxlYXNlLXdhaXQudHAtbG9jYWwtb3ZlcmxhcCB7XFxuICBwb3NpdGlvbjogYWJzb2x1dGU7XFxufVxcblxcbi50cC1wbGVhc2Utd2FpdCA+IC50cC1pY29uIHtcXG4gICAgd2lkdGg6IDgwcHg7XFxuICAgIGhlaWdodDogODBweDtcXG4gICAgbWFyZ2luOiAxMDBweCBhdXRvIDIwcHggYXV0bztcXG59XFxuXFxuLnBuLXNwaW5uZXIge1xcbiAgY29sb3I6IGdyZXk7XFxuICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7XFxuICBwb3NpdGlvbjogcmVsYXRpdmU7XFxuICB3aWR0aDogODBweDtcXG4gIGhlaWdodDogODBweDtcXG59XFxuLnBuLXNwaW5uZXIgZGl2IHtcXG4gIHRyYW5zZm9ybS1vcmlnaW46IDQwcHggNDBweDtcXG4gIGFuaW1hdGlvbjogcG4tc3Bpbm5lciAxLjJzIGxpbmVhciBpbmZpbml0ZTtcXG59XFxuLnBuLXNwaW5uZXIgZGl2OmFmdGVyIHtcXG4gIGNvbnRlbnQ6IFxcXCIgXFxcIjtcXG4gIGRpc3BsYXk6IGJsb2NrO1xcbiAgcG9zaXRpb246IGFic29sdXRlO1xcbiAgdG9wOiAzcHg7XFxuICBsZWZ0OiAzN3B4O1xcbiAgd2lkdGg6IDZweDtcXG4gIGhlaWdodDogMThweDtcXG4gIGJvcmRlci1yYWRpdXM6IDIwJTtcXG4gIGJhY2tncm91bmQ6ICNmZmY7XFxufVxcbi5wbi1zcGlubmVyIGRpdjpudGgtY2hpbGQoMSkge1xcbiAgdHJhbnNmb3JtOiByb3RhdGUoMGRlZyk7XFxuICBhbmltYXRpb24tZGVsYXk6IC0xLjFzO1xcbn1cXG4ucG4tc3Bpbm5lciBkaXY6bnRoLWNoaWxkKDIpIHtcXG4gIHRyYW5zZm9ybTogcm90YXRlKDMwZGVnKTtcXG4gIGFuaW1hdGlvbi1kZWxheTogLTFzO1xcbn1cXG4ucG4tc3Bpbm5lciBkaXY6bnRoLWNoaWxkKDMpIHtcXG4gIHRyYW5zZm9ybTogcm90YXRlKDYwZGVnKTtcXG4gIGFuaW1hdGlvbi1kZWxheTogLTAuOXM7XFxufVxcbi5wbi1zcGlubmVyIGRpdjpudGgtY2hpbGQoNCkge1xcbiAgdHJhbnNmb3JtOiByb3RhdGUoOTBkZWcpO1xcbiAgYW5pbWF0aW9uLWRlbGF5OiAtMC44cztcXG59XFxuLnBuLXNwaW5uZXIgZGl2Om50aC1jaGlsZCg1KSB7XFxuICB0cmFuc2Zvcm06IHJvdGF0ZSgxMjBkZWcpO1xcbiAgYW5pbWF0aW9uLWRlbGF5OiAtMC43cztcXG59XFxuLnBuLXNwaW5uZXIgZGl2Om50aC1jaGlsZCg2KSB7XFxuICB0cmFuc2Zvcm06IHJvdGF0ZSgxNTBkZWcpO1xcbiAgYW5pbWF0aW9uLWRlbGF5OiAtMC42cztcXG59XFxuLnBuLXNwaW5uZXIgZGl2Om50aC1jaGlsZCg3KSB7XFxuICB0cmFuc2Zvcm06IHJvdGF0ZSgxODBkZWcpO1xcbiAgYW5pbWF0aW9uLWRlbGF5OiAtMC41cztcXG59XFxuLnBuLXNwaW5uZXIgZGl2Om50aC1jaGlsZCg4KSB7XFxuICB0cmFuc2Zvcm06IHJvdGF0ZSgyMTBkZWcpO1xcbiAgYW5pbWF0aW9uLWRlbGF5OiAtMC40cztcXG59XFxuLnBuLXNwaW5uZXIgZGl2Om50aC1jaGlsZCg5KSB7XFxuICB0cmFuc2Zvcm06IHJvdGF0ZSgyNDBkZWcpO1xcbiAgYW5pbWF0aW9uLWRlbGF5OiAtMC4zcztcXG59XFxuLnBuLXNwaW5uZXIgZGl2Om50aC1jaGlsZCgxMCkge1xcbiAgdHJhbnNmb3JtOiByb3RhdGUoMjcwZGVnKTtcXG4gIGFuaW1hdGlvbi1kZWxheTogLTAuMnM7XFxufVxcbi5wbi1zcGlubmVyIGRpdjpudGgtY2hpbGQoMTEpIHtcXG4gIHRyYW5zZm9ybTogcm90YXRlKDMwMGRlZyk7XFxuICBhbmltYXRpb24tZGVsYXk6IC0wLjFzO1xcbn1cXG4ucG4tc3Bpbm5lciBkaXY6bnRoLWNoaWxkKDEyKSB7XFxuICB0cmFuc2Zvcm06IHJvdGF0ZSgzMzBkZWcpO1xcbiAgYW5pbWF0aW9uLWRlbGF5OiAwcztcXG59XFxuQGtleWZyYW1lcyBwbi1zcGlubmVyIHtcXG4gIDAlIHtcXG4gICAgb3BhY2l0eTogMTtcXG4gIH1cXG4gIDEwMCUge1xcbiAgICBvcGFjaXR5OiAwO1xcbiAgfVxcbn1cXG5cXG4udHAtcGxlYXNlLXdhaXQgPiAudHAtaWNvbi50cC1jZW50ZXJlZCB7XFxuICBtYXJnaW46IDA7XFxuICBwb3NpdGlvbjogYWJzb2x1dGU7XFxuICB0b3A6IDUwJTtcXG4gIGxlZnQ6IDUwJTtcXG4gIHRyYW5zZm9ybTogdHJhbnNsYXRlKC01MCUsIC01MCUpO1xcbn1cXG4udHAtaWZyYW1lLXdyYXBwZXIubm8td2lkdGggLnRwLWNsb3NlLFxcbi50cC1pZnJhbWUtd3JhcHBlci5uby1oZWlnaHQgLnRwLWNsb3NlLFxcbi50cC1tb2RhbC5uby13aWR0aCAudHAtY2xvc2UsXFxuLnRwLW1vZGFsLm5vLWhlaWdodCAudHAtY2xvc2Uge1xcbiAgICBkaXNwbGF5OiBub25lO1xcbn1cXG5cXG4udHAtYmFubmVyIHtcXG4gIHBvc2l0aW9uOiBmaXhlZDtcXG4gIGJvdHRvbTogMDtcXG4gIGxlZnQ6IDA7XFxuICB3aWR0aDogMTAwJTtcXG59XFxuXFxuLnRwLWJhbm5lciA+IC50cC1jb250YWluZXItaW5uZXIsXFxuLnRwLWJhbm5lciA+IC50cC1jb250YWluZXItaW5uZXIgPiBpZnJhbWUge1xcbiAgd2lkdGg6IGluaGVyaXQgIWltcG9ydGFudDtcXG59XFxuXFxuLmZyb3plbi1tb2JpbGUtYm9keSB7XFxuICB3aWR0aDogMTAwJTtcXG4gIG1hcmdpbjogMDtcXG4gIHBvc2l0aW9uOiBmaXhlZCAhaW1wb3J0YW50O1xcbiAgbWF4LWhlaWdodDogLXdlYmtpdC1maWxsLWF2YWlsYWJsZTtcXG4gIG1heC1oZWlnaHQ6IC1tb3otYXZhaWxhYmxlO1xcbn1cXG5cIik7IH0gfSk7XG4gICAgcG4uY29udGFpbmVyLnJlZ2lzdGVyKFwiY3NzXCIsIHsgdXNlVmFsdWU6IFYgfSksIHBuLmNzcyA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwiY3NzXCIpO1xuICAgIHZhciBxLCB6LCBIID0gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIHt9LnRvU3RyaW5nLmNhbGwoZSkubWF0Y2goL1xccyhbYS16QS1aXSspLylbMV0udG9Mb3dlckNhc2UoKTsgfSwgVyA9IE1hdGgucm91bmQoMWU0ICogTWF0aC5yYW5kb20oKSksIEogPSB3aW5kb3cuZG9jdW1lbnQsIEcgPSAvXig/OnRleHR8YXBwbGljYXRpb24pXFwvamF2YXNjcmlwdC9pLCBRID0gL14oPzp0ZXh0fGFwcGxpY2F0aW9uKVxcL3htbC9pLCBYID0gXCJhcHBsaWNhdGlvbi9qc29uXCIsICQgPSBcInRleHQvaHRtbFwiLCBZID0gL15cXHMqJC8sIEsgPSBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IGNlKHt9LCBlIHx8IHt9KTsgZm9yIChxIGluIEsuc2V0dGluZ3MpXG4gICAgICAgIHZvaWQgMCA9PT0gbltxXSAmJiAobltxXSA9IEsuc2V0dGluZ3NbcV0pOyAhZnVuY3Rpb24gKGUpIHsgZS5nbG9iYWwgJiYgMCA9PSBLLmFjdGl2ZSsrICYmIFooZSk7IH0obiksIG4uY3Jvc3NEb21haW4gfHwgKG4uY3Jvc3NEb21haW4gPSAvXihbXFx3LV0rOik/XFwvXFwvKFteXFwvXSspLy50ZXN0KG4udXJsKSAmJiBSZWdFeHAuJDIgIT0gd2luZG93LmxvY2F0aW9uLmhvc3QpOyB2YXIgdCA9IG4uZGF0YVR5cGUsIHIgPSAvPVxcPy8udGVzdChuLnVybCk7IGlmIChcImpzb25wXCIgPT0gdCB8fCByKVxuICAgICAgICByZXR1cm4gciB8fCAobi51cmwgPSBvZShuLnVybCwgXCJjYWxsYmFjaz0/XCIpKSwgSy5KU09OUChuKTsgbi51cmwgfHwgKG4udXJsID0gd2luZG93LmxvY2F0aW9uLnRvU3RyaW5nKCkpLCBpZShuKTsgdmFyIG8sIGkgPSBuLmFjY2VwdHNbdF0sIGEgPSB7fSwgcyA9IC9eKFtcXHctXSs6KVxcL1xcLy8udGVzdChuLnVybCkgPyBSZWdFeHAuJDEgOiB3aW5kb3cubG9jYXRpb24ucHJvdG9jb2wsIGMgPSBLLnNldHRpbmdzLnhocigpOyBuLmNyb3NzRG9tYWluIHx8IChhW1wiWC1SZXF1ZXN0ZWQtV2l0aFwiXSA9IFwiWE1MSHR0cFJlcXVlc3RcIiksIGkgJiYgKGEuQWNjZXB0ID0gaSwgaS5pbmRleE9mKFwiLFwiKSA+IC0xICYmIChpID0gaS5zcGxpdChcIixcIiwgMilbMF0pLCBjLm92ZXJyaWRlTWltZVR5cGUgJiYgYy5vdmVycmlkZU1pbWVUeXBlKGkpKSwgKG4uY29udGVudFR5cGUgfHwgbi5kYXRhICYmIFwiR0VUXCIgIT0gbi50eXBlLnRvVXBwZXJDYXNlKCkpICYmIChhW1wiQ29udGVudC1UeXBlXCJdID0gbi5jb250ZW50VHlwZSB8fCBcImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZFwiKSwgbi5oZWFkZXJzID0gY2UoYSwgbi5oZWFkZXJzIHx8IHt9KTsgdmFyIGwgPSBuLnhockZpZWxkcyAmJiBuLnhockZpZWxkcy53aXRoQ3JlZGVudGlhbHM7IGwgJiYgKGMud2l0aENyZWRlbnRpYWxzID0gbCksIGMub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24gKCkgeyBpZiAoNCA9PSBjLnJlYWR5U3RhdGUpIHtcbiAgICAgICAgY2xlYXJUaW1lb3V0KG8pO1xuICAgICAgICB2YXIgZSwgciA9ICExO1xuICAgICAgICBpZiAoYy5zdGF0dXMgPj0gMjAwICYmIGMuc3RhdHVzIDwgMzAwIHx8IDMwNCA9PSBjLnN0YXR1cyB8fCAwID09IGMuc3RhdHVzICYmIFwiZmlsZTpcIiA9PSBzKSB7XG4gICAgICAgICAgICB0ID0gdCB8fCBmdW5jdGlvbiAoZSkgeyByZXR1cm4gZSAmJiAoZSA9PSAkID8gXCJodG1sXCIgOiBlID09IFggPyBcImpzb25cIiA6IEcudGVzdChlKSA/IFwic2NyaXB0XCIgOiBRLnRlc3QoZSkgJiYgXCJ4bWxcIikgfHwgXCJ0ZXh0XCI7IH0oYy5nZXRSZXNwb25zZUhlYWRlcihcImNvbnRlbnQtdHlwZVwiKSksIGUgPSBjLnJlc3BvbnNlVGV4dDtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgXCJzY3JpcHRcIiA9PSB0ID8gKDAsIGV2YWwpKGUpIDogXCJ4bWxcIiA9PSB0ID8gZSA9IGMucmVzcG9uc2VYTUwgOiBcImpzb25cIiA9PSB0ICYmIChlID0gWS50ZXN0KGUpID8gbnVsbCA6IEpTT04ucGFyc2UoZSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICByID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHIgPyBuZShyLCBcInBhcnNlcmVycm9yXCIsIGMsIG4pIDogZWUoZSwgYywgbik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgbmUobnVsbCwgXCJlcnJvclwiLCBjLCBuKTtcbiAgICB9IH07IHZhciB1ID0gIShcImFzeW5jXCIgaW4gbikgfHwgbi5hc3luYzsgZm9yICh6IGluIGMub3BlbihuLnR5cGUsIG4udXJsLCB1KSwgbi5oZWFkZXJzKVxuICAgICAgICBjLnNldFJlcXVlc3RIZWFkZXIoeiwgbi5oZWFkZXJzW3pdKTsgcmV0dXJuICExID09PSBmdW5jdGlvbiAoZSwgbikgeyB2YXIgdCA9IG4uY29udGV4dDsgaWYgKCExID09PSBuLmJlZm9yZVNlbmQuY2FsbCh0LCBlLCBuKSB8fCAhMSA9PT0gWihuKSlcbiAgICAgICAgcmV0dXJuICExOyBaKG4pOyB9KGMsIG4pID8gKGMuYWJvcnQoKSwgITEpIDogKG4udGltZW91dCA+IDAgJiYgKG8gPSBzZXRUaW1lb3V0KChmdW5jdGlvbiAoKSB7IGMub25yZWFkeXN0YXRlY2hhbmdlID0gcmUsIGMuYWJvcnQoKSwgbmUobnVsbCwgXCJ0aW1lb3V0XCIsIGMsIG4pOyB9KSwgbi50aW1lb3V0KSksIGMuc2VuZChuLmRhdGEgPyBuLmRhdGEgOiBudWxsKSwgYyk7IH07XG4gICAgZnVuY3Rpb24gWihlLCBuLCB0LCByKSB7IGlmIChlLmdsb2JhbClcbiAgICAgICAgcmV0dXJuICEwOyB9XG4gICAgZnVuY3Rpb24gZWUoZSwgbiwgdCkgeyB2YXIgciA9IHQuY29udGV4dCwgbyA9IFwic3VjY2Vzc1wiOyB0LnN1Y2Nlc3MuY2FsbChyLCBlLCBvLCBuKSwgWih0KSwgdGUobywgbiwgdCk7IH1cbiAgICBmdW5jdGlvbiBuZShlLCBuLCB0LCByKSB7IHZhciBvID0gci5jb250ZXh0OyByLmVycm9yLmNhbGwobywgdCwgbiwgZSksIFoociksIHRlKG4sIHQsIHIpOyB9XG4gICAgZnVuY3Rpb24gdGUoZSwgbiwgdCkgeyB2YXIgciA9IHQuY29udGV4dDsgdC5jb21wbGV0ZS5jYWxsKHIsIG4sIGUpLCBaKHQpLCBmdW5jdGlvbiAoZSkgeyBlLmdsb2JhbCAmJiAhLS1LLmFjdGl2ZSAmJiBaKGUpOyB9KHQpOyB9XG4gICAgZnVuY3Rpb24gcmUoKSB7IH1cbiAgICBmdW5jdGlvbiBvZShlLCBuKSB7IHJldHVybiAoZSArIFwiJlwiICsgbikucmVwbGFjZSgvWyY/XXsxLDJ9LywgXCI/XCIpOyB9XG4gICAgZnVuY3Rpb24gaWUoZSkgeyB2YXIgbiwgdCwgcjsgXCJvYmplY3RcIiA9PT0gSChlLmRhdGEpICYmIChlLmRhdGEgPSAobiA9IGUuZGF0YSwgKHIgPSBbXSkuYWRkID0gZnVuY3Rpb24gKGUsIG4pIHsgdGhpcy5wdXNoKGFlKGUpICsgXCI9XCIgKyBhZShuKSk7IH0sIHNlKHIsIG4sIHQpLCByLmpvaW4oXCImXCIpLnJlcGxhY2UoXCIlMjBcIiwgXCIrXCIpKSksICFlLmRhdGEgfHwgZS50eXBlICYmIFwiR0VUXCIgIT0gZS50eXBlLnRvVXBwZXJDYXNlKCkgfHwgKGUudXJsID0gb2UoZS51cmwsIGUuZGF0YSkpOyB9XG4gICAgSy5hY3RpdmUgPSAwLCBLLkpTT05QID0gZnVuY3Rpb24gKGUpIHsgaWYgKCEoXCJ0eXBlXCIgaW4gZSkpXG4gICAgICAgIHJldHVybiBLKGUpOyB2YXIgbiwgdCA9IFwianNvbnBcIiArIChlLmNhY2hlID8gXCJDYWxsYmFja1wiIDogKytXKSwgciA9IEouY3JlYXRlRWxlbWVudChcInNjcmlwdFwiKSwgbyA9IHsgYWJvcnQ6IGZ1bmN0aW9uICgpIHsgdCBpbiB3aW5kb3cgJiYgKHdpbmRvd1t0XSA9IHJlKSwgdGUoXCJhYm9ydFwiLCBvLCBlKTsgfSB9LCBpID0gSi5nZXRFbGVtZW50c0J5VGFnTmFtZShcImhlYWRcIilbMF0gfHwgSi5kb2N1bWVudEVsZW1lbnQ7IHJldHVybiBlLmVycm9yICYmIChyLm9uZXJyb3IgPSBmdW5jdGlvbiAoKSB7IG8uYWJvcnQoKSwgZS5lcnJvcigpOyB9KSwgd2luZG93W3RdID0gZnVuY3Rpb24gKHIpIHsgY2xlYXJUaW1lb3V0KG4pLCBkZWxldGUgd2luZG93W3RdLCBlZShyLCBvLCBlKTsgfSwgaWUoZSksIHIuc3JjID0gZS51cmwucmVwbGFjZSgvPVxcPy8sIFwiPVwiICsgdCksIGkuaW5zZXJ0QmVmb3JlKHIsIGkuZmlyc3RDaGlsZCksIGUudGltZW91dCA+IDAgJiYgKG4gPSBzZXRUaW1lb3V0KChmdW5jdGlvbiAoKSB7IG8uYWJvcnQoKSwgdGUoXCJ0aW1lb3V0XCIsIG8sIGUpOyB9KSwgZS50aW1lb3V0KSksIG87IH0sIEsuc2V0dGluZ3MgPSB7IHR5cGU6IFwiR0VUXCIsIGJlZm9yZVNlbmQ6IHJlLCBzdWNjZXNzOiByZSwgZXJyb3I6IHJlLCBjb21wbGV0ZTogcmUsIGNvbnRleHQ6IG51bGwsIGdsb2JhbDogITAsIHhocjogZnVuY3Rpb24gKCkgeyByZXR1cm4gbmV3IHdpbmRvdy5YTUxIdHRwUmVxdWVzdDsgfSwgYWNjZXB0czogeyBzY3JpcHQ6IFwidGV4dC9qYXZhc2NyaXB0LCBhcHBsaWNhdGlvbi9qYXZhc2NyaXB0XCIsIGpzb246IFgsIHhtbDogXCJhcHBsaWNhdGlvbi94bWwsIHRleHQveG1sXCIsIGh0bWw6ICQsIHRleHQ6IFwidGV4dC9wbGFpblwiIH0sIGNyb3NzRG9tYWluOiAhMSwgdGltZW91dDogMCB9LCBLLmdldCA9IGZ1bmN0aW9uIChlLCBuKSB7IHJldHVybiBLKHsgdXJsOiBlLCBzdWNjZXNzOiBuIH0pOyB9LCBLLnBvc3QgPSBmdW5jdGlvbiAoZSwgbiwgdCwgcikgeyByZXR1cm4gXCJmdW5jdGlvblwiID09PSBIKG4pICYmIChyID0gciB8fCB0LCB0ID0gbiwgbiA9IG51bGwpLCBLKHsgdHlwZTogXCJQT1NUXCIsIHVybDogZSwgZGF0YTogbiwgc3VjY2VzczogdCwgZGF0YVR5cGU6IHIgfSk7IH0sIEsuZ2V0SlNPTiA9IGZ1bmN0aW9uIChlLCBuKSB7IHJldHVybiBLKHsgdXJsOiBlLCBzdWNjZXNzOiBuLCBkYXRhVHlwZTogXCJqc29uXCIgfSk7IH07XG4gICAgdmFyIGFlID0gZW5jb2RlVVJJQ29tcG9uZW50O1xuICAgIGZ1bmN0aW9uIHNlKGUsIG4sIHQsIHIpIHsgdmFyIG8gPSBcImFycmF5XCIgPT09IEgobik7IGZvciAodmFyIGkgaW4gbikge1xuICAgICAgICB2YXIgYSA9IG5baV07XG4gICAgICAgIHIgJiYgKGkgPSB0ID8gciA6IHIgKyBcIltcIiArIChvID8gXCJcIiA6IGkpICsgXCJdXCIpLCAhciAmJiBvID8gZS5hZGQoYS5uYW1lLCBhLnZhbHVlKSA6ICh0ID8gXCJhcnJheVwiID09PSBIKGEpIDogXCJvYmplY3RcIiA9PT0gSChhKSkgPyBzZShlLCBhLCB0LCBpKSA6IGUuYWRkKGksIGEpO1xuICAgIH0gfVxuICAgIGZ1bmN0aW9uIGNlKGUpIHsgdmFyIG4gPSBBcnJheS5wcm90b3R5cGUuc2xpY2U7IHJldHVybiBuLmNhbGwoYXJndW1lbnRzLCAxKS5mb3JFYWNoKChmdW5jdGlvbiAobikgeyBmb3IgKHEgaW4gbilcbiAgICAgICAgdm9pZCAwICE9PSBuW3FdICYmIChlW3FdID0gbltxXSk7IH0pKSwgZTsgfVxuICAgIHZhciBsZSA9IEssIHVlID0geyByZXF1ZXN0OiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gZS5kYXRhVHlwZSA9IGUuZGF0YVR5cGUgfHwgXCJqc29uXCIsIGxlKGUpOyB9IH07XG4gICAgcG4uY29udGFpbmVyLnJlZ2lzdGVyKFwiYWpheFwiLCB7IHVzZVZhbHVlOiB1ZSB9KSwgcG4uYWpheCA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwiYWpheFwiKTtcbiAgICB2YXIgZGUgPSBmdW5jdGlvbiAoKSB7IHZhciBlID0gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIFwiZnVuY3Rpb25cIiA9PSB0eXBlb2YgZTsgfSwgbiA9IGZ1bmN0aW9uIChlLCBuKSB7IHJldHVybiBlID8gdChlLCBuKVswXSA6IG51bGw7IH0sIHQgPSBmdW5jdGlvbiAoZSwgbikgeyBpZiAoIWUpXG4gICAgICAgIHJldHVybiBbXTsgdmFyIHQgPSBuIHx8IGRvY3VtZW50LCByID0gZS5zcGxpdChcIixcIiksIG8gPSBbXTsgcmV0dXJuIHIuZm9yRWFjaCgoZnVuY3Rpb24gKGUpIHsgdmFyIG4gPSBlLnRyaW0oKTsgdHJ5IHtcbiAgICAgICAgbyA9IG8uY29uY2F0KEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKHQucXVlcnlTZWxlY3RvckFsbChuKSkpO1xuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgICB2YXIgciA9IG4uaW5kZXhPZihcIiBcIikgPiAtMTtcbiAgICAgICAgaWYgKFwiLlwiICE9PSBuWzBdIHx8IHIpXG4gICAgICAgICAgICBpZiAoXCIjXCIgIT09IG5bMF0gfHwgcilcbiAgICAgICAgICAgICAgICBvID0gby5jb25jYXQoQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwodC5xdWVyeVNlbGVjdG9yQWxsKG4pKSk7XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB2YXIgaSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG4uc3Vic3RyaW5nKDEpKTtcbiAgICAgICAgICAgICAgICBvID0gby5jb25jYXQoaSA/IFtpXSA6IFtdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgbyA9IG8uY29uY2F0KEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKHQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShuLnN1YnN0cmluZygxKSkpKTtcbiAgICB9IH0pKSwgbzsgfSwgciA9IGZ1bmN0aW9uIChlLCBuLCB0KSB7IHQuc2V0QXR0cmlidXRlKGUsIG4pOyB9LCBvID0gW10sIGkgPSBmdW5jdGlvbiAoKSB7IGZvciAodmFyIGUgPSBbXSwgbiA9IDA7IG4gPCBhcmd1bWVudHMubGVuZ3RoOyBuKyspXG4gICAgICAgIGVbbl0gPSBhcmd1bWVudHNbbl07IGZvciAodmFyIHQgPSB7fSwgciA9IDAsIG8gPSBmdW5jdGlvbiAoZSkgeyBmb3IgKHZhciBuIGluIGUpXG4gICAgICAgIGUuaGFzT3duUHJvcGVydHkobikgJiYgKFwiW29iamVjdCBPYmplY3RdXCIgPT09IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChlW25dKSA/IHRbbl0gPSBpKHRbbl0sIGVbbl0pIDogdFtuXSA9IGVbbl0pOyB9OyByIDwgZS5sZW5ndGg7IHIrKylcbiAgICAgICAgbyhlW3JdKTsgcmV0dXJuIHQ7IH07IHJldHVybiB7IHNjcm9sbFRvcDogZnVuY3Rpb24gKCkgeyByZXR1cm4gd2luZG93LnBhZ2VZT2Zmc2V0IHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3A7IH0sIHdpblNpemU6IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSB3aW5kb3csIG4gPSBkb2N1bWVudCwgdCA9IG4uZG9jdW1lbnRFbGVtZW50LCByID0gbi5nZXRFbGVtZW50c0J5VGFnTmFtZShcImJvZHlcIilbMF0sIG8gPSBlLmlubmVyV2lkdGggfHwgdC5jbGllbnRXaWR0aCB8fCByLmNsaWVudFdpZHRoOyByZXR1cm4geyBoZWlnaHQ6IGUuaW5uZXJIZWlnaHQgfHwgdC5jbGllbnRIZWlnaHQgfHwgci5jbGllbnRIZWlnaHQsIHdpZHRoOiBvIH07IH0sIGlzUGxhaW5PYmplY3Q6IGZ1bmN0aW9uIChlKSB7IHJldHVybiBcIltvYmplY3QgT2JqZWN0XVwiID09PSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoZSk7IH0sIGlzRW1wdHlPYmplY3Q6IGZ1bmN0aW9uIChlKSB7IHJldHVybiAwID09PSBPYmplY3Qua2V5cyhlKS5sZW5ndGggJiYgZS5jb25zdHJ1Y3RvciA9PT0gT2JqZWN0OyB9LCBpc0Z1bmN0aW9uOiBlLCBpbkFycmF5OiBmdW5jdGlvbiAoZSwgbikgeyByZXR1cm4gbi5pbmRleE9mKGUpOyB9LCB0eXBlOiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGUpLnJlcGxhY2UoL15cXFtvYmplY3QgKC4rKVxcXSQvLCBcIiQxXCIpLnRvTG93ZXJDYXNlKCk7IH0sIHJlbW92ZTogZnVuY3Rpb24gKGUpIHsgdmFyIG47IG51bGwgPT09IChuID0gZS5wYXJlbnROb2RlKSB8fCB2b2lkIDAgPT09IG4gfHwgbi5yZW1vdmVDaGlsZChlKTsgfSwgZW1wdHk6IGZ1bmN0aW9uIChlKSB7IGZvciAoOyBlLmZpcnN0Q2hpbGQ7KVxuICAgICAgICAgICAgZS5yZW1vdmVDaGlsZChlLmZpcnN0Q2hpbGQpOyB9LCBxdWVyeUVsOiBuLCBxYTogdCwgZmlsdGVyOiBmdW5jdGlvbiAoZSwgbikgeyByZXR1cm4gQXJyYXkucHJvdG90eXBlLmZpbHRlci5jYWxsKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoZSksIG4pOyB9LCBhZGRDbGFzczogZnVuY3Rpb24gKGUsIG4pIHsgbi5jbGFzc0xpc3QuYWRkKGUpOyB9LCB0b2dnbGVDbGFzczogZnVuY3Rpb24gKGUsIG4pIHsgbi5jbGFzc0xpc3QudG9nZ2xlKGUpOyB9LCByZW1vdmVDbGFzczogZnVuY3Rpb24gKGUsIG4pIHsgbi5jbGFzc0xpc3QucmVtb3ZlKGUpOyB9LCBnZXRXaWR0aDogZnVuY3Rpb24gKGUpIHsgdmFyIG4gPSBnZXRDb21wdXRlZFN0eWxlKGUsIG51bGwpLCB0ID0gbi5wYWRkaW5nTGVmdCwgciA9IG4ucGFkZGluZ1JpZ2h0LCBvID0gZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aDsgcmV0dXJuIG8gLT0gcGFyc2VGbG9hdCh0KSArIHBhcnNlRmxvYXQocik7IH0sIHNob3c6IGZ1bmN0aW9uIChlKSB7IGUuc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjsgfSwgaGlkZTogZnVuY3Rpb24gKGUpIHsgZS5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7IH0sIGdldEhlaWdodDogZnVuY3Rpb24gKGUpIHsgdmFyIG4gPSBnZXRDb21wdXRlZFN0eWxlKGUsIG51bGwpLCB0ID0gbi5wYWRkaW5nVG9wLCByID0gbi5wYWRkaW5nQm90dG9tLCBvID0gZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5oZWlnaHQ7IHJldHVybiBvIC09IHBhcnNlRmxvYXQodCkgKyBwYXJzZUZsb2F0KHIpOyB9LCB2aXNpYmxlOiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gISEoZS5vZmZzZXRXaWR0aCB8fCBlLm9mZnNldEhlaWdodCB8fCBlLmdldENsaWVudFJlY3RzKCkubGVuZ3RoKTsgfSwgYXBwZW5kOiBmdW5jdGlvbiAoZSwgbikgeyBlLmFwcGVuZENoaWxkKG4pOyB9LCBzZXRBdHRyOiByLCBzZXRBdHRyczogZnVuY3Rpb24gKGUsIG4pIHsgT2JqZWN0LmtleXMoZSkuZm9yRWFjaCgoZnVuY3Rpb24gKHQpIHsgcih0LCBlW3RdLCBuKTsgfSkpOyB9LCBnZXRBdHRyOiBmdW5jdGlvbiAoZSwgdCkgeyByZXR1cm4gXCJzdHJpbmdcIiA9PSB0eXBlb2YgZSAmJiAoZSA9IG4oZSkpLCBlID8gZS5nZXRBdHRyaWJ1dGUodCkgOiBudWxsOyB9LCByZWFkeTogZnVuY3Rpb24gKGUpIHsgXCJsb2FkaW5nXCIgIT0gZG9jdW1lbnQucmVhZHlTdGF0ZSA/IGUoKSA6IGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJET01Db250ZW50TG9hZGVkXCIsIChmdW5jdGlvbiAoKSB7IHJldHVybiBlKCk7IH0pKTsgfSwgZGVsZWdhdGU6IGZ1bmN0aW9uIChlLCBuLCB0LCByKSB7IHZhciBpID0gZnVuY3Rpb24gKHQpIHsgZm9yICh2YXIgaSA9IHQudGFyZ2V0OyBpICYmIG51bGwgIT0gaTsgaSA9IGkucGFyZW50Tm9kZSkge1xuICAgICAgICAgICAgdmFyIGEgPSBvLmZpbmRJbmRleCgoZnVuY3Rpb24gKHQpIHsgcmV0dXJuIHQucGFyZW50RWwgPT09IGUgJiYgdC5lbGVtZW50U2VsZWN0b3IgPT09IG47IH0pKTtcbiAgICAgICAgICAgIGlmIChpLm1hdGNoZXMgJiYgaS5tYXRjaGVzKG4pICYmIGEgPj0gMCkge1xuICAgICAgICAgICAgICAgIHIuY2FsbChpLCB0KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSB9OyBvLnB1c2goeyBwYXJlbnRFbDogZSwgZWxlbWVudFNlbGVjdG9yOiBuLCBoYW5kbGVyOiBpLCBldmVudE5hbWU6IHQgfSksIGUuYWRkRXZlbnRMaXN0ZW5lcih0LCBpLCAhMSk7IH0sIHVuZGVsZWdhdGU6IGZ1bmN0aW9uIChlLCBuKSB7IG8gPSBvLmZpbHRlcigoZnVuY3Rpb24gKHQpIHsgdmFyIHIgPSB0LnBhcmVudEVsICE9PSBlICYmIHQuZWxlbWVudFNlbGVjdG9yICE9PSBuOyByZXR1cm4gciB8fCB0LnBhcmVudEVsLnJlbW92ZUV2ZW50TGlzdGVuZXIodC5ldmVudE5hbWUsIHQuaGFuZGxlciksIHI7IH0pKTsgfSwgb246IGZ1bmN0aW9uIChlLCBuLCB0KSB7IGUuYWRkRXZlbnRMaXN0ZW5lcihuLCAoZnVuY3Rpb24gKGUpIHsgdChlKTsgfSksICExKTsgfSwgb2ZmOiBmdW5jdGlvbiAoZSwgbiwgdCkgeyBlLnJlbW92ZUV2ZW50TGlzdGVuZXIobiwgdCk7IH0sIGRlZXBFeHRlbmQ6IGksIHBhcmFtOiBmdW5jdGlvbiAobikgeyB2YXIgdCA9IFtdLCByID0gZnVuY3Rpb24gKG4sIHQpIHsgcmV0dXJuIGVuY29kZVVSSUNvbXBvbmVudChuKSArIFwiPVwiICsgZW5jb2RlVVJJQ29tcG9uZW50KGUodCkgPyB0KCkgOiB0IHx8IDAgPT09IHQgfHwgITEgPT09IHQgPyB0IDogXCJcIik7IH07IHJldHVybiBPYmplY3Qua2V5cyhuKS5mb3JFYWNoKChmdW5jdGlvbiAoZSkgeyBBcnJheS5pc0FycmF5KG5bZV0pID8gbltlXS5mb3JFYWNoKChmdW5jdGlvbiAobikgeyB0LnB1c2gocihlLCBuKSk7IH0pKSA6IHQucHVzaChyKGUsIG5bZV0pKTsgfSkpLCB0LmpvaW4oXCImXCIpOyB9IH07IH07XG4gICAgcG4uY29udGFpbmVyLnJlZ2lzdGVyKFwianFVdGlsc1wiLCB7IHVzZVZhbHVlOiBkZSgpIH0pLCBwbi5qcVV0aWxzID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJqcVV0aWxzXCIpO1xuICAgIHZhciBwZSA9IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSB7fSwgbiA9IC9cXCsvZywgdCA9IGZ1bmN0aW9uIChlKSB7IHRyeSB7XG4gICAgICAgIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQoZS5yZXBsYWNlKG4sIFwiIFwiKSk7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7IH0gfSwgciA9IGZ1bmN0aW9uIChlKSB7IDAgPT09IGUuaW5kZXhPZignXCInKSAmJiAoZSA9IGUuc2xpY2UoMSwgLTEpLnJlcGxhY2UoL1xcXFxcIi9nLCAnXCInKS5yZXBsYWNlKC9cXFxcXFxcXC9nLCBcIlxcXFxcIikpLCBlID0gdChlKTsgdHJ5IHtcbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7IH0gfSwgbyA9IGZ1bmN0aW9uIChuLCBvLCBpKSB7IGlmICh2b2lkIDAgIT09IG8pIHtcbiAgICAgICAgaWYgKFwibnVtYmVyXCIgPT0gdHlwZW9mIChpID0gT2JqZWN0LmFzc2lnbih7fSwgZSwgaSkpLmV4cGlyZXMpIHtcbiAgICAgICAgICAgIHZhciBhID0gaS5leHBpcmVzLCBzID0gaS5leHBpcmVzID0gbmV3IERhdGU7XG4gICAgICAgICAgICBzLnNldERhdGUocy5nZXREYXRlKCkgKyBhKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbyA9IFN0cmluZyhvKSwgZG9jdW1lbnQuY29va2llID0gW2VuY29kZVVSSUNvbXBvbmVudChuKSwgXCI9XCIsIGVuY29kZVVSSUNvbXBvbmVudChvKSwgaS5leHBpcmVzID8gXCI7IGV4cGlyZXM9XCIgKyBpLmV4cGlyZXMudG9VVENTdHJpbmcoKSA6IFwiXCIsIGkucGF0aCA/IFwiOyBwYXRoPVwiICsgaS5wYXRoIDogXCJcIiwgaS5kb21haW4gPyBcIjsgZG9tYWluPVwiICsgaS5kb21haW4gOiBcIlwiLCBpLnNlY3VyZSA/IFwiOyBzZWN1cmVcIiA6IFwiXCIsIGkuc2FtZXNpdGUgPyBcIjsgc2FtZXNpdGU9XCIgKyBpLnNhbWVzaXRlIDogXCJcIl0uam9pbihcIlwiKTtcbiAgICB9IGZvciAodmFyIGMsIGwgPSBkb2N1bWVudC5jb29raWUgPyBkb2N1bWVudC5jb29raWUuc3BsaXQoXCI7IFwiKSA6IFtdLCB1ID0gMCwgZCA9IGwubGVuZ3RoOyB1IDwgZDsgdSsrKSB7XG4gICAgICAgIHZhciBwID0gbFt1XS5zcGxpdChcIj1cIiksIGYgPSB0KHAuc2hpZnQoKSksIG0gPSBwLmpvaW4oXCI9XCIpO1xuICAgICAgICBpZiAobiAmJiBuID09PSBmKSB7XG4gICAgICAgICAgICBjID0gcihtKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIG4gfHwgdm9pZCAwID09PSAobSA9IHIobSkpIHx8IChjW2ZdID0gbSk7XG4gICAgfSByZXR1cm4gYzsgfTsgcmV0dXJuIHsgbmFtZTogXCJjb29raWVcIiwgZGVmYXVsdHM6IGUsIHJhdzogITEsIGpzb246IGZhbHNlLCBwbHVzZXM6IG4sIHNldDogZnVuY3Rpb24gKGUsIG4sIHQpIHsgbyhlLCBuLCB0KTsgfSwgZ2V0OiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gbyhlKTsgfSwgcmVtb3ZlOiBmdW5jdGlvbiAoZSwgbikgeyByZXR1cm4gdm9pZCAwICE9PSBvKGUpICYmIChvKGUsIFwiXCIsIE9iamVjdC5hc3NpZ24oe30sIG4sIHsgZXhwaXJlczogLTEgfSkpLCAhMCk7IH0gfTsgfSgpO1xuICAgIHBuLmNvbnRhaW5lci5yZWdpc3RlcihcImNvb2tpZVwiLCB7IHVzZVZhbHVlOiBwZSB9KSwgcG4uY29va2llID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJjb29raWVcIik7XG4gICAgdmFyIGZlID0gZnVuY3Rpb24gKGUpIHsgZnVuY3Rpb24gbihlKSB7IHZhciBuLCB0LCByLCBvID0gYXJndW1lbnRzLmxlbmd0aCwgaSA9IHdpbmRvd1tlXSwgYSA9IGFyZ3VtZW50cywgcyA9IGFbMV07IGlmIChvIDwgMilcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTWluaW11bSAyIGFyZ3VtZW50cyBtdXN0IGJlIGdpdmVuXCIpOyBpZiAoQXJyYXkuaXNBcnJheShzKSkge1xuICAgICAgICBmb3IgKHZhciBjIGluIHQgPSB7fSwgcykge1xuICAgICAgICAgICAgbiA9IHNbY107XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHRbbl0gPSBKU09OLnBhcnNlKGkuZ2V0SXRlbShuKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIHRbbl0gPSBpLmdldEl0ZW0obik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHQ7XG4gICAgfSBpZiAoMiAhPSBvKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICB0ID0gSlNPTi5wYXJzZShpLmdldEl0ZW0ocykpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IocyArIFwiIGlzIG5vdCBkZWZpbmVkIGluIHRoaXMgc3RvcmFnZVwiKTtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKGMgPSAyOyBjIDwgbyAtIDE7IGMrKylcbiAgICAgICAgICAgIGlmICh2b2lkIDAgPT09ICh0ID0gdFthW2NdXSkpXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKFtdLnNsaWNlLmNhbGwoYSwgMSwgYyArIDEpLmpvaW4oXCIuXCIpICsgXCIgaXMgbm90IGRlZmluZWQgaW4gdGhpcyBzdG9yYWdlXCIpO1xuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShhW2NdKSkge1xuICAgICAgICAgICAgZm9yICh2YXIgbCBpbiByID0gdCwgdCA9IHt9LCBhW2NdKVxuICAgICAgICAgICAgICAgIHRbYVtjXVtsXV0gPSByW2FbY11bbF1dO1xuICAgICAgICAgICAgcmV0dXJuIHQ7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRbYVtjXV07XG4gICAgfSB0cnkge1xuICAgICAgICByZXR1cm4gSlNPTi5wYXJzZShpLmdldEl0ZW0ocykpO1xuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgICByZXR1cm4gaS5nZXRJdGVtKHMpO1xuICAgIH0gfSBmdW5jdGlvbiB0KG4pIHsgdmFyIHQsIHIsIG8gPSBhcmd1bWVudHMubGVuZ3RoLCBpID0gd2luZG93W25dLCBhID0gYXJndW1lbnRzLCBzID0gYVsxXSwgYyA9IGFbMl0sIGwgPSB7fTsgaWYgKG8gPCAyIHx8ICFlLmlzUGxhaW5PYmplY3QocykgJiYgbyA8IDMpXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIk1pbmltdW0gMyBhcmd1bWVudHMgbXVzdCBiZSBnaXZlbiBvciBzZWNvbmQgcGFyYW1ldGVyIG11c3QgYmUgYW4gb2JqZWN0XCIpOyBpZiAoZS5pc1BsYWluT2JqZWN0KHMpKSB7XG4gICAgICAgIGZvciAodmFyIHUgaW4gcylcbiAgICAgICAgICAgIHQgPSBzW3VdLCBlLmlzUGxhaW5PYmplY3QodCkgPyBpLnNldEl0ZW0odSwgSlNPTi5zdHJpbmdpZnkodCkpIDogaS5zZXRJdGVtKHUsIHQpO1xuICAgICAgICByZXR1cm4gcztcbiAgICB9IGlmICgzID09IG8pXG4gICAgICAgIHJldHVybiBcIm9iamVjdFwiID09IHR5cGVvZiBjID8gaS5zZXRJdGVtKHMsIEpTT04uc3RyaW5naWZ5KGMpKSA6IGkuc2V0SXRlbShzLCBjKSwgYzsgdHJ5IHtcbiAgICAgICAgbnVsbCAhPSAociA9IGkuZ2V0SXRlbShzKSkgJiYgKGwgPSBKU09OLnBhcnNlKHIpKTtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHsgfSByID0gbDsgZm9yICh1ID0gMjsgdSA8IG8gLSAyOyB1KyspXG4gICAgICAgIHJbdCA9IGFbdV1dICYmIGUuaXNQbGFpbk9iamVjdChyW3RdKSB8fCAoclt0XSA9IHt9KSwgciA9IHJbdF07IHJldHVybiByW2FbdV1dID0gYVt1ICsgMV0sIGkuc2V0SXRlbShzLCBKU09OLnN0cmluZ2lmeShsKSksIGw7IH0gZnVuY3Rpb24gcihlKSB7IHZhciBuLCB0LCByID0gYXJndW1lbnRzLmxlbmd0aCwgbyA9IHdpbmRvd1tlXSwgaSA9IGFyZ3VtZW50cywgYSA9IGlbMV07IGlmIChyIDwgMilcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTWluaW11bSAyIGFyZ3VtZW50cyBtdXN0IGJlIGdpdmVuXCIpOyBpZiAoQXJyYXkuaXNBcnJheShhKSkge1xuICAgICAgICBmb3IgKHZhciBzIGluIGEpXG4gICAgICAgICAgICBvLnJlbW92ZUl0ZW0oYVtzXSk7XG4gICAgICAgIHJldHVybiAhMDtcbiAgICB9IGlmICgyID09IHIpXG4gICAgICAgIHJldHVybiBvLnJlbW92ZUl0ZW0oYSksICEwOyB0cnkge1xuICAgICAgICBuID0gdCA9IEpTT04ucGFyc2Uoby5nZXRJdGVtKGEpKTtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKGEgKyBcIiBpcyBub3QgZGVmaW5lZCBpbiB0aGlzIHN0b3JhZ2VcIik7XG4gICAgfSBmb3IgKHMgPSAyOyBzIDwgciAtIDE7IHMrKylcbiAgICAgICAgaWYgKHZvaWQgMCA9PT0gKHQgPSB0W2lbc11dKSlcbiAgICAgICAgICAgIHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcihbXS5zbGljZS5jYWxsKGksIDEsIHMpLmpvaW4oXCIuXCIpICsgXCIgaXMgbm90IGRlZmluZWQgaW4gdGhpcyBzdG9yYWdlXCIpOyBpZiAoQXJyYXkuaXNBcnJheShpW3NdKSlcbiAgICAgICAgZm9yICh2YXIgYyBpbiBpW3NdKVxuICAgICAgICAgICAgZGVsZXRlIHRbaVtzXVtjXV07XG4gICAgZWxzZVxuICAgICAgICBkZWxldGUgdFtpW3NdXTsgcmV0dXJuIG8uc2V0SXRlbShhLCBKU09OLnN0cmluZ2lmeShuKSksICEwOyB9IGZ1bmN0aW9uIG8odCkgeyB2YXIgciA9IGFyZ3VtZW50cy5sZW5ndGgsIGkgPSBhcmd1bWVudHMsIHMgPSBpWzFdOyBpZiAoMSA9PSByKVxuICAgICAgICByZXR1cm4gMCA9PSBhKHQpLmxlbmd0aDsgaWYgKEFycmF5LmlzQXJyYXkocykpIHtcbiAgICAgICAgZm9yICh2YXIgYyA9IDA7IGMgPCBzLmxlbmd0aDsgYysrKVxuICAgICAgICAgICAgaWYgKCFvKHQsIHNbY10pKVxuICAgICAgICAgICAgICAgIHJldHVybiAhMTtcbiAgICAgICAgcmV0dXJuICEwO1xuICAgIH0gdHJ5IHtcbiAgICAgICAgdmFyIGwgPSBuLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgIGZvciAodmFyIGMgaW4gQXJyYXkuaXNBcnJheShpW3IgLSAxXSkgfHwgKGwgPSB7IHRvdGVzdDogbCB9KSwgbClcbiAgICAgICAgICAgIGlmICghKGUuaXNQbGFpbk9iamVjdChsW2NdKSAmJiBlLmlzRW1wdHlPYmplY3QobFtjXSkgfHwgQXJyYXkuaXNBcnJheShsW2NdKSAmJiAhbFtjXS5sZW5ndGgpICYmIGxbY10pXG4gICAgICAgICAgICAgICAgcmV0dXJuICExO1xuICAgICAgICByZXR1cm4gITA7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIHJldHVybiAhMDtcbiAgICB9IH0gZnVuY3Rpb24gaShlKSB7IHZhciB0ID0gYXJndW1lbnRzLmxlbmd0aCwgciA9IGFyZ3VtZW50cywgbyA9IHJbMV07IGlmICh0IDwgMilcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTWluaW11bSAyIGFyZ3VtZW50cyBtdXN0IGJlIGdpdmVuXCIpOyBpZiAoQXJyYXkuaXNBcnJheShvKSkge1xuICAgICAgICBmb3IgKHZhciBhID0gMDsgYSA8IG8ubGVuZ3RoOyBhKyspXG4gICAgICAgICAgICBpZiAoIWkoZSwgb1thXSkpXG4gICAgICAgICAgICAgICAgcmV0dXJuICExO1xuICAgICAgICByZXR1cm4gITA7XG4gICAgfSB0cnkge1xuICAgICAgICB2YXIgcyA9IG4uYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgZm9yICh2YXIgYSBpbiBBcnJheS5pc0FycmF5KHJbdCAtIDFdKSB8fCAocyA9IHsgdG90ZXN0OiBzIH0pLCBzKVxuICAgICAgICAgICAgaWYgKHZvaWQgMCA9PT0gc1thXSB8fCBudWxsID09PSBzW2FdKVxuICAgICAgICAgICAgICAgIHJldHVybiAhMTtcbiAgICAgICAgcmV0dXJuICEwO1xuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgICByZXR1cm4gITE7XG4gICAgfSB9IGZ1bmN0aW9uIGEodCkgeyB2YXIgciA9IGFyZ3VtZW50cy5sZW5ndGgsIG8gPSB3aW5kb3dbdF0sIGkgPSBhcmd1bWVudHMsIGEgPSBbXSwgcyA9IHt9OyBpZiAoKHMgPSByID4gMSA/IG4uYXBwbHkodGhpcywgaSkgOiBvKS5fY29va2llKVxuICAgICAgICBmb3IgKHZhciBjIGluIGUuY29va2llKCkpXG4gICAgICAgICAgICBcIlwiICE9IGMgJiYgYS5wdXNoKGMucmVwbGFjZShzLl9wcmVmaXgsIFwiXCIpKTtcbiAgICBlbHNlXG4gICAgICAgIGZvciAodmFyIGwgaW4gcylcbiAgICAgICAgICAgIGEucHVzaChsKTsgcmV0dXJuIGE7IH0gZnVuY3Rpb24gcyhuKSB7IGlmICghbiB8fCBcInN0cmluZ1wiICE9IHR5cGVvZiBuKVxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJGaXJzdCBwYXJhbWV0ZXIgbXVzdCBiZSBhIHN0cmluZ1wiKTsgYyA/ICh3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0obikgfHwgd2luZG93LmxvY2FsU3RvcmFnZS5zZXRJdGVtKG4sIFwie31cIiksIHdpbmRvdy5zZXNzaW9uU3RvcmFnZS5nZXRJdGVtKG4pIHx8IHdpbmRvdy5zZXNzaW9uU3RvcmFnZS5zZXRJdGVtKG4sIFwie31cIikpIDogKHdpbmRvdy5sb2NhbENvb2tpZVN0b3JhZ2UuZ2V0SXRlbShuKSB8fCB3aW5kb3cubG9jYWxDb29raWVTdG9yYWdlLnNldEl0ZW0obiwgXCJ7fVwiKSwgd2luZG93LnNlc3Npb25Db29raWVTdG9yYWdlLmdldEl0ZW0obikgfHwgd2luZG93LnNlc3Npb25Db29raWVTdG9yYWdlLnNldEl0ZW0obiwgXCJ7fVwiKSk7IHZhciB0ID0geyBsb2NhbFN0b3JhZ2U6IE9iamVjdC5hc3NpZ24oe30sIGUubG9jYWxTdG9yYWdlLCB7IF9uczogbiB9KSwgc2Vzc2lvblN0b3JhZ2U6IE9iamVjdC5hc3NpZ24oe30sIGUuc2Vzc2lvblN0b3JhZ2UsIHsgX25zOiBuIH0pIH07IHJldHVybiBlLmNvb2tpZSAmJiAod2luZG93LmNvb2tpZVN0b3JhZ2UuZ2V0SXRlbShuKSB8fCB3aW5kb3cuY29va2llU3RvcmFnZS5zZXRJdGVtKG4sIFwie31cIiksIHQuY29va2llU3RvcmFnZSA9IE9iamVjdC5hc3NpZ24oe30sIGUuY29va2llU3RvcmFnZSwgeyBfbnM6IG4gfSkpLCBlLm5hbWVzcGFjZVN0b3JhZ2VzW25dID0gdCwgdDsgfSB2YXIgYyA9IGZ1bmN0aW9uIChlKSB7IHZhciBuID0gXCJqc2FwaVwiOyB0cnkge1xuICAgICAgICByZXR1cm4gISF3aW5kb3dbZV0gJiYgKHdpbmRvd1tlXS5zZXRJdGVtKG4sIG4pLCB3aW5kb3dbZV0ucmVtb3ZlSXRlbShuKSwgITApO1xuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgICByZXR1cm4gITE7XG4gICAgfSB9KFwibG9jYWxTdG9yYWdlXCIpLCBsID0geyBfdHlwZTogXCJcIiwgX25zOiBcIlwiLCBfY2FsbE1ldGhvZDogZnVuY3Rpb24gKGUsIG4pIHsgdmFyIHQgPSBbdGhpcy5fdHlwZV0sIHIgPSAobiA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKG4pKVswXTsgcmV0dXJuIHRoaXMuX25zICYmIHQucHVzaCh0aGlzLl9ucyksIFwic3RyaW5nXCIgPT0gdHlwZW9mIHIgJiYgLTEgIT09IHIuaW5kZXhPZihcIi5cIikgJiYgKG4uc2hpZnQoKSwgW10udW5zaGlmdC5hcHBseShuLCByLnNwbGl0KFwiLlwiKSkpLCBbXS5wdXNoLmFwcGx5KHQsIG4pLCBlLmFwcGx5KHRoaXMsIHQpOyB9LCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuX2NhbGxNZXRob2QobiwgYXJndW1lbnRzKTsgfSwgc2V0OiBmdW5jdGlvbiAoKSB7IHZhciBuID0gYXJndW1lbnRzLmxlbmd0aCwgciA9IGFyZ3VtZW50cywgbyA9IHJbMF07IGlmIChuIDwgMSB8fCAhZS5pc1BsYWluT2JqZWN0KG8pICYmIG4gPCAyKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTWluaW11bSAyIGFyZ3VtZW50cyBtdXN0IGJlIGdpdmVuIG9yIGZpcnN0IHBhcmFtZXRlciBtdXN0IGJlIGFuIG9iamVjdFwiKTsgaWYgKGUuaXNQbGFpbk9iamVjdChvKSAmJiB0aGlzLl9ucykge1xuICAgICAgICAgICAgZm9yICh2YXIgaSBpbiBvKVxuICAgICAgICAgICAgICAgIHQodGhpcy5fdHlwZSwgdGhpcy5fbnMsIGksIG9baV0pO1xuICAgICAgICAgICAgcmV0dXJuIG87XG4gICAgICAgIH0gdmFyIGEgPSB0aGlzLl9jYWxsTWV0aG9kKHQsIHIpOyByZXR1cm4gdGhpcy5fbnMgPyBhW28uc3BsaXQoXCIuXCIpWzBdXSA6IGE7IH0sIHJlbW92ZTogZnVuY3Rpb24gKCkgeyBpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDEpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJNaW5pbXVtIDEgYXJndW1lbnQgbXVzdCBiZSBnaXZlblwiKTsgcmV0dXJuIHRoaXMuX2NhbGxNZXRob2QociwgYXJndW1lbnRzKTsgfSwgcmVtb3ZlQWxsOiBmdW5jdGlvbiAobikgeyByZXR1cm4gdGhpcy5fbnMgPyAodCh0aGlzLl90eXBlLCB0aGlzLl9ucywge30pLCAhMCkgOiBmdW5jdGlvbiAobiwgdCkgeyB2YXIgbyA9IGEobik7IGZvciAodmFyIGkgaW4gbylcbiAgICAgICAgICAgIHIobiwgb1tpXSk7IGlmICh0KVxuICAgICAgICAgICAgZm9yICh2YXIgaSBpbiBlLm5hbWVzcGFjZVN0b3JhZ2VzKVxuICAgICAgICAgICAgICAgIHMoaSk7IH0odGhpcy5fdHlwZSwgbik7IH0sIGlzRW1wdHk6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuX2NhbGxNZXRob2QobywgYXJndW1lbnRzKTsgfSwgaXNTZXQ6IGZ1bmN0aW9uICgpIHsgaWYgKGFyZ3VtZW50cy5sZW5ndGggPCAxKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTWluaW11bSAxIGFyZ3VtZW50IG11c3QgYmUgZ2l2ZW5cIik7IHJldHVybiB0aGlzLl9jYWxsTWV0aG9kKGksIGFyZ3VtZW50cyk7IH0sIGtleXM6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuX2NhbGxNZXRob2QoYSwgYXJndW1lbnRzKTsgfSB9OyBlLmNvb2tpZSAmJiAod2luZG93Lm5hbWUgfHwgKHdpbmRvdy5uYW1lID0gTWF0aC5mbG9vcigxZTggKiBNYXRoLnJhbmRvbSgpKSkpLCBlLmluaXROYW1lc3BhY2VTdG9yYWdlID0gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIHMoZSk7IH0sIGMgPyAoZS5sb2NhbFN0b3JhZ2UgPSBPYmplY3QuYXNzaWduKHt9LCBsLCB7IF90eXBlOiBcImxvY2FsU3RvcmFnZVwiIH0pLCBlLnNlc3Npb25TdG9yYWdlID0gT2JqZWN0LmFzc2lnbih7fSwgbCwgeyBfdHlwZTogXCJzZXNzaW9uU3RvcmFnZVwiIH0pKSA6IChlLmxvY2FsU3RvcmFnZSA9IE9iamVjdC5hc3NpZ24oe30sIGwsIHsgX3R5cGU6IFwibG9jYWxDb29raWVTdG9yYWdlXCIgfSksIGUuc2Vzc2lvblN0b3JhZ2UgPSBPYmplY3QuYXNzaWduKHt9LCBsLCB7IF90eXBlOiBcInNlc3Npb25Db29raWVTdG9yYWdlXCIgfSkpLCBlLm5hbWVzcGFjZVN0b3JhZ2VzID0ge30sIGUucmVtb3ZlQWxsU3RvcmFnZXMgPSBmdW5jdGlvbiAobikgeyBlLmxvY2FsU3RvcmFnZS5yZW1vdmVBbGwobiksIGUuc2Vzc2lvblN0b3JhZ2UucmVtb3ZlQWxsKG4pLCBlLmNvb2tpZVN0b3JhZ2UgJiYgZS5jb29raWVTdG9yYWdlLnJlbW92ZUFsbChuKSwgbiB8fCAoZS5uYW1lc3BhY2VTdG9yYWdlcyA9IHt9KTsgfTsgfSwgbWUgPSBmdW5jdGlvbiAoKSB7IHZhciBlID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJjb29raWVcIiksIG4gPSBwbi5jb250YWluZXIucmVzb2x2ZShcImpxVXRpbHNcIiksIHQgPSB7IGNvb2tpZTogZS5zZXQsIGlzUGxhaW5PYmplY3Q6IG4uaXNQbGFpbk9iamVjdCwgaXNFbXB0eU9iamVjdDogbi5pc0VtcHR5T2JqZWN0IH07IGZlKHQpOyByZXR1cm4geyBnZXQ6IGZ1bmN0aW9uIChlKSB7IGlmICh3aW5kb3cubG9jYWxTdG9yYWdlICYmIFwiZnVuY3Rpb25cIiA9PSB0eXBlb2Ygd2luZG93LmxvY2FsU3RvcmFnZS5nZXRJdGVtKVxuICAgICAgICAgICAgcmV0dXJuIHQubG9jYWxTdG9yYWdlLmdldChlKTsgfSwgc2V0OiBmdW5jdGlvbiAoZSwgbikgeyB3aW5kb3cubG9jYWxTdG9yYWdlICYmIFwiZnVuY3Rpb25cIiA9PSB0eXBlb2Ygd2luZG93LmxvY2FsU3RvcmFnZS5nZXRJdGVtICYmIHQubG9jYWxTdG9yYWdlLnNldChlLCBuKTsgfSwgcmVtb3ZlOiBmdW5jdGlvbiAoZSkgeyB3aW5kb3cubG9jYWxTdG9yYWdlICYmIFwiZnVuY3Rpb25cIiA9PSB0eXBlb2Ygd2luZG93LmxvY2FsU3RvcmFnZS5nZXRJdGVtICYmIHQubG9jYWxTdG9yYWdlLnJlbW92ZShlKTsgfSB9OyB9KCk7XG4gICAgcG4uY29udGFpbmVyLnJlZ2lzdGVyKFwibG9jYWxTdG9yYWdlXCIsIHsgdXNlVmFsdWU6IG1lIH0pLCBwbi5sb2NhbFN0b3JhZ2UgPSBwbi5jb250YWluZXIucmVzb2x2ZShcImxvY2FsU3RvcmFnZVwiKTtcbiAgICB2YXIgZ2UsIHZlID0gKGdlID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gXCIxNC4xNDIuMSwgc2VydmVyLXYxNC4xNDIuMS1UUy1lZGl0aW9uXCI7IH0sIHdpbmRvdy5fX3RwVmVyc2lvbiA9IFwiMTQuMTQyLjEsIHNlcnZlci12MTQuMTQyLjEtVFMtZWRpdGlvblwiLCB7IG5hbWU6IFwidmVyc2lvblNlcnZpY2VcIiwgZ2V0VGlueXBhc3NWZXJzaW9uOiBnZSB9KTtcbiAgICBwbi5jb250YWluZXIucmVnaXN0ZXIoXCJ2ZXJzaW9uU2VydmljZVwiLCB7IHVzZVZhbHVlOiB2ZSB9KSwgcG4udmVyc2lvblNlcnZpY2UgPSBwbi5jb250YWluZXIucmVzb2x2ZShcInZlcnNpb25TZXJ2aWNlXCIpO1xuICAgIHZhciBoZSA9IGZ1bmN0aW9uICgpIHsgdmFyIGUsIG4gPSBwbi5jb250YWluZXIucmVzb2x2ZShcImFqYXhcIiksIHQgPSB7fTsgcmV0dXJuIHsgbmFtZTogXCJpdHBcIiwgc3luY2hyb25pemVDb29raWU6IGZ1bmN0aW9uIChyLCBvLCBpKSB7IGlmIChwbi5jbG91ZGZsYXJlV29ya2VyVXJsKSB7XG4gICAgICAgICAgICAhZnVuY3Rpb24gKGUsIG4sIHIpIHsgaWYgKHRbZV0gPSB7IHZhbHVlOiBuIH0sICFyKVxuICAgICAgICAgICAgICAgIHJldHVybjsgciBpbnN0YW5jZW9mIERhdGUgPyB0W2VdLmV4cGlyZXMgPSByIDogdFtlXS5tYXhBZ2UgPSAzNjAwICogcjsgfShyLCBvLCBpKSwgZSAmJiBjbGVhclRpbWVvdXQoZSksIGUgPSBzZXRUaW1lb3V0KChmdW5jdGlvbiAoKSB7IG4ucmVxdWVzdCh7IHVybDogcG4uY2xvdWRmbGFyZVdvcmtlclVybCArIFwiP21heEFnZT0yNjI4MDAwXCIsIHR5cGU6IFwiUE9TVFwiLCBkYXRhOiBKU09OLnN0cmluZ2lmeSh0KSwgY3Jvc3NEb21haW46ICEwLCB4aHJGaWVsZHM6IHsgd2l0aENyZWRlbnRpYWxzOiAhMCB9LCBlcnJvcjogZnVuY3Rpb24gKGUsIG4pIHsgY29uc29sZS5lcnJvcihuKTsgfSB9KSwgdCA9IHt9OyB9KSwgMjUwMCk7XG4gICAgICAgIH0gfSB9OyB9KCk7XG4gICAgcG4uY29udGFpbmVyLnJlZ2lzdGVyKFwiaXRwXCIsIHsgdXNlVmFsdWU6IGhlIH0pLCBwbi5pdHAgPSBwbi5jb250YWluZXIucmVzb2x2ZShcIml0cFwiKTtcbiAgICB2YXIgd2UgPSBmdW5jdGlvbiAoZSwgbikgeyByZXR1cm4gd2UgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwgeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZSwgbikgeyBlLl9fcHJvdG9fXyA9IG47IH0gfHwgZnVuY3Rpb24gKGUsIG4pIHsgZm9yICh2YXIgdCBpbiBuKVxuICAgICAgICBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobiwgdCkgJiYgKGVbdF0gPSBuW3RdKTsgfSwgd2UoZSwgbik7IH07XG4gICAgdmFyIHllID0gZnVuY3Rpb24gKCkgeyByZXR1cm4geWUgPSBPYmplY3QuYXNzaWduIHx8IGZ1bmN0aW9uIChlKSB7IGZvciAodmFyIG4sIHQgPSAxLCByID0gYXJndW1lbnRzLmxlbmd0aDsgdCA8IHI7IHQrKylcbiAgICAgICAgZm9yICh2YXIgbyBpbiBuID0gYXJndW1lbnRzW3RdKVxuICAgICAgICAgICAgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG4sIG8pICYmIChlW29dID0gbltvXSk7IHJldHVybiBlOyB9LCB5ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOyB9O1xuICAgIGZ1bmN0aW9uIGJlKGUsIG4pIHsgcmV0dXJuIGZ1bmN0aW9uICh0LCByKSB7IG4odCwgciwgZSk7IH07IH1cbiAgICBmdW5jdGlvbiBrZShlLCBuKSB7IGlmIChcIm9iamVjdFwiID09IHR5cGVvZiBSZWZsZWN0ICYmIFwiZnVuY3Rpb25cIiA9PSB0eXBlb2YgUmVmbGVjdC5tZXRhZGF0YSlcbiAgICAgICAgcmV0dXJuIFJlZmxlY3QubWV0YWRhdGEoZSwgbik7IH1cbiAgICBmdW5jdGlvbiBfZShlLCBuLCB0KSB7IGlmICh0IHx8IDIgPT09IGFyZ3VtZW50cy5sZW5ndGgpXG4gICAgICAgIGZvciAodmFyIHIsIG8gPSAwLCBpID0gbi5sZW5ndGg7IG8gPCBpOyBvKyspXG4gICAgICAgICAgICAhciAmJiBvIGluIG4gfHwgKHIgfHwgKHIgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChuLCAwLCBvKSksIHJbb10gPSBuW29dKTsgcmV0dXJuIGUuY29uY2F0KHIgfHwgQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwobikpOyB9XG4gICAgdmFyIENlID0gZnVuY3Rpb24gKGUpIHsgdm9pZCAwID09PSBlICYmIChlID0gcG4uY29udGFpbmVyKTsgdmFyIG4sIHQgPSBlLnJlc29sdmUoXCJqcVV0aWxzXCIpLCByID0gZS5yZXNvbHZlKFwiY29va2llXCIpLCBvID0gZS5yZXNvbHZlKFwidmVyc2lvblNlcnZpY2VcIiksIGkgPSBlLnJlc29sdmUoXCJpdHBcIiksIGEgPSBlLnJlc29sdmUoXCJsb2NhbFN0b3JhZ2VcIiksIHMgPSBcIlwiLCBjID0geyBFTkFCTEVEX0FGVEVSX0RJU0FCTEVEOiAtMiwgTk9UX0RFVEVDVEVEOiAtMSwgRElTQUJMRUQ6IDAsIEVOQUJMRUQ6IDEgfTsgdm9pZCAwID09PSBcInRlc3RTdHJpbmdcIi50b0hleCAmJiBPYmplY3QuZGVmaW5lUHJvcGVydHkoU3RyaW5nLnByb3RvdHlwZSwgXCJ0b0hleFwiLCB7IGVudW1lcmFibGU6ICExLCB2YWx1ZTogZnVuY3Rpb24gKCkgeyBmb3IgKHZhciBlID0gXCJcIiwgbiA9IDA7IG4gPCB0aGlzLmxlbmd0aDsgKytuKVxuICAgICAgICAgICAgZSArPSBcIlwiICsgdGhpcy5jaGFyQ29kZUF0KG4pLnRvU3RyaW5nKDE2KTsgcmV0dXJuIGU7IH0gfSk7IHZhciBsID0gZnVuY3Rpb24gKGUsIG4sIHQpIHsgdmFyIG8gPSB7IHBhdGg6IFwiL1wiLCBleHBpcmVzOiAwIH07IHZvaWQgMCAhPT0gbiAmJiAoby5kb21haW4gPSBuKSwgdm9pZCAwICE9PSB0ICYmIChvLnBhdGggPSB0KSwgci5yZW1vdmUoZSwgbyk7IH0sIHUgPSBmdW5jdGlvbiAoZSwgbiwgdCkgeyAtMSAhPT0gbi5pbmRleE9mKFwiYWJyaWwuY29tLmJyXCIpICYmIGwoZSwgXCIuYWJyaWwuY29tLmJyXCIsIHQpLCAtMSAhPT0gbi5pbmRleE9mKFwic2NvdHNtYW4uY29tXCIpICYmIGwoZSwgXCIuc2NvdHNtYW4uY29tXCIsIHQpOyB9LCBkID0gZnVuY3Rpb24gKGUpIHsgdmFyIG47IGlmICgwID09PSBkb2N1bWVudC5jb29raWUubGVuZ3RoKVxuICAgICAgICByZXR1cm4gbnVsbDsgaWYgKGUgaW5zdGFuY2VvZiBSZWdFeHApXG4gICAgICAgIGZvciAodmFyIHQgPSBkb2N1bWVudC5jb29raWUuc3BsaXQoXCI7XCIpLCByID0gMDsgciA8IHQubGVuZ3RoOyByKyspIHtcbiAgICAgICAgICAgIHZhciBvID0gdFtyXS5pbmRleE9mKFwiPVwiKTtcbiAgICAgICAgICAgIGlmICgtMSAhPT0gbykge1xuICAgICAgICAgICAgICAgIHZhciBpLCBhID0gdFtyXS5zdWJzdHIoMCwgbykudHJpbSgpO1xuICAgICAgICAgICAgICAgIGlmIChlLnRlc3QoYSkpIHtcbiAgICAgICAgICAgICAgICAgICAgaSA9IHRbcl0uc3Vic3RyKG8gKyAxKS50cmltKCk7XG4gICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KGkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNhdGNoIChuKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmKCdDb3VsZCBub3QgdXJpLWRlY29kZSBjb29raWUgXCInICsgZS50b1N0cmluZygpICsgJ1wiJywgbik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHZhciBzID0gKFwiOyBcIiArIGRvY3VtZW50LmNvb2tpZSkuc3BsaXQoXCI7IFwiICsgZSArIFwiPVwiKTtcbiAgICAgICAgaWYgKHMubGVuZ3RoID49IDIpIHtcbiAgICAgICAgICAgIHZhciBjID0gbnVsbCA9PT0gKG4gPSBzLnBvcCgpKSB8fCB2b2lkIDAgPT09IG4gPyB2b2lkIDAgOiBuLnNwbGl0KFwiO1wiKS5zaGlmdCgpO1xuICAgICAgICAgICAgaWYgKHZvaWQgMCA9PT0gYylcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChuKSB7XG4gICAgICAgICAgICAgICAgZignQ291bGQgbm90IHVyaS1kZWNvZGUgY29va2llIFwiJyArIGUgKyAnXCInLCBuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBjO1xuICAgICAgICB9XG4gICAgfSByZXR1cm4gbnVsbDsgfSwgcCA9IGZ1bmN0aW9uIChlKSB7IGlmICgwID09PSBkb2N1bWVudC5jb29raWUubGVuZ3RoKVxuICAgICAgICByZXR1cm4gW107IGZvciAodmFyIG4gPSBbXSwgdCA9IGRvY3VtZW50LmNvb2tpZS5zcGxpdChcIjtcIiksIHIgPSAwOyByIDwgdC5sZW5ndGg7IHIrKykge1xuICAgICAgICB2YXIgbyA9IHRbcl0uaW5kZXhPZihcIj1cIik7XG4gICAgICAgIGlmICgtMSAhPT0gbykge1xuICAgICAgICAgICAgdmFyIGksIGEgPSB0W3JdLnN1YnN0cigwLCBvKS50cmltKCk7XG4gICAgICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIFJlZ0V4cCAmJiBlLnRlc3QoYSkpIHtcbiAgICAgICAgICAgICAgICBpID0gdFtyXS5zdWJzdHIobyArIDEpLnJlcGxhY2UoL15cXHMrfFxccyskL2csIFwiXCIpO1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIGkgPSBkZWNvZGVVUklDb21wb25lbnQoaSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhdGNoIChuKSB7XG4gICAgICAgICAgICAgICAgICAgIGYoJ0NvdWxkIG5vdCB1cmktZGVjb2RlIGNvb2tpZSBcIicgKyBlLnRvU3RyaW5nKCkgKyAnXCInLCBuKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgbi5wdXNoKHsgbmFtZTogYSwgdmFsdWU6IGkgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChhID09PSBlKSB7XG4gICAgICAgICAgICAgICAgaSA9IHRbcl0uc3Vic3RyKG8gKyAxKS5yZXBsYWNlKC9eXFxzK3xcXHMrJC9nLCBcIlwiKTtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICBpID0gZGVjb2RlVVJJQ29tcG9uZW50KGkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYXRjaCAobikge1xuICAgICAgICAgICAgICAgICAgICBmKCdDb3VsZCBub3QgdXJpLWRlY29kZSBjb29raWUgXCInICsgZSArICdcIicsIG4pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBuLnB1c2goeyBuYW1lOiBhLCB2YWx1ZTogaSB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0gcmV0dXJuIG47IH07IGZ1bmN0aW9uIGYoKSB7IGZvciAodmFyIGUgPSBbXSwgbiA9IDA7IG4gPCBhcmd1bWVudHMubGVuZ3RoOyBuKyspXG4gICAgICAgIGVbbl0gPSBhcmd1bWVudHNbbl07ICEwID09PSBwbi5kZWJ1ZyAmJiBtLmFwcGx5KHZvaWQgMCwgZSk7IH0gZnVuY3Rpb24gbSgpIHsgZm9yICh2YXIgZSA9IFtdLCBuID0gMDsgbiA8IGFyZ3VtZW50cy5sZW5ndGg7IG4rKylcbiAgICAgICAgZVtuXSA9IGFyZ3VtZW50c1tuXTsgaWYgKHdpbmRvdy5jb25zb2xlICYmIHdpbmRvdy5jb25zb2xlLmxvZyAmJiB3aW5kb3cuY29uc29sZS5sb2cuYXBwbHkgJiYgd2luZG93LmNvbnNvbGUubG9nLmFwcGx5LmNhbGwgJiYgdm9pZCAwICE9PSB3aW5kb3cuY29uc29sZSAmJiB2b2lkIDAgIT09IHdpbmRvdy5jb25zb2xlLmxvZykge1xuICAgICAgICB2YXIgdCA9IFtcIlRQOlwiXTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGZvciAodmFyIHIgPSAwOyByIDwgZS5sZW5ndGg7IHIrKylcbiAgICAgICAgICAgICAgICB0LnB1c2goZVtyXSk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKG4pIHtcbiAgICAgICAgICAgIHQgPSBlO1xuICAgICAgICB9XG4gICAgICAgIEcoKSAmJiAodCA9IHYodCkpLCBcIm9iamVjdFwiID09IHR5cGVvZiB3aW5kb3cuY29uc29sZS5sb2cgPyB3aW5kb3cuY29uc29sZS5sb2cuYXBwbHkuY2FsbCh0aGlzLCBjb25zb2xlLCB0KSA6IGNvbnNvbGUubG9nLmFwcGx5KGNvbnNvbGUsIHQpO1xuICAgIH0gfSB2YXIgZyA9IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSAwOyByZXR1cm4gd2luZG93LnBhZ2VZT2Zmc2V0ID8gZSA9IHdpbmRvdy5wYWdlWU9mZnNldCA6IGUgPSBcIm51bWJlclwiID09IHR5cGVvZiAoZSA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCB8fCBkb2N1bWVudC5ib2R5LnBhcmVudE5vZGUpLnNjcm9sbFRvcCA/IGUuc2Nyb2xsVG9wIDogZG9jdW1lbnQuYm9keS5zY3JvbGxUb3AsIGU7IH0sIHYgPSBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IFwiXCI7IHRyeSB7XG4gICAgICAgIGZvciAodmFyIHQgPSAwOyB0IDwgZS5sZW5ndGg7IHQrKylcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgbiArPSBKU09OLnN0cmluZ2lmeShlW3RdKSArIFwiLCBcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgbiArPSBcIlwiICsgZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFtuXTtcbiAgICB9XG4gICAgY2F0Y2ggKG4pIHtcbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfSB9LCBoID0gZnVuY3Rpb24gKCkgeyB2YXIgZSwgbjsgcmV0dXJuIFwiQ1NTMUNvbXBhdFwiID09PSBkb2N1bWVudC5jb21wYXRNb2RlID8gKGUgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGgsIG4gPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0KSA6IChlID0gZG9jdW1lbnQuYm9keS5jbGllbnRXaWR0aCwgbiA9IGRvY3VtZW50LmJvZHkuY2xpZW50SGVpZ2h0KSwgeyB4OiBlLCB5OiBuIH07IH0sIHcgPSBmdW5jdGlvbiAoZSkgeyBlID0gZS5yZXBsYWNlKC9bXFxbXS8sIFwiXFxcXFtcIikucmVwbGFjZSgvW1xcXV0vLCBcIlxcXFxdXCIpOyB2YXIgbiA9IG5ldyBSZWdFeHAoXCJbXFxcXD8mXVwiICsgZSArIFwiPShbXiYjXSopXCIpLmV4ZWMobG9jYXRpb24uc2VhcmNoKTsgcmV0dXJuIG51bGwgPT09IG4gPyBcIlwiIDogZGVjb2RlVVJJQ29tcG9uZW50KG5bMV0ucmVwbGFjZSgvXFwrL2csIFwiIFwiKSk7IH0sIHkgPSBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IGUobG9jYXRpb24uaHJlZik7IGlmIChoaXN0b3J5ICYmIFwiZnVuY3Rpb25cIiA9PSB0eXBlb2YgaGlzdG9yeS5yZXBsYWNlU3RhdGUpIHtcbiAgICAgICAgdmFyIHQgPSBcIm9iamVjdFwiID09IHR5cGVvZiB3aW5kb3cubmV4dCAmJiBcIm9iamVjdFwiID09IHR5cGVvZiB3aW5kb3cubmV4dC5yb3V0ZXIgPyB7IHVybDogZShoaXN0b3J5LnN0YXRlLnVybCB8fCBcIlwiKSwgYXM6IGUoaGlzdG9yeS5zdGF0ZS5hcyB8fCBcIlwiKSwgb3B0aW9uczogaGlzdG9yeS5zdGF0ZS5vcHRpb25zIH0gOiBoaXN0b3J5LnN0YXRlO1xuICAgICAgICBoaXN0b3J5LnJlcGxhY2VTdGF0ZSh0LCBkb2N1bWVudC50aXRsZSwgbik7XG4gICAgfVxuICAgIGVsc2VcbiAgICAgICAgbG9jYXRpb24uaHJlZiA9IG47IH0sIGIgPSBmdW5jdGlvbiAoZSwgbiwgdCkgeyB2YXIgciA9IHllKHsgcGF0aDogXCIvXCIsIGV4cGlyZXM6IDczMCB9LCB0ICYmIHsgZG9tYWluOiB0IH0pLCBvID0gUygpOyBmb3IgKHZhciBpIGluIG8pXG4gICAgICAgIGwoZSwgb1tpXSk7IHIuZG9tYWluICYmIHUoZSwgci5kb21haW4pLCAocG4uY29va2llRG9tYWluIHx8IHBuLmNvb2tpZVBhdGgpICYmIChyLmRvbWFpbiA9IHBuLmNvb2tpZURvbWFpbiA/IHBuLmNvb2tpZURvbWFpbiA6IHIuZG9tYWluLCBsKGUsIHIuZG9tYWluLCByLnBhdGgpLCByLnBhdGggPSBwbi5jb29raWVQYXRoID8gcG4uY29va2llUGF0aCA6IHIucGF0aCwgbChlLCByLmRvbWFpbiwgci5wYXRoKSksIGwoZSksIHEoZSwgbiwgcik7IH0sIGsgPSBmdW5jdGlvbiAoKSB7IHZhciBlLCBuLCB0ID0gXCJnZXRfdG9wX2xldmVsX2RvbWFpbl9jb29raWVcIiwgciA9IGRvY3VtZW50LmxvY2F0aW9uLmhvc3RuYW1lLnNwbGl0KFwiLlwiKTsgZm9yIChlID0gci5sZW5ndGggLSAxOyBlID49IDA7IGUtLSkge1xuICAgICAgICB2YXIgbyA9IHsgcGF0aDogXCIvXCIsIGRvbWFpbjogbiA9IFwiLlwiICsgci5zbGljZShlKS5qb2luKFwiLlwiKSB9O1xuICAgICAgICBpZiAocSh0LCBuLCBvKSwgVih0KSlcbiAgICAgICAgICAgIHJldHVybiBvLmV4cGlyZXMgPSBuZXcgRGF0ZSgxKSwgcSh0LCBuLCBvKSwgbjtcbiAgICB9IH0sIF8gPSBmdW5jdGlvbiAoZSkgeyByZXR1cm4gcG4udXNlQWlkU3BlY2lmaWVkQ29va2llcyAmJiBwbi5haWQgPyBlICsgXCJfXCIgKyBwbi5haWQgOiBlOyB9LCBDID0gZnVuY3Rpb24gKCkgeyB2YXIgZSwgbiA9IF8oXCJfX3Bsc1wiKSwgdCA9IGQobik7IGlmICh0KVxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgaWYgKChlID0gSlNPTi5wYXJzZSh0KSkgJiYgIUFycmF5LmlzQXJyYXkoZSkpXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiUHVzaCBsaXN0IHN1YnNjcmlwdGlvbnMgbXVzdCBiZSBhbiBhcnJheVwiKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgZihcIkNhbid0IGdldCBwdXNoIGxpc3Qgc3Vic2NyaXB0aW9uc1wiLCBlKTtcbiAgICAgICAgfSByZXR1cm4gZTsgfSwgSSA9IGZ1bmN0aW9uIChlKSB7IG4gPSBlOyB2YXIgdCA9IGsoKTsgcShcIl9fcGF0XCIsIG4sIHsgcGF0aDogXCIvXCIsIGV4cGlyZXM6IDMwLCBkb21haW46IHQgfSk7IH0sIFMgPSBmdW5jdGlvbiAoKSB7IHZhciBlID0gW107IGUucHVzaChkb2N1bWVudC5kb21haW4pOyBmb3IgKHZhciBuID0gZG9jdW1lbnQuZG9tYWluLnNwbGl0KFwiLlwiKTsgbi5sZW5ndGggPj0gMjspXG4gICAgICAgIGUucHVzaChcIi5cIiArIG4uam9pbihcIi5cIikpLCBuLnNoaWZ0KCk7IHJldHVybiBlOyB9LCB4ID0gZnVuY3Rpb24gKGUpIHsgdmFyIG4gPSBWKGUpOyByZXR1cm4gXCJib29sZWFuXCIgPT09IHQudHlwZShuKSB8fCBcInN0cmluZ1wiID09PSB0LnR5cGUobikgJiYgbi5sZW5ndGggPyAhMCA9PT0gbiB8fCBcInRydWVcIiA9PT0gbiA/IGMuRU5BQkxFRCA6IGMuRElTQUJMRUQgOiBjLk5PVF9ERVRFQ1RFRDsgfSwgUCA9IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSBWKFwiX19wbmFoY1wiKSwgbiA9ICExOyByZXR1cm4gdm9pZCAwID09PSBlICYmIChlID0gXCIwXCIsIG4gPSAhMCksIHsgY29va2llVmFsdWU6IHBhcnNlSW50KGUsIDEwKSwgaXNGaXJzdDogbiB9OyB9LCBFID0ge30sIFQgPSBmdW5jdGlvbiAoZSkgeyBFW2VdID8gRVtlXS5jb3VudGVyKysgOiBFW2VdID0geyBjb3VudGVyOiAxLCB3YWl0ZXJzOiBbXSB9OyB9LCBBID0gZnVuY3Rpb24gKGUsIG4pIHsgaWYgKEVbZV0gJiYgKEVbZV0uY291bnRlci0tLCBFW2VdLmNvdW50ZXIgPD0gMCkpIHtcbiAgICAgICAgdmFyIHQgPSBbXTtcbiAgICAgICAgRVtlXS53YWl0ZXJzLmZvckVhY2goKGZ1bmN0aW9uIChlKSB7IHQucHVzaChlKTsgfSkpLCBkZWxldGUgRVtlXSwgdC5mb3JFYWNoKChmdW5jdGlvbiAoZSkgeyBlKHZvaWQgMCAhPT0gbiA/IG4gOiB7fSk7IH0pKTtcbiAgICB9IH0sIE0gPSBmdW5jdGlvbiAoKSB7IHJldHVybiBuYXZpZ2F0b3IudXNlckFnZW50IHx8IG5hdmlnYXRvci52ZW5kb3IgfHwgd2luZG93Lm9wZXJhOyB9LCBPID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gby5nZXRUaW55cGFzc1ZlcnNpb24oKS5pbmRleE9mKFwiU05BUFNIT1RcIikgPj0gMDsgfSwgUiA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIFwiaHR0cHM6XCIgPT09IGRvY3VtZW50LmxvY2F0aW9uLnByb3RvY29sOyB9LCBMID0gZnVuY3Rpb24gKGUsIG4pIHsgdmFyIHQgPSBbXSwgciA9IGUuaW5kZXhPZihuKTsgcmV0dXJuIC0xID09PSByID8gdC5wdXNoKGUpIDogKHQucHVzaChlLnN1YnN0cigwLCByKSksIHQucHVzaChlLnN1YnN0cihyICsgMSkpKSwgdDsgfSwgTiA9IGZ1bmN0aW9uIChlKSB7IHZhciBuLCB0LCByID0gTChlLCBcIj1cIik7IHZvaWQgMCAhPT0gZSAmJiAobiA9IHJbMF0sIHQgPSByWzFdKTsgdmFyIG8gPSBcIlwiOyByZXR1cm4gdm9pZCAwICE9PSBuICYmIChvICs9IGVuY29kZVVSSUNvbXBvbmVudChkZWNvZGVVUklDb21wb25lbnQobikpKSwgdm9pZCAwICE9PSB0ICYmIChvICs9IFwiPVwiICsgZW5jb2RlVVJJQ29tcG9uZW50KGRlY29kZVVSSUNvbXBvbmVudCh0KSkpLCBvOyB9LCBVID0gZnVuY3Rpb24gKGUpIHsgdmFyIG4gPSBwYXJzZUludChlLCAxMCk7IHJldHVybiAhKGlzTmFOKHBhcnNlRmxvYXQobikpIHx8IG4gPCAwIHx8IG4gPiAyNTUpOyB9LCBqID0gZnVuY3Rpb24gKGUpIHsgdmFyIG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYVwiKTsgbi5ocmVmID0gL15odHRwcz86XFwvXFwvL2kudGVzdChlKSA/IGUgOiBcImh0dHA6Ly9cIiArIGU7IHZhciB0ID0gbi5ob3N0bmFtZTsgcmV0dXJuIDAgPT09IHQuaW5kZXhPZihcInd3dy5cIikgJiYgKHQgPSB0LnJlcGxhY2UoXCJ3d3cuXCIsIFwiXCIpKSwgdDsgfTsgdmFyIEQgPSBmdW5jdGlvbiAoZSwgbikgeyByZXR1cm4gbmV3IFJlZ0V4cChcIlxcXFw/XCIgKyBuLCBcImdpXCIpLnRlc3QoZSkgPyBlLnNwbGl0KFwiJlwiKS5sZW5ndGggPiAxID8gZS5yZXBsYWNlKG5ldyBSZWdFeHAobiArIFwiW14mXSsmP1wiLCBcImdpXCIpLCBcIlwiKSA6IGUucmVwbGFjZShuZXcgUmVnRXhwKFwiXFxcXD9cIiArIG4gKyBcIlteJl0rJj9cIiwgXCJnaVwiKSwgXCJcIikgOiBuZXcgUmVnRXhwKFwiXFxcXCZcIiArIG4sIFwiZ2lcIikudGVzdChlKSA/IGUucmVwbGFjZShuZXcgUmVnRXhwKFwiXFxcXCZcIiArIG4gKyBcIlteJl0rXCIsIFwiZ2lcIiksIFwiXCIpIDogZTsgfSwgRiA9IGZ1bmN0aW9uIChlLCBuKSB7IHRyeSB7XG4gICAgICAgIHZhciB0ID0gbmV3IEVycm9yLCByID0gcG4udXNlci5nZXRQcm92aWRlcigpLmdldE5hbWUoKSwgbyA9IEpTT04uc3RyaW5naWZ5KFt7IGFpZDogcG4uYWlkLCBkZXNjcmlwdGlvbjogXCJjbGVhcmluZyBfX3RwIGNvb2tpZVwiLCB1c2VyUHJvdmlkZXI6IHIsIGFjY2Vzc1Rva2VuTGlzdDogZSwgdXNlclRva2VuOiBuLCB1cmw6IHdpbmRvdy5sb2NhdGlvbi5ocmVmLCB0cmFjZTogWCh0LnN0YWNrLCAzKSwgdGFnczogW1wic2RrXCJdIH1dKTtcbiAgICAgICAgcG4uYXBpLmNhbGxBcGkoXCIvYW5vbi9lcnJvci9sb2dcIiwgeyBsb2dfbWVzc2FnZTogbyB9KTtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHsgfSB9OyB2YXIgQiA9IGZ1bmN0aW9uIChlKSB7IGUgfHwgKGUgPSA3MzApOyB2YXIgbiA9IHBuLmdldE1heENvb2tpZUV4cGlyYXRpb25JbkRheXMoKTsgaWYgKG51bGwgIT09IG4pIHtcbiAgICAgICAgdmFyIHQ7XG4gICAgICAgIFwibnVtYmVyXCIgPT0gdHlwZW9mIGUgPyAodCA9IG5ldyBEYXRlKS5zZXREYXRlKHQuZ2V0RGF0ZSgpICsgZSkgOiB0ID0gZTtcbiAgICAgICAgdmFyIHIgPSBuZXcgRGF0ZTtcbiAgICAgICAgaWYgKHIuc2V0RGF0ZShyLmdldERhdGUoKSArIG4pLCB0ID4gcilcbiAgICAgICAgICAgIHJldHVybiBuO1xuICAgIH0gcmV0dXJuIGU7IH0sIFYgPSBmdW5jdGlvbiAoZSkgeyByZXR1cm4gci5nZXQoZSk7IH0sIHEgPSBmdW5jdGlvbiAoZSwgbiwgdCkgeyB0ID0gdCB8fCB7fSwgXCIxMUM2YVlId3RiXCIgPT09IHBuLmFpZCA/ICh0LnNhbWVzaXRlID0gXCJub25lXCIsIHQuc2VjdXJlID0gITApIDogdC5zYW1lc2l0ZSA9IFwibGF4XCIsIHQuZXhwaXJlcyAmJiAodC5leHBpcmVzID0gQih0LmV4cGlyZXMpKSwgci5zZXQoZSwgbiwgdCksIHZvaWQgMCAhPT0gaS5zeW5jaHJvbml6ZUNvb2tpZSAmJiBpLnN5bmNocm9uaXplQ29va2llKGUsIG4sIHQuZXhwaXJlcyk7IH0sIHogPSBcIl9fdHAtXCIsIEggPSBcIi1leHBpcmF0aW9uXCIsIFcgPSBmdW5jdGlvbiAoKSB7IHJldHVybiBNYXRoLmZsb29yKChuZXcgRGF0ZSkuZ2V0VGltZSgpIC8gMWUzKTsgfSwgSiA9IGZ1bmN0aW9uIChlKSB7IHZhciBuID0geiArIGU7IGEucmVtb3ZlKG4pLCBhLnJlbW92ZShuICsgSCk7IH0sIEcgPSBmdW5jdGlvbiAoKSB7IHZhciBlID0gW1wiX193ZWJkcml2ZXJfZXZhbHVhdGVcIiwgXCJfX3NlbGVuaXVtX2V2YWx1YXRlXCIsIFwiX193ZWJkcml2ZXJfc2NyaXB0X2Z1bmN0aW9uXCIsIFwiX193ZWJkcml2ZXJfc2NyaXB0X2Z1bmNcIiwgXCJfX3dlYmRyaXZlcl9zY3JpcHRfZm5cIiwgXCJfX2Z4ZHJpdmVyX2V2YWx1YXRlXCIsIFwiX19kcml2ZXJfdW53cmFwcGVkXCIsIFwiX193ZWJkcml2ZXJfdW53cmFwcGVkXCIsIFwiX19kcml2ZXJfZXZhbHVhdGVcIiwgXCJfX3NlbGVuaXVtX3Vud3JhcHBlZFwiLCBcIl9fZnhkcml2ZXJfdW53cmFwcGVkXCJdLCBuID0gW1wiX3BoYW50b21cIiwgXCJfX25pZ2h0bWFyZVwiLCBcIl9zZWxlbml1bVwiLCBcImNhbGxQaGFudG9tXCIsIFwiY2FsbFNlbGVuaXVtXCIsIFwiX1NlbGVuaXVtX0lERV9SZWNvcmRlclwiXTsgZm9yICh2YXIgdCBpbiBuKSB7XG4gICAgICAgIGlmICh3aW5kb3dbblt0XV0pXG4gICAgICAgICAgICByZXR1cm4gITA7XG4gICAgfSBmb3IgKHZhciByIGluIGUpIHtcbiAgICAgICAgdmFyIG8gPSBlW3JdO1xuICAgICAgICBpZiAod2luZG93LmRvY3VtZW50W29dKVxuICAgICAgICAgICAgcmV0dXJuICEwO1xuICAgIH0gZm9yICh2YXIgaSBpbiB3aW5kb3cuZG9jdW1lbnQpXG4gICAgICAgIGlmIChpLm1hdGNoKC9cXCRbYS16XWRjXy8pICYmIHdpbmRvdy5kb2N1bWVudFtpXS5jYWNoZV8pXG4gICAgICAgICAgICByZXR1cm4gITA7IHJldHVybiAhISh3aW5kb3cuZXh0ZXJuYWwgJiYgd2luZG93LmV4dGVybmFsLnRvU3RyaW5nICYmIHdpbmRvdy5leHRlcm5hbC50b1N0cmluZygpICYmIC0xICE9PSB3aW5kb3cuZXh0ZXJuYWwudG9TdHJpbmcoKS5pbmRleE9mKFwiU2VxdWVudHVtXCIpKSB8fCAoISF3aW5kb3cuZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmdldEF0dHJpYnV0ZShcInNlbGVuaXVtXCIpIHx8ICghIXdpbmRvdy5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuZ2V0QXR0cmlidXRlKFwid2ViZHJpdmVyXCIpIHx8ICEhd2luZG93LmRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5nZXRBdHRyaWJ1dGUoXCJkcml2ZXJcIikpKTsgfSwgUSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIFYoXCJfX3RhY1wiKTsgfSwgWCA9IGZ1bmN0aW9uIChlLCBuKSB7IHJldHVybiBlICYmIGUuc3BsaXQoXCJcXG5cIikuZmlsdGVyKChmdW5jdGlvbiAoZSwgdCkgeyByZXR1cm4gdCA+IDAgJiYgdCA8IG4gKyAxOyB9KSkubWFwKChmdW5jdGlvbiAoZSkgeyByZXR1cm4gZS50cmltKCk7IH0pKS5qb2luKFwiXFxuXCIpOyB9OyByZXR1cm4geyBuYW1lOiBcInV0aWxcIiwgX19wcml2YXRlX186IHsgZ2V0QWRqdXN0ZWRDb29raWVFeHBpcmF0aW9uOiBCIH0sIF9fcHJvdGVjdGVkX186IHsgZGVsZXRlVExEQ29va2llRm9yU3BlY2lmaWNEb21haW5zOiB1LCBkb2N1bWVudFJlYWR5OiBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IGZ1bmN0aW9uICgpIHsgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIkRPTUNvbnRlbnRMb2FkZWRcIiwgbiksIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKFwibG9hZFwiLCBuKSwgZSgpOyB9OyBcImNvbXBsZXRlXCIgPT09IGRvY3VtZW50LnJlYWR5U3RhdGUgfHwgXCJsb2FkaW5nXCIgIT09IGRvY3VtZW50LnJlYWR5U3RhdGUgJiYgIWRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5kb1Njcm9sbCA/IHdpbmRvdy5zZXRUaW1lb3V0KGUpIDogKGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJET01Db250ZW50TG9hZGVkXCIsIG4pLCB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcImxvYWRcIiwgbikpOyB9LCBnZXRDb29raWU6IFYsIHNldENvb2tpZTogcSwgZ2V0TG9jYWxTdG9yYWdlSXRlbTogZnVuY3Rpb24gKGUpIHsgdmFyIG4gPSB6ICsgZSwgdCA9IGEuZ2V0KG4pLCByID0gYS5nZXQobiArIEgpOyByZXR1cm4gciAmJiByIDwgVygpID8gKEooZSksIG51bGwpIDogdDsgfSwgaGFzTG9jYWxTdG9yYWdlOiBmdW5jdGlvbiAoKSB7IHRyeSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwib2JqZWN0XCIgPT0gdHlwZW9mIHdpbmRvdy5sb2NhbFN0b3JhZ2UgJiYgXCJmdW5jdGlvblwiID09IHR5cGVvZiB3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiAhMTtcbiAgICAgICAgICAgIH0gfSwgcmFuZG9tU3RyaW5nQ3hDb21wYXRpYmxlOiBmdW5jdGlvbiAoKSB7IGZvciAodmFyIGUgPSAobmV3IERhdGUpLmdldFRpbWUoKS50b1N0cmluZygzNik7IGUubGVuZ3RoIDwgMTY7KVxuICAgICAgICAgICAgICAgIGUgKz0gTWF0aC5yb3VuZCgyMTQ3NDgzNjQ3ICogTWF0aC5yYW5kb20oKSkudG9TdHJpbmcoMzYpOyByZXR1cm4gZS5zdWJzdHIoMCwgMTYpOyB9LCBzZXRMb2NhbFN0b3JhZ2VJdGVtOiBmdW5jdGlvbiAoZSwgbiwgdCkgeyB2YXIgciA9IHogKyBlOyBhLnNldChyLCBuKSwgdCAmJiBhLnNldChyICsgSCwgVygpICsgdCk7IH0sIHJlbW92ZUxvY2FsU3RvcmFnZUl0ZW06IEosIGNhbWVGcm9tRmJTdWJzY3JpcHRpb25zOiBmdW5jdGlvbiAoKSB7IHJldHVybiAwID09PSB3KFwicmVkaXJlY3RfdXJpXCIpLmluZGV4T2YoXCJodHRwczovL3d3dy5mYWNlYm9vay5jb20vc3Vic2NyaXB0aW9ucy9hY2NvdW50LWxpbmtpbmcvY29uZmlybS9cIik7IH0sIGxvZ1JlbW92ZVRva2VuczogZnVuY3Rpb24gKGUpIHsgdHJ5IHtcbiAgICAgICAgICAgICAgICB2YXIgbiA9IG5ldyBFcnJvciwgdCA9IHBuLnVzZXIuZ2V0UHJvdmlkZXIoKS5nZXROYW1lKCksIHIgPSBKU09OLnN0cmluZ2lmeShbeyBhaWQ6IHBuLmFpZCwgZGVzY3JpcHRpb246IFwiY2xlYXJpbmcgX191dHAgY29va2llXCIsIHVzZXJQcm92aWRlcjogdCwgdXNlclRva2VuOiBlLCB1cmw6IHdpbmRvdy5sb2NhdGlvbi5ocmVmLCB0cmFjZTogWChuLnN0YWNrLCAzKSwgdGFnczogW1wic2RrXCJdIH1dKTtcbiAgICAgICAgICAgICAgICBwbi5hcGkuY2FsbEFwaShcIi9hbm9uL2Vycm9yL2xvZ1wiLCB7IGxvZ19tZXNzYWdlOiByIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGUpIHsgfSB9LCB3YWl0QWxsUHJvbWlzZXM6IGZ1bmN0aW9uIChlKSB7IHJldHVybiBQcm9taXNlLmFsbChlKTsgfSwgaXNJbnRlZ2VyOiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gXCJudW1iZXJcIiA9PSB0eXBlb2YgZSAmJiBpc0Zpbml0ZShlKSAmJiBNYXRoLmZsb29yKGUpID09PSBlOyB9LCByYWNlUHJvbWlzZTogZnVuY3Rpb24gKGUpIHsgcmV0dXJuIFByb21pc2UucmFjZShlKTsgfSwgaXNDeGVuc2VCb3Q6IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSBNKCk7IHJldHVybiAvKGN4ZW5zZWJvdCkvaS50ZXN0KGUpOyB9LCBpc0h0dHBzUHJvdG9jb2w6IFIsIGlzQXBwbGVQYXlBbGxvd2VkOiBmdW5jdGlvbiAoKSB7IHZhciBlID0gITE7IHRyeSB7XG4gICAgICAgICAgICAgICAgZSA9IHdpbmRvdy5BcHBsZVBheVNlc3Npb24gJiYgd2luZG93LkFwcGxlUGF5U2Vzc2lvbi5jYW5NYWtlUGF5bWVudHMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgbShcIkFwcGxlUGF5IGVycm9yXCIsIGUpO1xuICAgICAgICAgICAgfSByZXR1cm4gKE8oKSB8fCBSKCkpICYmIGU7IH0sIGlzRGV2RW5kcG9pbnQ6IE8gfSwgYWRkU2NyaXB0OiBmdW5jdGlvbiAoZSwgbikgeyB2YXIgdCwgciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzY3JpcHRcIiksIG8gPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZShcInNjcmlwdFwiKVswXTsgbnVsbCA9PT0gKHQgPSBvLnBhcmVudE5vZGUpIHx8IHZvaWQgMCA9PT0gdCB8fCB0Lmluc2VydEJlZm9yZShyLCBvKSwgci50eXBlID0gXCJ0ZXh0L2phdmFzY3JpcHRcIiwgci5hc3luYyA9ICEwLCByLm9ubG9hZCA9IG4sIHIuc3JjID0gZTsgfSwgZnJvbVVuZGVyc2NvcmVUb0NhbWVsQ2FzZTogZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGUuc2xpY2UoKS5yZXBsYWNlKC9fW2Etel0vZywgKGZ1bmN0aW9uIChlKSB7IHJldHVybiBlLnJlcGxhY2UoXCJfXCIsIFwiXCIpLnRvVXBwZXJDYXNlKCk7IH0pKTsgfSwgcmFuZG9tU3RyaW5nOiBmdW5jdGlvbiAoZSkgeyBlIHx8IChlID0gNSk7IHZhciBuID0gXCJcIiwgdCA9IFwiQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODlcIjsgaWYgKHdpbmRvdy5jcnlwdG8gJiYgd2luZG93LmNyeXB0by5nZXRSYW5kb21WYWx1ZXMgJiYgXCJmdW5jdGlvblwiID09IHR5cGVvZiBVaW50MzJBcnJheSkge1xuICAgICAgICAgICAgdmFyIHIgPSBuZXcgVWludDMyQXJyYXkoZSk7XG4gICAgICAgICAgICB3aW5kb3cuY3J5cHRvLmdldFJhbmRvbVZhbHVlcyhyKTtcbiAgICAgICAgICAgIGZvciAodmFyIG8gPSAwOyBvIDwgZTsgbysrKVxuICAgICAgICAgICAgICAgIG4gKz0gdC5jaGFyQXQocltvXSAlIHQubGVuZ3RoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICBmb3IgKG8gPSAwOyBvIDwgZTsgbysrKVxuICAgICAgICAgICAgICAgIG4gKz0gdC5jaGFyQXQoTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogdC5sZW5ndGgpKTsgcmV0dXJuIG47IH0sIGxvZzogbSwgZGVidWc6IGYsIGVycm9yOiBmdW5jdGlvbiAoKSB7IGZvciAodmFyIGUsIG4gPSBbXSwgdCA9IDA7IHQgPCBhcmd1bWVudHMubGVuZ3RoOyB0KyspXG4gICAgICAgICAgICBuW3RdID0gYXJndW1lbnRzW3RdOyBtLmFwcGx5KHZvaWQgMCwgbiksIChlID0gXCJzdHJpbmdcIiA9PSB0eXBlb2YgYXJndW1lbnRzWzBdID8gbmV3IEVycm9yKGFyZ3VtZW50c1swXSkgOiBuZXcgRXJyb3IpLnN0YWNrICYmIG0oZS5zdGFjayk7IH0sIGZpbmRDb29raWVCeU5hbWU6IGQsIGZpbmRDb29raWVzQnlOYW1lOiBwLCByZW1vdmVWb3VjaGVyQ29kZUZyb21Vcmw6IGZ1bmN0aW9uIChlKSB7IHJldHVybiBEKGUsIFwidm91Y2hlcl9jb2RlXCIpOyB9LCByZW1vdmVTaGFyZWRBY2NvdW50Q29kZUZyb21Vcmw6IGZ1bmN0aW9uIChlKSB7IHJldHVybiBEKGUsIFwic2hhcmVkX2FjY291bnRfY29kZVwiKTsgfSwgZGVsZXRlQ29va2llOiBsLCBtYXBBcnJheUluZGV4OiBmdW5jdGlvbiAoZSwgbikgeyByZXR1cm4gbjsgfSwgZ2V0U2Nyb2xsOiBnLCBnZXRQYWdlU2l6ZTogZnVuY3Rpb24gKCkgeyByZXR1cm4geyB4OiBNYXRoLm1heChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGgsIGRvY3VtZW50LmJvZHkuc2Nyb2xsV2lkdGgsIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxXaWR0aCwgZG9jdW1lbnQuYm9keS5vZmZzZXRXaWR0aCwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50Lm9mZnNldFdpZHRoKSwgeTogTWF0aC5tYXgoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodCwgZG9jdW1lbnQuYm9keS5zY3JvbGxIZWlnaHQsIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxIZWlnaHQsIGRvY3VtZW50LmJvZHkub2Zmc2V0SGVpZ2h0LCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQub2Zmc2V0SGVpZ2h0KSB9OyB9LCBnZXRWaWV3cG9ydDogaCwgY2VudGVyOiBmdW5jdGlvbiAoZSwgbikgeyB2YXIgdCA9IGcoKSwgciA9IGgoKTsgcmV0dXJuIChyID0geyB4OiByLnggLyAyIC0gZSAvIDIsIHk6IHIueSAvIDIgLSBuIC8gMiArIHQgfSkueCA9IE1hdGgubWF4KDAsIHIueCksIHIueSA9IE1hdGgubWF4KDEwLCByLnkpLCByOyB9LCBjZW50ZXJTY3JlZW46IGZ1bmN0aW9uIChlLCBuKSB7IGUgPSBlIHx8IDAsIG4gPSBuIHx8IDA7IHZhciByID0gdm9pZCAwICE9PSB3aW5kb3cuc2NyZWVuTGVmdCA/IHdpbmRvdy5zY3JlZW5MZWZ0IDogd2luZG93LnNjcmVlbi5sZWZ0LCBvID0gdm9pZCAwICE9PSB3aW5kb3cuc2NyZWVuVG9wID8gd2luZG93LnNjcmVlblRvcCA6IHdpbmRvdy5zY3JlZW4udG9wLCBpID0gdC53aW5TaXplKCk7IHJldHVybiB7IGxlZnQ6IChpLndpZHRoIHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCB8fCB3aW5kb3cuc2NyZWVuLndpZHRoKSAvIDIgLSBlIC8gMiArIHIsIHRvcDogKGkuaGVpZ2h0IHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQgfHwgd2luZG93LnNjcmVlbi5oZWlnaHQpIC8gMiAtIG4gLyAyICsgbyB9OyB9LCBnZXRRdWVyeVBhcmFtQnlOYW1lOiB3LCBoYXNRdWVyeVBhcmFtQnlOYW1lOiBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IHt9OyByZXR1cm4gbG9jYXRpb24uc2VhcmNoLnN1YnN0cigxKS5zcGxpdChcIiZcIikuZm9yRWFjaCgoZnVuY3Rpb24gKGUpIHsgdmFyIHQgPSBlLnNwbGl0KFwiPVwiKSwgciA9IHRbMF0sIG8gPSB0WzFdICYmIGRlY29kZVVSSUNvbXBvbmVudCh0WzFdKTsgciBpbiBuID8gbltyXS5wdXNoKG8pIDogbltyXSA9IFtvXTsgfSkpLCBuLmhhc093blByb3BlcnR5KGUpOyB9LCByZW1vdmVRdWVyeVBhcmFtQnlOYW1lOiBmdW5jdGlvbiAoZSkgeyB5KChmdW5jdGlvbiAobikgeyByZXR1cm4gZnVuY3Rpb24gKGUsIG4pIHsgdmFyIHQsIHIgPSBlLnNwbGl0KFwiI1wiKSwgbyA9IHJbMF0uc3BsaXQoXCI/XCIpOyBpZiAoci5sZW5ndGggPj0gMiAmJiAodCA9IHJbMV0pLCBuID0gQXJyYXkuaXNBcnJheShuKSA/IG4gOiBbbl0sIG8ubGVuZ3RoID49IDIpIHtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSBvWzFdLnNwbGl0KC9bJjtdL2cpLCBhID0gMDsgYSA8IG4ubGVuZ3RoOyBhKyspXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgcyA9IGVuY29kZVVSSUNvbXBvbmVudChuW2FdKSArIFwiPVwiLCBjID0gaS5sZW5ndGg7IGMtLSA+IDA7KVxuICAgICAgICAgICAgICAgICAgICAtMSAhPT0gaVtjXS5sYXN0SW5kZXhPZihzLCAwKSAmJiBpLnNwbGljZShjLCAxKTtcbiAgICAgICAgICAgIHJldHVybiBlID0gb1swXSArIChpLmxlbmd0aCA+IDAgPyBcIj9cIiArIGkuam9pbihcIiZcIikgOiBcIlwiKSwgdCA/IGUgKyBcIiNcIiArIHQgOiBlO1xuICAgICAgICB9IHJldHVybiBlOyB9KG4sIGUpOyB9KSk7IH0sIHNldEFjY2Vzc1Rva2VuTGlzdENvb2tpZTogZnVuY3Rpb24gKGUsIG4sIHIpIHsgdmFyIG8gPSBfKFwiX191dFwiKTsgaWYgKGUgJiYgXCJzdHJpbmdcIiA9PT0gdC50eXBlKGUudmFsdWUpKSB7XG4gICAgICAgICAgICB2YXIgaSA9IG5ldyBEYXRlLCBhID0geyBkb21haW46IHVuZGVmaW5lZCwgcGF0aDogXCIvXCIsIGV4cGlyZXM6IDczMCB9O1xuICAgICAgICAgICAgZS5jb29raWVfZG9tYWluICYmIFwibG9jYWxob3N0XCIgIT09IGUuY29va2llX2RvbWFpbiAmJiB0LmluQXJyYXkoZS5jb29raWVfZG9tYWluLCBTKCkpID49IDAgJiYgKGEuZG9tYWluID0gZS5jb29raWVfZG9tYWluKSwgcG4uY29va2llRG9tYWluICYmIChhLmRvbWFpbiA9IHBuLmNvb2tpZURvbWFpbiksIHBuLmNvb2tpZVBhdGggJiYgKGEucGF0aCA9IHBuLmNvb2tpZVBhdGgpO1xuICAgICAgICAgICAgdmFyIHMgPSBTKCk7XG4gICAgICAgICAgICBmb3IgKHZhciBjIGluIHMpXG4gICAgICAgICAgICAgICAgbChcIl9fdGFjXCIsIHNbY10pLCBsKFwiX190YWVcIiwgc1tjXSksIGwobywgc1tjXSk7XG4gICAgICAgICAgICBxKFwiX190YWNcIiwgZS52YWx1ZSwgYSksIHEoXCJfX3RhZVwiLCBpLmdldFRpbWUoKSwgYSksIHEobywgbiwgYSksIFwiXCIgIT09IG4gfHwgciB8fCBGKGUsIG4pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdmFyIHUgPSBTKCk7XG4gICAgICAgICAgICBpZiAodS5wdXNoKHZvaWQgMCksIHBuLmNvb2tpZURvbWFpbiAmJiB1LnB1c2gocG4uY29va2llRG9tYWluKSwgcG4uY29va2llUGF0aClcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBjIGluIHUpXG4gICAgICAgICAgICAgICAgICAgIGwoXCJfX3RhY1wiLCB1W2NdLCBwbi5jb29raWVQYXRoKSwgbChcIl9fdGFlXCIsIHVbY10sIHBuLmNvb2tpZVBhdGgpLCBsKFwiX19lZWFcIiwgdVtjXSwgcG4uY29va2llUGF0aCksIGwobywgdVtjXSwgcG4uY29va2llUGF0aCk7XG4gICAgICAgICAgICBmb3IgKHZhciBjIGluIHUpXG4gICAgICAgICAgICAgICAgbChcIl9fdGFjXCIsIHVbY10pLCBsKFwiX190YWVcIiwgdVtjXSksIGwoXCJfX2VlYVwiLCB1W2NdKSwgbChvLCB1W2NdKTtcbiAgICAgICAgICAgIHIgfHwgRihlLCBuKTtcbiAgICAgICAgfSB9LCBzZXRUcGNjQ29va2llczogZnVuY3Rpb24gKCkgeyB2YXIgZSA9IHcoXCJ0cGNjXCIpOyBpZiAoZSkge1xuICAgICAgICAgICAgdmFyIG4gPSBuZXcgRGF0ZSwgdCA9IEpTT04uc3RyaW5naWZ5KHsgZGF0ZTogbi5nZXRUaW1lKCkgfSksIHIgPSBrKCk7XG4gICAgICAgICAgICAvXigyNVswLTVdfDJbMC00XVswLTldfFswMV0/WzAtOV1bMC05XT8pXFwuKDI1WzAtNV18MlswLTRdWzAtOV18WzAxXT9bMC05XVswLTldPylcXC4oMjVbMC01XXwyWzAtNF1bMC05XXxbMDFdP1swLTldWzAtOV0/KVxcLigyNVswLTVdfDJbMC00XVswLTldfFswMV0/WzAtOV1bMC05XT8pJC8udGVzdChsb2NhdGlvbi5ob3N0bmFtZSkgJiYgKHIgPSBcIlwiKSwgciB8fCAociA9IFwiXCIpLCBxKFwidHBjY19cIiArIGUsIHQsIHsgcGF0aDogXCIvXCIsIGV4cGlyZXM6IDkwLCBkb21haW46IHIgfSk7XG4gICAgICAgIH0gfSwgZ2V0Q2FtcGFpZ25zOiBmdW5jdGlvbiAoZSkgeyBwKC9edHBjY18uKy8pLmZvckVhY2goKGZ1bmN0aW9uIChuKSB7IGVbbi5uYW1lXSA9IG4udmFsdWU7IH0pKTsgfSwgZ2V0Q3VzdG9tQ29va2llczogZnVuY3Rpb24gKCkgeyB2YXIgZSA9IHt9OyByZXR1cm4gcCgvXl9wY18uKy8pLmZvckVhY2goKGZ1bmN0aW9uIChuKSB7IGVbZGVjb2RlVVJJQ29tcG9uZW50KG4ubmFtZSldID0gbi52YWx1ZTsgfSkpLCBlOyB9LCBBREJMT0NLRVJfU1RBVFVTOiBjLCBnZXRBZGJsb2NrU3RhdHVzOiBmdW5jdGlvbiAoKSB7IHZhciBlLCBuLCB0ID0gYy5OT1RfREVURUNURUQsIHIgPSBQKCk7IHJldHVybiBwbi5hZGJsb2NrZXJDb29raWVOYW1lICYmICh0ID0geChwbi5hZGJsb2NrZXJDb29raWVOYW1lKSksIHQgPT09IGMuTk9UX0RFVEVDVEVEICYmICh0ID0geChcIl9fcGFjXCIpKSwgdCA9PT0gYy5OT1RfREVURUNURUQgJiYgKHQgPSB4KFwiX19hZGJsb2NrZXJcIikpLCBlID0gci5jb29raWVWYWx1ZSwgZSA8PD0gMSwgKG4gPSB0KSA9PT0gYy5FTkFCTEVEID8gZSB8PSAxIDogZSAmPSAtMiwgbiAhPT0gYy5OT1RfREVURUNURUQgJiYgcShcIl9fcG5haGNcIiwgZSArIFwiXCIsIHsgcGF0aDogXCIvXCIsIGV4cGlyZXM6IDkwIH0pLCB0ID09PSBjLkVOQUJMRUQgJiYgKHIuaXNGaXJzdCB8fCAxICE9IChyLmNvb2tpZVZhbHVlID4+IDAgJiAxKSAmJiAodCA9IGMuRU5BQkxFRF9BRlRFUl9ESVNBQkxFRCkpLCB0OyB9LCBnZXRBZGJsb2NrZXJTdGF0dXNSZWFzb246IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHZvaWQgMCAhPT0gd2luZG93LmJsb2NrQWRCbG9jayA/IFwiMVwiIDogXCIwXCI7IH0sIGdldEFkYmxvY2tlckhpc3RvcnlDb29raWVJbmZvOiBQLCB3YWl0Q2FsbDogZnVuY3Rpb24gKGUsIG4pIHsgRVtlXSA/IEVbZV0ud2FpdGVycy5wdXNoKG4pIDogbigpOyB9LCBzdGFydENhbGw6IFQsIGRvbmVDYWxsOiBBLCBoYXNDYWxsOiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gISFFW2VdOyB9LCBkZWJvdW5jZTogZnVuY3Rpb24gKGUsIG4sIHQpIHsgdmFyIHI7IHJldHVybiBmdW5jdGlvbiAoKSB7IHZhciBvID0gdGhpcywgaSA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cyksIGEgPSBmdW5jdGlvbiAoKSB7IHIgPSBudWxsLCB0IHx8IGUuYXBwbHkobywgaSk7IH0sIHMgPSB0ICYmICFyOyBjbGVhclRpbWVvdXQociksIHIgPSBzZXRUaW1lb3V0KGEsIG4pLCBzICYmIGUuYXBwbHkobywgaSk7IH07IH0sIHRocm90dGxlOiBmdW5jdGlvbiAoZSwgbikgeyB2YXIgdCwgciwgbyA9ICExOyByZXR1cm4gZnVuY3Rpb24gaSgpIHsgaWYgKG8pXG4gICAgICAgICAgICByZXR1cm4gdCA9IGFyZ3VtZW50cywgdm9pZCAociA9IHRoaXMpOyBlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyksIG8gPSAhMCwgc2V0VGltZW91dCgoZnVuY3Rpb24gKCkgeyBvID0gITEsIHQgJiYgKGkuYXBwbHkociwgdCksIHQgPSByID0gbnVsbCk7IH0pLCBuKTsgfTsgfSwgcHJvZmlsZTogZnVuY3Rpb24gKGUpIHsgZnVuY3Rpb24gbigpIHsgcmV0dXJuIG4uX19pbnZva2VDb3VudCsrLCBlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7IH0gcmV0dXJuIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShuLCBcIl9faW52b2tlQ291bnRcIiwgeyB3cml0YWJsZTogITAsIHZhbHVlOiAwIH0pLCBPYmplY3QuZGVmaW5lUHJvcGVydHkobiwgXCJpbnZva2VDb3VudFwiLCB7IGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5fX2ludm9rZUNvdW50OyB9IH0pLCBuOyB9LCBzZXRUYmNDb29raWVGcm9tUmVzcG9uc2U6IGZ1bmN0aW9uIChlKSB7IGUuYnJvd3NlciAmJiB2b2lkIDAgIT09IGUuYnJvd3Nlci50YmMgJiYgYihcIl9fdGJjXCIsIGUuYnJvd3Nlci50YmMsIGUuYnJvd3Nlci5jb29raWVfZG9tYWluKSwgZS50YmMgJiYgZS50YmMuY29va2llX3ZhbHVlICYmIGIoXCJfX3RiY1wiLCBlLnRiYy5jb29raWVfdmFsdWUsIGUudGJjLmNvb2tpZV9kb21haW4pOyB9LCBzZXRUYWNDb29raWVGcm9tUmVzcG9uc2U6IGZ1bmN0aW9uIChlKSB7IHZhciBuID0gKG5ldyBEYXRlKS5nZXRUaW1lKCksIHQgPSBRKCksIHIgPSBmdW5jdGlvbiAoZSwgcikgeyBlICYmIGUgIT09IHQgJiYgKGIoXCJfX3RhY1wiLCBlLCByKSwgYihcIl9fdGFlXCIsIG4sIHIpKTsgfTsgZS5icm93c2VyICYmIHIoZS5icm93c2VyLnRhYywgZS5icm93c2VyLmNvb2tpZV9kb21haW4pLCBlLnRhYyAmJiByKGUudGFjLmNvb2tpZV92YWx1ZSwgZS50YWMuY29va2llX2RvbWFpbik7IH0sIGdldFRiY0Nvb2tpZTogZnVuY3Rpb24gKCkgeyByZXR1cm4gVihcIl9fdGJjXCIpOyB9LCBnZXRUYWNDb29raWU6IFEsIGdldEFpZFNwZWNpZmllZE5hbWU6IF8sIGdldFVzZXJUb2tlbkNvb2tpZTogZnVuY3Rpb24gKCkgeyB2YXIgZSA9IF8oXCJfX3V0XCIpLCBuID0gZChlKTsgcmV0dXJuIHZvaWQgMCAhPT0gbiAmJiBuICYmIG4ubGVuZ3RoID49IDAgPyBuIDogbnVsbDsgfSwgZ2V0UHVzaExpc3RzQ29va2llOiBDLCBzZXRQdXNoTGlzdHNDb29raWU6IGZ1bmN0aW9uIChlKSB7IGlmIChlKSB7XG4gICAgICAgICAgICB2YXIgbiA9IF8oXCJfX3Bsc1wiKSwgdCA9IEMoKSB8fCBbXTtcbiAgICAgICAgICAgIHQuaW5kZXhPZihlKSA+IC0xIHx8ICh0LnB1c2goZSksIGwobiksIHEobiwgSlNPTi5zdHJpbmdpZnkodCksIHsgcGF0aDogXCIvXCIsIGV4cGlyZXM6IDczMCwgZG9tYWluOiBrKCkgfSkpO1xuICAgICAgICB9IH0sIHNldEFwcFRpbWV6b25lT2Zmc2V0RnJvbVJlc3BvbnNlOiBmdW5jdGlvbiAoZSkgeyBlLmJyb3dzZXIgJiYgdm9pZCAwICE9PSBlLmJyb3dzZXIuYXBwX3RpbWV6b25lX29mZnNldCA/IEkoZS5icm93c2VyLmFwcF90aW1lem9uZV9vZmZzZXQpIDogdm9pZCAwICE9PSBlLnRpbWV6b25lX29mZnNldCAmJiBJKGUudGltZXpvbmVfb2Zmc2V0KTsgfSwgc2V0QXBwVGltZXpvbmVPZmZzZXQ6IEksIGdldEFwcFRpbWV6b25lT2Zmc2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBudWxsID09IG4gJiYgKG4gPSBWKFwiX19wYXRcIikpLCBuIHx8IDA7IH0sIGdldEJyb3dzZXJUaW1lem9uZU9mZnNldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gLU1hdGgucm91bmQoKG5ldyBEYXRlKS5nZXRUaW1lem9uZU9mZnNldCgpKTsgfSwgc3RyMnRpbWVzdGFtcDogZnVuY3Rpb24gKGUpIHsgaWYgKHZvaWQgMCAhPT0gZSAmJiAwICE9PSBlLmxlbmd0aCkge1xuICAgICAgICAgICAgaWYgKFwic3RyaW5nXCIgIT0gdHlwZW9mIGUgJiYgKGUgPSBcIlwiICsgZSksIChlID0gZS50cmltKCkpLm1hdGNoKC9eWzAtOV17MCwxMH0kLykpXG4gICAgICAgICAgICAgICAgcmV0dXJuIHBhcnNlSW50KGUpO1xuICAgICAgICAgICAgaWYgKGUubWF0Y2goL15bMC05XXsxMyx9JC8pKVxuICAgICAgICAgICAgICAgIHJldHVybiBwYXJzZUludChlKSAvIDFlMztcbiAgICAgICAgICAgIHZhciBuID0gRGF0ZS5wYXJzZShlKTtcbiAgICAgICAgICAgIGlmIChuKVxuICAgICAgICAgICAgICAgIHJldHVybiBuIC8gMWUzO1xuICAgICAgICAgICAgaWYgKChlID0gKGUgPSAoZSA9IChlID0gZS5yZXBsYWNlKC8wMDooWzAtOV17Mn0oOlswLTldezJ9KT9cXHMqW0FQXU0pL2ksIFwiMTI6JDFcIikucmVwbGFjZSgvKFswLTldezJ9KShbQVB8TV0pL2ksIFwiJDEgJDJcIikpLnJlcGxhY2UoL1xccyooYXR8QHxcXC18b258XFx8KVxccyovZ2ksIFwiIFwiKSkucmVwbGFjZSgvXFxzKihtb24oZGF5KT98dHVlKHM/ZGF5KT98d2VkKG5lc2RheSk/fHRodSgocnMpP2RheSk/fGZyaShkYXkpP3xzYXQodXJkYXkpP3xzdW4oZGF5KT8pXFxzKi9naSwgXCJcIikpLnJlcGxhY2UoLyhbMC05XXsxLDJ9KShzdHxuZHxyZHx0aCkvLCBcIiQxXCIpKS5tYXRjaCgvXFxzK0VUJC8pKVxuICAgICAgICAgICAgICAgIGUgPSAyNDAgPT09IChuZXcgRGF0ZSkuZ2V0VGltZXpvbmVPZmZzZXQoKSA/IGUucmVwbGFjZSgvXFxzK0VUJC8sIFwiIEVEVFwiKSA6IGUucmVwbGFjZSgvXFxzK0VUJC8sIFwiIEVTVFwiKTtcbiAgICAgICAgICAgIGlmIChlID0gZS50cmltKCksIG4gPSBEYXRlLnBhcnNlKGUpKVxuICAgICAgICAgICAgICAgIHJldHVybiBuIC8gMWUzO1xuICAgICAgICAgICAgdmFyIHQgPSBlLm1hdGNoKC8hXihbYS16XSspWy0vIF0oWzAtOV0rKVstLyBdKFswLTldKykoLiopJCFpLyk7XG4gICAgICAgICAgICByZXR1cm4gdCA/IGUgPSB0WzJdICsgXCIgXCIgKyB0WzFdICsgXCIgXCIgKyB0WzNdICsgdFs0XSA6ICh0ID0gZS5tYXRjaCgvIV4oWzAtOV0rKVstLyBdKFthLXpdKylbLS8gXShbMC05XSspKC4qKSQhaS8pKSAmJiAoZSA9IHRbMV0gKyBcIiBcIiArIHRbMl0gKyBcIiBcIiArIHRbM10gKyB0WzRdKSwgKG4gPSBEYXRlLnBhcnNlKGUpKSA/IG4gLyAxZTMgOiB2b2lkIDA7XG4gICAgICAgIH0gfSwgZ2V0UG9zc2libGVDb29raWVEb21haW5zOiBTLCBpc01vYmlsZVRhYmxldElPczogZnVuY3Rpb24gKCkgeyB2YXIgZSA9IE0oKTsgcmV0dXJuIC9pUGFkfGlQaG9uZXxpUG9kLy50ZXN0KGUpICYmICF3aW5kb3cuTVNTdHJlYW07IH0sIGlzSXBob25lOiBmdW5jdGlvbiAoKSB7IHZhciBlID0gTSgpOyByZXR1cm4gL2lQaG9uZS8udGVzdChlKSAmJiAhd2luZG93Lk1TU3RyZWFtOyB9LCBpc0lPUzogZnVuY3Rpb24gKCkgeyB2YXIgZSA9IE0oKTsgcmV0dXJuIC9pUGFkfGlQaG9uZXxpUG9kLy50ZXN0KGUpICYmICF3aW5kb3cuTVNTdHJlYW07IH0sIGlzSU9zVWlXZWJWaWV3OiBmdW5jdGlvbiAoKSB7IHZhciBlID0gTSgpOyByZXR1cm4gLyhpUGhvbmV8aVBvZHxpUGFkKS4qQXBwbGVXZWJLaXQoPyEuKlNhZmFyaSkvaS50ZXN0KGUpOyB9LCBpc1NhZmFyaU9ySU9zVWlXZWJWaWV3OiBmdW5jdGlvbiAoKSB7IHZhciBlID0gTSgpOyByZXR1cm4gLyhpUGhvbmV8aVBvZHxpUGFkKS4qQXBwbGVXZWJLaXQvaS50ZXN0KGUpOyB9LCBpc0ZCT3JJbnN0V2ViVmlldzogZnVuY3Rpb24gKCkgeyB2YXIgZSA9IE0oKTsgcmV0dXJuIGUuaW5kZXhPZihcIkZCQU5cIikgPiAtMSB8fCBlLmluZGV4T2YoXCJGQkFWXCIpID4gLTEgfHwgZS5pbmRleE9mKFwiSW5zdGFncmFtXCIpID4gLTE7IH0sIGlzQW5kcm9pZDogZnVuY3Rpb24gKCkgeyB2YXIgZSA9IE0oKTsgcmV0dXJuIC8oYW5kcm9pZCkvaS50ZXN0KGUpOyB9LCBpc0lFOiBmdW5jdGlvbiAoKSB7IHZhciBlID0gLTEgIT09IChuYXZpZ2F0b3IgJiYgbmF2aWdhdG9yLmFwcFZlcnNpb24gfHwgXCJcIikuaW5kZXhPZihcIk1TSUVcIiksIG4gPSAobmF2aWdhdG9yICYmIG5hdmlnYXRvci51c2VyQWdlbnQgfHwgXCJcIikuaW5kZXhPZihcIlRyaWRlbnQvXCIpID4gMDsgcmV0dXJuIGUgfHwgbjsgfSwgaXNDcmlPUzogZnVuY3Rpb24gKCkgeyByZXR1cm4gLTEgIT09IChuYXZpZ2F0b3IgJiYgbmF2aWdhdG9yLnVzZXJBZ2VudCB8fCBcIlwiKS5pbmRleE9mKFwiQ3JpT1NcIik7IH0sIGlzUmVsYXRpdmVVcmw6IGZ1bmN0aW9uIChlKSB7IHJldHVybiAvXlxcLyg/Olxcdyt8XFwuezEsMn1cXC9cXHcrKS8udGVzdChlKTsgfSwgcHJlcGFyZVVybFBhcmFtZXRlcjogZnVuY3Rpb24gKGUpIHsgaWYgKCFlKVxuICAgICAgICAgICAgcmV0dXJuIFwiXCI7IHZhciBuID0gZnVuY3Rpb24gKGUpIHsgdmFyIG4gPSBlLmluZGV4T2YoXCI/XCIpLCB0ID0gZS5pbmRleE9mKFwiI1wiKSwgciA9ICExOyAtMSAhPT0gdCAmJiAociA9ICEwKTsgdmFyIG8sIGkgPSAhMTsgLTEgIT09IG4gJiYgKGkgPSAhMCksIHIgJiYgaSAmJiB0IDwgbiAmJiAoaSA9ICExKTsgdmFyIGEgPSBcIlwiLCBzID0gXCJcIjsgaWYgKGkpIHtcbiAgICAgICAgICAgIHZhciBjID0gTChlLCBcIj9cIik7XG4gICAgICAgICAgICBpZiAobyA9IGNbMF0sIHIpIHtcbiAgICAgICAgICAgICAgICB2YXIgbCA9IEwoY1sxXSwgXCIjXCIpO1xuICAgICAgICAgICAgICAgIGEgPSBsWzBdLCBzID0gbFsxXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICBhID0gY1sxXTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChyKSB7XG4gICAgICAgICAgICB2YXIgdSA9IEwoZSwgXCIjXCIpO1xuICAgICAgICAgICAgbyA9IHVbMF0sIHMgPSB1WzFdO1xuICAgICAgICB9XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIG8gPSBlOyByZXR1cm4geyBzY2hlbWVEb21haW5BbmRQYXRoOiBvLCBxdWVyeVN0cmluZzogYSwgaGFzaDogcywgaGFzUXVlcnlTdHJpbmc6IGksIGhhc0hhc2g6IHIgfTsgfShlID0gZS5yZXBsYWNlKC9eKCglMjApfFxccykrLywgXCJcIikpLCB0ID0gZW5jb2RlVVJJKGRlY29kZVVSSShuLnNjaGVtZURvbWFpbkFuZFBhdGgpKTsgcmV0dXJuIG4uaGFzUXVlcnlTdHJpbmcgJiYgKHQgKz0gXCI/XCIgKyBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IFwiXCI7IGlmICh2b2lkIDAgIT09IGUpXG4gICAgICAgICAgICBmb3IgKHZhciB0ID0gZS5zcGxpdChcIiZcIiksIHIgPSAwOyByIDwgdC5sZW5ndGg7IHIrKylcbiAgICAgICAgICAgICAgICByID4gMCAmJiAobiArPSBcIiZcIiksIG4gKz0gTih0W3JdKTsgcmV0dXJuIG47IH0obi5xdWVyeVN0cmluZykpLCBuLmhhc0hhc2ggJiYgKHQgKz0gXCIjXCIgKyBlbmNvZGVVUklDb21wb25lbnQoZGVjb2RlVVJJQ29tcG9uZW50KG4uaGFzaCkpKSwgdDsgfSwgZ2V0UmVmZXJyZXI6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGRvY3VtZW50LnJlZmVycmVyOyB9LCBnZXRIb3N0bmFtZTogaiwgZXh0cmFjdENvb2tpZURvbWFpbjogZnVuY3Rpb24gKGUpIHsgaWYgKGUgJiYgZS5sZW5ndGggJiYgXCIuXCIgPT09IGVbMF0pXG4gICAgICAgICAgICByZXR1cm4gZTsgdmFyIG4gPSBlIHx8IHdpbmRvdy5sb2NhdGlvbi5ocmVmLCB0ID0gaihuKTsgcmV0dXJuIGZ1bmN0aW9uIChlKSB7IHZhciBuID0gZS5zcGxpdChcIi5cIiksIHQgPSAhMDsgcmV0dXJuIDQgPT09IG4ubGVuZ3RoICYmIFUoblswXSkgJiYgVShuWzFdKSAmJiBVKG5bMl0pICYmIFUoblszXSkgfHwgKHQgPSAhMSksIHQ7IH0odCkgPyB0IDogXCJsb2NhbGhvc3RcIiA9PT0gdCA/IG51bGwgOiBcIi5cIiArIHQ7IH0sIHNldEN1cnJlbnREb21haW5Gcm9tUmVzcG9uc2U6IGZ1bmN0aW9uIChlKSB7IHZvaWQgMCAhPT0gZS5icm93c2VyICYmIHZvaWQgMCAhPT0gZS5icm93c2VyLmNvb2tpZV9kb21haW4gJiYgQShcImRvbWFpbklzUmVjZWl2ZWRcIiwgZS5icm93c2VyLmNvb2tpZV9kb21haW4pLCBlLnRiYyAmJiBlLnRiYy5jb29raWVfZG9tYWluICYmIEEoXCJkb21haW5Jc1JlY2VpdmVkXCIsIGUudGJjLmNvb2tpZV9kb21haW4pOyB9LCBnZXRDdXJyZW50RG9tYWluRnJvbUNvb2tpZTogZnVuY3Rpb24gKGUpIHsgdHJ5IHtcbiAgICAgICAgICAgIHJldHVybiBKU09OLnBhcnNlKFYoZSkpLmRvbWFpbjtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgVChcImRvbWFpbklzUmVjZWl2ZWRcIik7XG4gICAgICAgIH0gfSwgaXNCb3Q6IEcsIGdldEFmZmlsaWF0ZVRva2VuOiBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IHdpbmRvdy5sb2NhdGlvbi5oYXNoLnNsaWNlKDEpOyBpZiAobikge1xuICAgICAgICAgICAgdmFyIHQgPSBuLnNwbGl0KFwiPVwiKSwgciA9IHRbMF0sIG8gPSB0WzFdO1xuICAgICAgICAgICAgciAmJiBvICYmIHIgPT09IGUgJiYgKHkoKGZ1bmN0aW9uIChlKSB7IHJldHVybiBlLnNwbGl0KFwiI1wiKVswXTsgfSkpLCBzID0gbyk7XG4gICAgICAgIH0gcmV0dXJuIHM7IH0sIHJlbW92ZUFmZmlsaWF0ZVRva2VuOiBmdW5jdGlvbiAoKSB7IHMgPSBcIlwiOyB9IH07IH07XG4gICAgcG4uY29udGFpbmVyLnJlZ2lzdGVyKFwidXRpbFwiLCB7IHVzZVZhbHVlOiBDZSgpIH0pLCBwbi51dGlsID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJ1dGlsXCIpO1xuICAgIHZhciBJZSA9IGZ1bmN0aW9uICgpIHsgdmFyIGUsIG4gPSBwbi5jb250YWluZXIucmVzb2x2ZShcImpxVXRpbHNcIiksIHQgPSBwbi5jb250YWluZXIucmVzb2x2ZShcInV0aWxcIiksIHIgPSBwbi5jb250YWluZXIucmVzb2x2ZShcImFqYXhcIiksIG8gPSB0LmZpbmRDb29raWVCeU5hbWUoL19fVFBfKi8pOyBpZiAodm9pZCAwICE9PSB3aW5kb3cuX3RwbSAmJiB2b2lkIDAgIT09IHdpbmRvdy5fdHBtLnBheXdhbGxJRCkge1xuICAgICAgICB2YXIgaSA9IHdpbmRvdy5fdHBtLnBheXdhbGxJRDtcbiAgICAgICAgZSA9IHQuX19wcm90ZWN0ZWRfXy5nZXRDb29raWUoXCJ1bWNfXCIgKyBpKTtcbiAgICB9IHZhciBhID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gcG4uZ2V0QXBpRW5kcG9pbnQoKTsgfSwgcyA9IGZ1bmN0aW9uIChuLCByKSB7IHZhciBpID0gdC5fX3Byb3RlY3RlZF9fLmdldENvb2tpZShcIl9fdGFjXCIpOyB2b2lkIDAgIT09IG4gJiYgbiB8fCAobiA9IHt9KSwgbi5haWQgPSBwbi5haWQsIGUgJiYgKG4udW1jID0gZSksIG8gJiYgKG4udHBfYWNjZXNzX3Rva2VuX3YyID0gbyksIGkgJiYgKG4udGFjID0gaSksIG4udXNlcl9wcm92aWRlciB8fCAhciB8fCByLmlzdiB8fCAobi51c2VyX3Byb3ZpZGVyID0gci5nZXROYW1lKCkpLCB2b2lkIDAgIT09IG4udXNlcl90b2tlbiAmJiBuLnVzZXJfdG9rZW4gfHwgIXIgfHwgci5pc3YgfHwgKG4udXNlcl90b2tlbiA9IFwic3RyaW5nXCIgPT0gdHlwZW9mIHIuZ2V0VG9rZW4oKSA/IHIuZ2V0VG9rZW4oKSA6IFwiXCIpOyB2YXIgYSA9IHQuZ2V0QWZmaWxpYXRlVG9rZW4ocG4uYWZmaWxpYXRlVG9rZW5OYW1lKTsgYSAmJiAobi5hZmZpbGlhdGVUb2tlbiA9IGEpOyB9OyBmdW5jdGlvbiBjKGUsIG8sIGksIGMsIGwsIHUpIHsgdmFyIGQ7IHQuZGVidWcoXCJDYWxsaW5nIEFQSSBtZXRob2Q6IFwiICsgZSksIGQgPSB2b2lkIDAgIT09IGMgPyBjIDogYSgpLCBkICs9IGUsIHZvaWQgMCAhPT0gbyAmJiBvIHx8IChvID0ge30pOyB2YXIgcCwgZiwgbSA9IHQuZ2V0VGJjQ29va2llKCk7IG0gJiYgKG8udGJjID0gbSksIHBuLnVzZXIgJiYgKHAgPSBwbi51c2VyLmdldFByb3ZpZGVyKCkpLCBzKG8sIHApLCBmID0gZnVuY3Rpb24gKGUpIHsgdC5kZWJ1ZyhcIkFQSSBSZXNwb25zZVwiLCBlKSwgdC5zZXRUYmNDb29raWVGcm9tUmVzcG9uc2UoZSksIHQuc2V0QXBwVGltZXpvbmVPZmZzZXRGcm9tUmVzcG9uc2UoZSksIHQuc2V0Q3VycmVudERvbWFpbkZyb21SZXNwb25zZShlKSwgdm9pZCAwICE9PSBpICYmIGkoZSk7IH07IHZhciBnID0gZnVuY3Rpb24gKGUpIHsgdmFyIG4gPSBcIi9hY2Nlc3MvbGlzdFwiLCB0ID0gXCIvYWNjZXNzL2NoZWNrXCI7IGlmIChlICE9PSBuICYmIGUgIT09IHQgJiYgXCIvdXNlci9hY2Nlc3MvbGlzdFwiICE9PSBlICYmIFwiL3VzZXIvYWNjZXNzL2NoZWNrLmp3dFwiICE9PSBlKVxuICAgICAgICByZXR1cm4gbnVsbDsgdmFyIHIgPSBNYXRoLmZsb29yKChuZXcgRGF0ZSkuZ2V0VGltZSgpIC8gMWUzKTsgcmV0dXJuIGUgPT09IG4gPyB7IGNvZGU6IDAsIGNvdW50OiAwLCBkYXRhOiBbXSwgbGltaXQ6IDAsIG9mZnNldDogMCwgdG90YWw6IDAsIHRzOiByIH0gOiBlID09PSB0ID8geyBjb2RlOiAwLCB0czogMTU0ODk0MjMxNCwgYWNjZXNzOiB7IGFjY2Vzc19pZDogbnVsbCwgcGFyZW50X2FjY2Vzc19pZDogbnVsbCwgZ3JhbnRlZDogITEsIHJlc291cmNlOiBudWxsLCB1c2VyOiBudWxsLCBleHBpcmVfZGF0ZTogciB9IH0gOiB7IGNvZGU6IDQwMywgdHM6IHIsIG1lc3NhZ2U6IFwiVXNlciBkb2Vzbid0IGhhdmUgcGVybWlzc2lvbiB0byBjYWxsIHRoaXMgbWV0aG9kXCIgfTsgfShlKTsgaWYgKG51bGwgPT09IGcgfHwgcG4udXNlci5nZXRQcm92aWRlcigpLmlzVXNlclZhbGlkKCkpIHtcbiAgICAgICAgdmFyIHY7XG4gICAgICAgICFmdW5jdGlvbiAoZSkgeyBwbi5pc0RvdWJsZU9wdEluQ2hlY2tPbkFjY2Vzc0NoZWNrRW5hYmxlZCAmJiBcIi9hY2Nlc3MvY2hlY2tcIiA9PT0gZSAmJiBwbi5kb3VibGVPcHRJbi5jaGVjaygpOyB9KGUpO1xuICAgICAgICB2YXIgaCA9IHsgZGF0YVR5cGU6IFwianNvbnBcIiB9O1xuICAgICAgICBpZiAodSkge1xuICAgICAgICAgICAgdmFyIHcgPSBvLmFpZDtcbiAgICAgICAgICAgIGRlbGV0ZSBvLmFpZCwgdiA9IFwiYWlkPVwiICsgdywgT2JqZWN0LmFzc2lnbihoLCB7IHR5cGU6IFwiUE9TVFwiLCBkYXRhVHlwZTogXCJqc29uXCIsIGRhdGE6IG8gfSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgby5jYWxsQXBpSnNvbnAgPSAhMCwgdiA9IG4ucGFyYW0obyk7XG4gICAgICAgIGQgKz0gXCI/XCIgKyB2LCBoLnVybCA9IGQsIGwgJiYgKGguYXN5bmMgPSAhMSksIGguc3VjY2VzcyA9IGZ1bmN0aW9uIChlKSB7IGYoZSk7IH0sIGguZXJyb3IgPSBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IHsgY29kZTogNTAzLCBtZXNzYWdlOiBcIkVycm9yOiBSZWNlaXZlZCBlcnJvciB3aGVuIHJlcXVlc3RpbmcgQVBJIHJlc3BvbnNlIGZyb20gVVJMOiBcIiArIGQgfTsgdC5sb2cobi5tZXNzYWdlKSwgZihuKTsgfSwgci5yZXF1ZXN0KGgpO1xuICAgIH1cbiAgICBlbHNlXG4gICAgICAgIGYoZyk7IH0gcmV0dXJuIHsgbmFtZTogXCJhcGlcIiwgY2FsbEFwaTogZnVuY3Rpb24gKGUsIG4sIHQsIHIsIG8sIGkpIHsgcmV0dXJuIGMoZSwgbiwgdCwgciwgbywgaSk7IH0sIGdldEVuZHBvaW50OiBmdW5jdGlvbiAoKSB7IHJldHVybiBhKCk7IH0sIGdldENhbGxQYXJhbXM6IGZ1bmN0aW9uIChlLCBuKSB7IHJldHVybiBzKGUsIG4pOyB9IH07IH0oKTtcbiAgICBwbi5jb250YWluZXIucmVnaXN0ZXIoXCJhcGlcIiwgeyB1c2VWYWx1ZTogSWUgfSksIHBuLmFwaSA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwiYXBpXCIpO1xuICAgIHZhciBTZSA9IGZ1bmN0aW9uICgpIHsgdmFyIGUsIG4sIHQsIHIsIG8sIGksIGEsIHMsIGMsIGwsIHUsIGQgPSBwbi5jb250YWluZXIucmVzb2x2ZShcImpxVXRpbHNcIiksIHAgPSBwbi5jb250YWluZXIucmVzb2x2ZShcInV0aWxcIiksIGYgPSB7fSwgbSA9IHt9LCBnID0gW10sIHYgPSB7fSwgaCA9IChlID0ge30sIGkgPSAxLCBhID0gd2luZG93LCBzID0gITEsIGwgPSBcImFkZEV2ZW50TGlzdGVuZXJcIiwgdSA9IGFbYyA9IFwicG9zdE1lc3NhZ2VcIl0sIGVbY10gPSBmdW5jdGlvbiAoZSwgbiwgdCkgeyBuICYmIChlID0gXCJzdHJpbmdcIiA9PSB0eXBlb2YgZSA/IGUgOiBkLnBhcmFtKGUpLCB0ID0gdCB8fCBwYXJlbnQsIHUgPyB0W2NdKGUsIG4ucmVwbGFjZSgvKFteOl0rOlxcL1xcL1teXFwvXSspLiovLCBcIiQxXCIpKSA6IG4gJiYgKHQubG9jYXRpb24gPSBuLnJlcGxhY2UoLyMuKiQvLCBcIlwiKSArIFwiI1wiICsgK25ldyBEYXRlICsgaSsrICsgXCImXCIgKyBlKSk7IH0sIGUucmVjZWl2ZU1lc3NhZ2UgPSBvID0gZnVuY3Rpb24gKGUsIGksIGMpIHsgdSA/IChlICYmIChyICYmIG8oKSwgciA9IGZ1bmN0aW9uIChuKSB7IGlmIChcInN0cmluZ1wiID09IHR5cGVvZiBpICYmIG4ub3JpZ2luICE9PSBpIHx8IGQuaXNGdW5jdGlvbihpKSAmJiBpKG4ub3JpZ2luKSA9PT0gcylcbiAgICAgICAgcmV0dXJuIHM7IGUobik7IH0pLCBhW2xdID8gYVtlID8gbCA6IFwicmVtb3ZlRXZlbnRMaXN0ZW5lclwiXShcIm1lc3NhZ2VcIiwgciwgcykgOiBhW2UgPyBcImF0dGFjaEV2ZW50XCIgOiBcImRldGFjaEV2ZW50XCJdKFwib25tZXNzYWdlXCIsIHIpKSA6IChuICYmIGNsZWFySW50ZXJ2YWwobiksIG4gPSBudWxsLCBlICYmIChjID0gXCJudW1iZXJcIiA9PSB0eXBlb2YgaSA/IGkgOiBcIm51bWJlclwiID09IHR5cGVvZiBjID8gYyA6IDEwMCwgbiA9IHNldEludGVydmFsKChmdW5jdGlvbiAoKSB7IHZhciBuID0gZG9jdW1lbnQubG9jYXRpb24uaGFzaCwgciA9IC9eIz9cXGQrJi87IG4gIT09IHQgJiYgci50ZXN0KG4pICYmICh0ID0gbiwgZSh7IGRhdGE6IG4ucmVwbGFjZShyLCBcIlwiKSB9KSk7IH0pLCBjKSkpOyB9LCBlKTsgdmFyIHcgPSBmdW5jdGlvbiAoZSwgbiwgdCkgeyB0ICYmIF8odCkgJiYgISh0IGluIG0pID8gcC5lcnJvcihcIkNhbm5vdCBzZW5kIG1lc3NhZ2UgdG8gdW5tYW5hZ2VkIGlmcmFtZTogXCIgKyB0KSA6IHQgJiYgbVt0XS5lbGVtZW50ICYmIChcInBvcHVwXCIgPT09IG1bdF0uY29uZmlnLmRpc3BsYXlNb2RlIHx8IFwicG9wdXBcIiAhPT0gbVt0XS5jb25maWcuZGlzcGxheU1vZGUgJiYgbVt0XS5lbGVtZW50LmNvbnRlbnRXaW5kb3cgPyB5KGUsIG4sIHQpIDogKGcucHVzaCh7IGV2ZW50OiBlLCBwYXJhbXM6IG4sIHJlY2lwaWVudDogdCB9KSwgZC5vbihtW3RdLmVsZW1lbnQsIFwibG9hZFwiLCBmdW5jdGlvbiAoZSkgeyByZXR1cm4gZnVuY3Rpb24gKCkgeyB2YXIgbiA9IGcuZmlsdGVyKChmdW5jdGlvbiAobikgeyByZXR1cm4gbi5yZWNpcGllbnQgPT09IGU7IH0pKTsgZyA9IGcuZmlsdGVyKChmdW5jdGlvbiAobikgeyByZXR1cm4gbi5yZWNpcGllbnQgIT09IGU7IH0pKTsgZm9yICh2YXIgdCA9IG4ubGVuZ3RoOyB0LS07KSB7XG4gICAgICAgIHZhciByID0gbi5wb3AoKTtcbiAgICAgICAgeShyLmV2ZW50LCByLnBhcmFtcywgci5yZWNpcGllbnQpO1xuICAgIH0gfTsgfSh0KSkpKTsgfSwgeSA9IGZ1bmN0aW9uIChlLCBuLCB0KSB7IHZhciByLCBvID0ge30sIGkgPSBcInBvcHVwXCIgPT09IG1bdF0uY29uZmlnLmRpc3BsYXlNb2RlID8gXCJvcGVuZXJcIiA6IFwicGFyZW50XCI7IG8uc2VuZGVyID0gXyh0KSA/IGkgOiB0LCBvLnJlY2lwaWVudCA9IF8odCkgPyB0IDogaSwgby5ldmVudCA9IGUsIG8ucGFyYW1zID0gbjsgdmFyIGEgPSBtW3RdLmVsZW1lbnQ7IHIgPSBcInBvcHVwXCIgPT09IG1bdF0uY29uZmlnLmRpc3BsYXlNb2RlID8gbVt0XS5jb250YWluZXIgOiBhICYmIGEuY29udGVudFdpbmRvdyA/IGEuY29udGVudFdpbmRvdyA6IGEgJiYgXCJbb2JqZWN0IFdpbmRvd11cIiA9PT0gYS50b1N0cmluZygpID8gbVt0XS5lbGVtZW50IDogd2luZG93W2ldLCBoLnBvc3RNZXNzYWdlKEpTT04uc3RyaW5naWZ5KG8pLCBmW3RdLnBvc3RNZXNzYWdlVXJsLCByKTsgfTsgdmFyIGIgPSBmdW5jdGlvbiAoZSkgeyBmW2UuaWZyYW1lSWRdID0geyBpZnJhbWVDb25maWc6IG51bGwsIHJlY2VpdmU6IG51bGwsIHBvc3RNZXNzYWdlVXJsOiBudWxsLCBpbml0aWFsaXplZExpc3RlbmVyOiAhMSwgaW5pdGlhbGl6ZWRLZXlzdHJva2VIYW5kbGVyOiAhMSB9LCBtW2UuaWZyYW1lSWRdID0gZTsgfSwgayA9IGZ1bmN0aW9uIChlKSB7IHJldHVybiAhKCFmW2VdIHx8ICFmW2VdLmlmcmFtZUNvbmZpZyk7IH0sIF8gPSBmdW5jdGlvbiAoZSkgeyByZXR1cm4gIWZbZV0gfHwgIWZbZV0uaWZyYW1lQ29uZmlnOyB9LCBDID0gZnVuY3Rpb24gKGUpIHsgdmFyIG4gPSBJKGUpOyByZXR1cm4gbi5zaG93Q2xvc2VCdXR0b24gJiYgXCJpbmxpbmVcIiAhPT0gbi5kaXNwbGF5TW9kZTsgfSwgSSA9IGZ1bmN0aW9uIChlKSB7IHZhciBuID0gZltlXSwgdCA9IG4gJiYgbi5pZnJhbWVDb25maWcgJiYgbi5pZnJhbWVDb25maWcuaWZyYW1lOyByZXR1cm4gdCAmJiB0LmNvbmZpZzsgfTsgZnVuY3Rpb24gUyhlKSB7IHZhciBuLCB0LCByLCBvLCBpLCBhLCBzID0gITE7IHRyeSB7XG4gICAgICAgIG4gPSBKU09OLnBhcnNlKGUuZGF0YSk7XG4gICAgfVxuICAgIGNhdGNoICh0KSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICByID0gZS5kYXRhLCBpID0ge30sIGEgPSB7IHRydWU6ICEwLCBmYWxzZTogITEsIG51bGw6IG51bGwgfSwgci5yZXBsYWNlKC9cXCsvZywgXCIgXCIpLnNwbGl0KFwiJlwiKS5mb3JFYWNoKChmdW5jdGlvbiAoZSwgbikgeyB2YXIgdCA9IG4uc3BsaXQoXCI9XCIpLCByID0gXCJcIjsgdHJ5IHtcbiAgICAgICAgICAgICAgICByID0gZGVjb2RlVVJJQ29tcG9uZW50KHRbMF0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9IHZhciBzLCBjID0gaSwgbCA9IDAsIHUgPSByLnNwbGl0KFwiXVtcIiksIGQgPSB1Lmxlbmd0aCAtIDE7IGlmICgvXFxbLy50ZXN0KHVbMF0pICYmIC9cXF0kLy50ZXN0KHVbZF0pID8gKHVbZF0gPSB1W2RdLnJlcGxhY2UoL1xcXSQvLCBcIlwiKSwgZCA9ICh1ID0gdS5zaGlmdCgpLnNwbGl0KFwiW1wiKS5jb25jYXQodSkpLmxlbmd0aCAtIDEpIDogZCA9IDAsIDIgPT09IHQubGVuZ3RoKVxuICAgICAgICAgICAgICAgIGlmIChzID0gZGVjb2RlVVJJQ29tcG9uZW50KHRbMV0pLCBvICYmIChzID0gcyAmJiAhaXNOYU4ocykgPyArcyA6IFwidW5kZWZpbmVkXCIgPT09IHMgPyB2b2lkIDAgOiB2b2lkIDAgIT09IGFbc10gPyBhW3NdIDogcyksIGQpXG4gICAgICAgICAgICAgICAgICAgIGZvciAoOyBsIDw9IGQ7IGwrKylcbiAgICAgICAgICAgICAgICAgICAgICAgIGMgPSBjW3IgPSBcIlwiID09PSB1W2xdID8gYy5sZW5ndGggOiB1W2xdXSA9IGwgPCBkID8gY1tyXSB8fCAodVtsICsgMV0gJiYgaXNOYU4odVtsICsgMV0pID8ge30gOiBbXSkgOiBzO1xuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgQXJyYXkuaXNBcnJheShpW3JdKSA/IGlbcl0ucHVzaChzKSA6IHZvaWQgMCAhPT0gaVtyXSA/IGlbcl0gPSBbaVtyXSwgc10gOiBpW3JdID0gcztcbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICByICYmIChpW3JdID0gbyA/IHZvaWQgMCA6IFwiXCIpOyB9KSksIChuID0gaSkgJiYgKHMgPSAhMCk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKG4pIHtcbiAgICAgICAgICAgIHJldHVybiB2b2lkIHAuZGVidWcoXCJFcnJvciBwYXJzaW5nIHBvc3RNZXNzYWdlOiBcIiArIGUuZGF0YSk7XG4gICAgICAgIH1cbiAgICB9IGlmICh4KG4pLCBzKSB7XG4gICAgICAgIHZhciBjO1xuICAgICAgICBmb3IgKHZhciBsIGluIG0pXG4gICAgICAgICAgICAodCA9IG1bbF0pLmNvbmZpZy5pc0N1cnRhaW4gJiYgKGMgPSAhMCwgdC5jb25maWcucGFyZW50ICYmIGZbdC5jb25maWcucGFyZW50XS5yZWNlaXZlICYmIGZbdC5jb25maWcucGFyZW50XS5yZWNlaXZlKG4pLCBmW2xdLnJlY2VpdmUgJiYgZltsXS5yZWNlaXZlKG4pKTtcbiAgICAgICAgYyB8fCBwLmRlYnVnKFwiRXJyb3IgcGFyc2luZyBwb3N0TWVzc2FnZTogXCIgKyBlLmRhdGEpO1xuICAgIH1cbiAgICBlbHNlIGlmICghXyhuLnNlbmRlcikgfHwgbi5zZW5kZXIgJiYgbi5zZW5kZXIgaW4gbSkge1xuICAgICAgICBpZiAocC5kZWJ1ZygoayhuLnNlbmRlcikgPyBcImlmcmFtZShcIiArIG4ucmVjaXBpZW50IDogXCJ0aGUgcGFyZW50XCIpICsgXCIpIHJlY2VpdmVkIGV2ZW50ICdcIiArIG4uZXZlbnQgKyBcIicgZnJvbSBpZnJhbWUoXCIgKyBuLnNlbmRlciArIFwiKVwiLCBuKSwgZltuLnNlbmRlcl0ucmVjZWl2ZSAmJiBmW24uc2VuZGVyXS5yZWNlaXZlKG4pLCBtW24uc2VuZGVyXSAmJiAodCA9IG1bbi5zZW5kZXJdKS5jb25maWcucGFyZW50ICYmIGZbdC5jb25maWcucGFyZW50XS5yZWNlaXZlKSB7XG4gICAgICAgICAgICBuLnNlbmRlciA9IHQuY29uZmlnLnBhcmVudCwgZlt0LmNvbmZpZy5wYXJlbnRdLnJlY2VpdmUobiwgITApO1xuICAgICAgICB9XG4gICAgfVxuICAgIGVsc2VcbiAgICAgICAgcC5kZWJ1ZyhcIlJlY2VpdmVkIG1lc3NhZ2UgZnJvbSB1bm1hbmFnZWQgaWZyYW1lOiBcIiArIG4uc2VuZGVyKTsgfSB2YXIgeCA9IGZ1bmN0aW9uIChlKSB7ICh2W2UuZXZlbnRdIHx8IFtdKS5mb3JFYWNoKChmdW5jdGlvbiAobikgeyBuKGUpOyB9KSk7IH07IHJldHVybiB7IG5hbWU6IFwicG9zdG1lc3NhZ2VcIiwgaW5pdDogZnVuY3Rpb24gKGUsIG4pIHsgaWYgKGIoZS5pZnJhbWUpLCBlLnBvc3RNZXNzYWdlVXJsKSB7XG4gICAgICAgICAgICBpZiAoZS5pZnJhbWUuaWZyYW1lSWQpIHtcbiAgICAgICAgICAgICAgICBmW2UuaWZyYW1lLmlmcmFtZUlkXS5pbml0aWFsaXplZEtleXN0cm9rZUhhbmRsZXIgfHwgKGZbZS5pZnJhbWUuaWZyYW1lSWRdLmluaXRpYWxpemVkS2V5c3Ryb2tlSGFuZGxlciA9ICEwLCBkLmRlbGVnYXRlKHdpbmRvdywgXCIjXCIgKyBlLmlmcmFtZS5pZnJhbWVJZCwgXCJrZXl1cFwiLCAoZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGZ1bmN0aW9uIChlKSB7IDI3ID09PSBlLmtleUNvZGUgJiYgayhlLmRhdGEuaWZyYW1lSWQpICYmIEMoZS5kYXRhLmlmcmFtZUlkKSAmJiB3KFwiY2xvc2VcIiwgbnVsbCwgZS5kYXRhLmlmcmFtZUlkKTsgfShlKTsgfSkpKSwgZltlLmlmcmFtZS5pZnJhbWVJZF0ucG9zdE1lc3NhZ2VVcmwgPSBlLnBvc3RNZXNzYWdlVXJsLCBmW2UuaWZyYW1lLmlmcmFtZUlkXS5pbml0aWFsaXplZExpc3RlbmVyIHx8IChmW2UuaWZyYW1lLmlmcmFtZUlkXS5pbml0aWFsaXplZExpc3RlbmVyID0gITAsIGZbZS5pZnJhbWUuaWZyYW1lSWRdLnJlY2VpdmUgPSBlLnJlY2VpdmUsIGgucmVjZWl2ZU1lc3NhZ2UoUykpLCBmW2UuaWZyYW1lLmlmcmFtZUlkXS5pZnJhbWVDb25maWcgPSBlO1xuICAgICAgICAgICAgICAgIHZhciB0ID0gbiB8fCB7fTtcbiAgICAgICAgICAgICAgICB0LmhlaWdodCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5vZmZzZXRIZWlnaHQsIHQud2lkdGggPSBlLmlmcmFtZVBhcmFtcyAmJiBlLmlmcmFtZVBhcmFtcy53aWR0aCA/IGUuaWZyYW1lUGFyYW1zLndpZHRoIDogZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50Lm9mZnNldFdpZHRoLCB3KFwibG9hZGVkXCIsIHQsIGUuaWZyYW1lLmlmcmFtZUlkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICBwLmVycm9yKFwiTXVzdCBzcGVjaWZ5IHBvc3RNZXNzYWdlVXJsIHRvIHNlbmQgYW5kIHJlY2VpdmUgcG9zdE1lc3NhZ2VzXCIpOyB9LCBfX3Byb3RlY3RlZF9fOiB7IGlzSWZyYW1lTWFuYWdlZDogZnVuY3Rpb24gKGUpIHsgdmFyIG4gPSBtW2VdOyByZXR1cm4gbiAmJiBfKG4pOyB9IH0sIHNlbmQ6IHcsIHJlbW92ZUlmcmFtZTogZnVuY3Rpb24gKGUpIHsgZGVsZXRlIG1bZV0sIGRlbGV0ZSBmW2VdOyB9LCBicm9hZGNhc3Q6IGZ1bmN0aW9uIChlLCBuLCB0KSB7IGZvciAodmFyIHIgaW4gbSlcbiAgICAgICAgICAgIG0uaGFzT3duUHJvcGVydHkocikgJiYgciA9PT0gdCB8fCB3KGUsIG4sIHIpOyB9LCBzdWJzY3JpYmU6IGZ1bmN0aW9uIChlLCBuKSB7IHZbZV0gPSB2W2VdIHx8IFtdLCB2W2VdLnB1c2gobik7IH0sIHVuc3Vic2NyaWJlOiBmdW5jdGlvbiAoZSwgbikgeyB2W2VdIGluc3RhbmNlb2YgQXJyYXkgJiYgKHZbZV0gPSB2W2VdLmZpbHRlcigoZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGUgIT09IG47IH0pKSk7IH0gfTsgfSgpO1xuICAgIHBuLmNvbnRhaW5lci5yZWdpc3RlcihcInBvc3RtZXNzYWdlXCIsIHsgdXNlVmFsdWU6IFNlIH0pLCBwbi5wb3N0bWVzc2FnZSA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwicG9zdG1lc3NhZ2VcIik7XG4gICAgdmFyIHhlID0gZnVuY3Rpb24gKCkgeyB2YXIgZSA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwianFVdGlsc1wiKSwgbiA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwidXRpbFwiKSwgdCA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwicG9zdG1lc3NhZ2VcIik7IHJldHVybiB7IG5hbWU6IFwiZXZlbnRVdGlsc1wiLCBjcmVhdGVFdmVudE1hbmFnZXI6IGZ1bmN0aW9uIChyKSB7IHZhciBvLCBpID0ge307IGZvciAobyA9IDA7IG8gPCByLmxlbmd0aDsgbysrKVxuICAgICAgICAgICAgaVtyW29dXSA9IFtdOyB2YXIgYSA9IHsgYWRkRXZlbnQ6IGZ1bmN0aW9uIChlKSB7IHZvaWQgMCA9PT0gaVtlXSAmJiAoaVtlXSA9IFtdKTsgfSwgaGFzSWZyYW1lQ2FsbGJhY2s6IGZ1bmN0aW9uIChlLCBuKSB7IHZhciB0LCByOyBpZiAoaVtlXSAmJiBpW2VdLmxlbmd0aCA+IDApXG4gICAgICAgICAgICAgICAgZm9yIChyID0gMCwgdCA9IG51bGw7IHIgPCBpW2VdLmxlbmd0aDsgKytyKVxuICAgICAgICAgICAgICAgICAgICBpZiAoXCJvYmplY3RcIiA9PSB0eXBlb2YgKHQgPSBpW2VdW3JdKSAmJiBuID09PSB0LmlmcmFtZUlkKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICEwOyByZXR1cm4gITE7IH0sIGhhc0NhbGxiYWNrOiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gaVtlXSAmJiBpW2VdLmxlbmd0aCA+IDA7IH0sIHJlZ2lzdGVyQ2FsbGJhY2s6IGZ1bmN0aW9uIChlLCB0KSB7IHZhciByLCBvLCBhLCBzID0gXCJzdHJpbmdcIiA9PSB0eXBlb2YgZSA/IGUgOiBudWxsLCBjID0gXCJvYmplY3RcIiA9PSB0eXBlb2YgZSA/IGUgOiBudWxsOyBpZiAocykge1xuICAgICAgICAgICAgICAgIGlmIChyID0gXCJmdW5jdGlvblwiID09IHR5cGVvZiB0ID8gdCA6IG51bGwsIHZvaWQgMCA9PT0gaVtzXSlcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIGlbc10ucHVzaChyKTtcbiAgICAgICAgICAgIH0gaWYgKGMpXG4gICAgICAgICAgICAgICAgZm9yIChhIGluIG8gPSBcInN0cmluZ1wiID09IHR5cGVvZiB0ID8gdCA6IG51bGwsIGkpXG4gICAgICAgICAgICAgICAgICAgIFwiZnVuY3Rpb25cIiA9PSB0eXBlb2YgY1thXSAmJiAobi5kZWJ1ZyhcIlJlZ2lzdGVyaW5nIFwiICsgYSArIFwiIGNhbGxiYWNrIGZvciBpZnJhbWUgXCIgKyBvKSwgaVthXS5wdXNoKHsgaWZyYW1lSWQ6IG8sIGNhbGxiYWNrOiBjW2FdIH0pKTsgfSwgZmlyZUNhbGxiYWNrczogZnVuY3Rpb24gKGUsIG4sIHQsIHIpIHsgcmV0dXJuIGEuZmlyZSh0LCBlLCByLCBuKTsgfSwgZmlyZTogZnVuY3Rpb24gKHIsIG8sIGEsIHMsIGMsIGwpIHsgdmFyIHUsIGQsIHAsIGYgPSAhMSwgbSA9IFtdOyBzICYmIG0ucHVzaChzKSwgYyAmJiBtLnB1c2goYyksIGwgJiYgbS5wdXNoKGwpOyB2YXIgZyA9IHMgJiYgcy5yZXN1bHRDYWxsYmFja0lkLCB2ID0gZnVuY3Rpb24gKHQpIHsgaWYgKGEpXG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG0ubGVuZ3RoID4gMSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkLmFwcGx5KG51bGwsIG0pO1xuICAgICAgICAgICAgICAgICAgICBpZiAoXCJsb2dpblJlcXVpcmVkXCIgPT09IG8pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpID0gZS5kZWVwRXh0ZW5kKHt9LCB0LnRlcm0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRlbGV0ZSB0LnRlcm0sIGQodCwgciwgaSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQodCwgcik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIG4uZGVidWcoZSk7XG4gICAgICAgICAgICAgICAgfSB9OyBpZiAodm9pZCAwICE9PSBpW29dKSB7XG4gICAgICAgICAgICAgICAgZm9yIChwID0gMCwgdSA9IG51bGwsIGQgPSBudWxsOyBwIDwgaVtvXS5sZW5ndGg7ICsrcCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoXCJmdW5jdGlvblwiID09IHR5cGVvZiAoZCA9IGlbb11bcF0pKVxuICAgICAgICAgICAgICAgICAgICAgICAgbi5kZWJ1ZyhcImZpcmluZyBjYWxsYmFjayBmb3IgZXZlbnQgJ1wiICsgbyArIFwiJyBmcm9tIGlmcmFtZShcIiArIHIgKyBcIilcIiksIHUgPSB2KHMpLCBmID0gITA7XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKFwib2JqZWN0XCIgPT0gdHlwZW9mIGQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyICE9PSBkLmlmcmFtZUlkKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgbi5kZWJ1ZyhcImZpcmluZyBjYWxsYmFjayBmb3IgZXZlbnQgJ1wiICsgbyArIFwiJyBmcm9tIGlmcmFtZShcIiArIHIgKyBcIilcIiksIGQgPSBkLmNhbGxiYWNrLCB1ID0gdihzKSwgZiA9ICEwO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGcgJiYgKHMucmVzdWx0ID0gdSwgcy5ldmVudCA9IG8sIHQuc2VuZChcInJlc3VsdENhbGxiYWNrXCIsIHMsIHIpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuICFmICYmIGcgJiYgKHMuY2FsbGJhY2tOb3RGb3VuZCA9ICEwLCBzLmV2ZW50ID0gbywgdC5zZW5kKFwicmVzdWx0Q2FsbGJhY2tcIiwgcywgcikpLCB1O1xuICAgICAgICAgICAgfSB9LCBmaXJlQ2FsbGJhY2tzQW5kU3RvcE9uRmlyc3RGYWxzZTogZnVuY3Rpb24gKGUsIHQsIHIsIG8pIHsgZm9yICh2YXIgYSA9IFtdLCBzID0gNDsgcyA8IGFyZ3VtZW50cy5sZW5ndGg7IHMrKylcbiAgICAgICAgICAgICAgICBhW3MgLSA0XSA9IGFyZ3VtZW50c1tzXTsgaWYgKHZvaWQgMCA9PT0gaVtlXSlcbiAgICAgICAgICAgICAgICByZXR1cm4gITA7IGZvciAodmFyIGMgPSAhMCwgbCA9IDA7IGwgPCBpW2VdLmxlbmd0aDsgbCsrKSB7XG4gICAgICAgICAgICAgICAgdmFyIHUgPSBpW2VdW2xdO1xuICAgICAgICAgICAgICAgIGlmIChcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIHUpIHtcbiAgICAgICAgICAgICAgICAgICAgbi5kZWJ1ZyhcImZpcmluZyBjYWxsYmFjayBmb3IgZXZlbnQgJ1wiICsgZSArIFwiJ1wiKTtcbiAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZC5wdXNoKHQpLCBkLnB1c2gociksIGQucHVzaChvKSwgZCA9IGQuY29uY2F0KFtdLnNsaWNlLmNhbGwoYSkpLCAhMSA9PT0gdS5hcHBseShudWxsLCBkKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG4uZGVidWcoXCJjYWxsYmFjayBmb3IgZXZlbnQgJ1wiICsgZSArIFwiJyByZXR1cm5lZCBmYWxzZVwiKSwgYyA9ICExO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNhdGNoICh0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuLmRlYnVnKFwiZmlyaW5nIGNhbGxiYWNrIGZvciBldmVudCAnXCIgKyBlICsgXCInIGZhaWxlZFwiLCB0KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gcmV0dXJuIGM7IH0gfTsgcmV0dXJuIGE7IH0gfTsgfSgpO1xuICAgIHBuLmNvbnRhaW5lci5yZWdpc3RlcihcImV2ZW50VXRpbHNcIiwgeyB1c2VWYWx1ZTogeGUgfSksIHBuLmV2ZW50VXRpbHMgPSBwbi5jb250YWluZXIucmVzb2x2ZShcImV2ZW50VXRpbHNcIik7XG4gICAgdmFyIFBlID0gZnVuY3Rpb24gKCkgeyB2YXIgZSA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwidXRpbFwiKSwgbiA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwiYXBpXCIpLCB0ID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJldmVudFV0aWxzXCIpLCByID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJsb2NhbFN0b3JhZ2VcIiksIG8gPSB0LmNyZWF0ZUV2ZW50TWFuYWdlcihbXCJ1c2VyQ2hhbmdlZFwiLCBcImxvZ291dFwiXSksIGkgPSBcImphbnJhaW5cIiwgYSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGUuZ2V0VXNlclRva2VuQ29va2llKCk7IH0sIHMgPSBmdW5jdGlvbiAoKSB7IHZhciBlID0gYSgpOyByZXR1cm4gISEodm9pZCAwICE9PSBlICYmIGUgJiYgZS5sZW5ndGggPj0gMCk7IH0sIGMgPSAhMSwgbCA9ICExLCB1ID0geyBvbkNhcHR1cmVTZXNzaW9uQ3JlYXRlZDogW10gfSwgZCA9IHsgbG9naW5SZXF1aXJlZFNjcmVlbjogXCJzaWduSW5cIiwgYXBwTmFtZTogbnVsbCwgYXBwSWQ6IG51bGwsIGNsaWVudElkOiBudWxsLCBzZXR0aW5nczogbnVsbCwgZGlzYWJsZUxvZ291dDogITEsIHN0YXJ0Q2FwdHVyZTogITEgfSwgcCA9IHsgcmVnaXN0ZXI6IFwidHJhZGl0aW9uYWxSZWdpc3RyYXRpb25cIiwgbG9naW46IFwic2lnbkluXCIgfTsgdmFyIGYgPSBmdW5jdGlvbiAoZSkgeyByZXR1cm4gZSAmJiBwLmhhc093blByb3BlcnR5KGUuc3RhcnRTY3JlZW4pID8gcFtlLnN0YXJ0U2NyZWVuXSA6IGQubG9naW5SZXF1aXJlZFNjcmVlbjsgfTsgdmFyIG0gPSBmdW5jdGlvbiAoKSB7IGQuZGlzYWJsZUxvZ291dCB8fCBlLnNldEFjY2Vzc1Rva2VuTGlzdENvb2tpZSh2b2lkIDAsIHZvaWQgMCwgITApOyB9LCBnID0gITAsIHYgPSBmdW5jdGlvbiAoKSB7IHZhciBlID0gd2luZG93LmphbnJhaW47IHJldHVybiBlICYmIGUuY2FwdHVyZSAmJiBlLmNhcHR1cmUudWkgJiYgZS5jYXB0dXJlLnVpLmhhc0FjdGl2ZVNlc3Npb24oKTsgfTsgZnVuY3Rpb24gaCgpIHsgZS5sb2coXCJKQU5SQUlOOlwiLCBcIlByb2Nlc3NpbmcgamFucmFpbiB1c2VyXCIpLCBnID8gZyA9ICExIDogZS5zdGFydENhbGwoXCJyZWZyZXNoVXNlclRva2VuXCIpLCBlLmxvZyhcIkpBTlJBSU46XCIsIFwiaGFzQWN0aXZlU2Vzc2lvbjpcIiArIHYoKSk7IHZhciB0ID0gdygpOyBpZiAoIXYoKSlcbiAgICAgICAgcmV0dXJuIGUubG9nKFwiSkFOUkFJTjpcIiwgXCJObyB0b2tlbiBmb3VuZC4gIERvbmUgcHJvY2Vzc2luZyB1c2VyXCIpLCBtKCksIHZvaWQgZS5kb25lQ2FsbChcInJlZnJlc2hVc2VyVG9rZW5cIik7IGlmIChzKCkpXG4gICAgICAgIHJldHVybiBlLmxvZyhcIkpBTlJBSU46XCIsIFwiVXNpbmcgX191dC4gIERvbmUgcHJvY2Vzc2luZyB1c2VyXCIpLCB2b2lkIGUuZG9uZUNhbGwoXCJyZWZyZXNoVXNlclRva2VuXCIpOyB2YXIgciA9IHsgamFucmFpbl9jYXB0dXJlX3Rva2VuOiB0LCB1cmw6IGUucHJlcGFyZVVybFBhcmFtZXRlcih3aW5kb3cubG9jYXRpb24uaHJlZikgfTsgbi5jYWxsQXBpKFwiL2Fub24vamFucmFpbi92ZXJpZnlBY2NvdW50SW5mb1wiLCByLCAoZnVuY3Rpb24gKG4pIHsgaWYgKG4gJiYgbi5hY2Nlc3MpXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBlLmxvZyhcIkpBTlJBSU46XCIsIFwiVmVyaWZ5IHN1Y2Nlc3MuICBEb25lIHByb2Nlc3NpbmcgdXNlclwiKSwgZS5zZXRBY2Nlc3NUb2tlbkxpc3RDb29raWUobi5hY2Nlc3MuYWNjZXNzX3Rva2VuLCBuLmFjY2Vzcy51c2VyX3Rva2VuKTtcbiAgICAgICAgICAgIHZhciB0ID0geyBhY2Nlc3NfdG9rZW46IG4uYWNjZXNzLmFjY2Vzc190b2tlbiwgdXNlcl90b2tlbjogbi5hY2Nlc3MudXNlcl90b2tlbiB9O1xuICAgICAgICAgICAgbi5hY2Nlc3MudXNlciAmJiAodC51c2VyID0geyB1aWQ6IG4uYWNjZXNzLnVzZXIudWlkLCBlbWFpbDogbi5hY2Nlc3MudXNlci5lbWFpbCwgZmlyc3ROYW1lOiBuLmFjY2Vzcy51c2VyLmZpcnN0X25hbWUsIGxhc3ROYW1lOiBuLmFjY2Vzcy51c2VyLmxhc3RfbmFtZSwgdmFsaWQ6IG4uYWNjZXNzLnVzZXIudmFsaWQgfSksIGZ1bmN0aW9uIChlLCBuKSB7IGlmICh2b2lkIDAgIT09IHVbZV0gJiYgMCAhPT0gdVtlXS5sZW5ndGgpXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgdCA9IDA7IHQgPCB1W2VdLmxlbmd0aDsgKyt0KVxuICAgICAgICAgICAgICAgICAgICB1W2VdW3RdLmFwcGx5KG51bGwsIGFyZ3VtZW50cyk7IH0oXCJvbkNhcHR1cmVTZXNzaW9uQ3JlYXRlZFwiLCB0KSwgby5maXJlQ2FsbGJhY2tzKFwidXNlckNoYW5nZWRcIiwgdCwgdm9pZCAwLCAhMCk7XG4gICAgICAgIH1cbiAgICAgICAgZmluYWxseSB7XG4gICAgICAgICAgICBlLmRvbmVDYWxsKFwicmVmcmVzaFVzZXJUb2tlblwiKTtcbiAgICAgICAgfVxuICAgIGVsc2VcbiAgICAgICAgZS5sb2coXCJKQU5SQUlOOlwiLCBcIlZlcmlmeSBmYWlsZWRcIik7IH0pKTsgfSB2YXIgdyA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHIuZ2V0KFwiamFucmFpbkNhcHR1cmVUb2tlblwiKTsgfSwgeSA9IGZ1bmN0aW9uICgpIHsgdmFyIG4gPSB3aW5kb3cuamFucmFpbjsgbi5ldmVudHMub25Qcm92aWRlckxvZ291dENvbXBsZXRlLmFkZEhhbmRsZXIoKGZ1bmN0aW9uICgpIHsgbSgpOyB9KSksIG4uZXZlbnRzLm9uQ2FwdHVyZVNlc3Npb25FbmRlZC5hZGRIYW5kbGVyKChmdW5jdGlvbiAobikgeyBlLmxvZyhcIkpBTlJBSU46IEV2ZW50cyByZWNlaXZlZCBmb3IgbG9nb3V0XCIsIG4pLCBtKCk7IH0pKSwgYigpOyB9LCBiID0gZnVuY3Rpb24gKCkgeyBpZiAodigpKVxuICAgICAgICByZXR1cm4gZS5sb2coXCJKQU5SQUlOOlwiLCBcIkZvdW5kIGVhcmx5IGFjdGl2ZSBzZXNzaW9uIHZpYSBmdW5jdGlvblwiKSwgdm9pZCBoKCk7IGlmICghdigpICYmICFzKCkgJiYgIXcoKSlcbiAgICAgICAgcmV0dXJuIGUubG9nKFwiSkFOUkFJTjpcIiwgXCJub3QgZm91bmQgX191dCBjb29raWUgYW5kIGphbnJhaW4gdG9rZW5cIiksIHZvaWQgaCgpOyB2YXIgbiA9ICExLCB0ID0gd2luZG93LmphbnJhaW47IHQuZXZlbnRzLm9uQ2FwdHVyZVNlc3Npb25Gb3VuZC5hZGRIYW5kbGVyKChmdW5jdGlvbiAodCkgeyBrKCkgPyBuICYmIChlLmxvZyhcIkpBTlJBSU46IEV2ZW50cyByZWNlaXZlZCBmb3IgbG9nZ2VkIGluIHVzZXJcIiwgdCksIGgoKSkgOiBoKCk7IH0pKSwgdC5ldmVudHMub25DYXB0dXJlU2Vzc2lvbk5vdEZvdW5kLmFkZEhhbmRsZXIoKGZ1bmN0aW9uICh0KSB7IGsoKSA/IG4gJiYgKGUubG9nKFwiSkFOUkFJTjogRXZlbnRzIHJlY2VpdmVkIGZvciBsb2dnZWQgb3V0IHVzZXJcIiwgdCksIGgoKSkgOiBoKCk7IH0pKSwgdC5ldmVudHMub25DYXB0dXJlRmVkZXJhdGVOb0xvZ2luLmFkZEhhbmRsZXIoKGZ1bmN0aW9uIChlKSB7IG4gPSBlOyB9KSksIHQuZXZlbnRzLm9uQ2FwdHVyZUZlZGVyYXRlTG9naW4uYWRkSGFuZGxlcigoZnVuY3Rpb24gKG4pIHsgZS5sb2coXCJKQU5SQUlOOiBFdmVudHMgcmVjZWl2ZWQgZm9yIFNTTyBsb2dpblwiLCBuKSwgaCgpOyB9KSk7IH0sIGsgPSBmdW5jdGlvbiAoKSB7IHZhciBlID0gd2luZG93LmphbnJhaW47IHJldHVybiBlICYmIGUuc2V0dGluZ3MgJiYgZS5zZXR0aW5ncy5jYXB0dXJlICYmIGUuc2V0dGluZ3MuY2FwdHVyZS5mZWRlcmF0ZTsgfTsgZnVuY3Rpb24gXyhlLCBuKSB7IGlmICghYylcbiAgICAgICAgdGhyb3cgXCJKYW5yYWluIGlzIG5vdCBjb25maWd1cmVkXCI7IHZhciB0ID0gMDsgIWZ1bmN0aW9uIHIoKSB7IHZhciBvID0gd2luZG93LmphbnJhaW47IGlmIChsKVxuICAgICAgICBvLmV2ZW50c1tlXS5hZGRIYW5kbGVyKChmdW5jdGlvbiAoZSkgeyBuKGUpOyB9KSk7XG4gICAgZWxzZSB7XG4gICAgICAgIGlmICh0ID4gMTAwKVxuICAgICAgICAgICAgdGhyb3cgXCJKYW5yYWluIGlzIG5vdCBpbml0aWFsaXplZFwiO1xuICAgICAgICB0KyssIHdpbmRvdy5zZXRUaW1lb3V0KHIsIDEwMCk7XG4gICAgfSB9KCk7IH0gcmV0dXJuIHsgbmFtZTogaSwgaXN2OiAhMSwgaW5pdDogZnVuY3Rpb24gKG4pIHsgaWYgKCFjKSB7XG4gICAgICAgICAgICBpZiAoIW4uYXBwTmFtZSB8fCAhbi5hcHBJZCB8fCAhbi5jbGllbnRJZClcbiAgICAgICAgICAgICAgICB0aHJvdyBcIk11c3Qgc3BlY2lmeSBhcHBOYW1lLCBhcHBJZCwgYW5kIGNsaWVudElkIHRvIGluaXRpYWxpemUgamFucmFpblwiO1xuICAgICAgICAgICAgZm9yICh2YXIgdCBpbiBkKVxuICAgICAgICAgICAgICAgIHZvaWQgMCAhPT0gblt0XSAmJiAoZFt0XSA9IG5bdF0pO1xuICAgICAgICAgICAgaWYgKG4uc2V0dGluZ3MgJiYgKGQuc2V0dGluZ3MgPSBuLnNldHRpbmdzKSwgbi5sb2dpblJlcXVpcmVkU2NyZWVuICYmIChkLmxvZ2luUmVxdWlyZWRTY3JlZW4gPSBuLmxvZ2luUmVxdWlyZWRTY3JlZW4pLCBkLnNldHRpbmdzKSB7XG4gICAgICAgICAgICAgICAgXCJvYmplY3RcIiAhPSB0eXBlb2Ygd2luZG93LmphbnJhaW4gJiYgKHdpbmRvdy5qYW5yYWluID0ge30pLCBcIm9iamVjdFwiICE9IHR5cGVvZiB3aW5kb3cuamFucmFpbi5zZXR0aW5ncyAmJiAod2luZG93LmphbnJhaW4uc2V0dGluZ3MgPSB7fSk7XG4gICAgICAgICAgICAgICAgdmFyIHIgPSB3aW5kb3cuamFucmFpbjtcbiAgICAgICAgICAgICAgICByLnNldHRpbmdzID0gZC5zZXR0aW5ncywgXCJvYmplY3RcIiAhPSB0eXBlb2Ygd2luZG93LmphbnJhaW4uc2V0dGluZ3MuY2FwdHVyZSAmJiAod2luZG93LmphbnJhaW4uc2V0dGluZ3MuY2FwdHVyZSA9IHt9KSwgci5zZXR0aW5ncy5hcHBVcmwgPSBcImh0dHBzOi8vXCIgKyBkLmFwcE5hbWUgKyBcIi5ycHhub3cuY29tXCIsIHIuc2V0dGluZ3MuY2FwdHVyZS5jYXB0dXJlU2VydmVyID0gXCJodHRwczovL1wiICsgZC5hcHBOYW1lICsgXCIuamFucmFpbmNhcHR1cmUuY29tXCIsIHIuc2V0dGluZ3MuY2FwdHVyZS5hcHBJZCA9IGQuYXBwSWQsIHIuc2V0dGluZ3MuY2FwdHVyZS5jbGllbnRJZCA9IGQuY2xpZW50SWQ7XG4gICAgICAgICAgICAgICAgdmFyIG8sIGkgPSBkLmFwcE5hbWUucmVwbGFjZSgvXFwuL2csIFwiLVwiKSwgYSA9IFwiaHR0cDovL3dpZGdldC1jZG4ucnB4bm93LmNvbS9sb2FkL1wiICsgaSwgcyA9IFwiaHR0cHM6Ly9ycHhub3cuY29tL2xvYWQvXCIgKyBpO1xuICAgICAgICAgICAgICAgIG8gPSBlLl9fcHJvdGVjdGVkX18uaXNIdHRwc1Byb3RvY29sKCkgPyBzIDogYSwgcG4ucHVzaChbXCJhZGRFeHRlcm5hbExpYnJhcnlcIiwgbywgZnVuY3Rpb24gKCkgeyByLnJlYWR5ID0gITA7IH1dKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGUubG9nKFwiSkFOUkFJTjpcIiwgXCJzdGFydCByZWZyZXNoIHVzZXIgdG9rZW5cIiksIGUuc3RhcnRDYWxsKFwicmVmcmVzaFVzZXJUb2tlblwiLCAzZTQpLCBlLndhaXRDYWxsKFwicmVmcmVzaFVzZXJUb2tlblwiLCAoZnVuY3Rpb24gKCkgeyBlLmxvZyhcIkpBTlJBSU46XCIsIFwiZW5kIHJlZnJlc2ggdXNlciB0b2tlblwiKTsgfSkpLCBmdW5jdGlvbiAoKSB7IHZhciBuID0gMTAwLCB0ID0gMDsgZnVuY3Rpb24gcigpIHsgdmFyIG8gPSB3aW5kb3cuamFucmFpbjsgaWYgKHdpbmRvdy5qYW5yYWluICYmIHdpbmRvdy5qYW5yYWluLnJlYWR5ICYmIHdpbmRvdy5qYW5yYWluLmNhcHR1cmUgJiYgd2luZG93LmphbnJhaW4uY2FwdHVyZS51aSAmJiB3aW5kb3cuamFucmFpbi5jYXB0dXJlLnVpLmhhc0FjdGl2ZVNlc3Npb24pXG4gICAgICAgICAgICAgICAgIWZ1bmN0aW9uICgpIHsgdmFyIG4gPSB3aW5kb3cuamFucmFpbiwgdCA9IGZ1bmN0aW9uICh0KSB7IG4uZXZlbnRzW3RdLmFkZEhhbmRsZXIoKGZ1bmN0aW9uICgpIHsgZm9yICh2YXIgbiA9IFtdLCByID0gMDsgciA8IGFyZ3VtZW50cy5sZW5ndGg7IHIrKylcbiAgICAgICAgICAgICAgICAgICAgbltyXSA9IGFyZ3VtZW50c1tyXTsgZS5sb2coXCJKQU5SQUlOOiBcIiwgdCwgbik7IH0pKTsgfTsgcG4uZGVidWcgJiYgbi5ldmVudHMuY2FwdHVyZUV2ZW50cy5mb3JFYWNoKHQpOyB9KCksIHkoKSwgZC5zdGFydENhcHR1cmUgJiYgby5jYXB0dXJlLnVpLnN0YXJ0KCksIGwgPSAhMDtcbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmICh0ID4gbilcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgXCJKYW5yYWluIGlzIG5vdCBpbml0aWFsaXplZFwiO1xuICAgICAgICAgICAgICAgIHQrKywgd2luZG93LnNldFRpbWVvdXQociwgMTAwKTtcbiAgICAgICAgICAgIH0gfSByKCk7IH0oKSwgYyA9ICEwLCBwbi56SW5kZXhlcyA9IHsgYmFja2Ryb3A6IDkwMCwgbW9kYWw6IDk1MCwgY2xvc2U6IDk5MCB9O1xuICAgICAgICAgICAgdmFyIHUgPSBmdW5jdGlvbiAobikgeyBlLmxvZyhcIkpBTlJBSU46IG9uTG9naW5cIiksIHdpbmRvdy5qYW5yYWluLmNhcHR1cmUudWkubW9kYWwuY2xvc2UoKSwgaCgpOyB9O1xuICAgICAgICAgICAgXyhcIm9uQ2FwdHVyZUxvZ2luU3VjY2Vzc1wiLCB1KSwgXyhcIm9uQ2FwdHVyZVJlZ2lzdHJhdGlvblN1Y2Nlc3NcIiwgdSk7XG4gICAgICAgIH0gfSwgaXNVc2VyVmFsaWQ6IHMsIGdldFRva2VuOiBhLCBnZXROYW1lOiBmdW5jdGlvbiAoKSB7IHJldHVybiBpOyB9LCBvbkxvZ2luU3VjY2VzczogZnVuY3Rpb24gKG4pIHsgZS5zZXRBY2Nlc3NUb2tlbkxpc3RDb29raWUoeyB2YWx1ZTogbi50b2tlbl9saXN0LCBjb29raWVfZG9tYWluOiBuLmNvb2tpZV9kb21haW4gfSwgbi51c2VyX3Rva2VuKTsgfSwgbG9naW46IGZ1bmN0aW9uIChlLCBuKSB7IGlmICghYylcbiAgICAgICAgICAgIHRocm93IFwiSmFucmFpbiBpcyBub3QgY29uZmlndXJlZFwiOyB2YXIgdCA9IDAsIHIgPSBmdW5jdGlvbiAoKSB7IGlmIChsKVxuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICB3aW5kb3cuamFucmFpbi5jYXB0dXJlLnVpLnJlbmRlclNjcmVlbihmKG4pKSwgXCJmdW5jdGlvblwiID09IHR5cGVvZiBlICYmIGZ1bmN0aW9uIChlLCBuKSB7IHVbZV0gPSBbXSwgdVtlXS5wdXNoKG4pOyB9KFwib25DYXB0dXJlU2Vzc2lvbkNyZWF0ZWRcIiwgZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0KyssIHZvaWQgd2luZG93LnNldFRpbWVvdXQociwgMTAwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBpZiAodCA+IDEwMClcbiAgICAgICAgICAgICAgICB0aHJvdyBcIkphbnJhaW4gaXMgbm90IGluaXRpYWxpemVkXCI7XG4gICAgICAgICAgICB0KyssIHdpbmRvdy5zZXRUaW1lb3V0KHIsIDEwMCk7XG4gICAgICAgIH0gfTsgcigpOyB9LCBsb2dvdXQ6IGZ1bmN0aW9uIChlKSB7IGlmICghYylcbiAgICAgICAgICAgIHRocm93IFwiSmFucmFpbiBpcyBub3QgY29uZmlndXJlZFwiOyB2YXIgbiA9IDAsIHQgPSAwOyBmdW5jdGlvbiByKCkgeyB0ID4gMTAwID8gZSgpIDogdigpID8gKHQrKywgd2luZG93LnNldFRpbWVvdXQociwgMTAwKSkgOiBlKCk7IH0gbSgpLCBmdW5jdGlvbiB0KCkgeyBpZiAobCkge1xuICAgICAgICAgICAgdmFyIGkgPSB3aW5kb3cuamFucmFpbjtcbiAgICAgICAgICAgIGkuY2FwdHVyZS51aS5tb2RhbC5jbG9zZSgpLCBpLmNhcHR1cmUudWkuZW5kQ2FwdHVyZVNlc3Npb24oKSwgby5maXJlQ2FsbGJhY2tzKFwibG9nb3V0XCIsIG51bGwsIHZvaWQgMCwgITApLCBlICYmIHIoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGlmIChuID4gMTAwKVxuICAgICAgICAgICAgICAgIHRocm93IFwiSmFucmFpbiBpcyBub3QgaW5pdGlhbGl6ZWRcIjtcbiAgICAgICAgICAgIG4rKywgd2luZG93LnNldFRpbWVvdXQodCwgMTAwKTtcbiAgICAgICAgfSB9KCk7IH0sIGlzQ29uZmlndXJlZDogZnVuY3Rpb24gKCkgeyByZXR1cm4gYzsgfSwgZ2V0TG9naW5SZXF1aXJlZFNjcmVlbjogZiwgYWRkRXZlbnRIYW5kbGVyOiBfLCByZWdpc3RlckNhbGxiYWNrOiBmdW5jdGlvbiAoZSwgbikgeyBvLmFkZEV2ZW50KGUpLCBvLnJlZ2lzdGVyQ2FsbGJhY2soZSwgKGZ1bmN0aW9uIChlKSB7IG4oZSk7IH0pKTsgfSB9OyB9KCk7XG4gICAgcG4uY29udGFpbmVyLnJlZ2lzdGVyKFwiamFucmFpblwiLCB7IHVzZVZhbHVlOiBQZSB9KSwgcG4uamFucmFpbiA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwiamFucmFpblwiKTtcbiAgICB2YXIgRWUgPSB7IG5hbWU6IFwic2hhMVwiLCBoYXNoOiBmdW5jdGlvbiAoZSwgbikgeyBmdW5jdGlvbiB0KGUsIG4pIHsgcmV0dXJuIGUgPDwgbiB8IGUgPj4+IDMyIC0gbjsgfSBmdW5jdGlvbiByKGUpIHsgdmFyIG4sIHQgPSBcIlwiOyBmb3IgKG4gPSA3OyBuID49IDA7IG4tLSlcbiAgICAgICAgICAgIHQgKz0gKGUgPj4+IDQgKiBuICYgMTUpLnRvU3RyaW5nKDE2KTsgcmV0dXJuIHQ7IH0gdmFyIG8sIGksIGE7IG4gPSBuIHx8IDMyOyB2YXIgcywgYywgbCwgdSwgZCwgcCwgZiA9IG5ldyBBcnJheSg4MCksIG0gPSAxNzMyNTg0MTkzLCBnID0gNDAyMzIzMzQxNywgdiA9IDI1NjIzODMxMDIsIGggPSAyNzE3MzM4NzgsIHcgPSAzMjg1Mzc3NTIwLCB5ID0gKGUgPSBmdW5jdGlvbiAoZSkgeyBlID0gZS5yZXBsYWNlKC9cXHJcXG4vZywgXCJcXG5cIik7IGZvciAodmFyIG4gPSBcIlwiLCB0ID0gMDsgdCA8IGUubGVuZ3RoOyB0KyspIHtcbiAgICAgICAgICAgIHZhciByID0gZS5jaGFyQ29kZUF0KHQpO1xuICAgICAgICAgICAgciA8IDEyOCA/IG4gKz0gU3RyaW5nLmZyb21DaGFyQ29kZShyKSA6IHIgPiAxMjcgJiYgciA8IDIwNDggPyAobiArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKHIgPj4gNiB8IDE5MiksIG4gKz0gU3RyaW5nLmZyb21DaGFyQ29kZSg2MyAmIHIgfCAxMjgpKSA6IChuICs9IFN0cmluZy5mcm9tQ2hhckNvZGUociA+PiAxMiB8IDIyNCksIG4gKz0gU3RyaW5nLmZyb21DaGFyQ29kZShyID4+IDYgJiA2MyB8IDEyOCksIG4gKz0gU3RyaW5nLmZyb21DaGFyQ29kZSg2MyAmIHIgfCAxMjgpKTtcbiAgICAgICAgfSByZXR1cm4gbjsgfShlKSkubGVuZ3RoLCBiID0gbmV3IEFycmF5OyBmb3IgKGkgPSAwOyBpIDwgeSAtIDM7IGkgKz0gNClcbiAgICAgICAgICAgIGEgPSBlLmNoYXJDb2RlQXQoaSkgPDwgMjQgfCBlLmNoYXJDb2RlQXQoaSArIDEpIDw8IDE2IHwgZS5jaGFyQ29kZUF0KGkgKyAyKSA8PCA4IHwgZS5jaGFyQ29kZUF0KGkgKyAzKSwgYi5wdXNoKGEpOyBzd2l0Y2ggKHkgJSA0KSB7XG4gICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgaSA9IDIxNDc0ODM2NDg7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgaSA9IGUuY2hhckNvZGVBdCh5IC0gMSkgPDwgMjQgfCA4Mzg4NjA4O1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgIGkgPSBlLmNoYXJDb2RlQXQoeSAtIDIpIDw8IDI0IHwgZS5jaGFyQ29kZUF0KHkgLSAxKSA8PCAxNiB8IDMyNzY4O1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAzOiBpID0gZS5jaGFyQ29kZUF0KHkgLSAzKSA8PCAyNCB8IGUuY2hhckNvZGVBdCh5IC0gMikgPDwgMTYgfCBlLmNoYXJDb2RlQXQoeSAtIDEpIDw8IDggfCAxMjg7XG4gICAgICAgIH0gZm9yIChiLnB1c2goaSk7IGIubGVuZ3RoICUgMTYgIT0gMTQ7KVxuICAgICAgICAgICAgYi5wdXNoKDApOyBmb3IgKGIucHVzaCh5ID4+PiAyOSksIGIucHVzaCh5IDw8IDMgJiA0Mjk0OTY3Mjk1KSwgbyA9IDA7IG8gPCBiLmxlbmd0aDsgbyArPSAxNikge1xuICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IDE2OyBpKyspXG4gICAgICAgICAgICAgICAgZltpXSA9IGJbbyArIGldO1xuICAgICAgICAgICAgZm9yIChpID0gMTY7IGkgPD0gNzk7IGkrKylcbiAgICAgICAgICAgICAgICBmW2ldID0gdChmW2kgLSAzXSBeIGZbaSAtIDhdIF4gZltpIC0gMTRdIF4gZltpIC0gMTZdLCAxKTtcbiAgICAgICAgICAgIGZvciAocyA9IG0sIGMgPSBnLCBsID0gdiwgdSA9IGgsIGQgPSB3LCBpID0gMDsgaSA8PSAxOTsgaSsrKVxuICAgICAgICAgICAgICAgIHAgPSB0KHMsIDUpICsgKGMgJiBsIHwgfmMgJiB1KSArIGQgKyBmW2ldICsgMTUxODUwMDI0OSAmIDQyOTQ5NjcyOTUsIGQgPSB1LCB1ID0gbCwgbCA9IHQoYywgMzApLCBjID0gcywgcyA9IHA7XG4gICAgICAgICAgICBmb3IgKGkgPSAyMDsgaSA8PSAzOTsgaSsrKVxuICAgICAgICAgICAgICAgIHAgPSB0KHMsIDUpICsgKGMgXiBsIF4gdSkgKyBkICsgZltpXSArIDE4NTk3NzUzOTMgJiA0Mjk0OTY3Mjk1LCBkID0gdSwgdSA9IGwsIGwgPSB0KGMsIDMwKSwgYyA9IHMsIHMgPSBwO1xuICAgICAgICAgICAgZm9yIChpID0gNDA7IGkgPD0gNTk7IGkrKylcbiAgICAgICAgICAgICAgICBwID0gdChzLCA1KSArIChjICYgbCB8IGMgJiB1IHwgbCAmIHUpICsgZCArIGZbaV0gKyAyNDAwOTU5NzA4ICYgNDI5NDk2NzI5NSwgZCA9IHUsIHUgPSBsLCBsID0gdChjLCAzMCksIGMgPSBzLCBzID0gcDtcbiAgICAgICAgICAgIGZvciAoaSA9IDYwOyBpIDw9IDc5OyBpKyspXG4gICAgICAgICAgICAgICAgcCA9IHQocywgNSkgKyAoYyBeIGwgXiB1KSArIGQgKyBmW2ldICsgMzM5NTQ2OTc4MiAmIDQyOTQ5NjcyOTUsIGQgPSB1LCB1ID0gbCwgbCA9IHQoYywgMzApLCBjID0gcywgcyA9IHA7XG4gICAgICAgICAgICBtID0gbSArIHMgJiA0Mjk0OTY3Mjk1LCBnID0gZyArIGMgJiA0Mjk0OTY3Mjk1LCB2ID0gdiArIGwgJiA0Mjk0OTY3Mjk1LCBoID0gaCArIHUgJiA0Mjk0OTY3Mjk1LCB3ID0gdyArIGQgJiA0Mjk0OTY3Mjk1O1xuICAgICAgICB9IHJldHVybiAocCA9IHIobSkgKyByKGcpICsgcih2KSArIHIoaCkgKyByKHcpKS50b0xvd2VyQ2FzZSgpLnNsaWNlKDAsIG4pOyB9IH07XG4gICAgcG4uc2hhMSA9IEVlLCBwbi5jb250YWluZXIucmVnaXN0ZXIoXCJzaGExXCIsIHsgdXNlVmFsdWU6IEVlIH0pO1xuICAgIHZhciBUZSA9IGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZShlLCBuKSB7IHRoaXMuX2lzQWN0aXZlID0gITEsIHRoaXMudGFyZ2V0cyA9IFtdLCB0aGlzLnRpbWVvdXQgPSAyMDAsIHRoaXMudXRpbCA9IG4sIHRoaXMuY2FsbGJhY2sgPSBlOyB9IHJldHVybiBlLnByb3RvdHlwZS5fbXV0YXRpb25TZWFyY2ggPSBmdW5jdGlvbiAoKSB7IHZhciBlID0gdGhpczsgdGhpcy50YXJnZXRzLmZvckVhY2goKGZ1bmN0aW9uIChuKSB7IHZhciB0ID0gZS5fZ2V0U3RhdGUobi5lbGVtZW50KTsgIXQgPT09IG4uY3VycmVudFN0YXRlICYmIChuLmN1cnJlbnRTdGF0ZSA9IHQsIGUuY2FsbGJhY2soW3sgdGFyZ2V0OiBuLmVsZW1lbnQgfV0pKTsgfSkpLCB0aGlzLl9pc0FjdGl2ZSAmJiBzZXRUaW1lb3V0KHRoaXMuX211dGF0aW9uU2VhcmNoLmJpbmQodGhpcyksIHRoaXMudGltZW91dCk7IH0sIGUucHJvdG90eXBlLl9nZXRTdGF0ZSA9IGZ1bmN0aW9uIChlKSB7IHZhciBuID0gW10uc2xpY2UuY2FsbChlLmF0dHJpYnV0ZXMpLnJlZHVjZSgoZnVuY3Rpb24gKG4sIHQpIHsgcmV0dXJuIG5bdC5uYW1lXSA9IGUuZ2V0QXR0cmlidXRlKHQubmFtZSksIG47IH0pLCB7fSk7IHJldHVybiBKU09OLnN0cmluZ2lmeShuKTsgfSwgZS5wcm90b3R5cGUub2JzZXJ2ZSA9IGZ1bmN0aW9uIChlKSB7IHRoaXMudGFyZ2V0cy5wdXNoKHsgaWQ6IHRoaXMudXRpbC5yYW5kb21TdHJpbmcoKSwgZWxlbWVudDogZSwgY3VycmVudFN0YXRlOiB0aGlzLl9nZXRTdGF0ZShlKSB9KSwgdGhpcy5faXNBY3RpdmUgfHwgKHRoaXMuX2lzQWN0aXZlID0gITAsIHRoaXMuX211dGF0aW9uU2VhcmNoKCkpOyB9LCBlLnByb3RvdHlwZS5kaXNjb25uZWN0ID0gZnVuY3Rpb24gKCkgeyB0aGlzLl9pc0FjdGl2ZSA9ICExLCB0aGlzLnRhcmdldHMgPSBbXTsgfSwgZTsgfSgpLCBBZSA9IGZ1bmN0aW9uICgpIHsgcG4uY29udGFpbmVyLnJlc29sdmUoXCJqcVV0aWxzXCIpOyB2YXIgZSA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwidXRpbFwiKSwgbiA9IHdpbmRvdy5NdXRhdGlvbk9ic2VydmVyIHx8IHdpbmRvdy5XZWJLaXRNdXRhdGlvbk9ic2VydmVyIHx8IHdpbmRvdy5Nb3pNdXRhdGlvbk9ic2VydmVyLCB0ID0geyBhdHRyaWJ1dGVzOiAhMCB9OyByZXR1cm4geyBuYW1lOiBcIm9ic2VydmVyXCIsIGNyZWF0ZTogZnVuY3Rpb24gKHIsIG8pIHsgciB8fCBlLmVycm9yKFwiZWxlbWVudCBtdXN0IGJlIE5PREVcIik7IHZhciBpID0gbmV3IChuIHx8IFRlKSgoZnVuY3Rpb24gKGUpIHsgdmFyIG4gPSBlLm1hcCgoZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGUudGFyZ2V0OyB9KSk7IHJldHVybiBcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIG8gJiYgbyhuKTsgfSksIGUpOyByZXR1cm4gaS5vYnNlcnZlKHIsIHQpLCBpOyB9IH07IH0oKTtcbiAgICBwbi5jb250YWluZXIucmVnaXN0ZXIoXCJvYnNlcnZlclwiLCB7IHVzZVZhbHVlOiBBZSB9KSwgcG4ub2JzZXJ2ZXIgPSBwbi5jb250YWluZXIucmVzb2x2ZShcIm9ic2VydmVyXCIpO1xuICAgIHZhciBNZSA9IGZ1bmN0aW9uICgpIHsgdmFyIGUsIG4sIHQgPSBwbi5jb250YWluZXIucmVzb2x2ZShcImpxVXRpbHNcIiksIHIgPSBwbi5jb250YWluZXIucmVzb2x2ZShcInV0aWxcIiksIG8gPSBwbi5jb250YWluZXIucmVzb2x2ZShcInBvc3RtZXNzYWdlXCIpLCBpID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJldmVudFV0aWxzXCIpLCBhID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJzaGExXCIpLCBzID0ge30sIGMgPSB7fSwgbCA9IGkuY3JlYXRlRXZlbnRNYW5hZ2VyKFtcImNsb3NlXCJdKSwgdSA9IFwidHAtY29udGFpbmVyLWlubmVyXCIsIGQgPSBuZXcgTWFwLCBwID0gW10sIGYgPSBcImZyb3plbi1tb2JpbGUtYm9keVwiLCBtID0geyBfaW5pdGlhbFNjcm9sbFBvc2l0aW9uOiB7IHg6IDAsIHk6IDAgfSwgYXBwbHlGaXg6IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSB3aW5kb3cudmlzdWFsVmlld3BvcnQgPyBNYXRoLm1heCh3aW5kb3cuc2Nyb2xsWSwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcCwgd2luZG93LnZpc3VhbFZpZXdwb3J0LnBhZ2VUb3ApIDogTWF0aC5tYXgod2luZG93LnNjcm9sbFksIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3ApLCB0ID0gcG4uZG9udFNjcm9sbFRvcE1vZGFsID8gZSA6IDA7IHRoaXMuc2F2ZUluaXRpYWxTY3JvbGwod2luZG93LnNjcm9sbFgsIGUpLCBuICYmIChwbi5kb250U2Nyb2xsVG9wTW9kYWwgPyAoZG9jdW1lbnQuYm9keS5zdHlsZS50b3VjaEFjdGlvbiA9IFwibm9uZVwiLCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc3R5bGUudG91Y2hBY3Rpb24gPSBcIm5vbmVcIiwgdGhpcy5hZGRFdmVudHMoXCJzY3JvbGxcIiksIHRoaXMuYWRkRXZlbnRzKFwidG91Y2htb3ZlXCIpKSA6ICh2KCksIGcoMCwgMCkpLCBzZXRUaW1lb3V0KChmdW5jdGlvbiAoKSB7IHZhciBlID0geyBvdmVyc2Nyb2xsQmVoYXZpb3I6IFwiY29udGFpblwiLCBwb3NpdGlvbjogXCJhYnNvbHV0ZVwiLCB0b3A6IHQgKyBcInB4XCIsIGhlaWdodDogXCIxMDAlXCIsIHdpZHRoOiBcIjEwMCVcIiwgb3ZlcmZsb3dYOiBcInVuc2V0XCIsIG92ZXJmbG93WTogXCJzY3JvbGxcIiB9OyBPYmplY3Qua2V5cyhlKS5mb3JFYWNoKChmdW5jdGlvbiAodCkgeyBuLnN0eWxlW3RdID0gZVt0XTsgfSkpLCBuLnNjcm9sbEhlaWdodCA+IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQgJiYgbi5jbGFzc0xpc3QuYWRkKFwidHAtbW9kYWxfX21hcmdpbi0xMDBcIik7IH0pLCA1MDApKTsgfSwgYWRkRXZlbnRzOiBmdW5jdGlvbiAoZSkgeyBkb2N1bWVudC5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoZSwgdGhpcy5zY3JvbGxSZXZlcnQsIHsgcGFzc2l2ZTogITEgfSksIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoZSwgdGhpcy5zY3JvbGxSZXZlcnQsIHsgcGFzc2l2ZTogITEgfSk7IH0sIHJlbW92ZUV2ZW50czogZnVuY3Rpb24gKGUpIHsgZG9jdW1lbnQuYm9keS5yZW1vdmVFdmVudExpc3RlbmVyKGUsIHRoaXMuc2Nyb2xsUmV2ZXJ0LCAhMSksIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoZSwgdGhpcy5zY3JvbGxSZXZlcnQsICExKTsgfSwgcmVtb3ZlRml4OiBmdW5jdGlvbiAoKSB7IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIudHAtaWZyYW1lLXdyYXBwZXIudHAtYWN0aXZlXCIpLmxlbmd0aCB8fCAocG4uZG9udFNjcm9sbFRvcE1vZGFsID8gKGRvY3VtZW50LmJvZHkuc3R5bGUucmVtb3ZlUHJvcGVydHkoXCJ0b3VjaC1hY3Rpb25cIiksIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zdHlsZS5yZW1vdmVQcm9wZXJ0eShcInRvdWNoLWFjdGlvblwiKSwgdGhpcy5yZW1vdmVFdmVudHMoXCJzY3JvbGxcIiksIHRoaXMucmVtb3ZlRXZlbnRzKFwidG91Y2htb3ZlXCIpKSA6IChoKCksIHRoaXMuX3Njcm9sbEJhY2soKSkpOyB9LCBfc2Nyb2xsQmFjazogZnVuY3Rpb24gKCkgeyAodGhpcy5faW5pdGlhbFNjcm9sbFBvc2l0aW9uLnkgfHwgdGhpcy5faW5pdGlhbFNjcm9sbFBvc2l0aW9uLngpICYmIGcodGhpcy5faW5pdGlhbFNjcm9sbFBvc2l0aW9uLngsIHRoaXMuX2luaXRpYWxTY3JvbGxQb3NpdGlvbi55KTsgfSwgc2Nyb2xsUmV2ZXJ0OiBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IGUgfHwgd2luZG93LmV2ZW50OyByZXR1cm4gbi5wcmV2ZW50RGVmYXVsdCAmJiBuLmNhbmNlbGFibGUgJiYgbi5wcmV2ZW50RGVmYXVsdCgpLCBtLl9zY3JvbGxCYWNrKCksICExOyB9LCBzYXZlSW5pdGlhbFNjcm9sbDogZnVuY3Rpb24gKGUsIG4pIHsgdGhpcy5faW5pdGlhbFNjcm9sbFBvc2l0aW9uLnggPSBlLCB0aGlzLl9pbml0aWFsU2Nyb2xsUG9zaXRpb24ueSA9IG47IH0sIG1vZGFsT3BlbmVkOiBmdW5jdGlvbiAoKSB7IHRoaXMuYXBwbHlGaXgoKTsgfSwgbW9kYWxDbG9zZWQ6IGZ1bmN0aW9uICgpIHsgdGhpcy5yZW1vdmVGaXgoKTsgfSB9LCBnID0gZnVuY3Rpb24gKGUsIG4pIHsgZnVuY3Rpb24gdChlKSB7IHJldHVybiAvXFx7XFxzKlxcW25hdGl2ZSBjb2RlXFxdXFxzKlxcfS8udGVzdChcIlwiICsgZSk7IH0gdHJ5IHtcbiAgICAgICAgaWYgKHQod2luZG93LnNjcm9sbFRvKSlcbiAgICAgICAgICAgIHJldHVybiB2b2lkIHdpbmRvdy5zY3JvbGxUbyhlLCBuKTtcbiAgICAgICAgaWYgKHQod2luZG93LnNjcm9sbCkpXG4gICAgICAgICAgICByZXR1cm4gdm9pZCB3aW5kb3cuc2Nyb2xsKGUsIG4pO1xuICAgICAgICBkb2N1bWVudC5ib2R5ICYmIChkb2N1bWVudC5ib2R5LnNjcm9sbFRvcCA9IDApO1xuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgICBjb25zb2xlLndhcm4oXCJDYW4gbm90IHBlcmZvcm0gc2Nyb2xsOiBcIiArIGUubWVzc2FnZSk7XG4gICAgfSB9LCB2ID0gZnVuY3Rpb24gKCkgeyBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5jb250YWlucyhmKSB8fCBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5hZGQoZik7IH0sIGggPSBmdW5jdGlvbiAoKSB7IGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LmNvbnRhaW5zKGYpICYmIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LnJlbW92ZShmKTsgfTsgdC5vbih3aW5kb3csIFwicmVzaXplXCIsIChmdW5jdGlvbiAoKSB7IHZhciBlOyBpZiAocSgpLCByLmlzQW5kcm9pZCgpKSB7XG4gICAgICAgIHZhciBuID0gbnVsbCA9PT0gKGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnRwLWlmcmFtZS13cmFwcGVyLnRwLWFjdGl2ZVwiKSkgfHwgdm9pZCAwID09PSBlID8gdm9pZCAwIDogZS5jbG9zZXN0KFwiLnRwLW1vZGFsXCIpO1xuICAgICAgICBuICYmIG4uc2Nyb2xsQnkoMCwgMSk7XG4gICAgfSB9KSksIHIuaXNJT1MoKSAmJiB0Lm9uKHdpbmRvdywgXCJvcmllbnRhdGlvbmNoYW5nZVwiLCAoZnVuY3Rpb24gKCkgeyBzZXRUaW1lb3V0KChmdW5jdGlvbiAoKSB7IHJldHVybiBxKCk7IH0pLCAxMDApOyB9KSksIG8uc3Vic2NyaWJlKFwiY2xvc2VcIiwgKGZ1bmN0aW9uICgpIHsgbS5tb2RhbENsb3NlZCgpOyB9KSksIG8uc3Vic2NyaWJlKFwidG9nZ2xlSWZyYW1lU2hhZG93XCIsIChmdW5jdGlvbiAoZSkgeyBiKGUucGFyYW1zLmlzRW5hYmxlZCk7IH0pKSwgby5zdWJzY3JpYmUoXCJ0b2dnbGVMb2FkaW5nQ29udGFpbmVyXCIsIChmdW5jdGlvbiAoZSkgeyBpZiAoZS5wYXJhbXMuaXNFbmFibGVkKVxuICAgICAgICByZXR1cm4gSigpOyBHKCk7IH0pKTsgdmFyIHcsIHksIGIgPSBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIudHAtaWZyYW1lLXdyYXBwZXJcIik7IGlmIChuKVxuICAgICAgICByZXR1cm4gZSA/IG4uY2xhc3NMaXN0LmNvbnRhaW5zKFwibm8tc2hhZG93XCIpICYmIG4uY2xhc3NMaXN0LnJlbW92ZShcIm5vLXNoYWRvd1wiKSA6IHZvaWQgbi5jbGFzc0xpc3QuYWRkKFwibm8tc2hhZG93XCIpOyB9LCBrID0gZnVuY3Rpb24gKGUpIHsgIWZ1bmN0aW9uIChlKSB7IG8uc2VuZChcImNoZWNrUHJvY2Nlc3Nlc0ZvckNsb3NlXCIsIHt9LCBlLmlmcmFtZUlkKTsgfShlKSwgXCJwb3B1cFwiID09PSBlLmNvbmZpZy5kaXNwbGF5TW9kZSA/IGUuY29udGFpbmVyLmNsb3NlKCkgOiBmdW5jdGlvbiAoZSkgeyBpZiAoci5kZWJ1ZyhcIlJlbW92aW5nIGlmcmFtZVwiLCBlKSwgZS5lbGVtZW50ICYmICh0LmhpZGUoZS5lbGVtZW50KSwgXCJpbmxpbmVcIiA9PT0gZS5jb25maWcuZGlzcGxheU1vZGUpKSB7XG4gICAgICAgIHZhciBuID0gZS5lbGVtZW50LnBhcmVudEVsZW1lbnQ7XG4gICAgICAgIG4gJiYgdC5oaWRlKG4pO1xuICAgIH0gZS5yZXNpemVPYnNlcnZlciAmJiBlLnJlc2l6ZU9ic2VydmVyLmRpc2Nvbm5lY3QoKSwgXCJtb2RhbFwiICE9PSBlLmNvbmZpZy5kaXNwbGF5TW9kZSAmJiBcImlubGluZVwiICE9PSBlLmNvbmZpZy5kaXNwbGF5TW9kZSB8fCAoZS53YWl0RmluaXNoUHJvY2Vzc2VzID0gITApOyB9KGUpOyB9LCBfID0gZnVuY3Rpb24gKCkgeyBmb3IgKHZhciBlIGluIHMpIHtcbiAgICAgICAgdmFyIG4gPSBzW2VdO1xuICAgICAgICBpZiAoXCJtb2RhbFwiID09PSBuLmNvbmZpZy5kaXNwbGF5TW9kZSAmJiAhbi53YWl0RmluaXNoUHJvY2Vzc2VzICYmICFuLmNvbmZpZy5pc1ByZWxvYWQpXG4gICAgICAgICAgICByZXR1cm4gITA7XG4gICAgfSByZXR1cm4gITE7IH0sIEMgPSBmdW5jdGlvbiAoZSkgeyByZXR1cm4gc1tlXTsgfSwgSSA9IGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZShlLCBuLCB0KSB7IHRoaXMuJCA9IGUsIHRoaXMuX29wZXJhdGlvbldpdGhDb250YWluZXIgPSB0LCB0aGlzLnV0aWwgPSBuLCB0aGlzLl9pbml0TW9kYWxDb250YWluZXIoKSwgdGhpcy5pT1NCb3R0b21Ub29sYmFySGVpZ2h0ID0gOTA7IH0gcmV0dXJuIGUucHJvdG90eXBlLl9pbml0TW9kYWxDb250YWluZXIgPSBmdW5jdGlvbiAoKSB7IHZhciBlID0gdGhpczsgcmV0dXJuIHRoaXMuY29udGFpbmVyIHx8ICh0aGlzLmNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiksIHRoaXMuZWxlbWVudCA9IHRoaXMuY29udGFpbmVyLCB0aGlzLiQuYWRkQ2xhc3MoXCJ0cC1tb2RhbFwiLCB0aGlzLmNvbnRhaW5lciksIHRoaXMuY2xvc2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYnV0dG9uXCIpLCB0aGlzLiQuc2V0QXR0cihcInR5cGVcIiwgXCJidXR0b25cIiwgdGhpcy5jbG9zZSksIHRoaXMuJC5zZXRBdHRyKFwiYXJpYS1sYWJlbFwiLCBcIkNsb3NlXCIsIHRoaXMuY2xvc2UpLCB0aGlzLiQuYWRkQ2xhc3MoXCJ0cC1jbG9zZVwiLCB0aGlzLmNsb3NlKSwgdGhpcy5pZnJhbWVXcmFwcGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKSwgdGhpcy4kLmFkZENsYXNzKFwidHAtaWZyYW1lLXdyYXBwZXJcIiwgdGhpcy5pZnJhbWVXcmFwcGVyKSwgdGhpcy4kLmFwcGVuZCh0aGlzLmlmcmFtZVdyYXBwZXIsIHRoaXMuY2xvc2UpLCB0aGlzLmNvbnRhaW5lci5zdHlsZS56SW5kZXggPSBwbi56SW5kZXhlcy5tb2RhbCArIFwiXCIsIHRoaXMuY2xvc2Uuc3R5bGUuekluZGV4ID0gcG4uekluZGV4ZXMuY2xvc2UgKyBcIlwiLCB0aGlzLiQub24odGhpcy5jbG9zZSwgXCJjbGlja1wiLCAoZnVuY3Rpb24gKCkgeyBcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIGUuY2xvc2VDbGljayAmJiBlLmNsb3NlQ2xpY2soKTsgfSkpLCB0aGlzLnV0aWwuaXNJT1MoKSAmJiAhdGhpcy51dGlsLmlzRkJPckluc3RXZWJWaWV3KCkgJiYgKHRoaXMuaWZyYW1lV3JhcHBlci5zdHlsZS5tYXJnaW5Cb3R0b20gPSB0aGlzLmlPU0JvdHRvbVRvb2xiYXJIZWlnaHQgKyBcInB4XCIpLCB0aGlzLiQuYXBwZW5kKHRoaXMuY29udGFpbmVyLCB0aGlzLmlmcmFtZVdyYXBwZXIpLCB0aGlzLl9vcGVyYXRpb25XaXRoQ29udGFpbmVyKFwiYm9keVwiLCAoZnVuY3Rpb24gKG4pIHsgZS4kLmFwcGVuZChuLCBlLmNvbnRhaW5lcik7IH0pKSksIHRoaXMuY29udGFpbmVyOyB9LCBlLnByb3RvdHlwZS5nZXRDb250YWluZXIgPSBmdW5jdGlvbiAoZSwgbikgeyByZXR1cm4gdGhpcy5faW5pdE1vZGFsQ29udGFpbmVyKCksIHRoaXMuY2xvc2VDbGljayA9IG4sIHZvaWQgMCA9PT0gZSAmJiAoZSA9ICEwKSwgZSA/IHRoaXMuc2hvd0Nsb3NlQnV0dG9uKCkgOiB0aGlzLmhpZGVDbG9zZUJ1dHRvbigpLCB0aGlzLmlmcmFtZVdyYXBwZXI7IH0sIGUucHJvdG90eXBlLnNob3cgPSBmdW5jdGlvbiAoZSkgeyB0aGlzLl9pbml0TW9kYWxDb250YWluZXIoKSwgdm9pZCAwID09PSBlICYmIChlID0gITApLCBlID8gdGhpcy5zaG93Q2xvc2VCdXR0b24oKSA6IHRoaXMuaGlkZUNsb3NlQnV0dG9uKCksIHRoaXMuJC5hZGRDbGFzcyhcInRwLWFjdGl2ZVwiLCB0aGlzLmNvbnRhaW5lcik7IH0sIGUucHJvdG90eXBlLmhpZGUgPSBmdW5jdGlvbiAoKSB7IHRoaXMuX2luaXRNb2RhbENvbnRhaW5lcigpLCB0aGlzLiQucmVtb3ZlQ2xhc3MoXCJ0cC1hY3RpdmVcIiwgdGhpcy5jb250YWluZXIpOyB9LCBlLnByb3RvdHlwZS5zaG93Q2xvc2VCdXR0b24gPSBmdW5jdGlvbiAoKSB7IHRoaXMuX2luaXRNb2RhbENvbnRhaW5lcigpLCB0aGlzLiQuYWRkQ2xhc3MoXCJ0cC1hY3RpdmVcIiwgdGhpcy5jbG9zZSk7IH0sIGUucHJvdG90eXBlLmhpZGVDbG9zZUJ1dHRvbiA9IGZ1bmN0aW9uICgpIHsgdGhpcy5faW5pdE1vZGFsQ29udGFpbmVyKCksIHRoaXMuJC5yZW1vdmVDbGFzcyhcInRwLWFjdGl2ZVwiLCB0aGlzLmNsb3NlKTsgfSwgZTsgfSgpLCBTID0gZnVuY3Rpb24gKGUsIG4sIHQpIHsgZm9yICh2YXIgbyBpbiByLmRlYnVnKFwiU2VhcmNoIGNvbnRhaW5lciB0byBjbG9zZVwiLCBlLCBuLCB0KSwgcykge1xuICAgICAgICB2YXIgaSA9IHNbb107XG4gICAgICAgIGUgJiYgbyAhPT0gZSB8fCAodCAmJiBcImlubGluZVwiID09PSBpLmNvbmZpZy5kaXNwbGF5TW9kZSB8fCB0ICYmIGkuY29uZmlnLmlzUHJlbG9hZCB8fCAoayhpKSwgXCJtb2RhbFwiID09PSBpLmNvbmZpZy5kaXNwbGF5TW9kZSAmJiB4KGkpKSk7XG4gICAgfSBsLmZpcmVDYWxsYmFja3MoXCJjbG9zZVwiLCBudWxsLCBlLCAhMCk7IH0sIHggPSBmdW5jdGlvbiAoZSkgeyB2YXIgciA9IHAuc2hpZnQoKTsgdyAmJiAhciAmJiB0LnJlbW92ZUNsYXNzKFwidHAtYWN0aXZlXCIsIHcpLCBlLmlmcmFtZVBhcmFtcy5zaG93biA9ICExLCB0LnJlbW92ZUNsYXNzKFwidHAtYWN0aXZlXCIsIGUuY29udGFpbmVyKSwgciA/ICh0LmhpZGUobiksIG4gPSByLCB0LnNob3cobikpIDogKFAoKSwgVCgpKTsgfSwgUCA9IGZ1bmN0aW9uICgpIHsgbiAmJiAoTChcImJvZHlcIiwgKGZ1bmN0aW9uIChlKSB7IHQuYWRkQ2xhc3MoXCJ0cC1tb2RhbC1jbG9zZVwiLCBlKSwgdC5yZW1vdmVDbGFzcyhcInRwLW1vZGFsLW9wZW5cIiwgZSksIGUuY2xhc3NMaXN0LmNvbnRhaW5zKFwiYm9keS1maXhlZFwiKSAmJiB0LnJlbW92ZUNsYXNzKFwiYm9keS1maXhlZFwiLCBlKTsgfSkpLCB0LmhpZGUobikpOyB9LCBFID0gZnVuY3Rpb24gKGUsIG8sIGkpIHsgaWYgKGZ1bmN0aW9uICgpIHsgaWYgKHcpXG4gICAgICAgIHJldHVybiB3OyB2YXIgZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7IHQuYWRkQ2xhc3MoXCJ0cC1iYWNrZHJvcFwiLCBlKSwgZS5zdHlsZS56SW5kZXggPSBwbi56SW5kZXhlcy5iYWNrZHJvcCArIFwiXCIsIEwoXCJib2R5XCIsIChmdW5jdGlvbiAobikgeyB0LmFwcGVuZChuLCBlKTsgfSkpLCB3ID0gZTsgfSgpLCB0LnZpc2libGUodykpIHtcbiAgICAgICAgdmFyIGEgPSB0LnFhKFwiLnRwLW1vZGFsXCIpLmZpbmQoKGZ1bmN0aW9uIChlKSB7IHJldHVybiB0LnZpc2libGUoZSk7IH0pKTtcbiAgICAgICAgbyAmJiAhaSA/IChhICYmICh0LmhpZGUoYSksIHAudW5zaGlmdChhKSksIGUgJiYgdC5zaG93KGUpKSA6IG8gJiYgKGEgPyAoZSAmJiBwLnB1c2goZSksIG4gPSBhKSA6IGUgJiYgdC5zaG93KGUpKTtcbiAgICB9XG4gICAgZWxzZVxuICAgICAgICBlICYmIGZ1bmN0aW9uIChlKSB7IHQudmlzaWJsZShlKSB8fCAoTChcImJvZHlcIiwgKGZ1bmN0aW9uIChlKSB7IHQucmVtb3ZlQ2xhc3MoXCJ0cC1tb2RhbC1jbG9zZVwiLCBlKSwgdC5hZGRDbGFzcyhcInRwLW1vZGFsLW9wZW5cIiwgZSk7IH0pKSwgdC5zaG93KGUpLCAoci5pc0lwaG9uZSgpIHx8IHIuaXNTYWZhcmlPcklPc1VpV2ViVmlldygpIHx8IHIuaXNBbmRyb2lkKCkpICYmIG0ubW9kYWxPcGVuZWQoKSk7IH0oZSksIHQuc2hvdyh3KSwgeSA9IHdpbmRvdy5zZXRUaW1lb3V0KChmdW5jdGlvbiAoKSB7IHQuYWRkQ2xhc3MoXCJ0cC1hY3RpdmVcIiwgdyk7IH0pLCA1MCk7IH0sIFQgPSBmdW5jdGlvbiAoKSB7IHcgJiYgKHQucmVtb3ZlQ2xhc3MoXCJ0cC1hY3RpdmVcIiwgdyksIHQuaGlkZSh3KSwgY2xlYXJUaW1lb3V0KHkpKSwgbS5tb2RhbENsb3NlZCgpOyB9LCBBID0gZnVuY3Rpb24gKGUpIHsgdyAmJiAody5zdHlsZS5oZWlnaHQgPSBcIjEwMCVcIik7IHZhciBuID0gdC5xdWVyeUVsKFwiLnRwLWNsb3NlXCIsIGUpOyBuICYmIHQucmVtb3ZlQ2xhc3MoXCJ0cC1zcXVhcmVcIiwgbik7IH0sIE0gPSBmdW5jdGlvbiAoZSwgbikgeyBpZiAoZSkge1xuICAgICAgICB6KGUuZWxlbWVudCwgbik7XG4gICAgICAgIHZhciByID0gT2JqZWN0LmFzc2lnbih7fSwgbiwgeyBhbmltYXRlOiAhMSB9KTtcbiAgICAgICAgc3dpdGNoIChlLmNvbmZpZy5kaXNwbGF5TW9kZSkge1xuICAgICAgICAgICAgY2FzZSBcIm1vZGFsXCI6XG4gICAgICAgICAgICAgICAgeihlLmNvbnRhaW5lciwgciksIEwoXCJib2R5XCIsIChmdW5jdGlvbiAoZSkgeyB0LmFkZENsYXNzKFwidHAtbW9kYWwtcmVzaXppbmdcIiwgZSksIHNldFRpbWVvdXQoKGZ1bmN0aW9uICgpIHsgdC5yZW1vdmVDbGFzcyhcInRwLW1vZGFsLXJlc2l6aW5nXCIsIGUpOyB9KSwgNTApOyB9KSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiaW5saW5lXCI6XG4gICAgICAgICAgICAgICAgdmFyIG8gPSB0LnF1ZXJ5RWwoXCIudHAtY29udGFpbmVyLWlubmVyXCIsIGUuY29udGFpbmVyKTtcbiAgICAgICAgICAgICAgICBvICYmIHoobywgbik7XG4gICAgICAgIH1cbiAgICB9IH0sIE8gPSBmdW5jdGlvbiAoZSwgciwgbykgeyB2YXIgaSA9IGUuY29udGFpbmVyLCBhID0gaS5wYXJlbnRFbGVtZW50OyBhICYmIGEuY2xhc3NMaXN0LmNvbnRhaW5zKFwidHAtbW9kYWxcIikgPyBuID0gYSA6IGEgPSBuLCBlLmlmcmFtZVBhcmFtcyA9IGUuaWZyYW1lUGFyYW1zIHx8IHt9LCBlLmlmcmFtZVBhcmFtcy5zaG93biB8fCAoZS5pZnJhbWVQYXJhbXMuc2hvd24gPSAhMCwgRShhLCByLCBvKSwgbyB8fCAoaS5jbGFzc0xpc3QuY29udGFpbnMoXCJ0cC1hY3RpdmVcIikgfHwgdC5hZGRDbGFzcyhcInRwLWFjdGl2ZVwiLCBpKSwgQShpKSkpOyB9LCBSID0ge30sIEwgPSBmdW5jdGlvbiAoZSwgbikgeyB2YXIgciA9IHQucXVlcnlFbChlKTsgUltlXSB8fCAoUltlXSA9IDApLCByID8gKGRlbGV0ZSBSW2VdLCBuKHIpKSA6IFJbZV0gPCAxMDAgJiYgKFJbZV0gKz0gMSwgc2V0VGltZW91dCgoZnVuY3Rpb24gKCkgeyBMKGUsIG4pOyB9KSwgNTApKTsgfSwgTiA9IGZ1bmN0aW9uIChlLCBvKSB7IGlmICh2b2lkIDAgPT09IGUuc2hvd0Nsb3NlQnV0dG9uICYmIChlLnNob3dDbG9zZUJ1dHRvbiA9ICEwKSwgZS5jb250YWluZXIpXG4gICAgICAgIHJldHVybiBlLmNvbnRhaW5lcjsgdmFyIGkgPSBuZXcgSSh0LCByLCBMKTsgcmV0dXJuIGUuaXNQcmVsb2FkIHx8IChuID0gaS5lbGVtZW50KSwgaS5nZXRDb250YWluZXIoZS5zaG93Q2xvc2VCdXR0b24sIG8pOyB9LCBVID0gZnVuY3Rpb24gKGUpIHsgdmFyIG4gPSB7IGNvbnRhaW5lcjogbnVsbCwgY29udGFpbmVyUmVhZHk6ICExIH07IGlmICghZS5pZnJhbWVQYXJhbXMuY29udGFpbmVyU2VsZWN0b3IpXG4gICAgICAgIHJldHVybiByLmxvZyhcIklubGluZSBvZmZlciBtdXN0IGhhdmUgYSB2YWxpZCBjb250YWluZXJTZWxlY3RvclwiKSwgbjsgaWYgKG4uY29udGFpbmVyID0gZS5zaW5nbGVDb250YWluZXIgfHwgdC5xdWVyeUVsKGUuaWZyYW1lUGFyYW1zLmNvbnRhaW5lclNlbGVjdG9yKSwgIW4uY29udGFpbmVyKVxuICAgICAgICByZXR1cm4gci5sb2coXCJJbnZhbGlkIGNvbnRhaW5lclNlbGVjdG9yXCIpLCBuOyB2YXIgbyA9IGUuY29uZmlnLCBpID0gXCJvYmplY3RcIiA9PSB0eXBlb2YgbyAmJiBudWxsICE9PSBvOyByZXR1cm4gdC5lbXB0eShuLmNvbnRhaW5lciksIGkgPyAhMCA9PSAhIW8ucHJldmlldyB8fCAoZS5pZnJhbWVQYXJhbXMud2lkdGggPSB0LmdldFdpZHRoKG4uY29udGFpbmVyKSkgOiBlLmlmcmFtZVBhcmFtcy53aWR0aCA9IGUuaWZyYW1lUGFyYW1zLndpZHRoIHx8IHQuZ2V0V2lkdGgobi5jb250YWluZXIpLCBuLmNvbnRhaW5lclJlYWR5ID0gITAsIG47IH0sIGogPSBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IHQud2luU2l6ZSgpLCBvID0gZS53aWR0aCA/IGUud2lkdGggOiBuLndpZHRoLCBpID0gZS5oZWlnaHQgPyBlLmhlaWdodCA6IG4uaGVpZ2h0LCBhID0gci5jZW50ZXJTY3JlZW4obywgaSk7IHJldHVybiB7IHdpZHRoOiBvLCBoZWlnaHQ6IGksIHRvcDogYS50b3AsIGxlZnQ6IGEubGVmdCB9OyB9LCBEID0gZnVuY3Rpb24gKGUsIG4pIHsgdmFyIHQgPSBqKGUpLCBvID0gd2luZG93Lm9wZW4obiwgci5yYW5kb21TdHJpbmcoMTYpLCBcInNjcm9sbGJhcnM9eWVzLGxvY2F0aW9uPXllcyxzdGF0dXM9MCx0b29sYmFyPTAscmVzaXphYmxlPTEsIHdpZHRoPVwiICsgdC53aWR0aCArIFwiLCBoZWlnaHQ9XCIgKyB0LmhlaWdodCArIFwiLCB0b3A9XCIgKyB0LnRvcCArIFwiLCBsZWZ0PVwiICsgdC5sZWZ0KTsgcmV0dXJuIHdpbmRvdy5mb2N1cyAmJiBvICYmIG8uZm9jdXMoKSwgbzsgfSwgRiA9IDEsIEIgPSBmdW5jdGlvbiAoZSwgbiwgbykgeyB2YXIgaSA9IFwiaWZyYW1lLVwiICsgRisrICsgXCItXCIgKyByLnJhbmRvbVN0cmluZygpOyBuLmlmcmFtZUlkICYmIChpID0gbi5pZnJhbWVJZCk7IHZhciBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImlmcmFtZVwiKSwgcyA9IHsgaWQ6IGksIG5hbWU6IGksIHRpdGxlOiBpLCBzY3JvbGxpbmc6IFwibm9cIiwgYWxsb3d0cmFuc3BhcmVuY3k6IFwidHJ1ZVwiLCBzcmM6IG8sIGFsbG93OiBcInBheW1lbnRcIiB9OyBPYmplY3Qua2V5cyhzKS5mb3JFYWNoKChmdW5jdGlvbiAoZSkgeyB0LnNldEF0dHIoZSwgc1tlXSwgYSk7IH0pKTsgdmFyIGMgPSB7IG92ZXJmbG93OiBcImhpZGRlblwiLCBiYWNrZ3JvdW5kQ29sb3I6IFwidHJhbnNwYXJlbnRcIiwgYm9yZGVyOiBcIjBcIiwgd2lkdGg6IFwiaW5saW5lXCIgPT09IGUuZGlzcGxheU1vZGUgPyBuLndpZHRoICsgXCJweFwiIDogXCIwcHhcIiwgaGVpZ2h0OiBcIjBweFwiIH07IE9iamVjdC5rZXlzKGMpLmZvckVhY2goKGZ1bmN0aW9uIChlKSB7IGEuc3R5bGVbZV0gPSBjW2VdOyB9KSk7IHRyeSB7XG4gICAgICAgIHQuc2V0QXR0cihcImZyYW1lQm9yZGVyXCIsIFwiMFwiLCBhKTtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgci5sb2coZSk7XG4gICAgfSByZXR1cm4gYTsgfSwgViA9IGZ1bmN0aW9uIChlLCBuKSB7IHZhciByID0gc2V0SW50ZXJ2YWwoKGZ1bmN0aW9uICgpIHsgdC5lbXB0eShlKTsgfSksIDE1MCk7IHQucmVhZHkoKGZ1bmN0aW9uICgpIHsgY2xlYXJJbnRlcnZhbChyKSwgdC5hcHBlbmQoZSwgbik7IH0pKTsgfSwgcSA9IGZ1bmN0aW9uICgpIHsgZm9yICh2YXIgZSBpbiBzKSB7XG4gICAgICAgIHZhciBuID0gc1tlXTtcbiAgICAgICAgaWYgKCFuLmNvbmZpZy5wcmV2aWV3ICYmIFwiaW5saW5lXCIgPT09IG4uY29uZmlnLmRpc3BsYXlNb2RlICYmIG4uY29udGFpbmVyICYmIE0obiwgeyB3aWR0aDogdC5nZXRXaWR0aChuLmNvbnRhaW5lcikgfSksIFwibW9kYWxcIiA9PT0gbi5jb25maWcuZGlzcGxheU1vZGUgJiYgbi5jb250YWluZXIpIHtcbiAgICAgICAgICAgIHZhciByID0gTWF0aC5tYXgoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoLCBkb2N1bWVudC5ib2R5Lm9mZnNldFdpZHRoLCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQub2Zmc2V0V2lkdGgpO1xuICAgICAgICAgICAgby5zZW5kKFwiUkVTSVpFX01PREFMX0NIRUNLT1VUXCIsIHsgaWZyYW1lOiBuLCB3aWR0aDogciB9LCBuLmlmcmFtZUlkKTtcbiAgICAgICAgfVxuICAgIH0gfSwgeiA9IGZ1bmN0aW9uIChlLCBuKSB7IGUgJiYgKHZvaWQgMCAhPT0gbi53aWR0aCAmJiAoZS5zdHlsZS53aWR0aCA9IG4ud2lkdGggKyBcInB4XCIsICgwID09PSBuLndpZHRoICYmICFlLmNsYXNzTGlzdC5jb250YWlucyhcIm5vLXdpZHRoXCIpIHx8IDAgIT09IG4ud2lkdGggJiYgZS5jbGFzc0xpc3QuY29udGFpbnMoXCJuby13aWR0aFwiKSkgJiYgdC50b2dnbGVDbGFzcyhcIm5vLXdpZHRoXCIsIGUpKSwgdm9pZCAwICE9PSBuLmhlaWdodCAmJiAobi5hbmltYXRlLCBlLnN0eWxlLmhlaWdodCA9IG4uaGVpZ2h0ICsgXCJweFwiLCAoMCA9PT0gbi5oZWlnaHQgJiYgIWUuY2xhc3NMaXN0LmNvbnRhaW5zKFwibm8taGVpZ2h0XCIpIHx8IDAgIT09IG4uaGVpZ2h0ICYmIGUuY2xhc3NMaXN0LmNvbnRhaW5zKFwibm8taGVpZ2h0XCIpKSAmJiB0LnRvZ2dsZUNsYXNzKFwibm8taGVpZ2h0XCIsIGUpKSk7IH0sIEggPSBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7IHJldHVybiBuLmlubmVySFRNTCA9IGUudHJpbSgpLCBuLmZpcnN0Q2hpbGQ7IH0sIFcgPSBmdW5jdGlvbiAoZSkgeyByZXR1cm4gdm9pZCAwID09PSBlICYmIChlID0gXCJcIiksICc8ZGl2IGNsYXNzPVwidHAtcGxlYXNlLXdhaXQgdHAtYWN0aXZlIHRwLW92ZXJsYXAgJyArIGUgKyAnXCI+PGRpdiBjbGFzcz1cInRwLWljb24gdHAtY2VudGVyZWRcIj48ZGl2IGNsYXNzPVwicG4tc3Bpbm5lclwiPjxkaXY+PC9kaXY+PGRpdj48L2Rpdj48ZGl2PjwvZGl2PjxkaXY+PC9kaXY+PGRpdj48L2Rpdj48ZGl2PjwvZGl2PjxkaXY+PC9kaXY+PGRpdj48L2Rpdj48ZGl2PjwvZGl2PjxkaXY+PC9kaXY+PGRpdj48L2Rpdj48ZGl2PjwvZGl2PjwvZGl2PjwvZGl2PjwvZGl2Pic7IH0sIEogPSBmdW5jdGlvbiAoKSB7IGUgfHwgKGUgPSBIKFcoKSkpICYmIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoZSk7IH0sIEcgPSBmdW5jdGlvbiAoKSB7IGUgJiYgKGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoZSksIGUgPSBudWxsKTsgfTsgZnVuY3Rpb24gUShlKSB7IGlmIChlICYmIGUuY29udGFpbmVyKSB7XG4gICAgICAgICFmdW5jdGlvbiAoZSkgeyBpZiAoZSAmJiAobnVsbCA9PSBlID8gdm9pZCAwIDogZS5jb250YWluZXIpICYmICFkLmhhcyhlLmlmcmFtZUlkKSkge1xuICAgICAgICAgICAgdmFyIG4gPSBIKFcoXCJ0cC1sb2NhbC1vdmVybGFwXCIpKTtcbiAgICAgICAgICAgIG4gJiYgKGUuY29udGFpbmVyLmFwcGVuZENoaWxkKG4pLCBkLnNldChlLmlmcmFtZUlkLCBuKSk7XG4gICAgICAgIH0gfShlKTtcbiAgICAgICAgZS5jb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcihcImxvYWRcIiwgKGZ1bmN0aW9uICgpIHsgIWZ1bmN0aW9uIChlKSB7IGlmIChlICYmIChudWxsID09IGUgPyB2b2lkIDAgOiBlLmNvbnRhaW5lcikgJiYgZC5oYXMoZS5pZnJhbWVJZCkpIHtcbiAgICAgICAgICAgIHZhciBuID0gZC5nZXQoZS5pZnJhbWVJZCk7XG4gICAgICAgICAgICBuICYmIChlLmNvbnRhaW5lci5yZW1vdmVDaGlsZChuKSwgZC5kZWxldGUoZS5pZnJhbWVJZCkpO1xuICAgICAgICB9IH0oZSk7IH0pLCB7IG9uY2U6ICEwLCBjYXB0dXJlOiAhMCB9KTtcbiAgICB9IH0gZnVuY3Rpb24gWChlKSB7IGUgJiYgZS5lbGVtZW50ICYmIChmdW5jdGlvbiAoZSkgeyB2YXIgbjsgaWYgKCFlKVxuICAgICAgICByZXR1cm4gITE7IHJldHVybiAhIShudWxsID09PSAobiA9IG51bGwgPT0gZSA/IHZvaWQgMCA6IGUuZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSkgfHwgdm9pZCAwID09PSBuID8gdm9pZCAwIDogbi53aWR0aCk7IH0oZSkgJiYgUShlKSwgZS5lbGVtZW50LnNyYyA9IGUuZWxlbWVudC5zcmMpOyB9IGZ1bmN0aW9uICQoKSB7IGZvciAodmFyIGUgaW4gcykge1xuICAgICAgICB2YXIgbiA9IHNbZV07XG4gICAgICAgIG4gJiYgWChuKTtcbiAgICB9IH0gcmV0dXJuIHsgbmFtZTogXCJjb250YWluZXJVdGlsc1wiLCBmYWtlT2ZmZXJJZDogXCJmYWtlT2ZmZXJJZFwiLCBjcmVhdGVDb250YWluZXI6IGZ1bmN0aW9uIChlKSB7IHZhciBuLCBpLCBkLCBwID0gITAsIGYgPSBlLmlmcmFtZVBhcmFtczsgaWYgKFwiaW5saW5lXCIgPT09IGYuZGlzcGxheU1vZGUgfHwgZi53aWR0aCB8fCAoZi53aWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoKSwgaSA9IGUuY29uZmlnLmJ1aWxkUXVlcnlTdHJpbmdGbiA/IGZ1bmN0aW9uIChuKSB7IHJldHVybiBlLmNvbmZpZy5idWlsZFF1ZXJ5U3RyaW5nRm4obiwgdCk7IH0gOiBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IHQucGFyYW0oZSk7IHJldHVybiBuICsgXCImX3FoPVwiICsgYS5oYXNoKG4sIDEwKTsgfSwgXCJwb3B1cFwiID09PSBmLmRpc3BsYXlNb2RlKSB7XG4gICAgICAgICAgICBmLndpZHRoIHx8IChmLndpZHRoID0gd2luZG93LmlubmVyV2lkdGgpO1xuICAgICAgICAgICAgdmFyIG0gPSBlLnVybCArIFwiP1wiICsgaShmKTtcbiAgICAgICAgICAgIG4gPSBEKGYsIG0pO1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBkID0gbi5kb2N1bWVudDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgZCA9IG47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIGQgPSBudWxsLCBjb25zb2xlLndhcm4oXCJVbmFibGUgdG8gZ2V0IHBvcHVwIGVsZW1lbnRcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY1tmLmlmcmFtZUlkXSA9IHsgY29udGFpbmVyOiBuLCBpbnRlcnZhbDogc2V0SW50ZXJ2YWwoKGZ1bmN0aW9uICgpIHsgY1tmLmlmcmFtZUlkXS5jb250YWluZXIuY2xvc2VkICYmIChjbGVhckludGVydmFsKGNbZi5pZnJhbWVJZF0uaW50ZXJ2YWwpLCBjW2YuaWZyYW1lSWRdLmNvbnRhaW5lci5jbG9zZSgpLCBlLm9uQ2xvc2VDYWxsYmFjayAmJiBlLm9uQ2xvc2VDYWxsYmFjaygpKTsgfSksIDEwMCkgfTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGlmIChcImlubGluZVwiID09PSBmLmRpc3BsYXlNb2RlKSB7XG4gICAgICAgICAgICAgICAgdm9pZCAwICE9PSBlLmNvbmZpZy5zaG93Q2xvc2VCdXR0b24gJiYgZGVsZXRlIGUuY29uZmlnLnNob3dDbG9zZUJ1dHRvbjtcbiAgICAgICAgICAgICAgICB2YXIgZyA9IFUoZSk7XG4gICAgICAgICAgICAgICAgbiA9IGcuY29udGFpbmVyLCBwID0gISFnLmNvbnRhaW5lclJlYWR5O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIG4gPSBOKGUuY29uZmlnLCAoZnVuY3Rpb24gKCkgeyBTKGYuaWZyYW1lSWQsIGUucGFyZW50KTsgfSkpO1xuICAgICAgICAgICAgdmFyIHYgPSBlLnVybCArIFwiP1wiICsgaShmKTtcbiAgICAgICAgICAgIGQgPSBCKGUuY29uZmlnLCBmLCB2KTtcbiAgICAgICAgfSBsLnJlZ2lzdGVyQ2FsbGJhY2soZSwgZi5pZnJhbWVJZCk7IHZhciBoID0gc1tmLmlmcmFtZUlkXSA9IHsgaWZyYW1lSWQ6IGYuaWZyYW1lSWQsIGNvbmZpZzogZS5jb25maWcsIGVsZW1lbnQ6IGQsIGNvbnRhaW5lcjogbiwgaWZyYW1lUGFyYW1zOiBmLCBjb250YWluZXJSZWFkeTogcCB9OyBpZiAoby5pbml0KHsgcG9zdE1lc3NhZ2VVcmw6IGUucG9zdE1lc3NhZ2VVcmwsIHBhcmVudDogZS5wYXJlbnQsIHJlY2VpdmU6IGUucmVjZWl2ZSwgaWZyYW1lOiBoLCBpZnJhbWVQYXJhbXM6IGYgfSksIHQub24oZG9jdW1lbnQsIFwia2V5dXBcIiwgKGZ1bmN0aW9uIChlKSB7IH0pKSwgXCJtb2RhbFwiID09PSBmLmRpc3BsYXlNb2RlKVxuICAgICAgICAgICAgdC5vbih3aW5kb3csIFwicmVzaXplXCIsIChmdW5jdGlvbiAoKSB7IEEobik7IH0pKSwgdC5hcHBlbmQobiwgZCk7XG4gICAgICAgIGVsc2UgaWYgKFwiaW5saW5lXCIgPT09IGYuZGlzcGxheU1vZGUpIHtcbiAgICAgICAgICAgIGlmIChzW2YuaWZyYW1lSWRdLmNvbnRhaW5lclJlYWR5KSB7XG4gICAgICAgICAgICAgICAgdmFyIHcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICAgICAgICAgIHQuYWRkQ2xhc3ModSwgdyksIHQuYXBwZW5kKHcsIGQpLCBlLmNvbmZpZy5pc1ByZWxvYWQgJiYgdC5oaWRlKHcpLCAoXCJjb21wbGV0ZVwiID09PSBkb2N1bWVudC5yZWFkeVN0YXRlIHx8IFwibG9hZGluZ1wiICE9PSBkb2N1bWVudC5yZWFkeVN0YXRlICYmICFkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuZG9TY3JvbGwpICYmIG4gPyAodC5lbXB0eShuKSwgdC5hcHBlbmQobiwgdykpIDogVihuLCB3KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHZhciB5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgICAgICAgICAgICB0LnNldEF0dHIoXCJpZFwiLCBcInRlbXAtaW5saW5lLVwiICsgZi5pZnJhbWVJZCwgeSksIHQuaGlkZSh5KSwgTChcImJvZHlcIiwgKGZ1bmN0aW9uIChlKSB7IHQuYXBwZW5kKGUsIHkpOyB9KSksIHQuYXBwZW5kKHksIGQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHdpbmRvdy5SZXNpemVPYnNlcnZlcikge1xuICAgICAgICAgICAgICAgIHZhciBiID0gbmV3IFJlc2l6ZU9ic2VydmVyKChmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IHQuZ2V0V2lkdGgoaC5jb250YWluZXIpOyBuID4gMCAmJiBNKGgsIHsgd2lkdGg6IG4gfSk7IH0pKTtcbiAgICAgICAgICAgICAgICBiLm9ic2VydmUoaC5jb250YWluZXIpLCBoLnJlc2l6ZU9ic2VydmVyID0gYjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSByZXR1cm4gci5kZWJ1ZyhcImNyZWF0aW5nIGlmcmFtZTogXCIsIGUpLCBoOyB9LCBzaG93UHJlbG9hZGVkQ29udGFpbmVyOiBmdW5jdGlvbiAoZSkgeyBpZiAoXCJtb2RhbFwiID09PSBlLmNvbmZpZy5kaXNwbGF5TW9kZSkge1xuICAgICAgICAgICAgaWYgKF8oKSlcbiAgICAgICAgICAgICAgICByZXR1cm4gdm9pZCByLmxvZyhcIk1vZGFsIGlzIGFscmVhZHkgc2hvd247IG11c3QgYmUgb25lIG1vZGFsIHBlciB0aW1lXCIpO1xuICAgICAgICAgICAgIWZ1bmN0aW9uIChlKSB7IChuID0gZS5jb250YWluZXIuY2xvc2VzdChcIi50cC1tb2RhbFwiKSkgPyBuID0gbiA6IHIuZXJyb3IoXCJ0aGVyZSBpcyBubyBzdWNoIG1vZGFsIGNvbnRhaW5lclwiKSwgTyhlLCAhMCwgITApOyB9KGUpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIFwiaW5saW5lXCIgPT09IGUuY29uZmlnLmRpc3BsYXlNb2RlID8gZnVuY3Rpb24gKGUpIHsgdC5zaG93KGUuY29udGFpbmVyKTsgdmFyIG4gPSB0LnF1ZXJ5RWwoXCIudHAtY29udGFpbmVyLWlubmVyXCIsIGUuY29udGFpbmVyKTsgbiAmJiB0LnNob3cobiksIE0oZSwgeyB3aWR0aDogdC5nZXRXaWR0aChlLmNvbnRhaW5lcikgfSk7IH0oZSkgOiByLmxvZyhcIlVuZXhwZWN0ZWQgZGlzcGxheU1vZGUgb2YgcHJlbG9hZGVkIGlmcmFtZVxcblwiKTsgcmV0dXJuIGUuY29uZmlnLmlzUHJlbG9hZCA9ICExLCBlLmlmcmFtZVBhcmFtcy5pc1ByZWxvYWQgPSAhMSwgci5kZWJ1ZyhcInNob3cgcHJlbG9hZGVkIGlmcmFtZTogXCIsIGUuY29uZmlnKSwgZTsgfSwgcmVkaXJlY3RDb250YWluZXI6IGZ1bmN0aW9uIChlLCBuKSB7IHZhciByID0gbi51cmwgKyBcIj9cIiArIHQucGFyYW0obi5pZnJhbWVQYXJhbXMpLCBpID0gc1tlXTsgaWYgKFwicG9wdXBcIiA9PT0gaS5jb25maWcuZGlzcGxheU1vZGUpXG4gICAgICAgICAgICBpLmNvbnRhaW5lci5sb2NhdGlvbiA9IHI7XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdmFyIGEgPSBpLmVsZW1lbnQ7XG4gICAgICAgICAgICAoYS5jb250ZW50V2luZG93IHx8IGEpLmxvY2F0aW9uID0gcjtcbiAgICAgICAgfSBpLmNvbmZpZyA9IG4uY29uZmlnLCBvLmluaXQoeyBwb3N0TWVzc2FnZVVybDogbi5wb3N0TWVzc2FnZVVybCwgcmVjZWl2ZTogbi5yZWNlaXZlLCBpZnJhbWU6IHNbbi5pZnJhbWVQYXJhbXMuaWZyYW1lSWRdLCBpZnJhbWVQYXJhbXM6IG4uaWZyYW1lUGFyYW1zIH0pOyB9LCBoYXNNb2RhbElmcmFtZTogXywgZ2V0SWZyYW1lOiBDLCBnZW5lcmF0ZUlmcmFtZTogQiwgZ2VuZXJhdGVJZnJhbWVXcmFwcGVyOiBmdW5jdGlvbiAoKSB7IHZhciBlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKSwgbiA9IHsgb3ZlcmZsb3c6IFwiaGlkZGVuXCIsIGJhY2tncm91bmRDb2xvcjogXCJ0cmFuc3BhcmVudFwiLCBib3JkZXI6IFwiMFwiLCB3aWR0aDogXCIwcHhcIiwgaGVpZ2h0OiBcIjBweFwiLCBwb3NpdGlvbjogXCJhYnNvbHV0ZVwiLCBkaXNwbGF5OiBcImJsb2NrXCIsIHRvcDogXCItMXB4XCIsIGxlZnQ6IFwiLTFweFwiIH07IHJldHVybiBPYmplY3Qua2V5cyhuKS5mb3JFYWNoKChmdW5jdGlvbiAodCkgeyBlLnN0eWxlW3RdID0gblt0XTsgfSkpLCBlOyB9LCBnZXRQb3B1cFBvc2l0aW9uOiBqLCBnZW5lcmF0ZVBvcHVwOiBELCBpbml0SW5saW5lQ29udGFpbmVyOiBVLCBnZXRNb2RhbENvbnRhaW5lcjogTiwgY2VudGVyQmFja2Ryb3A6IGZ1bmN0aW9uIChlKSB7IGlmICh3KSB7XG4gICAgICAgICAgICB2YXIgbiA9IHQud2luU2l6ZSgpO1xuICAgICAgICAgICAgZS5vZmZzZXRIZWlnaHQgPiBuLmhlaWdodCA/IHcuc3R5bGUuaGVpZ2h0ID0gbi5oZWlnaHQgKyBcIlwiIDogdy5zdHlsZS5oZWlnaHQgPSBcIjEwMCVcIjtcbiAgICAgICAgfSB9LCBzaG93QmFja2Ryb3A6IEUsIGhpZGVCYWNrZHJvcDogVCwgY2hlY2tCYWNrZHJvcEFuZENvbnRhaW5lcjogTywgcmVzaXplSWZyYW1lOiBNLCBjZW50ZXJJdDogQSwgb3BlcmF0aW9uV2l0aENvbnRhaW5lcjogTCwgY2xvc2VDb250YWluZXI6IFMsIGNsb3NlTW9kYWxDb250YWluZXI6IGZ1bmN0aW9uIChlLCBuKSB7IFMoZSwgbiwgITApOyB9LCBwdXJnZUlmcmFtZTogZnVuY3Rpb24gKGUsIG4pIHsgci5kZWJ1ZyhcIlB1cmdpbmcgaWZyYW1lXCIsIGUpOyB2YXIgaSA9IHNbZV07IHRyeSB7XG4gICAgICAgICAgICBpZiAoaS5yZXNpemVPYnNlcnZlciAmJiBpLnJlc2l6ZU9ic2VydmVyLmRpc2Nvbm5lY3QoKSwgby5yZW1vdmVJZnJhbWUoaS5pZnJhbWVJZCksIHQucmVtb3ZlKGkuZWxlbWVudCksIFwiaW5saW5lXCIgPT09IGkuY29uZmlnLmRpc3BsYXlNb2RlKSB7XG4gICAgICAgICAgICAgICAgdmFyIGEgPSB0LnF1ZXJ5RWwoXCIudHAtY29udGFpbmVyLWlubmVyXCIsIGkuY29udGFpbmVyKTtcbiAgICAgICAgICAgICAgICBhICYmIHQucmVtb3ZlKGEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7IH0gZGVsZXRlIHNbZV07IH0sIGhpZGVNb2RhbENvbnRhaW5lcjogZnVuY3Rpb24gKGUpIHsgdmFyIG4gPSBbXTsgZm9yICh2YXIgciBpbiBzKSB7XG4gICAgICAgICAgICB2YXIgbyA9IHNbcl07XG4gICAgICAgICAgICBlICYmIHIgIT09IGUgfHwgXCJpbmxpbmVcIiAhPT0gby5jb25maWcuZGlzcGxheU1vZGUgJiYgXCJtb2RhbFwiID09PSBvLmNvbmZpZy5kaXNwbGF5TW9kZSAmJiAoeChvKSwgdC5oaWRlKG8uY29udGFpbmVyKSwgbi5wdXNoKHIpKTtcbiAgICAgICAgfSByZXR1cm4gbjsgfSwgY2xvc2VNb2RhbDogeCwgaGlkZUNsb3NlQnV0dG9uOiBmdW5jdGlvbiAoZSkgeyBpZiAoZSkge1xuICAgICAgICAgICAgdmFyIG4gPSB0LnF1ZXJ5RWwoXCIudHAtY2xvc2VcIiwgZSk7XG4gICAgICAgICAgICBuICYmIG4uY2xhc3NMaXN0LmNvbnRhaW5zKFwidHAtYWN0aXZlXCIpICYmIHQucmVtb3ZlQ2xhc3MoXCJ0cC1hY3RpdmVcIiwgbik7XG4gICAgICAgIH0gfSwgYWN0aXZhdGVDb250YWluZXJzOiBmdW5jdGlvbiAoZSkgeyBpZiAoZSAmJiBlLmxlbmd0aClcbiAgICAgICAgICAgIGZvciAodmFyIG4gaW4gcylcbiAgICAgICAgICAgICAgICBmb3IgKHZhciByID0gc1tuXSwgbyA9IDA7IG8gPCBlLmxlbmd0aDsgbysrKVxuICAgICAgICAgICAgICAgICAgICBpZiAobiA9PT0gZVtvXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGkgPSByLmNvbnRhaW5lciwgYSA9IGkucGFyZW50RWxlbWVudDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGEgJiYgRShhKSwgdC5hZGRDbGFzcyhcInRwLWFjdGl2ZVwiLCBpKSwgdC5zaG93KGkpO1xuICAgICAgICAgICAgICAgICAgICB9IH0sIHNob3dXYWl0UGFuZWw6IEosIGhpZGVXYWl0UGFuZWw6IEcsIGFkZENsYXNzVG9Db250YWluZXI6IGZ1bmN0aW9uIChlLCBuKSB7IHQuYWRkQ2xhc3MobiwgZS5jb250YWluZXIpOyB9LCB0dXJuT25SVEw6IGZ1bmN0aW9uIChlKSB7IGUuY29udGFpbmVyICYmIGUuY29udGFpbmVyLnNldEF0dHJpYnV0ZSAmJiBlLmNvbnRhaW5lci5zZXRBdHRyaWJ1dGUoXCJkaXJcIiwgXCJydGxcIik7IH0sIHR1cm5PZmZSVEw6IGZ1bmN0aW9uIChlKSB7IGUuY29udGFpbmVyICYmIGUuY29udGFpbmVyLnJlbW92ZUF0dHJpYnV0ZSAmJiBlLmNvbnRhaW5lci5yZW1vdmVBdHRyaWJ1dGUoXCJkaXJcIik7IH0sIHNldElmcmFtZXNQb3BzdGF0ZUhhbmRsZXJzOiBmdW5jdGlvbiAoKSB7IChyLmlzSXBob25lKCkgfHwgci5pc1NhZmFyaU9ySU9zVWlXZWJWaWV3KCkpICYmIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwicG9wc3RhdGVcIiwgJCk7IH0sIF9fcHJvdGVjdGVkX186IHsgc2V0RWxlbWVudFNpemVzOiB6LCBjbG9zZUlubGluZUNvbnRhaW5lcnM6IGZ1bmN0aW9uIChlKSB7IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoZSArIFwiID4gLlwiICsgXCJ0cC1jb250YWluZXItaW5uZXIgPiBpZnJhbWVcIikpLmZvckVhY2goKGZ1bmN0aW9uIChlKSB7IHZhciBuLCB0OyBlLmlkICYmIChuID0gZS5pZCwgKHQgPSBDKG4pKS5jb25maWcuY2hpbGQgJiYgUyh0LmNvbmZpZy5jaGlsZCksIFMobikpOyB9KSk7IH0sIGFkZENoaWxkVG9JbmxpbmVJZnJhbWU6IGZ1bmN0aW9uIChlLCBuKSB7IGlmIChlKSB7XG4gICAgICAgICAgICAgICAgdmFyIHQgPSBDKG4pO1xuICAgICAgICAgICAgICAgIHQgJiYgdC5jb25maWcgJiYgKHQuY29uZmlnLmNoaWxkID0gZS5pZnJhbWVJZCk7XG4gICAgICAgICAgICB9IH0sIGNsb3NlQW5kUmVtb3ZlSWZyYW1lOiBrIH0sIF9fcHJpdmF0ZV9fOiB7IG1vYmlsZU1vZGFsRml4OiBtIH0gfTsgfSgpO1xuICAgIHBuLmNvbnRhaW5lci5yZWdpc3RlcihcImNvbnRhaW5lclV0aWxzXCIsIHsgdXNlVmFsdWU6IE1lIH0pLCBwbi5jb250YWluZXJVdGlscyA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwiY29udGFpbmVyVXRpbHNcIik7XG4gICAgdmFyIE9lID0gZnVuY3Rpb24gKGUpIHsgdm9pZCAwID09PSBlICYmIChlID0gcG4uY29udGFpbmVyKTsgdmFyIG4gPSBlLnJlc29sdmUoXCJhamF4XCIpLCB0ID0gZS5yZXNvbHZlKFwidXRpbFwiKTsgZS5yZXNvbHZlKFwicG9zdG1lc3NhZ2VcIikuc3Vic2NyaWJlKFwiaWZyYW1lTG9nUmVxdWVzdFwiLCAoZnVuY3Rpb24gKGUpIHsgbyhlLnVybCwgZS5xdWVyeVBhcmFtcyk7IH0pKTsgdmFyIHIgPSBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IFtdOyBmb3IgKHZhciB0IGluIGUpIHtcbiAgICAgICAgdmFyIHIgPSBlW3RdO1xuICAgICAgICBuLnB1c2goZW5jb2RlVVJJQ29tcG9uZW50KHQpICsgXCI9XCIgKyBlbmNvZGVVUklDb21wb25lbnQoXCJvYmplY3RcIiA9PSB0eXBlb2YgciA/IEpTT04uc3RyaW5naWZ5KHIpIDogcikpO1xuICAgIH0gcmV0dXJuIG4uam9pbihcIiZcIik7IH0sIG8gPSBmdW5jdGlvbiAoZSwgbykgeyB2YXIgaSA9IHIobyk7IHQuaXNSZWxhdGl2ZVVybChlLnRyaW0oKSkgPyBpLmxlbmd0aCA+IDZlMyA/IG4ucmVxdWVzdCh7IHR5cGU6IFwiUE9TVFwiLCB1cmw6IHBuLmdldFRyYWNraW5nRW5kcG9pbnQoKSArIGUsIGRhdGE6IGkgfSkgOiBuLnJlcXVlc3QoeyB1cmw6IHBuLmdldFRyYWNraW5nRW5kcG9pbnQoKSArIGUgKyBcIj9cIiArIGksIGRhdGFUeXBlOiBcImpzb25wXCIgfSkgOiB0LmxvZyhcIlVybCBwYXJhbWV0ZXIgaXMgaW5jb3JyZWN0XCIpOyB9LCBpID0gZnVuY3Rpb24gKGUsIG4sIHIsIGksIGEpIHsgZSA/IHIgPyBuID8gbyhcIi9hcGkvdjMvY29udmVyc2lvbi9sb2dFc3BNaWNyb0NvbnZlcnNpb25cIiwgeyB0cmFja2luZ19pZDogZSwgZXNwX3dpZGdldF9pZDogbiwgZXZlbnRfdHlwZTogaSwgZXZlbnRfZ3JvdXBfaWQ6IHIsIGN1c3RvbV9wYXJhbXM6IGEgfHwgXCJcIiB9KSA6IHQubG9nKFwiUGFyYW1ldGVyIGVzcFdpZGdldElkIGlzIHJlcXVpcmVkIHRvIGxvZyBlc3AgbWljcm8gY29udmVyc2lvbi5cIikgOiB0LmxvZyhcIlBhcmFtZXRlciBldmVudEdyb3VwSWQgaXMgcmVxdWlyZWQgdG8gbG9nIGVzcCBtaWNybyBjb252ZXJzaW9uLlwiKSA6IHQubG9nKFwiUGFyYW1ldGVyIHRyYWNraW5nSWQgaXMgcmVxdWlyZWQgdG8gbG9nIGVzcCBtaWNybyBjb252ZXJzaW9uLlwiKTsgfSwgYSA9IGZ1bmN0aW9uIChlLCBuLCByLCBpLCBhLCBzLCBjLCBsKSB7IHZhciB1ID0geyB0cmFja2luZ19pZDogZSwgdGVybV9pZDogbiwgdGVybV9uYW1lOiByIH07IGUgPyBuID8gciA/ICh2b2lkIDAgIT09IGkgJiYgKHUuc3RlcF9udW1iZXIgPSBpKSwgdm9pZCAwICE9PSBhICYmICh1LmFtb3VudCA9IGEpLCB2b2lkIDAgIT09IHMgJiYgKHUuY3VycmVuY3kgPSBzKSwgdm9pZCAwICE9PSBjICYmICh1LmN1c3RvbV9wYXJhbXMgPSBjKSwgdm9pZCAwICE9PSBsICYmICh1LmNvbnZlcnNpb25fY2F0ZWdvcnkgPSBsKSwgbyhcIi9hcGkvdjMvY29udmVyc2lvbi9sb2dcIiwgdSkpIDogdC5sb2coXCJQYXJhbWV0ZXIgdGVybU5hbWUgaXMgcmVxdWlyZWQgdG8gbG9nIGNvbnZlcnNpb24uXCIpIDogdC5sb2coXCJQYXJhbWV0ZXIgdGVybUlkIGlzIHJlcXVpcmVkIHRvIGxvZyBjb252ZXJzaW9uLlwiKSA6IHQubG9nKFwiUGFyYW1ldGVyIHRyYWNraW5nSWQgaXMgcmVxdWlyZWQgdG8gbG9nIGNvbnZlcnNpb24uXCIpOyB9LCBzID0gZnVuY3Rpb24gKGUsIG8pIHsgaWYgKCEoaSA9IHdpbmRvdy5kb05vdFRyYWNrIHx8IHdpbmRvdy5uYXZpZ2F0b3IuZG9Ob3RUcmFjayB8fCB3aW5kb3cubmF2aWdhdG9yLm1zRG9Ob3RUcmFjaykgfHwgXCIxXCIgIT09IGkuY2hhckF0KDApICYmIFwieWVzXCIgIT09IGkpIHtcbiAgICAgICAgdmFyIGksIGEsIHMgPSByKG8pLCBjID0gZSArIFwiP1wiICsgcztcbiAgICAgICAgaWYgKG5hdmlnYXRvci5zZW5kQmVhY29uKVxuICAgICAgICAgICAgaWYgKGMubGVuZ3RoID4gNmUzKSB7XG4gICAgICAgICAgICAgICAgdmFyIGwgPSBuZXcgQmxvYihbc10sIHsgdHlwZTogXCJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWRcIiB9KTtcbiAgICAgICAgICAgICAgICBuYXZpZ2F0b3Iuc2VuZEJlYWNvbihlLCBsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICBuYXZpZ2F0b3Iuc2VuZEJlYWNvbihjKTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgKGEgPSAtMSAhPT0gbmF2aWdhdG9yLmFwcFZlcnNpb24uaW5kZXhPZihcIk1TSUUgOVwiKSA/IHsgZGF0YVR5cGU6IFwianNvbnBcIiwgdXJsOiBjIH0gOiB7IHR5cGU6IFwicG9zdFwiLCB1cmw6IGMsIGFzeW5jOiAhMSwgeGhyRmllbGRzOiB7IHdpdGhDcmVkZW50aWFsczogITAgfSB9KS5lcnJvciA9IGZ1bmN0aW9uICgpIHsgZm9yICh2YXIgZSA9IFtdLCBuID0gMDsgbiA8IGFyZ3VtZW50cy5sZW5ndGg7IG4rKylcbiAgICAgICAgICAgICAgICBlW25dID0gYXJndW1lbnRzW25dOyB0LmRlYnVnLmFwcGx5KHQsIF9lKFtcIkJlYWNvbiByZXF1ZXN0IGhhcyBiZWVuIGZhaWxlZFwiXSwgZSwgITEpKTsgfSwgbi5yZXF1ZXN0KGEpO1xuICAgIH0gfTsgcmV0dXJuIHsgbmFtZTogXCJsb2dcIiwgbG9nTWljcm9Db252ZXJzaW9uOiBmdW5jdGlvbiAoZSwgbiwgcikgeyBlID8gbiA/IG8oXCIvYXBpL3YzL2NvbnZlcnNpb24vbG9nTWljcm9Db252ZXJzaW9uXCIsIHsgdHJhY2tpbmdfaWQ6IGUsIGV2ZW50X2dyb3VwX2lkOiBuLCBjdXN0b21fcGFyYW1zOiByIHx8IFwiXCIgfSkgOiB0LmxvZyhcIlBhcmFtZXRlciBldmVudEdyb3VwSWQgaXMgcmVxdWlyZWQgdG8gbG9nIG1pY3JvIGNvbnZlcnNpb24uXCIpIDogdC5sb2coXCJQYXJhbWV0ZXIgdHJhY2tpbmdJZCBpcyByZXF1aXJlZCB0byBsb2cgbWljcm8gY29udmVyc2lvbi5cIik7IH0sIGxvZ0NvbnZlcnNpb246IGZ1bmN0aW9uIChlLCBuLCB0LCByLCBvLCBpLCBzLCBjKSB7IGlmIChcIm9iamVjdFwiID09IHR5cGVvZiBlKSB7XG4gICAgICAgICAgICB2YXIgbCA9IGU7XG4gICAgICAgICAgICBhKGwudHJhY2tpbmdfaWQsIGwudGVybV9pZCwgbC50ZXJtX25hbWUsIGwuc3RlcF9udW1iZXIsIGwuYW1vdW50LCBsLmN1cnJlbmN5LCBsLmN1c3RvbV9wYXJhbXMsIGwuY29udmVyc2lvbl9jYXRlZ29yeSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgYShlLCBuLCB0LCByLCBvLCBpLCBzLCBjKTsgfSwgbG9nRnVubmVsU3RlcDogZnVuY3Rpb24gKGUsIG4sIHIsIGkpIHsgZSA/IG4gPyByID8gbyhcIi9hcGkvdjMvY29udmVyc2lvbi9sb2dGdW5uZWxTdGVwXCIsIHsgdHJhY2tpbmdfaWQ6IGUsIHN0ZXBfbnVtYmVyOiBuLCBzdGVwX25hbWU6IHIsIGN1c3RvbV9wYXJhbXM6IGkgfHwgXCJcIiB9KSA6IHQubG9nKFwiUGFyYW1ldGVyIHN0ZXBOYW1lIGlzIHJlcXVpcmVkIHRvIGxvZyBmdW5uZWwgc3RlcC5cIikgOiB0LmxvZyhcIlBhcmFtZXRlciBzdGVwTnVtYmVyIGlzIHJlcXVpcmVkIHRvIGxvZyBmdW5uZWwgc3RlcC5cIikgOiB0LmxvZyhcIlBhcmFtZXRlciB0cmFja2luZ0lkIGlzIHJlcXVpcmVkIHRvIGxvZyBmdW5uZWwgc3RlcC5cIik7IH0sIGxvZ0VzcE1pY3JvQ29udmVyc2lvbjogaSwgbG9nQmVhY29uUmVxdWVzdDogcywgX19wcm90ZWN0ZWRfXzogeyBsb2dDdXN0b21Gb3JtSW1wcmVzc2lvbjogZnVuY3Rpb24gKGUsIG4sIHIpIHsgbiB8fCB0LmxvZyhcIlBhcmFtZXRlciBmb3JtTmFtZSBpcyByZXF1aXJlZCB0byBsb2cgaW1wcmVzc2lvbi5cIiksIHIgfHwgdC5sb2coXCJQYXJhbWV0ZXIgc291cmNlIGlzIHJlcXVpcmVkIHRvIGxvZyBpbXByZXNzaW9uLlwiKTsgdmFyIGkgPSB7IGFpZDogcG4uYWlkLCBwYWdldmlld19pZDogcG4ubWFpbi5mZXRjaFBhZ2VWaWV3SWQoKSwgY3VzdG9tX2Zvcm1fbmFtZTogbiwgY3VzdG9tX2Zvcm1fc291cmNlOiByIH0sIGEgPSBwbi51c2VyLmdldFByb3ZpZGVyKCkuZ2V0VG9rZW4oKTsgcmV0dXJuIGEgJiYgKGkudXNlcl90b2tlbiA9IGEpLCBlICYmIChpLnRyYWNraW5nX2lkID0gZSksIG8oXCIvYXBpL3YzL2N1c3RvbWZvcm0vbG9nL2ltcHJlc3Npb25cIiwgaSk7IH0sIGxvZ0N1c3RvbUZvcm1TdWJtaXNzaW9uOiBmdW5jdGlvbiAoZSwgbiwgcikgeyBuIHx8IHQubG9nKFwiUGFyYW1ldGVyIGZvcm1OYW1lIGlzIHJlcXVpcmVkIHRvIGxvZyBzdWJtaXNzaW9uLlwiKSwgciB8fCB0LmxvZyhcIlBhcmFtZXRlciBzb3VyY2UgaXMgcmVxdWlyZWQgdG8gbG9nIHN1Ym1pc3Npb24uXCIpOyB2YXIgaSA9IHsgYWlkOiBwbi5haWQsIHBhZ2V2aWV3X2lkOiBwbi5tYWluLmZldGNoUGFnZVZpZXdJZCgpLCBjdXN0b21fZm9ybV9uYW1lOiBuLCBjdXN0b21fZm9ybV9zb3VyY2U6IHIgfSwgYSA9IHBuLnVzZXIuZ2V0UHJvdmlkZXIoKS5nZXRUb2tlbigpOyByZXR1cm4gYSAmJiAoaS51c2VyX3Rva2VuID0gYSksIGUgJiYgKGkudHJhY2tpbmdfaWQgPSBlKSwgbyhcIi9hcGkvdjMvY3VzdG9tZm9ybS9sb2cvc3VibWlzc2lvblwiLCBpKTsgfSwgbG9nRXNwTWljcm9Db252ZXJzaW9uOiBpIH0sIF9fcHJpdmF0ZV9fOiB7IGRvTG9nOiBvLCBsb2dCZWFjb25SZXF1ZXN0OiBzIH0gfTsgfTtcbiAgICBwbi5jb250YWluZXIucmVnaXN0ZXIoXCJsb2dcIiwgeyB1c2VWYWx1ZTogT2UoKSB9KSwgcG4ubG9nID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJsb2dcIik7XG4gICAgdmFyIFJlID0gZnVuY3Rpb24gKCkgeyB2YXIgZSA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwibG9nXCIpLCBuID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJhcGlcIiksIHQgPSB7IGNvbXBsZXRlSW5pdDogMCwgZXhwRXhlYzogMCwgaWRTaG93OiAwLCBteUFjY291bnRTaG93OiAwLCBvZmZlclNob3c6IDAsIHRlbXBsYXRlU2hvdzogMCwgdHBBY2NTaG93OiAwLCB0cmFjazogMCB9OyBzZXRUaW1lb3V0KChmdW5jdGlvbiAoKSB7IHIoKTsgfSksIDFlNCk7IHZhciByID0gZnVuY3Rpb24gKHIpIHsgaWYgKE1hdGguZmxvb3IoNTAwICogTWF0aC5yYW5kb20oKSkgKyAxID09PSAyNTUpIHtcbiAgICAgICAgdmFyIG8gPSByIHx8IChwbi5mdWxsVFBWZXJzaW9uID8gXCJ0c19jXCIgOiBcInRzX3NcIiksIGkgPSB7IGNvbXBsZXRlSW5pdDogdC5jb21wbGV0ZUluaXQsIHRyYWNrOiB0LnRyYWNrLCBleHBFeGVjOiB0LmV4cEV4ZWMsIGlkU2hvdzogdC5pZFNob3csIG15QWNjb3VudFNob3c6IHQubXlBY2NvdW50U2hvdywgb2ZmZXJTaG93OiB0Lm9mZmVyU2hvdywgdGVtcGxhdGVTaG93OiB0LnRlbXBsYXRlU2hvdywgdHBBY2NTaG93OiB0LnRwQWNjU2hvdywgYWlkOiBwbi5haWQsIHR5cGU6IG8gfTtcbiAgICAgICAgZS5sb2dCZWFjb25SZXF1ZXN0KG4uZ2V0RW5kcG9pbnQoKSArIFwiL2ludGVybmFsL2Fub24vdGVsZW1ldHJ5L3V4L2luaXQvdGltZS9sb2dcIiwgaSk7XG4gICAgfSB9OyByZXR1cm4geyBuYW1lOiBcImxvZ2dpbmdcIiwgc2V0VGltZTogZnVuY3Rpb24gKGUpIHsgMCA9PT0gdFtlXSAmJiAodFtlXSA9IE1hdGgucm91bmQocGVyZm9ybWFuY2Uubm93KCkgLSB3aW5kb3cucG5Jbml0UGVyZm9ybWFuY2UpKTsgfSB9OyB9KCk7XG4gICAgcG4uY29udGFpbmVyLnJlZ2lzdGVyKFwibG9nZ2luZ1wiLCB7IHVzZVZhbHVlOiBSZSB9KSwgcG4ubG9nZ2luZyA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwibG9nZ2luZ1wiKTtcbiAgICB2YXIgTGU7XG4gICAgIWZ1bmN0aW9uIChlKSB7IGUuQVVUTyA9IFwiQVwiLCBlLk1BTlVBTCA9IFwiTVwiOyB9KExlIHx8IChMZSA9IHt9KSk7XG4gICAgdmFyIE5lID0gZnVuY3Rpb24gKCkgeyB2YXIgZSA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwidXRpbFwiKSwgbiA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwiYWpheFwiKSwgdCA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwianFVdGlsc1wiKSwgciA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwiZXZlbnRVdGlsc1wiKSwgbyA9IGZ1bmN0aW9uIChlKSB7IHJldHVybiBPYmplY3QuZW50cmllcyhlKS5yZWR1Y2UoKGZ1bmN0aW9uIChlLCBuKSB7IHZhciB0ID0gblswXSwgciA9IG5bMV07IHJldHVybiAociB8fCAwID09PSByKSAmJiAoZVt0XSA9IHIpLCBlOyB9KSwge30pOyB9LCBpID0gci5jcmVhdGVFdmVudE1hbmFnZXIoW10pLCBhID0gZnVuY3Rpb24gKHIsIGksIGEpIHsgcmV0dXJuIG5ldyBQcm9taXNlKChmdW5jdGlvbiAocywgYykgeyB2YXIgbCA9IGEgPyBcIj9cIiArIHQucGFyYW0oYSkgOiBcIlwiLCB1ID0gcG4uZ2V0RXhwZXJpZW5jZUVuZHBvaW50KCExKSArIFwiL1wiICsgcG4uYWlkICsgciArIGwsIGQgPSBvKHsgeGJjOiBlLl9fcHJvdGVjdGVkX18uZ2V0Q29va2llKFwieGJjXCIpIHx8IHZvaWQgMCwgdGJjOiBlLmdldFRiY0Nvb2tpZSgpIHx8IHZvaWQgMCB9KSwgcCA9IG8oeWUoeWUoe30sIGQpLCBpKSk7IGlmICghKHAuY2lkICYmIHAuaXRlbUlkICYmIHAueGJjKSkge1xuICAgICAgICB2YXIgZiA9IFwiY3JlZGl0OiBFcnJvcjogUmVxdWlyZWQgcGFyYW1zIGFyZSBhYnNlbnRcIjtcbiAgICAgICAgZS5kZWJ1ZyhmKSwgYyh7IGNvZGU6IDAsIG1lc3NhZ2U6IGYgfSk7XG4gICAgfSBuLnJlcXVlc3QoeyB0eXBlOiBcInBvc3RcIiwgdXJsOiB1LCBkYXRhOiB5ZSh5ZSh7fSwgZCksIGkpLCB4aHJGaWVsZHM6IHsgd2l0aENyZWRlbnRpYWxzOiAhMCB9LCBlcnJvcjogZnVuY3Rpb24gKG4pIHsgdmFyIHQgPSBcImNyZWRpdDogRXJyb3I6IFJlY2VpdmVkIGVycm9yOlwiICsgbi5zdGF0dXMgKyBcIiBcIiArIG4ucmVzcG9uc2VUZXh0OyBlLmRlYnVnKHQpLCBjKHsgY29kZTogbi5zdGF0dXMsIG1lc3NhZ2U6IG4ucmVzcG9uc2VUZXh0IH0pOyB9LCBzdWNjZXNzOiBmdW5jdGlvbiAoZSkgeyBzKGUpOyB9IH0pOyB9KSk7IH0sIHMgPSBmdW5jdGlvbiAoZSwgbiwgdCwgcikgeyB2YXIgbyA9IGZ1bmN0aW9uIChlKSB7IHJldHVybiBmdW5jdGlvbiAobikgeyByZXR1cm4gaS5maXJlKHZvaWQgMCwgZSwgITAsIG4pLCBuOyB9OyB9LCBzID0gbyhcInN0cmluZ1wiID09IHR5cGVvZiBlID8gZSA6IGUuc3VjY2VzcyksIGMgPSBvKFwic3RyaW5nXCIgPT0gdHlwZW9mIGUgPyBlIDogZS5mYWlsdXJlKTsgcmV0dXJuIGEobiwgdCwgcikudGhlbihzKS5jYXRjaChjKTsgfTsgcmV0dXJuIHsgcmVkZWVtOiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gcyhcIm1hbnVhbENyZWRpdFJlZGVlbWVkXCIsIFwiL2V4ZWN1dGlvbi9jcmVkaXQvcmVkZWVtXCIsIGUpOyB9LCBjaGVjazogZnVuY3Rpb24gKGUpIHsgcmV0dXJuIHMoXCJjcmVkaXRDaGVja2VkXCIsIFwiL2V4ZWN1dGlvbi9jcmVkaXQvY2hlY2tcIiwgZSk7IH0sIHJlZ2lzdGVyQ2FsbGJhY2s6IGZ1bmN0aW9uIChlLCBuKSB7IGkuYWRkRXZlbnQoZSksIGkucmVnaXN0ZXJDYWxsYmFjayhlLCBuKTsgfSB9OyB9KCk7XG4gICAgcG4uY29udGFpbmVyLnJlZ2lzdGVyKFwiY3JlZGl0XCIsIHsgdXNlVmFsdWU6IE5lIH0pLCBwbi5jcmVkaXQgPSBwbi5jb250YWluZXIucmVzb2x2ZShcImNyZWRpdFwiKTtcbiAgICB2YXIgVWUgPSBmdW5jdGlvbiAoKSB7IHZhciBlLCBuID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJwb3N0bWVzc2FnZVwiKSwgdCA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwiY29udGFpbmVyVXRpbHNcIiksIHIgPSBwbi5jb250YWluZXIucmVzb2x2ZShcInV0aWxcIiksIG8gPSBwbi5jb250YWluZXIucmVzb2x2ZShcImV2ZW50VXRpbHNcIiksIGkgPSBwbi5jb250YWluZXIucmVzb2x2ZShcImxvZ2dpbmdcIiksIGEgPSBvLmNyZWF0ZUV2ZW50TWFuYWdlcihbXCJyZXNpemVcIiwgXCJsb2dpblN1Y2Nlc3NcIiwgXCJsb2dvdXRcIl0pLCBzID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gcG4uZ2V0RW5kcG9pbnRSb290KCEwKSArIFwiL2NoZWNrb3V0L3VzZXIvbG9naW5TaG93XCI7IH07IGZ1bmN0aW9uIGMobykgeyByLmRlYnVnKFwiTG9naW4gZXZlbnQgcmVjZWl2ZWRcIiwgby5ldmVudCwgby5wYXJhbXMsIG8pOyB2YXIgaSA9ICF0LmdldElmcmFtZShvLnNlbmRlcikuY29uZmlnLnBhcmVudDsgc3dpdGNoIChvLmV2ZW50KSB7XG4gICAgICAgIGNhc2UgXCJsb2FkZWRcIjpcbiAgICAgICAgICAgIGUgPSAhMTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiY2xvc2VcIjpcbiAgICAgICAgICAgIHQuY2xvc2VNb2RhbENvbnRhaW5lcigpLCBhLmZpcmVDYWxsYmFja3Moby5ldmVudCwgby5wYXJhbXMsIG8uc2VuZGVyLCBpKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiY2FuY2VsXCI6XG4gICAgICAgIGNhc2UgXCJlcnJvclwiOlxuICAgICAgICBjYXNlIFwiY3VzdG9tRXZlbnRcIjpcbiAgICAgICAgICAgIGEuZmlyZUNhbGxiYWNrcyhvLmV2ZW50LCBvLnBhcmFtcywgby5zZW5kZXIsIGkpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJsb2dpblN1Y2Nlc3NcIjpcbiAgICAgICAgICAgICFmdW5jdGlvbiAoZSwgbiwgbywgaSkgeyB2YXIgcyA9IHQuZ2V0SWZyYW1lKG8pOyByLnNldEFjY2Vzc1Rva2VuTGlzdENvb2tpZSh7IHZhbHVlOiBuLnRva2VuX2xpc3QsIGNvb2tpZV9kb21haW46IG4uY29va2llX2RvbWFpbiB9LCBuLnVzZXJfdG9rZW4pLCBzLmNvbmZpZy51c2VyVG9rZW4gPSBuLnVzZXJfdG9rZW4sIHMgJiYgcy5jb25maWcgJiYgcy5jb25maWcubG9naW5TdWNjZXNzICYmIHMuY29uZmlnLmxvZ2luU3VjY2VzcyhuLmV2ZW50LCBuLnBhcmFtcywgbi5zZW5kZXIpOyBhLmZpcmVDYWxsYmFja3MoZSwgbiwgbywgaSksIHMgJiYgcy5jb25maWcgJiYgcy5jb25maWcuY2xvc2VBZnRlclN1Y2Nlc3MgJiYgdC5jbG9zZU1vZGFsQ29udGFpbmVyKG8pOyB2YXIgYyA9IHsgcmVsb2FkQWZ0ZXJMb2dpbjogITAsIHVzZXJUb2tlbjogbi51c2VyX3Rva2VuLCB1c2VyOiBuLnVzZXIgfTsgdShjKTsgfShvLmV2ZW50LCBvLnBhcmFtcywgby5zZW5kZXIsIGkpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJsb2dvdXRTdWNjZXNzXCI6XG4gICAgICAgICAgICAhZnVuY3Rpb24gKGUsIG4sIHQsIG8pIHsgYS5maXJlQ2FsbGJhY2tzKFwibG9nb3V0XCIsIG51bGwsIHZvaWQgMCwgITApLCByLnNldEFjY2Vzc1Rva2VuTGlzdENvb2tpZSh7IHZhbHVlOiBuLnRva2VuX2xpc3QsIGNvb2tpZV9kb21haW46IG4uY29va2llX2RvbWFpbiB9LCBuLnVzZXJfdG9rZW4sICEwKTsgfShvLmV2ZW50LCBvLnBhcmFtcywgby5zZW5kZXIpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJyZWFkeVRvU3VibWl0U3RhdHNcIjpcbiAgICAgICAgICAgIHZhciBzID0geyBwYWdlVmlld0lkOiBwbi5tYWluLmZldGNoUGFnZVZpZXdJZCgpLCB0YmM6IHIuZ2V0VGJjQ29va2llKCkgfTtcbiAgICAgICAgICAgIG4uc2VuZChcInN1Ym1pdFN0YXRzXCIsIHMsIG8uc2VuZGVyKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBkZWZhdWx0OiByZXR1cm4gdm9pZCByLmRlYnVnKFwiUmVjZWl2ZWQgaW52YWxpZCBldmVudCB0eXBlOiBcIiArIG8uZXZlbnQpO1xuICAgIH0gfSB2YXIgbCwgdSA9IGZ1bmN0aW9uIChlKSB7IG4uYnJvYWRjYXN0KFwicmVsb2FkT2ZmZXJcIiwgZSk7IH07IGZ1bmN0aW9uIGQoZSkgeyBsICYmIHQuY2xvc2VNb2RhbENvbnRhaW5lcihsKTsgdmFyIG4gPSB7fTsgT2JqZWN0LmFzc2lnbihuLCB7IGNsb3NlQWZ0ZXJTdWNjZXNzOiAhMCB9LCBlKSwgbi5kaXNwbGF5TW9kZSA9IFwicG9wdXBcIiwgbi53aWR0aCA9IDM2MCwgbi5oZWlnaHQgPSA2NjAsIG4uc3RhdGUgPSBuLnN0YXRlID8gbi5zdGF0ZSA6IFwibG9naW5cIjsgdmFyIG8sIGkgPSBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IHt9OyByZXR1cm4gW1wiZGlzcGxheU1vZGVcIiwgXCJhaWRcIiwgXCJ3aWR0aFwiLCBcImhlaWdodFwiLCBcInN0YXRlXCJdLmZvckVhY2goKGZ1bmN0aW9uICh0KSB7IGVbdF0gJiYgKG5bdF0gPSBlW3RdKTsgfSkpLCBuOyB9KG4pOyBpLmlmcmFtZUlkID0gci5yYW5kb21TdHJpbmcoMTYpLCBpLnVybCA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmLCBpLmhvc3RfdXJsID0gd2luZG93LmxvY2F0aW9uLmhyZWYsIGwgPSBpLmlmcmFtZUlkLCBmdW5jdGlvbiAoZSkgeyBbXCJhaWRcIiwgXCJnYUNsaWVudElkXCIsIFwidGFnc1wiLCBcImNvbnRlbnRTZWN0aW9uXCIsIFwiY29udGVudEF1dGhvclwiXS5mb3JFYWNoKChmdW5jdGlvbiAobikgeyBwbltuXSAmJiAoZVtuXSA9IHBuW25dKTsgfSkpLCBwbi5jb250ZW50Q3JlYXRlZCAmJiAoZS5jb250ZW50Q3JlYXRlZCA9IHBuLmNvbnRlbnRDcmVhdGVkKTsgfShpKSwgaS51c2VyX3Byb3ZpZGVyID0gXCJ0aW55cGFzc19hY2NvdW50c1wiLCBlLnVzZXJUb2tlbiAmJiAoaS51c2VyX3Rva2VuID0gZS51c2VyVG9rZW4pLCByLmdldENhbXBhaWducyhpKTsgdmFyIHUgPSB7IHVybDogcygpLCBjb25maWc6IG4sIHBvc3RNZXNzYWdlVXJsOiBzKCksIHJlY2VpdmU6IGMsIGlmcmFtZVBhcmFtczogaSB9OyByZXR1cm4gbi5pZnJhbWVJZCA/ICh1LmlmcmFtZVBhcmFtcy5pZnJhbWVJZCA9IG4uaWZyYW1lSWQsIG8gPSB0LnJlZGlyZWN0Q29udGFpbmVyKG4uaWZyYW1lSWQsIHUpKSA6IG8gPSB0LmNyZWF0ZUNvbnRhaW5lcih1KSwgYS5yZWdpc3RlckNhbGxiYWNrKG4sIGkuaWZyYW1lSWQpLCBvOyB9IHJldHVybiB7IG5hbWU6IFwidGlueXBhc3NMb2dpblwiLCBzaG93OiBmdW5jdGlvbiAobikgeyBpZiAoZSlcbiAgICAgICAgICAgIHJldHVybiAhMTsgZSA9ICEwLCBzZXRUaW1lb3V0KChmdW5jdGlvbiAoKSB7IGUgPSAhMTsgfSksIDFlNCksIGQobikgfHwgci5lcnJvcihcIkNvdWxkIG5vdCBpbml0aWFsaXplIGxvZ2luOyBjaGVjayBjb25maWd1cmF0aW9uXCIpLCBpLnNldFRpbWUoXCJ0cEFjY1Nob3dcIik7IH0sIGNsb3NlOiBmdW5jdGlvbiAoKSB7IHQuY2xvc2VNb2RhbENvbnRhaW5lcigpOyB9LCBzaG93QmFja2Ryb3A6IGZ1bmN0aW9uICgpIHsgdC5zaG93QmFja2Ryb3AoKTsgfSwgaGlkZUJhY2tkcm9wOiBmdW5jdGlvbiAoKSB7IHQuaGlkZUJhY2tkcm9wKCk7IH0sIGNlbnRlckJhY2tkcm9wOiBmdW5jdGlvbiAoZSkgeyB0LmNlbnRlckJhY2tkcm9wKGUpOyB9LCByZWdpc3RlckNhbGxiYWNrOiBmdW5jdGlvbiAoZSwgbikgeyBhLnJlZ2lzdGVyQ2FsbGJhY2soZSwgbik7IH0sIGxpc3RlbkxvZ2luOiBmdW5jdGlvbiAoZSkgeyAhZnVuY3Rpb24gKGUpIHsgYS5yZWdpc3RlckNhbGxiYWNrKGUsIGUuaWZyYW1lSWQpOyB2YXIgdCA9IHsgaWZyYW1lSWQ6IGUuaWZyYW1lSWQsIGNvbmZpZzogZSwgaWZyYW1lUGFyYW1zOiBlIH07IG4uaW5pdCh7IHBvc3RNZXNzYWdlVXJsOiBzKCksIHJlY2VpdmU6IGMsIGlmcmFtZTogdCwgaWZyYW1lUGFyYW1zOiB7fSB9KTsgfShlKTsgfSB9OyB9KCk7XG4gICAgcG4uY29udGFpbmVyLnJlZ2lzdGVyKFwidGlueXBhc3NMb2dpblwiLCB7IHVzZVZhbHVlOiBVZSB9KSwgcG4udGlueXBhc3NMb2dpbiA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwidGlueXBhc3NMb2dpblwiKTtcbiAgICB2YXIgamUgPSBmdW5jdGlvbiAoKSB7IHZhciBlID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJhamF4XCIpLCBuID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJqcVV0aWxzXCIpLCB0ID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJ1dGlsXCIpLCByID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJ0aW55cGFzc0xvZ2luXCIpLCBvID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJldmVudFV0aWxzXCIpLmNyZWF0ZUV2ZW50TWFuYWdlcihbXCJsb2dvdXRcIl0pLCBpID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdC5nZXRVc2VyVG9rZW5Db29raWUoKSB8fCBudWxsOyB9OyByZXR1cm4geyBuYW1lOiBcInRpbnlwYXNzQWNjb3VudHNcIiwgaXN2OiAhMSwgaXNVc2VyVmFsaWQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuICEhdC5nZXRVc2VyVG9rZW5Db29raWUoKTsgfSwgZ2V0VG9rZW46IGksIGdldE5hbWU6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIFwidGlueXBhc3NfYWNjb3VudHNcIjsgfSwgb25Mb2dpblN1Y2Nlc3M6IGZ1bmN0aW9uIChlKSB7IHQuc2V0QWNjZXNzVG9rZW5MaXN0Q29va2llKHsgdmFsdWU6IGUudG9rZW5fbGlzdCwgY29va2llX2RvbWFpbjogZS5jb29raWVfZG9tYWluIH0sIGUudXNlcl90b2tlbik7IH0sIGlzQ29uZmlndXJlZDogZnVuY3Rpb24gKCkgeyByZXR1cm4gITAgPT09IHBuLnVzZVRpbnlwYXNzQWNjb3VudHMgfHwgXCJzdHJpbmdcIiA9PSB0eXBlb2YgcG4udXNlVGlueXBhc3NBY2NvdW50cyAmJiBcInRydWVcIiA9PT0gcG4udXNlVGlueXBhc3NBY2NvdW50czsgfSwgbG9naW46IGZ1bmN0aW9uIChlKSB7IHJldHVybiAoZSA9IGUgfHwge30pLnVzZXJUb2tlbiA9IGkoKSwgci5zaG93KGUpOyB9LCBsb2dvdXQ6IGZ1bmN0aW9uIChyKSB7IHZhciBpID0geyBhaWQ6IHBuLmFpZCwgdXJsOiBkb2N1bWVudC5sb2NhdGlvbi5ocmVmIH0sIGEgPSBwbi5nZXRFbmRwb2ludFJvb3QoITApICsgXCIvY2hlY2tvdXQvdXNlci9sb2dvdXQ/XCIgKyBuLnBhcmFtKGkpOyB0LnNldEFjY2Vzc1Rva2VuTGlzdENvb2tpZSh7IHZhbHVlOiBudWxsIH0sIHZvaWQgMCwgITApLCBlLnJlcXVlc3QoeyB1cmw6IGEsIGRhdGFUeXBlOiBcImpzb25wXCIsIHN1Y2Nlc3M6IGZ1bmN0aW9uIChlKSB7IHQuc2V0QWNjZXNzVG9rZW5MaXN0Q29va2llKHsgdmFsdWU6IFwiXCIsIGNvb2tpZV9kb21haW46IGUubW9kZWxzLmNvb2tpZV9kb21haW4gfSwgZS5tb2RlbHMudXNlcl90b2tlbiwgITApLCBvLmZpcmVDYWxsYmFja3MoXCJsb2dvdXRcIiwgbnVsbCwgdm9pZCAwLCAhMCksIHIgJiYgcihlKTsgfSwgZXJyb3I6IGZ1bmN0aW9uIChlKSB7IHQuc2V0QWNjZXNzVG9rZW5MaXN0Q29va2llKG51bGwsIHZvaWQgMCwgITApLCBvLmZpcmVDYWxsYmFja3MoXCJsb2dvdXRcIiwgbnVsbCwgdm9pZCAwLCAhMCksIHIgJiYgcihlKTsgfSB9KTsgfSwgcmVnaXN0ZXJDYWxsYmFjazogZnVuY3Rpb24gKGUsIG4pIHsgby5hZGRFdmVudChlKSwgby5yZWdpc3RlckNhbGxiYWNrKGUsIG4pOyB9IH07IH0oKTtcbiAgICBwbi5jb250YWluZXIucmVnaXN0ZXIoXCJ0aW55cGFzc0FjY291bnRzXCIsIHsgdXNlVmFsdWU6IGplIH0pLCBwbi50aW55cGFzc0FjY291bnRzID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJ0aW55cGFzc0FjY291bnRzXCIpO1xuICAgIHZhciBEZSA9IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSBwbi5jb250YWluZXIucmVzb2x2ZShcImpxVXRpbHNcIiksIG4gPSBwbi5jb250YWluZXIucmVzb2x2ZShcImNvb2tpZVwiKSwgdCA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwidXRpbFwiKSwgciA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwiZXZlbnRVdGlsc1wiKS5jcmVhdGVFdmVudE1hbmFnZXIoW1wibG9nb3V0XCJdKTsgcmV0dXJuIHsgaXN2OiAhMSwgbmFtZTogXCJjb25kZVVzZXJQcm92aWRlclwiLCBnZXROYW1lOiBmdW5jdGlvbiAoKSB7IHJldHVybiBcImNvbmRlXCI7IH0sIGlzVXNlclZhbGlkOiBmdW5jdGlvbiAoKSB7IHJldHVybiAhIXQuZ2V0VXNlclRva2VuQ29va2llKCk7IH0sIGdldFRva2VuOiBmdW5jdGlvbiAoKSB7IHZhciBlID0gdC5maW5kQ29va2llQnlOYW1lKFwiYW1nX3VzZXJfcGFydG5lclwiKTsgcmV0dXJuIHZvaWQgMCAhPT0gZSAmJiBlICYmIGUubGVuZ3RoID49IDAgPyBlIDogbnVsbDsgfSwgb25Mb2dpblN1Y2Nlc3M6IGZ1bmN0aW9uIChyKSB7IHQuc2V0QWNjZXNzVG9rZW5MaXN0Q29va2llKHsgdmFsdWU6IHIudG9rZW5fbGlzdCwgY29va2llX2RvbWFpbjogci5jb29raWVfZG9tYWluIH0sIHIudXNlcl90b2tlbik7IHZhciBvID0geyBwYXRoOiBcIi9cIiwgZXhwaXJlczogNzMwIH07IHIuY29va2llX2RvbWFpbiAmJiBcImxvY2FsaG9zdFwiICE9PSByLmNvb2tpZV9kb21haW4gJiYgZS5pbkFycmF5KHIuY29va2llX2RvbWFpbiwgdC5nZXRQb3NzaWJsZUNvb2tpZURvbWFpbnMoKSkgPj0gMCAmJiAoby5kb21haW4gPSByLmNvb2tpZV9kb21haW4pLCBuLnJhdyA9ICEwLCB0Ll9fcHJvdGVjdGVkX18uc2V0Q29va2llKHIucGFyYW1zLmNvb2tpZU5hbWUsIHIucGFyYW1zLmNvb2tpZVZhbHVlLCBvKSwgdC5fX3Byb3RlY3RlZF9fLnNldENvb2tpZShcImFtZ191c2VyX3BhcnRuZXJcIiwgci5wYXJhbXMuZXh0ZXJuYWxJZCwgbyksIHQuX19wcm90ZWN0ZWRfXy5zZXRDb29raWUoXCJhbWdfdXNlcl9pbmZvXCIsIHIucGFyYW1zLnVzZXJOYW1lLCBvKSwgdC5fX3Byb3RlY3RlZF9fLnNldENvb2tpZShcImFtZ191c2VyX2V4dFwiLCByLnBhcmFtcy5zaXRlVXNlcklkLCBvKSwgci5wYXJhbXMudXBkYXRlVG9rZW4gJiYgdC5fX3Byb3RlY3RlZF9fLnNldENvb2tpZShcImFtZ191c2VyX3VwZGF0ZVwiLCByLnBhcmFtcy51cGRhdGVUb2tlbiwgbyksIG4ucmF3ID0gITE7IH0sIGxvZ291dDogZnVuY3Rpb24gKGUpIHsgdC5zZXRBY2Nlc3NUb2tlbkxpc3RDb29raWUoeyB2YWx1ZTogbnVsbCB9LCB2b2lkIDAsICEwKTsgdmFyIG4gPSB0LmdldFBvc3NpYmxlQ29va2llRG9tYWlucygpOyBmb3IgKHZhciBvIGluIG4pXG4gICAgICAgICAgICB0LmRlbGV0ZUNvb2tpZShcImFtZ191c2VyXCIsIG5bb10pLCB0LmRlbGV0ZUNvb2tpZShcImFtZ191c2VyX3BhcnRuZXJcIiwgbltvXSksIHQuZGVsZXRlQ29va2llKFwiYW1nX3VzZXJfaW5mb1wiLCBuW29dKSwgdC5kZWxldGVDb29raWUoXCJhbWdfdXNlcl9leHRcIiwgbltvXSksIHQuZGVsZXRlQ29va2llKFwiYW1nX3VzZXJfdXBkYXRlXCIsIG5bb10pOyB0LmRlbGV0ZUNvb2tpZShcImFtZ191c2VyXCIpLCB0LmRlbGV0ZUNvb2tpZShcImFtZ191c2VyX3BhcnRuZXJcIiksIHQuZGVsZXRlQ29va2llKFwiYW1nX3VzZXJfaW5mb1wiKSwgdC5kZWxldGVDb29raWUoXCJhbWdfdXNlcl9leHRcIiksIHQuZGVsZXRlQ29va2llKFwiYW1nX3VzZXJfdXBkYXRlXCIpLCByLmZpcmVDYWxsYmFja3MoXCJsb2dvdXRcIiwgbnVsbCwgdm9pZCAwLCAhMCksIGUgJiYgZSgpOyB9LCBpc0NvbmZpZ3VyZWQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuICEwID09PSBwbi51c2VDb25kZVVzZXJQcm92aWRlciB8fCBcInN0cmluZ1wiID09IHR5cGVvZiBwbi51c2VDb25kZVVzZXJQcm92aWRlciAmJiBcInRydWVcIiA9PT0gcG4udXNlQ29uZGVVc2VyUHJvdmlkZXI7IH0sIHJlZ2lzdGVyQ2FsbGJhY2s6IGZ1bmN0aW9uIChlLCBuKSB7IHIuYWRkRXZlbnQoZSksIHIucmVnaXN0ZXJDYWxsYmFjayhlLCBuKTsgfSB9OyB9KCk7XG4gICAgcG4uY29udGFpbmVyLnJlZ2lzdGVyKFwiY29uZGVVc2VyUHJvdmlkZXJcIiwgeyB1c2VWYWx1ZTogRGUgfSksIHBuLmNvbmRlVXNlclByb3ZpZGVyID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJjb25kZVVzZXJQcm92aWRlclwiKTtcbiAgICB2YXIgRmUgPSBmdW5jdGlvbiAoKSB7IHZhciBlID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJ1dGlsXCIpLCBuID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJhcGlcIiksIHQgPSBwbi5jb250YWluZXIucmVzb2x2ZShcImV2ZW50VXRpbHNcIiksIHIgPSBwbi5jb250YWluZXIucmVzb2x2ZShcImpxVXRpbHNcIiksIG8gPSAhMTsgdmFyIGkgPSB0LmNyZWF0ZUV2ZW50TWFuYWdlcihbXCJ1c2VyQ2hhbmdlZFwiLCBcIm9uSGlkZVwiLCBcImxvZ291dFwiXSksIGEgPSB7IGFwaUtleTogbnVsbCwgc2NyZWVuU2V0OiBcIkRlZmF1bHQtUmVnaXN0cmF0aW9uTG9naW5cIiwgc3RhcnRTY3JlZW46IG51bGwsIGVuYWJsZWRQcm92aWRlcnM6IG51bGwsIGxhbmc6IG51bGwgfTsgZnVuY3Rpb24gcygpIHsgdmFyIG4gPSBlLmdldFVzZXJUb2tlbkNvb2tpZSgpOyBpZiAobiAmJiBlLmZpbmRDb29raWVCeU5hbWUoXCJnbHRfXCIgKyBhLmFwaUtleSkgPT09IGUuZmluZENvb2tpZUJ5TmFtZShcIl9fdXRnX1wiICsgYS5hcGlLZXkpKVxuICAgICAgICByZXR1cm4gbjsgcmV0dXJuIG51bGw7IH0gdmFyIGMgPSBbXTsgZnVuY3Rpb24gbCh0LCBzKSB7IGlmICghbylcbiAgICAgICAgdGhyb3cgXCJHaWd5YSBpcyBub3QgY29uZmlndXJlZFwiOyBkKCk7IChlLmZpbmRDb29raWVCeU5hbWUoXCJnbHRfXCIgKyBhLmFwaUtleSkgIT09IGUuZmluZENvb2tpZUJ5TmFtZShcIl9fdXRnX1wiICsgYS5hcGlLZXkpIHx8IHQpICYmIChjLnB1c2gocyksIDEgPT09IGMubGVuZ3RoICYmIHdpbmRvdy5naWd5YS5hY2NvdW50cy5nZXRBY2NvdW50SW5mbyh7IGNhbGxiYWNrOiBmdW5jdGlvbiAodCkgeyBpZiAoMCA9PT0gdC5lcnJvckNvZGUpIHtcbiAgICAgICAgICAgIHZhciBvID0geyB1aWQ6IHQuVUlELCBzaWduYXR1cmU6IHQuVUlEU2lnbmF0dXJlLCBzaWduYXR1cmVfdGltZXN0YW1wOiB0LnNpZ25hdHVyZVRpbWVzdGFtcCwgdXJsOiBlLnByZXBhcmVVcmxQYXJhbWV0ZXIod2luZG93LmxvY2F0aW9uLmhyZWYpIH07XG4gICAgICAgICAgICBlLnN0YXJ0Q2FsbChcInJlZnJlc2hVc2VyVG9rZW5cIiksIG4uY2FsbEFwaShcIi9hbm9uL2dpZ3lhL3ZlcmlmeUFjY291bnRJbmZvXCIsIG8sIChmdW5jdGlvbiAobikgeyBpZiAobiAmJiBuLnJlc3VsdCkge1xuICAgICAgICAgICAgICAgIGUuc2V0QWNjZXNzVG9rZW5MaXN0Q29va2llKG4ucmVzdWx0LmFjY2Vzc190b2tlbiwgbi5yZXN1bHQudXNlcl90b2tlbik7XG4gICAgICAgICAgICAgICAgdmFyIHQgPSB7IHBhdGg6IFwiL1wiLCBleHBpcmVzOiA3MzAgfTtcbiAgICAgICAgICAgICAgICBpZiAobi5yZXN1bHQuYWNjZXNzX3Rva2VuKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBvID0gbi5yZXN1bHQuYWNjZXNzX3Rva2VuLmNvb2tpZV9kb21haW47XG4gICAgICAgICAgICAgICAgICAgIG8gJiYgXCJsb2NhbGhvc3RcIiAhPT0gbyAmJiByLmluQXJyYXkobywgZS5nZXRQb3NzaWJsZUNvb2tpZURvbWFpbnMoKSkgPj0gMCAmJiAodC5kb21haW4gPSBvKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFyIHMgPSBlLmZpbmRDb29raWVCeU5hbWUoXCJnbHRfXCIgKyBhLmFwaUtleSk7XG4gICAgICAgICAgICAgICAgZS5fX3Byb3RlY3RlZF9fLnNldENvb2tpZShcIl9fdXRnX1wiICsgYS5hcGlLZXksIHMsIHQpO1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGwgPSAwOyBsIDwgYy5sZW5ndGg7IGwrKykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgdSA9IGNbbF07XG4gICAgICAgICAgICAgICAgICAgIHUgJiYgdShuLnJlc3VsdCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIG4ucmVzdWx0LnVzZXIgJiYgKG4ucmVzdWx0LnVzZXIgPSB7IHVpZDogbi5yZXN1bHQudXNlci51aWQsIGVtYWlsOiBuLnJlc3VsdC51c2VyLmVtYWlsLCBmaXJzdE5hbWU6IG4ucmVzdWx0LnVzZXIuZmlyc3RfbmFtZSwgbGFzdE5hbWU6IG4ucmVzdWx0LnVzZXIubGFzdF9uYW1lLCB2YWxpZDogbi5yZXN1bHQudXNlci52YWxpZCB9KSwgaS5maXJlQ2FsbGJhY2tzKFwidXNlckNoYW5nZWRcIiwgbi5yZXN1bHQsIHZvaWQgMCwgITApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIGUubG9nKFwiQ2FuJ3QgdmVyaWZ5IGdpZ3lhIHVzZXI6IG1heSBiZSB0aGUgY29uZmlndXJhdGlvbiBvZiBnaWd5YSB1c2VyIHByb3ZpZGVyIGlzIGludmFsaWRcIiksIGUuc2V0QWNjZXNzVG9rZW5MaXN0Q29va2llKCk7IGMgPSBbXSwgZS5kb25lQ2FsbChcInJlZnJlc2hVc2VyVG9rZW5cIik7IH0pKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICBlLnNldEFjY2Vzc1Rva2VuTGlzdENvb2tpZSgpLCBjID0gW107IH0gfSkpOyB9IHZhciB1ID0gITE7IGZ1bmN0aW9uIGQoKSB7IGlmICghd2luZG93LmdpZ3lhIHx8ICF3aW5kb3cuZ2lneWEuX19pbml0aWFsaXplZClcbiAgICAgICAgdGhyb3cgXCJHaWd5YSBpcyBub3QgaW5pdGlhbGl6ZWRcIjsgfSByZXR1cm4geyBpc3Y6ICExLCBuYW1lOiBcImdpZ3lhXCIsIGluaXQ6IGZ1bmN0aW9uIChuKSB7IGlmICghbykge1xuICAgICAgICAgICAgZm9yICh2YXIgdCBpbiBuKVxuICAgICAgICAgICAgICAgIHZvaWQgMCAhPT0gblt0XSAmJiAoYVt0XSA9IG5bdF0pO1xuICAgICAgICAgICAgaWYgKCFhLnNjcmVlblNldClcbiAgICAgICAgICAgICAgICB0aHJvdyBcIkdpZ3lhIGlzIG5vdCBjb25maWd1cmVkOiBzY3JlZW5TZXQgcGFyYW1ldGVyIHJlcXVpcmVkXCI7XG4gICAgICAgICAgICBpZiAoIWEuYXBpS2V5KVxuICAgICAgICAgICAgICAgIHRocm93IFwiR2lneWEgaXMgbm90IGNvbmZpZ3VyZWQ6IGFwaUtleSBwYXJhbWV0ZXIgcmVxdWlyZWRcIjtcbiAgICAgICAgICAgIGQoKSwgd2luZG93LmdpZ3lhLmFjY291bnRzLmFkZEV2ZW50SGFuZGxlcnMoeyBvbkxvZ2luOiBmdW5jdGlvbiAoKSB7IHUgPSAhMCwgbCgpOyB9LCBvbkxvZ291dDogZnVuY3Rpb24gKCkgeyBlLnNldEFjY2Vzc1Rva2VuTGlzdENvb2tpZSh7IHZhbHVlOiBudWxsIH0sIHZvaWQgMCwgITApLCBpLmZpcmVDYWxsYmFja3MoXCJsb2dvdXRcIiwgbnVsbCwgdm9pZCAwLCAhMCk7IH0gfSksIG8gPSAhMCwgbCgpO1xuICAgICAgICB9IH0sIGlzVXNlclZhbGlkOiBmdW5jdGlvbiAoKSB7IHZhciBlID0gcygpOyByZXR1cm4gISEodm9pZCAwICE9PSBlICYmIGUgJiYgZS5sZW5ndGggPj0gMCk7IH0sIGdldFRva2VuOiBzLCBnZXROYW1lOiBmdW5jdGlvbiAoKSB7IHJldHVybiBcImdpZ3lhXCI7IH0sIG9uTG9naW5TdWNjZXNzOiBmdW5jdGlvbiAobikgeyBlLnNldEFjY2Vzc1Rva2VuTGlzdENvb2tpZSh7IHZhbHVlOiBuLnRva2VuX2xpc3QsIGNvb2tpZV9kb21haW46IG4uY29va2llX2RvbWFpbiB9LCBuLnVzZXJfdG9rZW4pOyB9LCBsb2dpbjogZnVuY3Rpb24gKGUpIHsgaWYgKCFvKVxuICAgICAgICAgICAgdGhyb3cgXCJHaWd5YSBpcyBub3QgY29uZmlndXJlZFwiOyBkKCksIGUgJiYgd2luZG93LmdpZ3lhLmFjY291bnRzLmFkZEV2ZW50SGFuZGxlcnMoeyBvbkxvZ2luOiBmdW5jdGlvbiAoKSB7IGwoITAsIGUpOyB9IH0pOyB2YXIgbiA9IHsgc2NyZWVuU2V0OiBhLnNjcmVlblNldCwgb25IaWRlOiBmdW5jdGlvbiAoKSB7IGkuZmlyZUNhbGxiYWNrcyhcIm9uSGlkZVwiLCB7IGFmdGVyTG9naW46IHUgfSwgdm9pZCAwLCAhMCk7IH0gfSwgdCA9IFtcImFwaUtleVwiLCBcInNjcmVlblNldFwiXTsgZm9yICh2YXIgciBpbiBhKSB7XG4gICAgICAgICAgICByIGluIHQgfHwgKG5bcl0gPSBhW3JdKTtcbiAgICAgICAgfSB1ID0gITEsIHdpbmRvdy5naWd5YS5hY2NvdW50cy5zaG93U2NyZWVuU2V0KG4pOyB9LCBsb2dvdXQ6IGZ1bmN0aW9uIChuKSB7IGlmICghbylcbiAgICAgICAgICAgIHRocm93IFwiR2lneWEgaXMgbm90IGNvbmZpZ3VyZWRcIjsgZCgpLCB3aW5kb3cuZ2lneWEuYWNjb3VudHMubG9nb3V0KHsgY2FsbGJhY2s6IGZ1bmN0aW9uICgpIHsgaS5maXJlQ2FsbGJhY2tzKFwibG9nb3V0XCIsIG51bGwsIHZvaWQgMCwgITApLCBuICYmIG4oKSwgZS5zZXRBY2Nlc3NUb2tlbkxpc3RDb29raWUoeyB2YWx1ZTogbnVsbCB9LCB2b2lkIDAsICEwKTsgfSB9KSwgZS5zZXRBY2Nlc3NUb2tlbkxpc3RDb29raWUoeyB2YWx1ZTogbnVsbCB9LCB2b2lkIDAsICEwKTsgfSwgaXNDb25maWd1cmVkOiBmdW5jdGlvbiAoKSB7IHJldHVybiAhMCA9PT0gcG4udXNlR2lneWFVc2VyUHJvdmlkZXIgfHwgXCJzdHJpbmdcIiA9PSB0eXBlb2YgcG4udXNlR2lneWFVc2VyUHJvdmlkZXIgJiYgXCJ0cnVlXCIgPT09IHBuLnVzZUdpZ3lhVXNlclByb3ZpZGVyOyB9LCByZWdpc3RlckNhbGxiYWNrOiBmdW5jdGlvbiAoZSwgbikgeyBpLmFkZEV2ZW50KGUpLCBpLnJlZ2lzdGVyQ2FsbGJhY2soZSwgKGZ1bmN0aW9uIChlKSB7IHJldHVybiBuKGUpOyB9KSk7IH0sIGxvZ2luQnlQYXNzd29yZGxlc3M6IGZ1bmN0aW9uIChuKSB7IGlmICghbilcbiAgICAgICAgICAgIHRocm93IFwiU2Vzc2lvbiBpbmZvIGlzIGVtcHR5XCI7IHZhciB0ID0gbi5hY2Nlc3NUb2tlbk5hbWUsIHIgPSBuLmFjY2Vzc1Rva2VuOyBlLl9fcHJvdGVjdGVkX18uc2V0Q29va2llKHQsIHIpOyB2YXIgbyA9IFwiZ2x0X1wiICsgYS5hcGlLZXk7IGUuX19wcm90ZWN0ZWRfXy5zZXRDb29raWUobywgciksIGwoITApOyB9IH07IH0oKTtcbiAgICBwbi5jb250YWluZXIucmVnaXN0ZXIoXCJnaWd5YVwiLCB7IHVzZVZhbHVlOiBGZSB9KSwgcG4uZ2lneWEgPSBwbi5jb250YWluZXIucmVzb2x2ZShcImdpZ3lhXCIpO1xuICAgIHZhciBCZSA9IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSBmdW5jdGlvbiAoZSkgeyBmdW5jdGlvbiBuKCkgeyByZXR1cm4gbnVsbCAhPT0gZSAmJiBlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpczsgfSByZXR1cm4gZnVuY3Rpb24gKGUsIG4pIHsgaWYgKFwiZnVuY3Rpb25cIiAhPSB0eXBlb2YgbiAmJiBudWxsICE9PSBuKVxuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2xhc3MgZXh0ZW5kcyB2YWx1ZSBcIiArIFN0cmluZyhuKSArIFwiIGlzIG5vdCBhIGNvbnN0cnVjdG9yIG9yIG51bGxcIik7IGZ1bmN0aW9uIHQoKSB7IHRoaXMuY29uc3RydWN0b3IgPSBlOyB9IHdlKGUsIG4pLCBlLnByb3RvdHlwZSA9IG51bGwgPT09IG4gPyBPYmplY3QuY3JlYXRlKG4pIDogKHQucHJvdG90eXBlID0gbi5wcm90b3R5cGUsIG5ldyB0KTsgfShuLCBlKSwgbi5wcm90b3R5cGUuY29uc3RydWN0ID0gZnVuY3Rpb24gKGUpIHsgdGhpcy5tZXNzYWdlID0gZSwgdGhpcy5uYW1lID0gXCJJbnZhbGlkQ2hhcmFjdGVyRXJyb3JcIjsgfSwgbjsgfShFcnJvcik7IGZ1bmN0aW9uIG4obikgeyB2YXIgdCA9IFN0cmluZyhuKS5yZXBsYWNlKC89KyQvLCBcIlwiKTsgaWYgKHQubGVuZ3RoICUgNCA9PSAxKVxuICAgICAgICB0aHJvdyBuZXcgZShcIidhdG9iJyBmYWlsZWQ6IFRoZSBzdHJpbmcgdG8gYmUgZGVjb2RlZCBpcyBub3QgY29ycmVjdGx5IGVuY29kZWQuXCIpOyBmb3IgKHZhciByLCBvLCBpID0gMCwgYSA9IDAsIHMgPSBcIlwiOyBvID0gdC5jaGFyQXQoYSsrKTsgfm8gJiYgKHIgPSBpICUgNCA/IDY0ICogciArIG8gOiBvLCBpKysgJSA0KSA/IHMgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgyNTUgJiByID4+ICgtMiAqIGkgJiA2KSkgOiAwKVxuICAgICAgICBvID0gXCJBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWmFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MDEyMzQ1Njc4OSsvPVwiLmluZGV4T2Yobyk7IHJldHVybiBzOyB9IHRyeSB7XG4gICAgICAgIHZhciB0ID0gd2luZG93LmF0b2IgJiYgd2luZG93LmF0b2IuYmluZCh3aW5kb3cpIHx8IG47XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIHQgPSBuO1xuICAgIH0gdmFyIHIgPSBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IGUucmVwbGFjZSgvLS9nLCBcIitcIikucmVwbGFjZSgvXy9nLCBcIi9cIik7IHN3aXRjaCAobi5sZW5ndGggJSA0KSB7XG4gICAgICAgIGNhc2UgMDogYnJlYWs7XG4gICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgIG4gKz0gXCI9PVwiO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgMzpcbiAgICAgICAgICAgIG4gKz0gXCI9XCI7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgZGVmYXVsdDogdGhyb3cgXCJJbGxlZ2FsIGJhc2U2NHVybCBzdHJpbmchXCI7XG4gICAgfSB0cnkge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudCh0KGUpLnJlcGxhY2UoLyguKS9nLCAoZnVuY3Rpb24gKGUsIG4pIHsgdmFyIHQgPSBuLmNoYXJDb2RlQXQoMCkudG9TdHJpbmcoMTYpLnRvVXBwZXJDYXNlKCk7IHJldHVybiB0Lmxlbmd0aCA8IDIgJiYgKHQgPSBcIjBcIiArIHQpLCBcIiVcIiArIHQ7IH0pKSk7IH0obik7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIHJldHVybiB0KG4pO1xuICAgIH0gfTsgcmV0dXJuIGZ1bmN0aW9uIChlLCBuKSB7IGlmIChcInN0cmluZ1wiICE9IHR5cGVvZiBlKVxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIHRva2VuIHNwZWNpZmllZFwiKTsgdmFyIHQgPSAhMCA9PT0gKG4gPSBuIHx8IHt9KS5oZWFkZXIgPyAwIDogMTsgcmV0dXJuIEpTT04ucGFyc2UocihlLnNwbGl0KFwiLlwiKVt0XSkpOyB9OyB9KCk7XG4gICAgcG4uand0RGVjb2RlID0gQmUsIHBuLmNvbnRhaW5lci5yZWdpc3RlcihcImp3dERlY29kZVwiLCB7IHVzZVZhbHVlOiBCZSB9KTtcbiAgICB2YXIgVmUgPSBmdW5jdGlvbiAoKSB7IHZhciBlLCBuID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJ1dGlsXCIpLCB0ID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJhcGlcIiksIHIgPSBwbi5jb250YWluZXIucmVzb2x2ZShcInBvc3RtZXNzYWdlXCIpLCBvID0gXCJwaWFub1RyYWNrZXJcIiwgaSA9IFwiZ2FBY2NvdW50XCIsIGEgPSBcIm1ldHJpY3NHQUFjY291bnRcIiwgcyA9IFwidHJhY2tPbmx5QWlkc1wiLCBjID0gXCJkaXNhYmxlZFwiLCBsID0gODY0MDAsIHUgPSB7IGdhQWNjb3VudDogdm9pZCAwLCB0cmFja2VyTmFtZTogbywgdHJhY2tPbmx5QWlkczogW10sIG1ldHJpY3NHQUFjY291bnQ6IHZvaWQgMCwgaXNHQUVuYWJsZWQ6ICExLCBpc0dBQXBwZW5kZWQ6ICExLCBpc01ldHJpY3NFbmFibGVkOiAhMSwgaXNUcmFja2VyQXBwZW5kZWQ6ICExLCBpc01ldHJpY3NUcmFja2VyQXBwZW5kZWQ6ICExIH0sIGQgPSBbXSwgcCA9ICExLCBmID0gITAsIG0gPSAhMSwgZyA9ICExLCB2ID0gW107IGZ1bmN0aW9uIGgoKSB7IG0gfHwgKGYgPyBzZXRUaW1lb3V0KChmdW5jdGlvbiAoKSB7IGYgPSAhMSwgdygpOyB9KSwgM2UzKSA6IHcoKSk7IH0gZnVuY3Rpb24gdygpIHsgbSA9ICEwLCBTKCksIHUuZ2FBY2NvdW50ID8gRSgpLmNhdGNoKChmdW5jdGlvbiAoKSB7IH0pKSA6IG5ldyBQcm9taXNlKChmdW5jdGlvbiAoZSwgbikgeyB0LmNhbGxBcGkoXCIvYW5vbi9hc3NldHMvZ2FBY2NvdW50XCIsIHsgYWlkOiB0cC5haWQgfSwgKGZ1bmN0aW9uICh0KSB7IDAgPT09IHQuY29kZSA/ICh4KHQuZGF0YSksIGUobnVsbCkpIDogbigpOyB9KSk7IH0pKS50aGVuKChmdW5jdGlvbiAoKSB7IHJldHVybiBFKCk7IH0pKS5jYXRjaCgoZnVuY3Rpb24gKCkgeyB9KSk7IH0gdmFyIHkgPSBmdW5jdGlvbiAoZSwgbikgeyBkLnB1c2goeyBhY3Rpb246IGUsIHBhcmFtczogbiB9KTsgfSwgYiA9IGZ1bmN0aW9uICgpIHsgaWYgKHdpbmRvdy5nYSAmJiB1LmlzVHJhY2tlckFwcGVuZGVkKVxuICAgICAgICBmb3IgKDsgZC5sZW5ndGg7KSB7XG4gICAgICAgICAgICB2YXIgZSA9IGQucG9wKCk7XG4gICAgICAgICAgICBDKGUuYWN0aW9uLCBlLnBhcmFtcyk7XG4gICAgICAgIH0gfSwgayA9IGZ1bmN0aW9uIChlLCBuKSB7IHYucHVzaCh7IGFjdGlvbjogZSwgcGFyYW1zOiBuIH0pOyB9LCBfID0gZnVuY3Rpb24gKCkgeyBpZiAod2luZG93LmdhICYmIHUuaXNNZXRyaWNzVHJhY2tlckFwcGVuZGVkKVxuICAgICAgICBmb3IgKDsgdi5sZW5ndGg7KSB7XG4gICAgICAgICAgICB2YXIgZSA9IHYucG9wKCk7XG4gICAgICAgICAgICBJKGUuYWN0aW9uLCBlLnBhcmFtcyk7XG4gICAgICAgIH0gfSwgQyA9IGZ1bmN0aW9uIChlLCBuKSB7IHdpbmRvdy5nYSAmJiB1LmlzVHJhY2tlckFwcGVuZGVkID8gd2luZG93LmdhKHUudHJhY2tlck5hbWUgKyBcIi5cIiArIGUsIG4pIDogeShlLCBuKTsgfSwgSSA9IGZ1bmN0aW9uIChlLCBuKSB7IHUuaXNNZXRyaWNzRW5hYmxlZCAmJiAod2luZG93LmdhICYmIHUuaXNNZXRyaWNzVHJhY2tlckFwcGVuZGVkID8gd2luZG93LmdhKFwicGVyZm9ybWFuY2VUcmFja2VyLlwiICsgZSwgbikgOiBrKGUsIG4pKTsgfSwgUyA9IGZ1bmN0aW9uICgpIHsgaWYgKCFwKSB7XG4gICAgICAgIGlmICh0cC5nYUNsaWVudElkICYmIChlID0gdHAuZ2FDbGllbnRJZCksIG4uX19wcm90ZWN0ZWRfXy5oYXNMb2NhbFN0b3JhZ2UoKSkge1xuICAgICAgICAgICAgdmFyIHQgPSBuLl9fcHJvdGVjdGVkX18uZ2V0TG9jYWxTdG9yYWdlSXRlbShpKSwgciA9IG4uX19wcm90ZWN0ZWRfXy5nZXRMb2NhbFN0b3JhZ2VJdGVtKGEpLCBvID0gbi5fX3Byb3RlY3RlZF9fLmdldExvY2FsU3RvcmFnZUl0ZW0ocyk7XG4gICAgICAgICAgICB1LmlzR0FFbmFibGVkID0gISF0ICYmIHQgIT09IGMsIHUuaXNNZXRyaWNzRW5hYmxlZCA9ICEhciAmJiByICE9PSBjLCB1LmdhQWNjb3VudCA9IHQsIHUubWV0cmljc0dBQWNjb3VudCA9IHIsIHUudHJhY2tPbmx5QWlkcyA9IG8gfHwgW107XG4gICAgICAgIH1cbiAgICAgICAgcCA9ICEwO1xuICAgIH0gfTsgdmFyIHggPSBmdW5jdGlvbiAoZSkgeyB1LmlzR0FFbmFibGVkID0gISFlLCB1LmdhQWNjb3VudCA9IGUgfHwgYywgbi5fX3Byb3RlY3RlZF9fLnNldExvY2FsU3RvcmFnZUl0ZW0oaSwgdS5nYUFjY291bnQsIGwpOyB9LCBQID0gZnVuY3Rpb24gKGUpIHsgdS5pc01ldHJpY3NFbmFibGVkID0gSlNPTi5wYXJzZShlLmlzX2VuYWJsZWQpLCB1Lm1ldHJpY3NHQUFjY291bnQgPSB1LmlzTWV0cmljc0VuYWJsZWQgPyBlLmdhX2FjY291bnQgOiBjLCB1LnRyYWNrT25seUFpZHMgPSB1LmlzTWV0cmljc0VuYWJsZWQgPyBKU09OLnBhcnNlKGUudHJhY2tfb25seV9haWRzKSA6IFtdLCBuLl9fcHJvdGVjdGVkX18uc2V0TG9jYWxTdG9yYWdlSXRlbShzLCB1LnRyYWNrT25seUFpZHMsIGwpLCBuLl9fcHJvdGVjdGVkX18uc2V0TG9jYWxTdG9yYWdlSXRlbShhLCB1Lm1ldHJpY3NHQUFjY291bnQsIGwpOyB9OyBmdW5jdGlvbiBFKCkgeyByZXR1cm4gbmV3IFByb21pc2UoKGZ1bmN0aW9uIChuLCB0KSB7IHUuaXNHQUVuYWJsZWQgPyBBKCkudGhlbigoZnVuY3Rpb24gKCkgeyBpZiAodS5pc0dBQXBwZW5kZWQpXG4gICAgICAgIGlmICh1LmlzVHJhY2tlckFwcGVuZGVkKVxuICAgICAgICAgICAgbihudWxsKTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICB2YXIgciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzY3JpcHRcIik7XG4gICAgICAgICAgICAgICAgci5pbm5lckhUTUwgPSBmdW5jdGlvbiAoKSB7IHZhciBuID0gbmV3IFJlZ0V4cChcIl5VQS1bMC05YS16QS1aXSotWzAtOWEtekEtWl0qJFwiKS50ZXN0KHUuZ2FBY2NvdW50KSwgdCA9IG5ldyBSZWdFeHAoXCIoW3tdP1swLTlhLWZBLUZdezh9LShbMC05YS1mQS1GXXs0fS0pezN9WzAtOWEtZkEtRl17MTJ9W31dPyl8KFswLTldKlxcXFwuWzAtOV0qKVwiKS50ZXN0KGUgfHwgXCJcIik7IGlmICghbilcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiXCI7IHZhciByID0gXCJnYShmdW5jdGlvbigpIHtcXG4gICAgICAgIGdhKCdjcmVhdGUnLCAnXCIgKyB1LmdhQWNjb3VudCArIFwiJywgJ2F1dG8nLCAnXCIgKyBcInBpYW5vVHJhY2tlcidcIjsgciArPSBlICYmIHQgPyBcIiwgeyBjbGllbnRJZDogJ1wiICsgZSArIFwiJyB9KTtcIiA6IFwiKTtcXG4gICAgICAgIHRwLmdhU2VydmljZS5zZXRDbGllbnRJZChnYS5nZXRCeU5hbWUoJ3BpYW5vVHJhY2tlcicpLmdldCgnY2xpZW50SWQnKSk7XCI7IHJldHVybiByICs9IFwidHAuZ2FTZXJ2aWNlLnRyYWNrZXJBcHBlbmRlZCgpOyB9KTtcIjsgfSgpLCBkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKHIpLCB1LmlzVHJhY2tlckFwcGVuZGVkID0gITAsIG4obnVsbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIHQoKTtcbiAgICAgICAgICAgIH1cbiAgICBlbHNlXG4gICAgICAgIHQoKTsgfSkpLmNhdGNoKChmdW5jdGlvbiAoZSkgeyB9KSkgOiB0KCk7IH0pKTsgfSBmdW5jdGlvbiBUKCkgeyByZXR1cm4gbmV3IFByb21pc2UoKGZ1bmN0aW9uIChlLCBuKSB7IHUuaXNNZXRyaWNzRW5hYmxlZCA/IEEoKS50aGVuKChmdW5jdGlvbiAoKSB7IGlmICh1LmlzR0FBcHBlbmRlZClcbiAgICAgICAgaWYgKHUuaXNNZXRyaWNzVHJhY2tlckFwcGVuZGVkKVxuICAgICAgICAgICAgZShudWxsKTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICB2YXIgdCA9ICF1LnRyYWNrT25seUFpZHMubGVuZ3RoIHx8IHUudHJhY2tPbmx5QWlkcy5jb250YWlucyh0cC5haWQpLCByID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNjcmlwdFwiKTtcbiAgICAgICAgICAgICAgICBpZiAoIW5ldyBSZWdFeHAoXCJeVUEtWzAtOWEtekEtWl0qLVswLTlhLXpBLVpdKiRcIikudGVzdCh1Lm1ldHJpY3NHQUFjY291bnQpKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdm9pZCBuKCk7XG4gICAgICAgICAgICAgICAgci5pbm5lckhUTUwgPSBcIlxcbmdhKGZ1bmN0aW9uKCkge1xcbiAgaWYgKFwiICsgdCArIFwiKSB7XFxuICAgIGdhKCdjcmVhdGUnLCAnXCIgKyB1Lm1ldHJpY3NHQUFjY291bnQgKyBcIicsICdhdXRvJywgJ1wiICsgXCJwZXJmb3JtYW5jZVRyYWNrZXInLCB7IHN0b3JhZ2U6ICdub25lJyB9KTtcXG4gICAgdHAuZ2FTZXJ2aWNlLm1ldHJpY3NUcmFja2VyQXBwZW5kZWQoKTtcXG4gIH1cXG59KTtcXG5cIiwgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChyKSwgdS5pc01ldHJpY3NUcmFja2VyQXBwZW5kZWQgPSAhMCwgZShudWxsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgbigpO1xuICAgICAgICAgICAgfVxuICAgIGVsc2VcbiAgICAgICAgbigpOyB9KSkgOiBlKFwiaXNNZXRyaWNzRW5hYmxlZCAhPT0gdHJ1ZVwiKTsgfSkpOyB9IGZ1bmN0aW9uIEEoKSB7IHJldHVybiBuZXcgUHJvbWlzZSgoZnVuY3Rpb24gKGUsIG4pIHsgaWYgKHUuaXNHQUFwcGVuZGVkKVxuICAgICAgICBlKG51bGwpO1xuICAgIGVsc2VcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHZhciB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNjcmlwdFwiKTtcbiAgICAgICAgICAgIHQuaW5uZXJIVE1MID0gXCJcXG4gICAgICAgICAgICAoZnVuY3Rpb24oaSxzLG8sZyxyLGEsbSl7aVsnR29vZ2xlQW5hbHl0aWNzT2JqZWN0J109cjtpW3JdPWlbcl18fGZ1bmN0aW9uKCl7XFxuICAgICAgICAgICAgKGlbcl0ucT1pW3JdLnF8fFtdKS5wdXNoKGFyZ3VtZW50cyl9LGlbcl0ubD0xKm5ldyBEYXRlKCk7YT1zLmNyZWF0ZUVsZW1lbnQobyksXFxuICAgICAgICAgICAgbT1zLmdldEVsZW1lbnRzQnlUYWdOYW1lKG8pWzBdO2EuYXN5bmM9MTthLnNyYz1nO20ucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoYSxtKVxcbiAgICAgICAgICAgIH0pKHdpbmRvdyxkb2N1bWVudCwnc2NyaXB0JywnaHR0cHM6Ly93d3cuZ29vZ2xlLWFuYWx5dGljcy5jb20vYW5hbHl0aWNzLmpzJywnZ2EnKTtcXG4gICAgICAgICAgXCIsIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQodCksIHUuaXNHQUFwcGVuZGVkID0gITAsIGUobnVsbCk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIG4oKTtcbiAgICAgICAgfSB9KSk7IH0gcmV0dXJuIHsgbmFtZTogXCJnYVNlcnZpY2VcIiwgZW1pdEV2ZW50OiBmdW5jdGlvbiAoZSkgeyBpZiAoZS5oaXRUeXBlID0gXCJldmVudFwiLCAhdS5pc1RyYWNrZXJBcHBlbmRlZClcbiAgICAgICAgICAgIHJldHVybiB5KFwic2VuZFwiLCBlKSwgdm9pZCBoKCk7IHUuaXNHQUVuYWJsZWQgJiYgKHdpbmRvdy5nYSAmJiB1LmlzVHJhY2tlckFwcGVuZGVkID8gKGQubGVuZ3RoICYmIGIoKSwgQyhcInNlbmRcIiwgZSkpIDogeShcInNlbmRcIiwgZSkpOyB9LCBlbWl0TWV0cmljc0V2ZW50OiBmdW5jdGlvbiAoZSkgeyBpZiAoZS5oaXRUeXBlID0gXCJ0aW1pbmdcIiwgIXUuaXNNZXRyaWNzVHJhY2tlckFwcGVuZGVkKVxuICAgICAgICAgICAgcmV0dXJuIGsoXCJzZW5kXCIsIGUpLCB2b2lkIGZ1bmN0aW9uICgpIHsgaWYgKGcpXG4gICAgICAgICAgICAgICAgcmV0dXJuOyBpZiAoZyA9ICEwLCBTKCksICF1Lm1ldHJpY3NHQUFjY291bnQpXG4gICAgICAgICAgICAgICAgcmV0dXJuIHZvaWQgbmV3IFByb21pc2UoKGZ1bmN0aW9uIChlLCBuKSB7IHQuY2FsbEFwaShcIi9hbm9uL2Fzc2V0cy9wZXJmb3JtYW5jZU1ldHJpY3NcIiwgbnVsbCwgKGZ1bmN0aW9uICh0KSB7IDAgPT09IHQuY29kZSA/IChQKHQucGVyZm9ybWFuY2VfbWV0cmljc19kdG8pLCBlKG51bGwpKSA6IG4oKTsgfSkpOyB9KSkudGhlbigoZnVuY3Rpb24gKCkgeyByZXR1cm4gVCgpOyB9KSkuY2F0Y2goKGZ1bmN0aW9uIChlKSB7IG4uZXJyb3IoXCJQTiBjYXRjaDogc29tZXRoaW5nIHZlbnQgd3Jvbmcgd2l0aCBHQSBpbmplY3Rpb246IFwiICsgZSk7IH0pKTsgVCgpLmNhdGNoKChmdW5jdGlvbiAoZSkgeyBuLmVycm9yKFwiUE4gY2F0Y2g6IHNvbWV0aGluZyB2ZW50IHdyb25nIHdpdGggR0EgaW5qZWN0aW9uOiBcIiArIGUpOyB9KSk7IH0oKTsgdS5pc01ldHJpY3NFbmFibGVkICYmICh3aW5kb3cuZ2EgJiYgdS5pc01ldHJpY3NUcmFja2VyQXBwZW5kZWQgPyAodi5sZW5ndGggJiYgXygpLCBJKFwic2VuZFwiLCBlKSkgOiBrKFwic2VuZFwiLCBlKSk7IH0sIGdldENsaWVudElkOiBmdW5jdGlvbiAoKSB7IHJldHVybiBlOyB9LCBnZXRHQUFjY291bnQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHUuZ2FBY2NvdW50OyB9LCBtZXRyaWNzVHJhY2tlckFwcGVuZGVkOiBmdW5jdGlvbiAoKSB7IHUuaXNNZXRyaWNzVHJhY2tlckFwcGVuZGVkID0gITAsIGcgPSAhMSwgXygpOyB9LCByZWNyZWF0ZVdpdGhDbGllbnRJZDogZnVuY3Rpb24gKG4pIHsgZSA9IG4sIGgoKTsgfSwgc2V0Q2xpZW50SWQ6IGZ1bmN0aW9uIChuKSB7IGUgPSBuOyB9LCBzZXRUcmFja2VyTmFtZTogZnVuY3Rpb24gKGUpIHsgdS50cmFja2VyTmFtZSA9IGU7IH0sIHRyYWNrZXJBcHBlbmRlZDogZnVuY3Rpb24gKCkgeyB1LmlzVHJhY2tlckFwcGVuZGVkID0gITAsIHIuYnJvYWRjYXN0KFwiZ2FBcHBlbmRlZFwiLCB7IGNsaWVudElkOiBlLCBnYUFjY291bnQ6IHUuZ2FBY2NvdW50IH0pLCBtID0gITEsIGIoKTsgfSB9OyB9KCk7XG4gICAgcG4uY29udGFpbmVyLnJlZ2lzdGVyKFwiZ2FTZXJ2aWNlXCIsIHsgdXNlVmFsdWU6IFZlIH0pLCBwbi5nYVNlcnZpY2UgPSBwbi5jb250YWluZXIucmVzb2x2ZShcImdhU2VydmljZVwiKTtcbiAgICB2YXIgcWUgPSBmdW5jdGlvbiAoZSkgeyB2b2lkIDAgPT09IGUgJiYgKGUgPSBwbi5jb250YWluZXIpOyB2YXIgbiwgdCwgciwgbywgaSwgYSA9IGUucmVzb2x2ZShcImNvb2tpZVwiKSwgcyA9IGUucmVzb2x2ZShcImpxVXRpbHNcIiksIGMgPSBlLnJlc29sdmUoXCJhamF4XCIpLCBsID0gZS5yZXNvbHZlKFwiand0RGVjb2RlXCIpLCB1ID0gZS5yZXNvbHZlKFwidXRpbFwiKSwgZCA9IGUucmVzb2x2ZShcImNvbnRhaW5lclV0aWxzXCIpLCBwID0gZS5yZXNvbHZlKFwicG9zdG1lc3NhZ2VcIiksIGYgPSBlLnJlc29sdmUoXCJsb2dcIiksIG0gPSBlLnJlc29sdmUoXCJvYnNlcnZlclwiKSwgZyA9IGUucmVzb2x2ZShcImdhU2VydmljZVwiKSwgdiA9IGUucmVzb2x2ZShcImFwaVwiKSwgaCA9IGUucmVzb2x2ZShcImxvZ2dpbmdcIiksIHcgPSBlLnJlc29sdmUoXCJsb2NhbFN0b3JhZ2VcIiksIHkgPSBcInBpYW5vX3NvY2lhbF90b2tlblwiLCBiID0gdS5nZXRBaWRTcGVjaWZpZWROYW1lKFwiX191dHBcIiksIGsgPSBcIl9fcGlsXCIsIF8gPSBcIl9fcGlkXCIsIEMgPSBcIl9faWRyXCIsIEkgPSBcIl9fZWVhXCIsIFMgPSBcIlBJQU5PSURcIiwgeCA9IFwic2hvd19mb3JtXCIsIFAgPSBcInJlZ2lzdHJhdGlvblwiLCBFID0gXCJjaGVja291dFwiLCBUID0gMzAwLCBBID0gXCJwbmlkLXRjLXN0cmluZ1wiLCBNID0gW1wiaGVfSUxcIiwgXCJhcl9FR1wiXSwgTyA9IHt9LCBSID0gW10sIEwgPSB7IGxvZ2dlZEluOiBbXSwgbG9nZ2VkT3V0OiBbXSwgbG9naW5TdWNjZXNzOiBbXSwgcmVnaXN0cmF0aW9uU3VjY2VzczogW10sIHByb2ZpbGVVcGRhdGU6IFtdLCBsYW5nQ2hhbmdlOiBbXSwgbGFuZ0NoYW5nZUZyb21JZnJhbWU6IHt9LCBmaXJlX2xvZ2luU3VjY2VzczogW10sIGxvZ2luRGlzcGxheWVkOiBbXSwgcmVnaXN0ZXJEaXNwbGF5ZWQ6IFtdLCBsb2dpbkZhaWxlZDogW10sIHJlZ2lzdHJhdGlvbkZhaWxlZDogW10sIG9uU2hvdzogW10sIGxheW91dFJlYWR5OiBbXSB9LCBOID0ge30sIFUgPSB7fSwgaiA9IFtdLCBEID0gITEsIEYgPSBbXCJHMThySUpXUTJHXCIsIFwiNDVMMkJhUzZwdVwiXTsgcy5vbih3aW5kb3csIFwicmVzaXplXCIsIChmdW5jdGlvbiAoKSB7IHJldHVybiBCKCk7IH0pKTsgdmFyIEIgPSBmdW5jdGlvbiAoZSkgeyBSLmZpbHRlcigoZnVuY3Rpb24gKGUpIHsgcmV0dXJuIFwiaW5saW5lXCIgPT09IGUuY29uZmlnLmRpc3BsYXlNb2RlOyB9KSkuZmlsdGVyKChmdW5jdGlvbiAobikgeyByZXR1cm4gIWUgfHwgZS5zb21lKChmdW5jdGlvbiAoZSkgeyByZXR1cm4gbi5jb250YWluZXIgPT09IGU7IH0pKTsgfSkpLmZvckVhY2goKGZ1bmN0aW9uIChlKSB7IHZhciBuID0gcy5nZXRXaWR0aChlLmNvbnRhaW5lcik7IGQucmVzaXplSWZyYW1lKGUsIHsgd2lkdGg6IG4gfSksIHAuc2VuZChcInJlc2l6ZVwiLCB7IHdpZHRoOiBuIH0sIGUuaWZyYW1lSWQpOyB9KSk7IH0sIFYgPSBmdW5jdGlvbiAoZSkgeyBpZiAociAmJiAhZSlcbiAgICAgICAgcmV0dXJuIHI7IHZhciBuOyBPID0gT2JqZWN0LmFzc2lnbih7fSwgZSksIHIgPSBuZXcgUHJvbWlzZSgoZnVuY3Rpb24gKGUpIHsgbiA9IGU7IH0pKSwgUWUoKSB8fCBwbi5zZXRVc2VQaWFub0lkVXNlclByb3ZpZGVyKCEwKSwgYWUoTyk7IHZhciB0ID0gdS5nZXRRdWVyeVBhcmFtQnlOYW1lKFwicmVzZXRfdG9rZW5cIik7IHZvaWQgMCA9PT0gTy5yZXNldFBhc3N3b3JkVG9rZW4gJiYgdCAmJiAoTy5yZXNldFBhc3N3b3JkVG9rZW4gPSB0KTsgdmFyIG8gPSB1LmdldFF1ZXJ5UGFyYW1CeU5hbWUoXCJwYXNzd29yZGxlc3NfdG9rZW5cIik7IHZvaWQgMCA9PT0gTy5wYXNzd29yZGxlc3NUb2tlbiAmJiBvICYmIChPLnBhc3N3b3JkbGVzc1Rva2VuID0gbyk7IHZhciBpID0gdS5nZXRRdWVyeVBhcmFtQnlOYW1lKFwidmVyaWZpY2F0aW9uX2NvZGVcIik7IHZvaWQgMCA9PT0gTy52ZXJpZmljYXRpb25fY29kZSAmJiBpICYmIChPLnZlcmlmaWNhdGlvbl9jb2RlID0gaSk7IHZhciBhID0gdS5nZXRRdWVyeVBhcmFtQnlOYW1lKHkpOyByZXR1cm4gYSAmJiAodS5yZW1vdmVRdWVyeVBhcmFtQnlOYW1lKHkpLCBPZSgpIHx8IChwbi5pbmFwcEJyb3dzZXJSZXR1cm4gPSAhMCwgZnVuY3Rpb24gKGUsIG4pIHsgdmFyIHQgPSBsKGUpOyB0LnJlbWVtYmVyTWUgPSAhIW4sIFNlKHsgdXNlcjogdCwgdG9rZW46IGUgfSk7IH0oYSwgITApKSksIHNldFRpbWVvdXQoKGZ1bmN0aW9uICgpIHsgcmV0dXJuIG4oKTsgfSksIDUwKSwgcjsgfSwgcSA9IGZ1bmN0aW9uIChlLCBuKSB7IGlmICh0ICYmICFlKVxuICAgICAgICByZXR1cm4gdDsgdmFyIHI7IHQgPSBuZXcgUHJvbWlzZSgoZnVuY3Rpb24gKGUpIHsgciA9IGU7IH0pKTsgdmFyIG8gPSBmdW5jdGlvbiAoKSB7IHUuZG9uZUNhbGwoXCJyZWZyZXNoVXNlclRva2VuXCIpLCB0ID0gbnVsbCwgcigpOyB9OyByZXR1cm4gZSAmJiBlLnByZXZpZXcgPyAoc2V0VGltZW91dCgoZnVuY3Rpb24gKCkgeyByZXR1cm4gcigpOyB9KSwgMTApLCB0KSA6ICh1LnN0YXJ0Q2FsbChcInJlZnJlc2hVc2VyVG9rZW5cIiksIFYoZSkudGhlbigoZnVuY3Rpb24gKCkgeyByZXR1cm4gTy5wYXNzd29yZGxlc3NUb2tlbiA/IEooKSA6IG4gPyBQcm9taXNlLnJlc29sdmUoKSA6IFJlKCk7IH0pKS50aGVuKG8sIG8pLCB0KTsgfSwgeiA9IGZ1bmN0aW9uIChlKSB7IHZhciB0ID0gIU9lKCk7IHEoKS50aGVuKChmdW5jdGlvbiAoKSB7IHZhciByID0gT2JqZWN0LmFzc2lnbih7fSwgTywgZSwgeyBpc1JlZ2lzdHJhdGlvbjogITAgfSksIG8gPSBPZSgpOyBvID8gKG5lKHIsIHsgZW1pdEdsb2JhbExvZ2luU3VjY2Vzc0V2ZW50OiB0ICYmIG8gfSksIEQgJiYgIVhlKCkgJiYgKGFlKGUpLCBzZShyKSwgX2UocikpKSA6IG4gPyAoYWUoZSksIHUubG9nKFwiTW9kYWwgbG9naW4gd2luZG93IGFscmVhZHkgc2hvd25cIikpIDogKGFlKGUpLCBzZShyKSwgX2UocikpOyBoLnNldFRpbWUoXCJpZFNob3dcIik7IH0pKTsgfSwgSCA9IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSBcImVtYWlsX2lzX25vdF9jb25maXJtZWRcIiwgbiA9IHUuZ2V0UXVlcnlQYXJhbUJ5TmFtZShlKTsgaWYgKG4pIHtcbiAgICAgICAgdS5yZW1vdmVRdWVyeVBhcmFtQnlOYW1lKGUpO1xuICAgICAgICB2YXIgdCA9IFwicmVnaXN0cmF0aW9uXCIgPT09IG4gPyBcImVtYWlsX2lzX25vdF9jb25maXJtZWRcIiA6IFwiZW1haWxfY29uZmlybWF0aW9uX3JlcXVpcmVkXCIsIHIgPSBUZSgpO1xuICAgICAgICBXKHsgc2NyZWVuOiB0LCBlbWFpbDogciAmJiByLmVtYWlsIH0pO1xuICAgIH0gfSwgVyA9IGZ1bmN0aW9uIChlKSB7IGlmIChuKVxuICAgICAgICB1LmxvZyhcIk1vZGFsIHdpbmRvdyBhbHJlYWR5IHNob3duXCIpO1xuICAgIGVsc2Uge1xuICAgICAgICBlIHx8IChlID0ge30pO1xuICAgICAgICB2YXIgdCA9IE9iamVjdC5hc3NpZ24oe30sIGUsIE8pO1xuICAgICAgICBlLmN1c3RvbUV2ZW50cyAmJiBcIm9iamVjdFwiID09IHR5cGVvZiBlLmN1c3RvbUV2ZW50cyAmJiAoTiA9IGUuY3VzdG9tRXZlbnRzKSwgc2UodCksIGFlKGUpLCBfZSh0KTtcbiAgICB9IH0sIEogPSBmdW5jdGlvbiAoKSB7IHJldHVybiBuZXcgUHJvbWlzZSgoZnVuY3Rpb24gKGUsIG4pIHsgYy5yZXF1ZXN0KHsgdXJsOiBoZSgpICsgXCJhcGkvdjEvaWRlbnRpdHkvcGFzc3dvcmRsZXNzL2F1dGhvcml6YXRpb24vY29kZVwiLCBkYXRhVHlwZTogXCJqc29ucFwiLCBkYXRhOiB7IGFpZDogTy5haWQgfHwgcG4uYWlkLCBwYXNzd29yZGxlc3NfdG9rZW46IE8ucGFzc3dvcmRsZXNzVG9rZW4gfSwgc3VjY2VzczogZnVuY3Rpb24gKHQpIHsgdC5lcnJvciA/IChRKHQpLCBuKCkpIDogKEcodCksIGUobnVsbCkpOyB9LCB4aHJGaWVsZHM6IHsgd2l0aENyZWRlbnRpYWxzOiAhMCB9LCBjcm9zc0RvbWFpbjogITAgfSk7IH0pKTsgfSwgRyA9IGZ1bmN0aW9uIChlKSB7ICFlLmVycm9yICYmIGUuYWNjZXNzX3Rva2VuICYmIChYKGUpLCBNZSh7IHNvdXJjZTogUywgdG9rZW46IGUuYWNjZXNzX3Rva2VuLCB1c2VyOiBsKGUuYWNjZXNzX3Rva2VuKSwgZXh0ZW5kRXhwaXJlZEFjY2Vzc0VuYWJsZWQ6IGUuZXh0ZW5kX2V4cGlyZWRfYWNjZXNzX2VuYWJsZWQgfSwgITEsICEwKSwgZGVsZXRlIE8ucGFzc3dvcmRsZXNzVG9rZW4sIHUucmVtb3ZlUXVlcnlQYXJhbUJ5TmFtZShcInBhc3N3b3JkbGVzc190b2tlblwiKSksIHUuZG9uZUNhbGwoXCJyZWZyZXNoVXNlclRva2VuXCIpOyB9LCBRID0gZnVuY3Rpb24gKGUpIHsgVyh7IHNjcmVlbjogXCJwYXNzd29yZGxlc3NfY29uZmlybWF0aW9uXCIsIGpzb25wRXJyb3I6IGUgfSksIGRlbGV0ZSBPLnBhc3N3b3JkbGVzc1Rva2VuLCB1LnJlbW92ZVF1ZXJ5UGFyYW1CeU5hbWUoXCJwYXNzd29yZGxlc3NfdG9rZW5cIik7IH0sIFggPSBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IHsgYWlkOiBPLmFpZCB8fCBwbi5haWQsIGxvZ2luX3Rva2VuX2lkOiBlLmxvZ2luX3Rva2VuX2lkLCB1c2VyX3Rva2VuOiBlLmFjY2Vzc190b2tlbiB9LCB0ID0geyBwYXNzd29yZGxlc3NUb2tlbjogZS5wYXNzd29yZGxlc3NfdG9rZW4sIHJlZGlyZWN0VXJpOiBlLmRpcmVjdGlvbl91cmwgfTsgJChuLCB0KTsgfSwgJCA9IGZ1bmN0aW9uIChlLCBuKSB7IGQuc2hvd1dhaXRQYW5lbCgpLCB2LmNhbGxBcGkoXCIvYW5vbi9wYXNzd29yZGxlc3MvY29tcGxldGVcIiwgZSwgKGZ1bmN0aW9uIChlKSB7IGlmIChlLnJlc3VsdCAmJiBlLnJlc3VsdC5wb2xsaW5nX2VuYWJsZWQpXG4gICAgICAgIHJldHVybiBZKGUpLnRoZW4oKGZ1bmN0aW9uIChlKSB7IFooZSwgbik7IH0pKTsgWihlLCBuKTsgfSkpOyB9LCBZID0gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIG5ldyBQcm9taXNlKChmdW5jdGlvbiAobikgeyB2YXIgdCA9IHsgYWlkOiBwbi5haWQsIG9pZDogZS5yZXN1bHQub2lkLCBwcm9jZXNzX2lkOiBlLnJlc3VsdC5wcm9jZXNzX2lkLCB1c2VyX3Rva2VuOiBwbi51c2VyLmdldFByb3ZpZGVyKCkuZ2V0VG9rZW4oKSB9OyBLKHQsIDAsIGUucmVzdWx0LnBvbGxpbmdfdGltZW91dHMsIG4pOyB9KSk7IH0sIEsgPSBmdW5jdGlvbiAoZSwgbiwgdCwgcikgeyB2LmNhbGxBcGkoXCIvYW5vbi9wYXNzd29yZGxlc3MvY2hlY2tcIiwgZSwgKGZ1bmN0aW9uIChvKSB7IG4rKywgbyAmJiBvLnJlc3VsdCAmJiBcIndhaXRpbmdcIiAhPT0gby5yZXN1bHQucG9sbF9zdGF0dXMgPyByKG8pIDogIW8ucmVzdWx0ICYmIG8ubWVzc2FnZSA/ICh1LmVycm9yKFwiUGFzc3dvcmRsZXNzIHB1cmNoYXNlIGZhaWxlZFwiLCBvLm1lc3NhZ2UpLCByKCkpIDogbiA8PSB0Lmxlbmd0aCA/IHNldFRpbWVvdXQoKGZ1bmN0aW9uICgpIHsgSyhlLCBuLCB0LCByKTsgfSksIHRbbiAtIDFdKSA6IHIoKTsgfSkpOyB9LCBaID0gZnVuY3Rpb24gKGUsIG4pIHsgdHJ5IHtcbiAgICAgICAgdmFyIHQgPSBlLnJlc3VsdC5yZXNvdXJjZSB8fCB7fSwgciA9IEpTT04ucGFyc2UoZS5yZXN1bHQuc2hvd19vZmZlcl9wYXJhbXMpLCBvID0gZWUobik7XG4gICAgICAgIGlmICghT2JqZWN0LmtleXModCkubGVuZ3RoICYmICFPYmplY3Qua2V5cyhyKS5sZW5ndGgpXG4gICAgICAgICAgICByZXR1cm4gVyhvKTtcbiAgICAgICAgbyA9IHQubmFtZSA/IGVlKG4sIHsgY3VzdG9tUGFyYW1zOiB7IHJlc291cmNlTmFtZTogdC5uYW1lIH0gfSkgOiBlZShuLCB7IGN1c3RvbUV2ZW50czogeyBjaGVja291dENvbnRpbnVlOiBmdW5jdGlvbiAoKSB7IENlKCksIGQuY2xvc2VNb2RhbENvbnRhaW5lcigpLCBwbi5vZmZlci5zaG93KHIpOyB9IH0gfSksIFcobyk7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIFcoZWUobikpO1xuICAgIH1cbiAgICBmaW5hbGx5IHtcbiAgICAgICAgZC5oaWRlV2FpdFBhbmVsKCk7XG4gICAgfSB9LCBlZSA9IGZ1bmN0aW9uIChlLCBuKSB7IHZhciB0ID0geyBzY3JlZW46IFwicGFzc3dvcmRsZXNzX2NvbmZpcm1hdGlvblwiIH07IHJldHVybiBlICYmICh0LnBhc3N3b3JkbGVzc1Rva2VuID0gZS5wYXNzd29yZGxlc3NUb2tlbiwgdC5yZWRpcmVjdFVyaSA9IGUucmVkaXJlY3RVcmkpLCBuID8gT2JqZWN0LmFzc2lnbih0LCBuKSA6IE9iamVjdC5hc3NpZ24odCwgeyBwYXNzd29yZGxlc3NTdWNjZXNzOiAhMCB9KTsgfSwgbmUgPSBmdW5jdGlvbiAoZSwgbikgeyBuID0gbiB8fCB7fTsgdmFyIHQgPSBUZSgpOyBpZiAodCkge1xuICAgICAgICB2YXIgciA9IHsgdG9rZW46IFBlKCksIHVzZXI6IHQsIHNvdXJjZTogbi5zb3VyY2UsIHN0YWdlOiBuLnN0YWdlIH0sIGkgPSB7IGV2ZW50OiBcImxvZ2luU3VjY2Vzc1wiLCBzb3VyY2U6IG4uc291cmNlLCBwYXJhbXM6IHIudXNlciwgdXNlcl90b2tlbjogci50b2tlbiwgcmVnaXN0cmF0aW9uOiBvLCBzdGFnZTogbi5zdGFnZSB9O1xuICAgICAgICBlID8gKGUubG9nZ2VkSW4gJiYgZS5sb2dnZWRJbihyKSwgbi5lbWl0R2xvYmFsTG9naW5TdWNjZXNzRXZlbnQgJiYgb2UoXCJsb2dpblN1Y2Nlc3NcIiwgaSkpIDogKHJlKFwibG9nZ2VkSW5cIiwgciksIHJlKFwibG9naW5TdWNjZXNzXCIsIHIpLCBuLnNvdXJjZSA9PT0gUyAmJiAocmUoXCJmaXJlX2xvZ2luU3VjY2Vzc1wiLCBpKSwgb2UoXCJsb2dpblN1Y2Nlc3NcIiwgaSkpKTtcbiAgICB9IH0sIHRlID0gZnVuY3Rpb24gKGUsIG4pIHsgaWUoeyBsb2dpbjogXCJsb2dpbkRpc3BsYXllZFwiLCByZWdpc3RlcjogXCJyZWdpc3RlckRpc3BsYXllZFwiIH1bZV0sIHt9LCBuKTsgfSwgcmUgPSBmdW5jdGlvbiAoZSwgbikgeyBMW2VdICYmIExbZV0uZm9yRWFjaCgoZnVuY3Rpb24gKGUpIHsgZShuKTsgfSkpOyB9LCBvZSA9IGZ1bmN0aW9uIChlLCBuKSB7IFVbZV0gJiYgVVtlXS5mb3JFYWNoKChmdW5jdGlvbiAoZSkgeyBlKG4pOyB9KSk7IH0sIGllID0gZnVuY3Rpb24gKGUsIG4sIHQpIHsgIXQgJiYgcmUoZSwgbiksIG9lKGUsIG4pOyB9LCBhZSA9IGZ1bmN0aW9uIChlKSB7IGUgJiYgT2JqZWN0LmtleXMoTCkuZm9yRWFjaCgoZnVuY3Rpb24gKG4pIHsgZVtuXSAmJiBMW25dLnB1c2goZVtuXSk7IH0pKTsgfSwgc2UgPSBmdW5jdGlvbiAoZSkgeyBlLmFpZCB8fCAoZS5haWQgPSBwbi5haWQpLCBlLmRpc3BsYXlNb2RlIHx8IChlLmRpc3BsYXlNb2RlID0gXCJtb2RhbFwiKSwgXCJwb3B1cFwiID09PSBlLmRpc3BsYXlNb2RlID8gKGUud2lkdGggPSBwYXJzZUludChlLndpZHRoKSB8fCBsZSgpLCBlLmhlaWdodCA9IHBhcnNlSW50KGUuaGVpZ2h0KSB8fCA0NjApIDogXCJtb2RhbFwiID09PSBlLmRpc3BsYXlNb2RlICYmIChlLndpZHRoID0gcGFyc2VJbnQoZS53aWR0aCkgfHwgbGUoKSksIGUuYWNjZXNzVG9rZW4gPSBQZSgpOyB9LCBjZSA9IGZ1bmN0aW9uIChlKSB7IFQgPSBlOyB9LCBsZSA9IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSB3aW5kb3cuaW5uZXJXaWR0aCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGggfHwgd2luZG93LnNjcmVlbi53aWR0aDsgcmV0dXJuIE1hdGgubWluKGUsIDQwMCk7IH0sIHVlID0gZnVuY3Rpb24gKGUsIG4sIHQpIHsgbyA9ICExLCBFZSgpLCB3LnJlbW92ZShBKSwgdS5zZXRBY2Nlc3NUb2tlbkxpc3RDb29raWUoeyB2YWx1ZTogbnVsbCB9LCB2b2lkIDAsICEwKSwgVWUoKS50aGVuKChmdW5jdGlvbiAoKSB7IHQgfHwgZnVuY3Rpb24gKGUpIHsgdmFyIG4gPSB7IHNvdXJjZTogZSB9OyByZShcImxvZ2dlZE91dFwiLCBuKSwgb2UoXCJsb2dvdXRcIiwgbik7IH0obiksIGUgJiYgZSgpOyB9KSksIFllKCk7IH07IGZ1bmN0aW9uIGRlKGUpIHsgcmV0dXJuIGZ1bmN0aW9uIChuKSB7IHZhciB0LCByLCBvID0gZS5jb25maWcudHJhY2tpbmdJZCwgaSA9IGUuY29uZmlnLmZvcm1OYW1lOyBzd2l0Y2ggKG4uZXZlbnQpIHtcbiAgICAgICAgY2FzZSBcImxvYWRlZFwiOlxuICAgICAgICAgICAgXCJtb2RhbFwiID09PSBlLmNvbmZpZy5kaXNwbGF5TW9kZSAmJiBkLmNoZWNrQmFja2Ryb3BBbmRDb250YWluZXIoZSwgITApLCBlLmNvbmZpZy5sb2FkZWRDYWxsYmFjayAmJiBlLmNvbmZpZy5sb2FkZWRDYWxsYmFjayhlKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwic3RhdGVSZWFkeVwiOlxuICAgICAgICAgICAgZS5jb25maWcucmVhZHlDYWxsYmFjayAmJiBlLmNvbmZpZy5yZWFkeUNhbGxiYWNrKGUpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJyZXNpemVcIjpcbiAgICAgICAgICAgIGQucmVzaXplSWZyYW1lKGUsIG4ucGFyYW1zKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwicmVzdG9yZVNpemVcIjpcbiAgICAgICAgICAgIFwiaW5saW5lXCIgPT09IGUuY29uZmlnLmRpc3BsYXlNb2RlICYmIGQucmVzaXplSWZyYW1lKGUsIHsgd2lkdGg6IHMuZ2V0V2lkdGgoZS5jb250YWluZXIpIH0pO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJsb2dpblN1Y2Nlc3NcIjpcbiAgICAgICAgICAgIHZlKG4sIChmdW5jdGlvbiAoKSB7IGUuY29uZmlnLmNhbGxiYWNrICYmIGUuY29uZmlnLmNhbGxiYWNrKCksIHBuLnVzZXIucmVmcmVzaEFjY2Vzc1Rva2VuKCEwKSwgcC5icm9hZGNhc3QoXCJwaWFub0lkTG9naW5TdWNjZXNzXCIsIG4ucGFyYW1zKTsgfSkpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJsb2dpbkZhaWxlZFwiOlxuICAgICAgICAgICAgaWUoXCJsb2dpbkZhaWxlZFwiLCBuLnBhcmFtcyk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcInJlZ2lzdHJhdGlvblN1Y2Nlc3NcIjpcbiAgICAgICAgICAgIHZlKG4sIChmdW5jdGlvbiAoKSB7IGllKFwicmVnaXN0cmF0aW9uU3VjY2Vzc1wiLCBuLnBhcmFtcyksIHAuYnJvYWRjYXN0KFwicGlhbm9JZExvZ2luU3VjY2Vzc1wiLCBuLnBhcmFtcyk7IH0pKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwicmVnaXN0cmF0aW9uRmFpbGVkXCI6XG4gICAgICAgICAgICBpZShcInJlZ2lzdHJhdGlvbkZhaWxlZFwiLCBuLnBhcmFtcyk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImxhbmdcIjpcbiAgICAgICAgICAgIEJlKG4ucGFyYW1zLmxhbmcsICEwKSwgR2Uobi5wYXJhbXMubGFuZywgZSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImN1c3RvbUV2ZW50XCI6XG4gICAgICAgICAgICB0ID0gZS5jb25maWcsIHIgPSBuLnBhcmFtcywgdCAmJiB0LmN1c3RvbUV2ZW50ICYmIHQuY3VzdG9tRXZlbnQociksIG9lKFwiY3VzdG9tRXZlbnRcIiwgcik7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImNsb3NlZFwiOlxuICAgICAgICAgICAgRGUoZSwgITApLCBlLmNvbmZpZy5jbG9zZWRDYWxsYmFjayAmJiBlLmNvbmZpZy5jbG9zZWRDYWxsYmFjayhlKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiY2ZGb3JtU3VibWlzc2lvblwiOlxuICAgICAgICAgICAgZi5fX3Byb3RlY3RlZF9fLmxvZ0N1c3RvbUZvcm1TdWJtaXNzaW9uKG8sIGksIHgpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJmb3JtU2VuZFwiOlxuICAgICAgICBjYXNlIFwiZm9ybVNraXBcIjpcbiAgICAgICAgICAgIERlKGUpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJjZkFwcEltcHJlc3Npb25cIjpcbiAgICAgICAgICAgIGYuX19wcm90ZWN0ZWRfXy5sb2dDdXN0b21Gb3JtSW1wcmVzc2lvbihvLCBpLCBQKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiY2ZBcHBTdWJtaXNzaW9uXCI6XG4gICAgICAgICAgICBmLl9fcHJvdGVjdGVkX18ubG9nQ3VzdG9tRm9ybVN1Ym1pc3Npb24obywgaSwgUCk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImNmRm9ybUltcHJlc3Npb25cIjpcbiAgICAgICAgICAgIGYuX19wcm90ZWN0ZWRfXy5sb2dDdXN0b21Gb3JtSW1wcmVzc2lvbihvLCBpLCB4KTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiY2hhbmdlU2NyZWVuXCI6XG4gICAgICAgICAgICB0ZShuLnBhcmFtcy5zY3JlZW4pO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJzY3JlZW5SZWFkeVwiOlxuICAgICAgICAgICAgaWUoXCJvblNob3dcIik7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImxheW91dFJlYWR5XCI6XG4gICAgICAgICAgICBpZShcImxheW91dFJlYWR5XCIsIG4ucGFyYW1zKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiY29uZmlybWF0aW9uRW1haWxTZW50XCI6XG4gICAgICAgICAgICBcImlubGluZVwiID09PSBlLmNvbmZpZy5kaXNwbGF5TW9kZSB8fCBuLnBhcmFtcy5pc0RPSSB8fCBuLnBhcmFtcy5pc1Bhc3N3b3JkbGVzc0RpZ2l0YWxDb2RlIHx8IERlKGUpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJ2ZXJpZmljYXRpb25Db2RlU3RhcnRDaGVja291dFwiOlxuICAgICAgICAgICAgdmFyIGEgPSB7fTtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgYSA9IEpTT04ucGFyc2Uobi5wYXJhbXMuc3RhcnRDaGVja291dFBhcmFtcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIHUubG9nKFwiZXJyb3IgcGFyc2Ugc3RhcnQgY2hlY2tvdXQgcGFyYW1zXCIpLCBhID0ge307XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBEZShlLCAhMCksIFJlKCEwLCAhMCksIHUud2FpdENhbGwoXCJyZWZyZXNoVXNlclRva2VuXCIsIChmdW5jdGlvbiAoKSB7IHBuLm9mZmVyLnNob3coYSk7IH0pKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwicmVtb3ZlUGFyYW1Gcm9tR2xvYmFsQ29uZmlnXCI6XG4gICAgICAgICAgICBmZShuKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwidmVyaWZ5Q29kZVwiOlxuICAgICAgICAgICAgbWUobiwgZSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcIm9wZW5QYXNzd29yZGxlc3NMb2dpbldpdGhDcmVhdGluZ1VzZXJcIjpcbiAgICAgICAgICAgIHBlKCk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImZpcmVDdXN0b21FdmVudFwiOlxuICAgICAgICAgICAgIWZ1bmN0aW9uIChlKSB7IE4gJiYgXCJmdW5jdGlvblwiID09IHR5cGVvZiBOW2VdICYmIE5bZV0oKTsgfShuLnBhcmFtcy5uYW1lKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwicGFzc3dvcmRSZXN0b3JlZFwiOlxuICAgICAgICAgICAgdS5yZW1vdmVRdWVyeVBhcmFtQnlOYW1lKFwicmVzZXRfdG9rZW5cIiksIE8ucmVzZXRQYXNzd29yZFRva2VuID0gdm9pZCAwO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJlbWl0R0FFdmVudFwiOlxuICAgICAgICAgICAgZy5lbWl0RXZlbnQobi5wYXJhbXMpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJyZWRpcmVjdFwiOlxuICAgICAgICAgICAgZG9jdW1lbnQubG9jYXRpb24uaHJlZiA9IG4ucGFyYW1zLnVybDtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiZGVzaWduVmVyc2lvblwiOlxuICAgICAgICAgICAgZC5hZGRDbGFzc1RvQ29udGFpbmVyKGUsIFwicGlhbm8taWQtbW9kYWwtdmVyLVwiICsgbi5wYXJhbXMudmVyc2lvbik7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcInByb2ZpbGVVcGRhdGVkXCI6XG4gICAgICAgICAgICByZShcInByb2ZpbGVVcGRhdGVcIiwgbi5wYXJhbXMpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJsb2dvdXRcIjpcbiAgICAgICAgICAgIHVlKCk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgZGVmYXVsdDogdS5kZWJ1ZyhcIlJlY2VpdmVkIGludmFsaWQgZXZlbnQgdHlwZTogXCIgKyBuLmV2ZW50KTtcbiAgICB9IH07IH0gdmFyIHBlID0gZnVuY3Rpb24gKCkgeyB6KHsgY3JlYXRlUGFzc3dvcmRsZXNzVXNlcjogITAgfSk7IH0sIGZlID0gZnVuY3Rpb24gKGUpIHsgdmFyIG4gPSBlLnBhcmFtcy5uYW1lLCB0ID0gdS5mcm9tVW5kZXJzY29yZVRvQ2FtZWxDYXNlKG4pOyBkZWxldGUgT1t0XSwgZS5wYXJhbXMucmVtb3ZlRnJvbVVybCAmJiB1LnJlbW92ZVF1ZXJ5UGFyYW1CeU5hbWUobik7IH0sIG1lID0gZnVuY3Rpb24gKGUsIG4pIHsgdmFyIHQgPSBlLnBhcmFtcy52ZXJpZmljYXRpb25Db2RlLCByID0gZS5wYXJhbXMubG9jYWxlLCBvID0gTy5haWQgfHwgcG4uYWlkLCBpID0gQWUoKSwgYSA9IGRvY3VtZW50LmxvY2F0aW9uLmhyZWY7IGMucmVxdWVzdCh7IHVybDogaGUoKSArIFwiYXBpL3YxL2lkZW50aXR5L3ZlcmlmaWNhdGlvbi9jb2RlXCIsIGRhdGFUeXBlOiBcImpzb25wXCIsIGRhdGE6IHsgY2xpZW50X2lkOiBvLCBhY2Nlc3NfdG9rZW46IGksIHNpdGU6IGEsIHZlcmlmaWNhdGlvbl9jb2RlOiB0LCBsYW5nOiByIH0sIHN1Y2Nlc3M6IGZ1bmN0aW9uIChlKSB7IGUuZXJyb3IgfHwgZ2UoZSwgbik7IH0sIHhockZpZWxkczogeyB3aXRoQ3JlZGVudGlhbHM6ICEwIH0sIGNyb3NzRG9tYWluOiAhMCB9KTsgfSwgZ2UgPSBmdW5jdGlvbiAoZSwgbikgeyAhZS5lcnJvciAmJiBlLmFjY2Vzc190b2tlbiAmJiBTZSh7IHRva2VuOiBlLmFjY2Vzc190b2tlbiwgdXNlcjogbChlLmFjY2Vzc190b2tlbiksIGNvb2tpZV9kb21haW46IGUuc2l0ZV9jb29raWVfZG9tYWluIH0pLCBwLnNlbmQoXCJ2ZXJpZmljYXRpb25Db2RlQ29tcGxldGVcIiwgZSwgbi5pZnJhbWVJZCk7IH0sIHZlID0gZnVuY3Rpb24gKGUsIG4pIHsgZSAmJiBlLnBhcmFtcyAmJiAhZS5wYXJhbXMuYXJlQ29va2llc1NldCA/IChlLnBhcmFtcy5zb3VyY2UgPSBTLCBvID0gISFlLnBhcmFtcy5yZWdpc3RyYXRpb24sIE1lKGUucGFyYW1zKS50aGVuKChmdW5jdGlvbiAoZSkgeyBuKGUpOyB9KSkpIDogXCJmdW5jdGlvblwiID09IHR5cGVvZiBuICYmIG4oKSwgJGUoKTsgfSwgaGUgPSBmdW5jdGlvbiAoKSB7IHJldHVybiBmdW5jdGlvbiAoKSB7IHZhciBlID0gcG4uc2FuZGJveCB8fCBwbi5pc05vblByb2RFbmRwb2ludCgpLCBuID0gTy5pZnJhbWVVcmwgfHwgcG4ucGlhbm9JZFVybCB8fCAhZSAmJiBcImh0dHBzOi8vaWQudGlueXBhc3MuY29tXCIgfHwgXCIvXCI7IHJldHVybiBcIi9cIiA9PT0gbiAmJiAobiA9IHBuLmdldEVuZHBvaW50Um9vdCghMCkpLCBuLnJlcGxhY2UoL1xcLyQvLCBcIlwiKTsgfSgpICsgXCIvaWQvXCI7IH0sIHdlID0gZnVuY3Rpb24gKCkgeyB2YXIgZSA9IE8uYWlkIHx8IHBuLmFpZDsgcmV0dXJuIEYuaW5kZXhPZihlKSA+PSAwOyB9LCBiZSA9IGZ1bmN0aW9uIChlLCBuLCB0LCByKSB7IGUubWF0Y2goXCJwcm94eS5odG1sXCIpIHx8IChlICs9IHdlKCkgPyBcImluZGV4My5odG1sXCIgOiBcIlwiKTsgdmFyIG8gPSB7IGNsaWVudF9pZDogbi5haWQsIHNlbmRlcjogdC5pZnJhbWVJZCwgb3JpZ2luOiByIHx8IHdpbmRvdy5sb2NhdGlvbi5vcmlnaW4gfHwgd2luZG93LmxvY2F0aW9uLmhyZWYsIHNpdGU6IHdpbmRvdy5sb2NhdGlvbi5ocmVmLCBkaXNwbGF5X21vZGU6IG4uZGlzcGxheU1vZGUsIHBhZ2VWaWV3SWQ6IHBuLm1haW4uZmV0Y2hQYWdlVmlld0lkKCksIHRiYzogdS5nZXRUYmNDb29raWUoKSB9LCBpID0gVmUoKTsgaWYgKGkgJiYgKG8ubGFuZyA9IGkpLCBnLmdldENsaWVudElkKCkgJiYgKG8uZ2FfY2xpZW50X2lkID0gZy5nZXRDbGllbnRJZCgpKSwgZy5nZXRHQUFjY291bnQoKSAmJiAoby5nYSA9IGcuZ2V0R0FBY2NvdW50KCkpLCBuLmRpc2FibGVTaWduVXAgJiYgKG8uZGlzYWJsZV9zaWduX3VwID0gITApLCBuLnNjcmVlbiAmJiAoby5zY3JlZW4gPSBuLnNjcmVlbiksIG4ucmVzZXRQYXNzd29yZFRva2VuICYmIChvLnJlc2V0ID0gbi5yZXNldFBhc3N3b3JkVG9rZW4pLCBuLnZlcmlmaWNhdGlvbl9jb2RlICYmIChvLnZlcmlmaWNhdGlvbl9jb2RlID0gbi52ZXJpZmljYXRpb25fY29kZSksIG4uc3RhZ2UgJiYgKG8uc3RhZ2UgPSBuLnN0YWdlKSwgbi5yZXNldFBhc3N3b3JkTGFuZGluZ1VybCAmJiAoby5yZXNldF91cmkgPSBuLnJlc2V0UGFzc3dvcmRMYW5kaW5nVXJsKSwgbi53aWR0aCAmJiBcIm1vZGFsXCIgPT09IG4uZGlzcGxheU1vZGUgJiYgKG8ud2lkdGggPSBuLndpZHRoKSwgbi5mb3JtTmFtZSAmJiAoby5mb3JtX25hbWUgPSBuLmZvcm1OYW1lKSwga2UobiwgZSkgJiYgKGUgKz0gXCJmb3JtXCIpLCBcInByb2ZpbGVcIiA9PT0gbi50ZW1wbGF0ZSAmJiAoZSArPSBcInByb2ZpbGVcIiksIG4uaGlkZUlmQ29tcGxldGUgJiYgKG8uaGlkZV9pZl9jb21wbGV0ZSA9IG4uaGlkZUlmQ29tcGxldGUpLCBuLnByZXZpZXcgJiYgKG8ucHJldmlldyA9IG4ucHJldmlldyksIG4udGVtcGxhdGVWZXJzaW9uICYmIChvLnRlbXBsYXRlVmVyc2lvbiA9IG4udGVtcGxhdGVWZXJzaW9uKSwgbi50ZW1wbGF0ZSAmJiAoby50ZW1wbGF0ZSA9IG4udGVtcGxhdGUpLCBuLmFjY2Vzc1Rva2VuICYmIChvLmFjY2Vzc190b2tlbiA9IG4uYWNjZXNzVG9rZW4pLCBuLmVtYWlsICYmIChvLmVtYWlsID0gbi5lbWFpbCksIG4uc2luZ2xlU3RlcCAmJiAoby5zaW5nbGVfc3RlcCA9ICEwKSwgbi5jcmVhdGVQYXNzd29yZGxlc3NVc2VyICYmIChvLmNyZWF0ZV9wYXNzd29yZGxlc3NfdXNlciA9ICEwKSwgbi5jdXN0b21QYXJhbXMgJiYgKG8uY3VzdG9tX3BhcmFtcyA9IEpTT04uc3RyaW5naWZ5KG4uY3VzdG9tUGFyYW1zKSksIG4uY3VzdG9tRXZlbnRzKSB7XG4gICAgICAgIHZhciBhID0gW107XG4gICAgICAgIE9iamVjdC5rZXlzKG4uY3VzdG9tRXZlbnRzKS5mb3JFYWNoKChmdW5jdGlvbiAoZSkgeyBhLnB1c2goZSk7IH0pKSwgYS5sZW5ndGggJiYgKG8uY3VzdG9tX2V2ZW50cyA9IEpTT04uc3RyaW5naWZ5KGEpKTtcbiAgICB9IHJldHVybiBuLmpzb25wRXJyb3IgJiYgKG8uanNvbnBfZXJyb3IgPSBKU09OLnN0cmluZ2lmeShuLmpzb25wRXJyb3IpKSwgbi5wYXNzd29yZGxlc3NTdWNjZXNzICYmIChvLnBhc3N3b3JkbGVzc19zdWNjZXNzID0gITApLCBuLnBhc3N3b3JkbGVzc1Rva2VuICYmIChvLnBhc3N3b3JkbGVzc190b2tlbiA9IG4ucGFzc3dvcmRsZXNzVG9rZW4pLCBuLnJlZGlyZWN0VXJpICYmIChvLnJlZGlyZWN0X3VyaSA9IG4ucmVkaXJlY3RVcmkpLCB0LmlmcmFtZVVybCAmJiAoby51cmwgPSB0LmlmcmFtZVVybCksIG4ucmV0dXJuQmFjayAmJiAoby5yZXR1cm5fYmFjayA9IG4ucmV0dXJuQmFjayksIHQucG9zICYmIChvLndpZHRoID0gdC5wb3Mud2lkdGgsIG8uaGVpZ2h0ID0gdC5wb3MuaGVpZ2h0LCBvLnRvcCA9IHQucG9zLnRvcCwgby5sZWZ0ID0gdC5wb3MubGVmdCksIG4udGVtcGxhdGVJZCAmJiAoby50ZW1wbGF0ZV9pZCA9IG4udGVtcGxhdGVJZCksIG4udmFyaWFudElkICYmIChvLnZhcmlhbnRfaWQgPSBuLnZhcmlhbnRJZCksIFtlLCBzLnBhcmFtKG8pXS5qb2luKFwiP1wiKTsgfSwga2UgPSBmdW5jdGlvbiAoZSwgbikgeyB2YXIgdCA9IHdlKCksIHIgPSAhZS5pc1JlZ2lzdHJhdGlvbiwgbyA9ICEvXFwuaHRtbCQvLnRlc3QobikgfHwgdDsgcmV0dXJuIGUuZm9ybU5hbWUgJiYgbyAmJiByOyB9LCBfZSA9IGZ1bmN0aW9uIChlKSB7IHZhciB0ID0gcy5xdWVyeUVsKGUuY29udGFpbmVyU2VsZWN0b3IpLCByID0gXCJwaWFuby1pZC1cIiArIChlLmlzUmVnaXN0cmF0aW9uID8gXCJcIiA6IFwiZm9ybS1cIikgKyB1LnJhbmRvbVN0cmluZygpOyBlLnNpbmdsZUNvbnRhaW5lciA9IHQ7IHZhciBvLCBpLCBhLCBjID0geyBpZnJhbWVJZDogciwgY29udGFpbmVyU2VsZWN0b3I6IGUuY29udGFpbmVyU2VsZWN0b3IsIHdpZHRoOiBlLndpZHRoLCBoZWlnaHQ6IGUuaGVpZ2h0IH0sIGwgPSBiZShoZSgpLCBlLCBjKSwgZiA9IGhlKCksIGcgPSAhMDsgaWYgKGUuaWZyYW1lUGFyYW1zID0gYywgXCJpbmxpbmVcIiA9PT0gZS5kaXNwbGF5TW9kZSkge1xuICAgICAgICB2YXIgdiA9IGQuaW5pdElubGluZUNvbnRhaW5lcihlKTtcbiAgICAgICAgaWYgKCEobyA9IHYuY29udGFpbmVyKSlcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgaSA9IGQuZ2VuZXJhdGVJZnJhbWUoZSwgYywgbCksIGcgPSAhIXYuY29udGFpbmVyUmVhZHksIGUub2JzZXJ2ZUNvbnRhaW5lciAmJiAoYSA9IG0uY3JlYXRlKG8sIEIpKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoXCJtb2RhbFwiID09PSBlLmRpc3BsYXlNb2RlKVxuICAgICAgICBvID0gZC5nZXRNb2RhbENvbnRhaW5lcihlLCAoZnVuY3Rpb24gKCkgeyByZXR1cm4gRGUobik7IH0pKSwgaSA9IGQuZ2VuZXJhdGVJZnJhbWUoZSwgYywgbCk7XG4gICAgZWxzZSBpZiAoXCJwb3B1cFwiID09PSBlLmRpc3BsYXlNb2RlKVxuICAgICAgICBpZiAodS5pc0lFKCkpIHtcbiAgICAgICAgICAgIG8gPSBkLmdlbmVyYXRlSWZyYW1lV3JhcHBlcigpLCBsID0gYmUoaGUoKSwgZSwgYywgaGUoKSArIFwicHJveHkuaHRtbFwiKSwgYy5pZnJhbWVVcmwgPSBsLCBjLnBvcyA9IGQuZ2V0UG9wdXBQb3NpdGlvbihjKTtcbiAgICAgICAgICAgIHZhciBoID0gYmUoaGUoKSArIFwicHJveHkuaHRtbFwiLCBlLCBjKTtcbiAgICAgICAgICAgIGUuZGlzcGxheU1vZGUgPSBcImlubGluZVBvcHVwXCIsIGkgPSBkLmdlbmVyYXRlSWZyYW1lKHt9LCBjLCBoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIG8gPSBkLmdlbmVyYXRlUG9wdXAoYywgbCk7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIGkgPSBvLmRvY3VtZW50O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgICAgICBpID0gbztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIGkgPSB3aW5kb3cuZG9jdW1lbnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gdmFyIHcgPSB7IGlmcmFtZUlkOiBjLmlmcmFtZUlkLCBjb25maWc6IGUsIGVsZW1lbnQ6IGksIGNvbnRhaW5lcjogbywgaWZyYW1lUGFyYW1zOiBjLCBjb250YWluZXJSZWFkeTogZyB9LCB5ID0geyBjZW50ZXI6IHUuY2VudGVyU2NyZWVuKCksIG9yaWdpblVybDogZG9jdW1lbnQubG9jYXRpb24uaHJlZiB9OyBpZiAocC5pbml0KHsgcG9zdE1lc3NhZ2VVcmw6IGYsIHJlY2VpdmU6IGRlKHcpLCBpZnJhbWU6IHcsIGlmcmFtZVBhcmFtczogYyB9LCB5KSwgXCJpbmxpbmVcIiA9PT0gZS5kaXNwbGF5TW9kZSkge1xuICAgICAgICB2YXIgYiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgIHMuYWRkQ2xhc3MoXCJwaWFuby1pZC1jb250YWluZXJcIiwgYiksIHMuYXBwZW5kKGIsIGkpLCBzLmFwcGVuZChvLCBiKTtcbiAgICB9XG4gICAgZWxzZVxuICAgICAgICBcIm1vZGFsXCIgPT09IGUuZGlzcGxheU1vZGUgPyBzLmFwcGVuZChvLCBpKSA6IFwiaW5saW5lUG9wdXBcIiA9PT0gZS5kaXNwbGF5TW9kZSAmJiAocy5hcHBlbmQobywgaSksIHMuYXBwZW5kKGRvY3VtZW50LmJvZHksIG8pKTsgaWYgKHUuZGVidWcoXCJjcmVhdGluZyBpZnJhbWU6IFwiLCBlKSwgUi5wdXNoKHcpLCBcIm1vZGFsXCIgPT09IGUuZGlzcGxheU1vZGUpIHtcbiAgICAgICAgKG4gPSB3KS5vYnNlcnZlciA9IGEsICh1LmlzSXBob25lKCkgfHwgdS5pc1NhZmFyaU9ySU9zVWlXZWJWaWV3KCkgfHwgdS5pc0FuZHJvaWQoKSkgJiYgZC5fX3ByaXZhdGVfXy5tb2JpbGVNb2RhbEZpeC5tb2RhbE9wZW5lZCgpO1xuICAgICAgICB2YXIgayA9IFZlKCk7XG4gICAgICAgIEdlKGssIHcpO1xuICAgIH0gcmV0dXJuIHc7IH0sIENlID0gZnVuY3Rpb24gKGUpIHsgaWYgKG4pIHtcbiAgICAgICAgdmFyIHQgPSBkLl9fcHJpdmF0ZV9fLm1vYmlsZU1vZGFsRml4O1xuICAgICAgICBkLmNsb3NlTW9kYWwobiksIHMucmVtb3ZlKG4uZWxlbWVudCksIG4ub2JzZXJ2ZXIgJiYgbi5vYnNlcnZlci5kaXNjb25uZWN0KCksIHQuaXNJcGhvbmVDYXJldEZpeGVkICYmIHQubW9kYWxDbG9zZWQoKSwgbiA9IHZvaWQgMDtcbiAgICB9IH0sIEllID0gZnVuY3Rpb24gKGUpIHsgdmFyIG4gPSB7IHBhdGg6IFwiL1wiIH0sIHQgPSB1Ll9fcHJvdGVjdGVkX18uZ2V0Q29va2llKF8pLCByID0gdS5leHRyYWN0Q29va2llRG9tYWluKGUgfHwgdCk7IHJldHVybiByICYmIChuLmRvbWFpbiA9IHIpLCAocG4uY29va2llRG9tYWluIHx8IHBuLmNvb2tpZVBhdGgpICYmIChuLmRvbWFpbiA9IHBuLmNvb2tpZURvbWFpbiA/IHBuLmNvb2tpZURvbWFpbiA6IG4uZG9tYWluLCBuLnBhdGggPSBwbi5jb29raWVQYXRoID8gcG4uY29va2llUGF0aCA6IG4ucGF0aCksIG47IH0sIFNlID0gZnVuY3Rpb24gKGUpIHsgaWYgKGUgJiYgZS51c2VyICYmIGUudG9rZW4pIHtcbiAgICAgICAgRWUobnVsbCwgITAsICEwKTtcbiAgICAgICAgdmFyIG4gPSBJZShlLmNvb2tpZV9kb21haW4pO1xuICAgICAgICBlLmV4dGVuZEV4cGlyZWRBY2Nlc3NFbmFibGVkICYmIHhlKGUuZXh0ZW5kRXhwaXJlZEFjY2Vzc0VuYWJsZWQsIGUuY29va2llX2RvbWFpbiksIChlLnVzZXIucmVtZW1iZXJNZSB8fCBIZSgpKSAmJiAobi5leHBpcmVzID0gbmV3IERhdGUoMWUzICogZS51c2VyLmV4cCksIHFlKG4pKTtcbiAgICAgICAgdmFyIHQgPSB1LmdldFBvc3NpYmxlQ29va2llRG9tYWlucygpO1xuICAgICAgICBmb3IgKHZhciByIGluIHQpXG4gICAgICAgICAgICB1LmRlbGV0ZUNvb2tpZShiLCB0W3JdKTtcbiAgICAgICAgdS5fX3Byb3RlY3RlZF9fLnNldENvb2tpZShiLCBlLnRva2VuLCBuKSwgZS5jb29raWVfZG9tYWluICYmIChuLmV4cGlyZXMgPSAzMCwgdS5fX3Byb3RlY3RlZF9fLnNldENvb2tpZShfLCBlLmNvb2tpZV9kb21haW4sIG4pKTtcbiAgICB9IH0sIHhlID0gZnVuY3Rpb24gKGUsIG4pIHsgSmUoXCJzZXRFeHRlbmRFeHBpcmVkQWNjZXNzXCIsIGUsIFwiYnJvYWRjYXN0XCIpOyB2YXIgdCA9IEllKG4pOyB0LmV4cGlyZXMgPSAzMCwgdS5fX3Byb3RlY3RlZF9fLnNldENvb2tpZShJLCBlID8gXCJ0cnVlXCIgOiBcImZhbHNlXCIsIHQpOyB9LCBQZSA9IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSB1LmZpbmRDb29raWVCeU5hbWUoYik7IHJldHVybiBlIHx8IG51bGw7IH0sIEVlID0gZnVuY3Rpb24gKGUsIG4sIHQpIHsgdmFyIHIgPSBJZSgpLCBvID0gdS5nZXRQb3NzaWJsZUNvb2tpZURvbWFpbnMoci5kb21haW4pOyBlICYmIHUuX19wcm90ZWN0ZWRfXy5sb2dSZW1vdmVUb2tlbnMoZSksIG8uZm9yRWFjaCgoZnVuY3Rpb24gKGUpIHsgdmFyIG8gPSB5ZSh5ZSh7fSwgciksIHsgZG9tYWluOiBlIH0pOyBhLnJlbW92ZShiLCBvKSwgdCB8fCBhLnJlbW92ZShJLCBvKSwgbiB8fCB6ZShvKTsgfSkpOyB9LCBUZSA9IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSBudWxsLCBuID0gUGUoKTsgaWYgKG4pXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBpZiAoZSA9IGwobikpIHtcbiAgICAgICAgICAgICAgICBlLmZpcnN0TmFtZSA9IGUuZ2l2ZW5fbmFtZSwgZS5sYXN0TmFtZSA9IGUuZmFtaWx5X25hbWUsIGUudmFsaWQgPSAhMCwgZS51aWQgPSBlLnN1YiwgZS5jb25maXJtZWQgPSAhZS5lbWFpbF9jb25maXJtYXRpb25fcmVxdWlyZWQ7XG4gICAgICAgICAgICAgICAgdmFyIHQgPSBuZXcgRGF0ZTtcbiAgICAgICAgICAgICAgICBuZXcgRGF0ZSgxZTMgKiBlLmV4cCkgPCB0ICYmICh1LmxvZyhcIlJlbW92aW5nIGV4cGlyZWQgdG9rZW5zXCIpLCBFZShuKSwgZSA9IG51bGwpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7IH0gcmV0dXJuIGU7IH0sIEFlID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gcG4uZXh0ZXJuYWxKV1QgJiYgUWUoKSA/IHBuLmV4dGVybmFsSldUIDogUGUoKTsgfSwgTWUgPSBmdW5jdGlvbiAoZSwgbiwgdCkgeyBTZShlKTsgdmFyIHIgPSBqZShlKS50aGVuKChmdW5jdGlvbiAoKSB7ICFuICYmIG5lKG51bGwsIHsgc3RhZ2U6IGUuc3RhZ2UsIHNvdXJjZTogZS5zb3VyY2UgfSk7IH0pKTsgaWYgKCEodCA9IHQgfHwgZS53aXRob3V0Q2xvc2VNb2RhbCkpIHtcbiAgICAgICAgdmFyIG8gPSBlICYmIGUudXNlciAmJiBlLnVzZXIuZW1haWxfY29uZmlybWF0aW9uX3JlcXVpcmVkLCBpID0gTy52ZXJpZmljYXRpb25fY29kZTtcbiAgICAgICAgbyB8fCBpID8gZC5oaWRlQ2xvc2VCdXR0b24oKSA6IEZlKCk7XG4gICAgfSByZXR1cm4gcjsgfSwgT2UgPSBmdW5jdGlvbiAoKSB7IHJldHVybiBRZSgpID8gISFwbi5leHRlcm5hbEpXVCA6ICEhVGUoKTsgfSwgUmUgPSBmdW5jdGlvbiAoZSwgbikgeyByZXR1cm4gbmV3IFByb21pc2UoKGZ1bmN0aW9uICh0LCByKSB7IHUuc3RhcnRDYWxsKFwicmVmcmVzaFVzZXJUb2tlblwiKTsgdmFyIG8gPSBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IHZvaWQgMCA9PT0gZSA/IHt9IDogZSwgbyA9IG4uaXNTdWNjZXNzZnVsLCBpID0gbi5nbVNTT0VuYWJsZWQ7IG8gPyB0KG51bGwpIDogcigpLCB1LmRvbmVDYWxsKFwicmVmcmVzaFVzZXJUb2tlblwiKSwgbyAmJiAoRCA9IGkpICYmICFYZSgpICYmIHooeyBzY3JlZW46IFwic3NvX2NvbmZpcm1cIiB9KTsgfSwgaSA9IGZ1bmN0aW9uICh0KSB7ICF0LmVycm9yICYmIHQuYWNjZXNzX3Rva2VuID8gTWUoeyB0b2tlbjogdC5hY2Nlc3NfdG9rZW4sIHVzZXI6IGwodC5hY2Nlc3NfdG9rZW4pLCBjb29raWVfZG9tYWluOiB0LnNpdGVfY29va2llX2RvbWFpbiwgZXh0ZW5kRXhwaXJlZEFjY2Vzc0VuYWJsZWQ6IHQuZXh0ZW5kX2V4cGlyZWRfYWNjZXNzX2VuYWJsZWQgfSwgZSwgbikudGhlbigoZnVuY3Rpb24gKCkgeyByZXR1cm4gbyh7IGlzU3VjY2Vzc2Z1bDogITAsIGdtU1NPRW5hYmxlZDogdC5hdXRob3JpemVkX2J5X3NzbyB9KTsgfSkpIDogKEVlKEFlKCkpLCBvKHsgaXNTdWNjZXNzZnVsOiAhMSB9KSk7IH0sIGEgPSBBZSgpIHx8IHZvaWQgMCwgcyA9IHsgY2xpZW50X2lkOiBPLmFpZCB8fCBwbi5haWQsIHNpdGU6IGRvY3VtZW50LmxvY2F0aW9uLm9yaWdpbiB8fCBkb2N1bWVudC5sb2NhdGlvbi5ocmVmIH0sIGQgPSBMZSgpOyBkICYmIChzLnRjZiA9IGQpLCBhID8gYy5yZXF1ZXN0KHsgdXJsOiBoZSgpICsgXCJhcGkvdjEvaWRlbnRpdHkvdG9rZW4vdmFsaWRhdGlvblwiLCBkYXRhOiBzLCBoZWFkZXJzOiB7IEF1dGhvcml6YXRpb246IGEgfSwgc3VjY2VzczogZnVuY3Rpb24gKGUpIHsgaShlKSwgZS5hY2Nlc3NfdG9rZW4gJiYgTmUoZCk7IH0sIGVycm9yOiBvIH0pIDogYy5yZXF1ZXN0KHsgdXJsOiBoZSgpICsgXCJhcGkvdjEvaWRlbnRpdHkvdG9rZW4vdmVyaWZ5XCIsIGRhdGE6IHMsIHN1Y2Nlc3M6IGZ1bmN0aW9uIChlKSB7IGkoZSksIGUuYWNjZXNzX3Rva2VuICYmIE5lKGQpOyB9LCBlcnJvcjogbywgZGF0YVR5cGU6IFwianNvbnBcIiwgeGhyRmllbGRzOiB7IHdpdGhDcmVkZW50aWFsczogITAgfSwgY3Jvc3NEb21haW46ICEwIH0pLCBzZXRUaW1lb3V0KG8sIDEwICogVCk7IH0pKTsgfSwgTGUgPSBmdW5jdGlvbiAoKSB7IHZhciBlLCBuID0gd2luZG93OyByZXR1cm4gZnVuY3Rpb24gKGUpIHsgaWYgKCFlKVxuICAgICAgICByZXR1cm4gITE7IHZhciBuID0gZTsgaWYgKCFuIHx8ICFuLnRjU3RyaW5nIHx8ICFuLmRhdGUpXG4gICAgICAgIHJldHVybiAhMTsgdmFyIHQgPSBuZXcgRGF0ZSwgciA9IG5ldyBEYXRlKG4uZGF0ZSksIG8gPSBNYXRoLmFicyhyLmdldFRpbWUoKSAtIHQuZ2V0VGltZSgpKTsgcmV0dXJuIE1hdGguY2VpbChvIC8gODY0ZTUpIDw9IDE7IH0ody5nZXQoQSkpID8gbnVsbCA6IChlID0gbnVsbCwgbi5fX3RjZmFwaSAmJiBuLl9fdGNmYXBpKFwiZ2V0VENEYXRhXCIsIDIsIChmdW5jdGlvbiAobiwgdCkgeyB0ICYmIG4udGNTdHJpbmcgJiYgKGUgPSBuLnRjU3RyaW5nKTsgfSksIFs0MTJdKSwgZSk7IH0sIE5lID0gZnVuY3Rpb24gKGUpIHsgaWYgKGUpIHtcbiAgICAgICAgdmFyIG4gPSB7IGRhdGU6IChuZXcgRGF0ZSkudG9TdHJpbmcoKSwgdGNTdHJpbmc6IGUgfTtcbiAgICAgICAgdy5zZXQoQSwgSlNPTi5zdHJpbmdpZnkobikpO1xuICAgIH0gfSwgVWUgPSBmdW5jdGlvbiAoKSB7IHJldHVybiBuZXcgUHJvbWlzZSgoZnVuY3Rpb24gKGUpIHsgYy5yZXF1ZXN0KHsgdXJsOiBoZSgpICsgXCJhcGkvdjEvaWRlbnRpdHkvbG9nb3V0XCIsIGRhdGE6IHsgY2xpZW50X2lkOiBPLmFpZCB8fCBwbi5haWQgfSwgZGF0YVR5cGU6IFwianNvbnBcIiwgY29tcGxldGU6IGUsIHhockZpZWxkczogeyB3aXRoQ3JlZGVudGlhbHM6ICEwIH0sIGNyb3NzRG9tYWluOiAhMCB9KSwgc2V0VGltZW91dChlLCBUKTsgfSkpOyB9LCBqZSA9IGZ1bmN0aW9uIChlKSB7IHJldHVybiBuZXcgUHJvbWlzZSgoZnVuY3Rpb24gKG4pIHsgdmFyIHQgPSAhKGUgJiYgZS51c2VyICYmIGUudXNlci5yZW1lbWJlck1lIHx8IEhlKCkpOyBjLnJlcXVlc3QoeyB1cmw6IGhlKCkgKyBcImFwaS92MS9pZGVudGl0eS92eGF1dGgvY29va2llXCIsIGRhdGE6IHsgY2xpZW50X2lkOiBPLmFpZCB8fCBwbi5haWQsIHNlc3Npb25fY29va2llOiB0IH0sIGhlYWRlcnM6IHsgQXV0aG9yaXphdGlvbjogZS50b2tlbiB8fCB2b2lkIDAgfSwgY29tcGxldGU6IG4gfSksIHNldFRpbWVvdXQobiwgVCk7IH0pKTsgfSwgRGUgPSBmdW5jdGlvbiAoZSwgbikgeyBlICYmIChuID8gZS5jbG9zZWQgfHwgKGUuY2xvc2VkID0gITAsIFwiaW5saW5lXCIgPT09IGUuY29uZmlnLmRpc3BsYXlNb2RlID8gcy5lbXB0eShlLmNvbnRhaW5lcikgOiBcInBvcHVwXCIgPT09IGUuY29uZmlnLmRpc3BsYXlNb2RlID8gZS5jb250YWluZXIuY2xvc2UoKSA6IFwibW9kYWxcIiA9PT0gZS5jb25maWcuZGlzcGxheU1vZGUgJiYgKENlKCksIHMucmVtb3ZlKGUuY29udGFpbmVyLnBhcmVudEVsZW1lbnQpKSwgRCAmJiBBZSgpICYmICRlKCkpIDogKHAuc2VuZChcImNsb3NlXCIsIHt9LCBlLmlmcmFtZUlkKSwgUiA9IFIuZmlsdGVyKChmdW5jdGlvbiAobikgeyByZXR1cm4gbi5pZnJhbWVJZCAhPT0gZS5pZnJhbWVJZDsgfSkpLCBzZXRUaW1lb3V0KChmdW5jdGlvbiAoKSB7IERlKGUsICEwKTsgfSksIDYwMCkpKTsgfSwgRmUgPSBmdW5jdGlvbiAoKSB7IFIuZm9yRWFjaCgoZnVuY3Rpb24gKGUpIHsgRGUoZSk7IH0pKSwgUiA9IFtdOyB9LCBCZSA9IGZ1bmN0aW9uIChlLCBuKSB7IHZhciB0ID0gSWUoKTsgdC5leHBpcmVzID0gMzAsIHUuX19wcm90ZWN0ZWRfXy5zZXRDb29raWUoaywgZSwgdCksIG4gfHwgUi5mb3JFYWNoKChmdW5jdGlvbiAobikgeyBwLnNlbmQoXCJsYW5nXCIsIHsgbGFuZzogZSB9LCBuLmlmcmFtZUlkKTsgfSkpLCBPYmplY3Qua2V5cyhMLmxhbmdDaGFuZ2VGcm9tSWZyYW1lKS5mb3JFYWNoKChmdW5jdGlvbiAobikgeyB2YXIgdCA9IEwubGFuZ0NoYW5nZUZyb21JZnJhbWVbbl07IHAuX19wcm90ZWN0ZWRfXy5pc0lmcmFtZU1hbmFnZWQobikgJiYgdCA/IHQoZSkgOiBkZWxldGUgTC5sYW5nQ2hhbmdlRnJvbUlmcmFtZVtuXTsgfSkpLCBpZShcImxhbmdDaGFuZ2VcIiwgZSk7IH0sIFZlID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gcG4ubG9jYWxlIHx8IHUuX19wcm90ZWN0ZWRfXy5nZXRDb29raWUoaykgfHwgXCJcIjsgfSwgcWUgPSBmdW5jdGlvbiAoZSkgeyB1Ll9fcHJvdGVjdGVkX18uc2V0Q29va2llKEMsIDEsIGUpOyB9LCB6ZSA9IGZ1bmN0aW9uIChlKSB7IGUgJiYgYS5yZW1vdmUoQywgZSk7IH0sIEhlID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gISF1Ll9fcHJvdGVjdGVkX18uZ2V0Q29va2llKEMpOyB9LCBXZSA9IGZ1bmN0aW9uIChlKSB7IHJldHVybiBuZXcgUHJvbWlzZSgoZnVuY3Rpb24gKG4pIHsgdmFyIHQgPSBPYmplY3QuYXNzaWduKHt9LCBPLCBlKTsgYy5yZXF1ZXN0KHsgdXJsOiBoZSgpICsgXCJhcGkvdjEvaWRlbnRpdHkvdXNlcmluZm9cIiwgZGF0YTogeyBjbGllbnRfaWQ6IE8uYWlkIHx8IHBuLmFpZCwgZm9ybV9uYW1lOiB0LmZvcm1OYW1lIH0sIGhlYWRlcnM6IHsgQXV0aG9yaXphdGlvbjogQWUoKSB8fCB2b2lkIDAgfSwgc3VjY2VzczogbiwgY29tcGxldGU6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIG4obnVsbCk7IH0gfSksIHNldFRpbWVvdXQobiwgMTAgKiBUKTsgfSkpOyB9LCBKZSA9IGZ1bmN0aW9uIChlLCBuLCB0KSB7IGoucHVzaCh7IHR5cGU6IHQsIG5hbWU6IGUsIGRhdGE6IG4gfSk7IH0sIEdlID0gZnVuY3Rpb24gKGUsIG4pIHsgTS5pbmNsdWRlcyhlKSA/IGQudHVybk9uUlRMKG4pIDogZC50dXJuT2ZmUlRMKG4pOyB9LCBRZSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuICEwID09PSBwbi51c2VQaWFub0lkTGl0ZVVzZXJQcm92aWRlciB8fCBcInN0cmluZ1wiID09IHR5cGVvZiBwbi51c2VQaWFub0lkTGl0ZVVzZXJQcm92aWRlciAmJiBcInRydWVcIiA9PT0gcG4udXNlUGlhbm9JZExpdGVVc2VyUHJvdmlkZXI7IH0sIFhlID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gISF3LmdldChcInBpYW5vLWlkLWluaXRpYWwtZ20tc3NvLXNob3duLVwiICsgKE8uYWlkIHx8IHBuLmFpZCkpOyB9LCAkZSA9IGZ1bmN0aW9uICgpIHsgdy5zZXQoXCJwaWFuby1pZC1pbml0aWFsLWdtLXNzby1zaG93bi1cIiArIChPLmFpZCB8fCBwbi5haWQpLCBcIjFcIik7IH0sIFllID0gZnVuY3Rpb24gKCkgeyB3LnJlbW92ZShcInBpYW5vLWlkLWluaXRpYWwtZ20tc3NvLXNob3duLVwiICsgKE8uYWlkIHx8IHBuLmFpZCkpOyB9OyByZXR1cm4geyBuYW1lOiBcInBpYW5vSWRcIiwgaXN2OiAhMSwgaW5pdDogcSwgcHJlcGFyZTogZnVuY3Rpb24gKCkgeyByZXR1cm4gVigpOyB9LCBzaG93OiB6LCBzaG93Rm9ybTogZnVuY3Rpb24gKGUpIHsgcSgpLnRoZW4oKGZ1bmN0aW9uICgpIHsgdmFyIHQgPSBPYmplY3QuYXNzaWduKHt9LCBPLCBlLCB7IGlzUmVnaXN0cmF0aW9uOiAhMSB9KTsgaWYgKCF0LmZvcm1OYW1lKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGb3JtIG5hbWUgc2hvdWxkIGJlIHNwZWNpZmllZCwgbGlrZVxcbnRwLnBpYW5vc0lkLnNob3dGb3JtKHtmb3JtTmFtZTogXCIuLi5cIn0pOycpOyB2YXIgciA9IGZ1bmN0aW9uICgpIHsgaWYgKG4pXG4gICAgICAgICAgICB1LmxvZyhcIk1vZGFsIGxvZ2luIHdpbmRvdyBhbHJlYWR5IHNob3duXCIpO1xuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGlmIChzZSh0KSwgYWUoZSksICF0LnByZXZpZXcgJiYgbylcbiAgICAgICAgICAgICAgICByZXR1cm4gdm9pZCB1LmxvZyhcIlNraXAgc2hvdyBmb3JtLCByZWdpc3RlciBuZXcgdXNlclwiKTtcbiAgICAgICAgICAgIGlmICghdC5oaWRlSWZDb21wbGV0ZSlcbiAgICAgICAgICAgICAgICByZXR1cm4gT2JqZWN0LmFzc2lnbih0LCB7IHJlYWR5Q2FsbGJhY2s6IGZ1bmN0aW9uIChlKSB7IHAuc2VuZChcInNldFRva2VuXCIsIEFlKCksIGUuaWZyYW1lSWQpOyB9IH0pLCBfZSh0KTtcbiAgICAgICAgICAgIFdlKHQpLnRoZW4oKGZ1bmN0aW9uIChlKSB7IGlmIChlICYmIGUuaGFzX2FsbF9jdXN0b21fZmllbGRfdmFsdWVzX2ZpbGxlZCAmJiB0LmhpZGVJZkNvbXBsZXRlKVxuICAgICAgICAgICAgICAgIHUubG9nKFwiU2tpcCBzaG93IGZvcm0sIGFsbCBmaWVsZHMgYXJlIGNvbXBsZXRlZFwiKTtcbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHZhciBuID0gT2JqZWN0LmFzc2lnbih7fSwgdCwgeyByZWFkeUNhbGxiYWNrOiBmdW5jdGlvbiAobikgeyBwLnNlbmQoXCJ1c2VyRGF0YVwiLCBlLCBuLmlmcmFtZUlkKTsgfSB9KTtcbiAgICAgICAgICAgICAgICBfZShuKTtcbiAgICAgICAgICAgIH0gfSkpO1xuICAgICAgICB9IH07IGlmIChlLnByZXZpZXcgfHwgT2UoKSlcbiAgICAgICAgICAgIHIoKTtcbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB2YXIgaSA9IE9iamVjdC5hc3NpZ24oe30sIGUsIHsgY2xvc2VkQ2FsbGJhY2s6IGZ1bmN0aW9uICgpIHsgT2UoKSAmJiByKCk7IH0gfSk7XG4gICAgICAgICAgICB6KGkpO1xuICAgICAgICB9IH0pKTsgfSwgY2hlY2tBbmRTaG93RW1haWxJc05vdENvbmZpcm1lZDogSCwgc2hvd0VtYWlsQ29uZmlybWF0aW9uUmVxdWlyZWQ6IGZ1bmN0aW9uIChlKSB7IG4gPyB1LmxvZyhcIk1vZGFsIHdpbmRvdyBhbHJlYWR5IHNob3duXCIpIDogcSgpLnRoZW4oKGZ1bmN0aW9uICgpIHsgdmFyIG4gPSBPYmplY3QuYXNzaWduKHsgc2NyZWVuOiBcImVtYWlsX2NvbmZpcm1hdGlvbl9yZXF1aXJlZFwiIH0sIE8sIGUpOyBhZShlKSwgc2UobiksIF9lKG4pOyB9KSk7IH0sIHN1Ym1pdExvZ2luRm9ybTogZnVuY3Rpb24gKCkgeyBwLnNlbmQoXCJzdWJtaXRMb2dpbkZvcm1cIiwgbnVsbCwgbnVsbCA9PSBuID8gdm9pZCAwIDogbi5pZnJhbWVJZCk7IH0sIGxvZ2luQnlUb2tlbjogZnVuY3Rpb24gKGUpIHsgdmFyIG4gPSBsKGUpOyBNZSh7IHVzZXI6IG4sIHRva2VuOiBlIH0pOyB9LCBsb2dvdXQ6IHVlLCBnZXRUb2tlbjogQWUsIGdldFVzZXI6IFRlLCBsb2FkRXh0ZW5kZWRVc2VyOiBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IE9iamVjdC5hc3NpZ24oe30sIE8sIGUpOyBXZShuKS50aGVuKChmdW5jdGlvbiAoZSkgeyB2YXIgdCA9IE9iamVjdC5hc3NpZ24oe30sIGUpOyBlICYmIEFycmF5LmlzQXJyYXkoZS5jdXN0b21fZmllbGRfdmFsdWVzKSAmJiAoZS5jdXN0b21fZmllbGRfdmFsdWVzID0gZS5jdXN0b21fZmllbGRfdmFsdWVzLm1hcCgoZnVuY3Rpb24gKGUpIHsgdmFyIG47IHRyeSB7XG4gICAgICAgICAgICBuID0gSlNPTi5wYXJzZShlLnZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAodCkge1xuICAgICAgICAgICAgbiA9IGUudmFsdWU7XG4gICAgICAgIH0gcmV0dXJuIHsgZmllbGRfbmFtZTogZS5maWVsZF9uYW1lLCB2YWx1ZTogbiwgY3JlYXRlZDogZS5jcmVhdGVkIH07IH0pKSksIFwiZnVuY3Rpb25cIiA9PSB0eXBlb2Ygbi5leHRlbmRlZFVzZXJMb2FkZWQgJiYgbi5leHRlbmRlZFVzZXJMb2FkZWQodCksIG9lKFwiZXh0ZW5kZWRVc2VyTG9hZGVkXCIsIHQpOyB9KSk7IH0sIGdldE5hbWU6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIFwicGlhbm9faWRcIjsgfSwgaXNDb25maWd1cmVkOiBmdW5jdGlvbiAoKSB7IHJldHVybiAhMCA9PT0gcG4udXNlUGlhbm9JZFVzZXJQcm92aWRlciB8fCBcInN0cmluZ1wiID09IHR5cGVvZiBwbi51c2VQaWFub0lkVXNlclByb3ZpZGVyICYmIFwidHJ1ZVwiID09PSBwbi51c2VQaWFub0lkVXNlclByb3ZpZGVyOyB9LCBvbkxvZ2luU3VjY2VzczogZnVuY3Rpb24gKGUpIHsgaWYgKCFpKSB7XG4gICAgICAgICAgICBpID0gITA7XG4gICAgICAgICAgICB2YXIgbiA9IHsgc291cmNlOiBlLnNvdXJjZSwgdG9rZW46IGUudXNlcl90b2tlbiwgdXNlcjogZS5wYXJhbXMsIGNvb2tpZV9kb21haW46IGUuY29va2llX2RvbWFpbiwgc3RhZ2U6IGUuc3RhZ2UgfTtcbiAgICAgICAgICAgIHUuc2V0QWNjZXNzVG9rZW5MaXN0Q29va2llKHsgdmFsdWU6IGUudG9rZW5fbGlzdCwgY29va2llX2RvbWFpbjogZS5jb29raWVfZG9tYWluIH0sIGUudXNlcl90b2tlbiksIE1lKG4pLnRoZW4oKGZ1bmN0aW9uICgpIHsgaSA9ICExOyB9KSk7XG4gICAgICAgIH0gfSwgb25Qcm9maWxlVXBkYXRlOiBmdW5jdGlvbiAoZSwgbikgeyB2YXIgdCA9IHsgdG9rZW46IGUudG9rZW4sIHVzZXI6IGUudXNlciwgY29va2llX2RvbWFpbjogZS5jb29raWVfZG9tYWluIH07IE1lKHQsICEwKS50aGVuKChmdW5jdGlvbiAoKSB7IG4oKSwgZnVuY3Rpb24gKGUpIHsgcmUoXCJwcm9maWxlVXBkYXRlXCIsIGUpOyB9KHQpOyB9KSk7IH0sIG9uRXh0ZW5kZWRVc2VyTG9naW5SZXF1aXJlZDogZnVuY3Rpb24gKCkgeyBXKCk7IH0sIGlzVXNlclZhbGlkOiBPZSwgc2V0Q2FsbGJhY2tzOiBhZSwgZ2V0SWZyYW1lVXJsOiBmdW5jdGlvbiAoKSB7IHJldHVybiBoZSgpOyB9LCB1cGRhdGVMYW5nOiBCZSwgb25MYW5nQ2hhbmdlOiBmdW5jdGlvbiAoZSwgbikgeyByZXR1cm4gTC5sYW5nQ2hhbmdlRnJvbUlmcmFtZVtuXSA9IGUsIGZ1bmN0aW9uICgpIHsgZGVsZXRlIEwubGFuZ0NoYW5nZUZyb21JZnJhbWVbbl07IH07IH0sIGdldExhbmc6IFZlLCBpc0FvdDogZnVuY3Rpb24gKCkgeyBSLmZvckVhY2goKGZ1bmN0aW9uIChlKSB7IHAuc2VuZChcImlzQU9UXCIsIHt9LCBlLmlmcmFtZUlkKTsgfSkpOyB9LCByZWdpc3RlckNhbGxiYWNrOiBmdW5jdGlvbiAoZSwgbikgeyBVW2VdID0gVVtlXSB8fCBbXSwgVVtlXS5wdXNoKG4pOyB9LCBzZXRSZXF1ZXN0VGltZW91dDogY2UsIF9fcHJvdGVjdGVkX186IHsgb2ZmZXJNZXNzYWdlUmVjZWl2ZXI6IGZ1bmN0aW9uIChlKSB7IHN3aXRjaCAoZS5wYXJhbXMuZXZlbnQpIHtcbiAgICAgICAgICAgICAgICBjYXNlIFwiY2ZBcHBJbXByZXNzaW9uXCI6XG4gICAgICAgICAgICAgICAgY2FzZSBcImNmRm9ybUltcHJlc3Npb25cIjpcbiAgICAgICAgICAgICAgICAgICAgZi5fX3Byb3RlY3RlZF9fLmxvZ0N1c3RvbUZvcm1JbXByZXNzaW9uKGUucGFyYW1zLnRyYWNraW5nSWQsIGUucGFyYW1zLnRyYWNraW5nSWQsIEUpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwiY2ZGb3JtU3VibWlzc2lvblwiOlxuICAgICAgICAgICAgICAgICAgICBmLl9fcHJvdGVjdGVkX18ubG9nQ3VzdG9tRm9ybVN1Ym1pc3Npb24oZS5wYXJhbXMudHJhY2tpbmdJZCwgZS5wYXJhbXMudHJhY2tpbmdJZCwgRSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJjaGFuZ2VTY3JlZW5cIjpcbiAgICAgICAgICAgICAgICAgICAgdGUoZS5wYXJhbXMucGFyYW1zLnNjcmVlbiwgITApO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwibG9naW5GYWlsZWRcIjpcbiAgICAgICAgICAgICAgICBjYXNlIFwicmVnaXN0cmF0aW9uRmFpbGVkXCI6XG4gICAgICAgICAgICAgICAgY2FzZSBcInJlZ2lzdHJhdGlvblN1Y2Nlc3NcIjpcbiAgICAgICAgICAgICAgICBjYXNlIFwiY3VzdG9tRXZlbnRcIjpcbiAgICAgICAgICAgICAgICAgICAgaWUoZS5wYXJhbXMuZXZlbnQsIGUucGFyYW1zLnBhcmFtcywgITApO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwiZW1pdEdBRXZlbnRcIjpcbiAgICAgICAgICAgICAgICAgICAgZy5lbWl0RXZlbnQoZS5wYXJhbXMucGFyYW1zKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDogcmV0dXJuIHZvaWQgdS5kZWJ1ZyhcIlJlY2VpdmVkIGludmFsaWQgZXZlbnQgdHlwZTogXCIgKyBlLnBhcmFtcy5ldmVudCk7XG4gICAgICAgICAgICB9IH0sIHNob3dFbWFpbENvbmZpcm1hdGlvbjogZnVuY3Rpb24gKGUpIHsgbiA/IHUubG9nKFwiTW9kYWwgd2luZG93IGFscmVhZHkgc2hvd25cIikgOiBxKCkudGhlbigoZnVuY3Rpb24gKCkgeyB2YXIgbiA9IE9iamVjdC5hc3NpZ24oeyBzY3JlZW46IFwiZW1haWxfY29uZmlybWF0aW9uXCIgfSwgTywgZSk7IGFlKGUpLCBzZShuKSwgX2Uobik7IH0pKTsgfSwgY2hlY2tBbmRTaG93RW1haWxJc05vdENvbmZpcm1lZDogSCwgY2xvc2VNb2RhbENvbnRhaW5lcjogQ2UsIGV4ZWN1dGVQb3N0TWVzc2FnZXNCYXRjaDogZnVuY3Rpb24gKCkgeyBmb3IgKDsgai5sZW5ndGg7KSB7XG4gICAgICAgICAgICAgICAgdmFyIGUgPSBqLnBvcCgpO1xuICAgICAgICAgICAgICAgIFwiYnJvYWRjYXN0XCIgPT09IGUudHlwZSA/IHAuYnJvYWRjYXN0KGUubmFtZSwgZS5kYXRhKSA6IHAuc2VuZChlLm5hbWUsIGUuZGF0YSk7XG4gICAgICAgICAgICB9IH0gfSwgX19wcml2YXRlX186IHsgcHJlcGFyZUNvbmZpZzogc2UsIGV4dGVuZFVzZXJUb2tlbjogZnVuY3Rpb24gKCkgeyB2YXIgZSA9IFBlKCk7IGlmIChlKSB7XG4gICAgICAgICAgICAgICAgdmFyIG4gPSAobmV3IERhdGUpLmdldFRpbWUoKSwgdCA9IHUuX19wcm90ZWN0ZWRfXy5nZXRDb29raWUoSSksIHIgPSBuIC0gbChlKS5sb2dpbl90aW1lc3RhbXAgPiA4NjRlNTtcbiAgICAgICAgICAgICAgICB0ICYmIHIgJiYgUmUoITEsICEwKTtcbiAgICAgICAgICAgIH0gfSwgc2V0UmVxdWVzdFRpbWVvdXQ6IGNlIH0gfTsgfTtcbiAgICBwbi5jb250YWluZXIucmVnaXN0ZXIoXCJwaWFub0lkXCIsIHsgdXNlVmFsdWU6IHFlKCkgfSksIHBuLnBpYW5vSWQgPSBwbi5jb250YWluZXIucmVzb2x2ZShcInBpYW5vSWRcIik7XG4gICAgdmFyIHplID0gZnVuY3Rpb24gKCkgeyB2YXIgZSA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwidXRpbFwiKSwgbiA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwicGlhbm9JZFwiKSwgdCA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwiZXZlbnRVdGlsc1wiKS5jcmVhdGVFdmVudE1hbmFnZXIoW1widXNlckNoYW5nZWRcIiwgXCJvbkhpZGVcIl0pLCByID0gZS5nZXRBaWRTcGVjaWZpZWROYW1lKFwiX191dHBcIiksIG8gPSBmdW5jdGlvbiAoKSB7IHJldHVybiBwbi5leHRlcm5hbEpXVCB8fCBpKCk7IH0sIGkgPSBmdW5jdGlvbiAoKSB7IHJldHVybiBlLmZpbmRDb29raWVCeU5hbWUocikgfHwgbnVsbDsgfTsgcmV0dXJuIHsgbmFtZTogXCJwaWFub0lkTGl0ZVwiLCBpc3Y6ICExLCBpc0NvbmZpZ3VyZWQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuICEwID09PSBwbi51c2VQaWFub0lkTGl0ZVVzZXJQcm92aWRlciB8fCBcInN0cmluZ1wiID09IHR5cGVvZiBwbi51c2VQaWFub0lkTGl0ZVVzZXJQcm92aWRlciAmJiBcInRydWVcIiA9PT0gcG4udXNlUGlhbm9JZExpdGVVc2VyUHJvdmlkZXI7IH0sIGlzVXNlclZhbGlkOiBmdW5jdGlvbiAoKSB7IHJldHVybiAhIW8oKTsgfSwgZ2V0VG9rZW46IG8sIGdldE5hbWU6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIFwicGlhbm9faWRfbGl0ZVwiOyB9LCBvbkxvZ2luU3VjY2VzczogZnVuY3Rpb24gKG4pIHsgZS5zZXRBY2Nlc3NUb2tlbkxpc3RDb29raWUoeyB2YWx1ZTogbi50b2tlbl9saXN0LCBjb29raWVfZG9tYWluOiBuLmNvb2tpZV9kb21haW4gfSwgbi51c2VyX3Rva2VuKTsgfSwgcmVnaXN0ZXJDYWxsYmFjazogZnVuY3Rpb24gKGUsIG4pIHsgdC5hZGRFdmVudChlKSwgdC5yZWdpc3RlckNhbGxiYWNrKGUsIG4pOyB9LCBsb2dpbkJ5VG9rZW46IGZ1bmN0aW9uIChlKSB7IG4ubG9naW5CeVRva2VuKGUpOyB9LCBsb2dvdXQ6IGZ1bmN0aW9uIChuKSB7IGUud2FpdENhbGwoXCJyZWZyZXNoVXNlclRva2VuXCIsIChmdW5jdGlvbiAoKSB7IFwiZnVuY3Rpb25cIiA9PSB0eXBlb2YgbiAmJiBuKCk7IH0pKTsgfSB9OyB9KCk7XG4gICAgcG4uY29udGFpbmVyLnJlZ2lzdGVyKFwicGlhbm9JZExpdGVcIiwgeyB1c2VWYWx1ZTogemUgfSksIHBuLnBpYW5vSWRMaXRlID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJwaWFub0lkTGl0ZVwiKTtcbiAgICB2YXIgSGUgPSBmdW5jdGlvbiAoZSkgeyB2b2lkIDAgPT09IGUgJiYgKGUgPSBwbi5jb250YWluZXIpOyB2YXIgbiA9IGUucmVzb2x2ZShcImFwaVwiKSwgdCA9IGUucmVzb2x2ZShcInV0aWxcIiksIHIgPSBlLnJlc29sdmUoXCJqYW5yYWluXCIpLCBvID0gZS5yZXNvbHZlKFwidGlueXBhc3NBY2NvdW50c1wiKSwgaSA9IGUucmVzb2x2ZShcImNvbmRlVXNlclByb3ZpZGVyXCIpLCBhID0gZS5yZXNvbHZlKFwiZ2lneWFcIiksIHMgPSBlLnJlc29sdmUoXCJwaWFub0lkXCIpLCBjID0gZS5yZXNvbHZlKFwicGlhbm9JZExpdGVcIiksIGwgPSBlLnJlc29sdmUoXCJldmVudFV0aWxzXCIpLmNyZWF0ZUV2ZW50TWFuYWdlcihbXSksIHUgPSB7IGlzdjogITEsIGdldE5hbWU6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIFwicHVibGlzaGVyX3VzZXJfcmVmXCI7IH0sIGdldFRva2VuOiBmdW5jdGlvbiAoKSB7IHJldHVybiBwbi51c2VyUmVmID8gcG4udXNlclJlZi5jb25zdHJ1Y3RvciA9PT0gXCJcIi5jb25zdHJ1Y3RvciA/IHBuLnVzZXJSZWYgOiBwbi51c2VyUmVmLmNvbnN0cnVjdG9yID09PSB7fS5jb25zdHJ1Y3RvciA/IFwie2pveH1cIiArIEpTT04uc3RyaW5naWZ5KHBuLnVzZXJSZWYpIDogcG4udXNlclJlZiA6IG51bGw7IH0sIGlzVXNlclZhbGlkOiBmdW5jdGlvbiAoKSB7IHJldHVybiAhISh2b2lkIDAgIT09IHBuLnVzZXJSZWYgJiYgcG4udXNlclJlZiAmJiBwbi51c2VyUmVmLmxlbmd0aCA+IDApOyB9LCBvbkxvZ2luU3VjY2VzczogZnVuY3Rpb24gKGUpIHsgdC5zZXRBY2Nlc3NUb2tlbkxpc3RDb29raWUoeyB2YWx1ZTogZS50b2tlbl9saXN0LCBjb29raWVfZG9tYWluOiBlLmNvb2tpZV9kb21haW4gfSwgZS51c2VyX3Rva2VuKTsgfSwgbG9nb3V0OiBmdW5jdGlvbiAoZSkgeyB0LnNldEFjY2Vzc1Rva2VuTGlzdENvb2tpZSgpLCBlICYmIGUoKTsgfSB9LCBkID0gZnVuY3Rpb24gKCkgeyB2YXIgZSA9IFtyLCBvLCBpLCBhLCBzLCBjXS5maW5kKChmdW5jdGlvbiAoZSkgeyByZXR1cm4gZS5pc0NvbmZpZ3VyZWQoKSAmJiAhZS5pc3Y7IH0pKTsgcmV0dXJuIGUgfHwgdTsgfTsgcmV0dXJuIHsgbmFtZTogXCJ1c2VyXCIsIGdldFByb3ZpZGVyOiBkLCBwcm92aWRlckluaXQ6IGZ1bmN0aW9uIChlKSB7IHZvaWQgMCAhPT0gZSAmJiBlIHx8IChlID0gZnVuY3Rpb24gKCkgeyB9KTsgdmFyIG4gPSBkKCk7IFwiZnVuY3Rpb25cIiA9PSB0eXBlb2Ygbi5wcmVwYXJlID8gXCJwcmVwYXJlXCIgaW4gbiAmJiBuLnByZXBhcmUoKS50aGVuKGUsIGUpIDogZSgpOyB9LCByZWZyZXNoQWNjZXNzVG9rZW46IGZ1bmN0aW9uIChlLCByKSB7IHZvaWQgMCAhPT0gciAmJiByIHx8IChyID0gZnVuY3Rpb24gKCkgeyB9KTsgdmFyIG8gPSAhMTsgaWYgKHZvaWQgMCAhPT0gZSAmJiBlKVxuICAgICAgICAgICAgbyA9ICEwO1xuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHZhciBpID0gdC5fX3Byb3RlY3RlZF9fLmdldENvb2tpZShcIl9fdGFlXCIpO1xuICAgICAgICAgICAgaWYgKHZvaWQgMCAhPT0gaSAmJiBpKSB7XG4gICAgICAgICAgICAgICAgdmFyIGEgPSBuZXcgRGF0ZShwYXJzZUludChpKSk7XG4gICAgICAgICAgICAgICAgKG5ldyBEYXRlKS5nZXRUaW1lKCkgLSBhLmdldFRpbWUoKSA+IDg2NGU1ICYmIChvID0gITApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIG8gPSAhMDtcbiAgICAgICAgfSBvID8gdC53YWl0Q2FsbChcInJlZnJlc2hVc2VyVG9rZW5cIiwgKGZ1bmN0aW9uICgpIHsgdC53YWl0Q2FsbChcIm9mZmVyQ3JlYXRlXCIsIChmdW5jdGlvbiAoKSB7IHQud2FpdENhbGwoXCJleHBlcmllbmNlRXhlY3V0ZVwiLCAoZnVuY3Rpb24gKCkgeyBpZiAoZCgpLmlzVXNlclZhbGlkKCkpIHtcbiAgICAgICAgICAgIHQuc3RhcnRDYWxsKFwicmVmcmVzaEFjY2Vzc1Rva2VuTGlzdFwiKTtcbiAgICAgICAgICAgIHZhciBlID0geyB1cmw6IHQucHJlcGFyZVVybFBhcmFtZXRlcih3aW5kb3cubG9jYXRpb24uaHJlZikgfTtcbiAgICAgICAgICAgIG4uY2FsbEFwaShcIi9hY2Nlc3MvdG9rZW4vbGlzdFwiLCBlLCAoZnVuY3Rpb24gKGUpIHsgdC5kb25lQ2FsbChcInJlZnJlc2hBY2Nlc3NUb2tlbkxpc3RcIiksIHZvaWQgMCAhPT0gZS5hY2Nlc3NfdG9rZW5fbGlzdCA/ICh0LnNldEFjY2Vzc1Rva2VuTGlzdENvb2tpZShlLmFjY2Vzc190b2tlbl9saXN0KSwgciAmJiByKGUuYWNjZXNzX3Rva2VuX2xpc3QudmFsdWUpKSA6IHIgJiYgcihudWxsKTsgfSksIHZvaWQgMCwgdm9pZCAwLCAhMCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgciAmJiByKFwiXCIpOyB9KSk7IH0pKTsgfSkpIDogcihudWxsKTsgfSwgc2hvd0xvZ2luOiBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IGQoKS5nZXROYW1lKCk7IGlmIChcInRpbnlwYXNzX2FjY291bnRzXCIgPT09IG4pXG4gICAgICAgICAgICBvLmxvZ2luKGUpO1xuICAgICAgICBlbHNlIGlmIChcInBpYW5vX2lkXCIgPT09IG4pIHtcbiAgICAgICAgICAgIHZhciB0ID0gZSB8fCB7fTtcbiAgICAgICAgICAgIHMuc2hvdyh0KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICBcInB1Ymxpc2hlcl91c2VyX3JlZlwiID09PSBuICYmIGwuZmlyZUNhbGxiYWNrcyhcImxvZ2luUmVxdWlyZWRcIiwge30sIHZvaWQgMCwgITApOyB9LCBpc1VzZXJWYWxpZDogZnVuY3Rpb24gKCkgeyByZXR1cm4gZCgpLmlzVXNlclZhbGlkKCk7IH0sIGxvZ291dDogZnVuY3Rpb24gKGUsIG4pIHsgZCgpLmxvZ291dChlLCBuKTsgfSwgcmVnaXN0ZXJDYWxsYmFjazogZnVuY3Rpb24gKGUsIG4pIHsgbC5hZGRFdmVudChlKSwgbC5yZWdpc3RlckNhbGxiYWNrKGUsIG4pOyB9LCBnZXRVc2VySW5mb1BhcmFtczogZnVuY3Rpb24gKGUpIHsgdmFyIG4gPSBlLnVzZXJUb2tlbjsgaWYgKCFuKSB7XG4gICAgICAgICAgICB2YXIgciA9IGQoKS5nZXRUb2tlbigpO1xuICAgICAgICAgICAgbiA9IHIgJiYgci5sZW5ndGggPiAwID8gciA6IFwiXCI7XG4gICAgICAgIH0gcmV0dXJuIHsgdXNlcl90b2tlbjogbiwgdXNlcl9sYW5nOiB0Ll9fcHJvdGVjdGVkX18uZ2V0Q29va2llKFwiTEFOR1wiKSB8fCBcIlwiLCBpc19wcmV2aWV3OiBlLnByZXZpZXcsIGlzX25vbl9sb2dnZWRfdXNlcjogZS5wcmV2aWV3Tm9uTG9nZ2VkVXNlciB9OyB9IH07IH07XG4gICAgcG4uY29udGFpbmVyLnJlZ2lzdGVyKFwidXNlclwiLCB7IHVzZVZhbHVlOiBIZSgpIH0pLCBwbi51c2VyID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJ1c2VyXCIpO1xuICAgIHZhciBXZSA9IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSBwbi5jb250YWluZXIucmVzb2x2ZShcImpxVXRpbHNcIiksIG4gPSBwbi5jb250YWluZXIucmVzb2x2ZShcInV0aWxcIiksIHQgPSBcInZpZXdwb3J0LWV4aXQtYWN0aXZhdGVkXCIsIHIgPSBcInZpZXdwb3J0LWV4aXQtcHJlcGFyZWRcIiwgbyA9ICExLCBpID0gITEsIGEgPSAwLCBzID0gMCwgYyA9IFtcInRvcFwiLCBcInJpZ2h0XCIsIFwiYm90dG9tXCIsIFwibGVmdFwiXSwgbCA9ICEwLCB1ID0gITEsIGQgPSAhMSwgcCA9IFtdLCBmID0geyB0b3A6IHsgdmlzaXRlZDogITEsIHZhbHVlOiAxIH0sIHJpZ2h0OiB7IHZpc2l0ZWQ6ICExLCB2YWx1ZTogMiB9LCBib3R0b206IHsgdmlzaXRlZDogITEsIHZhbHVlOiA0IH0sIGxlZnQ6IHsgdmlzaXRlZDogITEsIHZhbHVlOiA4IH0gfSwgbSA9IDAsIGcgPSBmdW5jdGlvbiAoKSB7IGlmICghdSkge1xuICAgICAgICB1ID0gITAsIG0gPSAwO1xuICAgICAgICB2YXIgbiA9IC8oPzpGaXJlZm94fFNhZmFyaSlbXFwvXFxzXShcXGQrXFwuXFxkKykvLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkgPyBkb2N1bWVudC5ib2R5IDogZG9jdW1lbnQ7XG4gICAgICAgIGUub24obiwgXCJtb3VzZWxlYXZlXCIsIChmdW5jdGlvbiAoZSkgeyByZXR1cm4gdihlKTsgfSkpLCBlLm9uKGRvY3VtZW50LCBcIm1vdXNlbW92ZVwiLCAoZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGgoZSk7IH0pKTtcbiAgICB9IH07IHZhciB2ID0gZnVuY3Rpb24gKHQpIHsgdmFyIHIsIG8sIGwsIHUsIGQsIHAsIGc7IChyID0gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGUuY2xpZW50WCA9PT0gZS5jbGllbnRZICYmIGUuY2xpZW50WCA8IDAgJiYgZS5jbGllbnRYID49IC0xOyB9KHQpID8gXCJcIiA6IChvID0gdC5jbGllbnRYLCBsID0gdC5jbGllbnRZLCB1ID0gZS53aW5TaXplKCksIGQgPSB1LndpZHRoLCBwID0gdS5oZWlnaHQsIGcgPSBcIlwiLCBvID49IGQgJiYgKGcgPSBcInJpZ2h0XCIpLCBsID49IHAgJiYgKGcgPSBcImJvdHRvbVwiKSwgbyA8PSAwICYmIChnID0gXCJsZWZ0XCIpLCBsIDw9IDAgJiYgKGcgPSBcInRvcFwiKSwgZykpIHx8IChyID0gZnVuY3Rpb24gKCkgeyBpZiAoIWkpXG4gICAgICAgIHJldHVybiBcIlwiOyB2YXIgbiA9IGUud2luU2l6ZSgpLCB0ID0gbi53aWR0aCwgciA9IG4uaGVpZ2h0OyByZXR1cm4gY1tmdW5jdGlvbiAoZSkgeyBpZiAoMCA9PT0gZS5sZW5ndGgpXG4gICAgICAgIHJldHVybiAtMTsgZm9yICh2YXIgbiA9IGVbMF0sIHQgPSAwLCByID0gMTsgciA8IGUubGVuZ3RoOyByKyspXG4gICAgICAgIGVbcl0gPCBuICYmICh0ID0gciwgbiA9IGVbcl0pOyByZXR1cm4gdDsgfShbcywgdCAtIGEsIHIgLSBzLCBhXSldOyB9KCksIHIgfHwgbi5kZWJ1ZyhcInZpZXdwb3J0RXhpdDogdGhlIGRldGVjdCBvZiB0aGUgZXhpdCBzaWRlIGZhaWxlZFwiKSksIHIgJiYgZnVuY3Rpb24gKGUpIHsgLTEgIT09IGMuaW5kZXhPZihlKSA/IGZbZV0udmlzaXRlZCB8fCAoZltlXS52aXNpdGVkID0gITAsIG0gKz0gZltlXS52YWx1ZSkgOiBuLmRlYnVnKFwidmlld3BvcnRFeGl0OiB0aGUgZGV0ZWN0IG9mIHRoZSBleGl0IHNpZGUgZmFpbGVkXCIpOyB9KHIpLCB3KFwiYWxsXCIpLCBcInRvcFwiID09PSByICYmIHcoXCJ0b3BcIik7IH0sIGggPSBmdW5jdGlvbiAoZSkgeyBpID0gITAsIHMgPSBlLmNsaWVudFksIGEgPSBlLmNsaWVudFg7IH0sIHcgPSBmdW5jdGlvbiAoZSkgeyBpZiAobCkge1xuICAgICAgICBmb3IgKHZhciB0LCByID0gW10sIG8gPSBbXSwgaSA9IDA7IGkgPCBwLmxlbmd0aDsgaSsrKVxuICAgICAgICAgICAgKCh0ID0gcFtpXSkuZGV0ZWN0RXhpdE1vZGUgPT09IGUgfHwgXCJiYWNrXCIgPT09IGUgJiYgdC5kZXRlY3RCYWNrQnV0dG9uRm9yTW9iaWxlKSAmJiB0LmNvbnN1bWVFdmVudEZuKCkgPyByLnB1c2godCkgOiBvLnB1c2godCk7XG4gICAgICAgIHIubGVuZ3RoICYmIG4uZGVidWcoXCJ2aWV3cG9ydEV4aXQ6IGxpc3RlbmVycyB3YXMgcnVuIGZpcmUgd2l0aCB0eXBlOiBcIiwgZSksIHAgPSBvO1xuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgci5sZW5ndGg7IGkrKylcbiAgICAgICAgICAgICh0ID0gcltpXSkuY2FsbGJhY2soKTtcbiAgICB9IH07IHJldHVybiB7IG5hbWU6IFwidmlld3BvcnRFeGl0XCIsIGluaXRpYWxpemU6IGcsIGlzSW5pdGlhbGl6ZWQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHU7IH0sIGFkZExpc3RlbmVyOiBmdW5jdGlvbiAoZSwgbiwgaSkgeyBcIm1vYmlsZVwiICE9PSBuLmNsaWVudERldmljZSAmJiBcInRhYmxldFwiICE9PSBuLmNsaWVudERldmljZSB8fCAhbi5kZXRlY3RCYWNrQnV0dG9uRm9yTW9iaWxlIHx8IGZ1bmN0aW9uICgpIHsgaWYgKCFkKSB7XG4gICAgICAgICAgICBkID0gITAsIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwicG9wc3RhdGVcIiwgKGZ1bmN0aW9uIChlKSB7IG8gJiYgZS5zdGF0ZSAmJiBlLnN0YXRlLnBpYW5vVmlld3BvcnRFeGl0U3RhdGUgPT09IHQgJiYgKG8gPSAhMSwgdyhcImJhY2tcIikpOyB9KSk7XG4gICAgICAgICAgICB2YXIgZSA9IHdpbmRvdy5oaXN0b3J5LnN0YXRlIHx8IHt9O1xuICAgICAgICAgICAgZSAmJiBlLnBpYW5vVmlld3BvcnRFeGl0U3RhdGUgIT09IHIgJiYgKGUucGlhbm9WaWV3cG9ydEV4aXRTdGF0ZSAhPT0gdCAmJiAoZS5waWFub1ZpZXdwb3J0RXhpdFN0YXRlID0gdCwgd2luZG93Lmhpc3RvcnkucmVwbGFjZVN0YXRlKGUsIGRvY3VtZW50LnRpdGxlKSksIHdpbmRvdy5oaXN0b3J5LnB1c2hTdGF0ZSh7IHBpYW5vVmlld3BvcnRFeGl0U3RhdGU6IHIgfSwgZG9jdW1lbnQudGl0bGUpKSwgbyA9ICEwO1xuICAgICAgICB9IH0oKSwgZygpLCBcImZ1bmN0aW9uXCIgIT0gdHlwZW9mIGkgJiYgKGkgPSBmdW5jdGlvbiAoKSB7IHJldHVybiAhMDsgfSksIHAucHVzaCh7IGNhbGxiYWNrOiBlLCBkZXRlY3RFeGl0TW9kZTogbi5kZXRlY3RFeGl0TW9kZSwgZGV0ZWN0QmFja0J1dHRvbkZvck1vYmlsZTogbi5kZXRlY3RCYWNrQnV0dG9uRm9yTW9iaWxlLCBjb25zdW1lRXZlbnRGbjogaSB9KTsgfSwgcmVzZXRTdW1PZkNvZGVzRGlyZWN0aW9uVG9EZWZhdWx0OiBmdW5jdGlvbiAoKSB7IG0gPSAwOyB9LCBnZXRTdW1PZkNvZGVzRGlyZWN0aW9uOiBmdW5jdGlvbiAoKSB7IHJldHVybiBtOyB9LCByZW1vdmVMaXN0ZW5lcnM6IGZ1bmN0aW9uICgpIHsgcCA9IFtdOyB9LCBlbmFibGU6IGZ1bmN0aW9uICgpIHsgbCA9ICEwOyB9LCBkaXNhYmxlOiBmdW5jdGlvbiAoKSB7IGwgPSAhMTsgfSB9OyB9KCk7XG4gICAgcG4uY29udGFpbmVyLnJlZ2lzdGVyKFwidmlld3BvcnRFeGl0XCIsIHsgdXNlVmFsdWU6IFdlIH0pLCBwbi52aWV3cG9ydEV4aXQgPSBwbi5jb250YWluZXIucmVzb2x2ZShcInZpZXdwb3J0RXhpdFwiKTtcbiAgICB2YXIgSmUgPSBmdW5jdGlvbiAoKSB7IHZhciBlID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJwb3N0bWVzc2FnZVwiKSwgbiA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwiY29udGFpbmVyVXRpbHNcIiksIHQgPSBwbi5jb250YWluZXIucmVzb2x2ZShcInVzZXJcIiksIHIgPSBwbi5jb250YWluZXIucmVzb2x2ZShcImFwaVwiKTsgcG4uY29udGFpbmVyLnJlc29sdmUoXCJ1dGlsXCIpOyBmdW5jdGlvbiBvKGUpIHsgcmV0dXJuIGEoZSwgXCIvY2hlY2tvdXQvdGVtcGxhdGUvc2hvd1wiKTsgfSBmdW5jdGlvbiBpKGUpIHsgcmV0dXJuIGUuaW5pdENvbnRleHRMb2FkUHJvbWlzZSA9IGZ1bmN0aW9uIChlLCBuKSB7IGUuY29udGV4dExvYWRpbmdQcm9taXNlID0gcyhlLCBuKTsgfSwgYShlLCBcIi9jaGVja291dC90ZW1wbGF0ZS9jYWNoZWFibGVTaG93XCIpOyB9IHZhciBhID0gZnVuY3Rpb24gKGUsIG4pIHsgdmFyIHQgPSBwbi5nZXRFbmRwb2ludFJvb3QoITApICsgbjsgcmV0dXJuIGUuaWZyYW1lVXJsID0gdCwgZS5wb3N0TWVzc2FnZVVybCA9IHQsIGUud2lkZ2V0ID0gXCJ0ZW1wbGF0ZVwiLCBwbi5vZmZlci5jcmVhdGVPZmZlcklmcmFtZShlKTsgfSwgcyA9IGZ1bmN0aW9uIChlLCBuKSB7IHZhciBvID0gdC5nZXRVc2VySW5mb1BhcmFtcyhlKTsgcmV0dXJuIG8udHJhY2tpbmdfaWQgPSBlLnRyYWNraW5nSWQsIG8udGVtcGxhdGVJZCA9IGUudGVtcGxhdGVJZCwgby50ZW1wbGF0ZVZhcmlhbnRJZCA9IGUudGVtcGxhdGVWYXJpYW50SWQsIG8uYWlkID0gcG4uYWlkLCBvLnByZWxvYWQgPSBlLmlzUHJlbG9hZCwgZS5hZmZpbGlhdGVTdGF0ZSAmJiAoby5hZmZpbGlhdGVTdGF0ZSA9IEpTT04uc3RyaW5naWZ5KGUuYWZmaWxpYXRlU3RhdGUpKSwgT2JqZWN0LmtleXMobikuZm9yRWFjaCgoZnVuY3Rpb24gKGUpIHsgb1tlXSA9IG5bZV07IH0pKSwgbmV3IFByb21pc2UoKGZ1bmN0aW9uIChlLCBuKSB7IHIuY2FsbEFwaShcIi9hbm9uL3RlbXBsYXRlL2xvYWRUZW1wbGF0ZUNvbnRleHRcIiwgbywgKGZ1bmN0aW9uICh0KSB7IHZhciByID0gdC5jb2RlLCBvID0gdC50ZW1wbGF0ZUNvbnRleHQsIGkgPSB0Lm1lc3NhZ2U7IDAgPT09IHIgPyBlKG8pIDogbihpKTsgfSksIHZvaWQgMCwgdm9pZCAwLCAhMCk7IH0pKTsgfSwgYyA9IGZ1bmN0aW9uIChlLCBuKSB7IHZhciB0ID0ge307IHJldHVybiBbXCJhaWRcIiwgXCJ0ZW1wbGF0ZUlkXCIsIFwidGVtcGxhdGVWYXJpYW50SWRcIiwgXCJwcmV2aWV3VGVtcGxhdGVWZXJzaW9uXCIsIFwicHJlbG9hZFwiLCBcInByZXZpZXdcIiwgXCJwcmV2aWV3VW5jYWNoZWRcIiwgXCJkZXBsb3ltZW50SXRlbUlkXCIsIFwiZ2FDbGllbnRJZFwiLCBcInp1b3JhU2VsZWN0ZWRSYXRlUGxhbklkc1wiLCBcIm5ld3NjeWNsZVNlbGVjdGVkSWRzXCIsIFwiYWRkTmV3c2xldHRlckFzc2V0c1wiLCBcIm9mZmVySWRcIiwgXCJleHBlcmllbmNlSWRcIiwgXCJpZnJhbWVJZFwiLCBcImRpc3BsYXlNb2RlXCIsIFwiZGVidWdcIiwgXCJwaWFub0lkVXJsXCIsIFwid2lkZ2V0XCIsIFwidXJsXCJdLmZvckVhY2goKGZ1bmN0aW9uIChuKSB7IGVbbl0gJiYgKHRbbl0gPSBlW25dKTsgfSkpLCBuLnBhcmFtKHQpOyB9OyBmdW5jdGlvbiBsKGUpIHsgcG4uZ2V0Q2FjaGVhYmxlU2hvd1RlbXBsYXRlKCkgPyAoIWZ1bmN0aW9uIChlKSB7IGUuZGVmZXJyZWRDb250ZXh0TG9hZGluZyA9ICEwLCBlLmJ1aWxkUXVlcnlTdHJpbmdGbiA9IGM7IH0oZSksIGUuY3JlYXRlSWZyYW1lRm4gPSBpKSA6IGUuY3JlYXRlSWZyYW1lRm4gPSBvOyB9IHJldHVybiB7IG5hbWU6IFwidGVtcGxhdGVcIiwgc2hvdzogZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGUub2ZmZXJJZCA9IG4uZmFrZU9mZmVySWQsIGUudHJhY2tTdGF0c09uU2hvdyA9ICEwLCBsKGUpLCBwbi5vZmZlci5zaG93KGUpOyB9LCBkZWZlcnJlZFNob3c6IGZ1bmN0aW9uIChlKSB7IHJldHVybiBlLm9mZmVySWQgPSBuLmZha2VPZmZlcklkLCBsKGUpLCBwbi5vZmZlci5kZWZlcnJlZFNob3coZSk7IH0sIGNsb3NlOiBmdW5jdGlvbiAoKSB7IG4uY2xvc2VNb2RhbENvbnRhaW5lcigpOyB9LCBjbG9zZUlubGluZTogZnVuY3Rpb24gKGUpIHsgbi5fX3Byb3RlY3RlZF9fLmNsb3NlSW5saW5lQ29udGFpbmVycyhlKTsgfSwgY3JlYXRlVGVtcGxhdGVJZnJhbWU6IG8sIHNob3dCYWNrZHJvcDogZnVuY3Rpb24gKCkgeyBuLnNob3dCYWNrZHJvcCgpOyB9LCBoaWRlQmFja2Ryb3A6IGZ1bmN0aW9uICgpIHsgbi5oaWRlQmFja2Ryb3AoKTsgfSwgY2VudGVyQmFja2Ryb3A6IGZ1bmN0aW9uIChlKSB7IG4uY2VudGVyQmFja2Ryb3AoZSk7IH0sIHJlZ2lzdGVyQ2FsbGJhY2s6IGZ1bmN0aW9uIChlLCBuKSB7IH0sIHJlZnJlc2hVc2VyOiBmdW5jdGlvbiAobikgeyB0LnJlZnJlc2hBY2Nlc3NUb2tlbighMCwgKGZ1bmN0aW9uICgpIHsgZS5zZW5kKFwiZXh0ZXJuYWxMb2dpblN1Y2Nlc3NcIiwgeyB1c2VyX3Rva2VuOiB0LmdldFByb3ZpZGVyKCkuZ2V0VG9rZW4oKSB9LCBuKTsgfSkpOyB9IH07IH0oKTtcbiAgICBwbi5jb250YWluZXIucmVnaXN0ZXIoXCJ0ZW1wbGF0ZVwiLCB7IHVzZVZhbHVlOiBKZSB9KSwgcG4udGVtcGxhdGUgPSBwbi5jb250YWluZXIucmVzb2x2ZShcInRlbXBsYXRlXCIpO1xuICAgIHZhciBHZSA9IGZ1bmN0aW9uIChlKSB7IHZvaWQgMCA9PT0gZSAmJiAoZSA9IHBuLmNvbnRhaW5lcik7IHZhciBuLCB0LCByID0gZS5yZXNvbHZlKFwianFVdGlsc1wiKSwgbyA9IGUucmVzb2x2ZShcInV0aWxcIiksIGkgPSBlLnJlc29sdmUoXCJwb3N0bWVzc2FnZVwiKSwgYSA9IGUucmVzb2x2ZShcInVzZXJcIiksIHMgPSBlLnJlc29sdmUoXCJjb250YWluZXJVdGlsc1wiKSwgYyA9IGUucmVzb2x2ZShcImV2ZW50VXRpbHNcIiksIGwgPSBlLnJlc29sdmUoXCJ2aWV3cG9ydEV4aXRcIiksIHUgPSBlLnJlc29sdmUoXCJnYVNlcnZpY2VcIiksIGQgPSBlLnJlc29sdmUoXCJzaGExXCIpLCBwID0gZS5yZXNvbHZlKFwibG9nZ2luZ1wiKSwgZiA9IGUucmVzb2x2ZShcInRlbXBsYXRlXCIpLCBtID0ge30sIGcgPSAwLCB2ID0gXCJjbG9zZVwiLCBoID0gXCJPRkZFUlwiLCB3ID0gITEsIHkgPSAhMSwgYiA9ICExLCBrID0ge30sIF8gPSBuZXcgTWFwLCBDID0ge30sIEkgPSBbXCJoZV9JTFwiLCBcImFyX0VHXCJdLCBTID0gYy5jcmVhdGVFdmVudE1hbmFnZXIoW1wiY29tcGxldGVcIiwgXCJjYW5jZWxcIiwgXCJjbG9zZVwiLCBcImVycm9yXCIsIFwibG9naW5SZXF1aXJlZFwiLCBcImxvZ2luU3VjY2Vzc1wiLCBcImxvYWRlZFwiLCBcImN1c3RvbUV2ZW50XCIsIFwic3RhcnRDaGVja291dFwiLCBcInJlc2l6ZVwiLCBcIm9uTWV0ZXJFeHBpcmVkXCIsIFwib25NZXRlckFjdGl2ZVwiLCBcIm9uQWNjZXNzR3JhbnRlZFwiLCBcIm9uU2hvd09mZmVyXCIsIFwicGlhbm9JZEV2ZW50XCIsIFwicGFyZW50U2l6ZVwiLCBcInJlZGVlbUNyZWRpdFwiLCBcIm9uU3RhcnRDcmVkaXRSZWRlbXB0aW9uXCJdKTsgcy5zZXRJZnJhbWVzUG9wc3RhdGVIYW5kbGVycygpOyB2YXIgeCA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHBuLm9mZmVyQmFzZVVybCA/IHBuLm9mZmVyQmFzZVVybCA6IHBuLmdldEVuZHBvaW50Um9vdCgpICsgXCIvY2hlY2tvdXQvb2ZmZXIvc2hvd1wiOyB9OyBmdW5jdGlvbiBQKGUsIG4pIHsgdmFyIGMgPSBzLmdldElmcmFtZShlLnNlbmRlciksIGQgPSAhMDsgc3dpdGNoIChjICYmIGMuY29uZmlnICYmIChkID0gIWMuY29uZmlnLnBhcmVudCksIGUuZXZlbnQpIHtcbiAgICAgICAgY2FzZSBcImluaXRDb250ZXh0XCI6XG4gICAgICAgICAgICBpZiAoZS5wYXJhbXMgJiYgZS5wYXJhbXMucmVzdWx0Q2FsbGJhY2tJZCkge1xuICAgICAgICAgICAgICAgIHZhciBwID0geyByZXN1bHRDYWxsYmFja0lkOiBlLnBhcmFtcy5yZXN1bHRDYWxsYmFja0lkLCBhZmZpbGlhdGVTdGF0ZTogYy5jb25maWcuYWZmaWxpYXRlU3RhdGUgfTtcbiAgICAgICAgICAgICAgICBpLnNlbmQoXCJyZXN1bHRDYWxsYmFja1wiLCBwLCBlLnNlbmRlcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcInN0b3JlQ3VzdG9tVmFyaWFibGVzXCI6XG4gICAgICAgICAgICB0cC5zYXZlQ3VzdG9tVmFyaWFibGVzVG9Mb2NhbFN0b3JhZ2UoMzAwKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiZnVsbFJlZGlyZWN0VGhyZWVEU1wiOlxuICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBlLnBhcmFtcy5iYW5rU2VjdXJlVXJsO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJyZXNpemVcIjpcbiAgICAgICAgICAgIGlmIChlLnBhcmFtcy5pZnJhbWVJZCA9PT0gZS5zZW5kZXIpIHtcbiAgICAgICAgICAgICAgICB2YXIgZiA9IHZvaWQgMCA9PT0gZS5wYXJhbXMud2lkdGggPyB5ZSh5ZSh7fSwgZS5wYXJhbXMpLCB7IHdpZHRoOiByLmdldFdpZHRoKGMuY29udGFpbmVyKSB9KSA6IGUucGFyYW1zO1xuICAgICAgICAgICAgICAgIHMucmVzaXplSWZyYW1lKGMsIGYpLCBcIm1vZGFsXCIgPT09IGMuY29uZmlnLmRpc3BsYXlNb2RlICYmIChcImJvaWxlcnBsYXRlXCIgPT09IGUucGFyYW1zLmNsb3NlQnV0dG9uVHlwZSAmJiBzLmhpZGVDbG9zZUJ1dHRvbihjLmNvbnRhaW5lciksIHMuY2VudGVySXQoYy5jb250YWluZXIpKSwgaS5zZW5kKFwiYWZ0ZXJSZXNpemVcIiwge30sIGMuaWZyYW1lSWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgUy5maXJlQ2FsbGJhY2tzKGUuZXZlbnQsIGUucGFyYW1zLCBlLnNlbmRlciwgZCk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcInN0YXJ0Q2hlY2tvdXRcIjpcbiAgICAgICAgICAgIGlmIChlLnBhcmFtcy53aWR0aCA9IG51bGwsIFwiaW5saW5lXCIgPT09IGUuZGlzcGxheU1vZGUpIHtcbiAgICAgICAgICAgICAgICBlLnBhcmFtcy5jbG9zZU9uTG9nb3V0ID0gITA7XG4gICAgICAgICAgICAgICAgdmFyIG0gPSBxKGUucGFyYW1zLCBjLnN0YXRQYXJhbXMpO1xuICAgICAgICAgICAgICAgIG0uYnJvd3NlcklkID0gYy5icm93c2VySWQsIG0uaXNPcGVuZWRGcm9tSW5saW5lQ2hlY2tvdXQgPSAhMCwgSyhtLCBlLnNlbmRlcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlLnBhcmFtcy5pZnJhbWVJZCA9PT0gZS5zZW5kZXIgJiYgUy5maXJlQ2FsbGJhY2tzKGUuZXZlbnQsIGUucGFyYW1zLCBlLnNlbmRlciwgZCk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImxvYWRlZFwiOlxuICAgICAgICAgICAgaWYgKGUucGFyYW1zLmlmcmFtZUlkID09PSBlLnNlbmRlcikge1xuICAgICAgICAgICAgICAgIGlmIChpLnNlbmQoXCJzZXR1cEN1c3RvbVZhcmlhYmxlc1wiLCBrW2UucGFyYW1zLmlmcmFtZUlkXSwgZS5wYXJhbXMuaWZyYW1lSWQpLCBpLnNlbmQoXCJzZXR1cEVWVEZpZWxkc1wiLCBjLmNvbmZpZy5leHRlcm5hbFZlcmlmaWNhdGlvbkZpZWxkcywgZS5wYXJhbXMuaWZyYW1lSWQpLCBjLmNvbmZpZy5kZWZlcnJlZENvbnRleHRMb2FkaW5nICYmIFQoYywgZSksIGMud2FpdEZpbmlzaFByb2Nlc3NlcylcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZvaWQgcy5fX3Byb3RlY3RlZF9fLmNsb3NlQW5kUmVtb3ZlSWZyYW1lKGMpO1xuICAgICAgICAgICAgICAgIFwicGlhbm9JZFwiID09PSBhLmdldFByb3ZpZGVyKCkubmFtZSAmJiBwbi5waWFub0lkLl9fcHJvdGVjdGVkX18uZXhlY3V0ZVBvc3RNZXNzYWdlc0JhdGNoKCksIFwibW9kYWxcIiA9PT0gYy5jb25maWcuZGlzcGxheU1vZGUgJiYgKHMucmVzaXplSWZyYW1lKGMsIGUucGFyYW1zKSwgYy5jb25maWcuaXNQcmVsb2FkIHx8IHMuY2hlY2tCYWNrZHJvcEFuZENvbnRhaW5lcihjLCAhMCkpLCBcInBvcHVwXCIgPT09IGMuY29uZmlnLmRpc3BsYXlNb2RlICYmIHMucmVzaXplSWZyYW1lKGMsIGUucGFyYW1zKSwgYy5jb25maWcuaXNQcmVsb2FkIHx8IGMuY29uZmlnLnRyYWNrU3RhdHNPblNob3cgfHwgQihjKSwgVihjKSwgUy5maXJlQ2FsbGJhY2tzKGUuZXZlbnQsIGUucGFyYW1zLCBlLnNlbmRlciwgZCksIFwiaW5saW5lXCIgPT09IGMuY29uZmlnLmRpc3BsYXlNb2RlICYmIChjLmNvbnRhaW5lclJlYWR5ID8gcy5yZXNpemVJZnJhbWUoYywgZS5wYXJhbXMpIDogcy5vcGVyYXRpb25XaXRoQ29udGFpbmVyKGMuaWZyYW1lUGFyYW1zLmNvbnRhaW5lclNlbGVjdG9yLCAoZnVuY3Rpb24gKG4pIHsgdmFyIHQgPSByLnF1ZXJ5RWwoXCIjdGVtcC1pbmxpbmUtXCIgKyBjLmlmcmFtZUlkKTsgdCAmJiAobi5pbm5lckhUTUwgPSB0LmlubmVySFRNTCwgci5yZW1vdmUodCkpLCBjLmVsZW1lbnQgPSByLnF1ZXJ5RWwoXCJpZnJhbWVcIiwgbiksIGMuY29udGFpbmVyUmVhZHkgPSAhMCwgcy5yZXNpemVJZnJhbWUoYywgZS5wYXJhbXMpOyB9KSkpLCBSKGMuY29uZmlnKSwgby5kb25lQ2FsbChcIm9mZmVyQ3JlYXRlXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJkb3duRm9yTWFpbnRlbmFuY2VcIjpcbiAgICAgICAgICAgIHMucmVzaXplSWZyYW1lKGMsIHsgd2lkdGg6IDMwMCwgaGVpZ2h0OiAyMDAgfSksIFwibW9kYWxcIiA9PT0gYy5jb25maWcuZGlzcGxheU1vZGUgJiYgKGMuY29uZmlnLmlzUHJlbG9hZCB8fCBzLmNoZWNrQmFja2Ryb3BBbmRDb250YWluZXIoYykpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJyZW1vdmVRdWVyeVBhcmFtQnlOYW1lXCI6XG4gICAgICAgICAgICBlICYmIGUucGFyYW1zICYmIEFycmF5LmlzQXJyYXkoZS5wYXJhbXMucGFyYW1zVG9SZW1vdmUpICYmIGUucGFyYW1zLnBhcmFtc1RvUmVtb3ZlLmZvckVhY2goKGZ1bmN0aW9uIChlKSB7IG8ucmVtb3ZlUXVlcnlQYXJhbUJ5TmFtZShlKTsgfSkpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJwdXJnZVwiOlxuICAgICAgICAgICAgbiB8fCAoZSAmJiBlLnBhcmFtcyAmJiBlLnBhcmFtcy5hbHJlYWR5UHVyY2hhc2VkICYmICh2ID0gXCJhbHJlYWR5SGFzQWNjZXNzXCIpLCBlICYmIGUucGFyYW1zICYmIGUucGFyYW1zLmNvbXBsZXRlUGF5bWVudCAmJiAodiA9IFwiY2hlY2tvdXRDb21wbGV0ZWRcIiksIHMucHVyZ2VJZnJhbWUoZS5zZW5kZXIsIGMuY29uZmlnLnBhcmVudCksIFIoYy5jb25maWcpKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiY2xvc2VcIjpcbiAgICAgICAgICAgIG4gfHwgKGUgJiYgZS5wYXJhbXMgJiYgZS5wYXJhbXMuYWxyZWFkeVB1cmNoYXNlZCAmJiAodiA9IFwiYWxyZWFkeUhhc0FjY2Vzc1wiKSwgZSAmJiBlLnBhcmFtcyAmJiBlLnBhcmFtcy5jb21wbGV0ZVBheW1lbnQgJiYgKHYgPSBcImNoZWNrb3V0Q29tcGxldGVkXCIpLCBvLmhhc1F1ZXJ5UGFyYW1CeU5hbWUoXCJ2b3VjaGVyX2NvZGVcIikgJiYgKHYgPSBcInZvdWNoZXJSZWRlbXB0aW9uQ29tcGxldGVkXCIpLCBzLmNsb3NlQ29udGFpbmVyKGUuc2VuZGVyLCBjLmNvbmZpZy5wYXJlbnQpLCBSKGMuY29uZmlnKSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImNsb3NlQW5kUmVmcmVzaFwiOlxuICAgICAgICAgICAgdmFyIGcgPSBlLnBhcmFtcztcbiAgICAgICAgICAgIGcgPyB3aW5kb3cubG9jYXRpb24uYXNzaWduKGcpIDogd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJzZWxlY3RUZXJtXCI6XG4gICAgICAgICAgICB2ID0gZSAmJiBlLnBhcmFtcyAmJiBlLnBhcmFtcy5hbHJlYWR5UHVyY2hhc2VkID8gXCJhbHJlYWR5SGFzQWNjZXNzXCIgOiBcImNsb3NlXCI7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcInN1Ym1pdFBheW1lbnRcIjpcbiAgICAgICAgY2FzZSBcImNoZWNrb3V0U2VsZWN0VGVybVwiOlxuICAgICAgICAgICAgUy5maXJlQ2FsbGJhY2tzKGUuZXZlbnQsIHEoZS5wYXJhbXMsIHsgb2ZmZXJJZDogYy5pZnJhbWVQYXJhbXMub2ZmZXJJZCB9KSwgZS5zZW5kZXIsIGQpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJjb21wbGV0ZVwiOlxuICAgICAgICAgICAgaWYgKHZvaWQgMCAhPT0gZS5wYXJhbXMudG9rZW5fbGlzdCkge1xuICAgICAgICAgICAgICAgIHZhciBoID0gZS5wYXJhbXMudXNlcl90b2tlbjtcbiAgICAgICAgICAgICAgICAhaCAmJiBhLmlzVXNlclZhbGlkKCkgJiYgXCJwaWFub0lkXCIgPT09IGEuZ2V0UHJvdmlkZXIoKS5uYW1lICYmIChoID0gYS5nZXRQcm92aWRlcigpLmdldFRva2VuKCkpLCBvLnNldEFjY2Vzc1Rva2VuTGlzdENvb2tpZSh7IHZhbHVlOiBlLnBhcmFtcy50b2tlbl9saXN0LCBjb29raWVfZG9tYWluOiBlLnBhcmFtcy5jb29raWVfZG9tYWluIH0sIGgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIHkgPSBxKGUucGFyYW1zLCB7IG9mZmVySWQ6IGMuaWZyYW1lUGFyYW1zLm9mZmVySWQgfSk7XG4gICAgICAgICAgICBTLmZpcmVDYWxsYmFja3MoZS5ldmVudCwgeSwgZS5zZW5kZXIsIGQpLCB2ID0gXCJjaGVja291dENvbXBsZXRlZFwiO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJjaGVja291dFN0YXRlQ2hhbmdlXCI6XG4gICAgICAgIGNhc2UgXCJjaGVja291dFBheW1lbnRFcnJvclwiOlxuICAgICAgICBjYXNlIFwiYWxyZWFkeVB1cmNoYXNlZFwiOlxuICAgICAgICBjYXNlIFwic3RhcnRUaHJlZURCYW5rU2VjdXJlXCI6XG4gICAgICAgIGNhc2UgXCJjYW5jZWxcIjpcbiAgICAgICAgY2FzZSBcImVycm9yXCI6XG4gICAgICAgIGNhc2UgXCJjdXN0b21FdmVudFwiOlxuICAgICAgICAgICAgUy5maXJlQ2FsbGJhY2tzKGUuZXZlbnQsIGUucGFyYW1zLCBlLnNlbmRlciwgZCk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImxvZ2luUmVxdWlyZWRcIjpcbiAgICAgICAgICAgIHcgPSAhMCwgUy5maXJlQ2FsbGJhY2tzKGUuZXZlbnQsIG5lKGMsIGUucGFyYW1zKSwgZS5zZW5kZXIsIGQpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJsb2dvdXRcIjpcbiAgICAgICAgICAgIEEoZS5ldmVudCwgZS5wYXJhbXMsIGUuc2VuZGVyLCBjLmNvbmZpZy5wYXJlbnQpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJsb2dpblN1Y2Nlc3NcIjpcbiAgICAgICAgICAgIE0oZS5ldmVudCwgZS5wYXJhbXMsIGUuc2VuZGVyLCBkKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiaW5wdXRGb2N1c1wiOlxuICAgICAgICAgICAgdmFyIGIgPSByLnF1ZXJ5RWwoXCIudHAtbW9kYWxcIik7XG4gICAgICAgICAgICBiICYmIChiLnN0eWxlLnpJbmRleCA9IHBuLnpJbmRleGVzLm1vZGFsICsgMSArIFwiXCIsIGIuc3R5bGUuekluZGV4ID0gcG4uekluZGV4ZXMubW9kYWwgKyBcIlwiKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiaW5wdXRCbHVyXCI6XG4gICAgICAgICAgICB2YXIgXyA9IHIucXVlcnlFbChcIi50cC1tb2RhbFwiKTtcbiAgICAgICAgICAgIF8gJiYgKF8uc3R5bGUuekluZGV4ID0gcG4uekluZGV4ZXMubW9kYWwgKyAxICsgXCJcIiwgXy5zdHlsZS56SW5kZXggPSBwbi56SW5kZXhlcy5tb2RhbCArIFwiXCIpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJnZXRMb2NhdGlvblwiOlxuICAgICAgICAgICAgZS5wYXJhbXMgJiYgZS5wYXJhbXMucmVzdWx0Q2FsbGJhY2tJZCAmJiAoZS5wYXJhbXMucmVzdWx0ID0gd2luZG93LmxvY2F0aW9uLmhyZWYsIGkuc2VuZChcInJlc3VsdENhbGxiYWNrXCIsIGUucGFyYW1zLCBlLnNlbmRlcikpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJzZXRMb2NhdGlvbkhhc2hcIjpcbiAgICAgICAgICAgIGUucGFyYW1zICYmIGUucGFyYW1zLmhhc2ggJiYgKHdpbmRvdy5sb2NhdGlvbi5oYXNoID0gZS5wYXJhbXMuaGFzaCk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImxhbmdDaGFuZ2VkV2l0aGluT2ZmZXJcIjpcbiAgICAgICAgICAgIHBuLnBpYW5vSWQuaXNDb25maWd1cmVkKCkgJiYgcG4ucGlhbm9JZC51cGRhdGVMYW5nKGUucGFyYW1zLmxhbmcpLCBJLmluZGV4T2YoZS5wYXJhbXMubGFuZykgPj0gMCA/IHMudHVybk9uUlRMKGMpIDogcy50dXJuT2ZmUlRMKGMpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJsb2dpblN0YXJ0XCI6XG4gICAgICAgICAgICBsLmRpc2FibGUoKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwibG9naW5FbmRcIjpcbiAgICAgICAgICAgIGwuZW5hYmxlKCk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcInBpYW5vSWRFdmVudFwiOlxuICAgICAgICAgICAgZS5wYXJhbXMuaWZyYW1lSWQgPT09IGUuc2VuZGVyICYmIChcImNsb3NlZFwiID09PSBlLnBhcmFtcy5ldmVudCAmJiBzLmNsb3NlQ29udGFpbmVyKGUuc2VuZGVyKSwgcG4ucGlhbm9JZC5fX3Byb3RlY3RlZF9fLm9mZmVyTWVzc2FnZVJlY2VpdmVyKGUpKSwgRShlLnBhcmFtcywgZS5zZW5kZXIpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJzd2dDaGVja291dFN0YXJ0XCI6IGJyZWFrO1xuICAgICAgICBjYXNlIFwic2hhcmVkQWNjb3VudHNTdWNjZXNzZnVsbHlBZGRlZFwiOlxuICAgICAgICAgICAgaS5icm9hZGNhc3QoXCJyZWZyZXNoTXlBY2NvdW50XCIsIHsgdXNlclRva2VuOiBhLmdldFByb3ZpZGVyKCkuZ2V0VG9rZW4oKSB9KTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwibmV3c2xldHRlclNpZ251cEltcHJlc3Npb25cIjpcbiAgICAgICAgY2FzZSBcIm5ld3NsZXR0ZXJTaWdudXBTdWJtaXNzaW9uXCI6XG4gICAgICAgICAgICBwbi5waWFub0VzcC5fX3Byb3RlY3RlZF9fLm9mZmVyTWVzc2FnZVJlY2VpdmVyKGUpLCBTLmZpcmVDYWxsYmFja3MoZS5ldmVudCwgZS5wYXJhbXMsIGUuc2VuZGVyLCBkKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwicGFyZW50U2l6ZVwiOlxuICAgICAgICAgICAgdmFyIEMgPSByLndpblNpemUoKSwgeCA9IHsgd2lkdGg6IEMud2lkdGgsIGhlaWdodDogQy5oZWlnaHQgfTtcbiAgICAgICAgICAgIGkuc2VuZChcInBhcmVudFNpemVcIiwgeCwgZS5zZW5kZXIpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJnaWd5YVBhc3N3b3JkbGVzc0xvZ2luXCI6XG4gICAgICAgICAgICBlLnBhcmFtcy5pZnJhbWVJZCA9PT0gZS5zZW5kZXIgJiYgKHQgPSBlLnBhcmFtcy5pZnJhbWVJZCwgcG4uZ2lneWEubG9naW5CeVBhc3N3b3JkbGVzcyhlLnBhcmFtcykpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJlbWl0R0FFdmVudFwiOiByZXR1cm4gdm9pZCAoIW4gJiYgdS5lbWl0RXZlbnQoZS5wYXJhbXMpKTtcbiAgICAgICAgY2FzZSBcImVtaXRNZXRyaWNzRXZlbnRcIjpcbiAgICAgICAgICAgICFuICYmIHUuZW1pdE1ldHJpY3NFdmVudChlLnBhcmFtcyk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImJhbm5lckluaXRcIjpcbiAgICAgICAgICAgIGMuY29uZmlnLnNpbmdsZUNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKFwidHAtYmFubmVyXCIpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJiYW5uZXJEZXN0cm95XCI6XG4gICAgICAgICAgICBjLmNvbmZpZy5zaW5nbGVDb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZShcInRwLWJhbm5lclwiKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwicmVkZWVtQ3JlZGl0XCI6XG4gICAgICAgICAgICB2YXIgUCA9IFMuZmlyZUNhbGxiYWNrcyhcIm9uU3RhcnRDcmVkaXRSZWRlbXB0aW9uXCIsIGUucGFyYW1zLCBlLnNlbmRlciwgZCk7XG4gICAgICAgICAgICBQICYmIFAudGhlbiAmJiBQLnRoZW4oKGZ1bmN0aW9uIChuKSB7IGkuc2VuZChcInN1Y2Nlc3NmdWxseUNyZWRpdFJlZGVlbVwiLCBuLCBlLnNlbmRlcik7IH0pLCAoZnVuY3Rpb24gKG4pIHsgaS5zZW5kKFwiY3JlZGl0UmVkZWVtRmFpbGVkXCIsIG4sIGUuc2VuZGVyKTsgfSkpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGRlZmF1bHQ6IHJldHVybiB2b2lkIG8uZGVidWcoXCJSZWNlaXZlZCBpbnZhbGlkIGV2ZW50IHR5cGU6IFwiICsgZS5ldmVudCk7XG4gICAgfSB9IHZhciBFID0gZnVuY3Rpb24gKGUsIG4pIHsgXCJzdWNjZXNzRE9JXCIgPT09IGUuZXZlbnQgJiYgKGUuaWZyYW1lSWQgIT09IG4gJiYgcy5jbG9zZUNvbnRhaW5lcihlLmlmcmFtZUlkKSwgaS5zZW5kKFwiYWZ0ZXJTdWNjZXNzRE9JXCIsIGUucGFyYW1zLCBuKSk7IH0sIFQgPSBmdW5jdGlvbiAoZSwgbikgeyBlLmNvbmZpZy5jb250ZXh0TG9hZGluZ1Byb21pc2UudGhlbigoZnVuY3Rpb24gKHQpIHsgdmFyIHIgPSB7IGlmcmFtZVBhcmFtczogZS5pZnJhbWVQYXJhbXMsIHVzZXJDb250ZXh0OiB0IH07IHIuaWZyYW1lUGFyYW1zLnVybCA9IG8ucHJlcGFyZVVybFBhcmFtZXRlcih3aW5kb3cubG9jYXRpb24uaHJlZiksIGkuc2VuZChcInVzZXJEYXRhQ29udGV4dExvYWRlZFwiLCByLCBuLnBhcmFtcy5pZnJhbWVJZCk7IH0pKTsgfSwgQSA9IGZ1bmN0aW9uIChlLCBuLCB0LCByLCBvKSB7IGEubG9nb3V0KChmdW5jdGlvbiAoKSB7IHZhciBlID0ge307IGUudXNlclByb3ZpZGVyID0gYS5nZXRQcm92aWRlcigpLmdldE5hbWUoKSwgZS51c2VyVG9rZW4gPSBhLmdldFByb3ZpZGVyKCkuZ2V0VG9rZW4oKSAmJiBhLmdldFByb3ZpZGVyKCkuZ2V0VG9rZW4oKS5sZW5ndGggPiAwID8gYS5nZXRQcm92aWRlcigpLmdldFRva2VuKCkgOiBcIlwiLCBlLm5vTmVlZFN0YXJ0Q2hlY2tvdXQgPSAhMCwgZWUoZSk7IH0pLCBoKSwgbi5jbG9zZU9uTG9nb3V0ICYmIHMuY2xvc2VNb2RhbENvbnRhaW5lcih0LCByKTsgfSwgTSA9IGZ1bmN0aW9uIChlLCBuLCB0LCByKSB7IGlmIChuLnNvdXJjZSA9IGgsIGEuZ2V0UHJvdmlkZXIoKS5vbkxvZ2luU3VjY2VzcyhuKSwgUy5maXJlQ2FsbGJhY2tzKFwibG9naW5TdWNjZXNzXCIsIG4sIHQsIHIpLCAhYikge1xuICAgICAgICB2YXIgbyA9IHsgdXNlclRva2VuOiBuLnVzZXJfdG9rZW4sIHVzZXI6IG4udXNlciwgcmVsb2FkQWZ0ZXJMb2dpbjogITAgfTtcbiAgICAgICAgZWUobywgdCk7XG4gICAgfSB9LCBPID0gZnVuY3Rpb24gKGUpIHsgdmFyIG4gPSBlLmRpc3BsYXlNb2RlIHx8IFwibW9kYWxcIjsgcmV0dXJuIFtlLm9mZmVySWQsIG4sIGUuY29udGFpbmVyU2VsZWN0b3JdLmpvaW4oXCJ8XCIpOyB9LCBSID0gZnVuY3Rpb24gKGUpIHsgdmFyIG4gPSBPKGUpOyBkZWxldGUgbVtuXTsgfSwgTCA9IGZ1bmN0aW9uIChlKSB7IGlmICh2ID0gXCJjbG9zZVwiLCBRKGUpLCB2b2lkIDAgPT09IGUuZGlzcGxheU1vZGUpXG4gICAgICAgIGUuZGlzcGxheU1vZGUgPSBcIm1vZGFsXCI7XG4gICAgZWxzZSBpZiAoXCJtb2RhbFwiICE9PSBlLmRpc3BsYXlNb2RlICYmIFwiaW5saW5lXCIgIT09IGUuZGlzcGxheU1vZGUgJiYgXCJwb3B1cFwiICE9PSBlLmRpc3BsYXlNb2RlKVxuICAgICAgICByZXR1cm4gby5sb2coXCJJbnZhbGlkIG9mZmVyIGRpc3BsYXlNb2RlOyBtdXN0IGJlIG9uZSBvZjogbW9kYWwsIGlubGluZSwgcG9wdXBcIiksIHZvaWQgUihlKTsgaWYgKFwibW9kYWxcIiA9PT0gZS5kaXNwbGF5TW9kZSAmJiAhZS5pc1ByZWxvYWQgJiYgcy5oYXNNb2RhbElmcmFtZSgpKVxuICAgICAgICByZXR1cm4gby5sb2coXCJNb2RhbCBvZmZlciBpcyBhbHJlYWR5IHNob3duOyBtdXN0IGJlIG9uZSBtb2RhbCBvZmZlciBwZXIgdGltZVwiKSwgdm9pZCBSKGUpOyBpZiAoXCJtb2RhbFwiICE9PSBlLmRpc3BsYXlNb2RlKSB7XG4gICAgICAgIHZhciBuLCB0ID0gci5xYShlLmNvbnRhaW5lclNlbGVjdG9yKTtcbiAgICAgICAgaWYgKCFlLmlzUHJlbG9hZClcbiAgICAgICAgICAgIGlmICh0LmZvckVhY2goKGZ1bmN0aW9uICh0KSB7IHZhciByID0gcSh7fSwgZSk7IHIuc2luZ2xlQ29udGFpbmVyID0gdCwgbiA9IE4ocik7IH0pKSwgbilcbiAgICAgICAgICAgICAgICByZXR1cm4gbjtcbiAgICAgICAgdmFyIGkgPSB0W3QubGVuZ3RoIC0gMV07XG4gICAgICAgIGkgJiYgKGUuc2luZ2xlQ29udGFpbmVyID0gaSk7XG4gICAgfSByZXR1cm4gTihlKTsgfTsgZnVuY3Rpb24gTihlLCBjKSB7IHZhciBsID0gZnVuY3Rpb24gKGUpIHsgdmFyIG4gPSB7fTsgZS50ZXJtSWRzICYmIChlLnRlcm1JZHMgaW5zdGFuY2VvZiBBcnJheSB8fCAoZS50ZXJtSWRzID0gW2UudGVybUlkc10pKTsgdmFyIHQgPSBlLmFkZGl0aW9uYWxQYXJhbU5hbWVzID8gZS5hZGRpdGlvbmFsUGFyYW1OYW1lcyA6IFtdOyBbXCJkaXNwbGF5TW9kZVwiLCBcImNvbnRhaW5lclNlbGVjdG9yXCIsIFwidGVtcGxhdGVJZFwiLCBcInRlbXBsYXRlVmFyaWFudElkXCIsIFwib2ZmZXJJZFwiLCBcInRlcm1JZFwiLCBcInRlcm1JZHNcIiwgXCJyaWRcIiwgXCJhaWRcIiwgXCJpc0NoZWNrb3V0XCIsIFwiaXNPcGVuZWRGcm9tSW5saW5lQ2hlY2tvdXRcIiwgXCJwd19pZFwiLCBcInBheXdhbGxJZFwiLCBcIndpZHRoXCIsIFwicHJldmlld1wiLCBcInByZXZpZXdVbmNhY2hlZFwiLCBcInByZXZpZXdUZW1wbGF0ZVR5cGVcIiwgXCJwcmV2aWV3VGVtcGxhdGVWZXJzaW9uXCIsIFwidG9rZW5UeXBlXCIsIFwiamFucmFpbkNhcHR1cmVUb2tlblwiLCBcImNsb3NlT25Mb2dvdXRcIiwgXCJ2b3VjaGVyQ29kZVwiLCBcImlzUmVkZW1wdGlvblwiLCBcImFsbG93UmV0dXJuVG9TdGFydFN0YXRlXCIsIFwic3RhcnRGcm9tSW5saW5lQ2hlY2tvdXRcIiwgXCJmb3JtTmFtZUJ5VGVybUlkXCIsIFwiaGlkZUNvbXBsZXRlZEZpZWxkc1wiLCBcInN0YXJ0RnJvbUlubGluZUNoZWNrb3V0XCIsIFwicmVsb2FkQWZ0ZXJMb2dpblwiLCBcInByZXZlbnRSZWxvYWRBZnRlckxvZ2luXCIsIFwiaXNBdXRoXCIsIFwiYXV0aFN0YXJ0U2NyZWVuXCIsIFwic2hvd0Nsb3NlQnV0dG9uXCIsIFwiY2xvc2VCdXR0b25UeXBlXCIsIFwiY2hlY2tvdXRGbG93SWRcIiwgXCJvZmZlclN0YXRlXCIsIFwib2lkXCIsIFwicHJvbW9Db2RlXCIsIFwicHJvbW9Db2RlSWRcIiwgXCJwcm9tb0NvZGVUZXJtSWRcIiwgXCJydXJsXzNkc1wiLCBcInRoaXJkUGFydHlQYXJhbXNcIiwgXCJ0ZXJtSWQzZHNcIiwgXCJwcm92aWRlcklkXCIsIFwiZGVwbG95bWVudEl0ZW1JZFwiLCBcInNoYXJlZEFjY291bnRDb2RlXCIsIFwidGFyZ2V0ZWRUZXJtSWRcIiwgXCJ3aWRnZXRcIl0uY29uY2F0KFtcInRyYWNraW5nSWRcIiwgXCJleHBlcmllbmNlSWRcIiwgXCJhY3RpdmVNZXRlcnNcIl0sIHQpLmZvckVhY2goKGZ1bmN0aW9uICh0KSB7IGVbdF0gJiYgKG5bdF0gPSBlW3RdKSwgXCJzaG93Q2xvc2VCdXR0b25cIiA9PT0gdCAmJiAodm9pZCAwID09PSBlW3RdID8gblt0XSA9ICEwIDogblt0XSA9IGVbdF0pOyB9KSk7IHZhciByID0gZGVjb2RlVVJJQ29tcG9uZW50KG8uZ2V0UXVlcnlQYXJhbUJ5TmFtZShcIl9wdGlkXCIpKTsgcmV0dXJuIHIgJiYgKG4udHJhY2tpbmdJZCA9IHIpLCBlLnByZXZpZXcgJiYgKG4uYWN0aXZlTWV0ZXJzID0gSlNPTi5zdHJpbmdpZnkoW3sgbWV0ZXJOYW1lOiBcInByZXZpZXctbWV0ZXJcIiwgdmlld3M6IDEwLCB2aWV3c0xlZnQ6IDUsIG1heFZpZXdzOiAyMCwgdG90YWxWaWV3czogMjAgfV0pKSwgbjsgfShlKTsgbC53aWRnZXQgfHwgKGwud2lkZ2V0ID0gXCJvZmZlclwiKTsgdmFyIGQgPSBvLmdldFRiY0Nvb2tpZSgpOyBkICYmIGQubGVuZ3RoID4gMCAmJiAobC50YmMgPSBkKSwgZS5kZWZlcnJlZENvbnRleHRMb2FkaW5nID8gKGwuaWZyYW1lSWQgPSBVKGUpLCBsLnVybCA9IHdpbmRvdy5sb2NhdGlvbi5vcmlnaW4pIDogKGwuaWZyYW1lSWQgPSBcIm9mZmVyLVwiICsgZysrICsgXCItXCIgKyBvLnJhbmRvbVN0cmluZygpLCBsLnVybCA9IG8ucHJlcGFyZVVybFBhcmFtZXRlcih3aW5kb3cubG9jYXRpb24uaHJlZikpOyB2YXIgZiA9IHIud2luU2l6ZSgpOyBsLnBhcmVudER1YWxTY3JlZW5MZWZ0ID0gdm9pZCAwICE9PSB3aW5kb3cuc2NyZWVuTGVmdCA/IHdpbmRvdy5zY3JlZW5MZWZ0IDogc2NyZWVuLmxlZnQsIGwucGFyZW50RHVhbFNjcmVlblRvcCA9IHZvaWQgMCAhPT0gd2luZG93LnNjcmVlblRvcCA/IHdpbmRvdy5zY3JlZW5Ub3AgOiBzY3JlZW4udG9wLCBsLnBhcmVudFdpZHRoID0gZi53aWR0aCA/IGYud2lkdGggOiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGggPyBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGggOiBzY3JlZW4ud2lkdGgsIGwucGFyZW50SGVpZ2h0ID0gZi5oZWlnaHQgPyBmLmhlaWdodCA6IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQgPyBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0IDogc2NyZWVuLmhlaWdodCwgbC5wYXJlbnRPdXRlckhlaWdodCA9IHdpbmRvdy5vdXRlckhlaWdodCwgZS5wcmV2aWV3Tm9uTG9nZ2VkVXNlciAmJiAobC5wcmV2aWV3Tm9uTG9nZ2VkVXNlciA9IGUucHJldmlld05vbkxvZ2dlZFVzZXIpLCBlLmlzUHJlbG9hZCAmJiAobC5wcmVsb2FkID0gMSksIHBuLmxvY2FsZSAmJiAobC5sYW5nID0gcG4ubG9jYWxlKSwgdS5nZXRDbGllbnRJZCgpICYmIChsLmdhQ2xpZW50SWQgPSB1LmdldENsaWVudElkKCkpLCB1LmdldEdBQWNjb3VudCgpICYmIChsLmdhQWNjb3VudCA9IHUuZ2V0R0FBY2NvdW50KCkpLCBmdW5jdGlvbiAoZSkgeyBbXCJkZWJ1Z1wiLCBcImFpZFwiLCBcImdhQ2xpZW50SWRcIiwgXCJ0YWdzXCIsIFwiY29udGVudFNlY3Rpb25cIiwgXCJjb250ZW50QXV0aG9yXCIsIFwiZGVidWdcIiwgXCJ6b25lXCJdLmZvckVhY2goKGZ1bmN0aW9uIChuKSB7IHBuW25dICYmIChlW25dID0gcG5bbl0pOyB9KSksIHBuLmN1c3RvbVZhcmlhYmxlcyAmJiAoa1tlLmlmcmFtZUlkXSA9IEpTT04uc3RyaW5naWZ5KHBuLmN1c3RvbVZhcmlhYmxlcykpOyB2YXIgbiA9IHBuLmNvbnRlbnRDcmVhdGVkOyBuICYmIChlLmNvbnRlbnRDcmVhdGVkID0gbiksIHBuICYmIHBuLm1haW4gJiYgKGUucGFnZVZpZXdJZCA9IHBuLm1haW4uZmV0Y2hQYWdlVmlld0lkKCksIGUudmlzaXRJZCA9IHBuLm1haW4uZmV0Y2hWaXNpdElkKCkpOyB9KGwpOyB2YXIgbSA9IFMuaGFzQ2FsbGJhY2soXCJsb2dpblJlcXVpcmVkXCIpOyBpZiAoIXBuLmphbnJhaW4uaXNDb25maWd1cmVkKCkgfHwgdm9pZCAwICE9PSBlLmxvZ2luUmVxdWlyZWQgJiYgZS5sb2dpblJlcXVpcmVkKVxuICAgICAgICBpZiAoIXBuLmdpZ3lhLmlzQ29uZmlndXJlZCgpIHx8IHZvaWQgMCAhPT0gZS5sb2dpblJlcXVpcmVkICYmIGUubG9naW5SZXF1aXJlZClcbiAgICAgICAgICAgIGlmIChwbi5waWFub0lkLmlzQ29uZmlndXJlZCgpKSB7XG4gICAgICAgICAgICAgICAgdm9pZCAwICE9PSBlLmxvZ2luUmVxdWlyZWQgJiYgZS5sb2dpblJlcXVpcmVkIHx8IChlLmxvZ2luUmVxdWlyZWQgPSBmdW5jdGlvbiAoZSkgeyBpZiAoIWUucHJldmVudEV4dGVybmFsTG9naW4pXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuID0gZS50ZXJtSWQsIHQgPSBsLmlmcmFtZUlkLCBwbi5waWFub0lkLnNob3coeyBzY3JlZW46IGUuc3RhcnRTY3JlZW4gfSksICExOyB9KSwgVygpLCBsLnBpYW5vSWRVcmwgPSBwbi5waWFub0lkLmdldElmcmFtZVVybCgpO1xuICAgICAgICAgICAgICAgIHZhciBoID0gcG4ucGlhbm9JZC5nZXRMYW5nKCk7XG4gICAgICAgICAgICAgICAgaCAmJiAobC5sYW5nID0gaCksIHBuLnBpYW5vSWQub25MYW5nQ2hhbmdlKChmdW5jdGlvbiAoZSkgeyBpLnNlbmQoXCJsYW5nQ2hhbmdlZFwiLCB7IGxhbmc6IGUgfSwgbC5pZnJhbWVJZCk7IH0pLCBsLmlmcmFtZUlkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICBwbi5waWFub0lkTGl0ZS5pc0NvbmZpZ3VyZWQoKSAmJiAobC5waWFub0lkVXJsID0gcG4ucGlhbm9JZC5nZXRJZnJhbWVVcmwoKSk7XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgYiA9IFtdO1xuICAgICAgICAgICAgcG4uZ2lneWEucmVnaXN0ZXJDYWxsYmFjayhcIm9uSGlkZVwiLCAoZnVuY3Rpb24gKGUpIHsgcy5hY3RpdmF0ZUNvbnRhaW5lcnMoYiksIGkuc2VuZChcImdpZ3lhSGlkZVwiLCBlLCB0KTsgfSkpLCB6KCksIGUubG9naW5SZXF1aXJlZCA9IGZ1bmN0aW9uIChlKSB7IHJldHVybiB5ID0gZS5hbGxvd1JldHVyblRvU3RhcnRTdGF0ZSwgdyA9ICExLCBiID0gcy5oaWRlTW9kYWxDb250YWluZXIoKSwgbiA9IGUudGVybUlkLCB0ID0gbC5pZnJhbWVJZCwgby53YWl0Q2FsbChcInJlZnJlc2hVc2VyVG9rZW5cIiwgKGZ1bmN0aW9uICgpIHsgcG4uZ2lneWEubG9naW4oKTsgfSkpLCAhMTsgfTtcbiAgICAgICAgfVxuICAgIGVsc2Uge1xuICAgICAgICB2YXIgYiA9IFtdO1xuICAgICAgICBwbi5qYW5yYWluLmFkZEV2ZW50SGFuZGxlcihcIm9uTW9kYWxDbG9zZVwiLCAoZnVuY3Rpb24gKCkgeyBzLmFjdGl2YXRlQ29udGFpbmVycyhiKTsgfSkpLCBIKCksIGUubG9naW5SZXF1aXJlZCA9IGZ1bmN0aW9uIChlKSB7IHJldHVybiBiID0gcy5oaWRlTW9kYWxDb250YWluZXIoKSwgeSA9IGUuYWxsb3dSZXR1cm5Ub1N0YXJ0U3RhdGUsIHcgPSAhMSwgbiA9IGUudGVybUlkLCB0ID0gbC5pZnJhbWVJZCwgby53YWl0Q2FsbChcInJlZnJlc2hVc2VyVG9rZW5cIiwgKGZ1bmN0aW9uICgpIHsgcG4uamFucmFpbi5sb2dpbih2b2lkIDAsIGUpOyB9KSksICExOyB9O1xuICAgIH0gbC51c2VyUHJvdmlkZXIgPSBhLmdldFByb3ZpZGVyKCkuZ2V0TmFtZSgpLCBlLnVzZXJUb2tlbiA/IGwudXNlclRva2VuID0gZS51c2VyVG9rZW4gOiBsLnVzZXJUb2tlbiA9IGEuZ2V0UHJvdmlkZXIoKS5nZXRUb2tlbigpICYmIGEuZ2V0UHJvdmlkZXIoKS5nZXRUb2tlbigpLmxlbmd0aCA+IDAgPyBhLmdldFByb3ZpZGVyKCkuZ2V0VG9rZW4oKSA6IFwiXCIsIG8uZ2V0Q2FtcGFpZ25zKGwpLCBsLmN1c3RvbUNvb2tpZXMgPSBKU09OLnN0cmluZ2lmeShvLmdldEN1c3RvbUNvb2tpZXMoKSksIFMucmVnaXN0ZXJDYWxsYmFjayhlLCBsLmlmcmFtZUlkKSwgbC5oYXNMb2dpblJlcXVpcmVkQ2FsbGJhY2sgPSBTLmhhc0lmcmFtZUNhbGxiYWNrKFwibG9naW5SZXF1aXJlZFwiLCBsLmlmcmFtZUlkKSB8fCBtLCBsLmluaXRNb2RlID0gXCJjb250ZXh0XCIsIGoobCk7IHZhciBfID0gZS5pZnJhbWVVcmwgPyBlLmlmcmFtZVVybCA6IGwuaXNDaGVja291dCA/IHBuLmdldEVuZHBvaW50Um9vdCghMCkgKyBcIi9jaGVja291dC9vZmZlci9zaG93XCIgOiB4KCksIEkgPSBlLnBvc3RNZXNzYWdlVXJsID8gZS5wb3N0TWVzc2FnZVVybCA6IHgoKTsgZS5kZWZlcnJlZENvbnRleHRMb2FkaW5nICYmIGUuaW5pdENvbnRleHRMb2FkUHJvbWlzZShlLCBEKGwpKTsgdmFyIEUgPSBGKGwsIGUpLCBUID0gcy5jcmVhdGVDb250YWluZXIoeyB1cmw6IF8sIGNvbmZpZzogZSwgcGFyZW50OiBlLnBhcmVudCwgcG9zdE1lc3NhZ2VVcmw6IEksIHJlY2VpdmU6IFAsIGlmcmFtZVBhcmFtczogbCwgc2luZ2xlQ29udGFpbmVyOiBlLnNpbmdsZUNvbnRhaW5lciwgY2xvc2U6IGZ1bmN0aW9uICgpIHsgUy5maXJlQ2FsbGJhY2tzKFwiY2xvc2VcIiwgeyBzdGF0ZTogdiB9LCBsLmlmcmFtZUlkLCAhMCk7IH0gfSksIEEgPSBfLmluZGV4T2YoXCIvb2ZmZXIvXCIpID8gXCJvZmZlclNob3dcIiA6IFwidGVtcGxhdGVTaG93XCI7IHJldHVybiBwLnNldFRpbWUoQSksIEMgPSBfLmluZGV4T2YoXCIvdGVtcGxhdGUvXCIpICYmIGwub2ZmZXJJZCA9PT0gcy5mYWtlT2ZmZXJJZCA/IGwgOiBDLCBULnN0YXRQYXJhbXMgPSBFLCBULmJyb3dzZXJJZCA9IGUuYnJvd3NlcklkLCBUOyB9IHZhciBVID0gZnVuY3Rpb24gKGUpIHsgdmFyIG4gPSAwLCB0ID0gXCJvZmZlcl9cIiArIGQuaGFzaChlLmlmcmFtZVVybCArIFwiP1wiICsgZS5idWlsZFF1ZXJ5U3RyaW5nRm4oZSwgciksIDIwKTsgcmV0dXJuIF8uaGFzKHQpICYmIChuID0gXy5nZXQodCkgKyAxKSwgXy5zZXQodCwgbiksIHQgKyBcIi1cIiArIG47IH0sIGogPSBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IG8uZ2V0UXVlcnlQYXJhbUJ5TmFtZShcInRlcm1JZFwiKSwgdCA9IG8uZ2V0UXVlcnlQYXJhbUJ5TmFtZShcInBheVNvdXJjZVwiKTsgbiAmJiAoZS50ZXJtSWQgPSBuKSwgdCAmJiAoZS5wYXlTb3VyY2UgPSB0KTsgfSwgRCA9IGZ1bmN0aW9uIChlKSB7IHZhciBuID0ge307IHJldHVybiBbXCJ0YmNcIiwgXCJ0cmFja2luZ0lkXCIsIFwicGFnZVZpZXdJZFwiLCBcInZpc2l0SWRcIiwgXCJ0YWdzXCIsIFwiY29udGVudENyZWF0ZWRcIiwgXCJjb250ZW50U2VjdGlvblwiLCBcImNvbnRlbnRBdXRob3JcIl0uZm9yRWFjaCgoZnVuY3Rpb24gKHQpIHsgZVt0XSAmJiAoblt0XSA9IGVbdF0pOyB9KSksIE9iamVjdC5rZXlzKGUpLmZvckVhY2goKGZ1bmN0aW9uICh0KSB7IDAgPT09IHQuaW5kZXhPZihcInRwY2NfXCIpICYmIChuW3RdID0gZVt0XSk7IH0pKSwgbjsgfSwgRiA9IGZ1bmN0aW9uIChlLCBuKSB7IHZhciB0ID0ge307IHJldHVybiBuLnRyYWNrU3RhdHNPblNob3cgfHwgbi5kZWZlcnJlZENvbnRleHRMb2FkaW5nIHx8ICh0ID0gRChlKSwgT2JqZWN0LmtleXModCkuZm9yRWFjaCgoZnVuY3Rpb24gKG4pIHsgZGVsZXRlIGVbbl07IH0pKSksIHQ7IH0sIEIgPSBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IHEoZS5pZnJhbWVQYXJhbXMsIGUuc3RhdFBhcmFtcyk7IGUuY29uZmlnLmFmZmlsaWF0ZVN0YXRlICYmIChuLmFmZmlsaWF0ZVN0YXRlID0gZS5jb25maWcuYWZmaWxpYXRlU3RhdGUpLCBpLnNlbmQoXCJ0cmFja1N0YXRcIiwgbiwgZS5pZnJhbWVJZCk7IH0sIFYgPSBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IHsgYnJvd3NlcklkOiBlLmJyb3dzZXJJZCB9OyBpLnNlbmQoXCJwYXNzQnJvd3NlcklkXCIsIG4sIGUuaWZyYW1lSWQpOyB9LCBxID0gZnVuY3Rpb24gKGUsIG4pIHsgdmFyIHQgPSB7fTsgcmV0dXJuIE9iamVjdC5rZXlzKGUpLmZvckVhY2goKGZ1bmN0aW9uIChuKSB7IHRbbl0gPSBlW25dOyB9KSksIE9iamVjdC5rZXlzKG4pLmZvckVhY2goKGZ1bmN0aW9uIChlKSB7IHRbZV0gPSBuW2VdOyB9KSksIHQ7IH0sIHogPSBmdW5jdGlvbiAoKSB7IGIgfHwgKHBuLmdpZ3lhLnJlZ2lzdGVyQ2FsbGJhY2soXCJ1c2VyQ2hhbmdlZFwiLCAoZnVuY3Rpb24gKGUpIHsgaWYgKGUgJiYgZS51c2VyX3Rva2VuKSB7XG4gICAgICAgIHZhciByID0geyB0b2tlbl9saXN0OiBlLmFjY2Vzc190b2tlbi52YWx1ZSwgdXNlcl90b2tlbjogZS51c2VyX3Rva2VuLCB1c2VyVG9rZW46IGUudXNlcl90b2tlbiwgY29va2llX2RvbWFpbjogZS5hY2Nlc3NfdG9rZW4uY29va2llX2RvbWFpbiwgdXNlcjogZS51c2VyLCBhbGxvd1JldHVyblRvU3RhcnRTdGF0ZTogeSwgdGVybUlkOiBuIH07XG4gICAgICAgIGlmICh0KVxuICAgICAgICAgICAgcy5nZXRJZnJhbWUodCkgPyAoaS5zZW5kKFwiZXh0ZXJuYWxMb2dpblN1Y2Nlc3NcIiwgciwgdCksIGRlbGV0ZSByLnRlcm1JZCwgZWUociwgdCkpIDogZWUocik7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIGVlKHIpO1xuICAgIH0gfSkpLCBwbi5naWd5YS5yZWdpc3RlckNhbGxiYWNrKFwibG9nb3V0XCIsIChmdW5jdGlvbiAoKSB7IHZhciBlLCByID0ge307IHIudXNlclByb3ZpZGVyID0gYS5nZXRQcm92aWRlcigpLmdldE5hbWUoKSwgci51c2VyVG9rZW4gPSBhLmdldFByb3ZpZGVyKCkuZ2V0VG9rZW4oKSAmJiBhLmdldFByb3ZpZGVyKCkuZ2V0VG9rZW4oKS5sZW5ndGggPiAwID8gYS5nZXRQcm92aWRlcigpLmdldFRva2VuKCkgOiBcIlwiLCByLm5vTmVlZFN0YXJ0Q2hlY2tvdXQgPSAhMCwgdCAmJiAoZSA9IHMuZ2V0SWZyYW1lKHQpKSwgZSAmJiBcImlubGluZVwiID09PSBlLmNvbmZpZy5kaXNwbGF5TW9kZSAmJiBzLmNsb3NlTW9kYWxDb250YWluZXIoKSwgbiA9IFwiXCIsIHQgPSBcIlwiLCB5ID0gITEsIGVlKHIpOyB9KSksIGIgPSAhMCk7IH0sIEggPSBmdW5jdGlvbiAoKSB7IGIgfHwgKHBuLmphbnJhaW4ucmVnaXN0ZXJDYWxsYmFjayhcInVzZXJDaGFuZ2VkXCIsIChmdW5jdGlvbiAoZSkgeyBpZiAoZSAmJiBlLnVzZXJfdG9rZW4pIHtcbiAgICAgICAgdmFyIHIgPSB7IHRva2VuX2xpc3Q6IGUuYWNjZXNzX3Rva2VuLnZhbHVlLCB1c2VyX3Rva2VuOiBlLnVzZXJfdG9rZW4sIHVzZXJUb2tlbjogZS51c2VyX3Rva2VuLCBjb29raWVfZG9tYWluOiBlLmFjY2Vzc190b2tlbi5jb29raWVfZG9tYWluLCB1c2VyOiBlLnVzZXIsIGFsbG93UmV0dXJuVG9TdGFydFN0YXRlOiB5LCB0ZXJtSWQ6IG4gfTtcbiAgICAgICAgaWYgKHQpXG4gICAgICAgICAgICBzLmdldElmcmFtZSh0KSA/IChpLnNlbmQoXCJleHRlcm5hbExvZ2luU3VjY2Vzc1wiLCByLCB0KSwgZGVsZXRlIHIudGVybUlkLCBlZShyLCB0KSkgOiBlZShyKTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgZWUocik7XG4gICAgfSB9KSksIHBuLmphbnJhaW4uYWRkRXZlbnRIYW5kbGVyKFwib25DYXB0dXJlU2Vzc2lvbkVuZGVkXCIsIChmdW5jdGlvbiAoKSB7IHZhciBlLCByID0ge307IHIudXNlclByb3ZpZGVyID0gYS5nZXRQcm92aWRlcigpLmdldE5hbWUoKSwgci51c2VyVG9rZW4gPSBhLmdldFByb3ZpZGVyKCkuZ2V0VG9rZW4oKSAmJiBhLmdldFByb3ZpZGVyKCkuZ2V0VG9rZW4oKS5sZW5ndGggPiAwID8gYS5nZXRQcm92aWRlcigpLmdldFRva2VuKCkgOiBcIlwiLCByLm5vTmVlZFN0YXJ0Q2hlY2tvdXQgPSAhMCwgdCAmJiAoZSA9IHMuZ2V0SWZyYW1lKHQpKSwgZSAmJiBcImlubGluZVwiID09PSBlLmNvbmZpZy5kaXNwbGF5TW9kZSAmJiBzLmNsb3NlTW9kYWxDb250YWluZXIoKSwgbiA9IFwiXCIsIHQgPSBcIlwiLCB5ID0gITEsIGVlKHIpOyB9KSksIGIgPSAhMCk7IH0sIFcgPSBmdW5jdGlvbiAoKSB7IGIgfHwgKHBuLnBpYW5vSWQuc2V0Q2FsbGJhY2tzKHsgbG9nZ2VkSW46IGZ1bmN0aW9uIChlKSB7IG8ubG9nKFwib2ZmZXIuanMgLSBwaWFubyBpZCB1c2VyIGxvZ2dlZCBpblwiKTsgdmFyIHIgPSB7IHVzZXJfdG9rZW46IGUudG9rZW4sIHVzZXJUb2tlbjogZS50b2tlbiwgdXNlcjogZS51c2VyLCByZWxvYWRBZnRlckxvZ2luOiAhMCwgdGVybUlkOiBuIH07IHQgPyBzLmdldElmcmFtZSh0KSA/IChpLnNlbmQoXCJleHRlcm5hbExvZ2luU3VjY2Vzc1wiLCByLCB0KSwgWih0LCByKSwgZGVsZXRlIHIudGVybUlkLCBlZShyLCB0KSkgOiBlZShyKSA6IGVlKHIpOyB9LCBsb2dnZWRPdXQ6IGZ1bmN0aW9uIChlKSB7IGlmIChlLnNvdXJjZSAhPT0gaCkge1xuICAgICAgICAgICAgdmFyIHIgPSB7fTtcbiAgICAgICAgICAgIHIudXNlclByb3ZpZGVyID0gYS5nZXRQcm92aWRlcigpLmdldE5hbWUoKSwgci51c2VyVG9rZW4gPSBhLmdldFByb3ZpZGVyKCkuZ2V0VG9rZW4oKSAmJiBhLmdldFByb3ZpZGVyKCkuZ2V0VG9rZW4oKS5sZW5ndGggPiAwID8gYS5nZXRQcm92aWRlcigpLmdldFRva2VuKCkgOiBcIlwiLCByLm5vTmVlZFN0YXJ0Q2hlY2tvdXQgPSAhMCwgZWUocik7XG4gICAgICAgIH0gbiA9IFwiXCIsIHQgPSBcIlwiOyB9IH0pLCBiID0gITApOyB9OyBmdW5jdGlvbiBKKGUpIHsgcmV0dXJuIHMuc2hvd1ByZWxvYWRlZENvbnRhaW5lcihlKTsgfSB2YXIgRyA9IGZ1bmN0aW9uIChlKSB7IHZhciBuID0gZS5vZmZlcklkID09PSBzLmZha2VPZmZlcklkID8gXCJzaG93VGVtcGxhdGVcIiA6IFwic2hvd09mZmVyXCI7IFMuaGFzQ2FsbGJhY2sobikgJiYgUy5maXJlQ2FsbGJhY2tzKG4sIGUsIHZvaWQgMCwgITApOyB9LCBRID0gZnVuY3Rpb24gKGUpIHsgW3sgcXVlcnlQYXJhbTogXCJwcm9tb19jb2RlXCIsIGNvbmZpZ1BhcmFtOiBcInByb21vQ29kZVwiIH1dLmZvckVhY2goKGZ1bmN0aW9uIChuKSB7IHZhciB0ID0gby5nZXRRdWVyeVBhcmFtQnlOYW1lKG4ucXVlcnlQYXJhbSk7IHQubGVuZ3RoICYmIChlW24uY29uZmlnUGFyYW1dID0gdCk7IH0pKTsgfSwgWCA9IGZ1bmN0aW9uIChlKSB7IGlmIChlLm9mZmVySWQgfHwgITAgPT09IGUucHJldmlldykge1xuICAgICAgICBpZiAoZnVuY3Rpb24gKGUpIHsgdmFyIG4gPSBPKGUpOyByZXR1cm4gISFtW25dOyB9KGUpKVxuICAgICAgICAgICAgcmV0dXJuICExO1xuICAgICAgICBlLnByZXZpZXcgfHwgZnVuY3Rpb24gKGUpIHsgdmFyIG4gPSBPKGUpOyBtW25dID0gITA7IH0oZSksIHNldFRpbWVvdXQoKGZ1bmN0aW9uICgpIHsgUihlKTsgfSksIDFlNCksIG8ud2FpdENhbGwoXCJyZWZyZXNoVXNlclRva2VuXCIsIChmdW5jdGlvbiAoKSB7IG8ud2FpdENhbGwoXCJyZWZyZXNoQWNjZXNzVG9rZW5MaXN0XCIsIChmdW5jdGlvbiAoKSB7IG8ud2FpdENhbGwoXCJteUFjY291bnRMb2dpblwiLCAoZnVuY3Rpb24gKCkgeyB2YXIgbjsgaWYgKG8uc3RhcnRDYWxsKFwib2ZmZXJDcmVhdGVcIiksIGUuY3JlYXRlSWZyYW1lRm4gPyAoUShlKSwgbiA9IGUuY3JlYXRlSWZyYW1lRm4oZSkpIDogbiA9IEwoZSksICFuKVxuICAgICAgICAgICAgcmV0dXJuIG8uZG9uZUNhbGwoXCJvZmZlckNyZWF0ZVwiKSwgdm9pZCBvLmVycm9yKFwiQ291bGQgbm90IGluaXRpYWxpemUgb2ZmZXI7IGNoZWNrIGNvbmZpZ3VyYXRpb25cIik7ICQoZSkgJiYgWShuLmlmcmFtZUlkKSwgRyhlKTsgfSkpOyB9KSk7IH0pKTtcbiAgICB9XG4gICAgZWxzZVxuICAgICAgICBvLmVycm9yKFwiTXVzdCBzcGVjaWZ5IG9mZmVySWRcIik7IH07IHZhciAkID0gZnVuY3Rpb24gKGUpIHsgcmV0dXJuICEhZS5kaXJlY3RDaGVja291dCAmJiBcImlubGluZVwiICE9PSBlLmRpc3BsYXlNb2RlOyB9LCBZID0gZnVuY3Rpb24gKGUpIHsgby53YWl0Q2FsbChcIm9mZmVyQ3JlYXRlXCIsIChmdW5jdGlvbiAoKSB7IGkuc2VuZChcInN0YXJ0RGlyZWN0Q2hlY2tvdXRcIiwge30sIGUpOyB9KSk7IH0sIEsgPSBmdW5jdGlvbiAoZSwgbikgeyBpZiAoIWZ1bmN0aW9uIChlKSB7IHJldHVybiAhZS5vZmZlcklkICYmICFlLmlzUmVkZW1wdGlvbiAmJiAhZS5wcmV2aWV3OyB9KGUpKSB7XG4gICAgICAgIHZhciB0ID0gUy5oYXNDYWxsYmFjayhcImxvZ2luUmVxdWlyZWRcIik7XG4gICAgICAgIGUuaXNTaXRlTGljZW5zaW5nICYmIHQgJiYgKHRlKCkgfHwgcmUoKSkgPyBmLnJlZnJlc2hVc2VyKEMuaWZyYW1lSWQpIDogKHMuaGFzTW9kYWxJZnJhbWUoKSAmJiBzLmNsb3NlTW9kYWxDb250YWluZXIoKSwgby5kZWJ1ZyhcImNyZWF0aW5nIGNoZWNrb3V0OiBcIiwgZSksIGUuZGlzcGxheU1vZGUgPSBcInBvcHVwXCIgPT09IGUuZGlzcGxheU1vZGUgPyBcInBvcHVwXCIgOiBcIm1vZGFsXCIsIGUuaXNDaGVja291dCA9ICEwLCBlLnBhcmVudCA9IG4sIG8ud2FpdENhbGwoXCJyZWZyZXNoVXNlclRva2VuXCIsIChmdW5jdGlvbiAoKSB7IG8ud2FpdENhbGwoXCJyZWZyZXNoQWNjZXNzVG9rZW5MaXN0XCIsIChmdW5jdGlvbiAoKSB7IHZhciB0OyBvLnN0YXJ0Q2FsbChcIm9mZmVyQ3JlYXRlXCIpLCB0ID0gZS5jcmVhdGVJZnJhbWVGbiA/IGUuY3JlYXRlSWZyYW1lRm4oZSkgOiBMKGUpLCBzLl9fcHJvdGVjdGVkX18uYWRkQ2hpbGRUb0lubGluZUlmcmFtZSh0LCBuKSwgdCA/IHcgJiYgby53YWl0Q2FsbChcIm9mZmVyQ3JlYXRlXCIsIChmdW5jdGlvbiAoKSB7IHcgPSAhMTsgdmFyIGUgPSB7fTsgZS51c2VyUHJvdmlkZXIgPSBhLmdldFByb3ZpZGVyKCkuZ2V0TmFtZSgpLCBhLmdldFByb3ZpZGVyKCkuZ2V0VG9rZW4oKSAmJiBhLmdldFByb3ZpZGVyKCkuZ2V0VG9rZW4oKS5sZW5ndGggPiAwID8gZS51c2VyVG9rZW4gPSBhLmdldFByb3ZpZGVyKCkuZ2V0VG9rZW4oKSA6IGUudXNlclRva2VuID0gXCJcIiwgZS5ub05lZWRTdGFydENoZWNrb3V0ID0gITAsIGUubm9OZWVkU3RhcnRDaGVja291dEFmdGVyTG9naW4gPSAhMCwgZWUoZSwgdC5pZnJhbWVJZCk7IH0pKSA6IChvLmRvbmVDYWxsKFwib2ZmZXJDcmVhdGVcIiksIG8uZXJyb3IoXCJDb3VsZCBub3Qgc3RhcnQgY2hlY2tvdXQ7IGNoZWNrIGNvbmZpZ3VyYXRpb25cIikpOyB9KSk7IH0pKSk7XG4gICAgfSB9LCBaID0gZnVuY3Rpb24gKGUsIG4pIHsgaS5zZW5kKFwicmVsb2FkT2ZmZXJcIiwgbiwgZSk7IH0sIGVlID0gZnVuY3Rpb24gKGUsIG4pIHsgaS5icm9hZGNhc3QoXCJyZWxvYWRPZmZlclwiLCBlLCBuKTsgfSwgbmUgPSBmdW5jdGlvbiAoZSwgbikgeyB2YXIgdCA9IHsgcmVsb2FkQWZ0ZXJMb2dpbjogITAgfTsgcmV0dXJuIE9iamVjdC5hc3NpZ24odCwgZS5jb25maWcpLCB0LnNpbmdsZUNvbnRhaW5lciAmJiBkZWxldGUgdC5zaW5nbGVDb250YWluZXIsIG4udGVybUlkICYmICh0LnRlcm1JZCA9IG4udGVybUlkKSwgbi50ZXJtICYmICh0LnRlcm0gPSB7fSwgdC50ZXJtID0gcSh0LnRlcm0sIG4udGVybSkpLCBuLnN0YXJ0U2NyZWVuICYmICh0LnN0YXJ0U2NyZWVuID0gbi5zdGFydFNjcmVlbiksIG4uaXNSZWRlbXB0aW9uICYmICh0LmlzUmVkZW1wdGlvbiA9IG4uaXNSZWRlbXB0aW9uLCB0LnZvdWNoZXJDb2RlID0gbi5yZWRlbXB0aW9uICYmIG4ucmVkZW1wdGlvbi5mb3JtICYmIG4ucmVkZW1wdGlvbi5mb3JtLnJlZGVlbUNvZGUsIHQudGVybUlkID0gbnVsbCksIG4gJiYgbi5jdXJyZW50U3RhdGUgJiYgXCJtb2RhbFwiID09PSBlLmNvbmZpZy5kaXNwbGF5TW9kZSAmJiAodC5hbGxvd1JldHVyblRvU3RhcnRTdGF0ZSA9ICEwKSwgbi5wcmV2ZW50RXh0ZXJuYWxMb2dpbiAmJiAodC5wcmV2ZW50RXh0ZXJuYWxMb2dpbiA9IG4ucHJldmVudEV4dGVybmFsTG9naW4pLCBuLnNoYXJlZEFjY291bnRDb2RlICYmICh0LnNoYXJlZEFjY291bnRDb2RlID0gbi5zaGFyZWRBY2NvdW50Q29kZSksIG4uaXNTaXRlTGljZW5zaW5nICYmICh0LmlzU2l0ZUxpY2Vuc2luZyA9IG4uaXNTaXRlTGljZW5zaW5nKSwgbi5jYW1wYWlnbkNvZGUgJiYgKHQuY2FtcGFpZ25Db2RlID0gbi5jYW1wYWlnbkNvZGUpLCBuLmNhbXBhaWduR3JvdXBJZCAmJiAodC5jYW1wYWlnbkdyb3VwSWQgPSBuLmNhbXBhaWduR3JvdXBJZCksIHQuZGlzcGxheU1vZGUgPSBcIm1vZGFsXCIsIHQ7IH0sIHRlID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gXCJwdWJsaXNoZXJfdXNlcl9yZWZcIiA9PT0gYS5nZXRQcm92aWRlcigpLmdldE5hbWUoKTsgfSwgcmUgPSBmdW5jdGlvbiAoKSB7IHJldHVybiBcInBpYW5vX2lkX2xpdGVcIiA9PT0gYS5nZXRQcm92aWRlcigpLmdldE5hbWUoKTsgfTsgcmV0dXJuIHsgbmFtZTogXCJvZmZlclwiLCBzaG93OiBmdW5jdGlvbiAoZSkgeyBcImlubGluZVwiID09PSBlLmRpc3BsYXlNb2RlID8gcy5vcGVyYXRpb25XaXRoQ29udGFpbmVyKGUuY29udGFpbmVyU2VsZWN0b3IsIChmdW5jdGlvbiAoKSB7IFgoZSk7IH0pKSA6IFgoZSk7IH0sIGRlZmVycmVkU2hvdzogZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGZ1bmN0aW9uIChlKSB7IHZhciBuLCB0LCByLCBpID0gbmV3IFByb21pc2UoKGZ1bmN0aW9uIChlLCByKSB7IG4gPSBlLCB0ID0gcjsgfSkpLCBhID0gbmV3IFByb21pc2UoKGZ1bmN0aW9uIChlLCBuKSB7IHIgPSBlOyB9KSk7IHJldHVybiBcInBvcHVwXCIgIT09IGUuZGlzcGxheU1vZGUgJiYgZS5vZmZlcklkID8gby53YWl0Q2FsbChcInJlZnJlc2hBY2Nlc3NUb2tlbkxpc3RcIiwgKGZ1bmN0aW9uICgpIHsgdmFyIGk7IGUuaXNQcmVsb2FkID0gITAsIG8uc3RhcnRDYWxsKFwib2ZmZXJDcmVhdGVcIiksIGUuY3JlYXRlSWZyYW1lRm4gPyAoUShlKSwgaSA9IGUuY3JlYXRlSWZyYW1lRm4oZSkpIDogaSA9IEwoZSksIGkgPyAoaS5lbGVtZW50Lm9ubG9hZCA9IGZ1bmN0aW9uICgpIHsgcihpKTsgfSwgbihpKSkgOiAoby5kb25lQ2FsbChcIm9mZmVyQ3JlYXRlXCIpLCBvLmVycm9yKFwiQ291bGQgbm90IGluaXRpYWxpemUgb2ZmZXI7IGNoZWNrIGNvbmZpZ3VyYXRpb25cIiksIHQoKSk7IH0pKSA6IHQoKSwgeyBwcm9taXNlOiBpLCBzaG93OiBmdW5jdGlvbiAoKSB7IGkudGhlbihKKS50aGVuKChmdW5jdGlvbiAoKSB7IHJldHVybiBhOyB9KSkudGhlbigoZnVuY3Rpb24gKG4pIHsgQihuKSwgJChlKSAmJiBZKG4uaWZyYW1lSWQpLCBHKGUpOyB9KSwgKGZ1bmN0aW9uICgpIHsgWChlKSwgZGVsZXRlIGUuaXNQcmVsb2FkOyB9KSk7IH0gfTsgfShlKTsgfSwgY2xvc2U6IGZ1bmN0aW9uICgpIHsgcy5jbG9zZU1vZGFsQ29udGFpbmVyKCk7IH0sIGNsb3NlSW5saW5lOiBmdW5jdGlvbiAoZSkgeyBzLl9fcHJvdGVjdGVkX18uY2xvc2VJbmxpbmVDb250YWluZXJzKGUpOyB9LCBzdGFydENoZWNrb3V0OiBLLCBzdGFydFJlZGVlbVZvdWNoZXI6IGZ1bmN0aW9uIChlLCBuKSB7IHMuY2xvc2VNb2RhbENvbnRhaW5lcigpLCBlIHx8IChlID0ge30pLCBlLmlzUmVkZW1wdGlvbiA9ICEwLCBvLmRlYnVnKFwic3RhcnRpbmcgcmVkZWVtIHZvdWNoZXI6IFwiLCBlKSwgZS5kaXNwbGF5TW9kZSA9IFwicG9wdXBcIiA9PT0gZS5kaXNwbGF5TW9kZSA/IFwicG9wdXBcIiA6IFwibW9kYWxcIiwgZS5pc0NoZWNrb3V0ID0gITEsIGUucGFyZW50ID0gbiwgby53YWl0Q2FsbChcInJlZnJlc2hBY2Nlc3NUb2tlbkxpc3RcIiwgKGZ1bmN0aW9uICgpIHsgby5zdGFydENhbGwoXCJvZmZlckNyZWF0ZVwiKSwgKGUuY3JlYXRlSWZyYW1lRm4gPyBlLmNyZWF0ZUlmcmFtZUZuKGUpIDogTChlKSkgfHwgKG8uZG9uZUNhbGwoXCJvZmZlckNyZWF0ZVwiKSwgby5lcnJvcihcIkNvdWxkIG5vdCBzdGFydCByZWRlZW07IGNoZWNrIGNvbmZpZ3VyYXRpb25cIikpOyB9KSk7IH0sIGNyZWF0ZU9mZmVySWZyYW1lOiBMLCBzaG93QmFja2Ryb3A6IGZ1bmN0aW9uICgpIHsgcy5zaG93QmFja2Ryb3AoKTsgfSwgaGlkZUJhY2tkcm9wOiBmdW5jdGlvbiAoKSB7IHMuaGlkZUJhY2tkcm9wKCk7IH0sIGNlbnRlckJhY2tkcm9wOiBmdW5jdGlvbiAoZSkgeyBzLmNlbnRlckJhY2tkcm9wKGUpOyB9LCByZWdpc3RlckNhbGxiYWNrOiBmdW5jdGlvbiAoZSwgbikgeyBTLmFkZEV2ZW50KGUpLCBTLnJlZ2lzdGVyQ2FsbGJhY2soZSwgbik7IH0sIHJlbG9hZDogWiwgcmVsb2FkQWxsOiBmdW5jdGlvbiAoZSwgbikgeyB2YXIgdCA9IGUgfHwge307IG8ud2FpdENhbGwoXCJyZWZyZXNoVXNlclRva2VuXCIsIChmdW5jdGlvbiAoKSB7IGVlKE9iamVjdC5hc3NpZ24odCwgeyB1c2VyVG9rZW46IHBuLnVzZXIuZ2V0UHJvdmlkZXIoKS5nZXRUb2tlbigpIH0pLCBuKTsgfSkpOyB9LCByZXNldFVzZXJBbmRSZWxvYWRBbGw6IGZ1bmN0aW9uIChlLCBuKSB7IHZhciB0ID0gZSB8fCB7fTsgZWUoT2JqZWN0LmFzc2lnbih0LCB7IHVzZXJUb2tlbjogXCJcIiB9KSwgbik7IH0sIGNoZWNrVGhyZWVEU1JlZGlyZWN0OiBmdW5jdGlvbiAoKSB7IHZhciBlID0gXCJwbl9ydXJsXzNkc1wiLCBuID0gby5nZXRRdWVyeVBhcmFtQnlOYW1lKGUpOyBpZiAobikge1xuICAgICAgICAgICAgdmFyIHQgPSB7IG9mZmVySWQ6IFwicG5fb2ZmZXJfaWRcIiwgb2lkOiBcInBuX29pZFwiLCB0ZXJtSWQzZHM6IFwicG5fdGVybV9pZFwiLCBwcm92aWRlcklkOiBcInBuX3Byb3ZpZGVyX2lkXCIsIHRoaXJkUGFydHlQYXJhbXM6IFwidGhpcmRfcGFydHlfcGFyYW1zXCIgfSwgciA9IFtlXSwgaSA9IE9iamVjdC5rZXlzKHQpLnJlZHVjZSgoZnVuY3Rpb24gKGUsIG4pIHsgdmFyIGkgPSBPYmplY3QuYXNzaWduKHt9LCBlKTsgcmV0dXJuIGlbbl0gPSBvLmdldFF1ZXJ5UGFyYW1CeU5hbWUodFtuXSksIHIucHVzaCh0W25dKSwgaTsgfSksIHt9KTtcbiAgICAgICAgICAgIG8ucmVtb3ZlUXVlcnlQYXJhbUJ5TmFtZShyKSwgWChPYmplY3QuYXNzaWduKHsgZGlzcGxheU1vZGU6IFwibW9kYWxcIiwgcnVybF8zZHM6IG4gfSwgaSkpO1xuICAgICAgICB9IH0gfTsgfTtcbiAgICBwbi5jb250YWluZXIucmVnaXN0ZXIoXCJvZmZlclwiLCB7IHVzZVZhbHVlOiBHZSgpIH0pLCBwbi5vZmZlciA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwib2ZmZXJcIik7XG4gICAgdmFyIFFlID0gZnVuY3Rpb24gKCkgeyB2YXIgZSwgbiA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwianFVdGlsc1wiKSwgdCA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwidXRpbFwiKSwgciA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwicG9zdG1lc3NhZ2VcIiksIG8gPSBwbi5jb250YWluZXIucmVzb2x2ZShcIm9mZmVyXCIpLCBpID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJ1c2VyXCIpLCBhID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJjb250YWluZXJVdGlsc1wiKSwgcyA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwicGlhbm9JZFwiKSwgYyA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwibG9nZ2luZ1wiKSwgbCA9IHt9LCB1ID0gITEsIGQgPSB7IGxvZ2luUmVxdWlyZWQ6IFtdLCBsb2dpblN1Y2Nlc3M6IFtdIH0sIHAgPSBmdW5jdGlvbiAoKSB7IHJldHVybiBwbi5nZXRFbmRwb2ludFJvb3QoKSArIFwiL2NoZWNrb3V0L215YWNjb3VudC9zaG93XCI7IH0sIGYgPSBmdW5jdGlvbiAoZSwgbikgeyBlLmVsZW1lbnQuc3R5bGUuaGVpZ2h0ID0gKGUuY29uZmlnLm1heEhlaWdodCA/IE1hdGgubWluKG4uaGVpZ2h0LCBlLmNvbmZpZy5tYXhIZWlnaHQpIDogbi5oZWlnaHQpICsgXCJweFwiLCBlLmNvbnRhaW5lci5zdHlsZS5oZWlnaHQgPSAoZS5jb25maWcubWF4SGVpZ2h0ID8gTWF0aC5taW4obi5oZWlnaHQsIGUuY29uZmlnLm1heEhlaWdodCkgOiBuLmhlaWdodCkgKyBcInB4XCIsIGUuZWxlbWVudC5zdHlsZS53aWR0aCA9IG4ud2lkdGggKyBcInB4XCIsIFwibW9kYWxcIiA9PT0gZS5jb25maWcuZGlzcGxheU1vZGUgJiYgKGUuY29udGFpbmVyLnN0eWxlLndpZHRoID0gbi53aWR0aCArIFwicHhcIiksIHIuc2VuZChcInJlc2l6ZWRcIiwgeyBoZWlnaHQ6IGUuY29uZmlnLm1heEhlaWdodCA/IE1hdGgubWluKG4uaGVpZ2h0LCBlLmNvbmZpZy5tYXhIZWlnaHQpIDogbi5oZWlnaHQsIHdpZHRoOiBuLndpZHRoIH0sIGUuaWZyYW1lSWQpOyB9LCBtID0gZnVuY3Rpb24gKHQsIHIsIGkpIHsgcmV0dXJuIGZ1bmN0aW9uICgpIHsgZSAmJiAobi5yZW1vdmVDbGFzcyhcInRwLWFjdGl2ZVwiLCBlKSwgby5oaWRlQmFja2Ryb3AoKSwgd2luZG93LnNldFRpbWVvdXQoKGZ1bmN0aW9uICgpIHsgbi5yZW1vdmUoZSk7IH0pLCAyNTApLCByLnJlc3VsdCA9IGksIHQocikpOyB9OyB9LCBnID0gZnVuY3Rpb24gKGUpIHsgdmFyIHQgPSBuLndpblNpemUoKTsgZS5vZmZzZXRIZWlnaHQgPiB0LmhlaWdodCA/ICghMSA9PT0gdSAmJiAoZS5zdHlsZS5wb3NpdGlvbiA9IFwiYWJzb2x1dGVcIiwgdSA9ICEwKSwgZS5zdHlsZS5tYXJnaW5Ub3AgPSB3aW5kb3cuc2Nyb2xsWSAtIC41ICogdC5oZWlnaHQgKyBcIlwiKSA6ICghMCA9PT0gdSAmJiAoZS5zdHlsZS5wb3NpdGlvbiA9IFwiZml4ZWRcIiwgdSA9ICExKSwgZS5zdHlsZS5tYXJnaW5Ub3AgPSAwIC0gLjUgKiBlLm9mZnNldEhlaWdodCArIFwiXCIpLCBvLmNlbnRlckJhY2tkcm9wKGUpLCBlLnN0eWxlLm1hcmdpbkxlZnQgPSAwIC0gLjUgKiBlLm9mZnNldFdpZHRoICsgXCJcIjsgfSwgdiA9IGZ1bmN0aW9uICh0LCBpKSB7ICFmdW5jdGlvbiAodCwgcikgeyB2YXIgaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7IG4uYWRkQ2xhc3MoXCJ0cC1tb2RhbFwiLCBpKTsgdmFyIGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpOyBuLmFkZENsYXNzKFwidHAtY2xvc2VcIiwgYSk7IHZhciBzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTsgbi5hZGRDbGFzcyhcInRwLW1lc3NhZ2VcIiwgcyksIGkuc3R5bGUud2lkdGggPSAodC53aWR0aCA/IHQud2lkdGggOiA0MDApICsgXCJweFwiLCBzLmlubmVySFRNTCA9IHQubWVzc2FnZTsgdmFyIGMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpOyBuLmFkZENsYXNzKFwidHAtYnRuLWNvbnRhaW5lclwiLCBjKTsgdmFyIGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYnV0dG9uXCIpOyBuLmFkZENsYXNzKFwidHAtYnRuXCIsIGwpLCBuLmFkZENsYXNzKFwidHAtb2stYnRuXCIsIGwpLCBsLmlubmVySFRNTCA9IHQub2sgPyB0Lm9rIDogXCJPa1wiOyB2YXIgdSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIik7IG4uYWRkQ2xhc3MoXCJ0cC1idG5cIiwgdSksIG4uYWRkQ2xhc3MoXCJ0cC1jYW5jZWwtYnRuXCIsIHUpLCB1LmlubmVySFRNTCA9IHQuY2FuY2VsID8gdC5jYW5jZWwgOiBcIkNhbmNlbFwiLCBuLm9uKGEsIFwiY2xpY2tcIiwgbShyLCB0LCBcImNhbmNlbFwiKSksIG4ub24odSwgXCJjbGlja1wiLCBtKHIsIHQsIFwiY2FuY2VsXCIpKSwgbi5vbihsLCBcImNsaWNrXCIsIG0ociwgdCwgXCJva1wiKSksIG4uYXBwZW5kKGksIGEpLCBuLmFwcGVuZChpLCBzKSwgbi5hcHBlbmQoYywgbCksIG4uYXBwZW5kKGMsIHUpLCBuLmFwcGVuZChpLCBjKSwgbi5hcHBlbmQoZG9jdW1lbnQuYm9keSwgaSksIG8uc2hvd0JhY2tkcm9wKCksIG4uYWRkQ2xhc3MoXCJ0cC1hY3RpdmVcIiwgaSksIGcoaSksIGUgPSBpOyB9KGkucGFyYW1zLCAoZnVuY3Rpb24gKGUpIHsgci5zZW5kKFwiY2xvc2VEaWFsb2dcIiwgZSwgbFtpLnNlbmRlcl0uaWZyYW1lSWQpOyB9KSk7IH0sIGggPSBmdW5jdGlvbiAoZSwgbikgeyBkW2VdID0gZFtlXSB8fCBbXSwgZFtlXS5wdXNoKG4pOyB9LCB3ID0gZnVuY3Rpb24gKGUsIG4sIG8pIHsgaWYgKHQuZGVidWcoXCJyZWNlaXZlZCBldmVudDogXCIgKyBlLCBuKSwgdm9pZCAwICE9PSBkW2VdKSB7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZFtlXS5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgdC5kZWJ1ZyhcImZpcmluZyBjYWxsYmFjayBmb3IgZXZlbnQ6IFwiICsgZSk7XG4gICAgICAgICAgICB2YXIgYSA9IGRbZV1baV0obik7XG4gICAgICAgICAgICBuICYmIG4ucmVzdWx0Q2FsbGJhY2tJZCAmJiAobi5yZXN1bHQgPSBhLCBuLmV2ZW50ID0gZSwgci5zZW5kKFwicmVzdWx0Q2FsbGJhY2tcIiwgbiwgbykpO1xuICAgICAgICB9XG4gICAgICAgICFkW2VdLmxlbmd0aCAmJiBuICYmIG4ucmVzdWx0Q2FsbGJhY2tJZCAmJiAobi5jYWxsYmFja05vdEZvdW5kID0gITAsIG4uZXZlbnQgPSBlLCByLnNlbmQoXCJyZXN1bHRDYWxsYmFja1wiLCBuLCBvKSk7XG4gICAgfSB9LCB5ID0gZnVuY3Rpb24gKGUpIHsgc3dpdGNoICh0LmxvZyhcIioqKiBNeSBhY2NvdW50IGV2ZW50IHJlY2VpdmVkXCIsIGUuZXZlbnQsIGUucGFyYW1zKSwgZS5ldmVudCkge1xuICAgICAgICBjYXNlIFwicmVzaXplXCI6XG4gICAgICAgICAgICB0LmRlYnVnKFwiKioqIFJlc2l6ZSBldmVudFwiLCBlLnBhcmFtcy53aWR0aCwgZS5wYXJhbXMuaGVpZ2h0KSwgZihsW2Uuc2VuZGVyXSwgZS5wYXJhbXMpLCBcIm1vZGFsXCIgPT09IGxbZS5zZW5kZXJdLmNvbmZpZy5kaXNwbGF5TW9kZSAmJiBnKGxbZS5zZW5kZXJdLmNvbnRhaW5lcik7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImxvYWRlZFwiOlxuICAgICAgICAgICAgci5zZW5kKFwiaW5pdE1heEhlaWdodFwiLCB7IGhlaWdodDogbFtlLnNlbmRlcl0uY29uZmlnLm1heEhlaWdodCB9LCBsW2Uuc2VuZGVyXS5pZnJhbWVJZCksIGYobFtlLnNlbmRlcl0sIGUucGFyYW1zKSwgXCJwaWFub0lkXCIgPT09IGkuZ2V0UHJvdmlkZXIoKS5uYW1lICYmIHMuX19wcm90ZWN0ZWRfXy5leGVjdXRlUG9zdE1lc3NhZ2VzQmF0Y2goKSwgXCJtb2RhbFwiID09PSBsW2Uuc2VuZGVyXS5jb25maWcuZGlzcGxheU1vZGUgJiYgd2luZG93LnNldFRpbWVvdXQoKGZ1bmN0aW9uICgpIHsgbi5hZGRDbGFzcyhcInRwLWFjdGl2ZVwiLCBsW2Uuc2VuZGVyXS5jb250YWluZXIpLCBnKGxbZS5zZW5kZXJdLmNvbnRhaW5lcik7IH0pLCAyNSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImNhbmNlbFwiOlxuICAgICAgICBjYXNlIFwiY29tcGxldGVcIjpcbiAgICAgICAgY2FzZSBcImVycm9yXCI6XG4gICAgICAgIGNhc2UgXCJsb2dpblJlcXVpcmVkXCI6XG4gICAgICAgIGNhc2UgXCJjdXN0b21FdmVudFwiOlxuICAgICAgICAgICAgdyhlLmV2ZW50LCBlLnBhcmFtcywgZS5zZW5kZXIpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJvcGVuRGlhbG9nXCI6XG4gICAgICAgICAgICB2KGUuZXZlbnQsIGUpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJwaWFub0lkUHJvZmlsZVVwZGF0ZWRcIjpcbiAgICAgICAgICAgIHMub25Qcm9maWxlVXBkYXRlKGUucGFyYW1zLCAoZnVuY3Rpb24gKCkgeyB2YXIgbiA9IGUucGFyYW1zOyBuICYmIG4ucmVzdWx0Q2FsbGJhY2tJZCAmJiByLnNlbmQoXCJyZXN1bHRDYWxsYmFja1wiLCBuLCBlLnNlbmRlcik7IHZhciB0ID0geyB1c2VyVG9rZW46IGUucGFyYW1zLnRva2VuLCB1c2VyOiBlLnBhcmFtcy51c2VyIH07IGIodCk7IH0pKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiZXh0ZW5kZWRVc2VyTG9naW5SZXF1aXJlZFwiOlxuICAgICAgICAgICAgcy5vbkV4dGVuZGVkVXNlckxvZ2luUmVxdWlyZWQoKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwibG9naW5TdWNjZXNzXCI6XG4gICAgICAgICAgICBpLmdldFByb3ZpZGVyKCkub25Mb2dpblN1Y2Nlc3MoZS5wYXJhbXMpO1xuICAgICAgICAgICAgdmFyIG8gPSB7IHJlbG9hZEFmdGVyTG9naW46ICEwLCB1c2VyVG9rZW46IGUucGFyYW1zLnVzZXJfdG9rZW4sIHVzZXI6IGUucGFyYW1zLnVzZXIgfTtcbiAgICAgICAgICAgIGIobyksIHcoZS5ldmVudCwgZS5wYXJhbXMsIGUuc2VuZGVyKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwibG9nb3V0XCI6XG4gICAgICAgICAgICBpLmxvZ291dCgoZnVuY3Rpb24gKCkgeyB2YXIgZSA9IHt9OyBlLnVzZXJQcm92aWRlciA9IGkuZ2V0UHJvdmlkZXIoKS5nZXROYW1lKCksIGUudXNlclRva2VuID0gaS5nZXRQcm92aWRlcigpLmdldFRva2VuKCkgJiYgaS5nZXRQcm92aWRlcigpLmdldFRva2VuKCkubGVuZ3RoID4gMCA/IGkuZ2V0UHJvdmlkZXIoKS5nZXRUb2tlbigpIDogXCJcIiwgYihlKTsgfSkpLCB3KGUuZXZlbnQsIGUucGFyYW1zLCBlLnNlbmRlcik7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcInVzZXJQcm9maWxlVXBkYXRlU3VjY2Vzc1wiOlxuICAgICAgICAgICAgdmFyIGEgPSBlLCBjID0gYS5ldmVudCwgdSA9IGEucGFyYW1zLCBkID0gYS5zZW5kZXI7XG4gICAgICAgICAgICBpLmdldFByb3ZpZGVyKCkub25Mb2dpblN1Y2Nlc3ModSk7XG4gICAgICAgICAgICB2YXIgcCA9IHsgdXNlclByb3ZpZGVyOiB1LnVzZXJfcHJvdmlkZXIsIHVzZXJUb2tlbjogdS51c2VyX3Rva2VuIH07XG4gICAgICAgICAgICBmb3IgKHZhciBtIGluIGIocCksIHcoYywgdSwgZCksIGwpXG4gICAgICAgICAgICAgICAgaWYgKGwuaGFzT3duUHJvcGVydHkobSkpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGggPSBsW21dLmNvbmZpZztcbiAgICAgICAgICAgICAgICAgICAgaC5oYXNPd25Qcm9wZXJ0eShcInVzZXJUb2tlblwiKSAmJiBkZWxldGUgaC51c2VyVG9rZW4sIEkoaCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJsYW5nQ2hhbmdlZFdpdGhpbk15QWNjb3VudFwiOlxuICAgICAgICAgICAgcy5pc0NvbmZpZ3VyZWQoKSAmJiBzLnVwZGF0ZUxhbmcoZS5wYXJhbXMubGFuZyk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcInJlcXVlc3RTY3JvbGxEYXRhXCI6XG4gICAgICAgICAgICBrKGUuc2VuZGVyKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiZG93bkZvck1haW50ZW5hbmNlXCI6XG4gICAgICAgICAgICBmKGxbZS5zZW5kZXJdLCB7IHdpZHRoOiAzMDAsIGhlaWdodDogMjAwIH0pO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJyZW1vdmVRdWVyeVBhcmFtQnlOYW1lXCI6XG4gICAgICAgICAgICBBcnJheS5pc0FycmF5KGUucGFyYW1zLnBhcmFtc1RvUmVtb3ZlKSAmJiBlLnBhcmFtcy5wYXJhbXNUb1JlbW92ZS5mb3JFYWNoKChmdW5jdGlvbiAoZSkgeyB0LnJlbW92ZVF1ZXJ5UGFyYW1CeU5hbWUoZSk7IH0pKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiZ2V0VHJhY2tpbmdEYXRhXCI6XG4gICAgICAgICAgICByLnNlbmQoXCJnZXRUcmFja2luZ0RhdGFSZXNwb25zZUV2ZW50XCIsIHsgcGFnZVZpZXdJZDogcG4ubWFpbi5mZXRjaFBhZ2VWaWV3SWQoKSwgdGJjOiB0LmdldFRiY0Nvb2tpZSgpIH0sIGUuc2VuZGVyKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBkZWZhdWx0OiByZXR1cm4gdm9pZCB0LmxvZyhcIlJlY2VpdmVkIGludmFsaWQgZXZlbnQgdHlwZTogXCIgKyBlLmV2ZW50KTtcbiAgICB9IH0sIGIgPSBmdW5jdGlvbiAoZSkgeyByLmJyb2FkY2FzdChcInJlbG9hZE9mZmVyXCIsIGUpOyB9LCBrID0gZnVuY3Rpb24gKGUpIHsgdmFyIG4gPSBsW2VdLmVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCksIHQgPSB7IGlmcmFtZVJlY3Q6IHsgYm90dG9tOiBuLmJvdHRvbSwgaGVpZ2h0OiBuLmhlaWdodCwgbGVmdDogbi5sZWZ0LCByaWdodDogbi5yaWdodCwgdG9wOiBuLnRvcCwgd2lkdGg6IG4ud2lkdGggfSB9OyByLnNlbmQoXCJyZXR1cm5TY3JvbGxEYXRhXCIsIHQsIGUpOyB9OyBmdW5jdGlvbiBfKGUpIHsgdmFyIG8gPSB7IHdpZGdldDogXCJteWFjY291bnRcIiB9OyBpZiAoZS50ZW1wbGF0ZUlkICYmIChvLnRlbXBsYXRlSWQgPSBlLnRlbXBsYXRlSWQpLCB2b2lkIDAgPT09IGUuZGlzcGxheU1vZGUpXG4gICAgICAgIGUuZGlzcGxheU1vZGUgPSBcImlubGluZVwiO1xuICAgIGVsc2UgaWYgKFwibW9kYWxcIiAhPT0gZS5kaXNwbGF5TW9kZSAmJiBcImlubGluZVwiICE9PSBlLmRpc3BsYXlNb2RlKVxuICAgICAgICByZXR1cm4gdm9pZCB0LmxvZyhcIkludmFsaWQgb2ZmZXIgZGlzcGxheU1vZGU7IG11c3QgYmUgb25lIG9mOiBtb2RhbCwgaW5saW5lXCIpOyBpZiAoby5kaXNwbGF5TW9kZSA9IGUuZGlzcGxheU1vZGUsIG8uaWZyYW1lSWQgPSB0LnJhbmRvbVN0cmluZygxNiksIG8udXJsID0gd2luZG93LmxvY2F0aW9uLmhyZWYsIG8uaW5pdGlhbFdpZHRoID0gZS53aWR0aCwgby5pbml0aWFsSGVpZ2h0ID0gZS5oZWlnaHQsIG8ubWF4SGVpZ2h0ID0gZS5tYXhIZWlnaHQsIHBuLmxvY2FsZSAmJiAoby5sYW5nID0gcG4ubG9jYWxlKSwgIXBuLmphbnJhaW4uaXNDb25maWd1cmVkKCkgfHwgdm9pZCAwICE9PSBlLmxvZ2luUmVxdWlyZWQgJiYgZS5sb2dpblJlcXVpcmVkKVxuICAgICAgICBpZiAoIXBuLmdpZ3lhLmlzQ29uZmlndXJlZCgpIHx8IHZvaWQgMCAhPT0gZS5sb2dpblJlcXVpcmVkICYmIGUubG9naW5SZXF1aXJlZClcbiAgICAgICAgICAgIGlmIChwbi5waWFub0lkLmlzQ29uZmlndXJlZCgpKSB7XG4gICAgICAgICAgICAgICAgdiA9IGU7XG4gICAgICAgICAgICAgICAgaWYgKHBuLnBpYW5vSWQuc2V0Q2FsbGJhY2tzKHsgbG9nZ2VkSW46IGZ1bmN0aW9uIChuKSB7IHZhciB0OyBvLnVzZXJUb2tlbiAhPT0gbi50b2tlbiAmJiAoZS5sb2dpblN1Y2Nlc3MgJiYgKHQgPSBlLmxvZ2luU3VjY2VzcyhuKSksICh2b2lkIDAgPT09IHQgfHwgdCkgJiYgKHYudXNlclRva2VuID0gbi50b2tlbiwgSSh2KSkpOyB9LCBsb2dnZWRPdXQ6IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSB7fTsgZS51c2VyUHJvdmlkZXIgPSBpLmdldFByb3ZpZGVyKCkuZ2V0TmFtZSgpLCBlLnVzZXJUb2tlbiA9IGkuZ2V0UHJvdmlkZXIoKS5nZXRUb2tlbigpICYmIGkuZ2V0UHJvdmlkZXIoKS5nZXRUb2tlbigpLmxlbmd0aCA+IDAgPyBpLmdldFByb3ZpZGVyKCkuZ2V0VG9rZW4oKSA6IFwiXCIsIGIoZSk7IH0gfSksIHZvaWQgMCA9PT0gZS5sb2dpblJlcXVpcmVkIHx8ICFlLmxvZ2luUmVxdWlyZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHMgPSAwO1xuICAgICAgICAgICAgICAgICAgICBlLmxvZ2luUmVxdWlyZWQgPSBmdW5jdGlvbiAoKSB7IGlmICgrK3MgPiAxMClcbiAgICAgICAgICAgICAgICAgICAgICAgIHQubG9nKFwiVG9vIG1hbnkgYXR0ZW1wcyB0byBsb2dpbiBmb3IgbXlBY2NvdW50XCIpO1xuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlID0gdC5nZXRRdWVyeVBhcmFtQnlOYW1lKFwidmVyaWZpY2F0aW9uX2NvZGVcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBwbi5waWFub0lkLnNob3coeyB2ZXJpZmljYXRpb25Db2RlOiBlIH0pO1xuICAgICAgICAgICAgICAgICAgICB9IH07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIG8ucGlhbm9JZFVybCA9IHBuLnBpYW5vSWQuZ2V0SWZyYW1lVXJsKCk7XG4gICAgICAgICAgICAgICAgdmFyIHUgPSBwbi5waWFub0lkLmdldExhbmcoKTtcbiAgICAgICAgICAgICAgICB1ICYmIChvLmxhbmcgPSB1KSwgcG4ucGlhbm9JZC5vbkxhbmdDaGFuZ2UoKGZ1bmN0aW9uIChlKSB7IHIuc2VuZChcImxhbmdDaGFuZ2VkXCIsIHsgbGFuZzogZSB9LCBvLmlmcmFtZUlkKTsgfSksIG8uaWZyYW1lSWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIHBuLnBpYW5vSWRMaXRlLmlzQ29uZmlndXJlZCgpICYmIChvLnBpYW5vSWRVcmwgPSBwbi5waWFub0lkLmdldElmcmFtZVVybCgpKTtcbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBtID0gW107XG4gICAgICAgICAgICBwbi5naWd5YS5yZWdpc3RlckNhbGxiYWNrKFwib25IaWRlXCIsIChmdW5jdGlvbiAoKSB7IGEuYWN0aXZhdGVDb250YWluZXJzKG0pLCB0LmRvbmVDYWxsKFwibXlBY2NvdW50TG9naW5cIik7IH0pKSwgZS5sb2dpblJlcXVpcmVkID0gZnVuY3Rpb24gKCkgeyB2YXIgbiA9IGU7IHQud2FpdENhbGwoXCJyZWZyZXNoQWNjZXNzVG9rZW5MaXN0XCIsIChmdW5jdGlvbiAoKSB7IHQud2FpdENhbGwoXCJvZmZlckNyZWF0ZVwiLCAoZnVuY3Rpb24gKCkgeyB0LnN0YXJ0Q2FsbChcIm15QWNjb3VudExvZ2luXCIpLCBtID0gYS5oaWRlTW9kYWxDb250YWluZXIoKSwgcG4uZ2lneWEubG9naW4oKGZ1bmN0aW9uICh0KSB7IHZhciByOyBlLmxvZ2luU3VjY2VzcyAmJiAociA9IGUubG9naW5TdWNjZXNzKHQpKSwgKHZvaWQgMCA9PT0gciB8fCByKSAmJiAobi51c2VyVG9rZW4gPSB0LnVzZXJfdG9rZW4sIEkobikpOyB9KSk7IH0pKTsgfSkpOyB9O1xuICAgICAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHZhciBtID0gW10sIHYgPSBlO1xuICAgICAgICBwbi5qYW5yYWluLmFkZEV2ZW50SGFuZGxlcihcIm9uTW9kYWxDbG9zZVwiLCAoZnVuY3Rpb24gKCkgeyBhLmFjdGl2YXRlQ29udGFpbmVycyhtKSwgdC5kb25lQ2FsbChcIm15QWNjb3VudExvZ2luXCIpOyB9KSksIHBuLmphbnJhaW4ucmVnaXN0ZXJDYWxsYmFjayhcInVzZXJDaGFuZ2VkXCIsIChmdW5jdGlvbiAobikgeyB2YXIgdDsgbiAmJiBuLnVzZXJfdG9rZW4gJiYgKGUubG9naW5TdWNjZXNzICYmICh0ID0gZS5sb2dpblN1Y2Nlc3MobikpLCAodm9pZCAwID09PSB0IHx8IHQpICYmICh2LnVzZXJUb2tlbiA9IG4udXNlcl90b2tlbiwgSSh2KSkpOyB9KSksIHBuLmphbnJhaW4uYWRkRXZlbnRIYW5kbGVyKFwib25DYXB0dXJlU2Vzc2lvbkVuZGVkXCIsIChmdW5jdGlvbiAobikgeyB2YXIgdDsgZS5sb2dpblN1Y2Nlc3MgJiYgKHQgPSBlLmxvZ2luU3VjY2VzcyhuKSksICh2b2lkIDAgPT09IHQgfHwgdCkgJiYgKHYudXNlclRva2VuID0gbnVsbCwgSSh2KSk7IH0pKSwgZS5sb2dpblJlcXVpcmVkID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdC53YWl0Q2FsbChcInJlZnJlc2hBY2Nlc3NUb2tlbkxpc3RcIiwgKGZ1bmN0aW9uICgpIHsgdC53YWl0Q2FsbChcIm9mZmVyQ3JlYXRlXCIsIChmdW5jdGlvbiAoKSB7IHQuc3RhcnRDYWxsKFwibXlBY2NvdW50TG9naW5cIiksIG0gPSBhLmhpZGVNb2RhbENvbnRhaW5lcigpLCBwbi5qYW5yYWluLmxvZ2luKCk7IH0pKTsgfSkpLCAhMTsgfTtcbiAgICB9IHJldHVybiBuZXcgUHJvbWlzZSgoZnVuY3Rpb24gKGEpIHsgdC53YWl0Q2FsbChcInJlZnJlc2hVc2VyVG9rZW5cIiwgKGZ1bmN0aW9uICgpIHsgdmFyIHMsIHUgPSB7fTsgaWYgKFwiaW5saW5lXCIgPT09IGUuZGlzcGxheU1vZGUpIHtcbiAgICAgICAgaWYgKCFlLmNvbnRhaW5lclNlbGVjdG9yKVxuICAgICAgICAgICAgcmV0dXJuIHZvaWQgdC5sb2coXCJNeSBhY2NvdW50IG11c3QgaGF2ZSBhIHZhbGlkIGNvbnRhaW5lclNlbGVjdG9yXCIpO1xuICAgICAgICBpZiAoIShzID0gbi5xdWVyeUVsKGUuY29udGFpbmVyU2VsZWN0b3IpKSlcbiAgICAgICAgICAgIHJldHVybiB2b2lkIHQubG9nKFwiTXkgYWNjb3VudCBtdXN0IGhhdmUgYSB2YWxpZCBjb250YWluZXJTZWxlY3RvclwiKTtcbiAgICAgICAgby53aWR0aCA9IG4uZ2V0V2lkdGgocyk7XG4gICAgfVxuICAgIGVsc2VcbiAgICAgICAgcyA9IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpOyBuLmFkZENsYXNzKFwidHAtbW9kYWxcIiwgZSk7IHZhciB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTsgcmV0dXJuIG4uYWRkQ2xhc3MoXCJ0cC1jbG9zZVwiLCB0KSwgbi5hcHBlbmQoZSwgdCksIG4uYXBwZW5kKGRvY3VtZW50LmJvZHksIGUpLCBlOyB9KCk7IGZvciAodmFyIG0gaW4gby5wYWdlVmlld0lkID0gcG4ubWFpbi5mZXRjaFBhZ2VWaWV3SWQoKSwgby50YmMgPSB0LmdldFRiY0Nvb2tpZSgpLCBvLnVzZXJQcm92aWRlciA9IGkuZ2V0UHJvdmlkZXIoKS5nZXROYW1lKCksIGUudXNlclRva2VuID8gby51c2VyVG9rZW4gPSBlLnVzZXJUb2tlbiA6IG8udXNlclRva2VuID0gaS5nZXRQcm92aWRlcigpLmdldFRva2VuKCksIGQpXG4gICAgICAgIFwiZnVuY3Rpb25cIiA9PSB0eXBlb2YgZVttXSAmJiAodC5kZWJ1ZyhcIlJlZ2lzdGVyaW5nIFwiICsgbSArIFwiIGNhbGxiYWNrIGZvciBpZnJhbWUgXCIgKyBvLmlmcmFtZUlkKSwgaChtLCBlW21dKSk7IG8uYWlkID0gcG4uYWlkLCBwbi5pc1NlbnNpdGl2ZURhdGFQcm90ZWN0aW9uRW5hYmxlZCAmJiAodSA9IHsgdXNlclRva2VuOiBvLnVzZXJUb2tlbiwgaWZyYW1lSWQ6IG8uaWZyYW1lSWQgfSwgZGVsZXRlIG8udXNlclRva2VuKTsgdmFyIHYgPSBwKCkgKyBcIj9cIiArIG4ucGFyYW0obyksIHcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaWZyYW1lXCIpLCBiID0geyBzY3JvbGxpbmc6IFwibm9cIiwgYWxsb3d0cmFuc3BhcmVuY3k6IFwidHJ1ZVwiLCBuYW1lOiBvLmlmcmFtZUlkLCBpZDogby5pZnJhbWVJZCwgYWxsb3c6IFwicGF5bWVudFwiIH07IHBuLmlzU2Vuc2l0aXZlRGF0YVByb3RlY3Rpb25FbmFibGVkIHx8IChiLnNyYyA9IHYpLCBPYmplY3Qua2V5cyhiKS5mb3JFYWNoKChmdW5jdGlvbiAoZSkgeyBuLnNldEF0dHIoZSwgYltlXSwgdyk7IH0pKTsgdmFyIGsgPSB7IG92ZXJmbG93OiBcImhpZGRlblwiLCBib3JkZXI6IFwiMFwiLCBoZWlnaHQ6IFwiMFwiIH07IGlmIChcImlubGluZVwiID09PSBlLmRpc3BsYXlNb2RlID8gay53aWR0aCA9IG8ud2lkdGggKyBcInB4XCIgOiBrLndpZHRoID0gMCwgT2JqZWN0LmtleXMoaykuZm9yRWFjaCgoZnVuY3Rpb24gKGUpIHsgdy5zdHlsZVtlXSA9IGtbZV07IH0pKSwgbFtvLmlmcmFtZUlkXSA9IHsgaWZyYW1lSWQ6IG8uaWZyYW1lSWQsIGNvbmZpZzogZSwgZWxlbWVudDogdywgY29udGFpbmVyOiBzLCBjb250YWluZXJXaWR0aDogbi5nZXRXaWR0aChzKSwgY29udGFpbmVySGVpZ2h0OiBuLmdldEhlaWdodChzKSB9LCByLmluaXQoeyBwb3N0TWVzc2FnZVVybDogcCgpLCByZWNlaXZlOiB5LCBpZnJhbWU6IGxbby5pZnJhbWVJZF0gfSksIG4ub24od2luZG93LCBcImtleXVwXCIsIChmdW5jdGlvbiAoZSkgeyB9KSksIFwibW9kYWxcIiA9PT0gZS5kaXNwbGF5TW9kZSAmJiBuLm9uKHdpbmRvdywgXCJyZXNpemVcIiwgKGZ1bmN0aW9uICgpIHsgZyhzKTsgfSkpLCBcIm1vZGFsXCIgPT09IGUuZGlzcGxheU1vZGUgPyBnKHMpIDogbi5lbXB0eShzKSwgcG4uaXNTZW5zaXRpdmVEYXRhUHJvdGVjdGlvbkVuYWJsZWQpIHtcbiAgICAgICAgdS5pZnJhbWVTcmMgPSB2O1xuICAgICAgICB2YXIgXyA9IEModSk7XG4gICAgICAgIG4uYXBwZW5kKHMsIHcpLCBuLmFwcGVuZChzLCBfKSwgXy5zdWJtaXQoKTtcbiAgICB9XG4gICAgZWxzZVxuICAgICAgICBuLmFwcGVuZChzLCB3KTsgaWYgKG4ub24od2luZG93LCBcInJlc2l6ZVwiLCAoZnVuY3Rpb24gKCkgeyAhZnVuY3Rpb24gKCkgeyBmb3IgKHZhciBlIGluIGwpIHtcbiAgICAgICAgdmFyIHQgPSBsW2VdLCBvID0gITEsIGkgPSBuLmdldFdpZHRoKHQuY29udGFpbmVyKTtcbiAgICAgICAgaSAhPT0gdC5jb250YWluZXJXaWR0aCAmJiAodC5lbGVtZW50LnN0eWxlLndpZHRoID0gaSArIFwiXCIsIHQuY29udGFpbmVyV2lkdGggPSBpLCBvID0gITApO1xuICAgICAgICB2YXIgYSA9IG4uZ2V0SGVpZ2h0KHQuY29udGFpbmVyKTtcbiAgICAgICAgYSAhPT0gdC5jb250YWluZXJIZWlnaHQgJiYgKHQuZWxlbWVudC5zdHlsZS5oZWlnaHQgPSBhICsgXCJcIiwgdC5jb250YWluZXJIZWlnaHQgPSBhLCBvID0gITApLCBvICYmIHIuc2VuZChcInJlc2l6ZVwiLCB7IHdpZHRoOiBpLCBoZWlnaHQ6IGEgfSwgZSk7XG4gICAgfSB9KCk7IH0pKSwgXCJpbmxpbmVcIiA9PT0gZS5kaXNwbGF5TW9kZSAmJiB3aW5kb3cuUmVzaXplT2JzZXJ2ZXIpIHtcbiAgICAgICAgdmFyIEkgPSBuZXcgUmVzaXplT2JzZXJ2ZXIoKGZ1bmN0aW9uIChlKSB7IHZhciB0ID0gbi5nZXRXaWR0aChzKTsgdCA+IDAgJiYgZihsW28uaWZyYW1lSWRdLCB7IHdpZHRoOiB0IH0pOyB9KSk7XG4gICAgICAgIEkub2JzZXJ2ZShzKSwgbFtvLmlmcmFtZUlkXS5yZXNpemVPYnNlcnZlciA9IEk7XG4gICAgfSBwbi5vZmZlciAmJiBwbi5vZmZlci5yZWdpc3RlckNhbGxiYWNrKFwiY29tcGxldGVcIiwgKGZ1bmN0aW9uICgpIHsgci5zZW5kKFwicmVmcmVzaE5vd1wiLCB7fSwgby5pZnJhbWVJZCk7IH0pKSwgYShsW28uaWZyYW1lSWRdKSwgYy5zZXRUaW1lKFwibXlBY2NvdW50U2hvd1wiKTsgfSkpOyB9KSk7IH0gdmFyIEMgPSBmdW5jdGlvbiAoZSkgeyB2YXIgdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJmb3JtXCIpLCByID0geyBpZDogXCJmb3JtX1wiICsgZS5pZnJhbWVJZCwgbWV0aG9kOiBcInBvc3RcIiwgYWN0aW9uOiBlLmlmcmFtZVNyYywgdGFyZ2V0OiBlLmlmcmFtZUlkIH07IHJldHVybiBuLnNldEF0dHJzKHIsIHQpLCBbeyBuYW1lOiBcInVzZXJUb2tlblwiLCB2YWx1ZTogZS51c2VyVG9rZW4gfV0uZm9yRWFjaCgoZnVuY3Rpb24gKGUpIHsgdmFyIHIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIiksIG8gPSB7IHR5cGU6IFwiaGlkZGVuXCIsIG5hbWU6IGUubmFtZSB9OyBuLnNldEF0dHJzKG8sIHIpLCByLnZhbHVlID0gZS52YWx1ZSwgbi5hcHBlbmQodCwgcik7IH0pKSwgdDsgfSwgSSA9IGZ1bmN0aW9uIChlKSB7IHQud2FpdENhbGwoXCJvZmZlckNyZWF0ZVwiLCAoZnVuY3Rpb24gKCkgeyB0LndhaXRDYWxsKFwicmVmcmVzaEFjY2Vzc1Rva2VuTGlzdFwiLCAoZnVuY3Rpb24gKCkgeyB2YXIgbjsgbnVsbCA9PT0gKG4gPSBfKGUpKSB8fCB2b2lkIDAgPT09IG4gfHwgbi50aGVuKChmdW5jdGlvbiAoZSkgeyBlIHx8IHQubG9nKFwiQ291bGQgbm90IGluaXRpYWxpemUgbXkgYWNjb3VudDsgY2hlY2sgY29uZmlndXJhdGlvblwiKTsgfSkpOyB9KSk7IH0pKTsgfTsgcmV0dXJuIHsgbmFtZTogXCJteWFjY291bnRcIiwgc2hvdzogSSwgcmVnaXN0ZXJDYWxsYmFjazogaCB9OyB9KCk7XG4gICAgcG4uY29udGFpbmVyLnJlZ2lzdGVyKFwibXlhY2NvdW50XCIsIHsgdXNlVmFsdWU6IFFlIH0pLCBwbi5teWFjY291bnQgPSBwbi5jb250YWluZXIucmVzb2x2ZShcIm15YWNjb3VudFwiKTtcbiAgICB2YXIgWGUgPSBmdW5jdGlvbiAoKSB7IHZhciBlID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJqcVV0aWxzXCIpLCBuID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJ1dGlsXCIpLCB0ID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJhcGlcIiksIHIgPSBwbi5jb250YWluZXIucmVzb2x2ZShcIm9mZmVyXCIpLCBvID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJldmVudFV0aWxzXCIpLmNyZWF0ZUV2ZW50TWFuYWdlcihbXCJvbkNoZWNrb3V0U3VjY2Vzc1wiLCBcIm9uTWV0ZXJFeHBpcmVkXCIsIFwib25NZXRlckVycm9yXCIsIFwib25BY2Nlc3NHcmFudGVkXCIsIFwib25NZXRlckFjdGl2ZVwiLCBcIm9uTWV0ZXJJbmFjdGl2ZVwiLCBcIm1ldGVyU2VsZWN0b3JcIl0pLCBpID0geyBzdGF0ZTogXCJva1wiLCB2aWV3c19sZWZ0OiBudWxsLCBvZmZlcl9pZDogXCJcIiwgY3VydGFpbl90ZW1wbGF0ZV9pZDogXCJcIiwgcmVtaW5kZXJfdGVtcGxhdGVfaWQ6IFwiXCIsIGNvb2tpZV9uYW1lOiBcIlwiLCBjb29raWVfdmFsdWU6IFwiXCIsIGNvb2tpZV9leHBpcmVzOiBcIlwiLCBzaG93X3JlbWluZGVyOiAhMSwgc2hvd19jbG9zZV9idXR0b246ICExIH0sIGEgPSBmdW5jdGlvbiAoZSwgdCkgeyByZXR1cm4gby5maXJlKHZvaWQgMCwgZSwgITAsIHQpLCAhdVtlXSB8fCBcImZ1bmN0aW9uXCIgIT0gdHlwZW9mIHVbZV0gfHwgKG4uZGVidWcoXCJfY3VzdG9tQ2FsbGVyIGNhbGxlZCB3aXRoIFwiICsgZSksIHVbZV0odCkpOyB9LCBzID0gZnVuY3Rpb24gKG4pIHsgKG4gPSBuIHx8IHt9KS5vZmZlcklkIHx8IChuLm9mZmVySWQgPSBpLm9mZmVyX2lkKSwgbi50ZW1wbGF0ZUlkIHx8IChuLnRlbXBsYXRlSWQgPSBpLmN1cnRhaW5fdGVtcGxhdGVfaWQpLCBuLmRpc3BsYXlNb2RlIHx8IChuLmRpc3BsYXlNb2RlID0gdS5kaXNwbGF5TW9kZSksIG4uY29udGFpbmVyU2VsZWN0b3IgfHwgKG4uY29udGFpbmVyU2VsZWN0b3IgPSB1LmNvbnRhaW5lclNlbGVjdG9yKSwgbi5zaG93Q2xvc2VCdXR0b24gfHwgKG4uc2hvd0Nsb3NlQnV0dG9uID0gaS5zaG93X2Nsb3NlX2J1dHRvbiksIFwiZnVuY3Rpb25cIiA9PT0gZS50eXBlKHUuY2xvc2UpICYmIChuLmNsb3NlID0gdS5jbG9zZSksIFwiZnVuY3Rpb25cIiA9PT0gZS50eXBlKHUubG9naW5SZXF1aXJlZCkgJiYgKG4ubG9naW5SZXF1aXJlZCA9IHUubG9naW5SZXF1aXJlZCksIFwiZnVuY3Rpb25cIiA9PT0gZS50eXBlKHUuY3VzdG9tRXZlbnQpICYmIChuLmN1c3RvbUV2ZW50ID0gdS5jdXN0b21FdmVudCksIFwiZnVuY3Rpb25cIiA9PT0gZS50eXBlKHUub25DaGVja291dFN1Y2Nlc3MpICYmIChuLmNvbXBsZXRlID0gdS5vbkNoZWNrb3V0U3VjY2VzcyksIHIuY3JlYXRlT2ZmZXJJZnJhbWUobik7IH0sIGMgPSBmdW5jdGlvbiAoZSkgeyBpZiAoYShcIl9fX29uUHJvY2Vzc01ldGVyXCIsIGUpLCAhZS51c2VyX21ldGVyKVxuICAgICAgICByZXR1cm4gbi5sb2coXCJDb3VsZCBub3QgbG9hZCBtZXRlclwiLCBlKSwgdm9pZCBhKFwib25NZXRlckVycm9yXCIsIGUpOyBpZiAoKGkgPSBlLnVzZXJfbWV0ZXIpICYmIGkuY29va2llX25hbWUgJiYgaS5jb29raWVfdmFsdWUgJiYgaS5jb29raWVfZXhwaXJlcykge1xuICAgICAgICB2YXIgdCA9IHsgcGF0aDogXCIvXCIsIGV4cGlyZXM6IGkuY29va2llX2V4cGlyZXMgfTtcbiAgICAgICAgaS5jb29raWVfZG9tYWluICYmICh0LmRvbWFpbiA9IGkuY29va2llX2RvbWFpbiksIG4uX19wcm90ZWN0ZWRfXy5zZXRDb29raWUoaS5jb29raWVfbmFtZSwgaS5jb29raWVfdmFsdWUsIHQpO1xuICAgIH0gXCJva1wiID09PSBpLnN0YXRlID8gZnVuY3Rpb24gKGUpIHsgbi5kZWJ1ZyhcIl9oYW5kbGVNZXRlckFjdGl2ZVwiLCBlKSwgZS5zaG93X3JlbWluZGVyICYmIGUucmVtaW5kZXJfdGVtcGxhdGVfaWQgJiYgZS50cmFja19wYWdlX3ZpZXcgJiYgYShcIm9uU2hvd09mZmVyXCIsIGUpICYmIHMoeyB0ZW1wbGF0ZUlkOiBlLnJlbWluZGVyX3RlbXBsYXRlX2lkIH0pLCBhKFwib25NZXRlckFjdGl2ZVwiLCBlKTsgfShpKSA6IFwiYXBcIiA9PT0gaS5zdGF0ZSA/IGZ1bmN0aW9uIChlKSB7IG4uZGVidWcoXCJfaGFuZGxlQWNjZXNzR3JhbnRlZFwiLCBlKSwgYShcIm9uQWNjZXNzR3JhbnRlZFwiLCBlKTsgfShpKSA6IFwiaWFcIiA9PT0gaS5zdGF0ZSA/IGZ1bmN0aW9uIChlKSB7IG4uZGVidWcoXCJfaGFuZGxlTWV0ZXJJbmFjdGl2ZVwiLCBlKSwgYShcIm9uTWV0ZXJJbmFjdGl2ZVwiLCBlKTsgfShpKSA6IGZ1bmN0aW9uIChlKSB7IG4uZGVidWcoXCJfaGFuZGxlRXhwaXJlZFwiLCBlKSwgYShcIm9uTWV0ZXJFeHBpcmVkXCIsIGUpLCBlLnRyYWNrX3BhZ2VfdmlldyAmJiBhKFwib25TaG93T2ZmZXJcIiwgZSkgJiYgcygpOyB9KGkpOyB9LCBsID0gZnVuY3Rpb24gKGUsIHIsIG8pIHsgaWYgKG51bGwgIT09IHUucGF5d2FsbElkICYmIFwiXCIgIT09IHUucGF5d2FsbElkKSB7XG4gICAgICAgIHZhciBpID0gZG9jdW1lbnQuVVJMO1xuICAgICAgICBlICYmIFwiZnVuY3Rpb25cIiA9PSB0eXBlb2YgZS5nZXRBdHRyaWJ1dGUgJiYgZS5nZXRBdHRyaWJ1dGUoXCJocmVmXCIpID8gaSA9IGUuZ2V0QXR0cmlidXRlKFwiaHJlZlwiKSA6IGUgJiYgXCJmdW5jdGlvblwiID09IHR5cGVvZiBlLmF0dHIgJiYgZS5hdHRyKFwiaHJlZlwiKSAmJiAoaSA9IGUuYXR0cihcImhyZWZcIikpO1xuICAgICAgICB2YXIgYSA9IHUudHJhY2tQYWdldmlldztcbiAgICAgICAgYSAmJiBkZWxldGUgdS50cmFja1BhZ2V2aWV3O1xuICAgICAgICB2YXIgcyA9IHUubWV0ZXJTZWxlY3RvcigpO1xuICAgICAgICBzIHx8IChzID0gXCJcIik7XG4gICAgICAgIHZhciBsID0geyBwYXl3YWxsX2lkOiB1LnBheXdhbGxJZCwgdXJsOiBlbmNvZGVVUkkoaSksIHJlZmVyZXI6IGVuY29kZVVSSSh1LnJlZmVyZXIpLCB0cmFja19wYWdlX3ZpZXc6IGEsIG1ldGVyX25hbWU6IHMsIHBhZ2V2aWV3X2lkOiBwbi5tYWluLmZldGNoUGFnZVZpZXdJZCgpIH07XG4gICAgICAgIHIgJiYgKGwudHJhbnNhY3Rpb25faWQgPSByKSwgdS5yZWZlcmVyID0gXCJcIjtcbiAgICAgICAgdmFyIGQgPSBuLl9fcHJvdGVjdGVkX18uZ2V0Q29va2llKFwidW1jXCIpO1xuICAgICAgICBpZiAoZClcbiAgICAgICAgICAgIGwudW1jID0gZDtcbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB2YXIgcCA9IG4uX19wcm90ZWN0ZWRfXy5nZXRDb29raWUoXCJ1bWNfXCIgKyB1LnBheXdhbGxJZCk7XG4gICAgICAgICAgICBwICYmIChsLnVtYyA9IHApO1xuICAgICAgICB9XG4gICAgICAgIHQuY2FsbEFwaShcIi9hbm9uL21ldGVyL2xvYWRcIiwgbCwgKGZ1bmN0aW9uIChlKSB7IGMoZSksIFwiZnVuY3Rpb25cIiA9PSB0eXBlb2YgbyAmJiBvKCk7IH0pKTtcbiAgICB9XG4gICAgZWxzZVxuICAgICAgICBuLmRlYnVnKFwiWW91IG11c3Qgc3BlY2lmeSBhIHBheXdhbGxJZCBpbiB5b3VyIGNvbmZpZ3VyYXRpb25cIik7IH0sIHUgPSB7IHBheXdhbGxJZDogbnVsbCwgdHJhY2tQYWdldmlldzogITAsIHRyYWNrRXh0ZXJuYWxSZWZlcnJlcjogITAsIHJlZmVyZXI6IGRvY3VtZW50LnJlZmVycmVyLCBvZmZlclVSTDogXCJcIiwgZGlzcGxheU1vZGU6IFwibW9kYWxcIiwgY29udGFpbmVyU2VsZWN0b3I6IFwiXCIsIG9uQ2hlY2tvdXRTdWNjZXNzOiBmdW5jdGlvbiAoKSB7IH0sIG9uTWV0ZXJFeHBpcmVkOiBmdW5jdGlvbiAoKSB7IH0sIG9uTWV0ZXJFcnJvcjogZnVuY3Rpb24gKCkgeyB9LCBvbkFjY2Vzc0dyYW50ZWQ6IGZ1bmN0aW9uICgpIHsgfSwgb25NZXRlckFjdGl2ZTogZnVuY3Rpb24gKCkgeyB9LCBvbk1ldGVySW5hY3RpdmU6IGZ1bmN0aW9uICgpIHsgfSwgbWV0ZXJTZWxlY3RvcjogZnVuY3Rpb24gKCkgeyB9IH07IHJldHVybiB7IG5hbWU6IFwibWV0ZXJcIiwgaW5pdDogZnVuY3Rpb24gKGUpIHsgaWYgKHZvaWQgMCAhPT0gZSlcbiAgICAgICAgICAgIGlmICh2b2lkIDAgIT09IGUucGF5d2FsbElEIHx8IHZvaWQgMCAhPT0gZS5wYXl3YWxsSWQpIHtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciB0IGluIHZvaWQgMCA9PT0gZS5wYXl3YWxsSWQgJiYgKGUucGF5d2FsbElkID0gZS5wYXl3YWxsSUQpLCBlKVxuICAgICAgICAgICAgICAgICAgICB1W3RdID0gZVt0XTtcbiAgICAgICAgICAgICAgICB1LnJlZmVyZXIgPSBkb2N1bWVudC5yZWZlcnJlciwgbi5kZWJ1ZyhcIkluaXRpYWxpemluZyBwYXl3YWxsOiBcIiArIHUucGF5d2FsbElkKSwgbCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIG4uZXJyb3IoXCJNdXN0IHNwZWNpZnkgcGF5d2FsbElkIHRvIGxvYWQgUGlhbm8gcGF5d2FsbFwiKTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgbi5lcnJvcihcIk11c3Qgc3BlY2lmeSBwYXl3YWxsIGNvbmZpZ3VyYXRpb24gdG8gbG9hZCBQaWFubyBwYXl3YWxsXCIpOyB9LCBpc0V4cGlyZWQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGkuc3RhdGUgJiYgXCJleFwiID09PSBpLnN0YXRlOyB9LCBpc0V4cGlyZWROZXh0Q2xpY2s6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHZvaWQgMCAhPT0gaS52aWV3c19sZWZ0ICYmIDAgPT09IGkudmlld3NfbGVmdDsgfSwgY2hlY2tNZXRlcjogZnVuY3Rpb24gKGUpIHsgdS50cmFja1BhZ2V2aWV3ID0gITAsIGwoZSk7IH0sIHNob3dDdXJ0YWluOiBzLCBsYXN0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBpOyB9LCByZWdpc3RlckNhbGxiYWNrOiBmdW5jdGlvbiAoZSwgbikgeyBvLmFkZEV2ZW50KGUpLCBvLnJlZ2lzdGVyQ2FsbGJhY2soZSwgbik7IH0gfTsgfSgpO1xuICAgIHBuLmNvbnRhaW5lci5yZWdpc3RlcihcIm1ldGVyXCIsIHsgdXNlVmFsdWU6IFhlIH0pLCBwbi5tZXRlciA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwibWV0ZXJcIik7XG4gICAgdmFyICRlID0gZnVuY3Rpb24gKCkgeyB2YXIgZSA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwidXRpbFwiKSwgbiA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwic2hhMVwiKSwgdCA9IFwiXCIsIHIgPSBmdW5jdGlvbiAoKSB7IHZhciBlID0gXCJcIjsgcmV0dXJuIFtcIlNob2Nrd2F2ZUZsYXNoLlNob2Nrd2F2ZUZsYXNoLjZcIiwgXCJTaG9ja3dhdmVGbGFzaC5TaG9ja3dhdmVGbGFzaC43XCIsIFwiU1dDdDEuU1dDdDEuOVwiLCBcIlNXQ3RsLlNXQ3RsXCIsIFwiQWRvYmUuU1ZHQ3RsXCIsIFwiV01QbGF5ZXIuT0NYXCIsIFwiQWdDb250cm9sLkFnQ29udHJvbFwiLCBcIkFjcm9QREYuUERGXCIsIFwiUERGLlBkZkN0cmxcIiwgXCJSZWFsUGxheWVyLlJlYWxQbGF5ZXIodG0pIEFjdGl2ZVggQ29udHJvbCAoMzItYml0KVwiLCBcIlJlYWxQbGF5ZXJcIiwgXCJTa3lwZS5EZXRlY3Rpb25cIiwgXCIzZG1sdy5JRVBsdWdpblwiLCBcIkdvb2dsZVRhbGsuUGx1Z2luXCIsIFwiR29vZ2xlVGFsay5QbHVnaW4uMVwiXS5tYXAoKGZ1bmN0aW9uIChuKSB7IHRyeSB7XG4gICAgICAgIG5ldyB3aW5kb3cuQWN0aXZlWE9iamVjdChuKSwgZSArPSBuICsgXCJ8XCI7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7IH0gfSkpLCBlOyB9LCBvID0gZnVuY3Rpb24gKCkgeyBpZiAodClcbiAgICAgICAgcmV0dXJuIHQ7IHZhciBvID0gZnVuY3Rpb24gKCkgeyB0cnkge1xuICAgICAgICB2YXIgZTtcbiAgICAgICAgcmV0dXJuIGUgPSB3aW5kb3cubmF2aWdhdG9yLnVzZXJMYW5ndWFnZSB8fCB3aW5kb3cubmF2aWdhdG9yLmxhbmd1YWdlLCAobmV3IERhdGUpLmdldFRpbWV6b25lT2Zmc2V0KCkgKyBcIjpcIiArIGU7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIHJldHVybiBcIlwiO1xuICAgIH0gfSgpOyByZXR1cm4gbyArPSBmdW5jdGlvbiAoKSB7IGlmICh3aW5kb3cuQWN0aXZlWE9iamVjdClcbiAgICAgICAgcmV0dXJuIHIoKTsgdHJ5IHtcbiAgICAgICAgdmFyIGUgPSBcIlwiLCBuID0gbmF2aWdhdG9yLnBsdWdpbnMubGVuZ3RoO1xuICAgICAgICBpZiAobiA+IDApXG4gICAgICAgICAgICBmb3IgKHZhciB0ID0gMDsgdCA8IG47IHQrKylcbiAgICAgICAgICAgICAgICBlICs9IG5hdmlnYXRvci5wbHVnaW5zW3RdLm5hbWUgKyBcInxcIjtcbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIHJldHVybiBcIlwiO1xuICAgIH0gfSgpLCBvICs9IGZ1bmN0aW9uICgpIHsgdHJ5IHtcbiAgICAgICAgcmV0dXJuIHNjcmVlbi5oZWlnaHQgKyBcInhcIiArIHNjcmVlbi53aWR0aCArIFwiK1wiICsgc2NyZWVuLmNvbG9yRGVwdGg7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIHJldHVybiBcIlwiO1xuICAgIH0gfSgpLCBvICs9IG5hdmlnYXRvci51c2VyQWdlbnQsIG8gKz0gZnVuY3Rpb24gKCkgeyB2YXIgZSA9IFwiXCI7IHRyeSB7XG4gICAgICAgIGUgKz0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQgPyAxIDogMCwgZSArPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSA/IDEgOiAwLCBlICs9IHNjcmVlbi5nbG9iYWxTdG9yYWdlID8gMSA6IDAsIGUgKz0gd2luZG93LmxvY2FsU3RvcmFnZSA/IDEgOiAwLCBlICs9IHdpbmRvdy5zZXNzaW9uU3RvcmFnZSA/IDEgOiAwLCBlICs9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUgPyAxIDogMCwgZSArPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yID8gMSA6IDAsIGUgKz0gZG9jdW1lbnQuYWxsID8gMSA6IDAsIGUgKz0gd2luZG93LmF0dGFjaEV2ZW50ID8gMSA6IDAsIGUgKz0gd2luZG93LmNyZWF0ZVBvcHVwID8gMSA6IDAsIGUgKz0gd2luZG93LlhNTEh0dHBSZXF1ZXN0ID8gMSA6IDAsIGUgKz0gd2luZG93LkFjdGl2ZVhPYmplY3QgPyAxIDogMCwgZSArPSB3aW5kb3cuWERvbWFpblJlcXVlc3QgPyAxIDogMCwgZSArPSB3aW5kb3cubXNQZXJmb3JtYW5jZSA/IDEgOiAwLCBlICs9IGRvY3VtZW50LmRvY3VtZW50TW9kZSA/IDEgOiAwLCBlICs9IG5hdmlnYXRvci5jcHVDbGFzcyA/IDEgOiAwLCBlICs9IG5hdmlnYXRvci5icm93c2VyTGFuZ3VhZ2UgPyAxIDogMCwgZSArPSB3aW5kb3cub3BlcmEgPyAxIDogMCwgZSArPSB3aW5kb3cuY2hyb21lID8gMSA6IDA7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7IH0gcmV0dXJuIGU7IH0oKSwgdCA9IG4uaGFzaChvKSwgZS5kZWJ1ZyhcIkN1cnJlbnQgYnJvd3NlciBmaW5nZXJwcmludCBpczogXCIgKyB0KSwgdDsgfTsgcmV0dXJuIG8oKSwgeyBuYW1lOiBcImZpbmdlcnByaW50XCIsIGdldEZpbmdlcnByaW50OiBvIH07IH0oKTtcbiAgICBwbi5jb250YWluZXIucmVnaXN0ZXIoXCJmaW5nZXJwcmludFwiLCB7IHVzZVZhbHVlOiAkZSB9KSwgcG4uZmluZ2VycHJpbnQgPSBwbi5jb250YWluZXIucmVzb2x2ZShcImZpbmdlcnByaW50XCIpO1xuICAgIHZhciBZZSA9IGZ1bmN0aW9uICgpIHsgdmFyIGUsIG4gPSBwbi5jb250YWluZXIucmVzb2x2ZShcImpxVXRpbHNcIiksIHQgPSAwLCByID0gMCwgbyA9IDIwMCwgaSA9IDAsIGEgPSBbXTsgbi5vbih3aW5kb3csIFwic2Nyb2xsXCIsIChmdW5jdGlvbiAoKSB7IGMoKTsgfSkpOyB2YXIgcyA9IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSBuLnNjcm9sbFRvcCgpOyBlID4gaSAmJiAoaSA9IGUpOyB9LCBjID0gZnVuY3Rpb24gKCkgeyBzKCksIHUoKTsgfSwgbCA9IGZ1bmN0aW9uIChlKSB7IGlmIChlLmNvbnN1bWVFdmVudEZuKCkpXG4gICAgICAgIHJldHVybiBcInBpeGVsc1wiID09PSBlLm1lYXN1cmVUeXBlID8gZS5wb3NpdGlvbiA8PSBpIDogXCJwZXJjZW50YWdlXCIgPT09IGUubWVhc3VyZVR5cGUgPyBpIC8gKHQgLSBuLndpblNpemUoKS5oZWlnaHQpID49IGUucG9zaXRpb24gLyAxMDAgOiB2b2lkIDA7IH0sIHUgPSBmdW5jdGlvbiAoKSB7IGZvciAodmFyIGUsIG4gPSBbXSwgdCA9IFtdLCByID0gMDsgciA8IGEubGVuZ3RoOyByKyspXG4gICAgICAgIGUgPSBhW3JdLCBsKGUpID8gbi5wdXNoKGUpIDogdC5wdXNoKGUpOyBhID0gdDsgZm9yIChyID0gMDsgciA8IG4ubGVuZ3RoOyByKyspXG4gICAgICAgIG5bcl0uY2FsbGJhY2soKTsgfTsgcmV0dXJuIHsgbmFtZTogXCJzY3JvbGxEZXB0aFwiLCBpbml0aWFsaXplOiBmdW5jdGlvbiAoaSkgeyB2YXIgYSA9IGRvY3VtZW50OyBpICYmIGkgPiAwICYmIChvID0gaSB8fCBvKTsgdmFyIHMgPSBmdW5jdGlvbiAoKSB7IHZhciBpID0gYS5ib2R5IHx8IHt9LCBjID0gYS5kb2N1bWVudEVsZW1lbnQgfHwge30sIGwgPSBNYXRoLm1heChpLnNjcm9sbEhlaWdodCwgYy5zY3JvbGxIZWlnaHQsIGkub2Zmc2V0SGVpZ2h0LCBjLm9mZnNldEhlaWdodCwgaS5jbGllbnRIZWlnaHQsIGMuY2xpZW50SGVpZ2h0KTsgbCA+IHQgJiYgKHQgPSBsKTsgdmFyIHUgPSBuLnNjcm9sbFRvcCgpICsgbi53aW5TaXplKCkuaGVpZ2h0OyB1ID4gciAmJiAociA9IHUpID4gdCAmJiAodCA9IHIpLCBlICYmIGNsZWFyVGltZW91dChlKSwgZSA9IHNldFRpbWVvdXQocywgbyk7IH07IHMoKTsgfSwgZ2V0TWF4U2Nyb2xsRGVwdGg6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHI7IH0sIGdldE1heERvY3VtZW50SGVpZ2h0OiBmdW5jdGlvbiAoKSB7IHJldHVybiB0OyB9LCBhZGRMaXN0ZW5lcjogZnVuY3Rpb24gKGUsIG4sIHQpIHsgXCJmdW5jdGlvblwiICE9IHR5cGVvZiB0ICYmICh0ID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gITA7IH0pLCBhLnB1c2goeyBjYWxsYmFjazogZSwgcG9zaXRpb246IG4uc2Nyb2xsRGVwdGgsIG1lYXN1cmVUeXBlOiBuLm1lYXN1cmVUeXBlLCByZXBlYXQ6IFwib25jZVwiLCBjb25zdW1lRXZlbnRGbjogdCB9KSwgcygpLCB1KCk7IH0sIHJlbW92ZUxpc3RlbmVyczogZnVuY3Rpb24gKCkgeyBhID0gW107IH0sIGNsZWFyTWF4U2Nyb2xsZWRQb3NpdGlvbjogZnVuY3Rpb24gKCkgeyBpID0gMDsgfSB9OyB9KCk7XG4gICAgcG4uY29udGFpbmVyLnJlZ2lzdGVyKFwic2Nyb2xsRGVwdGhcIiwgeyB1c2VWYWx1ZTogWWUgfSksIHBuLnNjcm9sbERlcHRoID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJzY3JvbGxEZXB0aFwiKTtcbiAgICB2YXIgS2UgPSBmdW5jdGlvbiAoKSB7IHZhciBlLCBuID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJ1dGlsXCIpLCB0ID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJqcVV0aWxzXCIpLCByID0gITEsIG8gPSBbXTsgZnVuY3Rpb24gaSgpIHsgciB8fCAociA9ICEwLCB0Lm9uKGRvY3VtZW50LCBcIm1vdXNlbW92ZVwiLCAoZnVuY3Rpb24gKCkgeyByZXR1cm4gcygpOyB9KSksIHQub24oZG9jdW1lbnQsIFwia2V5cHJlc3NcIiwgKGZ1bmN0aW9uICgpIHsgcmV0dXJuIHMoKTsgfSkpLCB0Lm9uKHdpbmRvdywgXCJzY3JvbGxcIiwgKGZ1bmN0aW9uICgpIHsgcmV0dXJuIHMoKTsgfSkpKTsgfSBmdW5jdGlvbiBhKCkgeyBvLmxlbmd0aCAmJiBmdW5jdGlvbiAoKSB7IGZvciAodmFyIGUsIHQsIHIgPSBbXSwgaSA9IFtdLCBhID0gRGF0ZS5ub3coKSwgcyA9IDA7IHMgPCBvLmxlbmd0aDsgcysrKVxuICAgICAgICB0ID0gITEsIGEgLSAoZSA9IG9bc10pLnN0YXJ0VGltZSA+PSBlLmlkbGVUaW1lICYmIChlLmNvbnN1bWVFdmVudEZuKCkgPyB0ID0gITAgOiBlLnN0YXJ0VGltZSA9IGEpLCB0ID8gci5wdXNoKGUpIDogaS5wdXNoKGUpOyByLmxlbmd0aCAmJiBuLmRlYnVnKFwiaWRsZTogcnVuIGZpcmVcIik7IG8gPSBpOyBmb3IgKHMgPSAwOyBzIDwgci5sZW5ndGg7IHMrKylcbiAgICAgICAgKGUgPSByW3NdKS5jYWxsYmFjaygpOyB9KCksIGUgJiYgY2xlYXJUaW1lb3V0KGUpLCBvLmxlbmd0aCAmJiAoZSA9IHNldFRpbWVvdXQoKGZ1bmN0aW9uICgpIHsgcmV0dXJuIGEoKTsgfSksIDIwMCkpOyB9IGZ1bmN0aW9uIHMoKSB7IGZvciAodmFyIG4gPSBEYXRlLm5vdygpLCB0ID0gMDsgdCA8IG8ubGVuZ3RoOyB0KyspXG4gICAgICAgIG9bdF0uc3RhcnRUaW1lID0gbjsgY2xlYXJUaW1lb3V0KGUpLCBvLmxlbmd0aCAmJiAoZSA9IHNldFRpbWVvdXQoKGZ1bmN0aW9uICgpIHsgcmV0dXJuIGEoKTsgfSksIDIwMCkpOyB9IHJldHVybiB7IG5hbWU6IFwiaWRsZVwiLCBpbml0aWFsaXplOiBpLCBhZGRMaXN0ZW5lcjogZnVuY3Rpb24gKG4sIHQsIHIpIHsgaSgpLCBcImZ1bmN0aW9uXCIgIT0gdHlwZW9mIHIgJiYgKHIgPSBmdW5jdGlvbiAoKSB7IHJldHVybiAhMDsgfSksIG8ucHVzaCh7IGNhbGxiYWNrOiBuLCBpZGxlVGltZTogMWUzICogdCwgc3RhcnRUaW1lOiBEYXRlLm5vdygpLCBjb25zdW1lRXZlbnRGbjogciB9KSwgZSB8fCAoZSA9IHNldFRpbWVvdXQoKGZ1bmN0aW9uICgpIHsgcmV0dXJuIGEoKTsgfSksIDIwMCkpOyB9LCByZW1vdmVMaXN0ZW5lcnM6IGZ1bmN0aW9uICgpIHsgbyA9IFtdOyB9IH07IH0oKTtcbiAgICBwbi5jb250YWluZXIucmVnaXN0ZXIoXCJpZGxlXCIsIHsgdXNlVmFsdWU6IEtlIH0pLCBwbi5pZGxlID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJpZGxlXCIpO1xuICAgIHZhciBaZSA9IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSBwbi5jb250YWluZXIucmVzb2x2ZShcInV0aWxcIiksIG4gPSBwbi5jb250YWluZXIucmVzb2x2ZShcImpxVXRpbHNcIiksIHQgPSBbXTsgcmV0dXJuIHsgbmFtZTogXCJpbnRlcmFjdGlvblwiLCBiaW5kOiBmdW5jdGlvbiAociwgbywgaSkgeyB2YXIgYSA9IGZ1bmN0aW9uIChlKSB7IGZvciAodmFyIG4gPSB7IGNsaWNrOiBcImNsaWNrXCIsIGRvdWJsZUNsaWNrOiBcImRibGNsaWNrXCIsIHJpZ2h0Q2xpY2s6IFwiY29udGV4dG1lbnVcIiwgbW91c2VPdXQ6IFwibW91c2VvdXRcIiwgbW91c2VJbjogXCJtb3VzZW92ZXJcIiB9LCB0ID0gW10sIHIgPSAwOyByIDwgZS5sZW5ndGg7IHIrKykge1xuICAgICAgICAgICAgdmFyIG8gPSBlW3JdO1xuICAgICAgICAgICAgdC5wdXNoKG5bb10pO1xuICAgICAgICB9IHJldHVybiB0OyB9OyBcImZ1bmN0aW9uXCIgIT0gdHlwZW9mIGkgJiYgKGkgPSBmdW5jdGlvbiAoKSB7IHJldHVybiAhMDsgfSksIGUuX19wcm90ZWN0ZWRfXy5kb2N1bWVudFJlYWR5KChmdW5jdGlvbiAoKSB7IGZvciAodmFyIGUgPSAwOyBlIDwgby5sZW5ndGg7IGUrKykge1xuICAgICAgICAgICAgdmFyIHMgPSBvW2VdLCBjID0gYShzLmVsZW1lbnRBY3Rpb25zKS5qb2luKFwiIFwiKSwgbCA9IHMuZWxlbWVudFNlbGVjdG9yLCB1ID0gcy5yZXBldGl0aXZlO1xuICAgICAgICAgICAgYy50cmltKCkubGVuZ3RoICYmIGZ1bmN0aW9uIChlLCBvLCBhKSB7IHZhciBzID0gZnVuY3Rpb24gKCkgeyBpKCkgJiYgKGEgfHwgbi51bmRlbGVnYXRlKGRvY3VtZW50LmJvZHksIGUpLCByKCkpOyB9OyBuLmRlbGVnYXRlKGRvY3VtZW50LmJvZHksIGUsIG8sIHMpLCB0LnB1c2goeyBhY3Rpb246IGMsIHNlbGVjdG9yOiBsLCBmdW5jOiBzIH0pOyB9KGwsIGMsIHUpO1xuICAgICAgICB9IH0pKTsgfSwgdW5iaW5kQWxsOiBmdW5jdGlvbiAoKSB7IHQuZm9yRWFjaCgoZnVuY3Rpb24gKGUpIHsgbi51bmRlbGVnYXRlKGRvY3VtZW50LmJvZHksIGUuc2VsZWN0b3IpOyB9KSksIHQgPSBbXTsgfSB9OyB9KCk7XG4gICAgcG4uY29udGFpbmVyLnJlZ2lzdGVyKFwiaW50ZXJhY3Rpb25cIiwgeyB1c2VWYWx1ZTogWmUgfSksIHBuLmludGVyYWN0aW9uID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJpbnRlcmFjdGlvblwiKTtcbiAgICB2YXIgZW4gPSBmdW5jdGlvbiAoKSB7IHZhciBlID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJqcVV0aWxzXCIpLCBuID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJ1dGlsXCIpLCB0ID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJjb250YWluZXJVdGlsc1wiKSwgciA9IGZ1bmN0aW9uIChlKSB7IHJldHVybiBcImlubGluZVwiID09PSBlLmRpc3BsYXlNb2RlOyB9LCBvID0gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIFwibW9kYWxcIiA9PT0gZS5kaXNwbGF5TW9kZTsgfTsgcmV0dXJuIHsgbmFtZTogXCJyZWNXaWRnZXRTZXJ2aWNlXCIsIF9fcHJvdGVjdGVkX186IHsgZ2V0SW5zdGFuY2U6IGZ1bmN0aW9uICgpIHsgdmFyIGksIGEgPSBbXTsgZnVuY3Rpb24gcyhuKSB7IHZhciBzID0gbiB8fCB7fSwgYyA9IHMud2lkZ2V0IHx8IHt9OyByKGMuY29uZmlnKSA/IGUuZW1wdHkoYy5jb250YWluZXIpIDogbyhjLmNvbmZpZykgJiYgKCFmdW5jdGlvbiAobikgeyBpZiAoIWkpXG4gICAgICAgICAgICAgICAgcmV0dXJuOyB0LmNsb3NlTW9kYWwoaSksIGUuZW1wdHkoaS5jb250YWluZXIpOyB2YXIgciA9IHQuX19wcml2YXRlX18ubW9iaWxlTW9kYWxGaXg7IHIuaXNJcGhvbmVDYXJldEZpeGVkICYmIHIubW9kYWxDbG9zZWQoKTsgaSA9IG51bGw7IH0oKSwgZS5yZW1vdmUoYy5jb250YWluZXIpKSwgIXMuc2tpcE9uY2xvc2UgJiYgZS5pc0Z1bmN0aW9uKGMub25jbG9zZSkgJiYgYy5vbmNsb3NlKCksIGEgPSBhLmZpbHRlcigoZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGUudXVpZCAhPT0gYy51dWlkOyB9KSk7IH0gZnVuY3Rpb24gYyhlKSB7IHJldHVybiBhLmZpbHRlcigoZnVuY3Rpb24gKG4pIHsgcmV0dXJuIGUgPT09IG4ud2lkZ2V0SWQ7IH0pKVswXTsgfSByZXR1cm4geyBzaG93UmVjb21tZW5kYXRpb246IGZ1bmN0aW9uIChsKSB7IHZhciB1ID0gbC53aWRnZXRDb25maWcgfHwge30sIGQgPSBsLmNyZWF0ZVBsYWNlaG9sZGVyRm4sIHAgPSB1LndpZGdldElkOyBpZiAoIXApXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIndpZGdldElkIHNob3VsZCBiZSBzcGVjaWZpZWRcIik7IGlmIChjKHApKVxuICAgICAgICAgICAgICAgICAgICBuLmxvZyhcIndpZGdldCB3aXRoIGlkIFwiICsgdS53aWRnZXRJZCArIFwiIGFscmVhZHkgaW5pdGlhbGl6ZVwiKTtcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChvKHUpICYmIGkpXG4gICAgICAgICAgICAgICAgICAgIG4ubG9nKFwibW9kYWwgd2lkZ2V0IGFscmVhZHkgc2hvd25cIik7XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBmID0gZnVuY3Rpb24gKHQpIHsgdmFyIHIgPSBlLnF1ZXJ5RWwodC5jb250YWluZXJTZWxlY3RvciksIG8gPSBcIndpZGdldC1pZC1cIiArIG4ucmFuZG9tU3RyaW5nKCksIGkgPSB7IHNpbmdsZUNvbnRhaW5lcjogciB8fCB2b2lkIDAsIGRpc3BsYXlNb2RlOiB0LmRpc3BsYXlNb2RlIHx8IFwibW9kYWxcIiwgc2hvd0Nsb3NlQnV0dG9uOiB0LnNob3dDbG9zZUJ1dHRvbiwgaWZyYW1lUGFyYW1zOiB7IGlmcmFtZUlkOiBvLCBjb250YWluZXJTZWxlY3RvcjogdC5jb250YWluZXJTZWxlY3Rvciwgd2lkdGg6IHQud2lkdGgsIGhlaWdodDogdC5oZWlnaHQgfSB9OyByZXR1cm4geyB1dWlkOiBvLCB3aWRnZXRJZDogdC53aWRnZXRJZCwgcGxhY2Vob2xkZXI6IHQucGxhY2Vob2xkZXIsIHRyYWNraW5nSWQ6IHQudHJhY2tpbmdJZCwgY29uZmlnOiBpIH07IH0odSksIG0gPSBmLmNvbmZpZywgZyA9IGQoKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGYuY29udGFpbmVyID0gZnVuY3Rpb24gKGUsIG4pIHsgdmFyIGk7IHJldHVybiByKGUpID8gaSA9IHQuaW5pdElubGluZUNvbnRhaW5lcihlKS5jb250YWluZXIgOiBvKGUpICYmIChpID0gdC5nZXRNb2RhbENvbnRhaW5lcihlLCAoZnVuY3Rpb24gKCkgeyBuIGluc3RhbmNlb2YgRnVuY3Rpb24gJiYgbigpOyB9KSkpLCBpOyB9KG0sIChmdW5jdGlvbiAoKSB7IHMoeyB3aWRnZXQ6IGYgfSk7IH0pKSwgZi5jb250YWluZXIpXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZS5hcHBlbmQoZi5jb250YWluZXIsIGcpLCBmLmVsZW1lbnQgPSBnLCBvKG0pICYmIChpID0gZiwgKG4uaXNJcGhvbmUoKSB8fCBuLmlzU2FmYXJpT3JJT3NVaVdlYlZpZXcoKSB8fCBuLmlzQW5kcm9pZCgpKSAmJiB0Ll9fcHJpdmF0ZV9fLm1vYmlsZU1vZGFsRml4Lm1vZGFsT3BlbmVkKCkpLCBmdW5jdGlvbiAobiwgdCkgeyB2b2lkIDAgPT09IHQgJiYgKHQgPSB7fSksIE9iamVjdC5rZXlzKHQpLmZvckVhY2goKGZ1bmN0aW9uIChyKSB7IGUuaXNGdW5jdGlvbih0W3JdKSAmJiAobltyXSA9IHRbcl0obikpOyB9KSk7IH0oZiwgbC53aWRnZXRDYWxsYmFja3MpLCBhLnB1c2goZiksIGY7XG4gICAgICAgICAgICAgICAgICAgIG4ubG9nKCd3aWRnZXQgaGFzIGludmFsaWQgc2VsZWN0b3IgXCInICsgbS5pZnJhbWVQYXJhbXMuY29udGFpbmVyU2VsZWN0b3IgKyAnXCInKTtcbiAgICAgICAgICAgICAgICB9IH0sIGZpcmVXaWRnZXRDYWxsYmFjazogZnVuY3Rpb24gKG4sIHQsIHIpIHsgYS5mb3JFYWNoKChmdW5jdGlvbiAobykgeyBpZiAoby53aWRnZXRJZCA9PT0gdC50b1N0cmluZygpKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBpID0gb1tcIm9uXCIgKyBuXTtcbiAgICAgICAgICAgICAgICAgICAgZS5pc0Z1bmN0aW9uKGkpICYmIGkocik7XG4gICAgICAgICAgICAgICAgfSB9KSk7IH0sIGZpbmRXaWRnZXQ6IGMsIGNsZWFyV2lkZ2V0czogZnVuY3Rpb24gKCkgeyBhID0gW10sIGkgPSBudWxsOyB9LCBjbG9zZVdpZGdldDogcywgZml4V2lkZ2V0TW9kYWxXaWR0aDogZnVuY3Rpb24gKG4sIHIpIHsgaWYgKCFuIHx8IG8obi5jb25maWcpKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBpID0gbi5jb250YWluZXIsIGEgPSByID8gZS5xdWVyeUVsKFwiaWZyYW1lXCIsIGkpIDogZS5xdWVyeUVsKFwiLnRwLXdpZGdldC1wbGFjZWhvbGRlclwiLCBpKTtcbiAgICAgICAgICAgICAgICAgICAgdC5jaGVja0JhY2tkcm9wQW5kQ29udGFpbmVyKG4sICEwLCAhMCksIHNldFRpbWVvdXQoKGZ1bmN0aW9uICgpIHsgYSAmJiB0Ll9fcHJvdGVjdGVkX18uc2V0RWxlbWVudFNpemVzKGksIHsgd2lkdGg6IGUuZ2V0V2lkdGgoYSkgfSk7IH0pLCAxMDApO1xuICAgICAgICAgICAgICAgIH0gfSB9OyB9LCBpbnNlcnRXaWRnZXRMaWI6IGZ1bmN0aW9uIChuKSB7IHZhciB0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJzY3JpcHRcIilbMF0sIHIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic2NyaXB0XCIpOyBuLmlkICYmIHIuc2V0QXR0cmlidXRlKFwiaWRcIiwgbi5pZCksIGUuaXNGdW5jdGlvbihuLm9uZXJyb3IpICYmIChyLm9uZXJyb3IgPSBuLm9uZXJyb3IpLCBlLmlzRnVuY3Rpb24obi5vbmxvYWQpICYmIChyLm9ubG9hZCA9IG4ub25sb2FkKSwgbi5kZWZlciAmJiAoci5kZWZlciA9ICEwKSwgci50eXBlID0gXCJ0ZXh0L2phdmFzY3JpcHRcIiwgci5zcmMgPSBuLnNyYywgdCAmJiB0LnBhcmVudE5vZGUgJiYgdC5wYXJlbnROb2RlLmluc2VydEJlZm9yZShyLCB0KTsgfSB9IH07IH0oKTtcbiAgICBwbi5jb250YWluZXIucmVnaXN0ZXIoXCJyZWNXaWRnZXRTZXJ2aWNlXCIsIHsgdXNlVmFsdWU6IGVuIH0pLCBwbi5yZWNXaWRnZXRTZXJ2aWNlID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJyZWNXaWRnZXRTZXJ2aWNlXCIpO1xuICAgIHZhciBubiA9IGZ1bmN0aW9uICgpIHsgcG4uY29udGFpbmVyLnJlc29sdmUoXCJwcmVkZWZpbmVkT3B0aW9uc1wiKTsgcmV0dXJuIHsgdGVzdFBpYW5vT3B0aW9uOiBcIlwiIH07IH0oKTtcbiAgICBwbi5jb250YWluZXIucmVnaXN0ZXIoXCJwaWFub1wiLCB7IHVzZVZhbHVlOiBubiB9KTtcbiAgICB2YXIgdG4gPSBwbi5jb250YWluZXIucmVzb2x2ZShcInBpYW5vXCIpO1xuICAgIGZvciAodmFyIHJuIGluIHRuKVxuICAgICAgICBwbltybl0gPSB0bltybl07XG4gICAgdmFyIG9uID0gZnVuY3Rpb24gKGUpIHsgdm9pZCAwID09PSBlICYmIChlID0gcG4uY29udGFpbmVyKTsgdmFyIG4gPSBlLnJlc29sdmUoXCJ1dGlsXCIpLCB0ID0gZS5yZXNvbHZlKFwibG9nXCIpLCByID0gZS5yZXNvbHZlKFwidXNlclwiKTsgZS5yZXNvbHZlKFwiYXBpXCIpOyB2YXIgbywgaSA9IGUucmVzb2x2ZShcImpxVXRpbHNcIiksIGEgPSBlLnJlc29sdmUoXCJyZWNXaWRnZXRTZXJ2aWNlXCIpLCBzID0gXCJfX3BubWxcIiwgYyA9IFwiRVhURVJOQUxfRVZFTlRcIiwgbCA9IHsgZ3JhbnRlZDogXCJBTExPV0VEXCIsIGRlZmF1bHQ6IFwiVU5LTk9XTlwiLCBkZW5pZWQ6IFwiRk9SQklEREVOXCIgfSwgdSA9IGEuX19wcm90ZWN0ZWRfXy5nZXRJbnN0YW5jZSgpOyBmdW5jdGlvbiBkKCkgeyByZXR1cm4gbyB8fCAobyA9IG5ldyBQcm9taXNlKChmdW5jdGlvbiAoZSwgdCkgeyB2YXIgciA9IHdpbmRvdy5QaWFub0VTUENvbmZpZyB8fCB7fTsgci5pZCA/IChPYmplY3QuYXNzaWduKHIsIHsgb25sb2FkOiBmdW5jdGlvbiAoKSB7IHJldHVybiBlKG51bGwpOyB9LCB3aWRnZXRfaW5pdF9vbl9ldmVudDogeyByZWM6ICEwLCBcIm9wdC1pblwiOiAhMSB9LCBvbmNsaWNrOiBmdW5jdGlvbiAoZSkgeyB1LmZpcmVXaWRnZXRDYWxsYmFjayhcImNsaWNrXCIsIGUud2lkZ2V0SWQsIGUpOyB9LCBvbndpZGdldGluaXQ6IGZ1bmN0aW9uIChlKSB7IHUuZmlyZVdpZGdldENhbGxiYWNrKFwiaW5pdFwiLCBlLndpZGdldElkLCBlKTsgfSwgb25yZWNzbG9hZGVkOiBmdW5jdGlvbiAoZSkgeyB1LmZpcmVXaWRnZXRDYWxsYmFjayhcInJlY3Nsb2FkZWRcIiwgZS53aWRnZXRJZCwgZSk7IH0gfSksIHdpbmRvdy5QaWFub0VTUENvbmZpZyA9IHIsIG4uZGVidWcoXCJwaWFub0VTUDogbG9hZGluZyBQaWFub0VTUCB3aXRoIGNvbmZpZzpcIiwgd2luZG93LlBpYW5vRVNQQ29uZmlnKSwgYS5fX3Byb3RlY3RlZF9fLmluc2VydFdpZGdldExpYih7IGlkOiBcInBuZXNwbHVjaWRzZGtzZWxcIiwgc3JjOiBwKCkgKyBcIi9wdWJsaWMvc2RrL3YwNC9zZGsuanM/dj1cIiArIChsb2NhbFN0b3JhZ2UgJiYgbG9jYWxTdG9yYWdlLmx1Y2lkc2RrdmVyIHx8IFwieHh4XCIpLCBvbmVycm9yOiBmdW5jdGlvbiAoKSB7IHJldHVybiB0KCk7IH0gfSkpIDogdCgpOyB9KSkpOyB9IHNldFRpbWVvdXQoKGZ1bmN0aW9uICgpIHsgcG4uYWRkSGFuZGxlcihcImxvZ291dFwiLCAoZnVuY3Rpb24gKCkgeyBtKFtdKTsgfSkpOyB2YXIgZSA9IHIuZ2V0UHJvdmlkZXIoKTsgZS5yZWdpc3RlckNhbGxiYWNrICYmIGUucmVnaXN0ZXJDYWxsYmFjayhcImxvZ291dFwiLCAoZnVuY3Rpb24gKCkgeyBtKFtdKTsgfSkpOyB9KSwgMzAwKTsgdmFyIHAgPSBmdW5jdGlvbiAoKSB7IHZhciBlID0gXCIvL2FwaS1lc3AucGlhbm8uaW9cIjsgcmV0dXJuIHBuLmVzcEVuZHBvaW50ID8gZSA9IHBuLmVzcEVuZHBvaW50IDogcG4uaXNTYW5kYm94KCkgJiYgKGUgPSBcIi8vc2FuZGJveC1hcGktZXNwLnBpYW5vLmlvXCIpLCBlOyB9LCBmID0gZnVuY3Rpb24gKGUsIHIpIHsgZCgpLnRoZW4oKGZ1bmN0aW9uICgpIHsgd2luZG93LlBpYW5vRVNQLmdldEN1cnJlbnRQdXNoU3RhdGUoKS50aGVuKChmdW5jdGlvbiAoZSkgeyBcInByb21wdFwiID09PSBlICYmIHQubG9nTWljcm9Db252ZXJzaW9uKHIsIFwic2hvd1Byb21wdFwiKTsgfSkpLCB3aW5kb3cuUGlhbm9FU1Auc3Vic2NyaWJlVG9QdXNoU3F1YWRzKFtlXSkudGhlbigoZnVuY3Rpb24gKG8pIHsgdmFyIGkgPSBvIHx8IHt9OyAhMCA9PT0gaS5yZXN1bHQgPyAobi5zZXRQdXNoTGlzdHNDb29raWUoZSksIG4uZGVidWcoXCJwaWFub0VTUDogUHVzaCBub3RpZmljYXRpb24gd2FzIHNldDpcIiwgaSksIHQubG9nTWljcm9Db252ZXJzaW9uKHIsIFwiZW5yb2xsUHVzaENhbXBhaWduXCIpKSA6ICExID09PSBpLnJlc3VsdCAmJiAoXCJjbG9zZWRcIiA9PT0gaS5yZWFzb24gPyB0LmxvZ01pY3JvQ29udmVyc2lvbihyLCBcImNsb3NlUHJvbXB0XCIpIDogdC5sb2dNaWNyb0NvbnZlcnNpb24ociwgXCJkZWNsaW5lRW5yb2xsUHVzaENhbXBhaWduXCIpKTsgfSkpLmNhdGNoKChmdW5jdGlvbiAoZSkgeyBuLmxvZyhcInBpYW5vRVNQOiBQdXNoIG5vdGlmaWNhdGlvbiBlcnJvcjpcIiwgZSk7IH0pKTsgfSkpOyB9LCBtID0gZnVuY3Rpb24gKGUpIHsgdHJ5IHtcbiAgICAgICAgdmFyIHQgPSBKU09OLnN0cmluZ2lmeShlKTtcbiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0ocywgdCk7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIG4uZGVidWcoXCJjYW4ndCBzYXZlIG1haWxpbmcgbGlzdHMgdG8gc3RvcmFnZVwiLCBlKTtcbiAgICB9IH0sIGcgPSBmdW5jdGlvbiAoKSB7IHZhciBlID0gW107IHRyeSB7XG4gICAgICAgIHZhciB0ID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0ocyk7XG4gICAgICAgIGlmICghdClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIk1BSU5MSU5HX0xJU1Qgc2hvdWxkIGJlIGFycmF5XCIpO1xuICAgICAgICBpZiAoZSA9IEpTT04ucGFyc2UodCksICFBcnJheS5pc0FycmF5KGUpKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTUFJTkxJTkdfTElTVCBzaG91bGQgYmUgYXJyYXlcIik7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIG4uZGVidWcoXCJjYW4ndCBsb2FkIG1haWxpbmcgbGlzdHMgZnJvbSBzdG9yYWdlXCIsIGUpO1xuICAgIH0gcmV0dXJuIGUgfHwgW107IH07IHZhciB2ID0gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGZ1bmN0aW9uICgpIHsgdmFyIG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwicG5lc3B3Z3RwbGFjZWhvbGRlclwiKTsgcmV0dXJuIGkuc2V0QXR0cihcImhvbGRlcm5hbWVcIiwgZSwgbiksIG47IH07IH07IGZ1bmN0aW9uIGgoKSB7IHJldHVybiB7IG9ucmVjc2xvYWRlZDogZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGZ1bmN0aW9uIChyKSB7IDAgIT09IHIuY291bnRPZlJlY3MgPyAodS5maXhXaWRnZXRNb2RhbFdpZHRoKGUsICEwKSwgdC5sb2dFc3BNaWNyb0NvbnZlcnNpb24oZS50cmFja2luZ0lkLCBlLndpZGdldElkLCBcImluaXRcIiwgYyksIG4uZGVidWcoXCJjcmVhdGluZyByZWNvbW1lbmRhdGlvbiB3aWRnZXQ6IFwiLCBlLmNvbmZpZykpIDogdS5jbG9zZVdpZGdldCh7IHdpZGdldDogZSwgc2tpcE9uY2xvc2U6ICEwIH0pOyB9OyB9LCBvbmNsaWNrOiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gZnVuY3Rpb24gKG4pIHsgdmFyIHIgPSB7IGhyZWY6IG4udXJsIH07IHQubG9nRXNwTWljcm9Db252ZXJzaW9uKGUudHJhY2tpbmdJZCwgZS53aWRnZXRJZCwgXCJjbGlja1wiLCBcIkVYVEVSTkFMX0xJTktcIiwgcik7IH07IH0sIG9uY2xvc2U6IGZ1bmN0aW9uIChlKSB7IHJldHVybiBmdW5jdGlvbiAoKSB7IHQubG9nRXNwTWljcm9Db252ZXJzaW9uKGUudHJhY2tpbmdJZCwgZS53aWRnZXRJZCwgXCJjbG9zZVwiLCBjLCB7IGV2ZW50OiBcIndpZGdldENsb3NlZFwiIH0pOyB9OyB9IH07IH0gcmV0dXJuIHsgbmFtZTogXCJwaWFub0VzcFwiLCBfX3Byb3RlY3RlZF9fOiB7IGluaXQ6IGQsIHNldFZpc2l0b3JJZDogZnVuY3Rpb24gKGUpIHsgd2luZG93LlBpYW5vRVNQQ29uZmlnID0gT2JqZWN0LmFzc2lnbih7fSwgd2luZG93LlBpYW5vRVNQQ29uZmlnLCB7IHZpc2l0b3I6IGUgfSk7IH0sIHNob3dSZWNvbW1lbmRhdGlvbjogZnVuY3Rpb24gKGUpIHsgdmFyIG4gPSBoKCk7IHJldHVybiB1LnNob3dSZWNvbW1lbmRhdGlvbih7IHdpZGdldENvbmZpZzogZSwgd2lkZ2V0Q2FsbGJhY2tzOiBuLCBjcmVhdGVQbGFjZWhvbGRlckZuOiB2KGUucGxhY2Vob2xkZXIpIH0pLCBkKCkudGhlbigoZnVuY3Rpb24gKCkgeyB3aW5kb3cuUGlhbm9FU1AuaW5pdFdpZGdldChwYXJzZUludChlLndpZGdldElkKSk7IH0pKTsgfSwgc2hvd1B1c2hTaWdudXA6IGZ1bmN0aW9uIChlKSB7IHZhciBuID0gZSB8fCB7fTsgbi50ZW1wbGF0ZUlkID8gKHQuX19wcm90ZWN0ZWRfXy5sb2dDdXN0b21Gb3JtSW1wcmVzc2lvbihuLnRyYWNraW5nSWQsIFwicHVzaFNpZ251cFwiLCBcInNob3dfZm9ybVwiKSwgcG4udGVtcGxhdGUuc2hvdyh7IHRlbXBsYXRlSWQ6IG4udGVtcGxhdGVJZCwgdGVtcGxhdGVWYXJpYW50SWQ6IG4udGVtcGxhdGVWYXJpYW50SWQsIGRpc3BsYXlNb2RlOiBcIm1vZGFsXCIsIGN1c3RvbUV2ZW50OiBmdW5jdGlvbiAoZSkgeyBzd2l0Y2ggKGUuZXZlbnROYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJwdXNoLWFsbG93XCI6XG4gICAgICAgICAgICAgICAgICAgICAgICB0LmxvZ01pY3JvQ29udmVyc2lvbihuLnRyYWNraW5nSWQsIFwiYWxsb3dTb2Z0RW5yb2xsUHVzaENhbXBhaWduXCIpLCBmKG4ucHVzaExpc3RJZCwgbi50cmFja2luZ0lkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwicHVzaC1kb250LWFsbG93XCI6XG4gICAgICAgICAgICAgICAgICAgICAgICB0LmxvZ01pY3JvQ29udmVyc2lvbihuLnRyYWNraW5nSWQsIFwiZGVjbGluZVNvZnRFbnJvbGxQdXNoQ2FtcGFpZ25cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcInB1c2gtY2xvc2VcIjogdC5sb2dNaWNyb0NvbnZlcnNpb24obi50cmFja2luZ0lkLCBcImNsb3NlXCIpO1xuICAgICAgICAgICAgICAgIH0gfSB9KSkgOiBmKG4ucHVzaExpc3RJZCwgbi50cmFja2luZ0lkKTsgfSwgZ2V0Tm90aWZpY2F0aW9uU3RhdHVzOiBmdW5jdGlvbiAoKSB7IGlmICh3aW5kb3cuTm90aWZpY2F0aW9uKVxuICAgICAgICAgICAgICAgIHJldHVybiBsW3dpbmRvdy5Ob3RpZmljYXRpb24ucGVybWlzc2lvbl0gfHwgbC5kZWZhdWx0OyB9LCBzaG93TmV3c2xldHRlclNpZ251cDogZnVuY3Rpb24gKGUpIHsgaWYgKGUgJiYgZS5tYWlsaW5nTGlzdElkcykge1xuICAgICAgICAgICAgICAgIHZhciB0ID0gZygpLmluZGV4T2YoZS5tYWlsaW5nTGlzdElkcykgPiAtMTtcbiAgICAgICAgICAgICAgICBlLm5vdFNob3dJZkZpbGxlZCAmJiB0ID8gbi5sb2coXCJNYWlsaW5nIGxpc3Qgd2l0aCBpZHMgXCIgKyBlLm1haWxpbmdMaXN0SWRzICsgXCIgYWxyZWFkeSBzaG93blwiKSA6IHBuLnRlbXBsYXRlLnNob3coZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgbi5sb2coXCJtYWlsaW5nTGlzdElkcyBzaG91bGQgYmUgc3BlY2lmaWVkXCIpOyB9LCBvZmZlck1lc3NhZ2VSZWNlaXZlcjogZnVuY3Rpb24gKGUpIHsgaWYgKFwibmV3c2xldHRlclNpZ251cFN1Ym1pc3Npb25cIiA9PT0gZS5ldmVudCkge1xuICAgICAgICAgICAgICAgIHZhciBuID0gZygpO1xuICAgICAgICAgICAgICAgIC0xID09PSBuLmluZGV4T2YoZS5wYXJhbXMubWFpbGluZ0xpc3RJZHMpICYmIChuLnB1c2goZS5wYXJhbXMubWFpbGluZ0xpc3RJZHMpLCBtKG4pKTtcbiAgICAgICAgICAgIH0gfSwgbG9hZENvbXBsZXRlTWFpbGluZ0xpc3RzOiBnIH0sIF9fcHJpdmF0ZV9fOiB7IHJlbW92ZVdpZGdldHNBbmRTZGs6IGZ1bmN0aW9uICgpIHsgdS5jbGVhcldpZGdldHMoKSwgbyA9IG51bGwsIGRlbGV0ZSB3aW5kb3cuUGlhbm9FU1A7IH0sIGdldFdpZGdldENhbGxiYWNrczogaCwgb25Jbml0OiBmdW5jdGlvbiAoZSkgeyBvICYmIFwiZnVuY3Rpb25cIiA9PSB0eXBlb2YgZSAmJiBvLnRoZW4oZSk7IH0gfSB9OyB9O1xuICAgIHBuLmNvbnRhaW5lci5yZWdpc3RlcihcInBpYW5vRXNwXCIsIHsgdXNlVmFsdWU6IG9uKCkgfSksIHBuLnBpYW5vRXNwID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJwaWFub0VzcFwiKTtcbiAgICB2YXIgYW4gPSBmdW5jdGlvbiAoKSB7IHZhciBlLCBuID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJwb3N0bWVzc2FnZVwiKSwgdCA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwidXNlclwiKSwgciA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwidXRpbFwiKSwgbyA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwiZXZlbnRVdGlsc1wiKSwgaSA9IFwiZXh0ZXJuYWxDaGVja291dENvbXBsZXRlXCIsIGEgPSBcImxvZ2luUHJvbXB0XCIsIHMgPSBcImRlZmVycmVkQWNjb3VudENyZWF0aW9uXCIsIGMgPSBcImJ1eVwiLCBsID0gby5jcmVhdGVFdmVudE1hbmFnZXIoW2ldKSwgdSA9ICExLCBkID0gITE7IHdpbmRvdy5TV0cgPSB3aW5kb3cuU1dHIHx8IFtdLCB3aW5kb3cuU1dHLnB1c2goKGZ1bmN0aW9uIChuKSB7IG4uc2V0T25QYXltZW50UmVzcG9uc2UoKGZ1bmN0aW9uIChuKSB7IGQgfHwgKHIuZGVidWcoXCJzd2c6IG9uUGF5bWVudFJlc3BvbnNlIGlzIHRyaWdnZXJlZFwiKSwgZCA9ICEwLCBuLnRoZW4oKGZ1bmN0aW9uIChuKSB7IHIuZGVidWcoXCJzd2c6IG9uUGF5bWVudFJlc3BvbnNlXCIsIG4pLCBlICYmIGcobiwgbi5wdXJjaGFzZURhdGEsIG4udXNlckRhdGEsIGUsIGMpOyB9KSkuY2F0Y2goKGZ1bmN0aW9uIChlKSB7IHIubG9nKFwic3dnOiBvblBheW1lbnRSZXNwb25zZSBmYWlsZWRcIiwgZSk7IH0pKSk7IH0pKTsgfSkpLCBuLnN1YnNjcmliZShcInN3Z0NoZWNrb3V0U3RhcnRcIiwgKGZ1bmN0aW9uIChuKSB7IHUgfHwgci5sb2coXCJzd2c6IGluY29ycmVjdCBTd0cgY29uZmlndXJhdGlvbi4gUGxlYXNlIG1ha2Ugc3VyZSB0aGF0IEV4cGVyaWVuY2UgdXNlciBzZWdtZW50IGlzIGNvbmZpZ3VyZWQgcHJvcGVybHkuIERldGFpbHMgYXQgaHR0cHM6Ly9kb2NzLnBpYW5vLmlvL3N1YnNjcmliZS13aXRoLWdvb2dsZS8jU3dHc2NyaXB0XCIpOyB2YXIgdCA9IG4ucGFyYW1zLnNrdTsgZSA9IG4ucGFyYW1zLnRlcm1JZCwgd2luZG93LlNXRy5wdXNoKChmdW5jdGlvbiAoZSkgeyBlLnN1YnNjcmliZSh0KTsgfSkpOyB9KSk7IHZhciBwID0gZnVuY3Rpb24gKGUpIHsgaWYgKGwuaGFzQ2FsbGJhY2soaSkpIHtcbiAgICAgICAgdmFyIG4gPSB7IHR5cGU6IFwic3dnXCIsIGZsb3c6IGUgfTtcbiAgICAgICAgbC5maXJlQ2FsbGJhY2tzKGksIG4sIHZvaWQgMCwgITApO1xuICAgIH0gfSwgZiA9IGZ1bmN0aW9uIChlKSB7IHJldHVybiBuZXcgUHJvbWlzZSgoZnVuY3Rpb24gKG4sIHQpIHsgcG4uYXBpLmNhbGxBcGkoXCIvc3dnL2NoZWNrXCIsIHsgZW50aXRsZW1lbnQ6IEpTT04uc3RyaW5naWZ5KGUpIH0sIChmdW5jdGlvbiAoZSkgeyAwICE9PSBlLmNvZGUgJiYgKHIubG9nKFwic3dnOiBjaGVjayBzdWJzY3JpcHRpb24gcmVzcG9uc2UgLSBcIiArIGUubWVzc2FnZSksIHQoKSksIG4oZS5DaGVja1N1YnNjcmlwdGlvblJlc3BvbnNlKTsgfSkpOyB9KSk7IH0sIG0gPSBmdW5jdGlvbiAoZSkgeyByZXR1cm4gbmV3IFByb21pc2UoKGZ1bmN0aW9uIChuLCB0KSB7IHBuLmFwaS5jYWxsQXBpKFwiL3N3Zy9jaGVjay9leHRlcm5hbFwiLCB7IGVudGl0bGVtZW50czogSlNPTi5zdHJpbmdpZnkoZSkgfSwgKGZ1bmN0aW9uIChlKSB7IDAgIT09IGUuY29kZSAmJiAoci5sb2coXCJzd2c6IGNoZWNrIGV4dGVybmFsIGVudGl0bGVtZW50IHJlc3BvbnNlIC0gXCIgKyBlLm1lc3NhZ2UpLCB0KCkpOyB2YXIgbyA9IGUuZGF0YTsgbyB8fCAoci5sb2coXCJzd2c6IGNoZWNrIGV4dGVybmFsIGVudGl0bGVtZW50IGVtcHR5IHJlc3BvbnNlXCIpLCB0KCkpLCBuKG8pOyB9KSk7IH0pKTsgfSwgZyA9IGZ1bmN0aW9uIChlLCB0LCBvLCBpLCBhKSB7IHBuLmFwaS5jYWxsQXBpKFwiL3N3Zy9zdWJzY3JpYmVcIiwgeyB0ZXJtX2lkOiBpLCBwdXJjaGFzZV9kYXRhOiBKU09OLnN0cmluZ2lmeSh0KSwgdXNlcl9kYXRhOiBKU09OLnN0cmluZ2lmeShvKSB9LCAoZnVuY3Rpb24gKHQpIHsgaWYgKDAgPT09IHQuY29kZSkge1xuICAgICAgICB2YXIgbyA9IHQuZGF0YTtcbiAgICAgICAgdihvKSwgbi5icm9hZGNhc3QoXCJzd2dDaGVja291dENvbXBsZXRlXCIpLCBlLmNvbXBsZXRlKCkudGhlbigoZnVuY3Rpb24gKCkgeyBwKGEpOyB9KSkuY2F0Y2goKGZ1bmN0aW9uIChlKSB7IHIubG9nKFwic3dnOiBjb21wbGV0ZSBmYWlsZWQ6XCIsIGUpOyB9KSk7XG4gICAgfVxuICAgIGVsc2VcbiAgICAgICAgci5sb2coXCJzd2c6IHN1YnNjcmliZSByZXNwb25zZSAtIFwiICsgdC5tZXNzYWdlKTsgfSkpOyB9LCB2ID0gZnVuY3Rpb24gKGUpIHsgZSAmJiB0LmdldFByb3ZpZGVyKCkubG9naW5CeVRva2VuICYmIHQuZ2V0UHJvdmlkZXIoKS5sb2dpbkJ5VG9rZW4oZSk7IH0sIGggPSAhMSwgdyA9ICExOyByZXR1cm4geyBuYW1lOiBcInN3Z1wiLCBfX3Byb3RlY3RlZF9fOiB7IGluamVjdE1hcmt1cDogZnVuY3Rpb24gKGUpIHsgdmFyIG47IGlmICghaCAmJiBlKSB7XG4gICAgICAgICAgICAgICAgci5kZWJ1ZyhcInN3ZzogcmVuZGVyaW5nIHN3ZyBtYXJrdXAgd2l0aCBjb25maWc6XCIsIGUpO1xuICAgICAgICAgICAgICAgIHZhciB0ID0gJ3tcXG4gICBcIkBjb250ZXh0XCI6IFwiaHR0cDovL3NjaGVtYS5vcmdcIixcXG4gICBcIkB0eXBlXCI6IFwiQ3JlYXRpdmVXb3JrXCIsXFxuICAgXCJpc0FjY2Vzc2libGVGb3JGcmVlXCI6ICcgKyBlLmlzQWNjZXNzaWJsZUZvckZyZWU7XG4gICAgICAgICAgICAgICAgITEgPT09IGUuaXNBY2Nlc3NpYmxlRm9yRnJlZSAmJiBlLnByb2R1Y3RJZCAmJiAodCA9IHQgKyAnLFxcbiAgIFwiaXNQYXJ0T2ZcIjoge1xcbiAgICAgICBcIkB0eXBlXCI6IFtcIkNyZWF0aXZlV29ya1wiLCBcIlByb2R1Y3RcIl0sXFxuICAgICAgIFwibmFtZVwiIDogXCInICsgZS5yZXNvdXJjZU5hbWUgKyAnXCIsXFxuICAgICAgIFwicHJvZHVjdElEXCI6IFwiJyArIGUucHJvZHVjdElkICsgJ1wiXFxuICAgfScpLCB0ICs9IFwiXFxufVwiO1xuICAgICAgICAgICAgICAgIHZhciBvID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNjcmlwdFwiKTtcbiAgICAgICAgICAgICAgICBvLnR5cGUgPSBcImFwcGxpY2F0aW9uL2xkK2pzb25cIiwgby5pbm5lckhUTUwgPSB0LCBudWxsID09PSAobiA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwic2NyaXB0XCIpWzBdLnBhcmVudE5vZGUpIHx8IHZvaWQgMCA9PT0gbiB8fCBuLmFwcGVuZENoaWxkKG8pLCBoID0gITA7XG4gICAgICAgICAgICB9IH0sIGFkZExpYnJhcnk6IGZ1bmN0aW9uICgpIHsgdmFyIGU7IGlmICghdykge1xuICAgICAgICAgICAgICAgIHIuZGVidWcoXCJzd2c6IGFkZGluZyBzd2cuanMgbGlicmFyeVwiKTtcbiAgICAgICAgICAgICAgICB2YXIgbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzY3JpcHRcIik7XG4gICAgICAgICAgICAgICAgbi50eXBlID0gXCJ0ZXh0L2phdmFzY3JpcHRcIiwgbi5zZXRBdHRyaWJ1dGUoXCJzdWJzY3JpcHRpb25zLWNvbnRyb2xcIiwgXCJtYW51YWxcIiksIG4uYXN5bmMgPSAhMCwgbi5zcmMgPSBcImh0dHBzOi8vbmV3cy5nb29nbGUuY29tL3N3Zy9qcy92MS9zd2cuanNcIiwgbnVsbCA9PT0gKGUgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZShcInNjcmlwdFwiKVswXS5wYXJlbnROb2RlKSB8fCB2b2lkIDAgPT09IGUgfHwgZS5hcHBlbmRDaGlsZChuKSwgdyA9ICEwO1xuICAgICAgICAgICAgfSB9LCBpbml0U3dnRmxvdzogZnVuY3Rpb24gKCkgeyB3aW5kb3cuU1dHLnB1c2goKGZ1bmN0aW9uIChlKSB7IGUuZ2V0RW50aXRsZW1lbnRzKCkudGhlbigoZnVuY3Rpb24gKG4pIHsgaWYgKHUgPSAhMCwgci5kZWJ1ZyhcInN3ZzogZ2V0RW50aXRsZW1lbnRzXCIsIG4pLCBuLmVuYWJsZXNUaGlzKCkpIHtcbiAgICAgICAgICAgICAgICB2YXIgbyA9IG4uZ2V0RW50aXRsZW1lbnRGb3JTb3VyY2UoXCJnb29nbGVcIik7XG4gICAgICAgICAgICAgICAgaWYgKCFvKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBpID0gbi5lbnRpdGxlbWVudHM7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB2b2lkIChpICYmIG0oaSkudGhlbigoZnVuY3Rpb24gKCkgeyByLmRlYnVnKFwic3dnOiBjaGVja0V4dGVybmFsRW50aXRsZW1lbnRcIiksIG4uYWNrKCk7IH0pLCAoZnVuY3Rpb24gKCkgeyByLmxvZyhcInN3ZzogY2hlY2tFeHRlcm5hbEVudGl0bGVtZW50IGZhaWxlZFwiKTsgfSkpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZihvKS50aGVuKChmdW5jdGlvbiAobykgeyBpZiAoZClcbiAgICAgICAgICAgICAgICAgICAgci5kZWJ1ZyhcInN3Zzogb25QYXltZW50UmVzcG9uc2UgaXMgYWxyZWFkeSB0cmlnZ2VyZWQuIFNraXBwaW5nIGVudGl0bGVtZW50cyBmbG93LlwiKTtcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChvKVxuICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKG8udHlwZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcIlVTRVJfRk9VTkRcIjpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodC5pc1VzZXJWYWxpZCgpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdm9pZCByLmVycm9yKFwic3dnOiB1c2VyIGZvdW5kLCBidXQgbm90IHZhbGlkXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHIuZGVidWcoXCJzd2c6IHVzZXIgZm91bmQsIGluaXRpYXRlIGxvZ2luIHByb21wdFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaSA9IG8udXNlcl90b2tlbjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLnNob3dMb2dpblByb21wdCgpLnRoZW4oKGZ1bmN0aW9uICgpIHsgdihpKSwgcChhKTsgfSkpLmNhdGNoKChmdW5jdGlvbiAoZSkgeyByLmxvZyhcInN3Zzogc2hvd0xvZ2luUHJvbXB0IGZhaWxlZFwiLCBlKTsgfSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcIlRFUk1fRk9VTkRcIjpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByLmRlYnVnKFwic3dnOiB0ZXJtIGZvdW5kLCBpbml0aWF0ZSBkZWZlcnJlZCBhY2NvdW50IGNyZWF0aW9uXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjID0gby50ZXJtX2lkO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUuY29tcGxldGVEZWZlcnJlZEFjY291bnRDcmVhdGlvbih7IGVudGl0bGVtZW50czogbiwgY29uc2VudDogITAgfSkudGhlbigoZnVuY3Rpb24gKGUpIHsgci5kZWJ1ZyhcInN3ZzogY29tcGxldGVEZWZlcnJlZEFjY291bnRDcmVhdGlvblwiLCBlKSwgZyhlLCBlLnB1cmNoYXNlRGF0YSwgZS51c2VyRGF0YSwgYywgcyk7IH0pKS5jYXRjaCgoZnVuY3Rpb24gKGUpIHsgci5sb2coXCJzd2c6IGNvbXBsZXRlRGVmZXJyZWRBY2NvdW50Q3JlYXRpb24gZmFpbGVkXCIsIGUpOyB9KSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OiByLmRlYnVnKFwic3dnOiBjaGVjayBzdWJzY3JpcHRpb24gcmVzcG9uc2UgdHlwZSBcIiArIG8udHlwZSArIFwiLiBOb3RoaW5nIHRvIGRvXCIpO1xuICAgICAgICAgICAgICAgICAgICB9IH0pLCAoZnVuY3Rpb24gKCkgeyByLmxvZyhcInN3ZzogY2hlY2tTdWJzY3JpcHRpb24gZmFpbGVkXCIpOyB9KSksIG4uYWNrKCk7XG4gICAgICAgICAgICB9IH0pKS5jYXRjaCgoZnVuY3Rpb24gKGUpIHsgci5sb2coXCJzd2c6IGdldCBlbnRpdGxlbWVudHMgZmFpbGVkXCIsIGUpOyB9KSk7IH0pKTsgfSB9LCByZWdpc3RlckNhbGxiYWNrOiBmdW5jdGlvbiAoZSwgbikgeyBsLmFkZEV2ZW50KGUpLCBsLnJlZ2lzdGVyQ2FsbGJhY2soZSwgbik7IH0gfTsgfSgpO1xuICAgIHBuLmNvbnRhaW5lci5yZWdpc3RlcihcInN3Z1wiLCB7IHVzZVZhbHVlOiBhbiB9KSwgcG4uc3dnID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJzd2dcIik7XG4gICAgdmFyIHNuID0gZnVuY3Rpb24gKCkgeyB2YXIgZSA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwidXRpbFwiKSwgbiA9ICExLCB0ID0gZnVuY3Rpb24gKHQsIHIsIG8pIHsgbiA/IChvIHx8IChvID0ge30pLCBlLmxvZyhcImZicGl4ZWw6IFRyYWNrIEZhY2Vib29rIFBpeGVsIGV2ZW50XCIsIHIsIG8pLCB3aW5kb3cuZmJxKHQsIHIsIG8pKSA6IGUubG9nKFwiZmJwaXhlbDogU2tpcCB0cmFja2luZyBldmVudCAtIEZhY2Vib29rIFBpeGVsIGlzIG5vdCBpbml0YWxpemVkXCIsIHIsIG8pOyB9LCByID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gbjsgfTsgcmV0dXJuIHsgbmFtZTogXCJmYnBpeGVsXCIsIGlzSW5pdGlhbGl6ZWQ6IHIsIF9fcHJpdmF0ZV9fOiB7IGlzSW5pdGlhbGl6ZWQ6IHIgfSwgX19wcm90ZWN0ZWRfXzogeyBpbml0OiBmdW5jdGlvbiAoKSB7IGlmICghbikge1xuICAgICAgICAgICAgICAgIHZhciB0LCByLCBvLCBpLCBhLCBzLCBjID0gcG4uZ2V0RmJQaXhlbElkKCk7XG4gICAgICAgICAgICAgICAgaWYgKGMpXG4gICAgICAgICAgICAgICAgICAgIGUubG9nKFwiZmJwaXhlbDogSW5pdGlhbGl6ZSBGYWNlYm9vayBQaXhlbCB0cmFja2luZ1wiLCBjKSwgdCA9IHdpbmRvdywgciA9IGRvY3VtZW50LCBvID0gXCJzY3JpcHRcIiwgdC5mYnEgfHwgKGkgPSB0LmZicSA9IGZ1bmN0aW9uICgpIHsgaS5jYWxsTWV0aG9kID8gaS5jYWxsTWV0aG9kLmFwcGx5KGksIGFyZ3VtZW50cykgOiBpLnF1ZXVlLnB1c2goYXJndW1lbnRzKTsgfSwgdC5fZmJxIHx8ICh0Ll9mYnEgPSBpKSwgaS5wdXNoID0gaSwgaS5sb2FkZWQgPSAhMCwgaS52ZXJzaW9uID0gXCIyLjBcIiwgaS5xdWV1ZSA9IFtdLCAoYSA9IHIuY3JlYXRlRWxlbWVudChvKSkuYXN5bmMgPSAhMCwgYS5zcmMgPSBcImh0dHBzOi8vY29ubmVjdC5mYWNlYm9vay5uZXQvZW5fVVMvZmJldmVudHMuanNcIiwgKHMgPSByLmdldEVsZW1lbnRzQnlUYWdOYW1lKG8pWzBdKS5wYXJlbnROb2RlLmluc2VydEJlZm9yZShhLCBzKSksIHdpbmRvdy5mYnEoXCJzZXRcIiwgXCJhdXRvQ29uZmlnXCIsIFwiZmFsc2VcIiwgYyksIHdpbmRvdy5mYnEoXCJpbml0XCIsIGMpLCBuID0gITA7XG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICBlLmVycm9yKFwiZmJwaXhlbDogRmFjZWJvb2sgUGl4ZWwgSUQgaXMgbm90IGRlZmluZWRcIik7XG4gICAgICAgICAgICB9IH0gfSwgdHJhY2tFdmVudDogZnVuY3Rpb24gKGUsIG4pIHsgdChcInRyYWNrXCIsIGUsIG4pOyB9LCB0cmFja0N1c3RvbUV2ZW50OiBmdW5jdGlvbiAoZSwgbikgeyB0KFwidHJhY2tDdXN0b21cIiwgZSwgbik7IH0gfTsgfSgpO1xuICAgIHBuLmNvbnRhaW5lci5yZWdpc3RlcihcImZicGl4ZWxcIiwgeyB1c2VWYWx1ZTogc24gfSksIHBuLmZicGl4ZWwgPSBwbi5jb250YWluZXIucmVzb2x2ZShcImZicGl4ZWxcIik7XG4gICAgdmFyIGNuID0gZnVuY3Rpb24gKCkgeyB2YXIgZSA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwidXRpbFwiKSwgbiA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwiZmJwaXhlbFwiKSwgdCA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwib2ZmZXJcIiksIHIgPSBwbi5jb250YWluZXIucmVzb2x2ZShcInVzZXJcIiksIG8gPSBwbi5jb250YWluZXIucmVzb2x2ZShcImFwaVwiKSwgaSA9ICExLCBhID0gXCJcIiwgcyA9IHt9LCBjID0ge307IGZ1bmN0aW9uIGwobikgeyByZXR1cm4gbmV3IFByb21pc2UoKGZ1bmN0aW9uICh0KSB7IHZhciBpID0geyBhaWQ6IHBuLmFpZCwgcmlkOiBcIlwiLCBhY2NvdW50X2xpbmtpbmdfdG9rZW46IGUuZ2V0UXVlcnlQYXJhbUJ5TmFtZShcImFjY291bnRfbGlua2luZ190b2tlblwiKSwgdXNlcl90b2tlbjogci5nZXRQcm92aWRlcigpLmdldFRva2VuKCksIHVzZXJfcHJvdmlkZXI6IHIuZ2V0UHJvdmlkZXIoKS5nZXROYW1lKCkgfTsgbiAmJiAoaS5yaWQgPSBuKSwgby5jYWxsQXBpKFwiL2ZiaWEvc3Vic2NyaXB0aW9uUGF5bG9hZC9nZW5lcmF0ZVwiLCBpLCAoZnVuY3Rpb24gKGUpIHsgZSAmJiBlLmRhdGEgJiYgKGEgPSBlLmRhdGEpLCB0KG51bGwpOyB9KSk7IH0pKTsgfSB2YXIgdSA9IGZ1bmN0aW9uICgpIHsgbCgpLnRoZW4oKGZ1bmN0aW9uICgpIHsgYSAmJiBwKCk7IH0pKTsgfSwgZCA9IGZ1bmN0aW9uIChuKSB7IGlmIChuKSB7XG4gICAgICAgIHZhciB0ID0gbmV3IFByb21pc2UoKGZ1bmN0aW9uIChlKSB7IHNldFRpbWVvdXQoKGZ1bmN0aW9uICgpIHsgZShudWxsKTsgfSksIDFlMyAqIHBuLnJlZGlyZWN0VG9GYlRpbWVvdXQpOyB9KSksIHIgPSBsKG4pO1xuICAgICAgICBlLl9fcHJvdGVjdGVkX18ud2FpdEFsbFByb21pc2VzKFt0LCByXSkudGhlbigoZnVuY3Rpb24gKCkgeyBwKCk7IH0pKTtcbiAgICB9XG4gICAgZWxzZVxuICAgICAgICBlLmVycm9yKFwiZmJzdWJzY3JpcHRpb25zOiAncmlkJyBjb3VsZCBub3QgYmUgZW1wdHkgb24gZ2VuZXJhdGluZyBzdWJzY3JpcHRpb24gcGF5bG9hZFwiKTsgfSwgcCA9IGZ1bmN0aW9uICgpIHsgdmFyIG4gPSBlLmdldFF1ZXJ5UGFyYW1CeU5hbWUoXCJhY2NvdW50X2xpbmtpbmdfdG9rZW5cIiksIHQgPSBlLmdldFF1ZXJ5UGFyYW1CeU5hbWUoXCJyZWRpcmVjdF91cmlcIikgKyBcIj9hY2NvdW50X2xpbmtpbmdfdG9rZW49XCIgKyBlbmNvZGVVUklDb21wb25lbnQobik7IGEgJiYgKHQgKz0gXCImc3Vic2NyaXB0aW9uX3BheWxvYWQ9XCIgKyBlbmNvZGVVUklDb21wb25lbnQoYSkpLCB3aW5kb3cubG9jYXRpb24uaHJlZiA9IHQ7IH0sIGYgPSBmdW5jdGlvbiAoZSwgdCkgeyBzW2VdIHx8IChzW2VdID0gITAsIG4udHJhY2tFdmVudChlLCB0KSk7IH0sIG0gPSBmdW5jdGlvbiAoZSwgdCkgeyBjW2VdIHx8IChjW2VdID0gITAsIG4udHJhY2tDdXN0b21FdmVudChlLCB0KSk7IH0sIGcgPSBmdW5jdGlvbiAoKSB7IHJldHVybiBpOyB9OyByZXR1cm4geyBuYW1lOiBcImZic3Vic2NyaXB0aW9uc1wiLCBjaGVja1VzZXJBY2Nlc3NBbmRSZWRpcmVjdFRvRmI6IGZ1bmN0aW9uICgpIHsgbCgpLnRoZW4oKGZ1bmN0aW9uICgpIHsgcCgpOyB9KSk7IH0sIGlzSW5pdGlhbGl6ZWQ6IGcsIF9fcHJpdmF0ZV9fOiB7IGlzSW5pdGlhbGl6ZWQ6IGcgfSwgX19wcm90ZWN0ZWRfXzogeyBpbml0OiBmdW5jdGlvbiAoKSB7IGlmICghaSkge1xuICAgICAgICAgICAgICAgIG4uX19wcm90ZWN0ZWRfXy5pbml0KCksIHQucmVnaXN0ZXJDYWxsYmFjayhcImxvYWRlZFwiLCAoZnVuY3Rpb24gKCkgeyB2YXIgbiA9IGUuZ2V0UXVlcnlQYXJhbUJ5TmFtZShcInN1cmZhY2VcIik7IFwibWV0ZXJfbGltaXRfcmVhY2hlZFwiICE9PSBuICYmIFwibG9ja2VkX2FydGljbGVcIiAhPT0gbiB8fCBwbi5pbmFwcEJyb3dzZXJSZXR1cm4gfHwgbShcIlZpZXdQYXl3YWxsXCIsIHsgc3VyZmFjZTogXCJJQVwiIH0pOyB9KSk7XG4gICAgICAgICAgICAgICAgcG4uYWRkSGFuZGxlcihcImxvZ2luU3VjY2Vzc1wiLCAoZnVuY3Rpb24gKGUpIHsgbCgpLnRoZW4oKGZ1bmN0aW9uICgpIHsgZS5yZWdpc3RyYXRpb24gPyBtKFwiQ3JlYXRlQWNjb3VudFwiKSA6IG0oXCJMb2dJbnRvQWNjb3VudFwiLCB7IGlzX3N1YnNjcmliZXI6ICEhYSB9KSwgYSAmJiBzZXRUaW1lb3V0KChmdW5jdGlvbiAoKSB7IHAoKTsgfSksIDIwMCk7IH0pKTsgfSkpLCBwbi5hZGRIYW5kbGVyKFwiZXhwZXJpZW5jZUV4ZWN1dGVcIiwgKGZ1bmN0aW9uICgpIHsgci5pc1VzZXJWYWxpZCgpICYmIHUoKTsgfSkpLCB0LnJlZ2lzdGVyQ2FsbGJhY2soXCJhbHJlYWR5UHVyY2hhc2VkXCIsIChmdW5jdGlvbiAoZSkgeyBkKGUucmlkKTsgfSkpLCB0LnJlZ2lzdGVyQ2FsbGJhY2soXCJzdGFydENoZWNrb3V0XCIsIChmdW5jdGlvbiAoZSkgeyBmKFwiSW5pdGlhdGVDaGVja291dFwiLCB7IG9mZmVyX2NvZGU6IGUub2ZmZXJJZCwgY2FtcGFpZ25fY29kZTogZS50ZXJtSWQgfSk7IH0pKSwgdC5yZWdpc3RlckNhbGxiYWNrKFwiY29tcGxldGVcIiwgKGZ1bmN0aW9uIChlKSB7IGUuaGFzT3duUHJvcGVydHkoXCJjaGFyZ2VDdXJyZW5jeVwiKSAmJiBlLmhhc093blByb3BlcnR5KFwiY2hhcmdlQW1vdW50XCIpICYmIGYoXCJQdXJjaGFzZVwiLCB7IGN1cnJlbmN5OiBlLmNoYXJnZUN1cnJlbmN5LCB2YWx1ZTogZS5jaGFyZ2VBbW91bnQsIG9mZmVyX2NvZGU6IGUub2ZmZXJJZCwgY2FtcGFpZ25fY29kZTogZS50ZXJtSWQgfSksIGQoZS5yaWQpOyB9KSksIHQucmVnaXN0ZXJDYWxsYmFjayhcImNsb3NlXCIsIChmdW5jdGlvbiAoKSB7IHAoKTsgfSkpLCBpID0gITA7XG4gICAgICAgICAgICB9IH0gfSB9OyB9KCk7XG4gICAgcG4uY29udGFpbmVyLnJlZ2lzdGVyKFwiZmJzdWJzY3JpcHRpb25zXCIsIHsgdXNlVmFsdWU6IGNuIH0pLCBwbi5mYnN1YnNjcmlwdGlvbnMgPSBwbi5jb250YWluZXIucmVzb2x2ZShcImZic3Vic2NyaXB0aW9uc1wiKTtcbiAgICB2YXIgbG4gPSBmdW5jdGlvbiAoZSkgeyB2b2lkIDAgPT09IGUgJiYgKGUgPSBwbi5jb250YWluZXIpOyB2YXIgbiA9IGUucmVzb2x2ZShcImpxVXRpbHNcIiksIHQgPSBlLnJlc29sdmUoXCJ1dGlsXCIpLCByID0gZS5yZXNvbHZlKFwicmVjV2lkZ2V0U2VydmljZVwiKS5fX3Byb3RlY3RlZF9fLmdldEluc3RhbmNlKCksIG8gPSBbXSwgaSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHZvaWQgMCAhPT0gcG4uY3hDZG5VcmwgJiYgXCJcIiAhPT0gcG4uY3hDZG5VcmwgPyBwbi5jeENkblVybCA6IFwiaHR0cHM6Ly9jZG4uY3hlbnNlLmNvbVwiOyB9LCBhID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdm9pZCAwICE9PSBwbi5jeGVuc2VTaXRlSWQgJiYgXCJcIiAhPT0gcG4uY3hlbnNlU2l0ZUlkOyB9LCBzID0gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIHZvaWQgMCAhPT0gd2luZG93LmNYICYmIHZvaWQgMCAhPT0gd2luZG93LmNYLmxpYnJhcnkgJiYgKGUgfHwgdm9pZCAwICE9PSB3aW5kb3cuY1guQ0NFICYmIHZvaWQgMCAhPT0gd2luZG93LmNYLkNDRS5saWJyYXJ5KTsgfSwgYyA9IGZ1bmN0aW9uIChlKSB7IHJldHVybiB2b2lkIDAgIT09IGUuY3hlbnNlQ3VzdG9tZXJQcmVmaXggJiYgXCJcIiAhPT0gZS5jeGVuc2VDdXN0b21lclByZWZpeDsgfSwgbCA9IGZ1bmN0aW9uIChlKSB7IHZhciBuLCByLCBvID0gd2luZG93LmNYID0gd2luZG93LmNYIHx8IHt9OyBvLmNhbGxRdWV1ZSA9IG8uY2FsbFF1ZXVlIHx8IFtdOyB2YXIgaSA9IFwiYW5vblwiOyBlLnVpZCAmJiBcImFub25cIiAhPT0gZS51aWQgJiYgXCJcIiAhPT0gZS51aWQgJiYgKGkgPSAhIShudWxsID09PSAociA9IG51bGwgPT09IChuID0gZS5ldmVudEV4ZWN1dGlvbkNvbnRleHQpIHx8IHZvaWQgMCA9PT0gbiA/IHZvaWQgMCA6IG4uYWNjZXNzTGlzdCkgfHwgdm9pZCAwID09PSByID8gdm9pZCAwIDogci5sZW5ndGgpID8gXCJoYXNBY3RpdmVBY2Nlc3NcIiA6IFwicmVnaXN0ZXJlZFwiLCBvLmNhbGxRdWV1ZS5wdXNoKFtcImFkZEV4dGVybmFsSWRcIiwgeyBpZDogZS51aWQsIHR5cGU6IGUuY3hlbnNlQ3VzdG9tZXJQcmVmaXggfV0pLCB0LmRlYnVnKFwiYzF4OiBhZGRpbmcgZXh0ZXJuYWxJZFwiLCB7IHVpZDogZS51aWQsIHByZWZpeDogZS5jeGVuc2VDdXN0b21lclByZWZpeCB9KSk7IG8uY2FsbFF1ZXVlLnB1c2goW1wic2V0Q3VzdG9tUGFyYW1ldGVyc1wiLCB7IHVzZXJTdGF0ZTogaSB9XSksIHQuZGVidWcoXCJjMXg6IGFkZGluZyBDdXN0b21QYXJhbWV0ZXJzIHVzZXJTdGF0ZVwiLCB7IHVzZXJTdGF0ZTogaSB9KSwgZCghMSwgZS5icm93c2VySWQsIGUucGFnZVZpZXdJZCwgcG4uY3hlbnNlU2l0ZUlkKSwgdC5kZWJ1ZyhcImMxeDogc2VuZGluZyBwYWdldmlldyBldmVudFwiKSwgby5jYWxsUXVldWUucHVzaChbXCJzZW5kUGFnZVZpZXdFdmVudFwiXSk7IH0sIHUgPSBmdW5jdGlvbiAoZSwgbiwgdCwgcikgeyB0ICYmICghMCA9PT0gciA/IGUuY2FsbFF1ZXVlLnVuc2hpZnQoW24sIHRdKSA6IGUuY2FsbFF1ZXVlLnB1c2goW24sIHRdKSk7IH0sIGQgPSBmdW5jdGlvbiAoZSwgbiwgciwgbykgeyB2YXIgaSA9IHdpbmRvdy5jWCA9IHdpbmRvdy5jWCB8fCB7fTsgaS5jYWxsUXVldWUgPSBpLmNhbGxRdWV1ZSB8fCBbXSwgdShpLCBcInNldFNpdGVJZFwiLCBvLCBlKSwgbiAmJiB1KGksIFwiaW52b2tlXCIsIChmdW5jdGlvbiAoKSB7IHdpbmRvdy5jWE5hdGl2ZSA9IHsgZ2V0VXNlcklkOiBmdW5jdGlvbiAoKSB7IHJldHVybiBuOyB9IH07IH0pLCBlKSwgdShpLCBcInNldFJhbmRvbUlkXCIsIHIsIGUpLCB0LmRlYnVnKFwiYzF4OiBpbmplY3RpbmcgaWRzXCIsIHsgYnJvd3NlcklkOiBuLCBwYWdlVmlld0lkOiByLCBzaXRlSWQ6IG8gfSk7IH0sIHAgPSBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IG51bGwsIHQgPSBbXTsgZnVuY3Rpb24gcigpIHsgbiAmJiBjbGVhclRpbWVvdXQobiksIG4gPSBudWxsLCBlKHQpLCB0ID0gW107IH0gcmV0dXJuIGZ1bmN0aW9uIChlKSB7IG4gfHwgKG4gPSBzZXRUaW1lb3V0KHIsIDEwKSksIHQucHVzaChlKTsgfTsgfSgoZnVuY3Rpb24gKGUpIHsgaWYgKGEoKSkge1xuICAgICAgICBmb3IgKHZhciBuID0gW10sIGkgPSBmdW5jdGlvbiAoKSB7IHZhciB0ID0gZVtzXSB8fCB7fTsgci5zaG93UmVjb21tZW5kYXRpb24oeyB3aWRnZXRDb25maWc6IHQsIGNyZWF0ZVBsYWNlaG9sZGVyRm46IGYodC53aWRnZXRJZCwgdC5kaXNwbGF5TW9kZSkgfSkgJiYgbi5wdXNoKHsgd2lkZ2V0UGFyYW1zOiB7IHdpZGdldElkOiB0LndpZGdldElkLCB0YXJnZXRFbGVtZW50SWQ6IFwiY3hlbnNlLVwiICsgdC53aWRnZXRJZCwgZXhwZXJpZW5jZUlkOiB0LmV4cGVyaWVuY2VJZCB9LCB3aWRnZXRDYWxsYmFjazogZnVuY3Rpb24gKGUpIHsgdmFyIG4gPSBlICYmIGUucmVzcG9uc2U7IGlmIChuICYmICFlLnJlc3BvbnNlLmVycm9yKSB7XG4gICAgICAgICAgICAgICAgXCJtb2RhbFwiID09PSB0LmRpc3BsYXlNb2RlICYmIHIuZml4V2lkZ2V0TW9kYWxXaWR0aChyLmZpbmRXaWRnZXQodC53aWRnZXRJZCkpO1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbi5pdGVtcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgYSA9IG4uaXRlbXNbaV0uaWQ7XG4gICAgICAgICAgICAgICAgICAgIC0xID09PSBvLmluZGV4T2YoYSkgJiYgby5wdXNoKGEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gfSB9KTsgfSwgcyA9IDA7IHMgPCBlLmxlbmd0aDsgcysrKVxuICAgICAgICAgICAgaSgpO1xuICAgICAgICBtKChmdW5jdGlvbiAoKSB7IHZhciBlOyBlID0gcG4uY3hlbnNlU2l0ZUlkLCB0LmRlYnVnKFwiYzF4OiBzZXR0aW5nIHNpdGVJZDogXCIsIGUpLCB3aW5kb3cuY1guc2V0U2l0ZUlkKGUpLCB3aW5kb3cuY1guQ0NFLnJ1bk11bHRpKG4sIFtcImlkXCJdLCBvKTsgfSkpO1xuICAgIH1cbiAgICBlbHNlXG4gICAgICAgIHQuZGVidWcoXCJjMXg6IGNhbiBub3Qgc2hvdyByZWNvbW1lbmRhdGlvbiBiZWNhdXNlIHNpdGVJZCBpcyBub3QgY29uZmlndXJlZCB1c2luZyBgc2V0Q3hlbnNlU2l0ZUlkYFwiKTsgfSkpLCBmID0gZnVuY3Rpb24gKGUsIHQpIHsgcmV0dXJuIGZ1bmN0aW9uICgpIHsgdmFyIHIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpOyBuLmFkZENsYXNzKFwidHAtY3hlbnNlLXBsYWNlaG9sZGVyLVwiICsgdCwgciksIG4uYWRkQ2xhc3MoXCJ0cC13aWRnZXQtcGxhY2Vob2xkZXJcIiwgcik7IHZhciBvID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTsgcmV0dXJuIG8uaWQgPSBcImN4ZW5zZS1cIiArIGUsIHIuYXBwZW5kQ2hpbGQobyksIHI7IH07IH0sIG0gPSBmdW5jdGlvbiAoZSkgeyB3aW5kb3cuY1ggPSB3aW5kb3cuY1ggfHwge30sIHdpbmRvdy5jWC5DQ0UgPSB3aW5kb3cuY1guQ0NFIHx8IHt9LCB3aW5kb3cuY1guQ0NFLmNhbGxRdWV1ZSA9IHdpbmRvdy5jWC5DQ0UuY2FsbFF1ZXVlIHx8IFtdLCB3aW5kb3cuY1guQ0NFLmNhbGxRdWV1ZS5wdXNoKFtcImludm9rZVwiLCBlXSk7IH0sIGcgPSBmdW5jdGlvbiAoZSkgeyByZXR1cm4gcyhlKTsgfTsgcmV0dXJuIHsgbmFtZTogXCJjeGVuc2VcIiwgX19wcm90ZWN0ZWRfXzogeyBzaG93UmVjb21tZW5kYXRpb246IHAsIHNlbmRQYWdlVmlld0V2ZW50OiBmdW5jdGlvbiAoZSkgeyAoYSgpIHx8IGMoZSkpICYmIChhKCkgfHwgIWMoZSkgPyAhYSgpIHx8IGMoZSkgPyBsKGUpIDogdC5kZWJ1ZyhcImN4ZW5zZTogY2FuIG5vdCBzZW5kIHBhZ2V2aWV3IGJlY2F1c2UgY3VzdG9tZXIgcHJlZml4IGlzIG5vdCBjb25maWd1cmVkIGluIGFwcCBzZXR0aW5nc1wiKSA6IHQuZGVidWcoXCJjeGVuc2U6IGNhbiBub3Qgc2VuZCBwYWdldmlldyBiZWNhdXNlIHNpdGVJZCBpcyBub3QgY29uZmlndXJlZCB1c2luZyBgc2V0Q3hlbnNlU2l0ZUlkYFwiKSk7IH0sIGlzQWN0aXZhdGVkOiBhLCBpc0N1c3RvbWVyUHJlZml4Q29uZmlndXJlZDogYywgaXNDb25maWd1cmVkUG9sbGluZ0FzeW5jOiBmdW5jdGlvbiAoZSwgbiwgdCkgeyBuID0gbiB8fCAwLCB0ID0gdCB8fCAwOyB2YXIgciA9IDA7IHJldHVybiBuZXcgUHJvbWlzZSgoZnVuY3Rpb24gKG8sIGkpIHsgdmFyIGEgPSBmdW5jdGlvbiAoKSB7IGcoZSkgPyBvKCEwKSA6IHIgPj0gdCA/IGkoZSA/IFwiYzF4OiBjWCBvYmplY3QgaXMgbm90IGZvdW5kIGFmdGVyIFwiICsgdCArIFwiIHJldHJpZXMgd2l0aCBcIiArIG4gKyBcIm1zIGludGVydmFsXCIgOiBcImMxeDogY1ggYW5kIGNYLkNDRSBvYmplY3RzIGFyZSBub3QgZm91bmQgYWZ0ZXIgXCIgKyB0ICsgXCIgcmV0cmllcyB3aXRoIFwiICsgbiArIFwibXMgaW50ZXJ2YWxcIikgOiAocisrLCBzZXRUaW1lb3V0KGEsIG4pKTsgfTsgZyhlKSA/IG8oITApIDogc2V0VGltZW91dChhLCBuKTsgfSkpOyB9LCBpbnZva2VDeGVuc2VGbjogbSwgZ2V0QzFYSW50ZWdyYXRpb25WZXJzaW9uOiBmdW5jdGlvbiAoKSB7IHJldHVybiB2b2lkIDAgIT09IHBuLmMxWEludGVncmF0aW9uVmVyc2lvbiAmJiBcIlwiICE9PSBwbi5jeGVuc2VTaXRlSWQgPyBwbi5jMVhJbnRlZ3JhdGlvblZlcnNpb24gOiBcIk4vQVwiOyB9LCBnZXRPckdlbmVyYXRlQ3hDb21wYXRpYmxlQmlkOiBmdW5jdGlvbiAoKSB7IHZhciBlID0gdC5fX3Byb3RlY3RlZF9fLmdldENvb2tpZShcImNYX1BcIiksIG4gPSBudWxsOyB0cnkge1xuICAgICAgICAgICAgICAgIHQuX19wcm90ZWN0ZWRfXy5oYXNMb2NhbFN0b3JhZ2UoKSAmJiAobiA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKFwiX2NYX1BcIikpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGUpIHsgfSB2YXIgciA9IGUgfHwgbjsgcmV0dXJuIHIgPyAodC5kZWJ1ZyhcImMxeDogZXhpc3RpbmcgY1hfUCB2YWx1ZSBoYXMgYmVlbiBmb3VuZDogXCIsIHIpLCByKSA6ICh0LmRlYnVnKFwiYzF4OiBjYW4gbm90IGZpbmQgZXhpc3RpbmcgY1hfUCB2YWx1ZSwgZ2VuZXJhdGluZyBhIG5ldyBvbmVcIiksIHQuX19wcm90ZWN0ZWRfXy5yYW5kb21TdHJpbmdDeENvbXBhdGlibGUoKSk7IH0sIGxvYWRDeExpYklmTmVlZGVkOiBmdW5jdGlvbiAoKSB7IHZhciBlOyBpZiAoIWEoKSB8fCAhcyghMCkpIHtcbiAgICAgICAgICAgICAgICB2YXIgbiA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwic2NyaXB0XCIpWzBdLCByID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNjcmlwdFwiKTtcbiAgICAgICAgICAgICAgICByLm9uZXJyb3IgPSBmdW5jdGlvbiAoZSkgeyB0LmRlYnVnKFwiYzF4OiBlcnJvciBkdXJpbmcgbG9hZCBvZiBjeC5qcy4gXCIsIGUpOyB9LCByLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHsgdC5kZWJ1ZyhcImMxeDogY3guanMgaGFzIGJlZW4gc3VjY2Vzc2Z1bGx5IGxvYWRlZFwiKTsgfSwgci5hc3luYyA9ICEwLCByLnR5cGUgPSBcInRleHQvamF2YXNjcmlwdFwiLCBwbi5jMVhMb2FkQ2NlID8gci5zcmMgPSBpKCkgKyBcIi9jeC5jY2UuanNcIiA6IHIuc3JjID0gaSgpICsgXCIvY3guanNcIiwgdC5kZWJ1ZyhcImMxeDogc3RhcnQgbG9hZGluZyBjeC5qcyBvbiB0aGUgcGFnZS4uLlwiKSwgbnVsbCA9PT0gKGUgPSBuLnBhcmVudE5vZGUpIHx8IHZvaWQgMCA9PT0gZSB8fCBlLmluc2VydEJlZm9yZShyLCBuKTtcbiAgICAgICAgICAgIH0gfSwgc2V0Q3hCaWRDb29raWU6IGZ1bmN0aW9uIChlLCBuKSB7IHZhciByOyByID0geyBwYXRoOiBcIi9cIiwgZXhwaXJlczogNzMwIH0sIG4gJiYgKHIuZG9tYWluID0gbiwgdC5fX3Byb3RlY3RlZF9fLmRlbGV0ZVRMRENvb2tpZUZvclNwZWNpZmljRG9tYWlucyhcImNYX1BcIiwgbikpLCB0LmRlbGV0ZUNvb2tpZShcImNYX1BcIiksIHQuX19wcm90ZWN0ZWRfXy5zZXRDb29raWUoXCJjWF9QXCIsIGUsIHIpOyB9LCB0cnlUb0dldEN4UGFnZVZpZXdJZDogZnVuY3Rpb24gKGUpIHsgdmFyIG4sIHQsIHIgPSB3aW5kb3cuY1g7IHJldHVybiAobnVsbCA9PT0gKHQgPSBudWxsID09PSAobiA9IG51bGwgPT0gciA/IHZvaWQgMCA6IHIuZ2V0UGFnZUNvbnRleHQpIHx8IHZvaWQgMCA9PT0gbiA/IHZvaWQgMCA6IG4uY2FsbChyKSkgfHwgdm9pZCAwID09PSB0ID8gdm9pZCAwIDogdC5wYWdlVmlld1JhbmRvbSkgfHwgZTsgfSwgaW5qZWN0SWRzOiBkIH0gfTsgfTtcbiAgICBwbi5jb250YWluZXIucmVnaXN0ZXIoXCJjeGVuc2VcIiwgeyB1c2VWYWx1ZTogbG4oKSB9KSwgcG4uY3hlbnNlID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJjeGVuc2VcIik7XG4gICAgdmFyIHVuID0gZnVuY3Rpb24gKGUpIHsgdm9pZCAwID09PSBlICYmIChlID0gcG4uY29udGFpbmVyKTsgdmFyIG4sIHQsIHIgPSBlLnJlc29sdmUoXCJqcVV0aWxzXCIpLCBvID0gZS5yZXNvbHZlKFwidXRpbFwiKSwgaSA9IGUucmVzb2x2ZShcImFwaVwiKSwgYSA9IGUucmVzb2x2ZShcImV2ZW50VXRpbHNcIiksIHMgPSBlLnJlc29sdmUoXCJzY3JvbGxEZXB0aFwiKSwgYyA9IGUucmVzb2x2ZShcImxvZ1wiKSwgbCA9IGUucmVzb2x2ZShcImFqYXhcIiksIHUgPSBlLnJlc29sdmUoXCJ2aWV3cG9ydEV4aXRcIiksIGQgPSBlLnJlc29sdmUoXCJpZGxlXCIpLCBwID0gZS5yZXNvbHZlKFwiaW50ZXJhY3Rpb25cIiksIGYgPSBlLnJlc29sdmUoXCJwaWFub0VzcFwiKSwgbSA9IGUucmVzb2x2ZShcInN3Z1wiKSwgZyA9IGUucmVzb2x2ZShcImZic3Vic2NyaXB0aW9uc1wiKSwgdiA9IGUucmVzb2x2ZShcInVzZXJcIiksIGggPSBlLnJlc29sdmUoXCJjeGVuc2VcIiksIHcgPSBlLnJlc29sdmUoXCJsb2dnaW5nXCIpLCB5ID0gW10sIGIgPSB7fSwgayA9IFwiXCIsIF8gPSAhMSwgQyA9IFwicmVhZGVyX2lkXCIsIEkgPSAhMSwgUyA9IHt9LCB4ID0gKG4gPSB7IGFwcGx5Q3NzOiB7IGZuOiBmdW5jdGlvbiAoZSkgeyBlLmV2ZW50UGFyYW1zLnJ1bGVMaXN0LmZvckVhY2goKGZ1bmN0aW9uIChlKSB7IHZhciBuLCB0ID0gZS5jbGFzc2VzLCBpID0gZS5lbGVtZW50czsgdCAmJiAodCA9IHQucmVwbGFjZSgvWywuXS9nLCBcIiBcIikuc3BsaXQoXCIgXCIpLmZpbHRlcigoZnVuY3Rpb24gKGUpIHsgcmV0dXJuIFwiXCIgIT09IGU7IH0pKSwgXCJhZGRcIiA9PT0gZS50eXBlICYmIChuID0gci5xYShpKSkgJiYgbi5sZW5ndGggJiYgbi5mb3JFYWNoKChmdW5jdGlvbiAoZSkgeyB0LmZvckVhY2goKGZ1bmN0aW9uIChuKSB7IHIuYWRkQ2xhc3MobiwgZSk7IH0pKTsgfSkpLCBcInJlbW92ZVwiID09PSBlLnR5cGUgJiYgKG4gPSByLnFhKGkpKSAmJiBuLmxlbmd0aCAmJiBuLmZvckVhY2goKGZ1bmN0aW9uIChlKSB7IHQuZm9yRWFjaCgoZnVuY3Rpb24gKG4pIHsgci5yZW1vdmVDbGFzcyhuLCBlKTsgfSkpOyB9KSkpOyBvLmRlYnVnKFwiZXhwOiBjc3MgYXBwbGllZCB3aXRoIHJ1bGU6XCIsIGUpOyB9KSk7IH0sIGlzQWN0aW9uOiAhMCwgc2hvdWxkRmlyZUNhbGxiYWNrOiAhMCB9LCBydW5KczogeyBmbjogZnVuY3Rpb24gKGUpIHsgaWYgKGUuZXZlbnRQYXJhbXMgJiYgZS5ldmVudFBhcmFtcy5zbmlwcGV0KSB7XG4gICAgICAgICAgICAgICAgdmFyIG4gPSBlLmV2ZW50UGFyYW1zLnNuaXBwZXQ7XG4gICAgICAgICAgICAgICAgby5kZWJ1ZyhcImV4cDogcnVuIGpzIHdpdGggc25pcHBldDpcIiwgbik7XG4gICAgICAgICAgICAgICAgdmFyIHQgPSBlLmV2ZW50RXhlY3V0aW9uQ29udGV4dDtcbiAgICAgICAgICAgICAgICBvLmRlYnVnKFwiZXhwOiBzZXQgcHVibGlzaGVyJ3MgY29udGV4dCBhbmQgY3VzdG9tOlwiLCB0KSwgZmUoXCJ2YXIgY29udGV4dCA9IFwiICsgSlNPTi5zdHJpbmdpZnkodCkgKyBcIjtcXG52YXIgY3VzdG9tID0gXCIgKyBKU09OLnN0cmluZ2lmeShwbi5jdXN0b21WYXJpYWJsZXMpICsgXCI7XFxuXCIgKyBuKTtcbiAgICAgICAgICAgIH0gfSwgaXNBY3Rpb246ICEwLCBzaG91bGRGaXJlQ2FsbGJhY2s6ICEwIH0sIHNldENvb2tpZTogeyBmbjogZnVuY3Rpb24gKGUpIHsgdmFyIG4gPSBlLmV2ZW50UGFyYW1zOyBpZiAobiAmJiB2b2lkIDAgIT09IG4uY29va2llTmFtZSAmJiB2b2lkIDAgIT09IG4uY29va2llVmFsdWUpIHtcbiAgICAgICAgICAgICAgICBvLmRlYnVnKFwiZXhwOiBzZXQgY29va2llIHdpdGggcGFyYW1ldGVyczpcIiwgbik7XG4gICAgICAgICAgICAgICAgdmFyIHQgPSAobi5pc1JlYWRhYmxlQ29va2llID8gXCJfcGNfXCIgOiBcIlwiKSArIG4uY29va2llTmFtZSwgciA9IHsgZG9tYWluOiBuLmNvb2tpZURvbWFpbiwgcGF0aDogbi5jb29raWVQYXRoIH07XG4gICAgICAgICAgICAgICAgaWYgKCFuLmlzU2Vzc2lvbkNvb2tpZSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgaSA9IG5ldyBEYXRlO1xuICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKG4uZXhwaXJhdGlvblVuaXQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJzZWNvbmRzXCI6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaS5zZXRTZWNvbmRzKGkuZ2V0U2Vjb25kcygpICsgbi5leHBpcmF0aW9uVmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcIm1pbnV0ZXNcIjpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpLnNldE1pbnV0ZXMoaS5nZXRNaW51dGVzKCkgKyBuLmV4cGlyYXRpb25WYWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiaG91cnNcIjpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpLnNldEhvdXJzKGkuZ2V0SG91cnMoKSArIG4uZXhwaXJhdGlvblZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJkYXlzXCI6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaS5zZXREYXRlKGkuZ2V0RGF0ZSgpICsgbi5leHBpcmF0aW9uVmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcIm1vbnRoc1wiOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkuc2V0TW9udGgoaS5nZXRNb250aCgpICsgbi5leHBpcmF0aW9uVmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcInllYXJzXCI6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaS5zZXRGdWxsWWVhcihpLmdldEZ1bGxZZWFyKCkgKyBuLmV4cGlyYXRpb25WYWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OiBvLmxvZyhcIldyb25nIGV2ZW50UGFyYW1zLmV4cGlyYXRpb25Vbml0IDogXCIsIG4uZXhwaXJhdGlvblVuaXQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHIuZXhwaXJlcyA9IGk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIG8uX19wcm90ZWN0ZWRfXy5zZXRDb29raWUodCwgbi5jb29raWVWYWx1ZSwgcik7XG4gICAgICAgICAgICB9IH0sIGlzQWN0aW9uOiAhMCwgc2hvdWxkRmlyZUNhbGxiYWNrOiAhMCB9LCBub25TaXRlOiB7IGZuOiBmdW5jdGlvbiAoZSkgeyBvLmRlYnVnKFwiZXhwOiBub24tc2l0ZSBhY3Rpb246XCIsIGUpOyB9LCBpc0FjdGlvbjogITAsIHNob3VsZEZpcmVDYWxsYmFjazogITAgfSwgc2hvd0Zvcm06IHsgZm46IGZ1bmN0aW9uIChlKSB7IHZhciBuID0gZS5ldmVudFBhcmFtczsgaWYgKG4gJiYgbi5mb3JtTmFtZSkge1xuICAgICAgICAgICAgICAgIHZhciB0ID0geyBmb3JtTmFtZTogbi5mb3JtTmFtZSwgaGlkZUlmQ29tcGxldGU6IG4uaGlkZUNvbXBsZXRlZEZpZWxkcywgdHJhY2tpbmdJZDogZS5ldmVudEV4ZWN1dGlvbkNvbnRleHQudHJhY2tpbmdJZCwgZGlzcGxheU1vZGU6IG4uZGlzcGxheU1vZGUsIGNvbnRhaW5lclNlbGVjdG9yOiBuLmNvbnRhaW5lclNlbGVjdG9yLCBzaG93Q2xvc2VCdXR0b246IG4uc2hvd0Nsb3NlQnV0dG9uLCBhY2Nlc3NUb2tlbjogdi5nZXRQcm92aWRlcigpLmdldFRva2VuKCkgfTtcbiAgICAgICAgICAgICAgICBuLmZvcm1XaWR0aCAmJiBuLmZvcm1XaWR0aC5lbmFibGVkICYmICh0ID0gci5kZWVwRXh0ZW5kKHt9LCB7IHdpZHRoOiBuLmZvcm1XaWR0aC53aWR0aCB9LCB0KSksIG8uZGVidWcoXCJleHA6IHNob3cgZm9ybSB3aXRoIHBhcmFtczpcIiwgbiksIHBuLnBpYW5vSWQuc2hvd0Zvcm0odCk7XG4gICAgICAgICAgICB9IH0sIGlzQWN0aW9uOiAhMCwgc2hvdWxkRmlyZUNhbGxiYWNrOiAhMCB9LCBzaG93UmVjb21tZW5kYXRpb25zOiB7IGZuOiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gbWUoZSwgZnVuY3Rpb24gKGUpIHsgcmV0dXJuIHsgRVNQOiBmLl9fcHJvdGVjdGVkX18uc2hvd1JlY29tbWVuZGF0aW9uLmJpbmQoZiksIENYRU5TRTogaC5fX3Byb3RlY3RlZF9fLnNob3dSZWNvbW1lbmRhdGlvbi5iaW5kKGgpIH1bZV0gfHwgZnVuY3Rpb24gKCkgeyB9OyB9KGUuZXZlbnRQYXJhbXMudHlwZSkpOyB9LCBpc0FjdGlvbjogITAsIHNob3VsZEZpcmVDYWxsYmFjazogITAgfSwgc2hvd09mZmVyOiB7IGZuOiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gbWUoZSwgKGZ1bmN0aW9uIChlKSB7IHJldHVybiBwbi5vZmZlci5zaG93KGUpOyB9KSk7IH0sIGlzQWN0aW9uOiAhMCwgc2hvdWxkRmlyZUNhbGxiYWNrOiAhMSB9LCBzaG93VGVtcGxhdGU6IHsgZm46IGdlLCBpc0FjdGlvbjogITAsIHNob3VsZEZpcmVDYWxsYmFjazogITEgfSwgc2hvd1p1b3JhT2ZmZXI6IHsgZm46IGdlLCBpc0FjdGlvbjogITAsIHNob3VsZEZpcmVDYWxsYmFjazogITEgfSwgc2hvd05ld3NjeWNsZU9mZmVyOiB7IGZuOiBnZSwgaXNBY3Rpb246ICEwLCBzaG91bGRGaXJlQ2FsbGJhY2s6ICExIH0sIHNob3dOZXdzbGV0dGVyU2lnbnVwOiB7IGZuOiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gbWUoZSwgKGZ1bmN0aW9uIChlKSB7IHJldHVybiBmLl9fcHJvdGVjdGVkX18uc2hvd05ld3NsZXR0ZXJTaWdudXAoZSk7IH0pKTsgfSwgaXNBY3Rpb246ICEwLCBzaG91bGRGaXJlQ2FsbGJhY2s6ICExIH0sIHNob3dQdXNoU2lnblVwOiB7IGZuOiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gbWUoZSwgKGZ1bmN0aW9uIChlKSB7IHJldHVybiBmLl9fcHJvdGVjdGVkX18uc2hvd1B1c2hTaWdudXAoZSk7IH0pKTsgfSwgaXNBY3Rpb246ICEwLCBzaG91bGRGaXJlQ2FsbGJhY2s6ICExIH0sIHNob3dMb2dpbjogeyBmbjogZnVuY3Rpb24gKCkgeyB2LnNob3dMb2dpbih7fSk7IH0sIGlzQWN0aW9uOiAhMCwgc2hvdWxkRmlyZUNhbGxiYWNrOiAhMCB9LCBjb250aW51ZUV4ZWN1dGlvbjogeyBmbjogZnVuY3Rpb24gKGUsIG4pIHsgby5kZWJ1ZyhcImV4cDogY29udGludWUgZXhlY3V0aW9uIGFjdGlvbjpcIiwgZSwgXCJ3aXRoIHJlcXVlc3RQYXJhbWV0ZXJzXCIsIG4pOyB2YXIgdCA9IG4gfHwge307IHQuZXhwZXJpZW5jZV9pZCA9IGUuZXZlbnRFeGVjdXRpb25Db250ZXh0LmV4cGVyaWVuY2VJZCwgdC5leHBlcmllbmNlX3ZlcnNpb24gPSBlLmV2ZW50RXhlY3V0aW9uQ29udGV4dC5leHBlcmllbmNlVmVyc2lvbiwgdC5jb250ZXh0X2RhdGEgPSBlLmV2ZW50UGFyYW1zLmNvbnRleHREYXRhLCBRKFwiYXV0b1wiLCB0LCAhMCk7IH0sIHNob3VsZEZpcmVDYWxsYmFjazogITAgfSwgY29udGludWVFeGVjdXRpb25Db21wbGV0ZWQ6IHsgZm46IGJlLCBzaG91bGRGaXJlQ2FsbGJhY2s6ICEwIH0sIG1ldGVyQWN0aXZlOiB7IGZuOiBiZSwgc2hvdWxkRmlyZUNhbGxiYWNrOiAhMCB9LCBtZXRlckV4cGlyZWQ6IHsgZm46IGJlLCBzaG91bGRGaXJlQ2FsbGJhY2s6ICEwIH0sIHVzZXJTZWdtZW50VHJ1ZTogeyBmbjogcGUsIHNob3VsZEZpcmVDYWxsYmFjazogITAgfSwgdXNlclNlZ21lbnRGYWxzZTogeyBmbjogcGUsIHNob3VsZEZpcmVDYWxsYmFjazogITAgfSwgZXhwZXJpZW5jZUV4ZWN1dGlvbkZhaWxlZDogeyBmbjogYmUsIHNob3VsZEZpcmVDYWxsYmFjazogITAgfSwgbG9nOiB7IGZuOiBmdW5jdGlvbiAoZSkgeyBlZShlLmV2ZW50TW9kdWxlUGFyYW1zLm1vZHVsZUlkLCBlKTsgfSwgc2hvdWxkRmlyZUNhbGxiYWNrOiAhMSB9LCBleHBlcmllbmNlRXhlY3V0ZTogeyBmbjogZnVuY3Rpb24gKGUsIG4sIHQpIHsgZS5ldmVudFBhcmFtcy5yZXN1bHQgPSB0OyB9LCBzaG91bGRGaXJlQ2FsbGJhY2s6ICEwIH0sIHNldFJlc3BvbnNlVmFyaWFibGU6IHsgZm46IGZ1bmN0aW9uIChlKSB7IHJldHVybiBlLmV2ZW50UGFyYW1zOyB9LCBpc0FjdGlvbjogITAsIHNob3VsZEZpcmVDYWxsYmFjazogITAgfSwgY3JlZGl0UmVkZWVtZWQ6IHsgZm46IGZ1bmN0aW9uIChlKSB7IG8uZGVidWcoXCJleHA6IGNyZWRpdCByZWRlZW1lZCBhY3Rpb246XCIsIGUpOyB9LCBpc0FjdGlvbjogITAsIHNob3VsZEZpcmVDYWxsYmFjazogITAgfSB9LCB0ID0ge30sIE9iamVjdC5rZXlzKG4pLmZvckVhY2goKGZ1bmN0aW9uIChlKSB7IGlmIChcImZ1bmN0aW9uXCIgIT0gdHlwZW9mIG5bZV0uZm4pXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIlVuc3VwcG9ydGVkIGNvbmZpZyBmb3IgXCIgKyBlICsgXCIgaGFuZGxlclwiKTsgdFtlXSA9IGZ1bmN0aW9uIChlLCBuKSB7IHJldHVybiBmdW5jdGlvbiAodCwgciwgaSkgeyBpZiAoZS5pc0FjdGlvbikge1xuICAgICAgICB2YXIgYSA9IGZ1bmN0aW9uIChlKSB7IHZhciBuID0gZS5ldmVudFBhcmFtcywgdCA9IGUuZXZlbnRNb2R1bGVQYXJhbXMsIHIgPSBlLmV2ZW50RXhlY3V0aW9uQ29udGV4dDsgcmV0dXJuIG8uZGVidWcoXCJleHA6IGZpcmUgZXZlbnQgJ2JlZm9yZUNvbXBvc2VyQWN0aW9uJyB3aXRoIGV2ZW50UGFyYW1zOlwiLCBuLCBcIiwgbW9kdWxlUGFyYW1zOlwiLCB0LCBcIiwgY29udGV4dDpcIiwgciksIEIuZmlyZUNhbGxiYWNrc0FuZFN0b3BPbkZpcnN0RmFsc2UoXCJiZWZvcmVDb21wb3NlckFjdGlvblwiLCBuLCB0LCByKTsgfSh0KTtcbiAgICAgICAgaWYgKCFhKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB2YXIgcyA9IHJlKHQpLCBjID0gdGUodCk7XG4gICAgICAgIChzIHx8IGMpICYmIGVlKHQuZXZlbnRNb2R1bGVQYXJhbXMubW9kdWxlSWQsIHQpO1xuICAgIH0gdmFyIGwsIHUgPSB0LmV2ZW50TW9kdWxlUGFyYW1zLm1vZHVsZUlkOyBTW3VdIHx8IFwiTi9BXCIgPT09IHUgfHwgKFNbdV0gPSB7IGV4cGVyaWVuY2VJZDogdC5ldmVudEV4ZWN1dGlvbkNvbnRleHQuZXhwZXJpZW5jZUlkLCBtb2R1bGVOYW1lOiB0LmV2ZW50TW9kdWxlUGFyYW1zLm1vZHVsZU5hbWUgfSksIGUuZm4odCwgciwgaSksIGUuc2hvdWxkRmlyZUNhbGxiYWNrICYmIChsID0gbiwgZnVuY3Rpb24gKGUpIHsgdmFyIG4gPSBlLmV2ZW50UGFyYW1zLmNhbGxiYWNrLCB0ID0gZS5ldmVudFBhcmFtcywgciA9IGUuZXZlbnRNb2R1bGVQYXJhbXMsIGkgPSBlLmV2ZW50RXhlY3V0aW9uQ29udGV4dDsgby5kZWJ1ZyhcImV4cDogZmlyZSBldmVudCBcIiwgbCwgXCIgd2l0aCBldmVudFBhcmFtczpcIiwgdCwgXCIsIG1vZHVsZVBhcmFtczpcIiwgciwgXCIsIGNvbnRleHQ6XCIsIGkpLCBCLmZpcmUoXCJleHBlcmllbmNlXCIsIGwsICEwLCB0LCByLCBpKSwgbiAmJiBsICE9PSBuICYmIChvLmRlYnVnKFwiZXhwOiBleGVjdXRlIGV2ZW50IFwiLCBsLCBcIiB3aXRoIGNhbGxiYWNrOiBcIiwgbiksIGZlKG4pKTsgfSkodCk7IH07IH0obltlXSwgZSk7IH0pKSwgdCksIFAgPSB7IHNob3dPZmZlcjogZnVuY3Rpb24gKGUpIHsgcmV0dXJuIHZlKGUsIChmdW5jdGlvbiAoZSkgeyByZXR1cm4gcG4ub2ZmZXIuZGVmZXJyZWRTaG93KGUpOyB9KSk7IH0sIHNob3dUZW1wbGF0ZTogaGUsIHNob3dadW9yYU9mZmVyOiBoZSwgc2hvd05ld3NjeWNsZU9mZmVyOiBoZSB9LCBFID0gby5wcm9maWxlKChmdW5jdGlvbiAoZSkgeyBRKFwibWFudWFsXCIsIGUsICExKTsgfSkpLCBUID0gZnVuY3Rpb24gKGUsIG4pIHsgQi5hZGRFdmVudChlKSwgQi5yZWdpc3RlckNhbGxiYWNrKGUsIG4pOyB9LCBBID0gXCJ4YmNcIiwgTSA9IHt9LCBPID0gXCJcIiwgUiA9IFwiXCIsIEwgPSBcIlwiLCBOID0gW10sIFUgPSBcImhhbmRsZXJcIiwgaiA9IFwiZXZlbnRDb25kaXRpb25cIiwgRCA9IFwiaW5uZXJFdmVudENvbmRpdGlvblwiLCBGID0gXCJwcmVsb2FkXCIsIEIgPSBhLmNyZWF0ZUV2ZW50TWFuYWdlcihbXSksIFYgPSBbXCJzaG93T2ZmZXJcIiwgXCJzaG93WnVvcmFPZmZlclwiLCBcInNob3dOZXdzY3ljbGVPZmZlclwiLCBcInNob3dUZW1wbGF0ZVwiXTsgdmFyIHEsIHogPSBmdW5jdGlvbiAoKSB7IHJldHVybiB5OyB9LCBIID0gZnVuY3Rpb24gKCkgeyB5ID0gW107IH0sIFcgPSBmdW5jdGlvbiAoKSB7IHJldHVybiBwbi5nZXRUcmFja2luZ0VuZHBvaW50KHBuLmNvbXBvc2VySG9zdCkgKyBcIi9hcGkvdjNcIjsgfSwgSiA9IGZ1bmN0aW9uICgpIHsgZy5fX3Byb3RlY3RlZF9fLmluaXQoKTsgfSwgRyA9IGZ1bmN0aW9uIChlKSB7IHZhciBuID0geigpOyBuLmxlbmd0aCAmJiAoYy5sb2dCZWFjb25SZXF1ZXN0KFcoKSArIFwiL2NvbXBvc2VyL2xvZ0V4ZWN1dGlvblN0YXRzXCIsIHsgYWlkOiBwbi5haWQsIGl0ZW1zOiBKU09OLnN0cmluZ2lmeShuKSwgZXhlY3V0aW9uX3N0YXRzX2NvbnRleHQ6IGssIHRzOiAobmV3IERhdGUpLmdldFRpbWUoKSwgc291cmNlOiBlIH0pLCBIKCkpLCB3aW5kb3cuY2xlYXJUaW1lb3V0KHEpLCBxID0gd2luZG93LnNldFRpbWVvdXQoKGZ1bmN0aW9uICgpIHsgRyhcInRpbWVyXCIgKyBxKTsgfSksIDJlMyk7IH0sIFEgPSBmdW5jdGlvbiAoZSwgbiwgdCkgeyB2b2lkIDAgPT09IHBuLm1haW4uYXBwSGFzQXBwbGVQYXkoKSAmJiBCLmZpcmVDYWxsYmFja3MoXCJleHBlcmllbmNlRmxvd1wiLCBudWxsLCBcImV4cGVyaWVuY2VcIiwgITApOyB2YXIgaSA9IG5ldyBQcm9taXNlKChmdW5jdGlvbiAoZSkgeyBzZXRUaW1lb3V0KChmdW5jdGlvbiAoKSB7IGUoe30pOyB9KSwgM2U0KTsgfSkpOyByZXR1cm4gUHJvbWlzZS5yYWNlKFtwbi5tYWluLmV4dGVybmFsUmVzb3VyY2VzRGVsYXkoKSwgaV0pLnRoZW4oKGZ1bmN0aW9uIChpKSB7IGlmIChyLmlzUGxhaW5PYmplY3QoaSkgfHwgKG8uZXJyb3IoXCJleHA6IGVycm9yIGdldCBleHRlcm5hbCByZXNvdXJjZXMgXCIsIGkpLCBpID0ge30pLCBoLl9fcHJvdGVjdGVkX18uaXNBY3RpdmF0ZWQoKSkge1xuICAgICAgICBvLmRlYnVnKFwiYzF4OiBpbnRlZ3JhdGlvbiBpcyBhY3RpdmF0ZWRcIiksIGguX19wcm90ZWN0ZWRfXy5sb2FkQ3hMaWJJZk5lZWRlZCgpO1xuICAgICAgICB2YXIgYSA9IHIuZGVlcEV4dGVuZCh7fSwgbiwgaSwgeyBjMXhfaW50ZWdyYXRpb25fdmVyc2lvbjogXCJ2MlwiLCBuZXdfYmlkOiBwbi5tYWluLmZldGNoQ3hCcm93c2VySWQoKSB9KTtcbiAgICAgICAgWChlLCBhLCB0KTtcbiAgICB9XG4gICAgZWxzZVxuICAgICAgICBYKGUsIHIuZGVlcEV4dGVuZCh7fSwgbiwgaSksIHQpOyB9KSkuY2F0Y2goKGZ1bmN0aW9uIChlKSB7IH0pKTsgfSwgWCA9IGZ1bmN0aW9uIChlLCBuLCB0KSB7IG4gPSBuIHx8IHt9OyB2YXIgYSA9IHIuZGVlcEV4dGVuZCh7fSwgeyBwcm90b2NvbF92ZXJzaW9uOiAxIH0sIG4pOyAkKGEpLCBZKGEpLCBvLmhhc1F1ZXJ5UGFyYW1CeU5hbWUoQykgJiYgKGEucmVhZGVyX2lkID0gby5nZXRRdWVyeVBhcmFtQnlOYW1lKEMpKSwgby53YWl0Q2FsbChcInJlZnJlc2hVc2VyVG9rZW5cIiwgKGZ1bmN0aW9uICgpIHsgaWYgKHQpXG4gICAgICAgIGEuZXhlY3V0ZWRfbm9kZXMgPSBKU09OLnN0cmluZ2lmeShTKTtcbiAgICBlbHNlIHtcbiAgICAgICAgcG4ubWFpbi50cmFja1BhZ2VVbmxvYWRJZk5lY2Vzc2FyeSgpLCBLKGEpLCBpLmdldENhbGxQYXJhbXMoYSwgdi5nZXRQcm92aWRlcigpKSwgby5yZW1vdmVBZmZpbGlhdGVUb2tlbigpO1xuICAgICAgICB2YXIgbiA9IHsgdXJsOiB3aW5kb3cubG9jYXRpb24uaHJlZiwgdGFnczogcG4udGFncywgc3VibWl0VHlwZTogZSB9O1xuICAgICAgICBwbi5tYWluLmJ1aWxkUGFnZVRyYWNrUGFyYW1zKGEsIG4pO1xuICAgIH0gby5kZWJ1ZyhcImV4cDogRXhwZXJpZW5jZSBpbml0aWFsaXplZCB3aXRoIHBhcmFtczpcIiwgYSksIG8ud2FpdENhbGwoXCJyZWZyZXNoQWNjZXNzVG9rZW5MaXN0XCIsIChmdW5jdGlvbiAoKSB7IG8uc3RhcnRDYWxsKFwiZXhwZXJpZW5jZUV4ZWN1dGVcIik7IHZhciBlLCBuLCBpID0gKG8uX19wcm90ZWN0ZWRfXy5jYW1lRnJvbUZiU3Vic2NyaXB0aW9ucygpID8gKGUgPSBcIi94YnVpbGRlci9leHBlcmllbmNlL2V4ZWN1dGVGYmlhXCIsIEooKSkgOiBlID0gXCIveGJ1aWxkZXIvZXhwZXJpZW5jZS9leGVjdXRlXCIsIHBuLmdldEV4cGVyaWVuY2VFbmRwb2ludCghMSkgKyBlKTsgaWYgKC0xICE9PSBuYXZpZ2F0b3IuYXBwVmVyc2lvbi5pbmRleE9mKFwiTVNJRSA5XCIpKVxuICAgICAgICBuID0geyBkYXRhVHlwZTogXCJqc29ucFwiLCB1cmw6IGkgKyBcIj9cIiArIHIucGFyYW0oYSkgfTtcbiAgICBlbHNlIHtcbiAgICAgICAgdmFyIHMgPSBcIj9cIiArIHIucGFyYW0oeyBhaWQ6IGEuYWlkIH0pO1xuICAgICAgICBuID0geyB0eXBlOiBcInBvc3RcIiwgdXJsOiBpICsgcywgZGF0YTogYSwgeGhyRmllbGRzOiB7IHdpdGhDcmVkZW50aWFsczogITAgfSB9O1xuICAgIH0gbi5zdWNjZXNzID0gZnVuY3Rpb24gKGUpIHsgby5kb25lQ2FsbChcImV4cGVyaWVuY2VFeGVjdXRlXCIpOyB2YXIgbiA9IHIuZGVlcEV4dGVuZCh7fSwgYSk7IHQgfHwgKHdlKCksIHBuLm1haW4ucmVnaXN0ZXJUcmFja1VubG9hZCgpKSwgWihlLmVycm9ycyksIGRlKGUubW9kZWxzLCBuKTsgfSwgbi5lcnJvciA9IGZ1bmN0aW9uICgpIHsgby5kb25lQ2FsbChcImV4cGVyaWVuY2VFeGVjdXRlXCIpLCB0IHx8IHdlKCk7IHZhciBlID0geyBjb2RlOiA1MDMsIG1lc3NhZ2U6IFwiRXJyb3I6IFJlY2VpdmVkIGVycm9yIHdoZW4gcmVxdWVzdGluZyBBUEkgcmVzcG9uc2UgZnJvbSBVUkw6IFwiICsgaSB9OyBvLmRlYnVnKGUubWVzc2FnZSk7IH0sIGwucmVxdWVzdChuKTsgfSkpOyB9KSk7IH0sICQgPSBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IG8uX19wcm90ZWN0ZWRfXy5nZXRDb29raWUoQSk7IG4gJiYgKGUueGJjID0gbik7IHZhciB0ID0gby5nZXRUYmNDb29raWUoKTsgdCAmJiB0Lmxlbmd0aCA+IDAgJiYgKGUudGJjID0gdCksIG8uZ2V0Q2FtcGFpZ25zKGUpLCBlLmN1c3RvbV9jb29raWVzID0gSlNPTi5zdHJpbmdpZnkoby5nZXRDdXN0b21Db29raWVzKCkpOyB9LCBZID0gZnVuY3Rpb24gKGUpIHsgdmFyIG4gPSBvLmdldFB1c2hMaXN0c0Nvb2tpZSgpLCB0ID0gZi5fX3Byb3RlY3RlZF9fLmdldE5vdGlmaWNhdGlvblN0YXR1cygpOyBuICYmIG4ubGVuZ3RoID4gMCAmJiAoZS5wdXNoX2xpc3Rfc3Vic2NyaXB0aW9ucyA9IEpTT04uc3RyaW5naWZ5KG4pKSwgdCAmJiAoZS5wdXNoX25vdGlmaWNhdGlvbl9zZXR0aW5ncyA9IHQpOyB9LCBLID0gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIFt7IHByb3BlcnR5OiBcImRlYnVnXCIsIHBhcmFtZXRlcjogXCJkZWJ1Z1wiIH0sIHsgcHJvcGVydHk6IFwidHJhY2tQYWdlVmlld1wiLCBwYXJhbWV0ZXI6IFwiaW5jcmVtZW50X3BhZ2V2aWV3X21ldGVyXCIgfV0uZm9yRWFjaCgoZnVuY3Rpb24gKG4pIHsgdm9pZCAwICE9PSBwbltuLnByb3BlcnR5XSAmJiAoZVtuLnBhcmFtZXRlcl0gPSBwbltuLnByb3BlcnR5XSk7IH0pKSwgZTsgfSwgWiA9IGZ1bmN0aW9uIChlKSB7IEFycmF5LmlzQXJyYXkoZSkgJiYgKGUubGVuZ3RoICYmIG8uZGVidWcoXCJleHA6IGNvbXBvc2VyIGV4ZWN1dGlvbiBoYXMgYmVlbiBmYWlsZWQgd2l0aCBlcnJvcnNcIiksIGUuZm9yRWFjaCgoZnVuY3Rpb24gKGUpIHsgby5kZWJ1ZyhcImV4cDogXCIgKyBlLm1zZyk7IH0pKSk7IH0sIGVlID0gZnVuY3Rpb24gKGUsIG4pIHsgdmFyIHQ7IHQgPSB7IG1JZDogZSwgZUlkOiBuLmV2ZW50RXhlY3V0aW9uQ29udGV4dC5leHBlcmllbmNlSWQsIGVWOiBuLmV2ZW50RXhlY3V0aW9uQ29udGV4dC5leHBlcmllbmNlVmVyc2lvbiwgZWVJZDogbi5ldmVudEV4ZWN1dGlvbkNvbnRleHQuZXhlY3V0aW9uSWQgfSwgeS5wdXNoKHQpOyB9OyBmdW5jdGlvbiBuZShlLCBuLCB0LCByKSB7IHJldHVybiB7IHR5cGU6IFUsIGV2ZW50VHlwZTogbi5ldmVudFR5cGUsIGNoaWxkcmVuOiBbXSwgcnVuOiBmdW5jdGlvbiAoKSB7IGUuYmluZCh0aGlzLCBuLCB0LCByKSgpOyB9IH07IH0gdmFyIHRlID0gZnVuY3Rpb24gKGUpIHsgdmFyIG4sIHQgPSBlLmV2ZW50UGFyYW1zLmRlbGF5QnkgfHwge307IHJldHVybiB0LnZhbHVlICYmIChcInRpbWVcIiA9PT0gdC50eXBlID8gbiA9IHsgdHlwZTogXCJ0aW1lclwiLCB0aW1lcjogdC52YWx1ZSB9IDogXCJzY3JvbGxcIiA9PT0gdC50eXBlICYmIChuID0geyB0eXBlOiBcInNjcm9sbERlcHRoXCIsIHNjcm9sbERlcHRoOiB0LnZhbHVlLCBtZWFzdXJlVHlwZTogXCJwaXhlbHNcIiB9KSksIG47IH0sIHJlID0gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGUuZXZlbnRDb25kaXRpb25zICYmIEFycmF5LmlzQXJyYXkoZS5ldmVudENvbmRpdGlvbnMpID8gZS5ldmVudENvbmRpdGlvbnMubGVuZ3RoIDogMDsgfSwgb2UgPSBmdW5jdGlvbiAoZSwgbikgeyByZXR1cm4gciA9ICExLCB7IHR5cGU6IEYsIGV2ZW50VHlwZTogbi5ldmVudFR5cGUsIGNoaWxkcmVuOiBbXSwgcnVuOiBmdW5jdGlvbiAoKSB7ICExID09PSByICYmICh0ID0gZShuKSwgciA9ICEwKTsgfSwgZ2V0UHJlbG9hZFJlc3VsdDogZnVuY3Rpb24gKCkgeyByZXR1cm4gdDsgfSB9OyB2YXIgdCwgcjsgfTsgZnVuY3Rpb24gaWUoZSwgbikgeyB2YXIgdCA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIEIuZmlyZUNhbGxiYWNrc0FuZFN0b3BPbkZpcnN0RmFsc2UoXCJiZWZvcmVCcm93c2VyRXZlbnRcIiwgZSk7IH07IHN3aXRjaCAoZS50eXBlKSB7XG4gICAgICAgIGNhc2UgXCJ2aWV3cG9ydEV4aXRcIjpcbiAgICAgICAgICAgIHUuYWRkTGlzdGVuZXIobiwgeyBkZXRlY3RFeGl0TW9kZTogZS5kZXRlY3RFeGl0TW9kZSwgZGV0ZWN0QmFja0J1dHRvbkZvck1vYmlsZTogZS5kZXRlY3RCYWNrQnV0dG9uRm9yTW9iaWxlLCBjbGllbnREZXZpY2U6IGUuY2xpZW50RGV2aWNlIH0sIHQpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJzY3JvbGxEZXB0aFwiOlxuICAgICAgICAgICAgcy5hZGRMaXN0ZW5lcihuLCB7IHNjcm9sbERlcHRoOiBlLnNjcm9sbERlcHRoLCBtZWFzdXJlVHlwZTogZS5tZWFzdXJlVHlwZSB9LCB0KTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwidGltZXJcIjpcbiAgICAgICAgICAgIHZhciByID0gc2V0VGltZW91dCgoZnVuY3Rpb24gKCkgeyB0KCkgJiYgbigpOyB9KSwgMWUzICogZS50aW1lcik7XG4gICAgICAgICAgICBOLnB1c2gocik7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImludGVyYWN0aW9uXCI6XG4gICAgICAgICAgICBwLmJpbmQobiwgZS5pbnRlcmFjdGlvbnMsIHQpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJpZGxlXCI6IGQuYWRkTGlzdGVuZXIobiwgZS5pZGxlVGltZSwgdCk7XG4gICAgfSB9IHZhciBhZSA9IGZ1bmN0aW9uIChlKSB7IHJldHVybiBlLnR5cGUgPT09IFUgJiYgLTEgPT09IFtcImNvbnRpbnVlRXhlY3V0aW9uXCIsIFwibWV0ZXJBY3RpdmVcIiwgXCJtZXRlckV4cGlyZWRcIl0uaW5kZXhPZihlLmV2ZW50VHlwZSk7IH07IGZ1bmN0aW9uIHNlKGUsIG4pIHsgcmV0dXJuIHQgPSAhMSwgciA9IGZ1bmN0aW9uICgpIHsgZWUoZS5tb2R1bGVJZCwgbik7IGZvciAodmFyIHIgPSBiW2UubW9kdWxlSWRdLmNoaWxkcmVuLCBpID0gMDsgaSA8IHIubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdmFyIGEgPSByW2ldLCBzID0gYlthXTtcbiAgICAgICAgaWYgKCExID09PSB0IHx8IGFlKHMpKVxuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBzLnJ1bigpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICBvLmVycm9yKFwiZXhwOiBlcnJvciBleGVjdXRlIGNoYWluIGV2ZW50XCIsIHMsIGUpO1xuICAgICAgICAgICAgfVxuICAgIH0gdCA9ICEwLCBfICYmIEcoXCJjaGFpblwiKTsgfSwgeyB0eXBlOiBqLCBjaGlsZHJlbjogW10sIHJ1bjogZnVuY3Rpb24gKCkgeyBpZShlLCByKTsgfSB9OyB2YXIgdCwgcjsgfSBmdW5jdGlvbiBjZShlLCBuKSB7IHJldHVybiB0ID0gITEsIHIgPSBmdW5jdGlvbiAoKSB7IGZvciAodmFyIGUgPSBiW24gKyBEXS5jaGlsZHJlbiwgciA9IDA7IHIgPCBlLmxlbmd0aDsgcisrKSB7XG4gICAgICAgIHZhciBpID0gZVtyXSwgYSA9IGJbaV07XG4gICAgICAgIGlmICghMSA9PT0gdCB8fCBhZShhKSlcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgYS5ydW4oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgby5lcnJvcihcImV4cDogZXJyb3IgZXhlY3V0ZSBjaGFpbiBldmVudFwiLCBhLCBlKTtcbiAgICAgICAgICAgIH1cbiAgICB9IHQgPSAhMDsgfSwgeyB0eXBlOiBELCBjaGlsZHJlbjogW25dLCBydW46IGZ1bmN0aW9uICgpIHsgaWUoZSwgcik7IH0gfTsgdmFyIHQsIHI7IH0gdmFyIGxlID0gZnVuY3Rpb24gKGUpIHsgdmFyIG47IGUuc3dnTWFya3VwRGF0YSAmJiAoby5kZWJ1ZyhcImV4cDogc3dnIG1hcmt1cCBkYXRhIDpcIiwgZS5zd2dNYXJrdXBEYXRhKSwgbiA9IGUuc3dnTWFya3VwRGF0YSwgbS5fX3Byb3RlY3RlZF9fLmluamVjdE1hcmt1cChuKSwgZS5zd2dNYXJrdXBEYXRhLmlzQWNjZXNzaWJsZUZvckZyZWUgfHwgbS5fX3Byb3RlY3RlZF9fLmFkZExpYnJhcnkoKSksIGUuc3dnRW5hYmxlZCAmJiBtLl9fcHJvdGVjdGVkX18uaW5pdFN3Z0Zsb3coKTsgfSwgdWUgPSBmdW5jdGlvbiAoZSkgeyBpZiAoZSkge1xuICAgICAgICBmb3IgKHZhciBuID0ge30sIHQgPSAwOyB0IDwgZS5ldmVudHMubGVuZ3RoOyB0KyspIHtcbiAgICAgICAgICAgIHZhciBpID0gZS5ldmVudHNbdF07XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIFwiZXhwZXJpZW5jZUV4ZWN1dGVcIiA9PT0gaS5ldmVudFR5cGUgJiYgKChuID0gci5kZWVwRXh0ZW5kKHt9LCBpLmV2ZW50RXhlY3V0aW9uQ29udGV4dCkpLnJlc3VsdCA9IHIuZGVlcEV4dGVuZCh7fSwgZSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICBvLmVycm9yKFwiZXhwOiBlcnJvciBvbiBleGVjdXRlIGV2ZW50OiBcIiwgaSwgZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG47XG4gICAgfSBvLmRlYnVnKFwiZXhwOiBubyBjb21wb3NlciBleGVjdXRpb24gcmVzdWx0XCIpOyB9LCBkZSA9IGZ1bmN0aW9uIChlLCBuKSB7IGlmIChlKSB7XG4gICAgICAgIHZhciB0LCBpO1xuICAgICAgICBpZiAoby5zZXRUYmNDb29raWVGcm9tUmVzcG9uc2UoZSksIG8uc2V0VGFjQ29va2llRnJvbVJlc3BvbnNlKGUpLCB0ID0gZSwgaC5fX3Byb3RlY3RlZF9fLmlzQWN0aXZhdGVkKCkgJiYgaC5fX3Byb3RlY3RlZF9fLmlzQ3VzdG9tZXJQcmVmaXhDb25maWd1cmVkKHQpICYmIHQgJiYgdC5iaWQgJiYgaC5fX3Byb3RlY3RlZF9fLnNldEN4QmlkQ29va2llKHQuYmlkLCBudWxsID09PSAoaSA9IHQudGJjKSB8fCB2b2lkIDAgPT09IGkgPyB2b2lkIDAgOiBpLmNvb2tpZV9kb21haW4pLCBvLnNldEFwcFRpbWV6b25lT2Zmc2V0RnJvbVJlc3BvbnNlKGUpLCBvLnNldEN1cnJlbnREb21haW5Gcm9tUmVzcG9uc2UoZSksIGZ1bmN0aW9uIChlKSB7IGYuX19wcm90ZWN0ZWRfXy5zZXRWaXNpdG9ySWQoZS5iaWQpOyB9KGUpLCBmdW5jdGlvbiAoZSkgeyBoLl9fcHJvdGVjdGVkX18uc2VuZFBhZ2VWaWV3RXZlbnQoeyBicm93c2VySWQ6IGUuYmlkLCB1aWQ6IGUudWlkLCBjeGVuc2VDdXN0b21lclByZWZpeDogZS5jeGVuc2VDdXN0b21lclByZWZpeCwgcGFnZVZpZXdJZDogcG4ubWFpbi5mZXRjaFBhZ2VWaWV3SWQoKSwgZXZlbnRFeGVjdXRpb25Db250ZXh0OiB1ZShlLnJlc3VsdCkgfSk7IH0oZSksIGZ1bmN0aW9uIChlKSB7IE8gPSBlLmJpZDsgfShlKSwgZnVuY3Rpb24gKGUpIHsgZS5pc3MgJiYgKFIgPSBlLmlzcyk7IH0oZSksIGZ1bmN0aW9uIChlKSB7IEwgPSBlLml0ZW1JZDsgfShlKSwgZS54YmMgJiYgZS54YmMuY29va2llX3ZhbHVlKSB7XG4gICAgICAgICAgICB2YXIgYSA9IHsgcGF0aDogXCIvXCIsIGV4cGlyZXM6IDczMCB9O1xuICAgICAgICAgICAgaWYgKGUueGJjLmNvb2tpZV9kb21haW4gJiYgXCJsb2NhbGhvc3RcIiAhPT0gZS54YmMuY29va2llX2RvbWFpbiAmJiAoYS5kb21haW4gPSBlLnhiYy5jb29raWVfZG9tYWluLCBvLl9fcHJvdGVjdGVkX18uZGVsZXRlVExEQ29va2llRm9yU3BlY2lmaWNEb21haW5zKEEsIGUueGJjLmNvb2tpZV9kb21haW4pKSwgcG4uY29va2llRG9tYWluIHx8IHBuLmNvb2tpZVBhdGgpIHtcbiAgICAgICAgICAgICAgICB2YXIgcyA9IG8uZ2V0UG9zc2libGVDb29raWVEb21haW5zKCk7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgYyBpbiBzKVxuICAgICAgICAgICAgICAgICAgICBvLmRlbGV0ZUNvb2tpZShBLCBzW2NdKTtcbiAgICAgICAgICAgICAgICBhLmRvbWFpbiA9IHBuLmNvb2tpZURvbWFpbiA/IHBuLmNvb2tpZURvbWFpbiA6IGEuZG9tYWluLCBvLl9fcHJvdGVjdGVkX18uZGVsZXRlVExEQ29va2llRm9yU3BlY2lmaWNEb21haW5zKEEsIGEuZG9tYWluLCBhLnBhdGgpLCBhLnBhdGggPSBwbi5jb29raWVQYXRoID8gcG4uY29va2llUGF0aCA6IGEucGF0aCwgby5fX3Byb3RlY3RlZF9fLmRlbGV0ZVRMRENvb2tpZUZvclNwZWNpZmljRG9tYWlucyhBLCBhLmRvbWFpbiwgYS5wYXRoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG8uZGVsZXRlQ29va2llKEEpLCBvLl9fcHJvdGVjdGVkX18uc2V0Q29va2llKEEsIGUueGJjLmNvb2tpZV92YWx1ZSwgYSk7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGwgPSBlLnJlc3VsdCwgdSA9IHt9O1xuICAgICAgICBpZiAobCkge1xuICAgICAgICAgICAgbGUobCksIG8uZGVidWcoXCJleHA6IHByb2Nlc3NlZCBleHBlcmllbmNlcyA6XCIsIGwuZXhwZXJpZW5jZXMpLCBrID0gZS5leGVjdXRpb25TdGF0c0NvbnRleHQsIGwuZGVidWdNZXNzYWdlcy5mb3JFYWNoKChmdW5jdGlvbiAoZSkgeyBvLmRlYnVnKFwiZXhwOiBleGVjdXRlIDpcIiwgZSk7IH0pKTtcbiAgICAgICAgICAgIGZvciAodmFyIGQsIHAgPSBmdW5jdGlvbiAoZSwgbiwgdCkgeyBmb3IgKHZhciByID0gZS5ldmVudENvbmRpdGlvbnMsIGkgPSAwOyBpIDwgci5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHZhciBhID0gcltpXSwgcyA9IGEubW9kdWxlSWQsIGMgPSByW2kgLSAxXSwgbCA9ICFyW2kgKyAxXTtcbiAgICAgICAgICAgICAgICBpZiAoYltzXSB8fCAoYltzXSA9IHNlKGEsIGUpKSwgbClcbiAgICAgICAgICAgICAgICAgICAgaWYgKGJbc10uY2hpbGRyZW4ucHVzaChuKSwgLTEgIT09IFYuaW5kZXhPZihlLmV2ZW50VHlwZSkgJiYgXCJ2aWV3cG9ydEV4aXRcIiA9PT0gYS50eXBlICYmICF0ZShlKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHUgPSBQW2UuZXZlbnRUeXBlXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG8uZXJyb3IoXCJleHA6IG5vdCBmb3VuZCBwcmVsb2FkIGhhbmRsZXIgZm9yIGV2ZW50OiBcIiwgZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IG4gKyBGO1xuICAgICAgICAgICAgICAgICAgICAgICAgYltkXSA9IG9lKHUsIGUpLCBjID8gYltjLm1vZHVsZUlkXS5jaGlsZHJlbi5wdXNoKGQpIDogdC5wdXNoKGQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYyAmJiAtMSA9PT0gYltjLm1vZHVsZUlkXS5jaGlsZHJlbi5pbmRleE9mKHMpICYmIGJbYy5tb2R1bGVJZF0uY2hpbGRyZW4ucHVzaChzKTtcbiAgICAgICAgICAgIH0gfSwgbSA9IFtdLCBnID0gMCwgdiA9IDA7IHYgPCBsLmV2ZW50cy5sZW5ndGg7IHYrKykge1xuICAgICAgICAgICAgICAgIHZhciB3ID0gbC5ldmVudHNbdl07XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHkgPSB3LmV2ZW50VHlwZSwgQyA9IHcuZXZlbnRNb2R1bGVQYXJhbXMgfHwge307XG4gICAgICAgICAgICAgICAgICAgIGlmIChvLmRlYnVnKFwiZXhwOiBwcm9jZXNzIGV2ZW50ICdcIiArIHkgKyBcIicgKFwiICsgQy5tb2R1bGVJZCArIFwiKVwiKSwgXCJleHBlcmllbmNlRXhlY3V0ZVwiID09PSB5ICYmICgodSA9IHIuZGVlcEV4dGVuZCh7fSwgdy5ldmVudEV4ZWN1dGlvbkNvbnRleHQpKS5yZXN1bHQgPSByLmRlZXBFeHRlbmQoe30sIGwpKSwgIShkID0gQy5tb2R1bGVJZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG8uZXJyb3IoXCJleHA6IG5vdCBmb3VuZCBtb2R1bGVJZCBmb3IgbGlua2VkIG5vZGUgZXZlbnQ6IFwiLCB3KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHZhciBJID0geFt5XTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFJKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvLmVycm9yKFwiZXhwOiBub3QgZm91bmQgaGFuZGxlciBmb3IgZXZlbnQ6IFwiLCB3KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJbZF0gPSBuZShJLCB3LCBuLCBsKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIFMgPSByZSh3KSwgRSA9IHRlKHcpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoUyB8fCBFKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgVCA9IGQ7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoRSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBOID0gY2UoRSwgZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYltUID0gZCArIERdID0gTjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIFMgPyAtMSA9PT0gbS5pbmRleE9mKHcuZXZlbnRDb25kaXRpb25zWzBdLm1vZHVsZUlkKSAmJiBtLnB1c2gody5ldmVudENvbmRpdGlvbnNbMF0ubW9kdWxlSWQpIDogRSAmJiBtLnB1c2goVCksIHAodywgVCwgbSksIGcrKztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICBtLnB1c2goZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIG8uZXJyb3IoXCJleHA6IGVycm9yIG9uIGV4ZWN1dGUgZXZlbnQ6IFwiLCB3LCBlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBnIDw9IDMgJiYgKF8gPSAhMCk7XG4gICAgICAgICAgICBmb3IgKHZhciBVID0gMDsgVSA8IG0ubGVuZ3RoOyBVKyspXG4gICAgICAgICAgICAgICAgZCA9IG1bVV0sIGJbZF0gJiYgYltkXS5ydW4oKTtcbiAgICAgICAgICAgIHdpbmRvdy5jbGVhclRpbWVvdXQocSksIHEgPSB3aW5kb3cuc2V0VGltZW91dCgoZnVuY3Rpb24gKCkgeyBHKFwicm9vdFRpbWVyXCIgKyBxKTsgfSksIDJlMyksIE0gPSB1O1xuICAgICAgICB9XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIG8uZGVidWcoXCJleHA6IG5vIGNvbXBvc2VyIGV4ZWN1dGlvbiByZXN1bHRcIik7XG4gICAgfSB9OyBmdW5jdGlvbiBwZShlKSB7IHJlKGUpICYmIGVlKGUuZXZlbnRNb2R1bGVQYXJhbXMubW9kdWxlSWQsIGUpOyB9IGZ1bmN0aW9uIGZlKGUpIHsgdHJ5IHtcbiAgICAgICAgZXZhbC5jYWxsKHdpbmRvdywgXCIoZnVuY3Rpb24gKCkge1wiICsgZSArIFwiXFxufSkoKTtcIik7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIG8ubG9nKFwiRXJyb3Igb2NjdXJyZWQgaW4gUnVuSlNcXG5cIiwgZSk7XG4gICAgfSB9IGZ1bmN0aW9uIG1lKGUsIG4pIHsgdmFyIHQgPSBiW2UuZXZlbnRNb2R1bGVQYXJhbXMubW9kdWxlSWQgKyBGXTsgcmV0dXJuIHQgJiYgdC5nZXRQcmVsb2FkUmVzdWx0ID8gdC5nZXRQcmVsb2FkUmVzdWx0KCkuc2hvdygpIDogeWUoZSwgbik7IH0gZnVuY3Rpb24gZ2UoZSkgeyByZXR1cm4gbWUoZSwgKGZ1bmN0aW9uIChlKSB7IHJldHVybiBwbi50ZW1wbGF0ZS5zaG93KGUpOyB9KSk7IH0gZnVuY3Rpb24gdmUoZSwgbikgeyByZXR1cm4gby5kZWJ1ZyhcImV4cDogcnVuIHByZWxvYWRpbmcgZm9yOlwiLCBlKSwgeWUoZSwgKGZ1bmN0aW9uIChlKSB7IHJldHVybiBuKGUpOyB9KSk7IH0gZnVuY3Rpb24gaGUoZSkgeyByZXR1cm4gdmUoZSwgKGZ1bmN0aW9uIChlKSB7IHJldHVybiBwbi50ZW1wbGF0ZS5kZWZlcnJlZFNob3coZSk7IH0pKTsgfSBmdW5jdGlvbiB3ZSgpIHsgRyhcInJlc2V0XCIpLCBOLmZvckVhY2goKGZ1bmN0aW9uIChlLCBuKSB7IGNsZWFyVGltZW91dChuKTsgfSkpLCBOID0gW10sIHUucmVtb3ZlTGlzdGVuZXJzKCksIGQucmVtb3ZlTGlzdGVuZXJzKCksIHMucmVtb3ZlTGlzdGVuZXJzKCksIHAudW5iaW5kQWxsKCksIGIgPSB7fSwgUyA9IHt9OyB9IGZ1bmN0aW9uIHllKGUsIG4pIHsgdmFyIHQgPSByLmRlZXBFeHRlbmQoe30sIGUuZXZlbnRQYXJhbXMpLCBpID0gZS5ldmVudEV4ZWN1dGlvbkNvbnRleHQuc3BsaXRUZXN0cywgYSA9IGUuZXZlbnRFeGVjdXRpb25Db250ZXh0LmFjdGl2ZU1ldGVycywgcyA9IGUuZXZlbnRQYXJhbXMuZm9ybU5hbWVCeVRlcm1JZCwgYyA9IGUuZXZlbnRQYXJhbXMuaGlkZUNvbXBsZXRlZEZpZWxkcywgbCA9IGZ1bmN0aW9uIChlKSB7IHZhciBuOyBpZiAoIVIpXG4gICAgICAgIHJldHVybiBudWxsOyB2YXIgdCA9IGUgfHwge307IHJldHVybiB7IGlzc3VlcklkOiBSLCBwcmVtaXVtOiB0LnVzZXIgJiYgdC51c2VyLnByZW1pdW0gfHwgbnVsbCwgcmVkZW1wdGlvbkNhbmRpZGF0ZUl0ZW1JZDogTCB8fCBudWxsLCBjcmVkaXRTdGF0ZXM6IHQuY3JlZGl0U3RhdGVzIHx8IG51bGwsIHVzZXJJZDogKG51bGwgPT09IChuID0gdC51c2VyKSB8fCB2b2lkIDAgPT09IG4gPyB2b2lkIDAgOiBuLnVpZCkgfHwgbnVsbCwgdGFyZ2V0R3JvdXBzOiB7IGwxOiBcInRhcmdldFwiLCBsMjogbnVsbCB9IH07IH0oZS5ldmVudEV4ZWN1dGlvbkNvbnRleHQpOyBpZiAodC50cmFja2luZ0lkID0gZS5ldmVudEV4ZWN1dGlvbkNvbnRleHQudHJhY2tpbmdJZCwgdC5leHBlcmllbmNlSWQgPSBlLmV2ZW50RXhlY3V0aW9uQ29udGV4dC5leHBlcmllbmNlSWQsIHQuZXhwZXJpZW5jZUV4ZWN1dGlvbklkID0gZS5ldmVudEV4ZWN1dGlvbkNvbnRleHQuZXhlY3V0aW9uSWQsIHQuZXhwZXJpZW5jZUFjdGlvbklkID0gZS5ldmVudE1vZHVsZVBhcmFtcy5tb2R1bGVJZCwgdC5leHBlcmllbmNlQ29uZGl0aW9ucyA9IGUuZXZlbnRDb25kaXRpb25zLCB0LmJyb3dzZXJJZCA9IE8sIHQub25TdGFydENyZWRpdFJlZGVtcHRpb24gPSBmdW5jdGlvbiAobikgeyB2YXIgdCA9IHIuZGVlcEV4dGVuZCh7fSwgbiksIG8gPSBcImh0dHBzOi8vd3d3LnBpYW5vLmlvXCIgPT09IFIsIGkgPSBlLmV2ZW50RXhlY3V0aW9uQ29udGV4dC51c2VyICYmIFwiYW5vblwiICE9PSBlLmV2ZW50RXhlY3V0aW9uQ29udGV4dC51aWQ7IHJldHVybiB0LnRyYWNraW5nSWQgPSBlLmV2ZW50RXhlY3V0aW9uQ29udGV4dC50cmFja2luZ0lkIHx8IHZvaWQgMCwgbyAmJiBpICYmICh0LnVpZCA9IGUuZXZlbnRFeGVjdXRpb25Db250ZXh0LnVzZXIudWlkIHx8IHZvaWQgMCksIHBuLmNyZWRpdC5yZWRlZW0odCk7IH0sIGkgJiYgaS5sZW5ndGggPiAwKSB7XG4gICAgICAgIHZhciB1ID0gaS5tYXAoKGZ1bmN0aW9uIChlKSB7IHJldHVybiBlLnZhcmlhbnRJZDsgfSkpO1xuICAgICAgICB0LnNwbGl0VGVzdElkcyA9IEpTT04uc3RyaW5naWZ5KHUpO1xuICAgIH0gaWYgKHQuYWRkaXRpb25hbFBhcmFtTmFtZXMgPSBbXSwgYSAmJiBhLmxlbmd0aCA+IDAgJiYgKHQuYWN0aXZlTWV0ZXJzID0gSlNPTi5zdHJpbmdpZnkoYSkpLCBcInNob3dadW9yYU9mZmVyXCIgPT09IGUuZXZlbnRUeXBlKSB7XG4gICAgICAgIHZhciBkID0gZS5ldmVudFBhcmFtcy5yYXRlUGxhbklkcztcbiAgICAgICAgZCAmJiBkLmxlbmd0aCA+IDAgJiYgKHQuenVvcmFTZWxlY3RlZFJhdGVQbGFuSWRzID0gSlNPTi5zdHJpbmdpZnkoZCksIHQuYWRkaXRpb25hbFBhcmFtTmFtZXMucHVzaChcInp1b3JhU2VsZWN0ZWRSYXRlUGxhbklkc1wiKSk7XG4gICAgfSBpZiAoXCJzaG93TmV3c2N5Y2xlT2ZmZXJcIiA9PT0gZS5ldmVudFR5cGUpIHtcbiAgICAgICAgdmFyIHAgPSBlLmV2ZW50UGFyYW1zLmlkcztcbiAgICAgICAgcCAmJiBwLmxlbmd0aCA+IDAgJiYgKHQubmV3c2N5Y2xlU2VsZWN0ZWRJZHMgPSBKU09OLnN0cmluZ2lmeShwKSwgdC5hZGRpdGlvbmFsUGFyYW1OYW1lcy5wdXNoKFwibmV3c2N5Y2xlU2VsZWN0ZWRJZHNcIiwgXCJjYW1wYWlnbkNvZGVcIiwgXCJjYW1wYWlnbkdyb3VwSWRcIikpO1xuICAgIH0gaWYgKFwic2hvd05ld3NsZXR0ZXJTaWdudXBcIiA9PT0gZS5ldmVudFR5cGUpIHtcbiAgICAgICAgdmFyIGYgPSBlLmV2ZW50UGFyYW1zLm1haWxpbmdMaXN0SWRzLCBtID0gZS5ldmVudFBhcmFtcy5zaXRlSWQ7XG4gICAgICAgIGYgJiYgZi5sZW5ndGggPiAwICYmICh0Lm1haWxpbmdMaXN0SWRzID0gSlNPTi5zdHJpbmdpZnkoZiksIHQuc2l0ZUlkID0gbSwgdC5hZGRpdGlvbmFsUGFyYW1OYW1lcy5wdXNoKFwibWFpbGluZ0xpc3RJZHNcIiwgXCJzaXRlSWRcIikpO1xuICAgIH0gcmV0dXJuIFwic2hvd1JlY29tbWVuZGF0aW9uc1wiID09PSBlLmV2ZW50VHlwZSAmJiAodC53aWRnZXRJZCA9IGUuZXZlbnRQYXJhbXMud2lkZ2V0SWQsIHQucGxhY2Vob2xkZXIgPSBlLmV2ZW50UGFyYW1zLnBsYWNlaG9sZGVyKSwgcyAmJiAodC5mb3JtTmFtZUJ5VGVybUlkID0gSlNPTi5zdHJpbmdpZnkocyksIHQuaGlkZUNvbXBsZXRlZEZpZWxkcyA9IGMpLCBsICYmICh0LmFmZmlsaWF0ZVN0YXRlID0gbCksIG8uZGVidWcoXCJleHA6IHNob3cgd2l0aCBwYXJhbXM6XCIsIHQpLCBuKHQpOyB9IGZ1bmN0aW9uIGJlKCkgeyByZXR1cm4gZnVuY3Rpb24gKCkgeyB9OyB9IHJldHVybiB7IG5hbWU6IFwiZXhwZXJpZW5jZVwiLCBpbml0OiBmdW5jdGlvbiAoKSB7IGlmICghSSAmJiAhby5fX3Byb3RlY3RlZF9fLmlzQ3hlbnNlQm90KCkpIHtcbiAgICAgICAgICAgIEkgPSAhMDtcbiAgICAgICAgICAgIHZhciBlID0gITA7XG4gICAgICAgICAgICBpZiAocG4uY3VzdG9tUHJlQ2hlY2tzICYmIHBuLmN1c3RvbVByZUNoZWNrcy5sZW5ndGgpXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgbiA9IG51bGwsIHQgPSBwbi5jdXN0b21QcmVDaGVja3MubGVuZ3RoOyB0LS07KVxuICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgMSAhPT0gKG4gPSBwbi5jdXN0b21QcmVDaGVja3NbdF0oKSkgJiYgITAgIT09IG4gJiYgKGUgPSAhMSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY2F0Y2ggKGUpIHsgfVxuICAgICAgICAgICAgZSAmJiBRKFwiYXV0b1wiKS50aGVuKChmdW5jdGlvbiAoKSB7IHcuc2V0VGltZShcImV4cEV4ZWNcIik7IH0pKTtcbiAgICAgICAgfSB9LCBleGVjdXRlOiBFLCBfZ2V0TGFzdEV4ZWN1dGlvblJlc3VsdDogZnVuY3Rpb24gKCkgeyByZXR1cm4gTTsgfSwgcmVnaXN0ZXJDYWxsYmFjazogVCwgX19wcml2YXRlX186IHsgaGFuZGxlcnM6IHgsIGV4ZWN1dGVkTm9kZXM6IHksIGxpbmtlZE5vZGVzOiBiLCBwcm9jZXNzUmVzdWx0OiBkZSwgcHJvY2Vzc0Vycm9yczogWiwgc2hvdzogeWUsIGdldFRyYWNraW5nRW5kcG9pbnQ6IFcsIGluaXRpYWxpemVkOiBJLCByZWdpc3RlckNhbGxiYWNrOiBUIH0sIF9fcHJvdGVjdGVkX186IHsgc2VuZFN0YXRpc3RpY3NFeGVjdXRlZE5vZGVzOiBHIH0gfTsgfTtcbiAgICBwbi5jb250YWluZXIucmVnaXN0ZXIoXCJleHBlcmllbmNlXCIsIHsgdXNlVmFsdWU6IHVuKCkgfSksIHBuLmV4cGVyaWVuY2UgPSBwbi5jb250YWluZXIucmVzb2x2ZShcImV4cGVyaWVuY2VcIik7XG4gICAgdmFyIGRuID0gZnVuY3Rpb24gKCkgeyB2YXIgZSwgbiwgdCwgciwgbywgaSA9IDAsIGEgPSBkb2N1bWVudCwgcyA9ICExLCBjID0gXCJhY3RpdmVcIiwgbCA9IDZlNCwgdSA9IChyID0ge30sIHQgPSBcIl9fY2VHVUlEXCIsIHsgYWRkOiBmdW5jdGlvbiAoZSwgbiwgbykgeyByZXR1cm4gZVt0XSA9IHZvaWQgMCwgZVt0XSB8fCAoZVt0XSA9IFwiaWZ2aXNpYmxlLm9iamVjdC5ldmVudC5pZGVudGlmaWVyXCIpLCByW2VbdF1dIHx8IChyW2VbdF1dID0ge30pLCByW2VbdF1dW25dIHx8IChyW2VbdF1dW25dID0gW10pLCByW2VbdF1dW25dLnB1c2gobyk7IH0sIHJlbW92ZTogZnVuY3Rpb24gKGUsIG4sIG8pIHsgdmFyIGksIGEsIHMsIGMsIGw7IGlmIChvKSB7XG4gICAgICAgICAgICBpZiAoZVt0XSAmJiByW2VbdF1dICYmIHJbZVt0XV1bbl0pXG4gICAgICAgICAgICAgICAgZm9yIChhID0gcyA9IDAsIGMgPSAobCA9IHJbZVt0XV1bbl0pLmxlbmd0aDsgcyA8IGM7IGEgPSArK3MpXG4gICAgICAgICAgICAgICAgICAgIGlmICgoaSA9IGxbYV0pID09PSBvKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJbZVt0XV1bbl0uc3BsaWNlKGEsIDEpLCBpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGVbdF0gJiYgcltlW3RdXSAmJiByW2VbdF1dW25dKVxuICAgICAgICAgICAgcmV0dXJuIGRlbGV0ZSByW2VbdF1dW25dOyB9LCBmaXJlOiBmdW5jdGlvbiAoZSwgbiwgbykgeyB2YXIgaSwgYSwgcywgYywgbDsgaWYgKGVbdF0gJiYgcltlW3RdXSAmJiByW2VbdF1dW25dKSB7XG4gICAgICAgICAgICBmb3IgKGwgPSBbXSwgYSA9IDAsIHMgPSAoYyA9IHJbZVt0XV1bbl0pLmxlbmd0aDsgYSA8IHM7IGErKylcbiAgICAgICAgICAgICAgICBpID0gY1thXSwgbC5wdXNoKGkobyB8fCB7fSkpO1xuICAgICAgICAgICAgcmV0dXJuIGw7XG4gICAgICAgIH0gfSB9KSwgZCA9IGZ1bmN0aW9uIChlLCBuLCB0KSB7IHJldHVybiBvIHx8IChvID0gZS5hZGRFdmVudExpc3RlbmVyID8gZnVuY3Rpb24gKGUsIG4sIHQpIHsgcmV0dXJuIGUuYWRkRXZlbnRMaXN0ZW5lcihuLCB0LmJpbmQoZG4pLCAhMSk7IH0gOiBlLmF0dGFjaEV2ZW50ID8gZnVuY3Rpb24gKGUsIG4sIHQpIHsgcmV0dXJuIGUuYXR0YWNoRXZlbnQoXCJvblwiICsgbiwgdCwgITEpOyB9IDogZnVuY3Rpb24gKGUsIG4sIHQpIHsgcmV0dXJuIGVbXCJvblwiICsgbl0gPSB0OyB9KSwgbyhlLCBuLCB0KTsgfSwgcCA9IGZ1bmN0aW9uICgpIHsgdmFyIGUsIG4gPSBhLmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiksIHQgPSBuLmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiaVwiKSwgciA9IDM7IGZvciAoZSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIG4uaW5uZXJIVE1MID0gXCJcXHgzYyEtLVtpZiBndCBJRSBcIiArICsrciArIFwiXT48aT48L2k+PCFbZW5kaWZdLS1cXHgzZVwiLCB0WzBdOyB9OyBlKCk7KVxuICAgICAgICA7IHJldHVybiByID4gNCA/IHIgOiB2b2lkIDA7IH0oKTsgZnVuY3Rpb24gZigpIHsgdmFyIHQsIHIsIG87IHJldHVybiAhIXMgfHwgKGUgPyBkKGEsIG4sIChmdW5jdGlvbiAoKSB7IHJldHVybiBhLmhpZGRlbiA/IGcoKSA6IG0oKTsgfSksICExKSA6ICh0ID0gXCJibHVyXCIsIHAgJiYgcCA8IDkgJiYgKHQgPSBcImZvY3Vzb3V0XCIpLCBkKHdpbmRvdywgdCwgKGZ1bmN0aW9uICgpIHsgcmV0dXJuIGRuLmJsdXIoKTsgfSkpLCBkKHdpbmRvdywgXCJmb2N1c1wiLCAoZnVuY3Rpb24gKCkgeyByZXR1cm4gZG4uZm9jdXMoKTsgfSkpKSwgcyA9ICEwLCAobyA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGNsZWFyVGltZW91dChyKSwgXCJhY3RpdmVcIiAhPT0gYyAmJiBoKCksIGkgPSArbmV3IERhdGUsIHIgPSBzZXRUaW1lb3V0KChmdW5jdGlvbiAoKSB7IGlmIChcImFjdGl2ZVwiID09PSBjKVxuICAgICAgICByZXR1cm4gdigpOyB9KSwgbCk7IH0pKCksIGQoYSwgXCJtb3VzZW1vdmVcIiwgbyksIGQoYSwgXCJtb3VzZXVwXCIsIG8pLCBkKGEsIFwia2V5dXBcIiwgbyksIGQoYSwgXCJ0b3VjaHN0YXJ0XCIsIG8pLCBkKHdpbmRvdywgXCJzY3JvbGxcIiwgbyksIGQod2luZG93LCBcInJlc2l6ZVwiLCBvKSwgbShvKSwgaChvKSk7IH0gdm9pZCAwICE9PSBhLmhpZGRlbiA/IChlID0gXCJoaWRkZW5cIiwgbiA9IFwidmlzaWJpbGl0eWNoYW5nZVwiKSA6IHZvaWQgMCAhPT0gYS5tb3pIaWRkZW4gPyAoZSA9IFwibW96SGlkZGVuXCIsIG4gPSBcIm1venZpc2liaWxpdHljaGFuZ2VcIikgOiB2b2lkIDAgIT09IGEubXNIaWRkZW4gPyAoZSA9IFwibXNIaWRkZW5cIiwgbiA9IFwibXN2aXNpYmlsaXR5Y2hhbmdlXCIpIDogdm9pZCAwICE9PSBhLndlYmtpdEhpZGRlbiAmJiAoZSA9IFwid2Via2l0SGlkZGVuXCIsIG4gPSBcIndlYmtpdHZpc2liaWxpdHljaGFuZ2VcIik7IGZ1bmN0aW9uIG0oZSkgeyByZXR1cm4gXCJmdW5jdGlvblwiID09IHR5cGVvZiBlID8gdyhcImZvY3VzXCIsIChmdW5jdGlvbiAobikgeyBlKG4pOyB9KSkgOiAoYyA9IFwiYWN0aXZlXCIsIHUuZmlyZShkbiwgXCJmb2N1c1wiKSwgdS5maXJlKGRuLCBcIndha2V1cFwiKSwgdS5maXJlKGRuLCBcInN0YXR1c0NoYW5nZWRcIiwgeyBzdGF0dXM6IGMgfSkpLCBkbjsgfSBmdW5jdGlvbiBnKGUpIHsgcmV0dXJuIFwiZnVuY3Rpb25cIiA9PSB0eXBlb2YgZSA/IHcoXCJibHVyXCIsIChmdW5jdGlvbiAobikgeyBlKG4pOyB9KSkgOiAoYyA9IFwiaGlkZGVuXCIsIHUuZmlyZShkbiwgXCJibHVyXCIpLCB1LmZpcmUoZG4sIFwiaWRsZVwiKSwgdS5maXJlKGRuLCBcInN0YXR1c0NoYW5nZWRcIiwgeyBzdGF0dXM6IGMgfSkpLCBkbjsgfSBmdW5jdGlvbiB2KGUpIHsgcmV0dXJuIFwiZnVuY3Rpb25cIiA9PSB0eXBlb2YgZSA/IHcoXCJpZGxlXCIsIChmdW5jdGlvbiAobikgeyBlKG4pOyB9KSkgOiAoYyA9IFwiaWRsZVwiLCB1LmZpcmUoZG4sIFwiaWRsZVwiKSwgdS5maXJlKGRuLCBcInN0YXR1c0NoYW5nZWRcIiwgeyBzdGF0dXM6IGMgfSkpLCBkbjsgfSBmdW5jdGlvbiBoKGUpIHsgcmV0dXJuIFwiZnVuY3Rpb25cIiA9PSB0eXBlb2YgZSA/IHcoXCJ3YWtldXBcIiwgKGZ1bmN0aW9uIChuKSB7IHJldHVybiBlKG4pOyB9KSkgOiAoYyA9IFwiYWN0aXZlXCIsIHUuZmlyZShkbiwgXCJ3YWtldXBcIiksIHUuZmlyZShkbiwgXCJzdGF0dXNDaGFuZ2VkXCIsIHsgc3RhdHVzOiBjIH0pKSwgZG47IH0gZnVuY3Rpb24gdyhlLCBuKSB7IHJldHVybiBmKCksIHUuYWRkKGRuLCBlLCBuKSwgZG47IH0gcmV0dXJuIHsgbmFtZTogXCJpZnZpc2libGVcIiwgc2V0SWRsZUR1cmF0aW9uOiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gbCA9IDFlMyAqIGU7IH0sIGdldElkbGVEdXJhdGlvbjogZnVuY3Rpb24gKCkgeyByZXR1cm4gbDsgfSwgZ2V0SWRsZUluZm86IGZ1bmN0aW9uICgpIHsgdmFyIGUsIG47IHJldHVybiBlID0gK25ldyBEYXRlLCBuID0ge30sIFwiaWRsZVwiID09PSBjID8gKG4uaXNJZGxlID0gITAsIG4uaWRsZUZvciA9IGUgLSBpLCBuLnRpbWVMZWZ0ID0gMCwgbi50aW1lTGVmdFBlciA9IDEwMCkgOiAobi5pc0lkbGUgPSAhMSwgbi5pZGxlRm9yID0gZSAtIGksIG4udGltZUxlZnQgPSBpICsgbCAtIGUsIG4udGltZUxlZnRQZXIgPSAoMTAwIC0gMTAwICogbi50aW1lTGVmdCAvIGwpLnRvRml4ZWQoMikpLCBuOyB9LCB3YWtldXA6IGgsIGlkbGU6IHYsIGZvY3VzOiBtLCBibHVyOiBnLCBvbjogdywgb2ZmOiBmdW5jdGlvbiAoZSwgbikgeyByZXR1cm4gZigpLCB1LnJlbW92ZShkbiwgZSwgbiksIGRuOyB9LCBvbkV2ZXJ5OiBmdW5jdGlvbiAoZSwgbikgeyB2YXIgdCwgciA9ICExOyByZXR1cm4gZigpLCBuICYmICh0ID0gc2V0SW50ZXJ2YWwoKGZ1bmN0aW9uICgpIHsgaWYgKFwiYWN0aXZlXCIgPT09IGMgJiYgIXIpXG4gICAgICAgICAgICByZXR1cm4gbigpOyB9KSwgMWUzICogZSkpLCB7IHN0b3A6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGNsZWFySW50ZXJ2YWwodCk7IH0sIHBhdXNlOiBmdW5jdGlvbiAoKSB7IHJldHVybiByID0gITA7IH0sIHJlc3VtZTogZnVuY3Rpb24gKCkgeyByZXR1cm4gciA9ICExOyB9LCBjb2RlOiB0LCBjYWxsYmFjazogbiB9OyB9LCBub3c6IGZ1bmN0aW9uIChlKSB7IHJldHVybiBmKCksIGMgPT09IChlIHx8IFwiYWN0aXZlXCIpOyB9IH07IH0oKTtcbiAgICBwbi5jb250YWluZXIucmVnaXN0ZXIoXCJpZnZpc2libGVcIiwgeyB1c2VWYWx1ZTogZG4gfSksIHBuLmlmdmlzaWJsZSA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwiaWZ2aXNpYmxlXCIpO1xuICAgIHZhciBmbiA9IGZ1bmN0aW9uICgpIHsgdmFyIGUsIG4gPSBwbi5jb250YWluZXIucmVzb2x2ZShcImpxVXRpbHNcIiksIHQgPSBwbi5jb250YWluZXIucmVzb2x2ZShcImlmdmlzaWJsZVwiKSwgciA9IDAsIG8gPSBbXSwgaSA9IDYwLCBhID0gITAsIHMgPSBmdW5jdGlvbiAoKSB7IG0oKTsgdmFyIGUgPSBvW28ubGVuZ3RoIC0gMV07IHZvaWQgMCAhPT0gZSAmJiB2b2lkIDAgPT09IGUuc3RvcFRpbWUgfHwgby5wdXNoKHsgc3RhcnRUaW1lOiBuZXcgRGF0ZSwgc3RhcnRNaW51dGU6IHIsIHN0b3BUaW1lOiB2b2lkIDAgfSk7IH0sIGMgPSBmdW5jdGlvbiAoKSB7IGlmICgwICE9PSBvLmxlbmd0aCAmJiAhYSlcbiAgICAgICAgaWYgKGQoKSlcbiAgICAgICAgICAgIGYoKTtcbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB2YXIgZSA9IG9bby5sZW5ndGggLSAxXTtcbiAgICAgICAgICAgIHZvaWQgMCA9PT0gZS5zdG9wVGltZSAmJiAoZS5zdG9wVGltZSA9IG5ldyBEYXRlLCBlLnN0b3BNaW51dGUgPSByKTtcbiAgICAgICAgfSB9LCBsID0gZnVuY3Rpb24gKGUsIG4sIHQsIHIpIHsgdmFyIG8gPSBNYXRoLmFicyhlLmdldFRpbWUoKSAtIG4uZ2V0VGltZSgpKSwgaSA9IHQgLSByOyByZXR1cm4gbyA+IDZlNCAqIChpICsgMTApICYmIChvID0gNmU0ICogaSksIG87IH0sIHUgPSBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IHBhcnNlRmxvYXQoZSk7IGlmIChpc05hTihuKSlcbiAgICAgICAgdGhyb3cgeyBuYW1lOiBcIkludmFsaWREdXJhdGlvbkV4Y2VwdGlvblwiLCBtZXNzYWdlOiBcIkFuIGludmFsaWQgZHVyYXRpb24gdGltZSAoXCIgKyBlICsgXCIpIHdhcyBwcm92aWRlZC5cIiB9OyB0LnNldElkbGVEdXJhdGlvbihuKSwgaSA9IG47IH0sIGQgPSBmdW5jdGlvbiAoKSB7IHJldHVybiAhIShlID0gbi5maWx0ZXIoXCJ2aWRlbyxhdWRpb1wiLCAoZnVuY3Rpb24gKGUpIHsgcmV0dXJuICFlLnBhdXNlZDsgfSkpKS5sZW5ndGg7IH0sIHAgPSBmdW5jdGlvbiAoKSB7IHNldFRpbWVvdXQoKGZ1bmN0aW9uICgpIHsgYygpOyB9KSwgMTVlMyk7IH0sIGYgPSBmdW5jdGlvbiAoKSB7IGUgJiYgZS5mb3JFYWNoKChmdW5jdGlvbiAoZSkgeyBuLm9uKGUsIFwicGF1c2VcIiwgcCk7IH0pKTsgfSwgbSA9IGZ1bmN0aW9uICgpIHsgZSAmJiBlLmZvckVhY2goKGZ1bmN0aW9uIChlKSB7IG4ub2ZmKGUsIFwicGF1c2VcIiwgcCk7IH0pKTsgfTsgcmV0dXJuIHsgbmFtZTogXCJhY3RpdmV0aW1lclwiLCBzZXRJZGxlRHVyYXRpb25JblNlY29uZHM6IHUsIGdldEFjdGl2ZVRpbWVJblNlY29uZHM6IGZ1bmN0aW9uICgpIHsgZm9yICh2YXIgZSA9IDAsIG4gPSAwOyBuIDwgby5sZW5ndGg7IG4rKykge1xuICAgICAgICAgICAgdmFyIHQgPSBvW25dLnN0YXJ0VGltZSwgaSA9IG9bbl0uc3RvcFRpbWUsIGEgPSBvW25dLnN0YXJ0TWludXRlLCBzID0gb1tuXS5zdG9wTWludXRlO1xuICAgICAgICAgICAgdm9pZCAwID09PSBpICYmIChpID0gbmV3IERhdGUsIHMgPSByKSwgZSArPSBsKGksIHQsIHMsIGEpO1xuICAgICAgICB9IHJldHVybiBNYXRoLmZsb29yKGUgLyAxZTMpOyB9LCBnZXRUb3RhbFRpbWVJblNlY29uZHM6IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSAwLCBuID0gb1swXTsgaWYgKHZvaWQgMCAhPT0gbikge1xuICAgICAgICAgICAgdmFyIHQgPSBuLnN0YXJ0VGltZSwgaSA9IG4uc3RhcnRNaW51dGUsIGEgPSBuZXcgRGF0ZTtcbiAgICAgICAgICAgIGUgPSBsKGEsIHQsIHIsIGkpO1xuICAgICAgICB9IHJldHVybiBNYXRoLmZsb29yKGUgLyAxZTMpOyB9LCByZXNldFJlY29yZGVkVGltZTogZnVuY3Rpb24gKCkgeyBvID0gW10sIHMoKTsgfSwgc3RhcnRUaW1lcjogcywgc3RvcFRpbWVyOiBjLCBpbml0aWFsaXplOiBmdW5jdGlvbiAoZSkgeyBlICYmIHUoZSksIHQub24oXCJibHVyXCIsIChmdW5jdGlvbiAoKSB7IGEgPSAhMSwgYygpOyB9KSksIHQub24oXCJmb2N1c1wiLCAoZnVuY3Rpb24gKCkgeyBhID0gITAsIHMoKTsgfSkpLCB0Lm9uKFwiaWRsZVwiLCAoZnVuY3Rpb24gKCkgeyBpID4gMCAmJiAoYSA9ICExLCBjKCkpOyB9KSksIHQub24oXCJ3YWtldXBcIiwgKGZ1bmN0aW9uICgpIHsgaSA+IDAgJiYgKGEgPSAhMCwgcygpKTsgfSkpLCBzKCksIHNldEludGVydmFsKChmdW5jdGlvbiAoKSB7IHIrKzsgfSksIDZlNCk7IH0gfTsgfSgpO1xuICAgIHBuLmNvbnRhaW5lci5yZWdpc3RlcihcImFjdGl2ZXRpbWVyXCIsIHsgdXNlVmFsdWU6IGZuIH0pLCBwbi5hY3RpdmV0aW1lciA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwiYWN0aXZldGltZXJcIik7XG4gICAgdmFyIG1uID0gZnVuY3Rpb24gKCkgeyB2YXIgZSwgbiA9IHt9LCB0ID0gW10sIHIgPSAhMSwgbyA9IDEsIGkgPSAyLCBhID0gMzsgZnVuY3Rpb24gcyhlKSB7IGUgJiYgKHUoKSwgciA9ICExKSwgZnVuY3Rpb24gKCkgeyBpZiAocilcbiAgICAgICAgcmV0dXJuICExOyByID0gITA7IHRyeSB7XG4gICAgICAgIHZhciBlID0gd2luZG93Lmdvb2dsZXRhZyA9IHdpbmRvdy5nb29nbGV0YWcgfHwge307XG4gICAgICAgIGUuY21kID0gZS5jbWQgfHwgW10sIGUuY21kLnB1c2goKGZ1bmN0aW9uICgpIHsgZS5wdWJhZHMoKS5hZGRFdmVudExpc3RlbmVyKFwic2xvdFJlbmRlckVuZGVkXCIsIGYpLCBlLnB1YmFkcygpLmFkZEV2ZW50TGlzdGVuZXIoXCJpbXByZXNzaW9uVmlld2FibGVcIiwgbSksIGUuY29tcGFuaW9uQWRzKCkuYWRkRXZlbnRMaXN0ZW5lcihcInNsb3RSZW5kZXJFbmRlZFwiLCBmKSwgZS5jb21wYW5pb25BZHMoKS5hZGRFdmVudExpc3RlbmVyKFwiaW1wcmVzc2lvblZpZXdhYmxlXCIsIG0pOyB9KSksIGUuYXBpUmVhZHkgJiYgZS5jbWQucHVzaCgoZnVuY3Rpb24gKCkgeyBkKGUucHViYWRzKCkuZ2V0U2xvdHMoKSksIGQoZS5jb21wYW5pb25BZHMoKS5nZXRTbG90cygpKTsgfSkpO1xuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgICByZXR1cm4gdihlKSwgITE7XG4gICAgfSB9KCk7IH0gZnVuY3Rpb24gYyhuLCB0KSB7IFwiZnVuY3Rpb25cIiA9PSB0eXBlb2YgZSAmJiBlKG4sIHQpOyB9IGZ1bmN0aW9uIGwoZSkgeyByZXR1cm4gZSAmJiB2b2lkIDAgIT09IG5bZV0gJiYgbnVsbCAhPT0gbltlXSAmJiBuLmhhc093blByb3BlcnR5KGUpOyB9IGZ1bmN0aW9uIHUoKSB7IG4gPSB7fSwgdCA9IFtdOyB9IGZ1bmN0aW9uIGQoZSkgeyBmb3IgKHZhciBuID0gMDsgbiA8IGUubGVuZ3RoOyBuKyspIHtcbiAgICAgICAgdmFyIHQgPSBlW25dO1xuICAgICAgICBmKHsgZXZlbnRTb3VyY2U6IGEsIHNsb3Q6IHQgfSk7XG4gICAgfSB9IGZ1bmN0aW9uIHAoZSkgeyB2YXIgbjsgdHJ5IHtcbiAgICAgICAgdmFyIHQgPSBlLnNlcnZpY2VOYW1lLCByID0gZS5zbG90O1xuICAgICAgICBpZiAoIXQpIHtcbiAgICAgICAgICAgIHZhciBvID0gZS5zbG90LmdldFNlcnZpY2VzKCk7XG4gICAgICAgICAgICBvICYmIG8ubGVuZ3RoICYmICh0ID0gb1swXS5nZXROYW1lKCkpO1xuICAgICAgICB9XG4gICAgICAgIHZhciBpID0gci5nZXRSZXNwb25zZUluZm9ybWF0aW9uKCkgfHwge30sIGEgPSByLmdldFNsb3RJZCA/IHIuZ2V0U2xvdElkKCkgOiB7fSwgcyA9IHIuZ2V0U2xvdEVsZW1lbnRJZCA/IHIuZ2V0U2xvdEVsZW1lbnRJZCgpIDogYS5nZXREb21JZCA/IGEuZ2V0RG9tSWQoKSA6IG51bGw7XG4gICAgICAgIG4gPSB7IGNvbXBhbmlvbjogISF0ICYmIFwiY29tcGFuaW9uX2Fkc1wiID09PSB0LCBhZFVuaXQ6IHIuZ2V0QWRVbml0UGF0aCA/IHIuZ2V0QWRVbml0UGF0aCgpIDogMCwgaXNFbXB0eTogZS5pc0VtcHR5LCBlbGVtZW50SWQ6IHMsIGFkdmVydGlzZXJJZDogZS5hZHZlcnRpc2VySWQgfHwgaS5hZHZlcnRpc2VySWQsIGNhbXBhaWduSWQ6IGUuY2FtcGFpZ25JZCB8fCBpLmNhbXBhaWduSWQsIGxpbmVJdGVtSWQ6IGUubGluZUl0ZW1JZCB8fCBpLmxpbmVJdGVtSWQsIGNyZWF0aXZlSWQ6IGUuY3JlYXRpdmVJZCB8fCBpLmNyZWF0aXZlSWQsIGV2ZW50U291cmNlOiBlLmV2ZW50U291cmNlIHx8IG51bGwsIHNpemU6IGUuc2l6ZSAmJiBlLnNpemUuc2xpY2UoMCwgMikgfHwgbnVsbCwgdmlld2VkOiAhMSwgcG9zaXRpb246IG51bGwgfTtcbiAgICAgICAgdmFyIGMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChzKTtcbiAgICAgICAgaWYgKHMgJiYgYyAmJiAobi5wb3NpdGlvbiA9IHsgdG9wOiBjLm9mZnNldFRvcCwgbGVmdDogYy5vZmZzZXRMZWZ0IH0sIHZvaWQgMCA9PT0gZS5pc0VtcHR5ICYmIChuLmlzRW1wdHkgPSBjLm9mZnNldFdpZHRoIDw9IDAgJiYgYy5vZmZzZXRIZWlnaHQgPD0gMCwgIW4uaXNFbXB0eSAmJiAhbi5zaXplKSkpIHtcbiAgICAgICAgICAgIHZhciBsID0gci5nZXRTaXplcygpO1xuICAgICAgICAgICAgbCAmJiBsLmxlbmd0aCAmJiAobi5zaXplID0gXCJvYmplY3RcIiA9PSB0eXBlb2YgbFswXSA/IFtsWzBdLmdldFdpZHRoKCksIGxbMF0uZ2V0SGVpZ2h0KCldIDogbFswXSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgdihlKTtcbiAgICB9IHJldHVybiBuOyB9IGZ1bmN0aW9uIGYoZSkgeyBlLmV2ZW50U291cmNlID0gZS5ldmVudFNvdXJjZSB8fCBvOyB2YXIgciA9IHAoZSksIGkgPSBnKGUuc2xvdCk7IGkgJiYgKG5baV0gPyByLnZpZXdlZCA9IG5baV0udmlld2VkIDogdC5wdXNoKGkpLCBuW2ldID0gciwgYyhyLCBpKSk7IH0gZnVuY3Rpb24gbShlKSB7IHZhciByID0gZyhlLnNsb3QpOyBpZiAocikge1xuICAgICAgICB2YXIgbyA9IG5bcl0gfHwgcChlKTtcbiAgICAgICAgbChyKSB8fCAobltyXSA9IG8sIHQucHVzaChyKSksIHZvaWQgMCA9PT0gby5jb21wYW5pb24gJiYgKG8uY29tcGFuaW9uID0gXCJjb21wYW5pb25fYWRzXCIgPT09IGUuc2VydmljZU5hbWUpLCAoIW8uZXZlbnRTb3VyY2UgfHwgby5ldmVudFNvdXJjZSA+IGkpICYmIChvLmV2ZW50U291cmNlID0gaSksIG8udmlld2VkID0gITAsIGMobywgcik7XG4gICAgfSB9IGZ1bmN0aW9uIGcoZSkgeyB0cnkge1xuICAgICAgICB2YXIgbiA9IGUuZ2V0U2xvdElkID8gZS5nZXRTbG90SWQoKSA6IHt9LCB0ID0gZS5nZXRTbG90RWxlbWVudElkID8gZS5nZXRTbG90RWxlbWVudElkKCkgOiBuLmdldERvbUlkID8gbi5nZXREb21JZCgpIDogbnVsbCwgciA9IGUuZ2V0QWRVbml0UGF0aCA/IGUuZ2V0QWRVbml0UGF0aCgpIDogMDtcbiAgICAgICAgcmV0dXJuIFt0LCBuLmdldElkID8gbi5nZXRJZCgpIDogMCwgcl0uam9pbihcIjpcIik7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIHYoZSk7XG4gICAgfSB9IGZ1bmN0aW9uIHYoZSkgeyBwbiAmJiBwbi51dGlsICYmIHBuLnV0aWwuZXJyb3IgJiYgcG4udXRpbC5lcnJvcihcIkRGUCBtb2R1bGUgZXJyb3I6IFwiLCBlKTsgfSByZXR1cm4gcygpLCB7IG5hbWU6IFwiZG91YmxlQ2xpY2tGb3JQdWJsaXNoZXJcIiwgaW5pdGlhbGl6ZTogcywgc2V0Q3VzdG9tSGFuZGxlcjogZnVuY3Rpb24gKG4pIHsgZSA9IG47IH0sIGdldEFkczogZnVuY3Rpb24gKGUpIHsgdmFyIHIsIG8gPSBbXSwgaSA9IDAsIGEgPSB0Lmxlbmd0aDsgZSAmJiAoXCJudW1iZXJcIiA9PSB0eXBlb2YgKHIgPSBlKSAmJiBpc0Zpbml0ZShyKSAmJiBNYXRoLmZsb29yKHIpID09PSByKSAmJiBlID4gMCAmJiBlIDwgYSAmJiAoaSA9IGEgLSBlKTsgZm9yICh2YXIgcyA9IGk7IHMgPCBhOyBzKyspIHtcbiAgICAgICAgICAgIHZhciBjID0gdFtzXTtcbiAgICAgICAgICAgIGwoYykgJiYgby5wdXNoKG5bY10pO1xuICAgICAgICB9IHJldHVybiBvOyB9LCByZXNldEFkczogdSB9OyB9KCk7XG4gICAgcG4uY29udGFpbmVyLnJlZ2lzdGVyKFwiZG91YmxlQ2xpY2tGb3JQdWJsaXNoZXJcIiwgeyB1c2VWYWx1ZTogbW4gfSksIHBuLmRvdWJsZUNsaWNrRm9yUHVibGlzaGVyID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJkb3VibGVDbGlja0ZvclB1Ymxpc2hlclwiKTtcbiAgICB2YXIgZ24gPSBmdW5jdGlvbiAoKSB7IHZhciBlLCBuLCB0LCByLCBvLCBpLCBhID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJwb3N0bWVzc2FnZVwiKSwgcyA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwidXRpbFwiKSwgYyA9IFwiaHR0cHM6Ly9qcy5icmFpbnRyZWVnYXRld2F5LmNvbS93ZWIvMy43OS4xL2pzL2NsaWVudC5taW4uanNcIiwgbCA9IFwiaHR0cHM6Ly9qcy5icmFpbnRyZWVnYXRld2F5LmNvbS93ZWIvMy43OS4xL2pzL2FwcGxlLXBheS5taW4uanNcIiwgdSA9IFwiXCI7IGEuc3Vic2NyaWJlKFwibG9hZGVkXCIsIChmdW5jdGlvbiAoKSB7IGQoKTsgfSkpLCBhLnN1YnNjcmliZShcInN0YXJ0Q2hlY2tvdXRcIiwgKGZ1bmN0aW9uICgpIHsgZCgpOyB9KSksIGEuc3Vic2NyaWJlKFwiYXBwbGVQYXlCdENsaWVudFRva2VuXCIsIChmdW5jdGlvbiAoZSkgeyBnKGUucGFyYW1zLmNsaWVudFRva2VuKTsgfSkpLCBhLnN1YnNjcmliZShcImFwcGxlUGF5QnRDaGVja291dEZsb3dQcm9wZXJ0aWVzXCIsIChmdW5jdGlvbiAoZSkgeyByID0gZS5wYXJhbXMucmVxdWVzdEVtYWlsLCBvID0gZS5wYXJhbXMucmVxdWVzdFBvc3RhbEFkZHJlc3M7IH0pKSwgYS5zdWJzY3JpYmUoXCJhcHBseVRheEZhaWxlZFwiLCAoZnVuY3Rpb24gKG4pIHsgZS5hYm9ydCgpOyB9KSksIGEuc3Vic2NyaWJlKFwiY2hlY2tBcHBsZVBheUJ0SW5zdGFuY2VcIiwgKGZ1bmN0aW9uIChlKSB7IG4gJiYgYS5icm9hZGNhc3QoXCJhcHBsZVBheUluaXRcIiwge30pOyB9KSksIGEuc3Vic2NyaWJlKFwiYXBwbHlUYXhDb21wbGV0ZWRcIiwgKGZ1bmN0aW9uIChlKSB7IG0oZS5wYXJhbXMubm9uY2UpOyB9KSksIGEuc3Vic2NyaWJlKFwiYXBwbGVQYXlCdEJlZ2luU2Vzc2lvblwiLCAoZnVuY3Rpb24gKGkpIHsgdmFyIHMgPSB7fSwgYyA9IGkucGFyYW1zOyBjLnJlc291cmNlVGl0bGUgJiYgKHMgPSBjKSwgYy50ZXJtSWQgJiYgKHUgPSBjLnRlcm1JZCB8fCBcIlwiKTsgdmFyIGwgPSB7IGN1cnJlbmN5Q29kZTogYy5jdXJyZW5jeUNvZGUsIHRvdGFsOiB7IGxhYmVsOiBjLnJlc291cmNlVGl0bGUsIGFtb3VudDogYy5jaGFyZ2VBbW91bnQgfSB9OyBwKGwpOyB0cnkge1xuICAgICAgICB0ID0gbi5jcmVhdGVQYXltZW50UmVxdWVzdChsKTtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgYS5icm9hZGNhc3QoXCJwYXltZW50LWVycm9yXCIsIHsgZXJyb3JDb2RlOiAxMDEgfSk7XG4gICAgfSAoZSA9IG5ldyB3aW5kb3cuQXBwbGVQYXlTZXNzaW9uKDIsIHQpKS5vbnZhbGlkYXRlbWVyY2hhbnQgPSBmdW5jdGlvbiAodCkgeyBuLnBlcmZvcm1WYWxpZGF0aW9uKHsgdmFsaWRhdGlvblVSTDogdC52YWxpZGF0aW9uVVJMLCBkaXNwbGF5TmFtZTogYy5yZXNvdXJjZVRpdGxlIHx8IHMucmVzb3VyY2VUaXRsZSB9LCAoZnVuY3Rpb24gKG4sIHQpIHsgaWYgKG4pXG4gICAgICAgIHJldHVybiBlLmFib3J0KCksIHZvaWQgYS5icm9hZGNhc3QoXCJwYXltZW50LWVycm9yXCIsIHsgZXJyb3JDb2RlOiAxMDIgfSk7IGUuY29tcGxldGVNZXJjaGFudFZhbGlkYXRpb24odCk7IH0pKTsgfSwgZS5vbnBheW1lbnRhdXRob3JpemVkID0gZnVuY3Rpb24gKHQpIHsgbi50b2tlbml6ZSh7IHRva2VuOiB0LnBheW1lbnQudG9rZW4gfSwgKGZ1bmN0aW9uIChuLCBpKSB7IGlmIChuKVxuICAgICAgICByZXR1cm4gYS5icm9hZGNhc3QoXCJwYXltZW50LWVycm9yXCIsIHsgZXJyb3JDb2RlOiAxMDMgfSksIHZvaWQgZS5jb21wbGV0ZVBheW1lbnQod2luZG93LkFwcGxlUGF5U2Vzc2lvbi5TVEFUVVNfRkFJTFVSRSk7IHZhciBzID0geyBub25jZTogaS5ub25jZSB9OyByIHx8IG8gPyBmKHQsIHMpIDogbShzKTsgfSkpOyB9LCBlLmJlZ2luKCk7IH0pKTsgdmFyIGQgPSBmdW5jdGlvbiAoKSB7IHZhciBlID0gcy5fX3Byb3RlY3RlZF9fLmlzQXBwbGVQYXlBbGxvd2VkKCk7IGEuYnJvYWRjYXN0KFwiRVZFTlRfQVBQTEVfUEFZX0NBTl9NQUtFX1BBWU1FTlRTXCIsIHsgY2FuTWFrZVBheW1lbnRzOiBlIH0pOyB9LCBwID0gZnVuY3Rpb24gKGUpIHsgciAmJiAoZS5yZXF1aXJlZFNoaXBwaW5nQ29udGFjdEZpZWxkcyA9IFtcImVtYWlsXCJdKSwgbyAmJiAoZS5yZXF1aXJlZEJpbGxpbmdDb250YWN0RmllbGRzID0gW1wicG9zdGFsQWRkcmVzc1wiXSk7IH0sIGYgPSBmdW5jdGlvbiAoZSwgbikgeyBlLnBheW1lbnQuc2hpcHBpbmdDb250YWN0ICYmIChuLnVzZXIgPSB7IGVtYWlsOiBlLnBheW1lbnQuc2hpcHBpbmdDb250YWN0LmVtYWlsQWRkcmVzcyB9KTsgdmFyIHQgPSBlLnBheW1lbnQuYmlsbGluZ0NvbnRhY3QsIHIgPSB7IGNvdW50cnlDb2RlOiB0LmNvdW50cnlDb2RlID8gdC5jb3VudHJ5Q29kZS50b1VwcGVyQ2FzZSgpIDogdC5jb3VudHJ5Q29kZSwgemlwQ29kZTogdC5wb3N0YWxDb2RlLCBiaWxsaW5nWmlwQ29kZTogdC5wb3N0YWxDb2RlLCBub25jZTogbiB9OyBhLmJyb2FkY2FzdChcImFwcGxlUGF5UGF5bWVudEF1dGhvcml6ZWRcIiArIHUsIHIpOyB9LCBtID0gZnVuY3Rpb24gKG4pIHsgZS5jb21wbGV0ZVBheW1lbnQod2luZG93LkFwcGxlUGF5U2Vzc2lvbi5TVEFUVVNfU1VDQ0VTUyksIGEuYnJvYWRjYXN0KFwiYXBwbGVQYXlOb25jZVwiICsgdSwgbik7IH0sIGcgPSBmdW5jdGlvbiAoZSkgeyBpID0gZSwgdigpOyB9LCB2ID0gZnVuY3Rpb24gKCkgeyB5KCkgfHwgdyhjLCAoZnVuY3Rpb24gKCkgeyBoKCk7IH0pKTsgfSwgaCA9IGZ1bmN0aW9uICgpIHsgYigpIHx8IHcobCwgKGZ1bmN0aW9uICgpIHsgd2luZG93LmJyYWludHJlZS5jbGllbnQuY3JlYXRlKHsgYXV0aG9yaXphdGlvbjogaSB9KS50aGVuKChmdW5jdGlvbiAoZSkgeyB3aW5kb3cuYnJhaW50cmVlLmFwcGxlUGF5LmNyZWF0ZSh7IGNsaWVudDogZSB9LCAoZnVuY3Rpb24gKGUsIHQpIHsgZSA/IGEuYnJvYWRjYXN0KFwicGF5bWVudC1lcnJvclwiLCB7IGVycm9yQ29kZTogMTAxIH0pIDogKG4gPSB0LCBhLmJyb2FkY2FzdChcImFwcGxlUGF5SW5pdFwiLCB7fSkpOyB9KSk7IH0pKS5jYXRjaCgoZnVuY3Rpb24gKGUpIHsgaWYgKGUpXG4gICAgICAgIHJldHVybiBhLmJyb2FkY2FzdChcInBheW1lbnQtZXJyb3JcIiwgeyBlcnJvckNvZGU6IDEwMCB9KSwgdm9pZCBzLmVycm9yKFwiW1RQXSBDbGllbnQgZXJyb3I6IFwiICsgZS5tZXNzYWdlKTsgfSkpOyB9KSk7IH0sIHcgPSBmdW5jdGlvbiAoZSwgbikgeyBzLmFkZFNjcmlwdChlLCBuKTsgfSwgeSA9IGZ1bmN0aW9uICgpIHsgZm9yICh2YXIgZSA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwic2NyaXB0XCIpLCBuID0gMCwgdCA9IGUubGVuZ3RoOyBuIDwgdDsgbisrKVxuICAgICAgICBpZiAoZVtuXS5zcmMuaW5kZXhPZihjKSA+IC0xKVxuICAgICAgICAgICAgcmV0dXJuICEwOyB9LCBiID0gZnVuY3Rpb24gKCkgeyBmb3IgKHZhciBlID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJzY3JpcHRcIiksIG4gPSAwLCB0ID0gZS5sZW5ndGg7IG4gPCB0OyBuKyspXG4gICAgICAgIGlmIChlW25dLnNyYy5pbmRleE9mKGwpID4gLTEpXG4gICAgICAgICAgICByZXR1cm4gITA7IH07IHJldHVybiB7IG5hbWU6IFwiYXBwbGVQYXlcIiB9OyB9KCk7XG4gICAgcG4uY29udGFpbmVyLnJlZ2lzdGVyKFwiYXBwbGVQYXlcIiwgeyB1c2VWYWx1ZTogZ24gfSksIHBuLmFwcGxlUGF5ID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJhcHBsZVBheVwiKTtcbiAgICB2YXIgdm4gPSBmdW5jdGlvbiAoKSB7IHZhciBlID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJwb3N0bWVzc2FnZVwiKSwgbiA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwidXRpbFwiKSwgdCA9IFwiXCIsIHIgPSB7IGVudmlyb25tZW50OiBcIlwiLCBiaWxsaW5nUmVxdWVzdEZsb3dJZDogXCJcIiB9LCBvID0geyBjdXN0b21lcjogXCJcIiwgbWFuZGF0ZTogXCJcIiwgYmFua19hY2NvdW50X2VuZGluZzogXCJcIiwgYmFua19hY2NvdW50X2hvbGRlcjogXCJcIiwgYmFua19uYW1lOiBcIlwiLCBjdXJyZW5jeTogXCJcIiB9LCBpID0gITEsIGEgPSBcImh0dHBzOi8vcGF5LmdvY2FyZGxlc3MuY29tL2JpbGxpbmcvc3RhdGljL2Ryb3Bpbi92Mi9pbml0aWFsaXNlLmpzXCI7IGUuc3Vic2NyaWJlKFwibG9hZGVkXCIsIChmdW5jdGlvbiAoZSkgeyB0ID0gZS5zZW5kZXIsIGkgfHwgXCJpbmxpbmVcIiA9PT0gZS5kaXNwbGF5TW9kZSB8fCBjKGEsIChmdW5jdGlvbiAoKSB7IGkgPSAhMDsgfSkpOyB9KSksIGUuc3Vic2NyaWJlKFwiTE9BRF9HT0NBUkRMRVNTX0RST1BJTlwiLCAoZnVuY3Rpb24gKG4pIHsgdCA9IG4uc2VuZGVyLCBpID8gZS5zZW5kKFwiR09DQVJETEVTU19EUk9QSU5fTE9BREVEXCIsIG51bGwsIHQpIDogYyhhLCAoZnVuY3Rpb24gKCkgeyBpID0gITAsIGUuc2VuZChcIkdPQ0FSRExFU1NfRFJPUElOX0xPQURFRFwiLCBudWxsLCB0KTsgfSkpOyB9KSksIGUuc3Vic2NyaWJlKFwiR09DQVJETEVTU19EUk9QSU5fTUFOREFURV9DUkVBVElPTl9JTklUXCIsIChmdW5jdGlvbiAoZSkgeyByID0gZS5wYXJhbXMsIGkgJiYgcygpOyB9KSk7IHZhciBzID0gZnVuY3Rpb24gKCkgeyB3aW5kb3cuR29DYXJkbGVzc0Ryb3Bpbi5jcmVhdGUoeyBiaWxsaW5nUmVxdWVzdEZsb3dJRDogci5iaWxsaW5nUmVxdWVzdEZsb3dJZCwgZW52aXJvbm1lbnQ6IHIuZW52aXJvbm1lbnQsIG9uU3VjY2VzczogZnVuY3Rpb24gKG4pIHsgdmFyIHIgPSBuLmxpbmtzLCBpID0gci5jdXN0b21lciwgYSA9IHIubWFuZGF0ZV9yZXF1ZXN0X21hbmRhdGUsIHMgPSBuLnJlc291cmNlcy5jdXN0b21lcl9iYW5rX2FjY291bnQsIGMgPSBzLmFjY291bnRfbnVtYmVyX2VuZGluZywgbCA9IHMuYWNjb3VudF9ob2xkZXJfbmFtZSwgdSA9IHMuYmFua19uYW1lLCBkID0gbi5tYW5kYXRlX3JlcXVlc3QuY3VycmVuY3k7IG8gPSB7IGN1c3RvbWVyOiBpLCBtYW5kYXRlOiBhLCBiYW5rX2FjY291bnRfZW5kaW5nOiBjLCBiYW5rX2FjY291bnRfaG9sZGVyOiBsLCBiYW5rX25hbWU6IHUsIGN1cnJlbmN5OiBkIH0sIGUuc2VuZChcIkdPQ0FSRExFU1NfRFJPUElOX01BTkRBVEVfQ1JFQVRJT05fQ09NUExFVEVcIiwgbywgdCk7IH0sIG9uRXhpdDogZnVuY3Rpb24gKG4pIHsgbiA/IGUuc2VuZChcInBheW1lbnQtZXJyb3JcIiwgeyBtZXNzYWdlOiBuIH0sIHQpIDogZS5zZW5kKFwiR09DQVJETEVTU19EUk9QSU5fRU5BQkxFX1BMVUdJTlwiLCBudWxsLCB0KTsgfSB9KS5vcGVuKCk7IH0sIGMgPSBmdW5jdGlvbiAoZSwgdCkgeyBuLmFkZFNjcmlwdChlLCB0KTsgfTsgcmV0dXJuIHsgbmFtZTogXCJnb0NhcmRsZXNzRHJvcGluXCIgfTsgfSgpO1xuICAgIHBuLmNvbnRhaW5lci5yZWdpc3RlcihcImdvQ2FyZGxlc3NEcm9waW5cIiwgeyB1c2VWYWx1ZTogdm4gfSksIHBuLmdvQ2FyZGxlc3NEcm9waW4gPSBwbi5jb250YWluZXIucmVzb2x2ZShcImdvQ2FyZGxlc3NEcm9waW5cIik7XG4gICAgdmFyIGhuID0gZnVuY3Rpb24gKCkgeyB2YXIgZSwgbiwgdCwgciA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwicG9zdG1lc3NhZ2VcIiksIG8gPSBwbi5jb250YWluZXIucmVzb2x2ZShcInV0aWxcIiksIGkgPSAhMTsgcmV0dXJuIHsgbmFtZTogXCJhcHBsZVBheUludGVncmF0aW9uU2VydmljZVwiLCBpbml0aWFsaXplOiBmdW5jdGlvbiAoKSB7IHZhciBhID0gZnVuY3Rpb24gKCkgeyBpID0gby5fX3Byb3RlY3RlZF9fLmlzQXBwbGVQYXlBbGxvd2VkKCksIHIuYnJvYWRjYXN0KFwiRVZFTlRfQVBQTEVfUEFZX0NBTl9NQUtFX1BBWU1FTlRTXCIsIHsgY2FuTWFrZVBheW1lbnRzOiBpIH0pOyB9OyByLnN1YnNjcmliZShcInByb3ZpZGVyLWNvbXBvbmVudC1pbml0aWF0ZWRcIiwgKGZ1bmN0aW9uICgpIHsgaSAmJiByLmJyb2FkY2FzdChcImFwcGxlLXBheS1pbml0XCIsIHt9KTsgfSkpLCByLnN1YnNjcmliZShcImluaXRQd0FwcGxlUGF5XCIsIChmdW5jdGlvbiAoKSB7IGEoKTsgfSkpLCByLnN1YnNjcmliZShcInN0YXJ0Q2hlY2tvdXRcIiwgKGZ1bmN0aW9uICgpIHsgYSgpOyB9KSksIHIuc3Vic2NyaWJlKFwicGF5LXNlc3Npb24tcmVjZWl2ZWRcIiwgKGZ1bmN0aW9uIChlKSB7IHRyeSB7XG4gICAgICAgICAgICBuLmNvbXBsZXRlTWVyY2hhbnRWYWxpZGF0aW9uKGUucGFyYW1zLmFwcGxlUGF5U2Vzc2lvbik7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHIuYnJvYWRjYXN0KFwicGF5bWVudC1lcnJvclwiLCB7IGVycm9yQ29kZTogMTExLCBlcnJvcnM6IGUgfSk7XG4gICAgICAgIH0gfSkpLCByLnN1YnNjcmliZShcImFwcGxlLXBheS1jb21wbGV0ZS1wYXltZW50XCIsIChmdW5jdGlvbiAoZSkgeyB2YXIgcjsgKHIgPSBlLnBhcmFtcy50ZXJtSWQsIHQgJiYgdCAhPT0gcikgfHwgbi5jb21wbGV0ZVBheW1lbnQoZS5wYXJhbXMuc3RhdHVzLCBlLnBhcmFtcy5lcnJvcnMpOyB9KSksIHIuc3Vic2NyaWJlKFwic3RhcnQtcHVyY2hhc2VcIiwgKGZ1bmN0aW9uIChvKSB7IHQgPSBvLnBhcmFtcy50ZXJtSWQgfHwgXCJcIiwgZSA9IG8ucGFyYW1zLnJlc291cmNlTmFtZSwgbiA9IG5ldyB3aW5kb3cuQXBwbGVQYXlTZXNzaW9uKDMsIGZ1bmN0aW9uIChlKSB7IHJldHVybiB7IGNvdW50cnlDb2RlOiBlLnBhcmFtcy5jb3VudHJ5Q29kZSwgY3VycmVuY3lDb2RlOiBlLnBhcmFtcy5jdXJyZW5jeUNvZGUsIHN1cHBvcnRlZE5ldHdvcmtzOiBbXCJ2aXNhXCIsIFwibWFzdGVyQ2FyZFwiLCBcImFtZXhcIiwgXCJkaXNjb3ZlclwiXSwgbWVyY2hhbnRDYXBhYmlsaXRpZXM6IFtcInN1cHBvcnRzM0RTXCJdLCByZXF1aXJlZFNoaXBwaW5nQ29udGFjdEZpZWxkczogZS5wYXJhbXMucmVxdWlyZWRTaGlwcGluZ0NvbnRhY3RGaWVsZHMgfHwgW10sIHJlcXVpcmVkQmlsbGluZ0NvbnRhY3RGaWVsZHM6IGUucGFyYW1zLnJlcXVpcmVkQmlsbGluZ0NvbnRhY3RGaWVsZHMgfHwgW10sIHRvdGFsOiB7IGxhYmVsOiBlLnBhcmFtcy5yZXNvdXJjZU5hbWUsIGFtb3VudDogZS5wYXJhbXMuY2hhcmdlQW1vdW50IH0gfTsgfShvKSksIG4ub252YWxpZGF0ZW1lcmNoYW50ID0gZnVuY3Rpb24gKG4pIHsgdmFyIG8sIGk7IG8gPSBuLnZhbGlkYXRpb25VUkwsIGkgPSB7IHZhbGlkYXRpb25Vcmw6IG8sIGRpc3BsYXllZENhcHRpb246IGUsIHVzZXJUb2tlbjogbnVsbCwgdXNlclByb3ZpZGVyOiBudWxsLCB1c2VyUmVmOiBudWxsLCBqYW5yYWluQ2FwdHVyZVRva2VuOiBudWxsLCBkb21haW5OYW1lOiB3aW5kb3cubG9jYXRpb24uaG9zdG5hbWUsIGFpZDogbnVsbCwgdGVybUlkOiB0IH0sIHIuYnJvYWRjYXN0KFwiYXBwbGUtcGF5LXBheS1zZXNzaW9uLXJlcXVlc3RcIiwgaSk7IH0sIG4ub25wYXltZW50YXV0aG9yaXplZCA9IGZ1bmN0aW9uIChlKSB7IHRyeSB7XG4gICAgICAgICAgICByLmJyb2FkY2FzdChcImFwcGxlLXBheS1wYXltZW50LWF1dGhvcml6ZWRcIiwgeyBwYXltZW50RGF0YTogZS5wYXltZW50LCB0ZXJtSWQ6IHQgfSk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHIuYnJvYWRjYXN0KFwicGF5bWVudC1lcnJvclwiLCB7IGVycm9yQ29kZTogMTEwLCBlcnJvcjogZSB9KTtcbiAgICAgICAgfSB9OyB0cnkge1xuICAgICAgICAgICAgbi5iZWdpbigpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICByLmJyb2FkY2FzdChcInBheW1lbnQtZXJyb3JcIiwgeyBlcnJvckNvZGU6IDExMiwgZXJyb3I6IGUsIHRlcm1JZDogdCB9KTtcbiAgICAgICAgfSB9KSksIHIuc3Vic2NyaWJlKFwiYWJvcnQtYXBwbGUtcGF5LXNlc3Npb25cIiwgKGZ1bmN0aW9uICgpIHsgIWZ1bmN0aW9uICgpIHsgdHJ5IHtcbiAgICAgICAgICAgIG4uYWJvcnQoKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgby5lcnJvcihlKTtcbiAgICAgICAgfSB9KCk7IH0pKTsgfSwgX19wcm90ZWN0ZWRfXzogeyBhcHBsZVBheUNhbk1ha2VQYXltZW50c1dpdGhBY3RpdmVDYXJkOiBmdW5jdGlvbiAoKSB7IHZhciBlID0geyB0aGVuOiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gZShudWxsKTsgfSwgY2F0Y2g6IGZ1bmN0aW9uICgpIHsgfSB9OyByZXR1cm4gcG4uYXBwbGVQYXlNZXJjaGFudElkICYmIG8uX19wcm90ZWN0ZWRfXy5pc0FwcGxlUGF5QWxsb3dlZCgpICYmIHBuLmFwcGxlUGF5TWVyY2hhbnRJZCA/IHdpbmRvdy5BcHBsZVBheVNlc3Npb24uY2FuTWFrZVBheW1lbnRzV2l0aEFjdGl2ZUNhcmQocG4uYXBwbGVQYXlNZXJjaGFudElkKSA6IGU7IH0gfSB9OyB9KCk7XG4gICAgcG4uY29udGFpbmVyLnJlZ2lzdGVyKFwiYXBwbGVQYXlJbnRlZ3JhdGlvblNlcnZpY2VcIiwgeyB1c2VWYWx1ZTogaG4gfSksIHBuLmFwcGxlUGF5SW50ZWdyYXRpb25TZXJ2aWNlID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJhcHBsZVBheUludGVncmF0aW9uU2VydmljZVwiKTtcbiAgICB2YXIgd24gPSBmdW5jdGlvbiAoKSB7IHZhciBlLCBuLCB0ID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJwb3N0bWVzc2FnZVwiKSwgciA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwidXRpbFwiKSwgbyA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwiYWpheFwiKSwgaSA9IFwiZGF0YXRyYW5zLWFwcGxlcGF5LWJ1dHRvblwiLCBhID0gbnVsbCwgcyA9IG51bGwsIGMgPSAhMSwgbCA9IGZ1bmN0aW9uIChuKSB7IGUgPSBuLnNlbmRlciwgbSgpLnRoZW4oZykudGhlbih2KTsgfSwgdSA9IGZ1bmN0aW9uIChuKSB7IHZhciByID0gbnVsbDsgbiB8fCAociA9IHsgbWVzc2FnZTogbiB9KSwgdC5zZW5kKFwiZGF0YXRyYW5zLWFwcGxlcGF5LXNlcnZpY2UtZXJyb3JcIiwgciwgZSk7IH0sIGQgPSBmdW5jdGlvbiAoZSkgeyBuID0gZS5wYXJhbXMsIG0oKS50aGVuKGcpLnRoZW4ocCkuY2F0Y2goKGZ1bmN0aW9uICgpIHsgdShcIkFwcGxlIFBheSBidXR0b24gaW5pdCBlcnJvclwiKTsgfSkpOyB9LCBwID0gZnVuY3Rpb24gKCkgeyBQYXltZW50QnV0dG9uLmluaXQobi5hcHBsZVBheUNvbmZpZyk7IH0sIGYgPSBmdW5jdGlvbiAoKSB7IHZhciBlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaSk7IG51bGwgIT09IGUgJiYgbnVsbCAhPT0gZS5maXJzdEVsZW1lbnRDaGlsZCA/IGUuZmlyc3RFbGVtZW50Q2hpbGQuY2xpY2soKSA6IHUoXCJDb3VsZCBub3QgcHJvY2VzcyB3aXRoIEFwcGxlIFBheS4gUGxlYXNlLCB0cnkgYWdhaW4uXCIpOyB9LCBtID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gbnVsbCAhPT0gcyA/IHMgOiBzID0gbmV3IFByb21pc2UoKGZ1bmN0aW9uIChlKSB7IG8ucmVxdWVzdCh7IHVybDogdHAuZ2V0QXBpRW5kcG9pbnQoKSArIFwiL2Fub24vZGF0YXRyYW5zL2FwcGxlcGF5L2NvbmZpZ1wiLCBkYXRhOiB7IGFpZDogdHAuYWlkIH0sIGRhdGFUeXBlOiBcImpzb25wXCIsIGpzb25wQ2FsbGJhY2s6IFwianNvbnBDYWxsYmFja1wiLCBzdWNjZXNzOiBmdW5jdGlvbiAobikgeyB2YXIgdCA9IG4uY29uZmlnOyBlKHQudXJsKTsgfSB9KTsgfSkpOyB9LCBnID0gZnVuY3Rpb24gKGUpIHsgaWYgKG51bGwgIT09IGEpXG4gICAgICAgIHJldHVybiBhOyB2YXIgbiA9IFwiZGF0YXRyYW5zLWFwcGxlLXBheVwiOyBpZiAoIWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG4pKSB7XG4gICAgICAgIHZhciB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNjcmlwdFwiKTtcbiAgICAgICAgcmV0dXJuIHQuc3JjID0gZSwgdC5pZCA9IG4sIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodCksIGEgPSBuZXcgUHJvbWlzZSgoZnVuY3Rpb24gKGUpIHsgdC5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7IGUobnVsbCk7IH07IH0pKTtcbiAgICB9IH0sIHYgPSBmdW5jdGlvbiAoKSB7IGMgfHwgKFBheW1lbnRCdXR0b24ub24oXCJpbml0XCIsIGgpLCBQYXltZW50QnV0dG9uLm9uKFwiY3JlYXRlXCIsIHcpLCBQYXltZW50QnV0dG9uLm9uKFwidG9rZW5cIiwgeSksIFBheW1lbnRCdXR0b24ub24oXCJhYm9ydFwiLCAoZnVuY3Rpb24gKCkgeyB1KG51bGwpOyB9KSksIFBheW1lbnRCdXR0b24ub24oXCJ1bnN1cHBvcnRlZFwiLCAoZnVuY3Rpb24gKCkgeyB1KFwiTm8gcGF5bWVudCBtZXRob2QgaXMgc3VwcG9ydGVkXCIpOyB9KSksIFBheW1lbnRCdXR0b24ub24oXCJlcnJvclwiLCAoZnVuY3Rpb24gKGUpIHsgZSAmJiAoci5lcnJvcihcImRhdGF0cmFuc0FwcGxlUGF5SW50ZWdyYXRpb25TZXJ2aWNlLiBhcHBsZSBwYXkgYnV0dG9uIGVycm9yOiBcIiArIGUpLCB1KFwiQ291bGQgbm90IHByb2Nlc3Mgd2l0aCBBcHBsZSBQYXkuIFBsZWFzZSwgdHJ5IGFnYWluLlwiKSk7IH0pKSwgYyA9ICEwKTsgfSwgaCA9IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSBiKCk7IFBheW1lbnRCdXR0b24uY3JlYXRlKGUsIG4ucGF5bWVudENvbmZpZykuY2F0Y2goKGZ1bmN0aW9uICgpIHsgdShcIkFwcGxlIFBheSBidXR0b24gY3JlYXRlIGVycm9yXCIpOyB9KSk7IH0sIHcgPSBmdW5jdGlvbiAoKSB7IHIubG9nKFwiZGF0YXRyYW5zQXBwbGVQYXlJbnRlZ3JhdGlvblNlcnZpY2UgcGF5bWVudEJ1dHRvbk9uQ3JlYXRlXCIpLCB0LnNlbmQoXCJkYXRhdHJhbnMtYXBwbGVwYXktc2VydmljZS1yZWFkeVwiLCBudWxsLCBlKTsgfSwgeSA9IGZ1bmN0aW9uIChuKSB7IHIubG9nKFwiZGF0YXRyYW5zQXBwbGVQYXlJbnRlZ3JhdGlvblNlcnZpY2UgcGF5bWVudEJ1dHRvbk9uVG9rZW5cIiksIHQuc2VuZChcImRhdGF0cmFucy1hcHBsZXBheS1zZXJ2aWNlLXRva2VuXCIsIG4udG9rZW4uZGV0YWlscy50b2tlbiwgZSk7IH0sIGIgPSBmdW5jdGlvbiAoKSB7IHZhciBlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaSk7IHJldHVybiBudWxsID09PSBlICYmICgoZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIikpLnNldEF0dHJpYnV0ZShcImlkXCIsIGkpLCBlLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIiwgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChlKSksIGUuaW5uZXJIVE1MID0gXCJcIiwgZTsgfTsgcmV0dXJuIHsgbmFtZTogXCJkYXRhdHJhbnNBcHBsZVBheUludGVncmF0aW9uU2VydmljZVwiLCBpbml0aWFsaXplOiBmdW5jdGlvbiAoKSB7IHIuX19wcm90ZWN0ZWRfXy5pc0FwcGxlUGF5QWxsb3dlZCgpICYmICh0LnN1YnNjcmliZShcImRhdGF0cmFucy1hcHBsZXBheS1sb2FkZWRcIiwgbCksIHQuc3Vic2NyaWJlKFwiZGF0YXRyYW5zLWFwcGxlcGF5LWNoZWNrb3V0LWluaXRpYXRlLXB1cmNoYXNlXCIsIGQpLCB0LnN1YnNjcmliZShcImRhdGF0cmFucy1hcHBsZXBheS1tYWtlLXB1cmNoYXNlXCIsIGYpKTsgfSB9OyB9KCk7XG4gICAgcG4uY29udGFpbmVyLnJlZ2lzdGVyKFwiZGF0YXRyYW5zQXBwbGVQYXlJbnRlZ3JhdGlvblNlcnZpY2VcIiwgeyB1c2VWYWx1ZTogd24gfSksIHBuLmRhdGF0cmFuc0FwcGxlUGF5SW50ZWdyYXRpb25TZXJ2aWNlID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJkYXRhdHJhbnNBcHBsZVBheUludGVncmF0aW9uU2VydmljZVwiKTtcbiAgICB2YXIgeW4gPSBmdW5jdGlvbiAoKSB7IHZhciBlLCBuID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJwb3N0bWVzc2FnZVwiKSwgdCA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwidXRpbFwiKSwgciA9IG51bGwsIG8gPSBudWxsLCBpID0gITEsIGEgPSBcIlwiOyBuLnN1YnNjcmliZShcInN0cmlwZS1hcHBsZXBheS1pbml0aWFsaXplZFwiLCAoZnVuY3Rpb24gKCkgeyBzKCk7IH0pKSwgbi5zdWJzY3JpYmUoXCJzdHJpcGUtYXBwbGVwYXktaW5pdGlhdGUtcHVyY2hhc2VcIiwgKGZ1bmN0aW9uIChlKSB7IHMoKS50aGVuKChmdW5jdGlvbiAoKSB7IHZhciBuID0gZS5wYXJhbXMuYXBpS2V5OyBudWxsID09PSByICYmIChyID0gd2luZG93LlN0cmlwZShuKSk7IHZhciB0ID0gZS5wYXJhbXMucGF5bWVudFJlcXVlc3RQYXlsb2FkOyByZXR1cm4gci5wYXltZW50UmVxdWVzdCh0KTsgfSkpLnRoZW4oKGZ1bmN0aW9uIChlKSB7IHJldHVybiBvID0gZSwgZS5jYW5NYWtlUGF5bWVudCgpOyB9KSkudGhlbigoZnVuY3Rpb24gKGUpIHsgaSA9IGUgJiYgZS5hcHBsZVBheSwgbi5icm9hZGNhc3QoXCJzdHJpcGUtYXBwbGVwYXktaW5pdGlhdGUtcHVyY2hhc2UtY29tcGxldGVcIiwgeyBjYW5NYWtlUGF5bWVudDogaSB9KSwgaSAmJiAoby5vbihcImNhbmNlbFwiLCAoZnVuY3Rpb24gKCkgeyBuLmJyb2FkY2FzdChcInN0cmlwZS1hcHBsZXBheS1zdGFydC1wdXJjaGFzZS1jb21wbGV0ZVwiICsgYSwgeyBzdGF0dXM6IFwiZmFpbFwiIH0pOyB9KSksIG8ub24oXCJwYXltZW50bWV0aG9kXCIsIChmdW5jdGlvbiAoZSkgeyB2YXIgdCA9IGUucGF5bWVudE1ldGhvZC5iaWxsaW5nX2RldGFpbHMuYWRkcmVzcywgciA9IHsgY291bnRyeUNvZGU6IHQuY291bnRyeSwgemlwQ29kZTogdC5wb3N0YWxfY29kZSwgYmlsbGluZ1ppcENvZGU6IHQucG9zdGFsX2NvZGUgfSwgbyA9IGUucGF5bWVudE1ldGhvZC5pZDsgbi5icm9hZGNhc3QoXCJzdHJpcGUtYXBwbGVwYXktc3RhcnQtcHVyY2hhc2UtY29tcGxldGVcIiArIGEsIHsgc3RhdHVzOiBcInN1Y2Nlc3NcIiwgcGF5bWVudE1ldGhvZElkOiBvLCBwYXllckVtYWlsOiBlLnBheWVyRW1haWwsIGJpbGxpbmdBZGRyZXNzOiByIH0pLCBlLmNvbXBsZXRlKFwic3VjY2Vzc1wiKTsgfSkpKTsgfSkpLmNhdGNoKChmdW5jdGlvbiAoZSkgeyB0LmVycm9yKGUpLCBuLmJyb2FkY2FzdChcInN0cmlwZS1hcHBsZXBheS1pbml0aWF0ZS1wdXJjaGFzZS1jb21wbGV0ZVwiLCB7IGNhbk1ha2VQYXltZW50OiAhMSB9KTsgfSkpOyB9KSksIG4uc3Vic2NyaWJlKFwic3RyaXBlLWFwcGxlcGF5LXN0YXJ0LXB1cmNoYXNlXCIsIChmdW5jdGlvbiAoZSkgeyBhID0gZS5wYXJhbXMudGVybUlkIHx8IFwiXCI7IHZhciBuID0gZS5wYXJhbXMucGF5bWVudFJlcXVlc3RQYXlsb2FkOyBvLnVwZGF0ZShuKSwgby5zaG93KCk7IH0pKSwgbi5zdWJzY3JpYmUoXCJzdHJpcGUtYXBwbGVwYXktYWJvcnQtcmVxdWVzdFwiLCAoZnVuY3Rpb24gKCkgeyBvICYmIG8uYWJvcnQoKSwgbi5icm9hZGNhc3QoXCJzdHJpcGUtYXBwbGVwYXktcmVvcGVuLXJlcXVlc3RcIik7IH0pKTsgdmFyIHMgPSBmdW5jdGlvbiAoKSB7IGlmIChudWxsICE9IGUpXG4gICAgICAgIHJldHVybiBlOyBpZiAoIWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic3RyaXBlLmpzXCIpKSB7XG4gICAgICAgIHZhciBuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNjcmlwdFwiKTtcbiAgICAgICAgcmV0dXJuIG4uc3JjID0gXCJodHRwczovL2pzLnN0cmlwZS5jb20vdjMvXCIsIG4uaWQgPSBcInN0cmlwZS5qc1wiLCBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKG4pLCBlID0gbmV3IFByb21pc2UoKGZ1bmN0aW9uIChlKSB7IG4ub25sb2FkID0gZnVuY3Rpb24gKCkgeyBlKG51bGwpOyB9OyB9KSk7XG4gICAgfSB9OyByZXR1cm4geyBuYW1lOiBcInN0cmlwZUFwcGxlUGF5SW50ZWdyYXRpb25TZXJ2aWNlXCIgfTsgfSgpO1xuICAgIHBuLmNvbnRhaW5lci5yZWdpc3RlcihcInN0cmlwZUFwcGxlUGF5SW50ZWdyYXRpb25TZXJ2aWNlXCIsIHsgdXNlVmFsdWU6IHluIH0pLCBwbi5zdHJpcGVBcHBsZVBheUludGVncmF0aW9uU2VydmljZSA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwic3RyaXBlQXBwbGVQYXlJbnRlZ3JhdGlvblNlcnZpY2VcIik7XG4gICAgdmFyIGJuID0gZnVuY3Rpb24gKCkgeyB2YXIgZSA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwicG9zdG1lc3NhZ2VcIiksIG4gPSBwbi5jb250YWluZXIucmVzb2x2ZShcInV0aWxcIik7IGUuc3Vic2NyaWJlKFwib2JpLWhhbmRsZS0zZHMtY2hhbGxlbmdlXCIsIChmdW5jdGlvbiAoZSkgeyB2YXIgciA9IGUucGFyYW1zOyBpZiAod2luZG93Lm9iaWNrKVxuICAgICAgICB0KHIpO1xuICAgIGVsc2Uge1xuICAgICAgICBpZiAoLTEgPT09IFtcImh0dHBzOi8vanNsLnFhdC5vYmkuYW9sLmNvbS9vYmlwbXNlcnZpY2Uvb2JpY2sudW1kLmpzXCIsIFwiaHR0cHM6Ly9qc2wucHJvZC5vYmkuYW9sLmNvbS9vYmlwbXNlcnZpY2Uvb2JpY2sudW1kLmpzXCJdLmluZGV4T2Yoci5vYmlja1VybCkpXG4gICAgICAgICAgICByZXR1cm4gdm9pZCBuLmVycm9yKFwiVW50cnVzdGVkIG9iaWNrVXJsIGRldGVjdGVkOiBcIiArIHIub2JpY2tVcmwpO1xuICAgICAgICB2YXIgbyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzY3JpcHRcIik7XG4gICAgICAgIG8uc3JjID0gci5vYmlja1VybCwgby5pZCA9IFwib2JpY2suanNcIiwgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChvKSwgby5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7IG4ubG9nKG8uaWQgKyBcIiBvbmxvYWRcIiksIHQocik7IH07XG4gICAgfSB9KSk7IHZhciB0ID0gZnVuY3Rpb24gKHQpIHsgaWYgKHQuc3RlcFVwVXJsICYmIDAgIT09IHQuc3RlcFVwVXJsLmluZGV4T2YoXCJodHRwXCIpKVxuICAgICAgICBuLmVycm9yKFwiVGhlcmUgaXMgbm8gbGluayBpbiBwYXJhbXMuc3RlcFVwVXJsIGZvciBPQklcIik7XG4gICAgZWxzZSB7XG4gICAgICAgIHZhciByID0geyBzdGVwVXBVcmw6IHQuc3RlcFVwVXJsLCBqd3Q6IHQuand0LCB0cmFuc2FjdGlvbklkOiB0LnRyYW5zYWN0aW9uSWQsIHpJbmRleDogdC56SW5kZXggfTtcbiAgICAgICAgd2luZG93Lm9iaWNrLmhhbmRsZTNkc0NoYWxsZW5nZShyKS50aGVuKChmdW5jdGlvbiAodCkgeyBuLmRlYnVnKHQpLCBlLmJyb2FkY2FzdChcIm9iaS0zZHMtY2hhbGxlbmdlLWNvbXBsZXRlXCIsIHsgdGhyZWVEU1RyYW5zYWN0aW9uSWQ6IHQudGhyZWVEU1RyYW5zYWN0aW9uSWQsIGNoYWxsZW5nZVN0YXR1czogdC5jaGFsbGVuZ2VTdGF0dXMgfSk7IH0pKS5jYXRjaCgoZnVuY3Rpb24gKHQpIHsgbi5lcnJvcih0KSwgZS5icm9hZGNhc3QoXCJvYmktM2RzLWNoYWxsZW5nZS1jb21wbGV0ZVwiLCB7IGVycm9yOiBcImNoYWxsZW5nZS1lcnJvclwiLCBwYXlsb2FkOiB0IH0pOyB9KSk7XG4gICAgfSB9OyByZXR1cm4geyBuYW1lOiBcIm9iaTNEU0NoYWxsZW5nZVwiIH07IH0oKTtcbiAgICBwbi5jb250YWluZXIucmVnaXN0ZXIoXCJvYmkzRFNDaGFsbGVuZ2VcIiwgeyB1c2VWYWx1ZTogYm4gfSksIHBuLm9iaTNEU0NoYWxsZW5nZSA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwib2JpM0RTQ2hhbGxlbmdlXCIpO1xuICAgIHZhciBrbiA9IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSBwbi5jb250YWluZXIucmVzb2x2ZShcImpxVXRpbHNcIiksIG4gPSBwbi5jb250YWluZXIucmVzb2x2ZShcInV0aWxcIiksIHQgPSBwbi5jb250YWluZXIucmVzb2x2ZShcImFwaVwiKSwgciA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwidXNlclwiKSwgbyA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwicGlhbm9JZFwiKSwgaSA9IHsgZGlzcGxheU1vZGU6IFwiaW5saW5lXCIsIGNvbnRhaW5lclNlbGVjdG9yOiBcImJvZHlcIiwgbG9naW5TdWNjZXNzOiBkIH0sIGEgPSBcInJlYWRlcl9pZFwiLCBzID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gXCIvXCIgKyBwbi5haWQgKyBcIi9leGVjdXRpb24vYW1wXCI7IH0sIGMgPSBmdW5jdGlvbiAoKSB7IHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gbi5nZXRRdWVyeVBhcmFtQnlOYW1lKFwicmV0dXJuXCIpICsgXCIjc3VjY2Vzcz10cnVlXCI7IH07IHZhciBsID0gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIC9eXFx3KyQvaS50ZXN0KGUpOyB9LCB1ID0gZnVuY3Rpb24gKGUpIHsgdmFyIHIgPSB7fTsgaWYgKHIucmVhZGVyX2lkID0gbi5nZXRRdWVyeVBhcmFtQnlOYW1lKGEpLCByLnJlYWRlcl9pZCkge1xuICAgICAgICB2YXIgbyA9IHBuLmdldEV4cGVyaWVuY2VFbmRwb2ludCghMSk7XG4gICAgICAgIHQuY2FsbEFwaShzKCkgKyBcIi9sb2dvdXRcIiwgciwgZSwgbywgITEsICEwKTtcbiAgICB9XG4gICAgZWxzZVxuICAgICAgICBuLmxvZyhcInJlYWRlcl9pZCBjYW5ub3QgYmUgZW1wdHlcIik7IH07IGZ1bmN0aW9uIGQoZSwgcikgeyB2YXIgbyA9IGUgfHwge307IGlmIChvLnJlYWRlcl9pZCB8fCAoby5yZWFkZXJfaWQgPSBuLmdldFF1ZXJ5UGFyYW1CeU5hbWUoYSkpLCBvLnJlYWRlcl9pZCkge1xuICAgICAgICB2YXIgaSA9IHBuLmdldEV4cGVyaWVuY2VFbmRwb2ludCghMSk7XG4gICAgICAgIHQuY2FsbEFwaShzKCkgKyBcIi9sb2dpblwiLCBvLCByLCBpLCAhMSwgITApO1xuICAgIH1cbiAgICBlbHNlXG4gICAgICAgIG4ubG9nKFwicmVhZGVyX2lkIGNhbm5vdCBiZSBlbXB0eVwiKTsgfSByZXR1cm4geyBuYW1lOiBcImFtcFwiLCBzaG93TG9naW46IGZ1bmN0aW9uICh0KSB7IHQgPSB0IHx8IHt9OyB2YXIgYSA9IHIuZ2V0UHJvdmlkZXIoKTsgaWYgKGEuZ2V0TmFtZSgpID09PSBvLmdldE5hbWUoKSkge1xuICAgICAgICAgICAgdmFyIHM7XG4gICAgICAgICAgICBzID0gdC5sb2dpblN1Y2Nlc3MgJiYgZS5pc0Z1bmN0aW9uKHQubG9naW5TdWNjZXNzKSA/IHQubG9naW5TdWNjZXNzIDogYztcbiAgICAgICAgICAgIHZhciBsID0gZnVuY3Rpb24gKCkgeyBkKHt9LCBzKTsgfSwgdSA9IE9iamVjdC5hc3NpZ24oe30sIGksIHQpO1xuICAgICAgICAgICAgci5pc1VzZXJWYWxpZCgpID8gbCgpIDogKHUubG9naW5TdWNjZXNzID0gbCwgby5zaG93KHUpKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICBuLmxvZyhcIkN1cnJlbnQgdXNlciBwcm92aWRlclwiICsgYS5uYW1lICsgXCIgaXMgbm90IGFsbG93ZWQgZm9yIGFtcFwiKTsgfSwgbG9nb3V0OiBmdW5jdGlvbiAobikgeyBuID0gZS5pc0Z1bmN0aW9uKG4pID8gbiA6IGMsIHIuZ2V0UHJvdmlkZXIoKS5nZXROYW1lKCkgPT09IG8uZ2V0TmFtZSgpID8gby5sb2dvdXQoKGZ1bmN0aW9uICgpIHsgdShuKTsgfSkpIDogdShuKTsgfSwgbG9naW46IGZ1bmN0aW9uICh0KSB7IHZhciBpID0gci5nZXRQcm92aWRlcigpLmdldE5hbWUoKTsgaSA9PT0gby5nZXROYW1lKCkgJiYgKHQgPSB0ID8gZS5kZWVwRXh0ZW5kKHt9LCB0LCB7IHVzZXJQcm92aWRlcjogaSB9KSA6IHsgdXNlclByb3ZpZGVyOiBpIH0pOyB2YXIgYSA9IHsgdXNlcl90cmFuc2llbnQ6ICEwLCB1c2VyX3Byb3ZpZGVyOiBcInB1Ymxpc2hlcl91c2VyXCIgfTsgaWYgKHQgJiYgdC5yZWFkZXJJZCAmJiAoYS5yZWFkZXJfaWQgPSB0LnJlYWRlcklkKSwgdCAmJiB0LnVzZXJUb2tlbiAmJiAoYS51c2VyX3Rva2VuID0gdC51c2VyVG9rZW4pLCB0ICYmIHQudXNlclByb3ZpZGVyICYmIChhLnVzZXJfcHJvdmlkZXIgPSB0LnVzZXJQcm92aWRlciwgYS51c2VyX3RyYW5zaWVudCA9ICExKSwgIWZ1bmN0aW9uICh0KSB7IGlmICh0ICYmIHQudXNlclN0YXRlICYmIGUuaXNQbGFpbk9iamVjdCh0LnVzZXJTdGF0ZSkpIHtcbiAgICAgICAgICAgIHZhciByID0gT2JqZWN0LmtleXModC51c2VyU3RhdGUpO1xuICAgICAgICAgICAgaWYgKHIuZmlsdGVyKGwpLmxlbmd0aCAhPT0gci5sZW5ndGgpXG4gICAgICAgICAgICAgICAgcmV0dXJuIG4uZXJyb3IoXCJ1c2VyX3N0YXRlIGFjY2VwdCBvbmx5IGNvbnRhaW4gbGV0dGVycywgbnVtYmVycyBhbmQgdW5kZXJzY29yZVwiKSwgITE7XG4gICAgICAgIH0gcmV0dXJuICEwOyB9KHQpKVxuICAgICAgICAgICAgcmV0dXJuICExOyB0ICYmIHQudXNlclN0YXRlICYmIChhLnVzZXJfc3RhdGUgPSBKU09OLnN0cmluZ2lmeSh0LnVzZXJTdGF0ZSkpOyBkKGEsIChmdW5jdGlvbiAobikgeyAwID09PSBuLmNvZGUgPyB0LmxvZ2luU3VjY2VzcyAmJiBlLmlzRnVuY3Rpb24odC5sb2dpblN1Y2Nlc3MpICYmIHQubG9naW5TdWNjZXNzKCkgOiB0LmxvZ2luRmFpbCAmJiBlLmlzRnVuY3Rpb24odC5sb2dpbkZhaWwpICYmIHQubG9naW5GYWlsKCk7IH0pKTsgfSB9OyB9KCk7XG4gICAgcG4uY29udGFpbmVyLnJlZ2lzdGVyKFwiYW1wXCIsIHsgdXNlVmFsdWU6IGtuIH0pLCBwbi5hbXAgPSBwbi5jb250YWluZXIucmVzb2x2ZShcImFtcFwiKTtcbiAgICB2YXIgX24gPSBmdW5jdGlvbiAoKSB7IHZhciBlLCBuID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJwb3N0bWVzc2FnZVwiKSwgdCA9IFt7IHJlc291cmNlUmVnRXhwOiBuZXcgUmVnRXhwKFwiL2NoZWNrb3V0L29mZmVyL3Nob3dcIiksIGxhYmVsOiBcInNob3dPZmZlclwiIH0sIHsgcmVzb3VyY2VSZWdFeHA6IG5ldyBSZWdFeHAoXCJ0aW55cGFzcy5taW4uanMkXCIpLCBsYWJlbDogXCJ0aW55cGFzc01pbkpTXCIgfSwgeyByZXNvdXJjZVJlZ0V4cDogbmV3IFJlZ0V4cChcIi94YnVpbGRlci9leHBlcmllbmNlL2V4ZWN1dGVcIiksIGxhYmVsOiBcImV4cGVyaWVuY2VFeGVjdXRlXCIgfV0sIHIgPSAhMSwgbyA9IFtdOyBmdW5jdGlvbiBpKGUpIHsgZS5mb3JFYWNoKChmdW5jdGlvbiAoZSkgeyAhZnVuY3Rpb24gKGUpIHsgaWYgKCFmdW5jdGlvbiAoZSkgeyByZXR1cm4gdC5zb21lKChmdW5jdGlvbiAobikgeyByZXR1cm4gZS5uYW1lLm1hdGNoKG4ucmVzb3VyY2VSZWdFeHApOyB9KSk7IH0oZSkpXG4gICAgICAgIHJldHVybjsgIWZ1bmN0aW9uIChlKSB7IGlmICghYSgpKVxuICAgICAgICByZXR1cm4gdm9pZCBvLnB1c2goZSk7IG8ucHVzaChlKSwgcygpOyB9KGUpOyB9KGUpOyB9KSk7IH0gZnVuY3Rpb24gYSgpIHsgcmV0dXJuIHIgJiYgZTsgfSBmdW5jdGlvbiBzKCkgeyBhKCkgJiYgKG8uZm9yRWFjaCgoZnVuY3Rpb24gKHQpIHsgbi5zZW5kKFwiRVZFTlRfVFBfUEVSRk9STUFOQ0VfREFUQVwiLCB7IGVudHJ5OiB0IH0sIGUpOyB9KSksIG8gPSBbXSk7IH0gcmV0dXJuIGZ1bmN0aW9uICgpIHsgaWYgKHdpbmRvdy5wZXJmb3JtYW5jZSAmJiB3aW5kb3cuUGVyZm9ybWFuY2VPYnNlcnZlciAmJiBcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIHBlcmZvcm1hbmNlLmdldEVudHJpZXMpIHtcbiAgICAgICAgdmFyIHQgPSB3aW5kb3cuUGVyZm9ybWFuY2VPYnNlcnZlci5wcm90b3R5cGUub2JzZXJ2ZTtcbiAgICAgICAgd2luZG93LlBlcmZvcm1hbmNlT2JzZXJ2ZXIucHJvdG90eXBlLm9ic2VydmUgPSBmdW5jdGlvbiAoKSB7IGZvciAodmFyIGUgPSBbXSwgbiA9IDA7IG4gPCBhcmd1bWVudHMubGVuZ3RoOyBuKyspXG4gICAgICAgICAgICBlW25dID0gYXJndW1lbnRzW25dOyB0cnkge1xuICAgICAgICAgICAgdC5hcHBseSh0aGlzLCBlKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkgeyB9IH0sIG4uc3Vic2NyaWJlKFwiRVZFTlRfTE9HR0VSX1JFQURZXCIsIChmdW5jdGlvbiAobikgeyBlID0gbi5zZW5kZXIsIHIgPSAhMCwgcygpOyB9KSksIGkocGVyZm9ybWFuY2UuZ2V0RW50cmllcygpKSwgbmV3IFBlcmZvcm1hbmNlT2JzZXJ2ZXIoKGZ1bmN0aW9uIChlKSB7IGkoZS5nZXRFbnRyaWVzKCkpOyB9KSkub2JzZXJ2ZSh7IGVudHJ5VHlwZXM6IFtcIm1lYXN1cmVcIiwgXCJyZXNvdXJjZVwiXSB9KTtcbiAgICB9IH0oKSwgeyBuYW1lOiBcInBlcmZvcm1hbmNlTWV0cmljc1wiIH07IH0oKTtcbiAgICBwbi5jb250YWluZXIucmVnaXN0ZXIoXCJwZXJmb3JtYW5jZU1ldHJpY3NcIiwgeyB1c2VWYWx1ZTogX24gfSksIHBuLnBlcmZvcm1hbmNlTWV0cmljcyA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwicGVyZm9ybWFuY2VNZXRyaWNzXCIpO1xuICAgIHZhciBDbiA9IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSBwbi5jb250YWluZXIucmVzb2x2ZShcImFwaVwiKSwgbiA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwicGlhbm9JZFwiKTsgcmV0dXJuIHsgbmFtZTogXCJkb3VibGVPcHRJblwiLCBjaGVjazogZnVuY3Rpb24gKCkgeyBwbi51c2VyLmlzVXNlclZhbGlkKCkgJiYgbmV3IFByb21pc2UoKGZ1bmN0aW9uIChuKSB7IGUuY2FsbEFwaShcIi9lbWFpbC9jb25maXJtYXRpb24vY2hlY2tcIiwge30sIChmdW5jdGlvbiAoZSkgeyBuKGUpOyB9KSk7IH0pKS50aGVuKChmdW5jdGlvbiAoZSkgeyBlICYmICExID09PSBlLmRhdGEgJiYgbi5zaG93RW1haWxDb25maXJtYXRpb25SZXF1aXJlZCgpOyB9KSk7IH0gfTsgfSgpO1xuICAgIHBuLmNvbnRhaW5lci5yZWdpc3RlcihcImRvdWJsZU9wdEluXCIsIHsgdXNlVmFsdWU6IENuIH0pLCBwbi5kb3VibGVPcHRJbiA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwiZG91YmxlT3B0SW5cIik7XG4gICAgdmFyIEluID0gZnVuY3Rpb24gKCkgeyB2YXIgZSA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwiYXBpXCIpLCBuID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJwb3N0bWVzc2FnZVwiKSwgdCA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwidXRpbFwiKSwgciA9IHQuZGVib3VuY2UoKGZ1bmN0aW9uICgpIHsgbmV3IFByb21pc2UoKGZ1bmN0aW9uIChuLCB0KSB7IHZhciByID0geyBhaWQ6IHBuLmFpZCB9OyBlLmNhbGxBcGkobywgciwgKGZ1bmN0aW9uIChlKSB7IGUgJiYgZS5kYXRhICYmIG4oZS5kYXRhKSwgdChlLm1lc3NhZ2UpOyB9KSk7IH0pKS50aGVuKGksIGEpOyB9KSwgMTUwMCksIG8gPSBcIi9leHRlcm5hbFZlcmlmaWNhdGlvbi9zeW5jaHJvbml6ZVN1YnNjcmlwdGlvbnNcIiwgaSA9IGZ1bmN0aW9uIChlKSB7IG4uYnJvYWRjYXN0KFwiTkVXU0NZQ0xFX0hBU19CRUVOX1NZTkNIUk9OSVpFRF9TVUNDRVNTXCIsIHsgZGF0YTogZSB9KTsgfSwgYSA9IGZ1bmN0aW9uIChlKSB7IHQuZXJyb3IoXCJuZXdzY3ljbGUgbW9kdWxlOiBzeW5jIHJlcXVlc3QgZmFpbGVkIHdpdGggZXJyb3I6IFwiICsgZSk7IH07IHJldHVybiB7IG5hbWU6IFwibmV3c2N5Y2xlXCIsIHN5bmNTdWJzY3JpcHRpb25zOiByIH07IH0oKTtcbiAgICBwbi5jb250YWluZXIucmVnaXN0ZXIoXCJuZXdzY3ljbGVcIiwgeyB1c2VWYWx1ZTogSW4gfSksIHBuLm5ld3NjeWNsZSA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwibmV3c2N5Y2xlXCIpO1xuICAgIHZhciBTbiA9IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSBwbi5jb250YWluZXIucmVzb2x2ZShcImFqYXhcIiksIG4gPSBwbi5jb250YWluZXIucmVzb2x2ZShcInBvc3RtZXNzYWdlXCIpLCB0ID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJ1dGlsXCIpLCByID0geyBlbmFibGVkOiAhMSwgY2FwdGNoYTNfc2l0ZV9rZXk6IFwiXCIsIGFpZDogXCJcIiB9LCBvID0gZnVuY3Rpb24gKG4pIHsgZS5yZXF1ZXN0KHsgdXJsOiB0cC5nZXRBcGlFbmRwb2ludCgpICsgXCIvYW5vbi9jYXB0Y2hhL2dldC5qc1wiLCBkYXRhOiB7IGFpZDogdHAuYWlkIH0sIGRhdGFUeXBlOiBcImpzb25wXCIsIGpzb25wQ2FsbGJhY2s6IFwianNvbnBDYWxsYmFja1wiLCBjYWNoZTogITAsIHN1Y2Nlc3M6IGZ1bmN0aW9uIChlKSB7ICFmdW5jdGlvbiAoZSwgbikgeyBlLmNvbmZpZyAmJiBlLmNvbmZpZy5lbmFibGVkID8gKHIgPSBlLmNvbmZpZywgbiAmJiBuKCkpIDogZS5tZXNzYWdlICYmIHQuZXJyb3IoZS5tZXNzYWdlKTsgfShlLCBuKTsgfSB9KTsgfTsgZnVuY3Rpb24gaSgpIHsgd2luZG93LmdyZWNhcHRjaGEucmVhZHkoYSksIGMoKTsgfSB2YXIgYSA9IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpOyBlLmlkID0gXCJ0cC1yZWNhcHRjaGFcIiwgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChlKSwgd2luZG93LmdyZWNhcHRjaGEucmVuZGVyKFwidHAtcmVjYXB0Y2hhXCIsIHsgc2l0ZWtleTogci5jYXB0Y2hhM19zaXRlX2tleSwgc2l6ZTogXCJpbnZpc2libGVcIiwgXCJlcnJvci1jYWxsYmFja1wiOiBmdW5jdGlvbiAoKSB7IGUuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiOyB9IH0pOyB9LCBzID0gZnVuY3Rpb24gKCkgeyB3aW5kb3cub25DYXB0Y2hhVjNMb2FkID0gaTsgdmFyIGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic2NyaXB0XCIpOyBlLnNyYyA9IFwiaHR0cHM6Ly93d3cuZ29vZ2xlLmNvbS9yZWNhcHRjaGEvYXBpLmpzP29ubG9hZD1vbkNhcHRjaGFWM0xvYWQmcmVuZGVyPWV4cGxpY2l0XCIsIGUudHlwZSA9IFwidGV4dC9qYXZhc2NyaXB0XCIsIGUuYXN5bmMgPSAhMCwgZS5kZWZlciA9ICEwLCBkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKGUpOyB9LCBjID0gZnVuY3Rpb24gKCkgeyBuLnN1YnNjcmliZShcImdldC1jYXB0Y2hhLXYzLWVuYWJsZWRcIiwgKGZ1bmN0aW9uICgpIHsgbCgpOyB9KSksIG4uc3Vic2NyaWJlKFwiZ2V0LWNhcHRjaGEtdjMtdG9rZW5cIiwgKGZ1bmN0aW9uIChlKSB7IHdpbmRvdy5ncmVjYXB0Y2hhLnJlYWR5KChmdW5jdGlvbiAoKSB7IHJldHVybiB1KGUucGFyYW1zLmFjdGlvbik7IH0pKTsgfSkpOyB9LCBsID0gZnVuY3Rpb24gKCkgeyBuLmJyb2FkY2FzdChcImNhcHRjaGEtdjMtZW5hYmxlZC12YWx1ZVwiLCB7IGlzRW5hYmxlZDogci5lbmFibGVkIH0pOyB9LCB1ID0gZnVuY3Rpb24gKGUpIHsgd2luZG93LmdyZWNhcHRjaGEuZXhlY3V0ZSh7IGFjdGlvbjogZSB9KS50aGVuKChmdW5jdGlvbiAoZSkgeyBuLmJyb2FkY2FzdChcImNhcHRjaGEtdjMtdG9rZW5cIiwgeyB0b2tlbjogZSB9KTsgfSkpLmNhdGNoKChmdW5jdGlvbiAoKSB7IG4uYnJvYWRjYXN0KFwiY2FwdGNoYS12My10b2tlblwiLCB7IHRva2VuOiBcIlwiIH0pOyB9KSk7IH07IHJldHVybiB7IG5hbWU6IFwiY2FwdGNoYVYzXCIsIGFkZENhcHRjaGFWMzogZnVuY3Rpb24gKCkgeyBvKHMpOyB9IH07IH0oKTtcbiAgICBwbi5jb250YWluZXIucmVnaXN0ZXIoXCJjYXB0Y2hhVjNcIiwgeyB1c2VWYWx1ZTogU24gfSksIHBuLmNhcHRjaGFWMyA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwiY2FwdGNoYVYzXCIpO1xuICAgIHZhciB4biA9IGZ1bmN0aW9uIChlKSB7IHZvaWQgMCA9PT0gZSAmJiAoZSA9IHBuLmNvbnRhaW5lcik7IHZhciBuID0gZS5yZXNvbHZlKFwibG9nXCIpLCB0ID0gZS5yZXNvbHZlKFwicG9zdG1lc3NhZ2VcIiksIHIgPSBlLnJlc29sdmUoXCJhcGlcIiksIG8gPSBlLnJlc29sdmUoXCJ1dGlsXCIpLCBpID0gZS5yZXNvbHZlKFwidmVyc2lvblNlcnZpY2VcIiksIGEgPSBcIkVWRU5UX1RQX0VSUk9SX0hBTkRMRVJcIiwgcyA9IFwic2RrXCIsIGMgPSBbXSwgbCA9ICEwLCB1ID0gZnVuY3Rpb24gKGUpIHsgaWYgKGgoKSAmJiAhZyhjLCBlKSkge1xuICAgICAgICBlLnRhZ3MgfHwgKGUudGFncyA9IFtcInVua25vd25cIl0pLCBlLmFpZCA9IHBuLmFpZCwgZS52ID0gaS5nZXRUaW55cGFzc1ZlcnNpb24oKTtcbiAgICAgICAgdmFyIG4gPSB7IGRldGFpbHM6IGUgfTtcbiAgICAgICAgYy5wdXNoKG4pO1xuICAgIH0gfTsgdmFyIGQgPSBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IGUucGFyYW1zOyBBcnJheS5pc0FycmF5KG4pICYmIG4uZm9yRWFjaCgoZnVuY3Rpb24gKGUpIHsgdShlKTsgfSkpOyB9OyBmdW5jdGlvbiBwKGUpIHsgdmFyIG4sIHQ7IGlmIChlLm1lc3NhZ2UudG9Mb3dlckNhc2UoKS5pbmRleE9mKFwic2NyaXB0IGVycm9yXCIpID4gLTEpXG4gICAgICAgIHUoeyBtZXNzYWdlOiBcIlByb2JhYmx5IHRoYXQgaXMgUGlhbm8gZXJyb3IuXCIsIHVybDogd2luZG93LmxvY2F0aW9uLmhyZWYsIHRhZ3M6IFtzXSB9KTtcbiAgICBlbHNlIHtcbiAgICAgICAgdmFyIHIgPSBudWxsID09IGUgPyB2b2lkIDAgOiBlLmVycm9yO1xuICAgICAgICBpZiAodihudWxsID09IHIgPyB2b2lkIDAgOiByLnN0YWNrKSlcbiAgICAgICAgICAgIHJldHVybiAhMTtcbiAgICAgICAgdSh7IHN0YWNrOiBudWxsICE9PSAobiA9IG51bGwgPT0gciA/IHZvaWQgMCA6IHIuc3RhY2spICYmIHZvaWQgMCAhPT0gbiA/IG4gOiBcIm4vYVwiLCBtZXNzYWdlOiBudWxsICE9PSAodCA9IG51bGwgPT0gciA/IHZvaWQgMCA6IHIubWVzc2FnZSkgJiYgdm9pZCAwICE9PSB0ID8gdCA6IFwibi9hXCIsIHVzZXJBZ2VudDogbmF2aWdhdG9yLnVzZXJBZ2VudCwgdGFnczogW3NdIH0pO1xuICAgIH0gcmV0dXJuICExOyB9IHZhciBmID0gZnVuY3Rpb24gKCkgeyBzZXRJbnRlcnZhbCgoZnVuY3Rpb24gKCkgeyBtKCksIGwgPSAhMTsgfSksIDE1ZTMpOyB9LCBtID0gZnVuY3Rpb24gKCkgeyB2YXIgZSA9IGMuZmlsdGVyKChmdW5jdGlvbiAoZSkgeyByZXR1cm4gIWUuc2VuZDsgfSkpOyBpZiAoMCAhPT0gZS5sZW5ndGgpIHtcbiAgICAgICAgdmFyIHQgPSBlLm1hcCgoZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGUuZGV0YWlsczsgfSkpLCBvID0geyB0eXBlOiBcImNvbnNvbGUtZXJyb3ItbWVzc2FnZVwiLCBzcmNUeXBlOiBcInRzXCIsIGxvZ19tZXNzYWdlOiBKU09OLnN0cmluZ2lmeSh0KSB9O1xuICAgICAgICBuLmxvZ0JlYWNvblJlcXVlc3Qoci5nZXRFbmRwb2ludCgpICsgXCIvYW5vbi9lcnJvci9sb2dcIiwgbyksIGUuZm9yRWFjaCgoZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGUuc2VuZCA9ICEwOyB9KSk7XG4gICAgfSB9LCBnID0gZnVuY3Rpb24gKGUsIG4pIHsgdmFyIHQgPSBlLm1hcCgoZnVuY3Rpb24gKGUpIHsgcmV0dXJuIEpTT04uc3RyaW5naWZ5KGUuZGV0YWlscyk7IH0pKSwgciA9IEpTT04uc3RyaW5naWZ5KG4pOyByZXR1cm4gLTEgIT09IHQuaW5kZXhPZihyKTsgfSwgdiA9IGZ1bmN0aW9uIChlKSB7IHJldHVybiAtMSA9PT0gKG51bGwgPT0gZSA/IHZvaWQgMCA6IGUuaW5kZXhPZihcInRpbnlwYXNzXCIpKTsgfSwgaCA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuICEhby5fX3Byb3RlY3RlZF9fLmdldExvY2FsU3RvcmFnZUl0ZW0oXCJ0aW55cGFzc0Vycm9ySGFuZGxlclRlc3RNb2RlXCIpIHx8IDAgPT09IHcoMCwgMWUzKTsgfSwgdyA9IGZ1bmN0aW9uIChlLCBuKSB7IHZhciB0ID0gZSAtIC41ICsgTWF0aC5yYW5kb20oKSAqIChuIC0gZSArIDEpOyByZXR1cm4gTWF0aC5yb3VuZCh0KTsgfSwgeSA9IGZ1bmN0aW9uIChlLCBuKSB7IHJldHVybiB2b2lkIDAgPT09IGUgJiYgKGUgPSBbXSksIG4gPyBlLmNvbmNhdChuKSA6IGU7IH07IHJldHVybiB7IG5hbWU6IFwidGlueXBhc3NFcnJvckhhbmRsZXJcIiwgYWRkRXJyb3I6IGZ1bmN0aW9uIChlLCBuKSB7IHRyeSB7XG4gICAgICAgICAgICB2YXIgdCA9IHsgcGxhY2U6IG4sIHRhZ3M6IFtzXSB9O1xuICAgICAgICAgICAgZSBpbnN0YW5jZW9mIEVycm9yID8gKHQuc3RhY2sgPSBlLnN0YWNrLCB0Lm1lc3NhZ2UgPSBlLm1lc3NhZ2UpIDogdC5zdGFjayA9IEpTT04uc3RyaW5naWZ5KGUpLCBsICYmICh0LnRhZ3MgPSB5KHQudGFncywgXCJpbml0RXJyb3JcIikpLCB1KHQpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7IH0gfSwgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKCkgeyB0cnkge1xuICAgICAgICAgICAgcG4uaXNTYW5kYm94KCkgfHwgKHQuc3Vic2NyaWJlKGEsIGQpLCBudWxsID09PSAoZSA9IHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKSB8fCB2b2lkIDAgPT09IGUgfHwgZS5jYWxsKHdpbmRvdywgXCJlcnJvclwiLCBwKSwgZigpKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKFwiQ2Fubm90IHN0YXJ0IHdhdGNoaW5nIGVycm9yc1wiLCBlKTtcbiAgICAgICAgfSB2YXIgZTsgfSB9OyB9O1xuICAgIHBuLmNvbnRhaW5lci5yZWdpc3RlcihcInRpbnlwYXNzRXJyb3JIYW5kbGVyXCIsIHsgdXNlVmFsdWU6IHhuKCkgfSksIHBuLnRpbnlwYXNzRXJyb3JIYW5kbGVyID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJ0aW55cGFzc0Vycm9ySGFuZGxlclwiKTtcbiAgICB2YXIgUG4gPSBmdW5jdGlvbiAoZSkgeyB2b2lkIDAgPT09IGUgJiYgKGUgPSBwbi5jb250YWluZXIpOyB2YXIgbiA9IGUucmVzb2x2ZShcImFwaVwiKSwgdCA9IGUucmVzb2x2ZShcImNvb2tpZVwiKSwgciA9IGUucmVzb2x2ZShcImxvZ1wiKSwgbyA9IGUucmVzb2x2ZShcImpxVXRpbHNcIiksIGkgPSBlLnJlc29sdmUoXCJ1dGlsXCIpLCBhID0gZS5yZXNvbHZlKFwibG9nZ2luZ1wiKSwgcyA9IGUucmVzb2x2ZShcImZpbmdlcnByaW50XCIpLCBjID0gZS5yZXNvbHZlKFwidXNlclwiKSwgbCA9IGUucmVzb2x2ZShcInNoYTFcIiksIHUgPSBlLnJlc29sdmUoXCJhY3RpdmV0aW1lclwiKSwgZCA9IGUucmVzb2x2ZShcInNjcm9sbERlcHRoXCIpLCBwID0gZS5yZXNvbHZlKFwiZG91YmxlQ2xpY2tGb3JQdWJsaXNoZXJcIiksIGYgPSBlLnJlc29sdmUoXCJvZmZlclwiKSwgbSA9IGUucmVzb2x2ZShcInZpZXdwb3J0RXhpdFwiKSwgZyA9IGUucmVzb2x2ZShcImlkbGVcIiksIHYgPSBlLnJlc29sdmUoXCJleHBlcmllbmNlXCIpLCBoID0gZS5yZXNvbHZlKFwicGlhbm9JZFwiKSwgdyA9IGUucmVzb2x2ZShcInBpYW5vRXNwXCIpLCB5ID0gZS5yZXNvbHZlKFwiYXBwbGVQYXlJbnRlZ3JhdGlvblNlcnZpY2VcIiksIGIgPSBlLnJlc29sdmUoXCJkYXRhdHJhbnNBcHBsZVBheUludGVncmF0aW9uU2VydmljZVwiKSwgayA9IGUucmVzb2x2ZShcImN4ZW5zZVwiKTsgZS5yZXNvbHZlKFwidGlueXBhc3NFcnJvckhhbmRsZXJcIik7IHZhciBfID0gZS5yZXNvbHZlKFwiY2FwdGNoYVYzXCIpLCBDID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJwb3N0bWVzc2FnZVwiKSwgSSA9IFwiZXhyc1wiLCBTID0gbnVsbCwgeCA9IFwidm91Y2hlcl9jb2RlXCIsIFAgPSBcIl9fcHZpXCIsIEUgPSAhMSwgVCA9ICExLCBBID0ge30sIE0gPSBudWxsLCBPID0gay5fX3Byb3RlY3RlZF9fLmdldE9yR2VuZXJhdGVDeENvbXBhdGlibGVCaWQoKSwgUiA9IHsgQVBQTEVfUEFZX0JUOiAyNSwgQVBQTEVfUEFZX1NTOiAzOCwgQVBQTEVfUEFZX1NUUklQRTogNDEsIEFQUExFX1BBWV9QVzogNDIsIERBVEFUUkFOU19BUFBMRV9QQVk6IDYxIH0sIEwgPSBuZXcgU2V0KE9iamVjdC52YWx1ZXMoUikpLCBOID0gdm9pZCAwLCBVID0gW10sIGogPSAhMSwgRCA9ICExLCBGID0gZnVuY3Rpb24gKCkgeyBpZiAoXCJpUFwiID09PSBuYXZpZ2F0b3IucGxhdGZvcm0uc3Vic3RyKDAsIDIpKSB7XG4gICAgICAgIHZhciBlID0gL2NvbnN0cnVjdG9yL2kudGVzdCh3aW5kb3cuSFRNTEVsZW1lbnQpLCBuID0gd2luZG93Lm5hdmlnYXRvciwgdCA9IG4udXNlckFnZW50LCByID0gISF3aW5kb3cuaW5kZXhlZERCO1xuICAgICAgICBpZiAoLTEgPT09IHQuaW5kZXhPZihcIlNhZmFyaVwiKSB8fCAtMSA9PT0gdC5pbmRleE9mKFwiVmVyc2lvblwiKSB8fCBuLnN0YW5kYWxvbmUpIHtcbiAgICAgICAgICAgIGlmICghciAmJiBlIHx8ICF3aW5kb3cuc3RhdHVzYmFyLnZpc2libGUpXG4gICAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgZWxzZSBpZiAod2luZG93LndlYmtpdCAmJiB3aW5kb3cud2Via2l0Lm1lc3NhZ2VIYW5kbGVycyB8fCAhZSB8fCByKVxuICAgICAgICAgICAgICAgIHJldHVybiAhMDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICA7XG4gICAgfSByZXR1cm4gITE7IH0oKTsgdmFyIEIsIFYsIHEsIHogPSBmdW5jdGlvbiAoKSB7IHZhciBlOyB0cnkge1xuICAgICAgICBlID0gSlNPTi5wYXJzZShpLl9fcHJvdGVjdGVkX18uZ2V0Q29va2llKFApKTtcbiAgICB9XG4gICAgY2F0Y2ggKG4pIHtcbiAgICAgICAgZSA9IHt9O1xuICAgIH0gcmV0dXJuIGU7IH0sIEggPSBmdW5jdGlvbiAoKSB7IHJldHVybiBpLmdldEN1cnJlbnREb21haW5Gcm9tQ29va2llKFApOyB9LCBXID0gZnVuY3Rpb24gKGUsIG4pIHsgdmFyIHQgPSBBOyBBID0ge307IHZhciByID0ge307IGZvciAodmFyIG8gaW4gdClcbiAgICAgICAgaWYgKHQuaGFzT3duUHJvcGVydHkobykpXG4gICAgICAgICAgICBmb3IgKHZhciBpIGluIHJbb10gPSByW29dIHx8IFtdLCB0W29dKVxuICAgICAgICAgICAgICAgIHRbb10uaGFzT3duUHJvcGVydHkoaSkgJiYgcltvXS5wdXNoKHRbb11baV0pOyBiZShyLCBlLCBuKTsgfSwgSiA9IGZ1bmN0aW9uICgpIHsgaWYgKHYuZXhlY3V0ZS5pbnZva2VDb3VudCA+IDApIHtcbiAgICAgICAgdmFyIGUgPSBHKCk7XG4gICAgICAgIHJldHVybiBDZSgpICYmIEllKHJlKCksIGUsIHBuLmN4ZW5zZVNpdGVJZCksIGU7XG4gICAgfSByZXR1cm4gQ2UoKSA/IGsuX19wcm90ZWN0ZWRfXy50cnlUb0dldEN4UGFnZVZpZXdJZChTZSgpKSA6IEcoKTsgfTsgZnVuY3Rpb24gRygpIHsgZnVuY3Rpb24gZShlLCBuLCB0KSB7IHQgPSB0IHx8IFwiMFwiOyB2YXIgciA9IFN0cmluZyhlKTsgcmV0dXJuIHIubGVuZ3RoID49IG4gPyByIDogbmV3IEFycmF5KG4gLSByLmxlbmd0aCArIDEpLmpvaW4odCkgKyByOyB9IGlmIChDZSgpKVxuICAgICAgICByZXR1cm4gU2UoKTsgdmFyIG4gPSBpLnJhbmRvbVN0cmluZygxNiksIHQgPSBsLmhhc2goW3MuZ2V0RmluZ2VycHJpbnQoKSwgd2luZG93LmxvY2F0aW9uLmhyZWZdLmpvaW4oXCJcIikpLCByID0gbmV3IERhdGU7IHJldHVybiBbW2Uoci5nZXRGdWxsWWVhcigpLCA0KSwgZShyLmdldE1vbnRoKCkgKyAxLCAyKSwgZShyLmdldERhdGUoKSwgMiksIGUoci5nZXRIb3VycygpLCAyKSwgZShyLmdldE1pbnV0ZXMoKSwgMiksIGUoci5nZXRTZWNvbmRzKCksIDIpLCBlKHIuZ2V0TWlsbGlzZWNvbmRzKCksIDMpXS5qb2luKFwiLVwiKSwgbiwgdF0uam9pbihcIi1cIik7IH0gdmFyIFEgPSBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IHsgcGF0aDogXCIvXCIsIGV4cGlyZXM6IDEsIGRvbWFpbjogVi5jdXJyZW50RG9tYWluIH07IHJldHVybiBlICYmIChuLmRvbWFpbiA9IGUpLCBuOyB9LCBYID0gZnVuY3Rpb24gKGUsIG4pIHsgZS5kb21haW4gPSBuLmRvbWFpbiwgZS50aW1lID0gKG5ldyBEYXRlKS5nZXRUaW1lKCksIGkuX19wcm90ZWN0ZWRfXy5zZXRDb29raWUoUCwgSlNPTi5zdHJpbmdpZnkoZSksIG4pOyB9LCAkID0gZnVuY3Rpb24gKGUpIHsgdmFyIG4gPSAobmV3IERhdGUpLmdldFRpbWUoKSwgdCA9IDZlNCAqIGkuZ2V0QnJvd3NlclRpbWV6b25lT2Zmc2V0KCksIHIgPSBpLmdldEFwcFRpbWV6b25lT2Zmc2V0KCksIG8gPSBuZXcgRGF0ZShlLnRpbWUpLnNldEhvdXJzKDAsIDAsIDAsIDApICsgODY0ZTUgLSB0IC0gcjsgcmV0dXJuIGUudGltZSArIDE4ZTUgPCBuIHx8IG4gPj0gbzsgfSwgWSA9IGZ1bmN0aW9uICgpIHsgaWYgKGkuX19wcm90ZWN0ZWRfXy5jYW1lRnJvbUZiU3Vic2NyaXB0aW9ucygpKVxuICAgICAgICByZXR1cm4gITE7IGlmICghVi5jdXJyZW50RG9tYWluKVxuICAgICAgICByZXR1cm4gITE7IHZhciBlID0gaS5nZXRSZWZlcnJlcigpOyBpZiAoTSAmJiBNID09PSBlKVxuICAgICAgICByZXR1cm4gITE7IHZhciBuID0gaS5nZXRIb3N0bmFtZShlKSwgdCA9IG5ldyBSZWdFeHAoVi5jdXJyZW50RG9tYWluLnJlcGxhY2UoL1xcLi9nLCBcIlxcXFwuXCIpLnJlcGxhY2UoL15cXFxcLi8sIFwiXFxcXC4/XCIpICsgXCIkXCIpLnRlc3Qobik7IHJldHVybiBCb29sZWFuKG4pICYmICF0OyB9LCBLID0gZnVuY3Rpb24gKCkgeyB2YXIgZSA9IHooKTsgKCFlIHx8ICFlLmlkIHx8ICFlLnRpbWUgfHwgJChlKSB8fCBZKCkpICYmIChlLmlkID0gXCJ2LVwiICsgRygpKSwgZnVuY3Rpb24gKGUpIHsgdmFyIG4gPSBRKCk7IGUuZG9tYWluIHx8IFYuY3VycmVudERvbWFpbiA/IFgoZSwgbikgOiBpLndhaXRDYWxsKFwiZG9tYWluSXNSZWNlaXZlZFwiLCAoZnVuY3Rpb24gKHQpIHsgY2UodCksIG4uZG9tYWluID0gdCwgWChlLCBuKTsgfSkpOyB9KGUpLCBWLnZpc2l0ID0gZTsgfSwgWiA9IGZ1bmN0aW9uIChlLCBuLCB0KSB7IHZhciByLCBhLCBjID0gXCJtYW51YWxcIjsgaWYgKHZvaWQgMCA9PT0gbilcbiAgICAgICAgbiA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmO1xuICAgIGVsc2Uge1xuICAgICAgICBpZiAoXCJvYmplY3RcIiAhPSB0eXBlb2YgbilcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkZpcnN0IHBhcmFtZXRlciB0byB0cmFjayBwYWdlIG11c3QgYmUgYSBVUkwgb3IgYW4gb2JqZWN0XCIpO1xuICAgICAgICB2YXIgbCA9IG47XG4gICAgICAgIGlmICh2b2lkIDAgPT09IGwudXJsKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTXVzdCBzdXBwbHkgdXJsIHByb3BlcnR5XCIpO1xuICAgICAgICBuID0gbC51cmwsIHZvaWQgMCAhPT0gbC50YWdzICYmICh0ID0gbC50YWdzKSwgdm9pZCAwICE9PSBsLnN1Ym1pdFR5cGUgJiYgKGMgPSBsLnN1Ym1pdFR5cGUpO1xuICAgIH0gdCB8fCAodCA9IHBuLnRhZ3MpLCBwbi5jdXN0b21QYWdlVXJsICYmIChlLmN1c3RvbV9wYWdlX3VybCA9IGkucHJlcGFyZVVybFBhcmFtZXRlcihwbi5jdXN0b21QYWdlVXJsKSksIHZvaWQgMCAhPT0gdCA/IFwiW29iamVjdCBBcnJheV1cIiAhPT0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHQpICYmIFwiW29iamVjdCBTdHJpbmddXCIgIT09IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh0KSA/IChpLmxvZyhcIlRhZ3MgbXVzdCBiZSBhbiBhcnJheSBvciBhIGNvbW1hLXNlcGFyYXRlZCBzdHJpbmcsIGlnbm9yaW5nIHN1cHBsaWVkIHRhZ3NcIiksIHQgPSBcIlwiKSA6IHQgaW5zdGFuY2VvZiBBcnJheSAmJiAodCA9IHQuam9pbihcIixcIikpIDogdCA9IFwiXCIsIHEudHJhY2soKSwgZS5wYWdlX3Nlc3Npb25faWQgPSBxLnBhZ2VTZXNzaW9uSWQsIGUudHJhY2tfY291bnQgPSBxLnRyYWNrQ291bnQsIHdlKGUpLCBwbi5jb250ZW50Q3JlYXRlZCA/IGEgPSBwbi5jb250ZW50Q3JlYXRlZCA6IHBuLmNvbnRlbnRDcmVhdGVkU2VsZWN0b3IgJiYgby5xdWVyeUVsKHBuLmNvbnRlbnRDcmVhdGVkU2VsZWN0b3IpICYmIChhID0gbnVsbCA9PT0gKHIgPSBvLnF1ZXJ5RWwocG4uY29udGVudENyZWF0ZWRTZWxlY3RvcikpIHx8IHZvaWQgMCA9PT0gciA/IHZvaWQgMCA6IHIuaW5uZXJIVE1MKSwgYSAmJiAoZS5jb250ZW50X2NyZWF0ZWQgPSBhKSwgXCJib29sZWFuXCIgPT0gdHlwZW9mIHBuLmNvbnRlbnRJc05hdGl2ZSAmJiAoZS5jb250ZW50X2lzX25hdGl2ZSA9IHBuLmNvbnRlbnRJc05hdGl2ZSksIHBuLnpvbmUgJiYgKGUuem9uZSA9IHBuLnpvbmUpLCBwbi5pdGVtSWQgJiYgKGUuaXRlbV9pZCA9IHBuLml0ZW1JZCk7IHZhciB1ID0gcG4uY29udGVudFNlY3Rpb24gfHwgc2UoXCJzZWN0aW9uXCIpOyB1ICYmIChlLmNvbnRlbnRfc2VjdGlvbiA9IHUpOyB2YXIgZCA9IHBuLmNvbnRlbnRBdXRob3IgfHwgc2UoXCJhdXRob3JcIik7IGQgJiYgKGUuY29udGVudF9hdXRob3IgPSBkKTsgdmFyIHAgPSBwbi5jb250ZW50SWQgfHwgc2UoXCJpZFwiKTsgcCAmJiAoZS5jb250ZW50X2lkID0gcCk7IHZhciBmLCBtID0gaS5fX3Byb3RlY3RlZF9fLmdldENvb2tpZShcInNhaWx0aHJ1X2hpZFwiKTsgbSAmJiAoZS5zYWlsdGhydV9oaWQgPSBtKSwgTSAmJiBNID09PSBpLmdldFJlZmVycmVyKCkgPyBmID0gXCJcIiA6IChmID0gaS5nZXRSZWZlcnJlcigpLCBNID0gZiksIGUucmVmZXJlciA9IGkucHJlcGFyZVVybFBhcmFtZXRlcihmKSwgdCAmJiAoZS50YWdzID0gdCksIGUudXJsID0gaS5wcmVwYXJlVXJsUGFyYW1ldGVyKG4pLCBlLmZpbmdlcnByaW50ID0gcy5nZXRGaW5nZXJwcmludCgpLCBlLmFkYmxvY2tlciA9IGkuZ2V0QWRibG9ja1N0YXR1cygpLCBlLmFkYmxvY2tlciAhPT0gaS5BREJMT0NLRVJfU1RBVFVTLkVOQUJMRURfQUZURVJfRElTQUJMRUQgJiYgZS5hZGJsb2NrZXIgIT09IGkuQURCTE9DS0VSX1NUQVRVUy5FTkFCTEVEIHx8IChwbi5zZXRDdXN0b21QYXJhbShcIl9hYnJcIiwgaS5nZXRBZGJsb2NrZXJTdGF0dXNSZWFzb24oKSwgXCJ1c2VyXCIsICEwKSwgcG4uc2V0Q3VzdG9tUGFyYW0oXCJfYWJzaFwiLCBpLmdldEFkYmxvY2tlckhpc3RvcnlDb29raWVJbmZvKCkuY29va2llVmFsdWUgKyBcIlwiLCBcInVzZXJcIiwgITApKSwgZS50aW1lem9uZV9vZmZzZXQgPSBpLmdldEJyb3dzZXJUaW1lem9uZU9mZnNldCgpLCBlLnN1Ym1pdF90eXBlID0gYzsgdmFyIGcgPSBhZSgpOyByZXR1cm4gZS52aXNpdF9pZCA9IGcsIGUubmV3X3Zpc2l0ID0gb2UoZyksIGUua2V5d29yZHMgPSBvLmdldEF0dHIoJ21ldGFbbmFtZT1cImtleXdvcmRzXCJdJywgXCJjb250ZW50XCIpIHx8IG8uZ2V0QXR0cignbWV0YVtuYW1lPVwibmV3c19rZXl3b3Jkc1wiXScsIFwiY29udGVudFwiKSB8fCBcIlwiLCBlLnRpdGxlID0gby5nZXRBdHRyKCdtZXRhW3Byb3BlcnR5PVwib2c6dGl0bGVcIl0nLCBcImNvbnRlbnRcIikgfHwgXCJcIiwgZS5kZXNjcmlwdGlvbiA9IG8uZ2V0QXR0cignbWV0YVtwcm9wZXJ0eT1cIm9nOmRlc2NyaXB0aW9uXCJdJywgXCJjb250ZW50XCIpIHx8IFwiXCIsIGUuY29udGVudF90eXBlID0gby5nZXRBdHRyKCdtZXRhW3Byb3BlcnR5PVwib2c6dHlwZVwiXScsIFwiY29udGVudFwiKSB8fCBcIlwiLCBbXCJrZXl3b3Jkc1wiLCBcInRpdGxlXCIsIFwiZGVzY3JpcHRpb25cIiwgXCJjb250ZW50X3R5cGVcIl0uZm9yRWFjaCgoZnVuY3Rpb24gKG4pIHsgZVtuXSA9IGVbbl0uc3Vic3RyKDAsIDgxOTIpOyB9KSksIGUuY3VzdG9tX3ZhcmlhYmxlcyA9IEpTT04uc3RyaW5naWZ5KHBuLmN1c3RvbVZhcmlhYmxlcyksIG5lKGUpLCBlOyB9LCBlZSA9IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSB7IGFpZDogcG4uYWlkIH0sIG4gPSBpLmdldFRiY0Nvb2tpZSgpLCB0ID0geyBhY3RpdmU6IHUuZ2V0QWN0aXZlVGltZUluU2Vjb25kcygpLCB0b3RhbDogdS5nZXRUb3RhbFRpbWVJblNlY29uZHMoKSB9OyBuICYmIChlLnRiYyA9IG4pLCB0LnRvdGFsIDwgdC5hY3RpdmUgJiYgKHQudG90YWwgPSB0LmFjdGl2ZSksIGUudGltZV9zcGVudCA9IEpTT04uc3RyaW5naWZ5KHQpLCBlLnNjcm9sbCA9IEpTT04uc3RyaW5naWZ5KHsgbWF4X3BhZ2VfaGVpZ2h0OiBkLmdldE1heERvY3VtZW50SGVpZ2h0KCksIG1heF9kZXB0aDogZC5nZXRNYXhTY3JvbGxEZXB0aCgpIH0pLCBlLnZpZXdwb3J0X2V4aXQgPSBtLmdldFN1bU9mQ29kZXNEaXJlY3Rpb24oKSwgZS51cmwgPSBpLnByZXBhcmVVcmxQYXJhbWV0ZXIod2luZG93LmxvY2F0aW9uLmhyZWYpLCB3ZShlKSwgZS52aXNpdF9pZCA9IGFlKCksIGllKCk7IHZhciByID0ge30sIGEgPSBwLmdldEFkcygyMDApOyByZXR1cm4gYS5sZW5ndGggJiYgKHIuZGZwID0gYSksIG8uaXNFbXB0eU9iamVjdChyKSB8fCAoZS5hZHMgPSBKU09OLnN0cmluZ2lmeShyKSksIGU7IH0sIG5lID0gZnVuY3Rpb24gKGUpIHsgdmFyIG4gPSB7fTsgcmV0dXJuIHBuLmN1c3RvbVBhcmFtcyAmJiAobiA9IG8uZGVlcEV4dGVuZCh7fSwgcG4uY3VzdG9tUGFyYW1zKSksIG8uaXNFbXB0eU9iamVjdChuKSB8fCAoZS5jdXN0b21fcGFyYW1zID0gSlNPTi5zdHJpbmdpZnkobikpLCBlOyB9LCB0ZSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHEuaWQ7IH0sIHJlID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gTzsgfSwgb2UgPSBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IFYubGFzdFRyYWNrZWRWaXNpdElkICE9PSBlOyByZXR1cm4gVi5sYXN0VHJhY2tlZFZpc2l0SWQgPSBlLCBuOyB9LCBpZSA9IGZ1bmN0aW9uICgpIHsgVi5jaGVja0ZvclJlZnJlc2ggPSAhMDsgfSwgYWUgPSBmdW5jdGlvbiAoKSB7IHJldHVybiBWLmNoZWNrRm9yUmVmcmVzaCAmJiAoSygpLCBWLmNoZWNrRm9yUmVmcmVzaCA9ICExKSwgVi52aXNpdC5pZDsgfSwgc2UgPSBmdW5jdGlvbiAoZSkgeyByZXR1cm4gKGRvY3VtZW50LmhlYWQucXVlcnlTZWxlY3RvcihcIm1ldGFbbmFtZT1cIiArIGUgKyBcIl1cIikgfHwge30pLmNvbnRlbnQ7IH0sIGNlID0gZnVuY3Rpb24gKGUpIHsgVi5jdXJyZW50RG9tYWluID0gZTsgfSwgbGUgPSBmdW5jdGlvbiAoKSB7IHJldHVybiAhKHBuLmVuZHBvaW50ICYmIHBuLmVuZHBvaW50Lm1hdGNoKC9zYW5kYm94LykpOyB9LCB1ZSA9IGZ1bmN0aW9uIChlLCB0LCByLCBvKSB7IHBuLmFpZCAmJiAwICE9PSBwbi5haWQubGVuZ3RoID8gbGUoKSAmJiBpLndhaXRDYWxsKFwicmVmcmVzaEFjY2Vzc1Rva2VuTGlzdFwiLCAoZnVuY3Rpb24gKCkgeyBpLndhaXRDYWxsKFwib2ZmZXJDcmVhdGVcIiwgKGZ1bmN0aW9uICgpIHsgYS5zZXRUaW1lKFwidHJhY2tcIiksIGkuc3RhcnRDYWxsKFwicGFnZVRyYWNrXCIpLCBuLmNhbGxBcGkoZSwgdCwgKGZ1bmN0aW9uIChlKSB7IGkuZG9uZUNhbGwoXCJwYWdlVHJhY2tcIiksIHIgJiYgcihlKTsgfSksIHBuLmdldFRyYWNraW5nRW5kcG9pbnQoKSArIFwiL2FwaS92M1wiLCBvKTsgfSkpOyB9KSkgOiBpLmxvZyhcIk11c3Qgc3VwcGx5IGEgdmFsaWQgdHAuYWlkIGJlZm9yZSBjYWxsaW5nIHRwLmluaXQoKVwiKTsgfSwgZGUgPSBmdW5jdGlvbiAoKSB7IEUgJiYgcS50cmFja0NvdW50ID4gMCAmJiAocGUoKSwgaGUoKSk7IH0sIHBlID0gZnVuY3Rpb24gKGUpIHsgaWYgKGxlKCkpXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICB2YXIgbiA9IGVlKCk7XG4gICAgICAgICAgICBtLmlzSW5pdGlhbGl6ZWQoKSAmJiBtLnJlc2V0U3VtT2ZDb2Rlc0RpcmVjdGlvblRvRGVmYXVsdCgpLCByLmxvZ0JlYWNvblJlcXVlc3QocG4uZ2V0VHJhY2tpbmdFbmRwb2ludCgpICsgXCIvYXBpL3YzL3BhZ2UvdW5sb2FkXCIsIG4pLCBnZSgpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICBpLmVycm9yKFwibWFpbjogZXJyb3Igb24gdHJhY2tpbmcgcGFnZSB1bmxvYWQgZXZlbnQ6IFwiLCBlKTtcbiAgICAgICAgfSB9LCBmZSA9IGZ1bmN0aW9uICgpIHsgVCB8fCAoVCA9ICEwLCBwZSgpKTsgfSwgbWUgPSBmdW5jdGlvbiAoKSB7IEUgPSAhMDsgfSwgZ2UgPSBmdW5jdGlvbiAoKSB7IEUgPSAhMTsgfSwgdmUgPSBmdW5jdGlvbiAoKSB7IEUgJiYgZmUoKSwgVyghMCwgXCJiZWFjb25fcmVxdWVzdFwiKSwgdi5fX3Byb3RlY3RlZF9fLnNlbmRTdGF0aXN0aWNzRXhlY3V0ZWROb2RlcyhcInVubG9hZFwiKTsgfSwgaGUgPSBmdW5jdGlvbiAoKSB7IHUucmVzZXRSZWNvcmRlZFRpbWUoKTsgfSwgd2UgPSBmdW5jdGlvbiAoZSkgeyBlICYmIChlLnBhZ2V2aWV3X2lkID0gdGUoKSk7IH0sIHllID0gZnVuY3Rpb24gKGUsIG4pIHsgaWYgKGxlKCkpXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBkZSgpO1xuICAgICAgICAgICAgdmFyIHQgPSBaKHt9LCBlLCBuKTtcbiAgICAgICAgICAgIHVlKFwiL3BhZ2UvdHJhY2tcIiwgdCksIG1lKCk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGkuZXJyb3IoXCJtYWluOiBlcnJvciBvbiBwYWdlIHRyYWNraW5nIGV2ZW50OiBcIiwgZSk7XG4gICAgICAgIH0gfSwgYmUgPSBmdW5jdGlvbiAoZSwgbiwgdCkgeyB9LCBrZSA9IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSBpLmdldFF1ZXJ5UGFyYW1CeU5hbWUoeCk7IGUgJiYgZi5zdGFydFJlZGVlbVZvdWNoZXIoeyB2b3VjaGVyQ29kZTogZSB9KTsgfSwgX2UgPSBmdW5jdGlvbiAoKSB7IHJldHVybiBTIHx8IChTID0gbmV3IFByb21pc2UoKGZ1bmN0aW9uIChlKSB7IGlmIChudWxsICE9PSBpLl9fcHJvdGVjdGVkX18uZ2V0TG9jYWxTdG9yYWdlSXRlbShJKSAmJiBlKHsgaGFzX2FjdGl2ZV9hcHBsZV9wYXlfY2FyZDogaS5fX3Byb3RlY3RlZF9fLmdldExvY2FsU3RvcmFnZUl0ZW0oSSkgfSksICFwbi5hcHBsZVBheU1lcmNoYW50SWQpXG4gICAgICAgIHJldHVybiBlKHsgaGFzX2FjdGl2ZV9hcHBsZV9wYXlfY2FyZDogbnVsbCB9KSwgUzsgUGUoKS50aGVuKChmdW5jdGlvbiAobikgeyB2YXIgdCA9IGZ1bmN0aW9uIChuKSB7IGUoeyBoYXNfYWN0aXZlX2FwcGxlX3BheV9jYXJkOiBuIH0pLCBpLl9fcHJvdGVjdGVkX18uc2V0TG9jYWxTdG9yYWdlSXRlbShJLCBuLCA3MjAwKTsgfTsgbiA/IHkuX19wcm90ZWN0ZWRfXy5hcHBsZVBheUNhbk1ha2VQYXltZW50c1dpdGhBY3RpdmVDYXJkKCkudGhlbih0KSA6IHQobnVsbCk7IH0pKTsgfSkpLCBTKTsgfTsgZnVuY3Rpb24gQ2UoKSB7IHJldHVybiBrLl9fcHJvdGVjdGVkX18uaXNBY3RpdmF0ZWQoKTsgfSB2YXIgSWUgPSBmdW5jdGlvbiAoZSwgbiwgdCkgeyByZXR1cm4gay5fX3Byb3RlY3RlZF9fLmluamVjdElkcyghMSwgZSwgbiwgdCk7IH0sIFNlID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gaS5fX3Byb3RlY3RlZF9fLnJhbmRvbVN0cmluZ0N4Q29tcGF0aWJsZSgpOyB9OyBmdW5jdGlvbiB4ZShlKSB7IHJldHVybiBmdW5jdGlvbiAobikgeyB2YXIgdCA9IG4ucGFyYW1zOyB2b2lkIDAgPT09IE4gJiYgKE4gPSBmdW5jdGlvbiAoZSkgeyBpZiAoIUFycmF5LmlzQXJyYXkoZSkgfHwgIWUubGVuZ3RoKVxuICAgICAgICByZXR1cm4gITE7IGZvciAodmFyIG4gPSAwLCB0ID0gZTsgbiA8IHQubGVuZ3RoOyBuKyspIHtcbiAgICAgICAgdmFyIHIgPSB0W25dO1xuICAgICAgICBpZiAoTC5oYXMocikpXG4gICAgICAgICAgICByZXR1cm4gITA7XG4gICAgfSByZXR1cm4gITE7IH0odCkpLCBVID0gdCB8fCBbXSwgZShOKTsgfTsgfSBmdW5jdGlvbiBQZSgpIHsgcmV0dXJuIHZvaWQgMCAhPT0gTiA/IFByb21pc2UucmVzb2x2ZShOKSA6IEYgPyAoTiA9ICExLCBQcm9taXNlLnJlc29sdmUoITEpKSA6IG5ldyBQcm9taXNlKChmdW5jdGlvbiAoZSkgeyB2LnJlZ2lzdGVyQ2FsbGJhY2soXCJleHBlcmllbmNlRmxvd1wiLCAoZnVuY3Rpb24gKCkgeyBOID0gITAsIGUoITApOyB9KSksIEMuc3Vic2NyaWJlKFwiQUNUSVZFX1BBWU1FTlRfTUVUSE9EU19JRFNfSU5JVElBTElaRURcIiwgeGUoZSkpLCBDLnN1YnNjcmliZShcIk1ZX0FDQ09VTlRfQUNUSVZFX1BBWU1FTlRfTUVUSE9EU19JRFNfSU5JVElBTElaRURcIiwgeGUoZSkpOyB9KSk7IH0gcmV0dXJuIHsgbmFtZTogXCJtYWluXCIsIGZldGNoVmlzaXRJZDogYWUsIHRyYWNrUGFnZVVubG9hZElmTmVjZXNzYXJ5OiBkZSwgZXh0ZXJuYWxSZXNvdXJjZXNEZWxheTogX2UsIHBhZ2VUcmFjazogeWUsIHRyYWNrUGFnZTogZnVuY3Rpb24gKGUsIG4pIHsgcmV0dXJuIHllKGUsIG4pOyB9LCBidWlsZFBhZ2VUcmFja1BhcmFtczogWiwgZmV0Y2hQYWdlVmlld0lkOiB0ZSwgZmV0Y2hDeEJyb3dzZXJJZDogcmUsIHRyYWNrUGFnZVVubG9hZDogcGUsIHJlZ2lzdGVyVHJhY2tVbmxvYWQ6IG1lLCBpc1JlZ2lzdGVyZWRUcmFja1VubG9hZDogZnVuY3Rpb24gKCkgeyByZXR1cm4gRTsgfSwgdW5yZWdpc3RlclRyYWNrVW5sb2FkOiBnZSwgcmVzZXRUaW1lcjogaGUsIHJlc2V0QWRzOiBmdW5jdGlvbiAoKSB7IHAucmVzZXRBZHMoKTsgfSwgdHJhY2tBZDogZnVuY3Rpb24gKGUsIG4sIHQpIHsgQVtlXSB8fCAoQVtlXSA9IHt9KSwgQVtlXVtuXSA9IHQsIEIoKTsgfSwgaW5pdDogZnVuY3Rpb24gKCkgeyBpZiAocG4uYWlkICYmIDAgIT09IHBuLmFpZC5sZW5ndGgpIHtcbiAgICAgICAgICAgIHZhciBlLCBuLCB0O1xuICAgICAgICAgICAgQiA9IGkuZGVib3VuY2UoVywgM2UzKSwgViA9IHsgY3VycmVudERvbWFpbjogSCgpLCBsYXN0VHJhY2tlZFZpc2l0SWQ6IHooKS5pZCwgdmlzaXQ6IHt9LCBjaGVja0ZvclJlZnJlc2g6ICExIH0sIHEgPSB7IGlkOiBKKCksIHBhZ2VTZXNzaW9uSWQ6IFwicy1cIiArIEcoKSwgdHJhY2tDb3VudDogMCwgdHJhY2tlZDogITEsIHRyYWNrOiBmdW5jdGlvbiAoKSB7IHEudHJhY2tlZCA/IHEuaWQgPSBKKCkgOiBxLnRyYWNrZWQgPSAhMCwgcS50cmFja0NvdW50Kys7IH0gfSwgQ2UoKSAmJiAoZSA9IHJlKCksIG4gPSB0ZSgpLCB0ID0gcG4uY3hlbnNlU2l0ZUlkLCBrLl9fcHJvdGVjdGVkX18uaW5qZWN0SWRzKCEwLCBlLCBuLCB0KSksIEsoKSwgcG4uaXNNb2NrTW9kZSB8fCAoby5pc0Z1bmN0aW9uKHAuaW5pdGlhbGl6ZSkgJiYgcC5pbml0aWFsaXplKCksIG8uaXNGdW5jdGlvbih1LmluaXRpYWxpemUpICYmIHUuaW5pdGlhbGl6ZSgpLCBvLmlzRnVuY3Rpb24oZC5pbml0aWFsaXplKSAmJiBkLmluaXRpYWxpemUoKSksIG8uaXNGdW5jdGlvbihnLmluaXRpYWxpemUpICYmIGcuaW5pdGlhbGl6ZSgpLCBQZSgpLnRoZW4oKGZ1bmN0aW9uIChlKSB7IGUgJiYgKCFqICYmIG8uaXNGdW5jdGlvbih5LmluaXRpYWxpemUpICYmIChqID0gITAsIHkuaW5pdGlhbGl6ZSgpKSwgRCB8fCAtMSAhPT0gVS5pbmRleE9mKFIuREFUQVRSQU5TX0FQUExFX1BBWSkgJiYgby5pc0Z1bmN0aW9uKGIuaW5pdGlhbGl6ZSkgJiYgKEQgPSAhMCwgYi5pbml0aWFsaXplKCkpKTsgfSkpLCBvLmlzRnVuY3Rpb24ody5fX3Byb3RlY3RlZF9fLmluaXQpICYmIHNldFRpbWVvdXQoKGZ1bmN0aW9uICgpIHsgdy5fX3Byb3RlY3RlZF9fLmluaXQoKS5jYXRjaCgoZnVuY3Rpb24gKCkgeyB9KSk7IH0pLCA1ZTMpLCBvLmlzRnVuY3Rpb24oYy5yZWZyZXNoQWNjZXNzVG9rZW4pICYmIGMucmVmcmVzaEFjY2Vzc1Rva2VuKCksIF9lKCk7XG4gICAgICAgICAgICB2YXIgciA9IGMuZ2V0UHJvdmlkZXIoKTtcbiAgICAgICAgICAgIHIgJiYgby5pc0Z1bmN0aW9uKHIuZXh0ZW5kVXNlclRva2VuKSAmJiByLmV4dGVuZFVzZXJUb2tlbigpLCBvLm9uKHdpbmRvdywgXCJiZWZvcmV1bmxvYWRcIiwgKGZ1bmN0aW9uICgpIHsgcmV0dXJuIHZlKCk7IH0pKSwgby5vbih3aW5kb3csIFwidW5sb2FkXCIsIChmdW5jdGlvbiAoKSB7IHJldHVybiB2ZSgpOyB9KSksIF8uYWRkQ2FwdGNoYVYzKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgaS5sb2coXCJNdXN0IHN1cHBseSBhIHZhbGlkIHRwLmFpZCBiZWZvcmUgY2FsbGluZyB0cC5pbml0KClcIik7IH0sIGNoZWNrVG9SdW5XaWRnZXRJbW1lZGlhdGVseTogZnVuY3Rpb24gKCkgeyB2YXIgZTsga2UoKSwgKGUgPSBpLmdldFF1ZXJ5UGFyYW1CeU5hbWUoXCJ2ZXJpZmljYXRpb25fY29kZVwiKSkgJiYgXCJwaWFub0lkXCIgPT09IGMuZ2V0UHJvdmlkZXIoKS5uYW1lICYmIGkud2FpdENhbGwoXCJvZmZlckNyZWF0ZVwiLCAoZnVuY3Rpb24gKCkgeyBoLmlzVXNlclZhbGlkKCkgPyBoLl9fcHJvdGVjdGVkX18uc2hvd0VtYWlsQ29uZmlybWF0aW9uKHsgdmVyaWZpY2F0aW9uX2NvZGU6IGUgfSkgOiBoLnNob3coeyB2ZXJpZmljYXRpb25fY29kZTogZSB9KTsgfSkpLCBoLmNoZWNrQW5kU2hvd0VtYWlsSXNOb3RDb25maXJtZWQoKSwgby5pc0Z1bmN0aW9uKGYuY2hlY2tUaHJlZURTUmVkaXJlY3QpICYmIGYuY2hlY2tUaHJlZURTUmVkaXJlY3QoKTsgfSwgdHJhY2tBZHM6IGJlLCBhcHBIYXNBcHBsZVBheTogZnVuY3Rpb24gKCkgeyByZXR1cm4gTjsgfSwgX19wcml2YXRlX186IHsgVklTSVRfSURfQ09PS0lFOiBQLCBWT1VDSEVSX1FVRVJZOiB4LCBjb2xsZWN0ZWRBZHM6IEEsIHVubG9hZFJlZ2lzdGVyZWQ6IEUsIHVubG9hZFRyaWdnZXJlZDogVCwgZ2V0UGFnZVZpZXc6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHE7IH0sIGdldFZpc2l0Q29udGFpbmVyOiBmdW5jdGlvbiAoKSB7IHJldHVybiBWOyB9LCB0cmFjazogdWUsIGNoZWNrVm91Y2hlcjoga2UsIHNldFBhZ2VWaWV3SWQ6IHdlLCBjdXJyZW50RW52aXJvbm1lbnRTdXBwb3J0c1BhZ2VUcmFjazogbGUsIGJ1aWxkUGFnZVVubG9hZFBhcmFtczogZWUsIGludmFsaWRhdGVMYXN0VmlzaXQ6IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSBRKCk7IHQucmVtb3ZlKFAsIGUpOyB9LCBnZXRDdXJyZW50RG9tYWluOiBILCBsb2FkTGFzdFZpc2l0OiB6LCBzZXRWaXNpdEN1cnJlbnREb21haW46IGNlLCBzYXZlVmlzaXRDb29raWU6IFgsIGdldFZpc2l0Q29va2llT3B0aW9uczogUSwgaXNUaW1lRXhwaXJlZDogJCwgcmVmcmVzaFZpc2l0OiBLLCBnZW5lcmF0ZVBhZ2VWaWV3SWQ6IEcsIHRyYWNrQ29sbGVjdGVkQWRzOiBXLCB1bmxvYWRIYW5kbGVyOiB2ZSwgdW5sb2FkQWN0aW9uOiBmZSwgYnVpbGRQYWdlQ3VzdG9tUGFyYW1zOiBuZSwgaGFzRXh0ZXJuYWxSZWZlcnJlcjogWSB9IH07IH07XG4gICAgcG4uY29udGFpbmVyLnJlZ2lzdGVyKFwibWFpblwiLCB7IHVzZVZhbHVlOiBQbigpIH0pLCBwbi5tYWluID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJtYWluXCIpO1xuICAgIHZhciBFbiA9IHsgcHJlZGVmaW5lVmFsdWVzOiBbXSB9O1xuICAgIHdpbmRvdy50cCAmJiB3aW5kb3cudHAubGVuZ3RoICYmIChFbi5wcmVkZWZpbmVWYWx1ZXMgPSBfZShbXSwgd2luZG93LnRwIHx8IFtdLCAhMCkpLCBwbi50cFByZWRlZmluZWRPcHRpb25zID0gRW4sIHBuLmNvbnRhaW5lci5yZWdpc3RlcihcInRwUHJlZGVmaW5lZE9wdGlvbnNcIiwgeyB1c2VWYWx1ZTogRW4gfSk7XG4gICAgdmFyIFRuID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiBlKGUsIG4sIHQsIHIsIG8pIHsgdGhpcy50cFByZWRlZmluZWRPcHRpb25zID0gZSwgdGhpcy5jc3MgPSBuLCB0aGlzLnRpbnlwYXNzRXJyb3JIYW5kbGVyID0gdCwgdGhpcy5nYVNlcnZpY2UgPSByLCB0aGlzLnV0aWxTZXJ2aWNlID0gbywgdGhpcy5mdWxsVFBWZXJzaW9uID0gITEsIHRoaXMuaXNJbml0aWFsaXplZCA9ICExLCB0aGlzLmFpZCA9IFwiXCIsIHRoaXMuaXNTZW5zaXRpdmVEYXRhUHJvdGVjdGlvbkVuYWJsZWQgPSAhMSwgdGhpcy5hZmZpbGlhdGVUb2tlbk5hbWUgPSBcImFmZmlsaWF0ZVRva2VuXCIsIHRoaXMuY3hDZG5VcmwgPSBcImh0dHBzOi8vY2RuLmN4ZW5zZS5jb21cIiwgdGhpcy5jMVhMb2FkQ2NlID0gITAsIHRoaXMuYzFYSW50ZWdyYXRpb25WZXJzaW9uID0gXCJ2MlwiLCB0aGlzLmN4ZW5zZUxpYkF3YWl0aW5nVGltZW91dCA9IDAsIHRoaXMuY3hlbnNlTGliQXdhaXRpbmdSZXRyeUNvdW50ID0gMCwgdGhpcy50cmFja1BhZ2VzID0gITAsIHRoaXMuZGVidWcgPSAhMSwgdGhpcy51c2VyUmVmID0gXCJcIiwgdGhpcy51c2VQaWFub0lkTGl0ZVVzZXJQcm92aWRlciA9ICExLCB0aGlzLnVzZVRpbnlwYXNzQWNjb3VudHMgPSAhMSwgdGhpcy51c2VDb25kZVVzZXJQcm92aWRlciA9ICExLCB0aGlzLnVzZUdpZ3lhVXNlclByb3ZpZGVyID0gITEsIHRoaXMudXNlUGlhbm9JZFVzZXJQcm92aWRlciA9ICExLCB0aGlzLnVzZUFpZFNwZWNpZmllZENvb2tpZXMgPSAhMSwgdGhpcy5zYW5kYm94ID0gITEsIHRoaXMuekluZGV4ZXMgPSB7IGJhY2tkcm9wOiAzZTUsIG1vZGFsOiAzMDAwNTAsIGNsb3NlOiAzMDAxMDAgfSwgdGhpcy5jdXN0b21QcmVDaGVja3MgPSBbXSwgdGhpcy5jdXN0b21QYXJhbXMgPSB7fSwgdGhpcy5leHRlcm5hbExpYnJhcmllcyA9IFtdLCB0aGlzLmV4dGVybmFsTGlicmFyaWVzQ2FsbGJhY2tzID0gW10sIHRoaXMuY3VzdG9tVmFyaWFibGVzID0ge30sIHRoaXMubG9jYWxlID0gXCJcIiwgdGhpcy50cmFja1BhZ2VWaWV3ID0gITAsIHRoaXMucmVkaXJlY3RUb0ZiVGltZW91dCA9IDMsIHRoaXMuaXNEb3VibGVPcHRJbkNoZWNrT25BY2Nlc3NDaGVja0VuYWJsZWQgPSAhMSwgdGhpcy5pc01vY2tNb2RlID0gITEsIHRoaXMuaW5hcHBCcm93c2VyUmV0dXJuID0gITEsIHRoaXMuZXZlbnRzID0gW10sIHRoaXMuYXBwTGlzdCA9IFtdLCB0aGlzLmNhY2hlYWJsZVNob3dUZW1wbGF0ZSA9ICEwLCB0aGlzLmluaXRDYWxsYmFja3MgPSBbXSwgdGhpcy5tYWluTW9kdWxlSW5pdGVkID0gITEsIHRoaXMucmVzdENhbGxiYWNrcyA9IFtdLCB0aGlzLmluaXRUcmllcyA9IDAsIHRoaXMuY2FsbGJhY2tzID0gW10sIG4ubG9hZE9mZmVyQ3NzKCk7IH0gcmV0dXJuIGUucHJvdG90eXBlLmluaXRUcCA9IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSB0aGlzOyB0cnkge1xuICAgICAgICB2YXIgbiA9IHRoaXMudHBQcmVkZWZpbmVkT3B0aW9ucy5wcmVkZWZpbmVWYWx1ZXM7XG4gICAgICAgIGlmICh0aGlzLnRwUHJlZGVmaW5lZE9wdGlvbnMucHJlZGVmaW5lVmFsdWVzID0gW10sIG4uZm9yRWFjaCgoZnVuY3Rpb24gKG4pIHsgXCJmdW5jdGlvblwiID09IHR5cGVvZiBuWzFdID8gXCJpbml0XCIgPT09IG5bMF0gPyBlLmluaXRDYWxsYmFja3MucHVzaChuWzFdKSA6IGUucmVzdENhbGxiYWNrcy5wdXNoKG4pIDogXCJpbml0XCIgPT09IG5bMV0gJiYgXCJmdW5jdGlvblwiID09IHR5cGVvZiBuWzJdID8gZS5pbml0Q2FsbGJhY2tzLnB1c2goblsyXSkgOiBlLnB1c2gobik7IH0pKSwgIXRoaXMuYWlkICYmIHRoaXMuaW5pdFRyaWVzIDwgMTApXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5pbml0VHJpZXMrKywgdm9pZCBzZXRUaW1lb3V0KChmdW5jdGlvbiAoKSB7IHJldHVybiBlLmluaXRUcCgpOyB9KSwgNTApO1xuICAgICAgICBpZiAoIXRoaXMuYWlkKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBmb3IgKHRoaXMudGlueXBhc3NFcnJvckhhbmRsZXIuaW5pdGlhbGl6ZSgpOyB0aGlzLnJlc3RDYWxsYmFja3MubGVuZ3RoOylcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgdmFyIHQgPSB0aGlzLnJlc3RDYWxsYmFja3Muc2hpZnQoKTtcbiAgICAgICAgICAgICAgICB0aGlzLnB1c2godCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZSksIHBuLnRpbnlwYXNzRXJyb3JIYW5kbGVyLmFkZEVycm9yKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB0aGlzLl9pbml0KCksIHRoaXMuZXh0ZXJuYWxMaWJyYXJpZXMubGVuZ3RoICYmIHRoaXMucmVhbGl6ZUV4dGVybmFsTGlicmFyaWVzKCksIHRoaXMuaXNJbml0aWFsaXplZCA9ICEwLCB3aW5kb3cuX19fdHAgPSBmdW5jdGlvbiAoKSB7IH07XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIHBuLnRpbnlwYXNzRXJyb3JIYW5kbGVyLmFkZEVycm9yKGUsIFwiaW5pdFRQXCIpO1xuICAgIH0gfSwgZS5wcm90b3R5cGUucmVhbGl6ZUV4dGVybmFsTGlicmFyaWVzID0gZnVuY3Rpb24gKCkgeyB2YXIgZSA9IHRoaXMsIG4gPSBbXTsgdGhpcy5leHRlcm5hbExpYnJhcmllcy5mb3JFYWNoKChmdW5jdGlvbiAodCkgeyB2YXIgciA9IGUucmVxdWlyZUpzRmlsZSh0KTsgbi5wdXNoKHIpOyB9KSksIFByb21pc2UuYWxsKG4pLnRoZW4oKGZ1bmN0aW9uICgpIHsgaWYgKGUuZXh0ZXJuYWxMaWJyYXJpZXMgPSBbXSwgZS5leHRlcm5hbExpYnJhcmllc0NhbGxiYWNrcylcbiAgICAgICAgZm9yICh2YXIgbiA9IDA7IG4gPCBlLmV4dGVybmFsTGlicmFyaWVzQ2FsbGJhY2tzLmxlbmd0aDsgKytuKVxuICAgICAgICAgICAgTW4uZXh0ZXJuYWxMaWJyYXJpZXNDYWxsYmFja3Nbbl0oKTsgTW4uZXh0ZXJuYWxMaWJyYXJpZXNDYWxsYmFja3MgPSBbXTsgfSkpOyB9LCBlLnByb3RvdHlwZS5wdXNoID0gZnVuY3Rpb24gKCkgeyBmb3IgKHZhciBlLCBuLCB0LCByID0gW10sIG8gPSAwOyBvIDwgYXJndW1lbnRzLmxlbmd0aDsgbysrKVxuICAgICAgICByW29dID0gYXJndW1lbnRzW29dOyBmb3IgKGUgPSAwOyBlIDwgci5sZW5ndGg7IGUrKylcbiAgICAgICAgaWYgKFwic3RyaW5nXCIgPT0gdHlwZW9mIChuID0gKHQgPSByW2VdKS5zaGlmdCgpKSB8fCBuIGluc3RhbmNlb2YgU3RyaW5nKSB7XG4gICAgICAgICAgICBpZiAoIXRoaXNbbl0pXG4gICAgICAgICAgICAgICAgcmV0dXJuIHZvaWQgY29uc29sZS5lcnJvcihcIlVuZGVmaW5lZCBtZXRob2QgXCIgKyBuKTtcbiAgICAgICAgICAgIHRoaXNbbl0uYXBwbHkodGhpcywgdCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgbi5hcHBseSh0aGlzLCB0KTsgfSwgZS5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uIChlKSB7IHRoaXMuaXNJbml0aWFsaXplZCA/ICh0aGlzLm1haW5Nb2R1bGVJbml0ZWQgfHwgKHRoaXMubWFpbk1vZHVsZUluaXRlZCA9ICEwLCB0aGlzLmluaXRNYWluTW9kdWxlQWZ0ZXJJbml0Q2JrKCkpLCBlICYmIGUoKSkgOiAoZSAmJiB0aGlzLnRwUHJlZGVmaW5lZE9wdGlvbnMucHJlZGVmaW5lVmFsdWVzLnB1c2goW1wiaW5pdFwiLCBlXSksIHRoaXMuaW5pdFRwKCkpOyB9LCBlLnByb3RvdHlwZS5faW5pdCA9IGZ1bmN0aW9uICgpIHsgaWYgKHBuLnV0aWwgJiYgcG4udXRpbC5oYXNRdWVyeVBhcmFtQnlOYW1lICYmIHBuLnV0aWwuaGFzUXVlcnlQYXJhbUJ5TmFtZShcInhwZGVidWdcIikgJiYgcG4uc2V0RGVidWcoITApLCBwbi51dGlsLnNldFRwY2NDb29raWVzKCksIHBuLnV0aWwuaXNTYWZhcmlPcklPc1VpV2ViVmlldygpICYmICFwbi51c2VyLmlzVXNlclZhbGlkKCkgJiYgcG4udXRpbC5nZXRRdWVyeVBhcmFtQnlOYW1lKFwidXNlclRva2VuXCIpKSB7XG4gICAgICAgIHZhciBlID0gcG4udXRpbC5nZXRRdWVyeVBhcmFtQnlOYW1lKFwiY29va2llRG9tYWluXCIpLCBuID0gcG4udXRpbC5nZXRRdWVyeVBhcmFtQnlOYW1lKFwidXNlclRva2VuXCIpLCB0ID0gcG4udXRpbC5nZXRRdWVyeVBhcmFtQnlOYW1lKFwidG9rZW5MaXN0VmFsdWVcIik7XG4gICAgICAgIHBuLnV0aWwuc2V0QWNjZXNzVG9rZW5MaXN0Q29va2llKHsgY29va2llX2RvbWFpbjogZSwgdmFsdWU6IHQgfSwgbiksIHBuLnV0aWwucmVtb3ZlUXVlcnlQYXJhbUJ5TmFtZShcInVzZXJUb2tlblwiKSwgcG4udXRpbC5yZW1vdmVRdWVyeVBhcmFtQnlOYW1lKFwiY29va2llRG9tYWluXCIpLCBwbi51dGlsLnJlbW92ZVF1ZXJ5UGFyYW1CeU5hbWUoXCJ0b2tlbkxpc3RWYWx1ZVwiKTtcbiAgICB9IGlmICh0aGlzLm1haW5Nb2R1bGVJbml0ZWQgfHwgKHRoaXMubWFpbk1vZHVsZUluaXRlZCA9ICEwLCB0aGlzLmluaXRNYWluTW9kdWxlQWZ0ZXJJbml0Q2JrKCkpLCAhdGhpcy5haWQpIHtcbiAgICAgICAgdmFyIHIgPSBuZXcgRXJyb3IoXCJJbmNvcnJlY3QgYWlkIGludGVncmF0aW9uOiBcIiArIE1uLmFpZCArIFwiIHVybDogXCIgKyB3aW5kb3cubG9jYXRpb24uaHJlZik7XG4gICAgICAgIHRoaXMudGlueXBhc3NFcnJvckhhbmRsZXIuYWRkRXJyb3Iocik7XG4gICAgfSBwbi5sb2dnaW5nLnNldFRpbWUoXCJjb21wbGV0ZUluaXRcIik7IH0sIGUucHJvdG90eXBlLmluaXRNYWluTW9kdWxlQWZ0ZXJJbml0Q2JrID0gZnVuY3Rpb24gKCkgeyBmb3IgKHBuLnVzZXIucHJvdmlkZXJJbml0KCksIHRoaXMuYXBwTGlzdC5pbmRleE9mKHRoaXMuYWlkKSA8IDAgJiYgKHRoaXMuYXBwTGlzdC5wdXNoKHRoaXMuYWlkKSwgcG4ubWFpbi5pbml0KCkpOyB0aGlzLmluaXRDYWxsYmFja3MubGVuZ3RoOylcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHRoaXMuaW5pdENhbGxiYWNrcy5zaGlmdCgpKCk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZSksIHBuLnRpbnlwYXNzRXJyb3JIYW5kbGVyLmFkZEVycm9yKGUpO1xuICAgICAgICB9IGlmIChwbi5tYWluLmNoZWNrVG9SdW5XaWRnZXRJbW1lZGlhdGVseSgpLCB0aGlzLmV2ZW50cykge1xuICAgICAgICBmb3IgKHZhciBlID0gMDsgZSA8IHRoaXMuZXZlbnRzLmxlbmd0aDsgZSsrKVxuICAgICAgICAgICAgdGhpcy5ldmVudHNbZV0oKTtcbiAgICAgICAgdGhpcy5ldmVudHMgPSBbXTtcbiAgICB9IH0sIGUucHJvdG90eXBlLnJlcXVpcmVKc0ZpbGUgPSBmdW5jdGlvbiAoZSkgeyByZXR1cm4gbmV3IFByb21pc2UoKGZ1bmN0aW9uIChuLCB0KSB7IHZhciByID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNjcmlwdFwiKTsgci5vbmxvYWQgPSBuLCByLm9uZXJyb3IgPSBuLCByLnR5cGUgPSBcInRleHQvamF2YXNjcmlwdFwiLCByLmNoYXJzZXQgPSBcInV0Zi04XCIsIHIuYXN5bmMgPSAhMCwgci5zcmMgPSBlLCBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZShcImhlYWRcIilbMF0uYXBwZW5kQ2hpbGQocik7IH0pKTsgfSwgZS5wcm90b3R5cGUuc2V0QWlkID0gZnVuY3Rpb24gKGUpIHsgdGhpcy5haWQgPSBlOyB9LCBlLnByb3RvdHlwZS5lbmFibGVTZW5zaXRpdmVEYXRhUHJvdGVjdGlvbiA9IGZ1bmN0aW9uIChlKSB7IHRoaXMuaXNTZW5zaXRpdmVEYXRhUHJvdGVjdGlvbkVuYWJsZWQgPSBlOyB9LCBlLnByb3RvdHlwZS5yZWxvYWQgPSBmdW5jdGlvbiAoKSB7IGxvY2F0aW9uLmhyZWYgPSBwbi51dGlsLnJlbW92ZVZvdWNoZXJDb2RlRnJvbVVybChsb2NhdGlvbi5ocmVmKTsgfSwgZS5wcm90b3R5cGUucmVtb3ZlU2hhcmVkQWNjb3VudENvZGVGcm9tVXJsID0gZnVuY3Rpb24gKCkgeyBsb2NhdGlvbi5ocmVmID0gcG4udXRpbC5yZW1vdmVTaGFyZWRBY2NvdW50Q29kZUZyb21VcmwobG9jYXRpb24uaHJlZik7IH0sIGUucHJvdG90eXBlLnNldEdBQ2xpZW50SWQgPSBmdW5jdGlvbiAoZSkgeyB0aGlzLmdhQ2xpZW50SWQgPSBlLCB0aGlzLmdhU2VydmljZS5yZWNyZWF0ZVdpdGhDbGllbnRJZChlKTsgfSwgZS5wcm90b3R5cGUuZ2V0R0FDbGllbnRJZCA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuZ2FDbGllbnRJZDsgfSwgZS5wcm90b3R5cGUuZW5hYmxlR0FDcm9zc0RvbWFpbkxpbmtpbmcgPSBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IHRoaXM7IHRoaXMuZ2FDcm9zc0RvbWFpbkxpbmtpbmcgPSAhMDsgdmFyIHQgPSBEYXRlLm5vdygpLCByID0gZnVuY3Rpb24gKCkgeyB2YXIgbyA9IHdpbmRvdy5nYTsgaWYgKG8gJiYgXCJmdW5jdGlvblwiID09IHR5cGVvZiBvKVxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgbygoZnVuY3Rpb24gKHQpIHsgaWYgKHZvaWQgMCAhPT0gdCAmJiB2b2lkIDAgPT09IGUpXG4gICAgICAgICAgICAgICAgbi5zZXRHQUNsaWVudElkKHQuZ2V0KFwiY2xpZW50SWRcIikpO1xuICAgICAgICAgICAgZWxzZSBpZiAodm9pZCAwICE9PSBlKVxuICAgICAgICAgICAgICAgIGZvciAodmFyIHIgPSBvLmdldEFsbCgpLCBpID0gMDsgaSA8IHIubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGEgPSByW2ldO1xuICAgICAgICAgICAgICAgICAgICBpZiAoYS5nZXQoXCJ0cmFja2luZ0lkXCIpID09PSBlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuLnNldEdBQ2xpZW50SWQoYS5nZXQoXCJjbGllbnRJZFwiKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gfSkpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7IH1cbiAgICBlbHNlXG4gICAgICAgIERhdGUubm93KCkgLSB0IDwgNmU0ICYmIHNldFRpbWVvdXQociwgNTAwKTsgfTsgcigpOyB9LCBlLnByb3RvdHlwZS5zZXRUYWdzID0gZnVuY3Rpb24gKGUpIHsgdGhpcy50YWdzID0gZSBpbnN0YW5jZW9mIEFycmF5ID8gZS5qb2luKFwiLFwiKSA6IGU7IH0sIGUucHJvdG90eXBlLnNldENvb2tpZURvbWFpbiA9IGZ1bmN0aW9uIChlKSB7IFwiLlwiICE9PSBlWzBdICYmIChlID0gXCIuXCIgKyBlKSwgdGhpcy5jb29raWVEb21haW4gPSBlOyB9LCBlLnByb3RvdHlwZS5zZXRDb29raWVQYXRoID0gZnVuY3Rpb24gKGUpIHsgdGhpcy5jb29raWVQYXRoID0gZTsgfSwgZS5wcm90b3R5cGUuc2V0RG9udFNjcm9sbFRvcE1vZGFsID0gZnVuY3Rpb24gKGUpIHsgdGhpcy5kb250U2Nyb2xsVG9wTW9kYWwgPSBlOyB9LCBlLnByb3RvdHlwZS5zZXRVc2VFeHBlcmllbmNlID0gZnVuY3Rpb24gKGUpIHsgdGhpcy51c2VFeHBlcmllbmNlID0gZTsgfSwgZS5wcm90b3R5cGUuc2V0RXhwZXJpbWVudGFsSW9zTW9kYWwgPSBmdW5jdGlvbiAoZSkgeyB0aGlzLmV4cGVyaW1lbnRhbElvc01vZGFsID0gZTsgfSwgZS5wcm90b3R5cGUuc2V0QXBwbGVQYXlNZXJjaGFudElkID0gZnVuY3Rpb24gKGUpIHsgdGhpcy5hcHBsZVBheU1lcmNoYW50SWQgPSBlOyB9LCBlLnByb3RvdHlwZS5zZXRDb250ZW50SXNOYXRpdmUgPSBmdW5jdGlvbiAoZSkgeyB0aGlzLmNvbnRlbnRJc05hdGl2ZSA9IGU7IH0sIGUucHJvdG90eXBlLnNldENvbXBvc2VySG9zdCA9IGZ1bmN0aW9uIChlKSB7IHRoaXMuY29tcG9zZXJIb3N0ID0gZTsgfSwgZS5wcm90b3R5cGUuc2V0RW5kcG9pbnQgPSBmdW5jdGlvbiAoZSkgeyB0aGlzLmVuZHBvaW50ID0gZTsgfSwgZS5wcm90b3R5cGUuc2V0QWZmaWxpYXRlVG9rZW5OYW1lID0gZnVuY3Rpb24gKGUpIHsgdGhpcy5hZmZpbGlhdGVUb2tlbk5hbWUgPSBlOyB9LCBlLnByb3RvdHlwZS5zZXRFc3BFbmRwb2ludCA9IGZ1bmN0aW9uIChlKSB7IHRoaXMuZXNwRW5kcG9pbnQgPSBlOyB9LCBlLnByb3RvdHlwZS5zZXRDeENkblVybCA9IGZ1bmN0aW9uIChlKSB7IHRoaXMuY3hDZG5VcmwgPSBlOyB9LCBlLnByb3RvdHlwZS5zZXRDMVhMb2FkQ2NlID0gZnVuY3Rpb24gKGUpIHsgdGhpcy5jMVhMb2FkQ2NlID0gZTsgfSwgZS5wcm90b3R5cGUuc2V0QzFYSW50ZWdyYXRpb25WZXJzaW9uID0gZnVuY3Rpb24gKGUpIHsgdGhpcy5jMVhJbnRlZ3JhdGlvblZlcnNpb24gPSBlOyB9LCBlLnByb3RvdHlwZS5zZXRDeGVuc2VTaXRlSWQgPSBmdW5jdGlvbiAoZSkgeyB0aGlzLmN4ZW5zZVNpdGVJZCA9IGU7IH0sIGUucHJvdG90eXBlLnNldEN4ZW5zZUxpYkF3YWl0aW5nVGltZW91dCA9IGZ1bmN0aW9uIChlKSB7IHRoaXMuY3hlbnNlTGliQXdhaXRpbmdUaW1lb3V0ID0gZTsgfSwgZS5wcm90b3R5cGUuc2V0Q3hlbnNlTGliQXdhaXRpbmdSZXRyeUNvdW50ID0gZnVuY3Rpb24gKGUpIHsgdGhpcy5jeGVuc2VMaWJBd2FpdGluZ1JldHJ5Q291bnQgPSBlOyB9LCBlLnByb3RvdHlwZS5zZXRDb250ZW50SWQgPSBmdW5jdGlvbiAoZSkgeyB0aGlzLmNvbnRlbnRJZCA9IGU7IH0sIGUucHJvdG90eXBlLnNldFRyYWNrUGFnZXMgPSBmdW5jdGlvbiAoZSkgeyB0aGlzLnRyYWNrUGFnZXMgPSBlOyB9LCBlLnByb3RvdHlwZS5zZXREZWJ1ZyA9IGZ1bmN0aW9uIChlKSB7IHRoaXMuZGVidWcgPSBlOyB9LCBlLnByb3RvdHlwZS5zZXRVc2VyUmVmID0gZnVuY3Rpb24gKGUpIHsgdGhpcy51c2VyUmVmID0gZTsgfSwgZS5wcm90b3R5cGUuc2V0VXNlUGlhbm9JZExpdGVVc2VyUHJvdmlkZXIgPSBmdW5jdGlvbiAoZSkgeyB0aGlzLnVzZVBpYW5vSWRMaXRlVXNlclByb3ZpZGVyID0gZTsgfSwgZS5wcm90b3R5cGUuc2V0RXh0ZXJuYWxKV1QgPSBmdW5jdGlvbiAoZSkgeyB0aGlzLmV4dGVybmFsSldUID0gZTsgfSwgZS5wcm90b3R5cGUuZ2V0RXh0ZXJuYWxKV1QgPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLmV4dGVybmFsSldUOyB9LCBlLnByb3RvdHlwZS5zZXRVc2VUaW55cGFzc0FjY291bnRzID0gZnVuY3Rpb24gKGUpIHsgdGhpcy51c2VUaW55cGFzc0FjY291bnRzID0gZTsgfSwgZS5wcm90b3R5cGUuc2V0VXNlQ29uZGVVc2VyUHJvdmlkZXIgPSBmdW5jdGlvbiAoZSkgeyB0aGlzLnVzZUNvbmRlVXNlclByb3ZpZGVyID0gZTsgfSwgZS5wcm90b3R5cGUuc2V0VXNlR2lneWFVc2VyUHJvdmlkZXIgPSBmdW5jdGlvbiAoZSkgeyB0aGlzLnVzZUdpZ3lhVXNlclByb3ZpZGVyID0gZTsgfSwgZS5wcm90b3R5cGUuc2V0VXNlUGlhbm9JZFVzZXJQcm92aWRlciA9IGZ1bmN0aW9uIChlKSB7IHRoaXMudXNlUGlhbm9JZFVzZXJQcm92aWRlciA9IGU7IH0sIGUucHJvdG90eXBlLnNldFBpYW5vSWRVcmwgPSBmdW5jdGlvbiAoZSkgeyB0aGlzLnBpYW5vSWRVcmwgPSBlOyB9LCBlLnByb3RvdHlwZS5zZXRJdGVtSWQgPSBmdW5jdGlvbiAoZSkgeyB0aGlzLml0ZW1JZCA9IGU7IH0sIGUucHJvdG90eXBlLnNldFVzZUFpZFNwZWNpZmllZENvb2tpZXMgPSBmdW5jdGlvbiAoZSkgeyB0aGlzLnVzZUFpZFNwZWNpZmllZENvb2tpZXMgPSBlOyB9LCBlLnByb3RvdHlwZS5zZXRTYW5kYm94ID0gZnVuY3Rpb24gKGUpIHsgdGhpcy5zYW5kYm94ID0gZTsgfSwgZS5wcm90b3R5cGUuc2V0Q29udGVudENyZWF0ZWRTZWxlY3RvciA9IGZ1bmN0aW9uIChlKSB7IHRoaXMuY29udGVudENyZWF0ZWRTZWxlY3RvciA9IGU7IH0sIGUucHJvdG90eXBlLnNldENvbnRlbnRDcmVhdGVkID0gZnVuY3Rpb24gKGUpIHsgdGhpcy5jb250ZW50Q3JlYXRlZCA9IGU7IH0sIGUucHJvdG90eXBlLnNldENvbnRlbnRBdXRob3IgPSBmdW5jdGlvbiAoZSkgeyB0aGlzLmNvbnRlbnRBdXRob3IgPSBlOyB9LCBlLnByb3RvdHlwZS5zZXRDb250ZW50U2VjdGlvbiA9IGZ1bmN0aW9uIChlKSB7IHRoaXMuY29udGVudFNlY3Rpb24gPSBlOyB9LCBlLnByb3RvdHlwZS5zZXRab25lID0gZnVuY3Rpb24gKGUpIHsgdGhpcy56b25lID0gZSB8fCBcIlwiOyB9LCBlLnByb3RvdHlwZS5pc05vblByb2RFbmRwb2ludCA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIFwic2FuZGJveFwiID09PSB0aGlzLmVuZHBvaW50IHx8IC9eaHR0cHM/OlxcL1xcLyguKnNhbmRib3guKnxcXGQrXFwuZGV2KVxcLih0aW55cGFzc1xcLmNvbXxwaWFub1xcLmlvKS9pLnRlc3QodGhpcy5lbmRwb2ludCk7IH0sIGUucHJvdG90eXBlLnNldFpJbmRleGVzID0gZnVuY3Rpb24gKGUpIHsgdGhpcy56SW5kZXhlcyA9IGU7IH0sIGUucHJvdG90eXBlLnNldEN1c3RvbVByZUNoZWNrID0gZnVuY3Rpb24gKGUpIHsgdGhpcy5jdXN0b21QcmVDaGVja3MucHVzaChlKTsgfSwgZS5wcm90b3R5cGUuc2V0Q3VzdG9tUGFyYW0gPSBmdW5jdGlvbiAoZSwgbiwgdCwgcikgeyB2YXIgbyA9IFtcImNvbnRlbnRcIiwgXCJ1c2VyXCIsIFwicmVxdWVzdFwiXTsgaWYgKHQgfHwgKHQgPSBcImNvbnRlbnRcIiksIHQgPSB0LnRvTG93ZXJDYXNlKCksIG8uaW5kZXhPZih0KSA8IDApXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIlVuZGVmaW5lZCBzY29wZSBcIiArIHQgKyBcIlxcbkF2YWlsYWJsZSBzY29wZXM6IFwiICsgby5qb2luKFwiLCBcIikpOyB2b2lkIDAgPT09IHRoaXMuY3VzdG9tUGFyYW1zW3RdICYmICh0aGlzLmN1c3RvbVBhcmFtc1t0XSA9IHt9KSwgKHZvaWQgMCA9PT0gdGhpcy5jdXN0b21QYXJhbXNbdF1bZV0gfHwgcikgJiYgKHRoaXMuY3VzdG9tUGFyYW1zW3RdW2VdID0gW10pOyBmb3IgKHZhciBpID0gW10uY29uY2F0KG4pLCBhID0gMDsgYSA8IGkubGVuZ3RoOyBhKyspIHtcbiAgICAgICAgaWYgKFwic3RyaW5nXCIgIT0gdHlwZW9mIGlbYV0pXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJzZXRDdXN0b21QYXJhbSBhY2NlcHQgb25seSBzdHJpbmcgdmFsdWVzIG9yIGFycmF5IG9mIHN0cmluZ3NcIik7XG4gICAgICAgIHRoaXMuY3VzdG9tUGFyYW1zW3RdW2VdLnB1c2goaVthXSk7XG4gICAgfSB9LCBlLnByb3RvdHlwZS5yZXNldEN1c3RvbVBhcmFtID0gZnVuY3Rpb24gKGUpIHsgZSB8fCAoZSA9IFwiY29udGVudFwiKSwgZGVsZXRlIHRoaXMuY3VzdG9tUGFyYW1zW2VdOyB9LCBlLnByb3RvdHlwZS5hZGRFeHRlcm5hbExpYnJhcnkgPSBmdW5jdGlvbiAoZSwgbikgeyBpZiAoXCJzdHJpbmdcIiA9PSB0eXBlb2YgZSlcbiAgICAgICAgdGhpcy5leHRlcm5hbExpYnJhcmllcy5wdXNoKGUpO1xuICAgIGVsc2VcbiAgICAgICAgZm9yICh2YXIgdCA9IDA7IHQgPCBlLmxlbmd0aDsgKyt0KVxuICAgICAgICAgICAgdGhpcy5leHRlcm5hbExpYnJhcmllcy5wdXNoKGVbdF0pOyBuICYmIHRoaXMuZXh0ZXJuYWxMaWJyYXJpZXNDYWxsYmFja3MucHVzaChuKSwgdGhpcy5pc0luaXRpYWxpemVkICYmIHRoaXMucmVhbGl6ZUV4dGVybmFsTGlicmFyaWVzKCk7IH0sIGUucHJvdG90eXBlLnNldEN1c3RvbVZhcmlhYmxlID0gZnVuY3Rpb24gKGUsIG4pIHsgdGhpcy5jdXN0b21WYXJpYWJsZXNbZV0gPSBuOyB9LCBlLnByb3RvdHlwZS5zYXZlQ3VzdG9tVmFyaWFibGVzVG9Mb2NhbFN0b3JhZ2UgPSBmdW5jdGlvbiAoZSkgeyBpZiAodGhpcy5jdXN0b21WYXJpYWJsZXMgJiYgXCJsb2NhbFN0b3JhZ2VcIiBpbiB3aW5kb3cgJiYgbnVsbCAhPT0gd2luZG93LmxvY2FsU3RvcmFnZSkge1xuICAgICAgICB2YXIgbiA9IFwiX190cC1jdXN0b21WYXJpYWJsZXNcIjtcbiAgICAgICAgd2luZG93LmxvY2FsU3RvcmFnZS5zZXRJdGVtKG4sIEpTT04uc3RyaW5naWZ5KHRoaXMuY3VzdG9tVmFyaWFibGVzKSksIGUgJiYgd2luZG93LmxvY2FsU3RvcmFnZS5zZXRJdGVtKG4gKyBcIi1leHBpcmF0aW9uXCIsIE1hdGguZmxvb3IoKG5ldyBEYXRlKS5nZXRUaW1lKCkgLyAxZTMpICsgZSArIFwiXCIpO1xuICAgIH0gfSwgZS5wcm90b3R5cGUucmVzdG9yZUN1c3RvbVZhcmliYWxlc0Zyb21Mb2NhbHN0b3JhZ2UgPSBmdW5jdGlvbiAoKSB7IGlmIChcImxvY2FsU3RvcmFnZVwiIGluIHdpbmRvdyAmJiBudWxsICE9PSB3aW5kb3cubG9jYWxTdG9yYWdlKSB7XG4gICAgICAgIHZhciBlID0gTW4udXRpbC5fX3Byb3RlY3RlZF9fLmdldExvY2FsU3RvcmFnZUl0ZW0oXCJjdXN0b21WYXJpYWJsZXNcIik7XG4gICAgICAgIGlmIChNbi51dGlsLl9fcHJvdGVjdGVkX18ucmVtb3ZlTG9jYWxTdG9yYWdlSXRlbShcImN1c3RvbVZhcmlhYmxlc1wiKSwgZSlcbiAgICAgICAgICAgIGZvciAodmFyIG4gaW4gZSlcbiAgICAgICAgICAgICAgICB0aGlzLmN1c3RvbVZhcmlhYmxlc1tuXSA9IGVbbl07XG4gICAgfSB9LCBlLnByb3RvdHlwZS5oYW5kbGVyID0gZnVuY3Rpb24gKGUsIG4pIHsgdmFyIHQgPSB0aGlzLnJlZ2lzdGVyUHJlZml4ZWRFdmVudHM7IHJldHVybiBmdW5jdGlvbiAoKSB7IGZvciAodmFyIHIsIG8gPSBbcG4ub2ZmZXIsIHBuLnRlbXBsYXRlLCBwbi5tZXRlciwgcG4uZXhwZXJpZW5jZSwgcG4ubXlhY2NvdW50LCBwbi5waWFub0lkLCBwbi50aW55cGFzc0xvZ2luLCBwbi5zd2csIHBuLnVzZXIsIHBuLmNyZWRpdF0sIGkgPSAwOyBpIDwgby5sZW5ndGg7IGkrKykge1xuICAgICAgICB2YXIgYSA9IG9baV07XG4gICAgICAgIGlmIChhKSB7XG4gICAgICAgICAgICB2YXIgcyA9IGEucmVnaXN0ZXJDYWxsYmFjayhlLCBuKTtcbiAgICAgICAgICAgIHZvaWQgMCAhPT0gcyAmJiAociA9IHMpLCB2b2lkIDAgIT09IChzID0gdChhLCBlLCBuKSkgJiYgKHIgPSBzKTtcbiAgICAgICAgfVxuICAgIH0gcmV0dXJuIHI7IH07IH0sIGUucHJvdG90eXBlLnJlZ2lzdGVyUHJlZml4ZWRFdmVudHMgPSBmdW5jdGlvbiAoZSwgbiwgdCkgeyBmb3IgKHZhciByLCBvLCBpLCBhID0gW3sgbW9kdWxlOiBcIm9mZmVyXCIsIHByZWZpeDogXCJjaGVja291dFwiIH0sIHsgbW9kdWxlOiBcInBpYW5vSWRcIiwgcHJlZml4OiBcInBpYW5vSWRcIiB9XSwgcyA9IDA7IHMgPCBhLmxlbmd0aDsgcysrKSB7XG4gICAgICAgIHZhciBjID0gYVtzXTtcbiAgICAgICAgZS5uYW1lID09PSBjLm1vZHVsZSAmJiBuLnN1YnN0cmluZygwLCBjLnByZWZpeC5sZW5ndGgpID09PSBjLnByZWZpeCAmJiAociA9IG4uc3Vic3RyaW5nKGMucHJlZml4Lmxlbmd0aCwgYy5wcmVmaXgubGVuZ3RoICsgMSkudG9Mb3dlckNhc2UoKSArIG4uc3Vic3RyaW5nKGMucHJlZml4Lmxlbmd0aCArIDEsIG4ubGVuZ3RoKSwgdm9pZCAwICE9PSAobyA9IGUucmVnaXN0ZXJDYWxsYmFjayhyLCB0KSkgJiYgKGkgPSBvKSk7XG4gICAgfSByZXR1cm4gaTsgfSwgZS5wcm90b3R5cGUuYWRkSGFuZGxlciA9IGZ1bmN0aW9uIChlLCBuKSB7IHZhciB0ID0gdGhpcy5oYW5kbGVyKGUsIG4pOyB0aGlzLmlzSW5pdGlhbGl6ZWQgPyB0KCkgOiB0aGlzLmV2ZW50cy5wdXNoKHQpOyB9LCBlLnByb3RvdHlwZS5zZXRUcmFja1BhZ2V2aWV3ID0gZnVuY3Rpb24gKGUpIHsgdGhpcy50cmFja1BhZ2VWaWV3ID0gZTsgfSwgZS5wcm90b3R5cGUuc2V0TG9jYWxlID0gZnVuY3Rpb24gKGUpIHsgdmFyIG4gPSB0aGlzOyB0aGlzLmxvY2FsZSA9IGUsIHRoaXMudXRpbFNlcnZpY2UuX19wcm90ZWN0ZWRfXy5zZXRDb29raWUoXCJMQU5HXCIsIHRoaXMubG9jYWxlKSwgdGhpcy5pc0luaXRpYWxpemVkID8gdGhpcy5jaGFuZ2VMb2NhbGUoZSkgOiB0aGlzLmluaXRDYWxsYmFja3MucHVzaCgoZnVuY3Rpb24gKCkgeyBuLmNoYW5nZUxvY2FsZShlKTsgfSkpOyB9LCBlLnByb3RvdHlwZS5zZXRQYWdlVVJMID0gZnVuY3Rpb24gKGUpIHsgdGhpcy5jdXN0b21QYWdlVXJsID0gZTsgfSwgZS5wcm90b3R5cGUuc2V0QWRibG9ja2VyQ29va2llTmFtZSA9IGZ1bmN0aW9uIChlKSB7IHRoaXMuYWRibG9ja2VyQ29va2llTmFtZSA9IGU7IH0sIGUucHJvdG90eXBlLnNldE1heENvb2tpZUV4cGlyYXRpb25JbkRheXMgPSBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IFwic3RyaW5nXCIgPT0gdHlwZW9mIGUgPyBwYXJzZUludChlLCAxMCkgOiBlOyBpZiAoIShpc0Zpbml0ZShuKSAmJiBuID4gMCkpXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIm1heENvb2tpZUV4cGlyYXRpb25JbkRheXMgbXVzdCBiZSBhIHBvc2l0aXZlIG51bWJlclwiKTsgdGhpcy5tYXhDb29raWVFeHBpcmF0aW9uSW5EYXlzID0gbjsgfSwgZS5wcm90b3R5cGUuZ2V0TWF4Q29va2llRXhwaXJhdGlvbkluRGF5cyA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMubWF4Q29va2llRXhwaXJhdGlvbkluRGF5czsgfSwgZS5wcm90b3R5cGUuc2V0RmJQaXhlbElkID0gZnVuY3Rpb24gKGUpIHsgdGhpcy5mYlBpeGVsSWQgPSBlOyB9LCBlLnByb3RvdHlwZS5nZXRGYlBpeGVsSWQgPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLmZiUGl4ZWxJZDsgfSwgZS5wcm90b3R5cGUuc2V0UmVkaXJlY3RUb0ZiVGltZW91dCA9IGZ1bmN0aW9uIChlKSB7IHRoaXMucmVkaXJlY3RUb0ZiVGltZW91dCA9IGU7IH0sIGUucHJvdG90eXBlLmVuYWJsZURvdWJsZU9wdEluQ2hlY2tPbkFjY2Vzc0NoZWNrID0gZnVuY3Rpb24gKCkgeyB0aGlzLmlzRG91YmxlT3B0SW5DaGVja09uQWNjZXNzQ2hlY2tFbmFibGVkID0gITA7IH0sIGUucHJvdG90eXBlLnNldENsb3VkZmxhcmVXb3JrZXJVcmwgPSBmdW5jdGlvbiAoZSkgeyB0aGlzLmNsb3VkZmxhcmVXb3JrZXJVcmwgPSBlOyB9LCBlLnByb3RvdHlwZS5nZXRFbmRwb2ludCA9IGZ1bmN0aW9uIChlLCBuKSB7IHJldHVybiBlLmxhc3RJbmRleE9mKFwiL1wiKSA9PT0gZS5sZW5ndGggLSAxICYmIChlID0gZS5zdWJzdHIoMCwgZS5sZW5ndGggLSAxKSksIGUubWF0Y2goL1xcL3YzJC8pICYmIChlID0gZS5zdWJzdHIoMCwgZS5sYXN0SW5kZXhPZihcIi92M1wiKSkpLCBlLm1hdGNoKC9cXC9hcGkkLykgJiYgKGUgPSBlLnN1YnN0cigwLCBlLmxhc3RJbmRleE9mKFwiL2FwaVwiKSkpLCBlLm1hdGNoKC9eKGh0dHBbc10/Oik/XFwvXFwvLykgfHwgKGUgPSBcIi8vXCIgKyBlKSwgdm9pZCAwICE9PSBuICYmIG4gJiYgIWUubWF0Y2goL15odHRwW3NdPzovKSAmJiAoZSA9IFwiaHR0cHM6XCIgKyBlKSwgZTsgfSwgZS5wcm90b3R5cGUuX2dldEVuZHBvaW50Um9vdCA9IGZ1bmN0aW9uIChlKSB7IHZhciBuID0gXCJodHRwczovL2J1eS50aW55cGFzcy5jb21cIjsgcmV0dXJuICEwID09PSB0aGlzLnNhbmRib3ggJiYgKHRoaXMuZW5kcG9pbnQgPSBcInNhbmRib3hcIiksIHRoaXMuZW5kcG9pbnQgJiYgKFwic2FuZGJveFwiID09PSB0aGlzLmVuZHBvaW50ID8gbiA9IFwiaHR0cHM6Ly9zYW5kYm94LnRpbnlwYXNzLmNvbVwiIDogXCJwcm9kXCIgIT09IHRoaXMuZW5kcG9pbnQgJiYgXCJwcm9kdWN0aW9uXCIgIT09IHRoaXMuZW5kcG9pbnQgJiYgKG4gPSB0aGlzLmVuZHBvaW50KSksIHRoaXMuZ2V0RW5kcG9pbnQobiwgZSk7IH0sIGUucHJvdG90eXBlLl9nZXRBcGlFbmRwb2ludCA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuX2dldEVuZHBvaW50Um9vdCgpICsgXCIvYXBpL3YzXCI7IH0sIGUucHJvdG90eXBlLl9nZXRUcmFja2luZ0VuZHBvaW50ID0gZnVuY3Rpb24gKGUpIHsgdm9pZCAwID09PSBlICYmIChlID0gXCJcIik7IHZhciBuID0gZSB8fCB0aGlzLmVuZHBvaW50OyByZXR1cm4gITAgPT09IHRoaXMuc2FuZGJveCA/IG4gPSBcImh0dHBzOi8vc2FuZGJveC50aW55cGFzcy5jb21cIiA6ICh2b2lkIDAgPT09IHRoaXMuZW5kcG9pbnQgfHwgbnVsbCA9PT0gdGhpcy5lbmRwb2ludCB8fCBcIlwiID09PSB0aGlzLmVuZHBvaW50IHx8IFwicHJvZFwiID09PSB0aGlzLmVuZHBvaW50IHx8IFwicHJvZHVjdGlvblwiID09PSB0aGlzLmVuZHBvaW50IHx8IHRoaXMuZW5kcG9pbnQubWF0Y2goLyhidXl8YXBpfGFwaS12MylcXC50aW55cGFzc1xcLmNvbS8pKSAmJiAobiA9IGUgfHwgXCJodHRwczovL2FwaS12My50aW55cGFzcy5jb21cIiksIHRoaXMuZ2V0RW5kcG9pbnQobiwgITApOyB9LCBlLnByb3RvdHlwZS5fZ2V0RXhwZXJpZW5jZUVuZHBvaW50ID0gZnVuY3Rpb24gKGUpIHsgdmFyIG4gPSBcImh0dHBzOi8vYzIucGlhbm8uaW9cIjsgcmV0dXJuIHRoaXMuY29tcG9zZXJIb3N0ID8gbiA9IHRoaXMuY29tcG9zZXJIb3N0IDogKCEwID09PSB0aGlzLnNhbmRib3ggJiYgKHRoaXMuZW5kcG9pbnQgPSBcInNhbmRib3hcIiksIHRoaXMuZW5kcG9pbnQgJiYgKFwic2FuZGJveFwiID09PSB0aGlzLmVuZHBvaW50ID8gbiA9IFwiaHR0cHM6Ly9jMi1zYW5kYm94LnBpYW5vLmlvXCIgOiBcInByb2RcIiAhPT0gdGhpcy5lbmRwb2ludCAmJiBcInByb2R1Y3Rpb25cIiAhPT0gdGhpcy5lbmRwb2ludCAmJiAobiA9IChuID0gKG4gPSAobiA9IChuID0gKG4gPSAobiA9IChuID0gKG4gPSAobiA9IChuID0gKG4gPSAobiA9IChuID0gKG4gPSAobiA9IChuID0gKG4gPSB0aGlzLmVuZHBvaW50KS5yZXBsYWNlKFwiLy9idXkudGlueXBhc3MuY29tXCIsIFwiLy9jMi5waWFuby5pb1wiKSkucmVwbGFjZShcIi8vYXBpLnRpbnlwYXNzLmNvbVwiLCBcIi8vYzIucGlhbm8uaW9cIikpLnJlcGxhY2UoXCIvL2J1eS1hdS5waWFuby5pb1wiLCBcIi8vYzItYXUucGlhbm8uaW9cIikpLnJlcGxhY2UoXCIvL2FwaS1hdS5waWFuby5pb1wiLCBcIi8vYzItYXUucGlhbm8uaW9cIikpLnJlcGxhY2UoXCIvL2J1eS1hcC5waWFuby5pb1wiLCBcIi8vYzItYXAucGlhbm8uaW9cIikpLnJlcGxhY2UoXCIvL2FwaS1hcC5waWFuby5pb1wiLCBcIi8vYzItYXAucGlhbm8uaW9cIikpLnJlcGxhY2UoXCIvL2J1eS1ldS5waWFuby5pb1wiLCBcIi8vYzItZXUucGlhbm8uaW9cIikpLnJlcGxhY2UoXCIvL2FwaS1ldS5waWFuby5pb1wiLCBcIi8vYzItZXUucGlhbm8uaW9cIikpLnJlcGxhY2UoXCIvL3NhbmRib3gudGlueXBhc3MuY29tXCIsIFwiLy9jMi1zYW5kYm94LnBpYW5vLmlvXCIpKS5yZXBsYWNlKFwiLy9zYW5kYm94LnBpYW5vLmlvXCIsIFwiLy9jMi1zYW5kYm94LnBpYW5vLmlvXCIpKS5yZXBsYWNlKFwiLy9leHBlcmllbmNlLWF1LnBpYW5vLmlvXCIsIFwiLy9jMi1hdS5waWFuby5pb1wiKSkucmVwbGFjZShcIi8vZXhwZXJpZW5jZS1ldS5waWFuby5pb1wiLCBcIi8vYzItZXUucGlhbm8uaW9cIikpLnJlcGxhY2UoXCIvL2V4cGVyaWVuY2UtYXAucGlhbm8uaW9cIiwgXCIvL2MyLWFwLnBpYW5vLmlvXCIpKS5yZXBsYWNlKFwiLy9leHBlcmllbmNlLnRpbnlwYXNzLmNvbVwiLCBcIi8vYzIucGlhbm8uaW9cIikpLnJlcGxhY2UoXCIvL2J1eS5waWFuby5pb1wiLCBcIi8vYzIucGlhbm8uaW9cIikpLnJlcGxhY2UoXCIvL2FwaS5waWFuby5pb1wiLCBcIi8vYzIucGlhbm8uaW9cIikpLnJlcGxhY2UoXCIvL2V4cGVyaWVuY2UucGlhbm8uaW9cIiwgXCIvL2MyLnBpYW5vLmlvXCIpKSkpLCB0aGlzLmdldEVuZHBvaW50KG4sIGUpOyB9LCBlLnByb3RvdHlwZS5faXNTYW5kYm94ID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5zYW5kYm94IHx8IFwic2FuZGJveFwiID09PSB0aGlzLmVuZHBvaW50IHx8ICEhdGhpcy5lbmRwb2ludCAmJiAtMSAhPT0gdGhpcy5lbmRwb2ludC5pbmRleE9mKFwiLy9zYW5kYm94LnRpbnlwYXNzLmNvbVwiKTsgfSwgZS5wcm90b3R5cGUuY2hhbmdlTG9jYWxlID0gZnVuY3Rpb24gKGUpIHsgcG4ucGlhbm9JZC5pc0NvbmZpZ3VyZWQoKSAmJiBwbi5waWFub0lkLnVwZGF0ZUxhbmcoZSksIHBuLnBvc3RtZXNzYWdlLmJyb2FkY2FzdChcImxhbmdDaGFuZ2VkXCIsIHsgbGFuZzogZSB9KTsgfSwgZS5wcm90b3R5cGUucGFnZVRyYWNrID0gZnVuY3Rpb24gKGUsIG4pIHsgcG4ubWFpbi5wYWdlVHJhY2soZSwgbik7IH0sIGUucHJvdG90eXBlLnRyYWNrUGFnZSA9IGZ1bmN0aW9uIChlLCBuKSB7IHBuLm1haW4ucGFnZVRyYWNrKGUsIG4pOyB9LCBlLnByb3RvdHlwZS50cmFja1BhZ2VVbmxvYWQgPSBmdW5jdGlvbiAoKSB7IHBuLm1haW4udHJhY2tQYWdlVW5sb2FkKCk7IH0sIGUucHJvdG90eXBlLnRyYWNrQWRzID0gZnVuY3Rpb24gKGUpIHsgcG4ubWFpbi50cmFja0FkcyhlKTsgfSwgZS5wcm90b3R5cGUudHJhY2tBZCA9IGZ1bmN0aW9uIChlLCBuLCB0KSB7IHBuLm1haW4udHJhY2tBZChlLCBuLCB0KTsgfSwgZS5wcm90b3R5cGUub25Mb2FkID0gZnVuY3Rpb24gKGUpIHsgdGhpcy5jYWxsYmFja3MucHVzaChlKTsgfSwgZS5wcm90b3R5cGUuZ2V0RW5kcG9pbnRSb290ID0gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIHRoaXMuX2dldEVuZHBvaW50Um9vdChlKTsgfSwgZS5wcm90b3R5cGUuZ2V0RXhwZXJpZW5jZUVuZHBvaW50ID0gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIHRoaXMuX2dldEV4cGVyaWVuY2VFbmRwb2ludChlKTsgfSwgZS5wcm90b3R5cGUuZ2V0QXBpRW5kcG9pbnQgPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLl9nZXRBcGlFbmRwb2ludCgpOyB9LCBlLnByb3RvdHlwZS5nZXRUcmFja2luZ0VuZHBvaW50ID0gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIHZvaWQgMCA9PT0gZSAmJiAoZSA9IFwiXCIpLCB0aGlzLl9nZXRUcmFja2luZ0VuZHBvaW50KGUpOyB9LCBlLnByb3RvdHlwZS5pc1NhbmRib3ggPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLl9pc1NhbmRib3goKTsgfSwgZS5wcm90b3R5cGUuc2V0Q2FjaGVhYmxlU2hvd1RlbXBsYXRlID0gZnVuY3Rpb24gKGUpIHsgdGhpcy5jYWNoZWFibGVTaG93VGVtcGxhdGUgPSBlOyB9LCBlLnByb3RvdHlwZS5nZXRDYWNoZWFibGVTaG93VGVtcGxhdGUgPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLmNhY2hlYWJsZVNob3dUZW1wbGF0ZTsgfSwgZSA9IGZ1bmN0aW9uIChlLCBuLCB0LCByKSB7IHZhciBvLCBpID0gYXJndW1lbnRzLmxlbmd0aCwgYSA9IGkgPCAzID8gbiA6IG51bGwgPT09IHIgPyByID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihuLCB0KSA6IHI7IGlmIChcIm9iamVjdFwiID09IHR5cGVvZiBSZWZsZWN0ICYmIFwiZnVuY3Rpb25cIiA9PSB0eXBlb2YgUmVmbGVjdC5kZWNvcmF0ZSlcbiAgICAgICAgYSA9IFJlZmxlY3QuZGVjb3JhdGUoZSwgbiwgdCwgcik7XG4gICAgZWxzZVxuICAgICAgICBmb3IgKHZhciBzID0gZS5sZW5ndGggLSAxOyBzID49IDA7IHMtLSlcbiAgICAgICAgICAgIChvID0gZVtzXSkgJiYgKGEgPSAoaSA8IDMgPyBvKGEpIDogaSA+IDMgPyBvKG4sIHQsIGEpIDogbyhuLCB0KSkgfHwgYSk7IHJldHVybiBpID4gMyAmJiBhICYmIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShuLCB0LCBhKSwgYTsgfShbcG4uc2luZ2xldG9uKCksIGJlKDAsIHBuLmluamVjdChcInRwUHJlZGVmaW5lZE9wdGlvbnNcIikpLCBiZSgxLCBwbi5pbmplY3QoXCJjc3NcIikpLCBiZSgyLCBwbi5pbmplY3QoXCJ0aW55cGFzc0Vycm9ySGFuZGxlclwiKSksIGJlKDMsIHBuLmluamVjdChcImdhU2VydmljZVwiKSksIGJlKDQsIHBuLmluamVjdChcInV0aWxcIikpLCBrZShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtPYmplY3QsIE9iamVjdCwgT2JqZWN0LCBPYmplY3QsIE9iamVjdF0pXSwgZSksIGU7IH0oKTtcbiAgICBwbi5jb250YWluZXIucmVnaXN0ZXJTaW5nbGV0b24oXCJ0aW55cGFzc1wiLCBUbik7XG4gICAgdmFyIEFuID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJ0aW55cGFzc1wiKTtcbiAgICBbeyBuOiBcInBvbHlmaWxsXCIsIGhNOiAhMSB9LCB7IG46IFwicHJlZGVmaW5lXCIsIGhNOiAhMSB9LCB7IG46IFwicHJlZGVmaW5lVGlueXBhc3NcIiwgaE06ICExIH0sIHsgbjogXCJjaGVja1RpbnlwYXNzXCIsIGhNOiAhMSB9LCB7IG46IFwiY3NzXCIsIGhNOiAhMCB9LCB7IG46IFwiYWpheFwiLCBoTTogITAgfSwgeyBuOiBcImpxVXRpbHNcIiwgaE06ICEwIH0sIHsgbjogXCJjb29raWVcIiwgaE06ICEwIH0sIHsgbjogXCJsb2NhbFN0b3JhZ2VcIiwgaE06ICEwIH0sIHsgbjogXCJ2ZXJzaW9uU2VydmljZVwiLCBoTTogITAgfSwgeyBuOiBcIml0cFwiLCBoTTogITAgfSwgeyBuOiBcInV0aWxcIiwgaE06ICEwIH0sIHsgbjogXCJhcGlcIiwgaE06ICEwIH0sIHsgbjogXCJwb3N0bWVzc2FnZVwiLCBoTTogITAgfSwgeyBuOiBcImV2ZW50VXRpbHNcIiwgaE06ICEwIH0sIHsgbjogXCJqYW5yYWluXCIsIGhNOiAhMCB9LCB7IG46IFwic2hhMVwiLCBoTTogITAgfSwgeyBuOiBcImNvbnRhaW5lclV0aWxzXCIsIGhNOiAhMCB9LCB7IG46IFwidGlueXBhc3NMb2dpblwiLCBoTTogITAgfSwgeyBuOiBcInRpbnlwYXNzQWNjb3VudHNcIiwgaE06ICEwIH0sIHsgbjogXCJjb25kZVVzZXJQcm92aWRlclwiLCBoTTogITAgfSwgeyBuOiBcImdpZ3lhXCIsIGhNOiAhMCB9LCB7IG46IFwiand0RGVjb2RlXCIsIGhNOiAhMCB9LCB7IG46IFwibG9nXCIsIGhNOiAhMCB9LCB7IG46IFwibG9nZ2luZ1wiLCBoTTogITAgfSwgeyBuOiBcIm9ic2VydmVyXCIsIGhNOiAhMCB9LCB7IG46IFwiZ2FTZXJ2aWNlXCIsIGhNOiAhMCB9LCB7IG46IFwicGlhbm9JZExpdGVcIiwgaE06ICEwIH0sIHsgbjogXCJwaWFub0lkXCIsIGhNOiAhMCB9LCB7IG46IFwidXNlclwiLCBoTTogITAgfSwgeyBuOiBcInZpZXdwb3J0RXhpdFwiLCBoTTogITAgfSwgeyBuOiBcInRlbXBsYXRlXCIsIGhNOiAhMCB9LCB7IG46IFwib2ZmZXJcIiwgaE06ICEwIH0sIHsgbjogXCJteWFjY291bnRcIiwgaE06ICEwIH0sIHsgbjogXCJtZXRlclwiLCBoTTogITAgfSwgeyBuOiBcImZpbmdlcnByaW50XCIsIGhNOiAhMCB9LCB7IG46IFwic2Nyb2xsRGVwdGhcIiwgaE06ICEwIH0sIHsgbjogXCJpZGxlXCIsIGhNOiAhMCB9LCB7IG46IFwiaW50ZXJhY3Rpb25cIiwgaE06ICEwIH0sIHsgbjogXCJyZWNXaWRnZXRTZXJ2aWNlXCIsIGhNOiAhMCB9LCB7IG46IFwicGlhbm9cIiwgaE06ICEwIH0sIHsgbjogXCJwaWFub0VzcFwiLCBoTTogITAgfSwgeyBuOiBcInN3Z1wiLCBoTTogITAgfSwgeyBuOiBcImZicGl4ZWxcIiwgaE06ICEwIH0sIHsgbjogXCJmYnN1YnNjcmlwdGlvbnNcIiwgaE06ICEwIH0sIHsgbjogXCJjeGVuc2VcIiwgaE06ICEwIH0sIHsgbjogXCJleHBlcmllbmNlXCIsIGhNOiAhMCB9LCB7IG46IFwiaWZ2aXNpYmxlXCIsIGhNOiAhMCB9LCB7IG46IFwiYWN0aXZldGltZXJcIiwgaE06ICEwIH0sIHsgbjogXCJkb3VibGVDbGlja0ZvclB1Ymxpc2hlclwiLCBoTTogITAgfSwgeyBuOiBcImFwcGxlUGF5XCIsIGhNOiAhMCB9LCB7IG46IFwiZ29DYXJkbGVzc0Ryb3BpblwiLCBoTTogITAgfSwgeyBuOiBcImFwcGxlUGF5SW50ZWdyYXRpb25TZXJ2aWNlXCIsIGhNOiAhMCB9LCB7IG46IFwiZGF0YXRyYW5zQXBwbGVQYXlJbnRlZ3JhdGlvblNlcnZpY2VcIiwgaE06ICEwIH0sIHsgbjogXCJzdHJpcGVBcHBsZVBheUludGVncmF0aW9uU2VydmljZVwiLCBoTTogITAgfSwgeyBuOiBcIm9iaTNEU0NoYWxsZW5nZVwiLCBoTTogITAgfSwgeyBuOiBcImFtcFwiLCBoTTogITAgfSwgeyBuOiBcInBlcmZvcm1hbmNlTWV0cmljc1wiLCBoTTogITAgfSwgeyBuOiBcImRvdWJsZU9wdEluXCIsIGhNOiAhMCB9LCB7IG46IFwibmV3c2N5Y2xlXCIsIGhNOiAhMCB9LCB7IG46IFwiY2FwdGNoYVYzXCIsIGhNOiAhMCB9LCB7IG46IFwibWFpblwiLCBoTTogITAgfSwgeyBuOiBcInRpbnlwYXNzRXJyb3JIYW5kbGVyXCIsIGhNOiAhMCB9LCB7IG46IFwidGlueXBhc3NcIiwgaE06ICEwIH0sIHsgbjogXCJwb3N0UHJvY2Vzc2luZ1wiLCBoTTogITEgfV0uZm9yRWFjaCgoZnVuY3Rpb24gKGUpIHsgZS5oTSAmJiAhcG4uY29udGFpbmVyLmlzUmVnaXN0ZXJlZChlLm4pICYmIHBuLmNvbnRhaW5lci5yZXNvbHZlKGUubik7IH0pKSwgT2JqZWN0LmFzc2lnbihwbiwgQW4pLCBPYmplY3Quc2V0UHJvdG90eXBlT2YocG4sIFRuLnByb3RvdHlwZSk7XG4gICAgdmFyIE1uID0gd2luZG93LnRwID0gcG47XG4gICAgcG4uaW5pdFRwKCksIGNvbnNvbGUubG9nKFwiUGlhbm8gU0RLIDIuMCBsb2FkZWQuXCIpO1xuICAgIGUuY3hlbnNlID0gbG4sIGUuZXhwZXJpZW5jZSA9IHVuLCBlLmpxVXRpbHMgPSBkZSwgZS5sb2cgPSBPZSwgZS5tYWluID0gUG4sIGUub2ZmZXIgPSBHZSwgZS5waWFub0VzcCA9IG9uLCBlLnBpYW5vSWQgPSBxZSwgZS5wb3N0UHJvY2Vzc2luZyA9IFwicG9zdFByb2Nlc3NpbmdcIiwgZS50aW55cGFzc0Vycm9ySGFuZGxlciA9IHhuLCBlLnVzZXIgPSBIZSwgZS51dGlsID0gQ2UsIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogITAgfSk7XG59KHt9KTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXRpbnlwYXNzLmpzLm1hcCIsIi8vIFRoZSBtb2R1bGUgY2FjaGVcbnZhciBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18gPSB7fTtcblxuLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbmZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG5cdHZhciBjYWNoZWRNb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdO1xuXHRpZiAoY2FjaGVkTW9kdWxlICE9PSB1bmRlZmluZWQpIHtcblx0XHRyZXR1cm4gY2FjaGVkTW9kdWxlLmV4cG9ydHM7XG5cdH1cblx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcblx0dmFyIG1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0gPSB7XG5cdFx0Ly8gbm8gbW9kdWxlLmlkIG5lZWRlZFxuXHRcdC8vIG5vIG1vZHVsZS5sb2FkZWQgbmVlZGVkXG5cdFx0ZXhwb3J0czoge31cblx0fTtcblxuXHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cblx0X193ZWJwYWNrX21vZHVsZXNfX1ttb2R1bGVJZF0obW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cblx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcblx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xufVxuXG4iLCIvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuX193ZWJwYWNrX3JlcXVpcmVfXy5uID0gKG1vZHVsZSkgPT4ge1xuXHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cblx0XHQoKSA9PiAobW9kdWxlWydkZWZhdWx0J10pIDpcblx0XHQoKSA9PiAobW9kdWxlKTtcblx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgeyBhOiBnZXR0ZXIgfSk7XG5cdHJldHVybiBnZXR0ZXI7XG59OyIsIi8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb25zIGZvciBoYXJtb255IGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uZCA9IChleHBvcnRzLCBkZWZpbml0aW9uKSA9PiB7XG5cdGZvcih2YXIga2V5IGluIGRlZmluaXRpb24pIHtcblx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZGVmaW5pdGlvbiwga2V5KSAmJiAhX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIGtleSkpIHtcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBrZXksIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBkZWZpbml0aW9uW2tleV0gfSk7XG5cdFx0fVxuXHR9XG59OyIsIl9fd2VicGFja19yZXF1aXJlX18ubyA9IChvYmosIHByb3ApID0+IChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBwcm9wKSkiLCIvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSAoZXhwb3J0cykgPT4ge1xuXHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcblx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcblx0fVxuXHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xufTsiLCJpbXBvcnQgQWRTZXJ2ZXIgZnJvbSAnLi4vZGlzdC9pbmRleCc7XG5cbmNvbnN0IG1peHBhbmVsUHJlc2VudGVkID0ge1xuICAgIHNlcnZpY2U6ICdtaXhwYW5lbCcsXG4gICAgYWN0aW9uOiAnTWVtYmVyc2hpcCBCbG9jaycsXG4gICAgc3RhdHVzOiAnUHJlc2VudGVkJyxcbn07XG5jb25zdCBtaXhwYW5lbEFjY2VwdGVkID0ge1xuICAgIHNlcnZpY2U6ICdtaXhwYW5lbCcsXG4gICAgYWN0aW9uOiAnTWVtYmVyc2hpcCBCbG9jaycsXG4gICAgc3RhdHVzOiAnQWNjZXB0ZWQnLFxufTtcblxuY29uc3QgYW5vbiA9IFtbXCJ1c2VyU2VnbWVudFwiLCAnZGVtb24nXV07XG5cbmNvbnN0IHBpYW5vID0gbmV3IEFkU2VydmVyKHtcbiAgICBhZFNlcnZpY2VyOiAncGlhbm8nLFxuICAgIG1hdGNoZXJzOiBhbm9uLFxuICAgIHRoaXJkUGFydHlDYWxsYmFja3M6IFtcbiAgICAgICAgbWl4cGFuZWxQcmVzZW50ZWQsXG4gICAgICAgIG1peHBhbmVsQWNjZXB0ZWQsXG4gICAgXSxcbiAgICB0YWdzOiBbW1widGVzdGluZ1wiXV0sXG59KTtcblxucGlhbm8uZGlzcGF0Y2hBZCgpOyJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==