/******/ (() => { // webpackBootstrap
/******/ 	var __webpack_modules__ = ({

/***/ "../dist/index.js":
/*!************************!*\
  !*** ../dist/index.js ***!
  \************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ AdServer)
/* harmony export */ });
/* harmony import */ var _piano_adapter__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./piano-adapter */ "../dist/piano-adapter.js");

/**
 *
 *  When we decide to ad a new ad service we will have to change the type of adServicer
 *  Currently it is just reliant on the PianoAdapter, but it could be any adapter that responds to
 *  .init() and takes the lifecycle methods along with matchers/tags.
 *
 */
class AdServer {
    constructor({ afterAdRender = [], afterAdInit = [], beforeAdInit = [], matchers = [], thirdPartyCallbacks = [], tags = [], adServicer, }) {
        this.afterAdInit = afterAdInit;
        this.afterAdRender = afterAdRender;
        this.beforeAdInit = beforeAdInit;
        this.matchers = matchers;
        this.tags = tags;
        this.thirdPartyCallbacks = thirdPartyCallbacks;
        this.user = this.setUser();
        this.adServicer = this.setAdapter(adServicer);
    }
    /**
     * Sets up the adapter for our Ad Service
     * Adapters api:
     * To render a template it REQUIRES an init() method
     * To interact with third-party services the adapter constructor REQUIRES an interface to receive an array of callbacks.
     * To match on custom variables it MAY have tags, matchers, or user-state
     * Lifecycle methods can be fired from the AdServer class or passed through to the Adapter.
     *
     * @remarks
     * Piano lifecycle methods lives inside the window.tp object so we have to pass through callbacks.
     * @param adServicer
     * @returns Adapter Class
     */
    setAdapter(adServicer) {
        const pianoConfig = {
            afterRenderCallbacks: this.afterAdRender,
            matchers: this.matchers,
            tags: this.tags,
            thirdPartyCallbacks: this.thirdPartyCallbacks,
            user: this.user
        };
        switch (adServicer) {
            case "piano": {
                return new _piano_adapter__WEBPACK_IMPORTED_MODULE_0__["default"](pianoConfig);
            }
            case "atk": {
                //configure in house AdService
            }
            default: {
                return new _piano_adapter__WEBPACK_IMPORTED_MODULE_0__["default"](pianoConfig);
            }
        }
    }
    /**
     * @remarks
     * These methods are private and should be only called through #dispatchAd
     */
    executeBeforeAdInit() {
        this.beforeAdInit.forEach((cb) => cb());
    }
    executeAfterAdRender() {
        this.afterAdRender.forEach((cb) => cb());
    }
    executeAfterAdInit() {
        this.afterAdInit.forEach((cb) => cb());
    }
    /**
     * Gathers needed properties and creates a configuration obj
     *
     * @remarks
     * The user data could come from context or it could come from
     * @returns User
     */
    setUser() {
        return {};
    }
    /**
     * Execute advertisement and lifecycle methods.
     */
    dispatchAd() {
        this.executeBeforeAdInit();
        this.adServicer.init();
        this.executeAfterAdInit();
    }
}
//# sourceMappingURL=index.js.map

/***/ }),

/***/ "../dist/piano-adapter.js":
/*!********************************!*\
  !*** ../dist/piano-adapter.js ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ PianoAdapter)
/* harmony export */ });
/* harmony import */ var _piano__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./piano */ "../dist/piano/index.js");
/* harmony import */ var _piano__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_piano__WEBPACK_IMPORTED_MODULE_0__);
var __classPrivateFieldGet = (undefined && undefined.__classPrivateFieldGet) || function (receiver, state, kind, f) {
    if (kind === "a" && !f) throw new TypeError("Private accessor was defined without a getter");
    if (typeof state === "function" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError("Cannot read private member from an object whose class did not declare it");
    return kind === "m" ? f : kind === "a" ? f.call(receiver) : f ? f.value : state.get(receiver);
};
var _PianoAdapter_instances, _PianoAdapter_getAid, _PianoAdapter_getUserToken;

class PianoAdapter {
    constructor({ thirdPartyCallbacks = [], afterRenderCallbacks = [], matchers = [], tags = [], user }) {
        _PianoAdapter_instances.add(this);
        this.tp = window.tp || [];
        this.user = this.setUser(user);
        this.setEnvConfig();
        this.setThirdPartyCallbacks(thirdPartyCallbacks);
        this.setCustomVariables(matchers);
        this.setAfterAdRender(afterRenderCallbacks);
        if (!Array.isArray(tags[0])) {
            tags = [tags];
        }
        this.setTags(tags);
    }
    /**
     * Sets required user fields to execute a piano experience.
     *
     * @remarks
     * Piano only needs the custom variable to match, but the user-token has something to do on their side.
     * I am not sure what it does, but to be backwards compatible we will add it in there.
     *
     * We are passing in a user argument just in-case we need additional properties from our
     * context or cookie in a future iteration.
     *
     * @param user
     */
    setUser(user) {
        return {
            aid: __classPrivateFieldGet(this, _PianoAdapter_instances, "m", _PianoAdapter_getAid).call(this),
            token: __classPrivateFieldGet(this, _PianoAdapter_instances, "m", _PianoAdapter_getUserToken).call(this),
        };
    }
    init() {
        /**
        * Initializes the piano experience
        * this is where we could eventually expand our callbacks using the tp api.
        * https://docs.piano.io/callbacks/
        *
        * @typedef {string} Command - Initialization command for piano experience.
        * @typedef {()=>void} Callback - In this callback you can access a lot of user information before initializing the experience.
        * @typedef {[Command, Callback]} InitParams
        * @param {InitParams}
        */
        this.tp.push(["init", () => {
                this.tp.experience.init();
            },]);
    }
    /**
     * Configuration objects carry the necessary data to the third party callback
     * Each configuration object is going to be different based on the 'service'.
     * Required properties are service, and callbacks.
     *
     * @typedef Service {string}
     * @typedef Callbacks {[()=>void]}
     * @typedef {Service, Callbacks} ConfigObj
     * @param thirdPartyConfigs ConfigObj[]
     */
    setThirdPartyCallbacks(thirdPartyConfigs) {
        thirdPartyConfigs.forEach((config) => {
            switch (config.service) {
                case 'mixpanel': {
                    this.setMixpanel(config);
                    break;
                }
                case 'atk': {
                    //do other stuff.
                    break;
                }
                default:
                    this.setMixpanel(config);
                    break;
            }
        });
    }
    /**
     * Configures mixpanel's global api for tracking events with piano template content fields
     *
     * @remarks
     * We are borrowing a pattern from redux, instead of action and payload we have mixpanel properties of status and actions
     * Actions are the event callbacks taking piano content fields and parsing the information we require for each specific event.
     *
     * We are using external events launch these callback. A hacky solution currently but we are injecting a third party iframe into our
     * application. There is a limited scope of interaction we can have with the template. But what we don't want is to couple our code
     * where the template is getting rendered. So hacky > heavily coupled currently.
     *
     * https://docs.piano.io/offer-template-essentials/#externalevent
     *
     * Every action that we want to track with mixpanel we add an additional case and add an external event on the template
     * We have to trigger it with javascript on the template if it is not a user triggered event (until we find a better way).
     *
     * @param ConfigObj
     *
     */
    setMixpanel({ status, action }) {
        /**
         * todo: add all of the available fields we get from the piano params obj and the params.params obj
         * This function maps the params data received from the event we get from piano
         * including custom parameters we have to set up in the external-event data-attributes
         * We can not target traditional data-attributes :frown:
         *
         *
         *@example
         * <span
         * id="mixpanel-params"
         * external-event="presented"
         * external-event-params="{{params}}"
         * external-event-adtype="[%% ad-type %%]"
         * external-event-incode="[%% incode %%]"
         * external-event-deviceType="[%% deviceType %%]"
         * external-event-clickdomain="[%% click-domain %%]"
         * external-event-mdc="[%% mdc %%]"
         * ></span>
         *
         *
         * In the custom script we have to manually trigger an event that is not cause by
         * user interaction. For this example we want to be able to fire a presented event to mixpanel
         * but because it isn't user triggered we will click on the span that will fire the external-event.
         *
         * <div custom-script>
         *   document.getElementById("mixpanel-params").click();
         * </div>
         */
        async function trackMixpanel({ action, status, params, customParams: { incode, clickdomain } }) {
            let { url } = await JSON.parse(params);
            // TODO: change 172 to support subdomains
            const [, location = "homepage"] = url.split(":5500/");
            window.mixpanel.track(action, { incode, status, location, type: clickdomain });
        }
        switch (status) {
            case 'Accepted': {
                this.tp.push(["addHandler", "customEvent", function (event) {
                        if (event?.eventName !== 'sign-up-button')
                            return;
                        trackMixpanel({ action, status, params: event.params.params, customParams: event.params });
                    }]);
                break;
            }
            case 'Presented': {
                this.tp.push(["addHandler", "customEvent", async function (event) {
                        if (event?.eventName !== 'presented')
                            return;
                        trackMixpanel({ action, status, params: event.params.params, customParams: event.params });
                    }]);
                break;
            }
            default:
                break;
        }
    }
    /**
     * We attach callbacks that fire before the browser renders the template
     *
     * @remarks
     *  This is not built to support third-party callbacks. Those need to be handled individually by their handlers.
     *
     * @param cbs
     */
    setBeforeAdInit(cbs) {
        cbs.forEach((callback) => {
            if (typeof callback === "function") {
                this.tp.push(["addHandler", "beforeBrowserEvent", callback]);
            }
        });
    }
    /**
     * We attach callbacks that fire after the browser renders the template
     *
     * @remarks
     *  This is not built to support third-party callbacks. Those need to be handled individually by their handlers.
     *
     * @param cbs
     */
    setAfterAdRender(cbs) {
        cbs.forEach((callback) => {
            this.tp.push(["addHandler", "showTemplate", function (templateParams) {
                    callback();
                }]);
        });
    }
    /**
     * Set the user segments that will match on the piano segment
     * in the initial user segments phase of the composer experience
     *
     * i.e. experience rules, initial user segments, events and triggers, actions
     * https://docs.piano.io/track/overview-composer?chapter=5556#menu5556
     *
     * @param matchers
     */
    setCustomVariables(matchers) {
        matchers.forEach((cv) => {
            const [key, value] = cv;
            this.tp.push(["setCustomVariable", key, value]);
        });
    }
    /**
     * Each experience in composer requires proper configuration.
     * This object will set up our configuration object properly to launch the expected experience.
     *
     * @returns PianoConfig
     */
    // debug if non prod
    getConfigProperties() {
        return {
            setAid: this.user.aid,
            setDebug: true,
            setEndpoint: "https://buy.tinypass.com/api/v3",
            setExternalJWT: this.user.token,
            setUsePianoIdUserProvider: true,
            setUseTinypassAccounts: false,
        };
    }
    /**
     * Sets up the window.tp piano object in the specific way it requires.
     *
     * @remarks
     * window.tp expects to push tuples with the proper 'key' (at position tuple[0]).
     * todo: expand explanation
     */
    setEnvConfig() {
        const config = this.getConfigProperties();
        Object.entries(config).forEach((d) => this.tp.push(d));
    }
    /**
     * This configures the window tp object to accept custom tags.
     *
     * @remarks
     * Tags are a way for us to match experiences with great specificity. (Experience Rules Phase)
     * Tags are used in the experience, and can be rendered on the template.
     * Tags can be returned to be used in third-party integrations
     * https://docs.piano.io/content-tracking/#custags
     *
     * @param tags
     */
    setTags(tags) {
        tags.forEach((tag) => {
            if (!Array.isArray(tag)) {
                this.tp.push(["setTags", tag]);
            }
        });
    }
}
_PianoAdapter_instances = new WeakSet(), _PianoAdapter_getAid = function _PianoAdapter_getAid() {
    // const [subdomain, domain] = window.location.hostname.split('.')
    // if(subdomain === 'www'){
    //   return {
    //     "americastestkitchen": "o8it4JKTpu",
    //     "cooksillustrated": "0l4CXRBBpu",
    //     "cookscountry": "vRqttsu1pu",
    //   }[domain]
    // } else {
    //   return {
    //     "americastestkitchen": "P3MUmmU9pu",
    //     "cooksillustrated": "CLRfAMqqpu",
    //     "cookscountry": "rkIgdPatpu",
    //   }[domain]
    // }
    /**
     * example implementation static aid
     */
    return "P3MUmmU9pu";
}, _PianoAdapter_getUserToken = function _PianoAdapter_getUserToken() {
    var c = document.cookie.match("(^|;)\\s*user_token\\s*=\\s*([^;]+)");
    if (c && c.length > 0)
        return c.pop();
    else
        return null;
};
//# sourceMappingURL=piano-adapter.js.map

/***/ }),

/***/ "../dist/piano/index.js":
/*!******************************!*\
  !*** ../dist/piano/index.js ***!
  \******************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

var pianoSDK = __webpack_require__(/*! ./tinypass */ "../dist/piano/tinypass.js");
module.exports = {
    pianoSDK
};
//# sourceMappingURL=index.js.map

/***/ }),

/***/ "../dist/piano/tinypass.js":
/*!*********************************!*\
  !*** ../dist/piano/tinypass.js ***!
  \*********************************/
/***/ (() => {

!function (e) {
    "use strict";
    window.pnFullTPVersion = !0, "function" != typeof Object.assign && Object.defineProperty(Object, "assign", { value: function (e, n) { if (null == e)
            throw new TypeError("Cannot convert undefined or null to object"); for (var t = Object(e), r = 1; r < arguments.length; r++) {
            var o = arguments[r];
            if (null != o)
                for (var i in o)
                    Object.prototype.hasOwnProperty.call(o, i) && (t[i] = o[i]);
        } return t; }, writable: !0, configurable: !0 });
    var n = new WeakMap;
    function t(e, t) { return n.get(e) && n.get(e).get(t); }
    function r(e, n, r) { if (void 0 === n)
        throw new TypeError; var o = t(n, r); return o && o.get(e); }
    function o(e, r, o, i) { if (i && !["string", "symbol"].includes(typeof i))
        throw new TypeError; (t(o, i) || function (e, t) { var r = n.get(e) || new Map; n.set(e, r); var o = r.get(t) || new Map; return r.set(t, o), o; }(o, i)).set(e, r); }
    function i(e, n, t) { return r(e, n, t) ? r(e, n, t) : Object.getPrototypeOf(n) ? i(e, Object.getPrototypeOf(n), t) : void 0; }
    var a, s = { decorate: function (e, n, t, r) { if (!Array.isArray(e) || 0 === e.length)
            throw new TypeError; return void 0 !== t ? function (e, n, t, r) { return e.reverse().forEach((function (e) { r = e(n, t, r) || r; })), r; }(e, n, t, r) : "function" == typeof n ? function (e, n) { return e.reverse().forEach((function (e) { var t = e(n); t && (n = t); })), n; }(e, n) : void 0; }, defineMetadata: function (e, n, t, r) { o(e, n, t, r); }, getMetadata: function (e, n, t) { return i(e, n, t); }, getOwnMetadata: function (e, n, t) { return r(e, n, t); }, hasMetadata: function (e, n, t) { return !!i(e, n, t); }, hasOwnMetadata: function (e, n, t) { return !!r(e, n, t); }, metadata: function (e, n) { return function (t, r) { o(e, n, t, r); }; } };
    window.Reflect = window.Reflect || {}, Object.assign(window.Reflect, s), function (e) { e[e.Transient = 0] = "Transient", e[e.Singleton = 1] = "Singleton", e[e.ResolutionScoped = 2] = "ResolutionScoped", e[e.ContainerScoped = 3] = "ContainerScoped"; }(a || (a = {}));
    var c = a, l = function (e, n) { return l = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, n) { e.__proto__ = n; } || function (e, n) { for (var t in n)
        n.hasOwnProperty(t) && (e[t] = n[t]); }, l(e, n); };
    function u(e, n) { function t() { this.constructor = e; } l(e, n), e.prototype = null === n ? Object.create(n) : (t.prototype = n.prototype, new t); }
    function d(e) { var n = "function" == typeof Symbol && Symbol.iterator, t = n && e[n], r = 0; if (t)
        return t.call(e); if (e && "number" == typeof e.length)
        return { next: function () { return e && r >= e.length && (e = void 0), { value: e && e[r++], done: !e }; } }; throw new TypeError(n ? "Object is not iterable." : "Symbol.iterator is not defined."); }
    function p(e, n) { var t = "function" == typeof Symbol && e[Symbol.iterator]; if (!t)
        return e; var r, o, i = t.call(e), a = []; try {
        for (; (void 0 === n || n-- > 0) && !(r = i.next()).done;)
            a.push(r.value);
    }
    catch (e) {
        o = { error: e };
    }
    finally {
        try {
            r && !r.done && (t = i.return) && t.call(i);
        }
        finally {
            if (o)
                throw o.error;
        }
    } return a; }
    function f() { for (var e = [], n = 0; n < arguments.length; n++)
        e = e.concat(p(arguments[n])); return e; }
    var m = "injectionTokens";
    function g(e) { return !!e.useClass; }
    function v(e) { return !!e.useFactory; }
    var h = function () { function e(e) { this.wrap = e, this.reflectMethods = ["get", "getPrototypeOf", "setPrototypeOf", "getOwnPropertyDescriptor", "defineProperty", "has", "set", "deleteProperty", "apply", "construct", "ownKeys"]; } return e.prototype.createProxy = function (e) { var n, t = this, r = !1; return new Proxy({}, this.createHandler((function () { return r || (n = e(t.wrap()), r = !0), n; }))); }, e.prototype.createHandler = function (e) { var n = {}; return this.reflectMethods.forEach((function (t) { n[t] = function () { for (var n = [], r = 0; r < arguments.length; r++)
        n[r] = arguments[r]; n[0] = e(); var o = Reflect[t]; return o.apply(void 0, f(n)); }; })), n; }, e; }();
    function w(e) { return "string" == typeof e || "symbol" == typeof e; }
    function y(e) { return "object" == typeof e && "token" in e && "transform" in e; }
    function b(e) { return !!e.useToken; }
    function k(e) { return null != e.useValue; }
    var _ = function () { function e() { this._registryMap = new Map; } return e.prototype.entries = function () { return this._registryMap.entries(); }, e.prototype.getAll = function (e) { return this.ensure(e), this._registryMap.get(e); }, e.prototype.get = function (e) { this.ensure(e); var n = this._registryMap.get(e); return n[n.length - 1] || null; }, e.prototype.set = function (e, n) { this.ensure(e), this._registryMap.get(e).push(n); }, e.prototype.setAll = function (e, n) { this._registryMap.set(e, n); }, e.prototype.has = function (e) { return this.ensure(e), this._registryMap.get(e).length > 0; }, e.prototype.clear = function () { this._registryMap.clear(); }, e.prototype.ensure = function (e) { this._registryMap.has(e) || this._registryMap.set(e, []); }, e; }(), C = function (e) { function n() { return null !== e && e.apply(this, arguments) || this; } return u(n, e), n; }(_), I = function () { this.scopedResolutions = new Map; };
    function S(e, n, t) { var r, o, i = p(e.toString().match(/constructor\(([\w, ]+)\)/) || [], 2)[1], a = function (e, n) { return null === e ? "at position #" + n : '"' + e.split(",")[n].trim() + '" at position #' + n; }(void 0 === i ? null : i, n); return r = "Cannot inject the dependency " + a + ' of "' + e.name + '" constructor. Reason:', void 0 === o && (o = "    "), f([r], t.message.split("\n").map((function (e) { return o + e; }))).join("\n"); }
    var x = function (e) { function n() { return null !== e && e.apply(this, arguments) || this; } return u(n, e), n; }(_), P = function (e) { function n() { return null !== e && e.apply(this, arguments) || this; } return u(n, e), n; }(_), E = function () { this.preResolution = new x, this.postResolution = new P; }, T = new Map, A = function () { function e(e) { this.parent = e, this._registry = new C, this.interceptors = new E; } return e.prototype.register = function (e, n, t) { var r; if (void 0 === t && (t = { lifecycle: c.Transient }), r = function (e) { return g(e) || k(e) || b(e) || v(e); }(n) ? n : { useClass: n }, b(r))
        for (var o = [e], i = r; null != i;) {
            var a = i.useToken;
            if (o.includes(a))
                throw new Error("Token registration cycle detected! " + f(o, [a]).join(" -> "));
            o.push(a);
            var s = this._registry.get(a);
            i = s && b(s.provider) ? s.provider : null;
        } if ((t.lifecycle === c.Singleton || t.lifecycle == c.ContainerScoped || t.lifecycle == c.ResolutionScoped) && (k(r) || v(r)))
        throw new Error('Cannot use lifecycle "' + c[t.lifecycle] + '" with ValueProviders or FactoryProviders'); return this._registry.set(e, { provider: r, options: t }), this; }, e.prototype.registerType = function (e, n) { return w(n) ? this.register(e, { useToken: n }) : this.register(e, { useClass: n }); }, e.prototype.registerInstance = function (e, n) { return this.register(e, { useValue: n }); }, e.prototype.registerSingleton = function (e, n) { if (w(e)) {
        if (w(n))
            return this.register(e, { useToken: n }, { lifecycle: c.Singleton });
        if (n)
            return this.register(e, { useClass: n }, { lifecycle: c.Singleton });
        throw new Error('Cannot register a type name as a singleton without a "to" token');
    } var t = e; return n && !w(n) && (t = n), this.register(e, { useClass: t }, { lifecycle: c.Singleton }); }, e.prototype.resolve = function (e, n) { void 0 === n && (n = new I); var t = this.getRegistration(e); if (!t && w(e))
        throw new Error('Attempted to resolve unregistered dependency token: "' + e.toString() + '"'); if (this.executePreResolutionInterceptor(e, "Single"), t) {
        var r = this.resolveRegistration(t, n);
        return this.executePostResolutionInterceptor(e, r, "Single"), r;
    } if (function (e) { return "function" == typeof e || e instanceof h; }(e)) {
        r = this.construct(e, n);
        return this.executePostResolutionInterceptor(e, r, "Single"), r;
    } throw new Error("Attempted to construct an undefined constructor. Could mean a circular dependency problem. Try using `delay` function."); }, e.prototype.executePreResolutionInterceptor = function (e, n) { var t, r; if (this.interceptors.preResolution.has(e)) {
        var o = [];
        try {
            for (var i = d(this.interceptors.preResolution.getAll(e)), a = i.next(); !a.done; a = i.next()) {
                var s = a.value;
                "Once" != s.options.frequency && o.push(s), s.callback(e, n);
            }
        }
        catch (e) {
            t = { error: e };
        }
        finally {
            try {
                a && !a.done && (r = i.return) && r.call(i);
            }
            finally {
                if (t)
                    throw t.error;
            }
        }
        this.interceptors.preResolution.setAll(e, o);
    } }, e.prototype.executePostResolutionInterceptor = function (e, n, t) { var r, o; if (this.interceptors.postResolution.has(e)) {
        var i = [];
        try {
            for (var a = d(this.interceptors.postResolution.getAll(e)), s = a.next(); !s.done; s = a.next()) {
                var c = s.value;
                "Once" != c.options.frequency && i.push(c), c.callback(e, n, t);
            }
        }
        catch (e) {
            r = { error: e };
        }
        finally {
            try {
                s && !s.done && (o = a.return) && o.call(a);
            }
            finally {
                if (r)
                    throw r.error;
            }
        }
        this.interceptors.postResolution.setAll(e, i);
    } }, e.prototype.resolveRegistration = function (e, n) { if (e.options.lifecycle === c.ResolutionScoped && n.scopedResolutions.has(e))
        return n.scopedResolutions.get(e); var t, r = e.options.lifecycle === c.Singleton, o = e.options.lifecycle === c.ContainerScoped, i = r || o; return t = k(e.provider) ? e.provider.useValue : b(e.provider) ? i ? e.instance || (e.instance = this.resolve(e.provider.useToken, n)) : this.resolve(e.provider.useToken, n) : g(e.provider) ? i ? e.instance || (e.instance = this.construct(e.provider.useClass, n)) : this.construct(e.provider.useClass, n) : v(e.provider) ? e.provider.useFactory(this) : this.construct(e.provider, n), e.options.lifecycle === c.ResolutionScoped && n.scopedResolutions.set(e, t), t; }, e.prototype.resolveAll = function (e, n) { var t = this; void 0 === n && (n = new I); var r = this.getAllRegistrations(e); if (!r && w(e))
        throw new Error('Attempted to resolve unregistered dependency token: "' + e.toString() + '"'); if (this.executePreResolutionInterceptor(e, "All"), r) {
        var o = r.map((function (e) { return t.resolveRegistration(e, n); }));
        return this.executePostResolutionInterceptor(e, o, "All"), o;
    } var i = [this.construct(e, n)]; return this.executePostResolutionInterceptor(e, i, "All"), i; }, e.prototype.isRegistered = function (e, n) { return void 0 === n && (n = !1), this._registry.has(e) || n && (this.parent || !1) && this.parent.isRegistered(e, !0); }, e.prototype.reset = function () { this._registry.clear(), this.interceptors.preResolution.clear(), this.interceptors.postResolution.clear(); }, e.prototype.clearInstances = function () { var e, n; try {
        for (var t = d(this._registry.entries()), r = t.next(); !r.done; r = t.next()) {
            var o = p(r.value, 2), i = o[0], a = o[1];
            this._registry.setAll(i, a.filter((function (e) { return !k(e.provider); })).map((function (e) { return e.instance = void 0, e; })));
        }
    }
    catch (n) {
        e = { error: n };
    }
    finally {
        try {
            r && !r.done && (n = t.return) && n.call(t);
        }
        finally {
            if (e)
                throw e.error;
        }
    } }, e.prototype.createChildContainer = function () { var n, t, r = new e(this); try {
        for (var o = d(this._registry.entries()), i = o.next(); !i.done; i = o.next()) {
            var a = p(i.value, 2), s = a[0], l = a[1];
            l.some((function (e) { return e.options.lifecycle === c.ContainerScoped; })) && r._registry.setAll(s, l.map((function (e) { return e.options.lifecycle === c.ContainerScoped ? { provider: e.provider, options: e.options } : e; })));
        }
    }
    catch (e) {
        n = { error: e };
    }
    finally {
        try {
            i && !i.done && (t = o.return) && t.call(o);
        }
        finally {
            if (n)
                throw n.error;
        }
    } return r; }, e.prototype.beforeResolution = function (e, n, t) { void 0 === t && (t = { frequency: "Always" }), this.interceptors.preResolution.set(e, { callback: n, options: t }); }, e.prototype.afterResolution = function (e, n, t) { void 0 === t && (t = { frequency: "Always" }), this.interceptors.postResolution.set(e, { callback: n, options: t }); }, e.prototype.getRegistration = function (e) { return this.isRegistered(e) ? this._registry.get(e) : this.parent ? this.parent.getRegistration(e) : null; }, e.prototype.getAllRegistrations = function (e) { return this.isRegistered(e) ? this._registry.getAll(e) : this.parent ? this.parent.getAllRegistrations(e) : null; }, e.prototype.construct = function (e, n) { var t = this; if (e instanceof h)
        return e.createProxy((function (e) { return t.resolve(e, n); })); var r = T.get(e); if (!r || 0 === r.length) {
        if (0 === e.length)
            return new e;
        throw new Error('TypeInfo not known for "' + e.name + '"');
    } var o = r.map(this.resolveParams(n, e)); return new (e.bind.apply(e, f([void 0], o))); }, e.prototype.resolveParams = function (e, n) { var t = this; return function (r, o) { var i, a, s, c; try {
        return "object" == typeof (c = r) && "token" in c && "multiple" in c ? y(r) ? r.multiple ? (i = t.resolve(r.transform)).transform.apply(i, f([t.resolveAll(r.token)], r.transformArgs)) : (a = t.resolve(r.transform)).transform.apply(a, f([t.resolve(r.token, e)], r.transformArgs)) : r.multiple ? t.resolveAll(r.token) : t.resolve(r.token, e) : y(r) ? (s = t.resolve(r.transform, e)).transform.apply(s, f([t.resolve(r.token, e)], r.transformArgs)) : t.resolve(r, e);
    }
    catch (e) {
        throw new Error(S(n, o, e));
    } }; }, e; }(), M = new A;
    function O() { return function (e) { T.set(e, function (e) { var n = Reflect.getMetadata("design:paramtypes", e) || [], t = Reflect.getOwnMetadata(m, e) || {}; return Object.keys(t).forEach((function (e) { n[+e] = t[e]; })), n; }(e)); }; }
    if ("undefined" == typeof Reflect || !Reflect.getMetadata)
        throw new Error("tsyringe requires a reflect polyfill. Please add 'import \"reflect-metadata\"' to the top of your entry point.");
    if (window.pnInitPerformance = performance.now(), window.pnHasPolyfilled || (window.pnHasPolyfilled = !1), window.pnFullTPVersion || (window.pnFullTPVersion = !1), void 0 !== window.pn && void 0 !== window.pn.container)
        throw new Error("Piano SDK is loaded twice on same page. Try to fix that to prevent the message.");
    if (!window.pnFullTPVersion && "undefined" != typeof Proxy) {
        var R = function () { return L; }, L = new Proxy({}, { get: function (e, n, t) { return "isv" === n || R; }, apply: function (e, n, t) { return L; } });
        M.resolve = new Proxy(M.resolve, { apply: function (e, n, t) { if (M.isRegistered(t[0]))
                return Reflect.apply(e, n, t); M.register(t[0], { useValue: L }); var r = M.resolve(t[0]); return U[t[0]] = r, r; } });
    }
    var N = window.pn || {}, U = window.pn = {};
    U.container = M, U.singleton = function () { return function (e) { O()(e), M.registerSingleton(e); }; }, U.injectable = O, U.inject = function (e) { return n = e, function (e, r, o) { var i = Reflect.getOwnMetadata(m, e) || {}; i[o] = t ? { token: n, transform: t.transformToken, transformArgs: t.args || [] } : n, Reflect.defineMetadata(m, i, e); }; var n, t; }, U.registry = function (e) { return void 0 === e && (e = []), function (n) { return e.forEach((function (e) { var n = e.token, t = e.options, r = function (e, n) { var t = {}; for (var r in e)
        Object.prototype.hasOwnProperty.call(e, r) && n.indexOf(r) < 0 && (t[r] = e[r]); if (null != e && "function" == typeof Object.getOwnPropertySymbols) {
        var o = 0;
        for (r = Object.getOwnPropertySymbols(e); o < r.length; o++)
            n.indexOf(r[o]) < 0 && Object.prototype.propertyIsEnumerable.call(e, r[o]) && (t[r[o]] = e[r[o]]);
    } return t; }(e, ["token", "options"]); return M.register(n, r, t); })), n; }; }, U.instanceCachingFactory = function (e) { var n; return function (t) { return null == n && (n = e(t)), n; }; }, U.predefinedOptions = N, M.register("predefinedOptions", { useValue: N });
    var j = !1;
    try {
        if (!window.pnHasPolyfilled) {
            if ("undefined" == typeof Proxy)
                throw new Error("The browser cannot Proxy");
            if (new Promise((function (e) { })), Object.assign({}, {}), [""].includes(""), !Element.prototype.closest)
                throw new Error("There is no closest method of a DOM element");
        }
    }
    catch (e) {
        j = !0;
    }
    if (j) {
        var D = function () { var e, n = document.querySelectorAll("script"); if (n.length)
            for (var t = 0, r = n; t < r.length; t++) {
                var o = r[t], i = null === (e = null == o ? void 0 : o.src) || void 0 === e ? void 0 : e.match(/^.*?(tinypass.com|piano.io)/i);
                if (i)
                    return i[0];
            } return "https://sandbox.tinypass.com"; }();
        delete window.pn;
        var F = document.createElement("script");
        throw F.type = "text/javascript", F.async = !0, F.src = D + "/api/piano.es5.js", document.getElementsByTagName("head")[0].appendChild(F), new Error("Load full version of piano SDK");
    }
    var B, V = (B = function (e) { return new Promise((function (n, t) { var r = document.createElement("style"); r.type = "text/css", r.innerHTML = e, r.onload = n, r.onerror = t, document.getElementsByTagName("head")[0].appendChild(r); })); }, { name: "css", loadOfferCss: function () { B(".tp-backdrop {\n    display: none;\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background: #121214;\n    z-index: 300000;\n    opacity: 0;\n    transition: opacity .25s linear;\n}\n.tp-backdrop.tp-active {\n    opacity: .9;\n}\n.tp-modal .tp-close.tp-square {\n    background: #ccc;\n    border-radius: 0;\n    border: 0;\n    top: 0;\n    right: -40px;\n}\n.tp-modal .tp-close {\n    display: none;\n    position: absolute;\n    top: -20px;\n    right: -20px;\n    width: 40px;\n    height: 40px;\n    background: #fff url(\"data:image/svg+xml,%3Csvg width='11' height='11' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M11 1.368L9.632 0 5.5 4.142 1.368 0 0 1.368 4.142 5.5 0 9.632 1.368 11 5.5 6.858 9.632 11 11 9.632 6.858 5.5 11 1.368z' fill='%23959595'/%3E%3C/svg%3E\") center center no-repeat;\n    border: none;\n    box-shadow: 0 0 10px 0 rgba(28, 37, 68, 0.15);\n    outline: none;\n    z-index: 300100;\n    border-radius: 40px;\n    opacity: 0;\n    cursor: pointer;\n    transform: scale(.25, .25);\n    -webkit-appearance: none;\n    -moz-appearance: none;\n    appearance: none;\n}\n.tp-modal .tp-close:hover,\n.tp-modal .tp-close:focus {\n    box-shadow: 0 0 10px 2px rgba(28, 37, 68, 0.15);\n}\n.tp-modal .tp-close:focus {\n   border: 1px solid;\n}\n.tp-modal .tp-close.tp-active {\n    display: block;\n    opacity: 1;\n    transform: scale(1, 1);\n}\n.tp-modal .tp-iframe-wrapper[dir=\"rtl\"] .tp-close {\n  right: initial;\n  left: -20px;\n}\n\n.tp-modal .tp-iframe-wrapper.piano-id-modal-ver-2 .tp-close {\n  top: 0;\n  right: 0;\n  width: 64px;\n  height: 64px;\n  box-shadow: none;\n  outline: none;\n  border-radius: 0;\n  border-left: 1px solid rgba(15, 15, 21, 0.2);\n  background: url(\"data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cg %3E%3Cpath d='M3 3L13 13M13 3L3 13' stroke='%230F0F15' stroke-width='2'/%3E%3C/g%3E%3C/svg%3E%0A\") center center no-repeat;\n  opacity: 0.3;\n}\n\n.tp-modal .tp-iframe-wrapper.piano-id-modal-ver-2 .tp-close.tp-active {\n  opacity: 0.3;\n}\n\n.tp-modal .tp-iframe-wrapper.piano-id-modal-ver-2 .tp-close:hover,\n.tp-modal .tp-iframe-wrapper.piano-id-modal-ver-2 .tp-close:focus {\n  box-shadow: none;\n  border: none;\n  border-left: 1px solid rgba(15, 15, 21, 0.06);\n  opacity: 1;\n}\n\n.tp-modal .tp-iframe-wrapper.piano-id-modal-ver-2[dir=\"rtl\"] .tp-close {\n  right: auto;\n  left: 0;\n  border-left: none;\n  border-right: 1px solid rgba(15, 15, 21, 0.2);\n}\n\n.tp-modal .tp-iframe-wrapper.piano-id-modal-ver-2[dir=\"rtl\"] .tp-close:hover,\n.tp-modal .tp-iframe-wrapper.piano-id-modal-ver-2[dir=\"rtl\"] .tp-close:focus {\n  border-left: none;\n  border-right: 1px solid rgba(15, 15, 21, 0.06);\n}\n\n.tp-modal {\n    z-index: 300050;\n}\n@media screen and (max-width: 650px) {\n    .tp-modal .tp-close {\n        right: 0;\n    }\n\n    .tp-modal .tp-iframe-wrapper[dir=\"rtl\"] .tp-close {\n      right: initial;\n      left: 0;\n    }\n}\n.tp-modal .tp-iframe-wrapper.tp-curtain {\n    width: 600px;\n    height: 480px;\n}\n.tp-modal-open {\n    overflow: hidden !important;\n    height: 100vh;\n    -webkit-overflow-scrolling: touch;\n}\n.tp-modal-open.tp-modal-resizing {\n    -webkit-overflow-scrolling: auto;\n}\n/*Bug fix of firefox v57*/\n.tp-modal-close {\n    overflow: auto;\n}\n.tp-modal__margin-100 .tp-iframe-wrapper {\n  margin-bottom: 100px;\n}\n.tp-iframe-wrapper {\n    position: relative;\n    margin: 50px auto;\n    box-shadow: 0 0 10px rgba(0, 0, 0, 0.21);\n}\n.tp-iframe-wrapper.no-shadow {\n  box-shadow: unset;\n}\n.tp-modal {\n    overflow-x: hidden;\n    overflow-y: scroll !important;\n    display: none;\n    position: fixed;\n    top: 0;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    transform: translate3d(0, 0, 0);\n}\n.tp-modal .tp-message {\n    font-family: \"Graphik Web Regular\", Helvetica, Arial, sans-serif;\n    padding: 10px;\n}\n.tp-modal .tp-btn-container {\n    padding-left: 10px;\n    padding-bottom: 10px;\n}\n.tp-cxense-placeholder-modal {\n    width: 100%;\n    background-color: #fff;\n    max-width: 912px;\n    display: block;\n    overflow: hidden;\n    height: auto;\n    opacity: 1;\n}\n.tp-widget-placeholder > div::after {\n    display: block;\n    content: \"\";\n    clear: both;\n}\n.tp-btn {\n    text-decoration: none;\n    cursor: pointer;\n    padding: 0 18px;\n    line-height: 40px;\n    border-collapse: separate;\n    border-radius: 4px;\n    text-align: center;\n    vertical-align: middle;\n    display: inline-block;\n    color: #fff;\n    border: none;\n    box-shadow: inset 0 -1px 0 rgba(216, 218, 221, 0.0);\n    background: #3878D8;\n    background-position: bottom;\n    text-shadow: none;\n    font-family: \"Graphik Web Regular\", Helvetica, Arial, sans-serif;\n    white-space: nowrap;\n    outline: 0;\n}\n.tp-please-wait.tp-active {\n    display: block;\n    opacity: .9;\n    transition: opacity .25s linear;\n}\n.tp-please-wait {\n    position: absolute;\n    top: 0;\n    left: 0;\n    background-color: #999;\n    opacity: 0;\n    width: 100%;\n    height: 100%;\n    display: none;\n    text-align: center;\n    color: #fff;\n    font-weight: lighter;\n    font-family: \"Open Sans\", sans-serif;\n    font-size: 15px;\n}\n.tp-please-wait.tp-overlap {\n  position: fixed;\n  z-index: 300150;\n}\n\n.tp-please-wait.tp-local-overlap {\n  position: absolute;\n}\n\n.tp-please-wait > .tp-icon {\n    width: 80px;\n    height: 80px;\n    margin: 100px auto 20px auto;\n}\n\n.pn-spinner {\n  color: grey;\n  display: inline-block;\n  position: relative;\n  width: 80px;\n  height: 80px;\n}\n.pn-spinner div {\n  transform-origin: 40px 40px;\n  animation: pn-spinner 1.2s linear infinite;\n}\n.pn-spinner div:after {\n  content: \" \";\n  display: block;\n  position: absolute;\n  top: 3px;\n  left: 37px;\n  width: 6px;\n  height: 18px;\n  border-radius: 20%;\n  background: #fff;\n}\n.pn-spinner div:nth-child(1) {\n  transform: rotate(0deg);\n  animation-delay: -1.1s;\n}\n.pn-spinner div:nth-child(2) {\n  transform: rotate(30deg);\n  animation-delay: -1s;\n}\n.pn-spinner div:nth-child(3) {\n  transform: rotate(60deg);\n  animation-delay: -0.9s;\n}\n.pn-spinner div:nth-child(4) {\n  transform: rotate(90deg);\n  animation-delay: -0.8s;\n}\n.pn-spinner div:nth-child(5) {\n  transform: rotate(120deg);\n  animation-delay: -0.7s;\n}\n.pn-spinner div:nth-child(6) {\n  transform: rotate(150deg);\n  animation-delay: -0.6s;\n}\n.pn-spinner div:nth-child(7) {\n  transform: rotate(180deg);\n  animation-delay: -0.5s;\n}\n.pn-spinner div:nth-child(8) {\n  transform: rotate(210deg);\n  animation-delay: -0.4s;\n}\n.pn-spinner div:nth-child(9) {\n  transform: rotate(240deg);\n  animation-delay: -0.3s;\n}\n.pn-spinner div:nth-child(10) {\n  transform: rotate(270deg);\n  animation-delay: -0.2s;\n}\n.pn-spinner div:nth-child(11) {\n  transform: rotate(300deg);\n  animation-delay: -0.1s;\n}\n.pn-spinner div:nth-child(12) {\n  transform: rotate(330deg);\n  animation-delay: 0s;\n}\n@keyframes pn-spinner {\n  0% {\n    opacity: 1;\n  }\n  100% {\n    opacity: 0;\n  }\n}\n\n.tp-please-wait > .tp-icon.tp-centered {\n  margin: 0;\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n}\n.tp-iframe-wrapper.no-width .tp-close,\n.tp-iframe-wrapper.no-height .tp-close,\n.tp-modal.no-width .tp-close,\n.tp-modal.no-height .tp-close {\n    display: none;\n}\n\n.tp-banner {\n  position: fixed;\n  bottom: 0;\n  left: 0;\n  width: 100%;\n}\n\n.tp-banner > .tp-container-inner,\n.tp-banner > .tp-container-inner > iframe {\n  width: inherit !important;\n}\n\n.frozen-mobile-body {\n  width: 100%;\n  margin: 0;\n  position: fixed !important;\n  max-height: -webkit-fill-available;\n  max-height: -moz-available;\n}\n"); } });
    pn.container.register("css", { useValue: V }), pn.css = pn.container.resolve("css");
    var q, z, H = function (e) { return {}.toString.call(e).match(/\s([a-zA-Z]+)/)[1].toLowerCase(); }, W = Math.round(1e4 * Math.random()), J = window.document, G = /^(?:text|application)\/javascript/i, Q = /^(?:text|application)\/xml/i, X = "application/json", $ = "text/html", Y = /^\s*$/, K = function (e) { var n = ce({}, e || {}); for (q in K.settings)
        void 0 === n[q] && (n[q] = K.settings[q]); !function (e) { e.global && 0 == K.active++ && Z(e); }(n), n.crossDomain || (n.crossDomain = /^([\w-]+:)?\/\/([^\/]+)/.test(n.url) && RegExp.$2 != window.location.host); var t = n.dataType, r = /=\?/.test(n.url); if ("jsonp" == t || r)
        return r || (n.url = oe(n.url, "callback=?")), K.JSONP(n); n.url || (n.url = window.location.toString()), ie(n); var o, i = n.accepts[t], a = {}, s = /^([\w-]+:)\/\//.test(n.url) ? RegExp.$1 : window.location.protocol, c = K.settings.xhr(); n.crossDomain || (a["X-Requested-With"] = "XMLHttpRequest"), i && (a.Accept = i, i.indexOf(",") > -1 && (i = i.split(",", 2)[0]), c.overrideMimeType && c.overrideMimeType(i)), (n.contentType || n.data && "GET" != n.type.toUpperCase()) && (a["Content-Type"] = n.contentType || "application/x-www-form-urlencoded"), n.headers = ce(a, n.headers || {}); var l = n.xhrFields && n.xhrFields.withCredentials; l && (c.withCredentials = l), c.onreadystatechange = function () { if (4 == c.readyState) {
        clearTimeout(o);
        var e, r = !1;
        if (c.status >= 200 && c.status < 300 || 304 == c.status || 0 == c.status && "file:" == s) {
            t = t || function (e) { return e && (e == $ ? "html" : e == X ? "json" : G.test(e) ? "script" : Q.test(e) && "xml") || "text"; }(c.getResponseHeader("content-type")), e = c.responseText;
            try {
                "script" == t ? (0, eval)(e) : "xml" == t ? e = c.responseXML : "json" == t && (e = Y.test(e) ? null : JSON.parse(e));
            }
            catch (e) {
                r = e;
            }
            r ? ne(r, "parsererror", c, n) : ee(e, c, n);
        }
        else
            ne(null, "error", c, n);
    } }; var u = !("async" in n) || n.async; for (z in c.open(n.type, n.url, u), n.headers)
        c.setRequestHeader(z, n.headers[z]); return !1 === function (e, n) { var t = n.context; if (!1 === n.beforeSend.call(t, e, n) || !1 === Z(n))
        return !1; Z(n); }(c, n) ? (c.abort(), !1) : (n.timeout > 0 && (o = setTimeout((function () { c.onreadystatechange = re, c.abort(), ne(null, "timeout", c, n); }), n.timeout)), c.send(n.data ? n.data : null), c); };
    function Z(e, n, t, r) { if (e.global)
        return !0; }
    function ee(e, n, t) { var r = t.context, o = "success"; t.success.call(r, e, o, n), Z(t), te(o, n, t); }
    function ne(e, n, t, r) { var o = r.context; r.error.call(o, t, n, e), Z(r), te(n, t, r); }
    function te(e, n, t) { var r = t.context; t.complete.call(r, n, e), Z(t), function (e) { e.global && !--K.active && Z(e); }(t); }
    function re() { }
    function oe(e, n) { return (e + "&" + n).replace(/[&?]{1,2}/, "?"); }
    function ie(e) { var n, t, r; "object" === H(e.data) && (e.data = (n = e.data, (r = []).add = function (e, n) { this.push(ae(e) + "=" + ae(n)); }, se(r, n, t), r.join("&").replace("%20", "+"))), !e.data || e.type && "GET" != e.type.toUpperCase() || (e.url = oe(e.url, e.data)); }
    K.active = 0, K.JSONP = function (e) { if (!("type" in e))
        return K(e); var n, t = "jsonp" + (e.cache ? "Callback" : ++W), r = J.createElement("script"), o = { abort: function () { t in window && (window[t] = re), te("abort", o, e); } }, i = J.getElementsByTagName("head")[0] || J.documentElement; return e.error && (r.onerror = function () { o.abort(), e.error(); }), window[t] = function (r) { clearTimeout(n), delete window[t], ee(r, o, e); }, ie(e), r.src = e.url.replace(/=\?/, "=" + t), i.insertBefore(r, i.firstChild), e.timeout > 0 && (n = setTimeout((function () { o.abort(), te("timeout", o, e); }), e.timeout)), o; }, K.settings = { type: "GET", beforeSend: re, success: re, error: re, complete: re, context: null, global: !0, xhr: function () { return new window.XMLHttpRequest; }, accepts: { script: "text/javascript, application/javascript", json: X, xml: "application/xml, text/xml", html: $, text: "text/plain" }, crossDomain: !1, timeout: 0 }, K.get = function (e, n) { return K({ url: e, success: n }); }, K.post = function (e, n, t, r) { return "function" === H(n) && (r = r || t, t = n, n = null), K({ type: "POST", url: e, data: n, success: t, dataType: r }); }, K.getJSON = function (e, n) { return K({ url: e, success: n, dataType: "json" }); };
    var ae = encodeURIComponent;
    function se(e, n, t, r) { var o = "array" === H(n); for (var i in n) {
        var a = n[i];
        r && (i = t ? r : r + "[" + (o ? "" : i) + "]"), !r && o ? e.add(a.name, a.value) : (t ? "array" === H(a) : "object" === H(a)) ? se(e, a, t, i) : e.add(i, a);
    } }
    function ce(e) { var n = Array.prototype.slice; return n.call(arguments, 1).forEach((function (n) { for (q in n)
        void 0 !== n[q] && (e[q] = n[q]); })), e; }
    var le = K, ue = { request: function (e) { return e.dataType = e.dataType || "json", le(e); } };
    pn.container.register("ajax", { useValue: ue }), pn.ajax = pn.container.resolve("ajax");
    var de = function () { var e = function (e) { return "function" == typeof e; }, n = function (e, n) { return e ? t(e, n)[0] : null; }, t = function (e, n) { if (!e)
        return []; var t = n || document, r = e.split(","), o = []; return r.forEach((function (e) { var n = e.trim(); try {
        o = o.concat(Array.prototype.slice.call(t.querySelectorAll(n)));
    }
    catch (e) {
        var r = n.indexOf(" ") > -1;
        if ("." !== n[0] || r)
            if ("#" !== n[0] || r)
                o = o.concat(Array.prototype.slice.call(t.querySelectorAll(n)));
            else {
                var i = document.getElementById(n.substring(1));
                o = o.concat(i ? [i] : []);
            }
        else
            o = o.concat(Array.prototype.slice.call(t.getElementsByClassName(n.substring(1))));
    } })), o; }, r = function (e, n, t) { t.setAttribute(e, n); }, o = [], i = function () { for (var e = [], n = 0; n < arguments.length; n++)
        e[n] = arguments[n]; for (var t = {}, r = 0, o = function (e) { for (var n in e)
        e.hasOwnProperty(n) && ("[object Object]" === Object.prototype.toString.call(e[n]) ? t[n] = i(t[n], e[n]) : t[n] = e[n]); }; r < e.length; r++)
        o(e[r]); return t; }; return { scrollTop: function () { return window.pageYOffset || document.documentElement.scrollTop; }, winSize: function () { var e = window, n = document, t = n.documentElement, r = n.getElementsByTagName("body")[0], o = e.innerWidth || t.clientWidth || r.clientWidth; return { height: e.innerHeight || t.clientHeight || r.clientHeight, width: o }; }, isPlainObject: function (e) { return "[object Object]" === Object.prototype.toString.call(e); }, isEmptyObject: function (e) { return 0 === Object.keys(e).length && e.constructor === Object; }, isFunction: e, inArray: function (e, n) { return n.indexOf(e); }, type: function (e) { return Object.prototype.toString.call(e).replace(/^\[object (.+)\]$/, "$1").toLowerCase(); }, remove: function (e) { var n; null === (n = e.parentNode) || void 0 === n || n.removeChild(e); }, empty: function (e) { for (; e.firstChild;)
            e.removeChild(e.firstChild); }, queryEl: n, qa: t, filter: function (e, n) { return Array.prototype.filter.call(document.querySelectorAll(e), n); }, addClass: function (e, n) { n.classList.add(e); }, toggleClass: function (e, n) { n.classList.toggle(e); }, removeClass: function (e, n) { n.classList.remove(e); }, getWidth: function (e) { var n = getComputedStyle(e, null), t = n.paddingLeft, r = n.paddingRight, o = e.getBoundingClientRect().width; return o -= parseFloat(t) + parseFloat(r); }, show: function (e) { e.style.display = "block"; }, hide: function (e) { e.style.display = "none"; }, getHeight: function (e) { var n = getComputedStyle(e, null), t = n.paddingTop, r = n.paddingBottom, o = e.getBoundingClientRect().height; return o -= parseFloat(t) + parseFloat(r); }, visible: function (e) { return !!(e.offsetWidth || e.offsetHeight || e.getClientRects().length); }, append: function (e, n) { e.appendChild(n); }, setAttr: r, setAttrs: function (e, n) { Object.keys(e).forEach((function (t) { r(t, e[t], n); })); }, getAttr: function (e, t) { return "string" == typeof e && (e = n(e)), e ? e.getAttribute(t) : null; }, ready: function (e) { "loading" != document.readyState ? e() : document.addEventListener("DOMContentLoaded", (function () { return e(); })); }, delegate: function (e, n, t, r) { var i = function (t) { for (var i = t.target; i && null != i; i = i.parentNode) {
            var a = o.findIndex((function (t) { return t.parentEl === e && t.elementSelector === n; }));
            if (i.matches && i.matches(n) && a >= 0) {
                r.call(i, t);
                break;
            }
        } }; o.push({ parentEl: e, elementSelector: n, handler: i, eventName: t }), e.addEventListener(t, i, !1); }, undelegate: function (e, n) { o = o.filter((function (t) { var r = t.parentEl !== e && t.elementSelector !== n; return r || t.parentEl.removeEventListener(t.eventName, t.handler), r; })); }, on: function (e, n, t) { e.addEventListener(n, (function (e) { t(e); }), !1); }, off: function (e, n, t) { e.removeEventListener(n, t); }, deepExtend: i, param: function (n) { var t = [], r = function (n, t) { return encodeURIComponent(n) + "=" + encodeURIComponent(e(t) ? t() : t || 0 === t || !1 === t ? t : ""); }; return Object.keys(n).forEach((function (e) { Array.isArray(n[e]) ? n[e].forEach((function (n) { t.push(r(e, n)); })) : t.push(r(e, n[e])); })), t.join("&"); } }; };
    pn.container.register("jqUtils", { useValue: de() }), pn.jqUtils = pn.container.resolve("jqUtils");
    var pe = function () { var e = {}, n = /\+/g, t = function (e) { try {
        return decodeURIComponent(e.replace(n, " "));
    }
    catch (e) { } }, r = function (e) { 0 === e.indexOf('"') && (e = e.slice(1, -1).replace(/\\"/g, '"').replace(/\\\\/g, "\\")), e = t(e); try {
        return e;
    }
    catch (e) { } }, o = function (n, o, i) { if (void 0 !== o) {
        if ("number" == typeof (i = Object.assign({}, e, i)).expires) {
            var a = i.expires, s = i.expires = new Date;
            s.setDate(s.getDate() + a);
        }
        return o = String(o), document.cookie = [encodeURIComponent(n), "=", encodeURIComponent(o), i.expires ? "; expires=" + i.expires.toUTCString() : "", i.path ? "; path=" + i.path : "", i.domain ? "; domain=" + i.domain : "", i.secure ? "; secure" : "", i.samesite ? "; samesite=" + i.samesite : ""].join("");
    } for (var c, l = document.cookie ? document.cookie.split("; ") : [], u = 0, d = l.length; u < d; u++) {
        var p = l[u].split("="), f = t(p.shift()), m = p.join("=");
        if (n && n === f) {
            c = r(m);
            break;
        }
        n || void 0 === (m = r(m)) || (c[f] = m);
    } return c; }; return { name: "cookie", defaults: e, raw: !1, json: false, pluses: n, set: function (e, n, t) { o(e, n, t); }, get: function (e) { return o(e); }, remove: function (e, n) { return void 0 !== o(e) && (o(e, "", Object.assign({}, n, { expires: -1 })), !0); } }; }();
    pn.container.register("cookie", { useValue: pe }), pn.cookie = pn.container.resolve("cookie");
    var fe = function (e) { function n(e) { var n, t, r, o = arguments.length, i = window[e], a = arguments, s = a[1]; if (o < 2)
        throw new Error("Minimum 2 arguments must be given"); if (Array.isArray(s)) {
        for (var c in t = {}, s) {
            n = s[c];
            try {
                t[n] = JSON.parse(i.getItem(n));
            }
            catch (e) {
                t[n] = i.getItem(n);
            }
        }
        return t;
    } if (2 != o) {
        try {
            t = JSON.parse(i.getItem(s));
        }
        catch (e) {
            throw new ReferenceError(s + " is not defined in this storage");
        }
        for (c = 2; c < o - 1; c++)
            if (void 0 === (t = t[a[c]]))
                throw new ReferenceError([].slice.call(a, 1, c + 1).join(".") + " is not defined in this storage");
        if (Array.isArray(a[c])) {
            for (var l in r = t, t = {}, a[c])
                t[a[c][l]] = r[a[c][l]];
            return t;
        }
        return t[a[c]];
    } try {
        return JSON.parse(i.getItem(s));
    }
    catch (e) {
        return i.getItem(s);
    } } function t(n) { var t, r, o = arguments.length, i = window[n], a = arguments, s = a[1], c = a[2], l = {}; if (o < 2 || !e.isPlainObject(s) && o < 3)
        throw new Error("Minimum 3 arguments must be given or second parameter must be an object"); if (e.isPlainObject(s)) {
        for (var u in s)
            t = s[u], e.isPlainObject(t) ? i.setItem(u, JSON.stringify(t)) : i.setItem(u, t);
        return s;
    } if (3 == o)
        return "object" == typeof c ? i.setItem(s, JSON.stringify(c)) : i.setItem(s, c), c; try {
        null != (r = i.getItem(s)) && (l = JSON.parse(r));
    }
    catch (e) { } r = l; for (u = 2; u < o - 2; u++)
        r[t = a[u]] && e.isPlainObject(r[t]) || (r[t] = {}), r = r[t]; return r[a[u]] = a[u + 1], i.setItem(s, JSON.stringify(l)), l; } function r(e) { var n, t, r = arguments.length, o = window[e], i = arguments, a = i[1]; if (r < 2)
        throw new Error("Minimum 2 arguments must be given"); if (Array.isArray(a)) {
        for (var s in a)
            o.removeItem(a[s]);
        return !0;
    } if (2 == r)
        return o.removeItem(a), !0; try {
        n = t = JSON.parse(o.getItem(a));
    }
    catch (e) {
        throw new ReferenceError(a + " is not defined in this storage");
    } for (s = 2; s < r - 1; s++)
        if (void 0 === (t = t[i[s]]))
            throw new ReferenceError([].slice.call(i, 1, s).join(".") + " is not defined in this storage"); if (Array.isArray(i[s]))
        for (var c in i[s])
            delete t[i[s][c]];
    else
        delete t[i[s]]; return o.setItem(a, JSON.stringify(n)), !0; } function o(t) { var r = arguments.length, i = arguments, s = i[1]; if (1 == r)
        return 0 == a(t).length; if (Array.isArray(s)) {
        for (var c = 0; c < s.length; c++)
            if (!o(t, s[c]))
                return !1;
        return !0;
    } try {
        var l = n.apply(this, arguments);
        for (var c in Array.isArray(i[r - 1]) || (l = { totest: l }), l)
            if (!(e.isPlainObject(l[c]) && e.isEmptyObject(l[c]) || Array.isArray(l[c]) && !l[c].length) && l[c])
                return !1;
        return !0;
    }
    catch (e) {
        return !0;
    } } function i(e) { var t = arguments.length, r = arguments, o = r[1]; if (t < 2)
        throw new Error("Minimum 2 arguments must be given"); if (Array.isArray(o)) {
        for (var a = 0; a < o.length; a++)
            if (!i(e, o[a]))
                return !1;
        return !0;
    } try {
        var s = n.apply(this, arguments);
        for (var a in Array.isArray(r[t - 1]) || (s = { totest: s }), s)
            if (void 0 === s[a] || null === s[a])
                return !1;
        return !0;
    }
    catch (e) {
        return !1;
    } } function a(t) { var r = arguments.length, o = window[t], i = arguments, a = [], s = {}; if ((s = r > 1 ? n.apply(this, i) : o)._cookie)
        for (var c in e.cookie())
            "" != c && a.push(c.replace(s._prefix, ""));
    else
        for (var l in s)
            a.push(l); return a; } function s(n) { if (!n || "string" != typeof n)
        throw new Error("First parameter must be a string"); c ? (window.localStorage.getItem(n) || window.localStorage.setItem(n, "{}"), window.sessionStorage.getItem(n) || window.sessionStorage.setItem(n, "{}")) : (window.localCookieStorage.getItem(n) || window.localCookieStorage.setItem(n, "{}"), window.sessionCookieStorage.getItem(n) || window.sessionCookieStorage.setItem(n, "{}")); var t = { localStorage: Object.assign({}, e.localStorage, { _ns: n }), sessionStorage: Object.assign({}, e.sessionStorage, { _ns: n }) }; return e.cookie && (window.cookieStorage.getItem(n) || window.cookieStorage.setItem(n, "{}"), t.cookieStorage = Object.assign({}, e.cookieStorage, { _ns: n })), e.namespaceStorages[n] = t, t; } var c = function (e) { var n = "jsapi"; try {
        return !!window[e] && (window[e].setItem(n, n), window[e].removeItem(n), !0);
    }
    catch (e) {
        return !1;
    } }("localStorage"), l = { _type: "", _ns: "", _callMethod: function (e, n) { var t = [this._type], r = (n = Array.prototype.slice.call(n))[0]; return this._ns && t.push(this._ns), "string" == typeof r && -1 !== r.indexOf(".") && (n.shift(), [].unshift.apply(n, r.split("."))), [].push.apply(t, n), e.apply(this, t); }, get: function () { return this._callMethod(n, arguments); }, set: function () { var n = arguments.length, r = arguments, o = r[0]; if (n < 1 || !e.isPlainObject(o) && n < 2)
            throw new Error("Minimum 2 arguments must be given or first parameter must be an object"); if (e.isPlainObject(o) && this._ns) {
            for (var i in o)
                t(this._type, this._ns, i, o[i]);
            return o;
        } var a = this._callMethod(t, r); return this._ns ? a[o.split(".")[0]] : a; }, remove: function () { if (arguments.length < 1)
            throw new Error("Minimum 1 argument must be given"); return this._callMethod(r, arguments); }, removeAll: function (n) { return this._ns ? (t(this._type, this._ns, {}), !0) : function (n, t) { var o = a(n); for (var i in o)
            r(n, o[i]); if (t)
            for (var i in e.namespaceStorages)
                s(i); }(this._type, n); }, isEmpty: function () { return this._callMethod(o, arguments); }, isSet: function () { if (arguments.length < 1)
            throw new Error("Minimum 1 argument must be given"); return this._callMethod(i, arguments); }, keys: function () { return this._callMethod(a, arguments); } }; e.cookie && (window.name || (window.name = Math.floor(1e8 * Math.random()))), e.initNamespaceStorage = function (e) { return s(e); }, c ? (e.localStorage = Object.assign({}, l, { _type: "localStorage" }), e.sessionStorage = Object.assign({}, l, { _type: "sessionStorage" })) : (e.localStorage = Object.assign({}, l, { _type: "localCookieStorage" }), e.sessionStorage = Object.assign({}, l, { _type: "sessionCookieStorage" })), e.namespaceStorages = {}, e.removeAllStorages = function (n) { e.localStorage.removeAll(n), e.sessionStorage.removeAll(n), e.cookieStorage && e.cookieStorage.removeAll(n), n || (e.namespaceStorages = {}); }; }, me = function () { var e = pn.container.resolve("cookie"), n = pn.container.resolve("jqUtils"), t = { cookie: e.set, isPlainObject: n.isPlainObject, isEmptyObject: n.isEmptyObject }; fe(t); return { get: function (e) { if (window.localStorage && "function" == typeof window.localStorage.getItem)
            return t.localStorage.get(e); }, set: function (e, n) { window.localStorage && "function" == typeof window.localStorage.getItem && t.localStorage.set(e, n); }, remove: function (e) { window.localStorage && "function" == typeof window.localStorage.getItem && t.localStorage.remove(e); } }; }();
    pn.container.register("localStorage", { useValue: me }), pn.localStorage = pn.container.resolve("localStorage");
    var ge, ve = (ge = function () { return "14.142.1, server-v14.142.1-TS-edition"; }, window.__tpVersion = "14.142.1, server-v14.142.1-TS-edition", { name: "versionService", getTinypassVersion: ge });
    pn.container.register("versionService", { useValue: ve }), pn.versionService = pn.container.resolve("versionService");
    var he = function () { var e, n = pn.container.resolve("ajax"), t = {}; return { name: "itp", synchronizeCookie: function (r, o, i) { if (pn.cloudflareWorkerUrl) {
            !function (e, n, r) { if (t[e] = { value: n }, !r)
                return; r instanceof Date ? t[e].expires = r : t[e].maxAge = 3600 * r; }(r, o, i), e && clearTimeout(e), e = setTimeout((function () { n.request({ url: pn.cloudflareWorkerUrl + "?maxAge=2628000", type: "POST", data: JSON.stringify(t), crossDomain: !0, xhrFields: { withCredentials: !0 }, error: function (e, n) { console.error(n); } }), t = {}; }), 2500);
        } } }; }();
    pn.container.register("itp", { useValue: he }), pn.itp = pn.container.resolve("itp");
    var we = function (e, n) { return we = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, n) { e.__proto__ = n; } || function (e, n) { for (var t in n)
        Object.prototype.hasOwnProperty.call(n, t) && (e[t] = n[t]); }, we(e, n); };
    var ye = function () { return ye = Object.assign || function (e) { for (var n, t = 1, r = arguments.length; t < r; t++)
        for (var o in n = arguments[t])
            Object.prototype.hasOwnProperty.call(n, o) && (e[o] = n[o]); return e; }, ye.apply(this, arguments); };
    function be(e, n) { return function (t, r) { n(t, r, e); }; }
    function ke(e, n) { if ("object" == typeof Reflect && "function" == typeof Reflect.metadata)
        return Reflect.metadata(e, n); }
    function _e(e, n, t) { if (t || 2 === arguments.length)
        for (var r, o = 0, i = n.length; o < i; o++)
            !r && o in n || (r || (r = Array.prototype.slice.call(n, 0, o)), r[o] = n[o]); return e.concat(r || Array.prototype.slice.call(n)); }
    var Ce = function (e) { void 0 === e && (e = pn.container); var n, t = e.resolve("jqUtils"), r = e.resolve("cookie"), o = e.resolve("versionService"), i = e.resolve("itp"), a = e.resolve("localStorage"), s = "", c = { ENABLED_AFTER_DISABLED: -2, NOT_DETECTED: -1, DISABLED: 0, ENABLED: 1 }; void 0 === "testString".toHex && Object.defineProperty(String.prototype, "toHex", { enumerable: !1, value: function () { for (var e = "", n = 0; n < this.length; ++n)
            e += "" + this.charCodeAt(n).toString(16); return e; } }); var l = function (e, n, t) { var o = { path: "/", expires: 0 }; void 0 !== n && (o.domain = n), void 0 !== t && (o.path = t), r.remove(e, o); }, u = function (e, n, t) { -1 !== n.indexOf("abril.com.br") && l(e, ".abril.com.br", t), -1 !== n.indexOf("scotsman.com") && l(e, ".scotsman.com", t); }, d = function (e) { var n; if (0 === document.cookie.length)
        return null; if (e instanceof RegExp)
        for (var t = document.cookie.split(";"), r = 0; r < t.length; r++) {
            var o = t[r].indexOf("=");
            if (-1 !== o) {
                var i, a = t[r].substr(0, o).trim();
                if (e.test(a)) {
                    i = t[r].substr(o + 1).trim();
                    try {
                        return decodeURIComponent(i);
                    }
                    catch (n) {
                        f('Could not uri-decode cookie "' + e.toString() + '"', n);
                    }
                    return i;
                }
            }
        }
    else {
        var s = ("; " + document.cookie).split("; " + e + "=");
        if (s.length >= 2) {
            var c = null === (n = s.pop()) || void 0 === n ? void 0 : n.split(";").shift();
            if (void 0 === c)
                return null;
            try {
                return decodeURIComponent(c);
            }
            catch (n) {
                f('Could not uri-decode cookie "' + e + '"', n);
            }
            return c;
        }
    } return null; }, p = function (e) { if (0 === document.cookie.length)
        return []; for (var n = [], t = document.cookie.split(";"), r = 0; r < t.length; r++) {
        var o = t[r].indexOf("=");
        if (-1 !== o) {
            var i, a = t[r].substr(0, o).trim();
            if (e instanceof RegExp && e.test(a)) {
                i = t[r].substr(o + 1).replace(/^\s+|\s+$/g, "");
                try {
                    i = decodeURIComponent(i);
                }
                catch (n) {
                    f('Could not uri-decode cookie "' + e.toString() + '"', n);
                }
                n.push({ name: a, value: i });
            }
            else if (a === e) {
                i = t[r].substr(o + 1).replace(/^\s+|\s+$/g, "");
                try {
                    i = decodeURIComponent(i);
                }
                catch (n) {
                    f('Could not uri-decode cookie "' + e + '"', n);
                }
                n.push({ name: a, value: i });
            }
        }
    } return n; }; function f() { for (var e = [], n = 0; n < arguments.length; n++)
        e[n] = arguments[n]; !0 === pn.debug && m.apply(void 0, e); } function m() { for (var e = [], n = 0; n < arguments.length; n++)
        e[n] = arguments[n]; if (window.console && window.console.log && window.console.log.apply && window.console.log.apply.call && void 0 !== window.console && void 0 !== window.console.log) {
        var t = ["TP:"];
        try {
            for (var r = 0; r < e.length; r++)
                t.push(e[r]);
        }
        catch (n) {
            t = e;
        }
        G() && (t = v(t)), "object" == typeof window.console.log ? window.console.log.apply.call(this, console, t) : console.log.apply(console, t);
    } } var g = function () { var e = 0; return window.pageYOffset ? e = window.pageYOffset : e = "number" == typeof (e = document.documentElement || document.body.parentNode).scrollTop ? e.scrollTop : document.body.scrollTop, e; }, v = function (e) { var n = ""; try {
        for (var t = 0; t < e.length; t++)
            try {
                n += JSON.stringify(e[t]) + ", ";
            }
            catch (e) {
                n += "" + e;
            }
        return [n];
    }
    catch (n) {
        return e;
    } }, h = function () { var e, n; return "CSS1Compat" === document.compatMode ? (e = document.documentElement.clientWidth, n = document.documentElement.clientHeight) : (e = document.body.clientWidth, n = document.body.clientHeight), { x: e, y: n }; }, w = function (e) { e = e.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]"); var n = new RegExp("[\\?&]" + e + "=([^&#]*)").exec(location.search); return null === n ? "" : decodeURIComponent(n[1].replace(/\+/g, " ")); }, y = function (e) { var n = e(location.href); if (history && "function" == typeof history.replaceState) {
        var t = "object" == typeof window.next && "object" == typeof window.next.router ? { url: e(history.state.url || ""), as: e(history.state.as || ""), options: history.state.options } : history.state;
        history.replaceState(t, document.title, n);
    }
    else
        location.href = n; }, b = function (e, n, t) { var r = ye({ path: "/", expires: 730 }, t && { domain: t }), o = S(); for (var i in o)
        l(e, o[i]); r.domain && u(e, r.domain), (pn.cookieDomain || pn.cookiePath) && (r.domain = pn.cookieDomain ? pn.cookieDomain : r.domain, l(e, r.domain, r.path), r.path = pn.cookiePath ? pn.cookiePath : r.path, l(e, r.domain, r.path)), l(e), q(e, n, r); }, k = function () { var e, n, t = "get_top_level_domain_cookie", r = document.location.hostname.split("."); for (e = r.length - 1; e >= 0; e--) {
        var o = { path: "/", domain: n = "." + r.slice(e).join(".") };
        if (q(t, n, o), V(t))
            return o.expires = new Date(1), q(t, n, o), n;
    } }, _ = function (e) { return pn.useAidSpecifiedCookies && pn.aid ? e + "_" + pn.aid : e; }, C = function () { var e, n = _("__pls"), t = d(n); if (t)
        try {
            if ((e = JSON.parse(t)) && !Array.isArray(e))
                throw new Error("Push list subscriptions must be an array");
        }
        catch (e) {
            f("Can't get push list subscriptions", e);
        } return e; }, I = function (e) { n = e; var t = k(); q("__pat", n, { path: "/", expires: 30, domain: t }); }, S = function () { var e = []; e.push(document.domain); for (var n = document.domain.split("."); n.length >= 2;)
        e.push("." + n.join(".")), n.shift(); return e; }, x = function (e) { var n = V(e); return "boolean" === t.type(n) || "string" === t.type(n) && n.length ? !0 === n || "true" === n ? c.ENABLED : c.DISABLED : c.NOT_DETECTED; }, P = function () { var e = V("__pnahc"), n = !1; return void 0 === e && (e = "0", n = !0), { cookieValue: parseInt(e, 10), isFirst: n }; }, E = {}, T = function (e) { E[e] ? E[e].counter++ : E[e] = { counter: 1, waiters: [] }; }, A = function (e, n) { if (E[e] && (E[e].counter--, E[e].counter <= 0)) {
        var t = [];
        E[e].waiters.forEach((function (e) { t.push(e); })), delete E[e], t.forEach((function (e) { e(void 0 !== n ? n : {}); }));
    } }, M = function () { return navigator.userAgent || navigator.vendor || window.opera; }, O = function () { return o.getTinypassVersion().indexOf("SNAPSHOT") >= 0; }, R = function () { return "https:" === document.location.protocol; }, L = function (e, n) { var t = [], r = e.indexOf(n); return -1 === r ? t.push(e) : (t.push(e.substr(0, r)), t.push(e.substr(r + 1))), t; }, N = function (e) { var n, t, r = L(e, "="); void 0 !== e && (n = r[0], t = r[1]); var o = ""; return void 0 !== n && (o += encodeURIComponent(decodeURIComponent(n))), void 0 !== t && (o += "=" + encodeURIComponent(decodeURIComponent(t))), o; }, U = function (e) { var n = parseInt(e, 10); return !(isNaN(parseFloat(n)) || n < 0 || n > 255); }, j = function (e) { var n = document.createElement("a"); n.href = /^https?:\/\//i.test(e) ? e : "http://" + e; var t = n.hostname; return 0 === t.indexOf("www.") && (t = t.replace("www.", "")), t; }; var D = function (e, n) { return new RegExp("\\?" + n, "gi").test(e) ? e.split("&").length > 1 ? e.replace(new RegExp(n + "[^&]+&?", "gi"), "") : e.replace(new RegExp("\\?" + n + "[^&]+&?", "gi"), "") : new RegExp("\\&" + n, "gi").test(e) ? e.replace(new RegExp("\\&" + n + "[^&]+", "gi"), "") : e; }, F = function (e, n) { try {
        var t = new Error, r = pn.user.getProvider().getName(), o = JSON.stringify([{ aid: pn.aid, description: "clearing __tp cookie", userProvider: r, accessTokenList: e, userToken: n, url: window.location.href, trace: X(t.stack, 3), tags: ["sdk"] }]);
        pn.api.callApi("/anon/error/log", { log_message: o });
    }
    catch (e) { } }; var B = function (e) { e || (e = 730); var n = pn.getMaxCookieExpirationInDays(); if (null !== n) {
        var t;
        "number" == typeof e ? (t = new Date).setDate(t.getDate() + e) : t = e;
        var r = new Date;
        if (r.setDate(r.getDate() + n), t > r)
            return n;
    } return e; }, V = function (e) { return r.get(e); }, q = function (e, n, t) { t = t || {}, "11C6aYHwtb" === pn.aid ? (t.samesite = "none", t.secure = !0) : t.samesite = "lax", t.expires && (t.expires = B(t.expires)), r.set(e, n, t), void 0 !== i.synchronizeCookie && i.synchronizeCookie(e, n, t.expires); }, z = "__tp-", H = "-expiration", W = function () { return Math.floor((new Date).getTime() / 1e3); }, J = function (e) { var n = z + e; a.remove(n), a.remove(n + H); }, G = function () { var e = ["__webdriver_evaluate", "__selenium_evaluate", "__webdriver_script_function", "__webdriver_script_func", "__webdriver_script_fn", "__fxdriver_evaluate", "__driver_unwrapped", "__webdriver_unwrapped", "__driver_evaluate", "__selenium_unwrapped", "__fxdriver_unwrapped"], n = ["_phantom", "__nightmare", "_selenium", "callPhantom", "callSelenium", "_Selenium_IDE_Recorder"]; for (var t in n) {
        if (window[n[t]])
            return !0;
    } for (var r in e) {
        var o = e[r];
        if (window.document[o])
            return !0;
    } for (var i in window.document)
        if (i.match(/\$[a-z]dc_/) && window.document[i].cache_)
            return !0; return !!(window.external && window.external.toString && window.external.toString() && -1 !== window.external.toString().indexOf("Sequentum")) || (!!window.document.documentElement.getAttribute("selenium") || (!!window.document.documentElement.getAttribute("webdriver") || !!window.document.documentElement.getAttribute("driver"))); }, Q = function () { return V("__tac"); }, X = function (e, n) { return e && e.split("\n").filter((function (e, t) { return t > 0 && t < n + 1; })).map((function (e) { return e.trim(); })).join("\n"); }; return { name: "util", __private__: { getAdjustedCookieExpiration: B }, __protected__: { deleteTLDCookieForSpecificDomains: u, documentReady: function (e) { var n = function () { document.removeEventListener("DOMContentLoaded", n), window.removeEventListener("load", n), e(); }; "complete" === document.readyState || "loading" !== document.readyState && !document.documentElement.doScroll ? window.setTimeout(e) : (document.addEventListener("DOMContentLoaded", n), window.addEventListener("load", n)); }, getCookie: V, setCookie: q, getLocalStorageItem: function (e) { var n = z + e, t = a.get(n), r = a.get(n + H); return r && r < W() ? (J(e), null) : t; }, hasLocalStorage: function () { try {
                return "object" == typeof window.localStorage && "function" == typeof window.localStorage.getItem;
            }
            catch (e) {
                return !1;
            } }, randomStringCxCompatible: function () { for (var e = (new Date).getTime().toString(36); e.length < 16;)
                e += Math.round(2147483647 * Math.random()).toString(36); return e.substr(0, 16); }, setLocalStorageItem: function (e, n, t) { var r = z + e; a.set(r, n), t && a.set(r + H, W() + t); }, removeLocalStorageItem: J, cameFromFbSubscriptions: function () { return 0 === w("redirect_uri").indexOf("https://www.facebook.com/subscriptions/account-linking/confirm/"); }, logRemoveTokens: function (e) { try {
                var n = new Error, t = pn.user.getProvider().getName(), r = JSON.stringify([{ aid: pn.aid, description: "clearing __utp cookie", userProvider: t, userToken: e, url: window.location.href, trace: X(n.stack, 3), tags: ["sdk"] }]);
                pn.api.callApi("/anon/error/log", { log_message: r });
            }
            catch (e) { } }, waitAllPromises: function (e) { return Promise.all(e); }, isInteger: function (e) { return "number" == typeof e && isFinite(e) && Math.floor(e) === e; }, racePromise: function (e) { return Promise.race(e); }, isCxenseBot: function () { var e = M(); return /(cxensebot)/i.test(e); }, isHttpsProtocol: R, isApplePayAllowed: function () { var e = !1; try {
                e = window.ApplePaySession && window.ApplePaySession.canMakePayments();
            }
            catch (e) {
                m("ApplePay error", e);
            } return (O() || R()) && e; }, isDevEndpoint: O }, addScript: function (e, n) { var t, r = document.createElement("script"), o = document.getElementsByTagName("script")[0]; null === (t = o.parentNode) || void 0 === t || t.insertBefore(r, o), r.type = "text/javascript", r.async = !0, r.onload = n, r.src = e; }, fromUnderscoreToCamelCase: function (e) { return e.slice().replace(/_[a-z]/g, (function (e) { return e.replace("_", "").toUpperCase(); })); }, randomString: function (e) { e || (e = 5); var n = "", t = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"; if (window.crypto && window.crypto.getRandomValues && "function" == typeof Uint32Array) {
            var r = new Uint32Array(e);
            window.crypto.getRandomValues(r);
            for (var o = 0; o < e; o++)
                n += t.charAt(r[o] % t.length);
        }
        else
            for (o = 0; o < e; o++)
                n += t.charAt(Math.floor(Math.random() * t.length)); return n; }, log: m, debug: f, error: function () { for (var e, n = [], t = 0; t < arguments.length; t++)
            n[t] = arguments[t]; m.apply(void 0, n), (e = "string" == typeof arguments[0] ? new Error(arguments[0]) : new Error).stack && m(e.stack); }, findCookieByName: d, findCookiesByName: p, removeVoucherCodeFromUrl: function (e) { return D(e, "voucher_code"); }, removeSharedAccountCodeFromUrl: function (e) { return D(e, "shared_account_code"); }, deleteCookie: l, mapArrayIndex: function (e, n) { return n; }, getScroll: g, getPageSize: function () { return { x: Math.max(document.documentElement.clientWidth, document.body.scrollWidth, document.documentElement.scrollWidth, document.body.offsetWidth, document.documentElement.offsetWidth), y: Math.max(document.documentElement.clientHeight, document.body.scrollHeight, document.documentElement.scrollHeight, document.body.offsetHeight, document.documentElement.offsetHeight) }; }, getViewport: h, center: function (e, n) { var t = g(), r = h(); return (r = { x: r.x / 2 - e / 2, y: r.y / 2 - n / 2 + t }).x = Math.max(0, r.x), r.y = Math.max(10, r.y), r; }, centerScreen: function (e, n) { e = e || 0, n = n || 0; var r = void 0 !== window.screenLeft ? window.screenLeft : window.screen.left, o = void 0 !== window.screenTop ? window.screenTop : window.screen.top, i = t.winSize(); return { left: (i.width || document.documentElement.clientWidth || window.screen.width) / 2 - e / 2 + r, top: (i.height || document.documentElement.clientHeight || window.screen.height) / 2 - n / 2 + o }; }, getQueryParamByName: w, hasQueryParamByName: function (e) { var n = {}; return location.search.substr(1).split("&").forEach((function (e) { var t = e.split("="), r = t[0], o = t[1] && decodeURIComponent(t[1]); r in n ? n[r].push(o) : n[r] = [o]; })), n.hasOwnProperty(e); }, removeQueryParamByName: function (e) { y((function (n) { return function (e, n) { var t, r = e.split("#"), o = r[0].split("?"); if (r.length >= 2 && (t = r[1]), n = Array.isArray(n) ? n : [n], o.length >= 2) {
            for (var i = o[1].split(/[&;]/g), a = 0; a < n.length; a++)
                for (var s = encodeURIComponent(n[a]) + "=", c = i.length; c-- > 0;)
                    -1 !== i[c].lastIndexOf(s, 0) && i.splice(c, 1);
            return e = o[0] + (i.length > 0 ? "?" + i.join("&") : ""), t ? e + "#" + t : e;
        } return e; }(n, e); })); }, setAccessTokenListCookie: function (e, n, r) { var o = _("__ut"); if (e && "string" === t.type(e.value)) {
            var i = new Date, a = { domain: undefined, path: "/", expires: 730 };
            e.cookie_domain && "localhost" !== e.cookie_domain && t.inArray(e.cookie_domain, S()) >= 0 && (a.domain = e.cookie_domain), pn.cookieDomain && (a.domain = pn.cookieDomain), pn.cookiePath && (a.path = pn.cookiePath);
            var s = S();
            for (var c in s)
                l("__tac", s[c]), l("__tae", s[c]), l(o, s[c]);
            q("__tac", e.value, a), q("__tae", i.getTime(), a), q(o, n, a), "" !== n || r || F(e, n);
        }
        else {
            var u = S();
            if (u.push(void 0), pn.cookieDomain && u.push(pn.cookieDomain), pn.cookiePath)
                for (var c in u)
                    l("__tac", u[c], pn.cookiePath), l("__tae", u[c], pn.cookiePath), l("__eea", u[c], pn.cookiePath), l(o, u[c], pn.cookiePath);
            for (var c in u)
                l("__tac", u[c]), l("__tae", u[c]), l("__eea", u[c]), l(o, u[c]);
            r || F(e, n);
        } }, setTpccCookies: function () { var e = w("tpcc"); if (e) {
            var n = new Date, t = JSON.stringify({ date: n.getTime() }), r = k();
            /^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(location.hostname) && (r = ""), r || (r = ""), q("tpcc_" + e, t, { path: "/", expires: 90, domain: r });
        } }, getCampaigns: function (e) { p(/^tpcc_.+/).forEach((function (n) { e[n.name] = n.value; })); }, getCustomCookies: function () { var e = {}; return p(/^_pc_.+/).forEach((function (n) { e[decodeURIComponent(n.name)] = n.value; })), e; }, ADBLOCKER_STATUS: c, getAdblockStatus: function () { var e, n, t = c.NOT_DETECTED, r = P(); return pn.adblockerCookieName && (t = x(pn.adblockerCookieName)), t === c.NOT_DETECTED && (t = x("__pac")), t === c.NOT_DETECTED && (t = x("__adblocker")), e = r.cookieValue, e <<= 1, (n = t) === c.ENABLED ? e |= 1 : e &= -2, n !== c.NOT_DETECTED && q("__pnahc", e + "", { path: "/", expires: 90 }), t === c.ENABLED && (r.isFirst || 1 != (r.cookieValue >> 0 & 1) && (t = c.ENABLED_AFTER_DISABLED)), t; }, getAdblockerStatusReason: function () { return void 0 !== window.blockAdBlock ? "1" : "0"; }, getAdblockerHistoryCookieInfo: P, waitCall: function (e, n) { E[e] ? E[e].waiters.push(n) : n(); }, startCall: T, doneCall: A, hasCall: function (e) { return !!E[e]; }, debounce: function (e, n, t) { var r; return function () { var o = this, i = Array.prototype.slice.call(arguments), a = function () { r = null, t || e.apply(o, i); }, s = t && !r; clearTimeout(r), r = setTimeout(a, n), s && e.apply(o, i); }; }, throttle: function (e, n) { var t, r, o = !1; return function i() { if (o)
            return t = arguments, void (r = this); e.apply(this, arguments), o = !0, setTimeout((function () { o = !1, t && (i.apply(r, t), t = r = null); }), n); }; }, profile: function (e) { function n() { return n.__invokeCount++, e.apply(this, arguments); } return Object.defineProperty(n, "__invokeCount", { writable: !0, value: 0 }), Object.defineProperty(n, "invokeCount", { get: function () { return this.__invokeCount; } }), n; }, setTbcCookieFromResponse: function (e) { e.browser && void 0 !== e.browser.tbc && b("__tbc", e.browser.tbc, e.browser.cookie_domain), e.tbc && e.tbc.cookie_value && b("__tbc", e.tbc.cookie_value, e.tbc.cookie_domain); }, setTacCookieFromResponse: function (e) { var n = (new Date).getTime(), t = Q(), r = function (e, r) { e && e !== t && (b("__tac", e, r), b("__tae", n, r)); }; e.browser && r(e.browser.tac, e.browser.cookie_domain), e.tac && r(e.tac.cookie_value, e.tac.cookie_domain); }, getTbcCookie: function () { return V("__tbc"); }, getTacCookie: Q, getAidSpecifiedName: _, getUserTokenCookie: function () { var e = _("__ut"), n = d(e); return void 0 !== n && n && n.length >= 0 ? n : null; }, getPushListsCookie: C, setPushListsCookie: function (e) { if (e) {
            var n = _("__pls"), t = C() || [];
            t.indexOf(e) > -1 || (t.push(e), l(n), q(n, JSON.stringify(t), { path: "/", expires: 730, domain: k() }));
        } }, setAppTimezoneOffsetFromResponse: function (e) { e.browser && void 0 !== e.browser.app_timezone_offset ? I(e.browser.app_timezone_offset) : void 0 !== e.timezone_offset && I(e.timezone_offset); }, setAppTimezoneOffset: I, getAppTimezoneOffset: function () { return null == n && (n = V("__pat")), n || 0; }, getBrowserTimezoneOffset: function () { return -Math.round((new Date).getTimezoneOffset()); }, str2timestamp: function (e) { if (void 0 !== e && 0 !== e.length) {
            if ("string" != typeof e && (e = "" + e), (e = e.trim()).match(/^[0-9]{0,10}$/))
                return parseInt(e);
            if (e.match(/^[0-9]{13,}$/))
                return parseInt(e) / 1e3;
            var n = Date.parse(e);
            if (n)
                return n / 1e3;
            if ((e = (e = (e = (e = e.replace(/00:([0-9]{2}(:[0-9]{2})?\s*[AP]M)/i, "12:$1").replace(/([0-9]{2})([AP|M])/i, "$1 $2")).replace(/\s*(at|@|\-|on|\|)\s*/gi, " ")).replace(/\s*(mon(day)?|tue(s?day)?|wed(nesday)?|thu((rs)?day)?|fri(day)?|sat(urday)?|sun(day)?)\s*/gi, "")).replace(/([0-9]{1,2})(st|nd|rd|th)/, "$1")).match(/\s+ET$/))
                e = 240 === (new Date).getTimezoneOffset() ? e.replace(/\s+ET$/, " EDT") : e.replace(/\s+ET$/, " EST");
            if (e = e.trim(), n = Date.parse(e))
                return n / 1e3;
            var t = e.match(/!^([a-z]+)[-/ ]([0-9]+)[-/ ]([0-9]+)(.*)$!i/);
            return t ? e = t[2] + " " + t[1] + " " + t[3] + t[4] : (t = e.match(/!^([0-9]+)[-/ ]([a-z]+)[-/ ]([0-9]+)(.*)$!i/)) && (e = t[1] + " " + t[2] + " " + t[3] + t[4]), (n = Date.parse(e)) ? n / 1e3 : void 0;
        } }, getPossibleCookieDomains: S, isMobileTabletIOs: function () { var e = M(); return /iPad|iPhone|iPod/.test(e) && !window.MSStream; }, isIphone: function () { var e = M(); return /iPhone/.test(e) && !window.MSStream; }, isIOS: function () { var e = M(); return /iPad|iPhone|iPod/.test(e) && !window.MSStream; }, isIOsUiWebView: function () { var e = M(); return /(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(e); }, isSafariOrIOsUiWebView: function () { var e = M(); return /(iPhone|iPod|iPad).*AppleWebKit/i.test(e); }, isFBOrInstWebView: function () { var e = M(); return e.indexOf("FBAN") > -1 || e.indexOf("FBAV") > -1 || e.indexOf("Instagram") > -1; }, isAndroid: function () { var e = M(); return /(android)/i.test(e); }, isIE: function () { var e = -1 !== (navigator && navigator.appVersion || "").indexOf("MSIE"), n = (navigator && navigator.userAgent || "").indexOf("Trident/") > 0; return e || n; }, isCriOS: function () { return -1 !== (navigator && navigator.userAgent || "").indexOf("CriOS"); }, isRelativeUrl: function (e) { return /^\/(?:\w+|\.{1,2}\/\w+)/.test(e); }, prepareUrlParameter: function (e) { if (!e)
            return ""; var n = function (e) { var n = e.indexOf("?"), t = e.indexOf("#"), r = !1; -1 !== t && (r = !0); var o, i = !1; -1 !== n && (i = !0), r && i && t < n && (i = !1); var a = "", s = ""; if (i) {
            var c = L(e, "?");
            if (o = c[0], r) {
                var l = L(c[1], "#");
                a = l[0], s = l[1];
            }
            else
                a = c[1];
        }
        else if (r) {
            var u = L(e, "#");
            o = u[0], s = u[1];
        }
        else
            o = e; return { schemeDomainAndPath: o, queryString: a, hash: s, hasQueryString: i, hasHash: r }; }(e = e.replace(/^((%20)|\s)+/, "")), t = encodeURI(decodeURI(n.schemeDomainAndPath)); return n.hasQueryString && (t += "?" + function (e) { var n = ""; if (void 0 !== e)
            for (var t = e.split("&"), r = 0; r < t.length; r++)
                r > 0 && (n += "&"), n += N(t[r]); return n; }(n.queryString)), n.hasHash && (t += "#" + encodeURIComponent(decodeURIComponent(n.hash))), t; }, getReferrer: function () { return document.referrer; }, getHostname: j, extractCookieDomain: function (e) { if (e && e.length && "." === e[0])
            return e; var n = e || window.location.href, t = j(n); return function (e) { var n = e.split("."), t = !0; return 4 === n.length && U(n[0]) && U(n[1]) && U(n[2]) && U(n[3]) || (t = !1), t; }(t) ? t : "localhost" === t ? null : "." + t; }, setCurrentDomainFromResponse: function (e) { void 0 !== e.browser && void 0 !== e.browser.cookie_domain && A("domainIsReceived", e.browser.cookie_domain), e.tbc && e.tbc.cookie_domain && A("domainIsReceived", e.tbc.cookie_domain); }, getCurrentDomainFromCookie: function (e) { try {
            return JSON.parse(V(e)).domain;
        }
        catch (e) {
            T("domainIsReceived");
        } }, isBot: G, getAffiliateToken: function (e) { var n = window.location.hash.slice(1); if (n) {
            var t = n.split("="), r = t[0], o = t[1];
            r && o && r === e && (y((function (e) { return e.split("#")[0]; })), s = o);
        } return s; }, removeAffiliateToken: function () { s = ""; } }; };
    pn.container.register("util", { useValue: Ce() }), pn.util = pn.container.resolve("util");
    var Ie = function () { var e, n = pn.container.resolve("jqUtils"), t = pn.container.resolve("util"), r = pn.container.resolve("ajax"), o = t.findCookieByName(/__TP_*/); if (void 0 !== window._tpm && void 0 !== window._tpm.paywallID) {
        var i = window._tpm.paywallID;
        e = t.__protected__.getCookie("umc_" + i);
    } var a = function () { return pn.getApiEndpoint(); }, s = function (n, r) { var i = t.__protected__.getCookie("__tac"); void 0 !== n && n || (n = {}), n.aid = pn.aid, e && (n.umc = e), o && (n.tp_access_token_v2 = o), i && (n.tac = i), n.user_provider || !r || r.isv || (n.user_provider = r.getName()), void 0 !== n.user_token && n.user_token || !r || r.isv || (n.user_token = "string" == typeof r.getToken() ? r.getToken() : ""); var a = t.getAffiliateToken(pn.affiliateTokenName); a && (n.affiliateToken = a); }; function c(e, o, i, c, l, u) { var d; t.debug("Calling API method: " + e), d = void 0 !== c ? c : a(), d += e, void 0 !== o && o || (o = {}); var p, f, m = t.getTbcCookie(); m && (o.tbc = m), pn.user && (p = pn.user.getProvider()), s(o, p), f = function (e) { t.debug("API Response", e), t.setTbcCookieFromResponse(e), t.setAppTimezoneOffsetFromResponse(e), t.setCurrentDomainFromResponse(e), void 0 !== i && i(e); }; var g = function (e) { var n = "/access/list", t = "/access/check"; if (e !== n && e !== t && "/user/access/list" !== e && "/user/access/check.jwt" !== e)
        return null; var r = Math.floor((new Date).getTime() / 1e3); return e === n ? { code: 0, count: 0, data: [], limit: 0, offset: 0, total: 0, ts: r } : e === t ? { code: 0, ts: 1548942314, access: { access_id: null, parent_access_id: null, granted: !1, resource: null, user: null, expire_date: r } } : { code: 403, ts: r, message: "User doesn't have permission to call this method" }; }(e); if (null === g || pn.user.getProvider().isUserValid()) {
        var v;
        !function (e) { pn.isDoubleOptInCheckOnAccessCheckEnabled && "/access/check" === e && pn.doubleOptIn.check(); }(e);
        var h = { dataType: "jsonp" };
        if (u) {
            var w = o.aid;
            delete o.aid, v = "aid=" + w, Object.assign(h, { type: "POST", dataType: "json", data: o });
        }
        else
            o.callApiJsonp = !0, v = n.param(o);
        d += "?" + v, h.url = d, l && (h.async = !1), h.success = function (e) { f(e); }, h.error = function (e) { var n = { code: 503, message: "Error: Received error when requesting API response from URL: " + d }; t.log(n.message), f(n); }, r.request(h);
    }
    else
        f(g); } return { name: "api", callApi: function (e, n, t, r, o, i) { return c(e, n, t, r, o, i); }, getEndpoint: function () { return a(); }, getCallParams: function (e, n) { return s(e, n); } }; }();
    pn.container.register("api", { useValue: Ie }), pn.api = pn.container.resolve("api");
    var Se = function () { var e, n, t, r, o, i, a, s, c, l, u, d = pn.container.resolve("jqUtils"), p = pn.container.resolve("util"), f = {}, m = {}, g = [], v = {}, h = (e = {}, i = 1, a = window, s = !1, l = "addEventListener", u = a[c = "postMessage"], e[c] = function (e, n, t) { n && (e = "string" == typeof e ? e : d.param(e), t = t || parent, u ? t[c](e, n.replace(/([^:]+:\/\/[^\/]+).*/, "$1")) : n && (t.location = n.replace(/#.*$/, "") + "#" + +new Date + i++ + "&" + e)); }, e.receiveMessage = o = function (e, i, c) { u ? (e && (r && o(), r = function (n) { if ("string" == typeof i && n.origin !== i || d.isFunction(i) && i(n.origin) === s)
        return s; e(n); }), a[l] ? a[e ? l : "removeEventListener"]("message", r, s) : a[e ? "attachEvent" : "detachEvent"]("onmessage", r)) : (n && clearInterval(n), n = null, e && (c = "number" == typeof i ? i : "number" == typeof c ? c : 100, n = setInterval((function () { var n = document.location.hash, r = /^#?\d+&/; n !== t && r.test(n) && (t = n, e({ data: n.replace(r, "") })); }), c))); }, e); var w = function (e, n, t) { t && _(t) && !(t in m) ? p.error("Cannot send message to unmanaged iframe: " + t) : t && m[t].element && ("popup" === m[t].config.displayMode || "popup" !== m[t].config.displayMode && m[t].element.contentWindow ? y(e, n, t) : (g.push({ event: e, params: n, recipient: t }), d.on(m[t].element, "load", function (e) { return function () { var n = g.filter((function (n) { return n.recipient === e; })); g = g.filter((function (n) { return n.recipient !== e; })); for (var t = n.length; t--;) {
        var r = n.pop();
        y(r.event, r.params, r.recipient);
    } }; }(t)))); }, y = function (e, n, t) { var r, o = {}, i = "popup" === m[t].config.displayMode ? "opener" : "parent"; o.sender = _(t) ? i : t, o.recipient = _(t) ? t : i, o.event = e, o.params = n; var a = m[t].element; r = "popup" === m[t].config.displayMode ? m[t].container : a && a.contentWindow ? a.contentWindow : a && "[object Window]" === a.toString() ? m[t].element : window[i], h.postMessage(JSON.stringify(o), f[t].postMessageUrl, r); }; var b = function (e) { f[e.iframeId] = { iframeConfig: null, receive: null, postMessageUrl: null, initializedListener: !1, initializedKeystrokeHandler: !1 }, m[e.iframeId] = e; }, k = function (e) { return !(!f[e] || !f[e].iframeConfig); }, _ = function (e) { return !f[e] || !f[e].iframeConfig; }, C = function (e) { var n = I(e); return n.showCloseButton && "inline" !== n.displayMode; }, I = function (e) { var n = f[e], t = n && n.iframeConfig && n.iframeConfig.iframe; return t && t.config; }; function S(e) { var n, t, r, o, i, a, s = !1; try {
        n = JSON.parse(e.data);
    }
    catch (t) {
        try {
            r = e.data, i = {}, a = { true: !0, false: !1, null: null }, r.replace(/\+/g, " ").split("&").forEach((function (e, n) { var t = n.split("="), r = ""; try {
                r = decodeURIComponent(t[0]);
            }
            catch (e) {
                return;
            } var s, c = i, l = 0, u = r.split("]["), d = u.length - 1; if (/\[/.test(u[0]) && /\]$/.test(u[d]) ? (u[d] = u[d].replace(/\]$/, ""), d = (u = u.shift().split("[").concat(u)).length - 1) : d = 0, 2 === t.length)
                if (s = decodeURIComponent(t[1]), o && (s = s && !isNaN(s) ? +s : "undefined" === s ? void 0 : void 0 !== a[s] ? a[s] : s), d)
                    for (; l <= d; l++)
                        c = c[r = "" === u[l] ? c.length : u[l]] = l < d ? c[r] || (u[l + 1] && isNaN(u[l + 1]) ? {} : []) : s;
                else
                    Array.isArray(i[r]) ? i[r].push(s) : void 0 !== i[r] ? i[r] = [i[r], s] : i[r] = s;
            else
                r && (i[r] = o ? void 0 : ""); })), (n = i) && (s = !0);
        }
        catch (n) {
            return void p.debug("Error parsing postMessage: " + e.data);
        }
    } if (x(n), s) {
        var c;
        for (var l in m)
            (t = m[l]).config.isCurtain && (c = !0, t.config.parent && f[t.config.parent].receive && f[t.config.parent].receive(n), f[l].receive && f[l].receive(n));
        c || p.debug("Error parsing postMessage: " + e.data);
    }
    else if (!_(n.sender) || n.sender && n.sender in m) {
        if (p.debug((k(n.sender) ? "iframe(" + n.recipient : "the parent") + ") received event '" + n.event + "' from iframe(" + n.sender + ")", n), f[n.sender].receive && f[n.sender].receive(n), m[n.sender] && (t = m[n.sender]).config.parent && f[t.config.parent].receive) {
            n.sender = t.config.parent, f[t.config.parent].receive(n, !0);
        }
    }
    else
        p.debug("Received message from unmanaged iframe: " + n.sender); } var x = function (e) { (v[e.event] || []).forEach((function (n) { n(e); })); }; return { name: "postmessage", init: function (e, n) { if (b(e.iframe), e.postMessageUrl) {
            if (e.iframe.iframeId) {
                f[e.iframe.iframeId].initializedKeystrokeHandler || (f[e.iframe.iframeId].initializedKeystrokeHandler = !0, d.delegate(window, "#" + e.iframe.iframeId, "keyup", (function (e) { return function (e) { 27 === e.keyCode && k(e.data.iframeId) && C(e.data.iframeId) && w("close", null, e.data.iframeId); }(e); }))), f[e.iframe.iframeId].postMessageUrl = e.postMessageUrl, f[e.iframe.iframeId].initializedListener || (f[e.iframe.iframeId].initializedListener = !0, f[e.iframe.iframeId].receive = e.receive, h.receiveMessage(S)), f[e.iframe.iframeId].iframeConfig = e;
                var t = n || {};
                t.height = document.documentElement.offsetHeight, t.width = e.iframeParams && e.iframeParams.width ? e.iframeParams.width : document.documentElement.offsetWidth, w("loaded", t, e.iframe.iframeId);
            }
        }
        else
            p.error("Must specify postMessageUrl to send and receive postMessages"); }, __protected__: { isIframeManaged: function (e) { var n = m[e]; return n && _(n); } }, send: w, removeIframe: function (e) { delete m[e], delete f[e]; }, broadcast: function (e, n, t) { for (var r in m)
            m.hasOwnProperty(r) && r === t || w(e, n, r); }, subscribe: function (e, n) { v[e] = v[e] || [], v[e].push(n); }, unsubscribe: function (e, n) { v[e] instanceof Array && (v[e] = v[e].filter((function (e) { return e !== n; }))); } }; }();
    pn.container.register("postmessage", { useValue: Se }), pn.postmessage = pn.container.resolve("postmessage");
    var xe = function () { var e = pn.container.resolve("jqUtils"), n = pn.container.resolve("util"), t = pn.container.resolve("postmessage"); return { name: "eventUtils", createEventManager: function (r) { var o, i = {}; for (o = 0; o < r.length; o++)
            i[r[o]] = []; var a = { addEvent: function (e) { void 0 === i[e] && (i[e] = []); }, hasIframeCallback: function (e, n) { var t, r; if (i[e] && i[e].length > 0)
                for (r = 0, t = null; r < i[e].length; ++r)
                    if ("object" == typeof (t = i[e][r]) && n === t.iframeId)
                        return !0; return !1; }, hasCallback: function (e) { return i[e] && i[e].length > 0; }, registerCallback: function (e, t) { var r, o, a, s = "string" == typeof e ? e : null, c = "object" == typeof e ? e : null; if (s) {
                if (r = "function" == typeof t ? t : null, void 0 === i[s])
                    return;
                i[s].push(r);
            } if (c)
                for (a in o = "string" == typeof t ? t : null, i)
                    "function" == typeof c[a] && (n.debug("Registering " + a + " callback for iframe " + o), i[a].push({ iframeId: o, callback: c[a] })); }, fireCallbacks: function (e, n, t, r) { return a.fire(t, e, r, n); }, fire: function (r, o, a, s, c, l) { var u, d, p, f = !1, m = []; s && m.push(s), c && m.push(c), l && m.push(l); var g = s && s.resultCallbackId, v = function (t) { if (a)
                try {
                    if (m.length > 1)
                        return d.apply(null, m);
                    if ("loginRequired" === o) {
                        var i = e.deepExtend({}, t.term);
                        return delete t.term, d(t, r, i);
                    }
                    return d(t, r);
                }
                catch (e) {
                    n.debug(e);
                } }; if (void 0 !== i[o]) {
                for (p = 0, u = null, d = null; p < i[o].length; ++p) {
                    if ("function" == typeof (d = i[o][p]))
                        n.debug("firing callback for event '" + o + "' from iframe(" + r + ")"), u = v(s), f = !0;
                    else if ("object" == typeof d) {
                        if (r !== d.iframeId)
                            continue;
                        n.debug("firing callback for event '" + o + "' from iframe(" + r + ")"), d = d.callback, u = v(s), f = !0;
                    }
                    g && (s.result = u, s.event = o, t.send("resultCallback", s, r));
                }
                return !f && g && (s.callbackNotFound = !0, s.event = o, t.send("resultCallback", s, r)), u;
            } }, fireCallbacksAndStopOnFirstFalse: function (e, t, r, o) { for (var a = [], s = 4; s < arguments.length; s++)
                a[s - 4] = arguments[s]; if (void 0 === i[e])
                return !0; for (var c = !0, l = 0; l < i[e].length; l++) {
                var u = i[e][l];
                if ("function" == typeof u) {
                    n.debug("firing callback for event '" + e + "'");
                    try {
                        var d = [];
                        if (d.push(t), d.push(r), d.push(o), d = d.concat([].slice.call(a)), !1 === u.apply(null, d)) {
                            n.debug("callback for event '" + e + "' returned false"), c = !1;
                            break;
                        }
                    }
                    catch (t) {
                        n.debug("firing callback for event '" + e + "' failed", t);
                    }
                }
            } return c; } }; return a; } }; }();
    pn.container.register("eventUtils", { useValue: xe }), pn.eventUtils = pn.container.resolve("eventUtils");
    var Pe = function () { var e = pn.container.resolve("util"), n = pn.container.resolve("api"), t = pn.container.resolve("eventUtils"), r = pn.container.resolve("localStorage"), o = t.createEventManager(["userChanged", "logout"]), i = "janrain", a = function () { return e.getUserTokenCookie(); }, s = function () { var e = a(); return !!(void 0 !== e && e && e.length >= 0); }, c = !1, l = !1, u = { onCaptureSessionCreated: [] }, d = { loginRequiredScreen: "signIn", appName: null, appId: null, clientId: null, settings: null, disableLogout: !1, startCapture: !1 }, p = { register: "traditionalRegistration", login: "signIn" }; var f = function (e) { return e && p.hasOwnProperty(e.startScreen) ? p[e.startScreen] : d.loginRequiredScreen; }; var m = function () { d.disableLogout || e.setAccessTokenListCookie(void 0, void 0, !0); }, g = !0, v = function () { var e = window.janrain; return e && e.capture && e.capture.ui && e.capture.ui.hasActiveSession(); }; function h() { e.log("JANRAIN:", "Processing janrain user"), g ? g = !1 : e.startCall("refreshUserToken"), e.log("JANRAIN:", "hasActiveSession:" + v()); var t = w(); if (!v())
        return e.log("JANRAIN:", "No token found.  Done processing user"), m(), void e.doneCall("refreshUserToken"); if (s())
        return e.log("JANRAIN:", "Using __ut.  Done processing user"), void e.doneCall("refreshUserToken"); var r = { janrain_capture_token: t, url: e.prepareUrlParameter(window.location.href) }; n.callApi("/anon/janrain/verifyAccountInfo", r, (function (n) { if (n && n.access)
        try {
            e.log("JANRAIN:", "Verify success.  Done processing user"), e.setAccessTokenListCookie(n.access.access_token, n.access.user_token);
            var t = { access_token: n.access.access_token, user_token: n.access.user_token };
            n.access.user && (t.user = { uid: n.access.user.uid, email: n.access.user.email, firstName: n.access.user.first_name, lastName: n.access.user.last_name, valid: n.access.user.valid }), function (e, n) { if (void 0 !== u[e] && 0 !== u[e].length)
                for (var t = 0; t < u[e].length; ++t)
                    u[e][t].apply(null, arguments); }("onCaptureSessionCreated", t), o.fireCallbacks("userChanged", t, void 0, !0);
        }
        finally {
            e.doneCall("refreshUserToken");
        }
    else
        e.log("JANRAIN:", "Verify failed"); })); } var w = function () { return r.get("janrainCaptureToken"); }, y = function () { var n = window.janrain; n.events.onProviderLogoutComplete.addHandler((function () { m(); })), n.events.onCaptureSessionEnded.addHandler((function (n) { e.log("JANRAIN: Events received for logout", n), m(); })), b(); }, b = function () { if (v())
        return e.log("JANRAIN:", "Found early active session via function"), void h(); if (!v() && !s() && !w())
        return e.log("JANRAIN:", "not found __ut cookie and janrain token"), void h(); var n = !1, t = window.janrain; t.events.onCaptureSessionFound.addHandler((function (t) { k() ? n && (e.log("JANRAIN: Events received for logged in user", t), h()) : h(); })), t.events.onCaptureSessionNotFound.addHandler((function (t) { k() ? n && (e.log("JANRAIN: Events received for logged out user", t), h()) : h(); })), t.events.onCaptureFederateNoLogin.addHandler((function (e) { n = e; })), t.events.onCaptureFederateLogin.addHandler((function (n) { e.log("JANRAIN: Events received for SSO login", n), h(); })); }, k = function () { var e = window.janrain; return e && e.settings && e.settings.capture && e.settings.capture.federate; }; function _(e, n) { if (!c)
        throw "Janrain is not configured"; var t = 0; !function r() { var o = window.janrain; if (l)
        o.events[e].addHandler((function (e) { n(e); }));
    else {
        if (t > 100)
            throw "Janrain is not initialized";
        t++, window.setTimeout(r, 100);
    } }(); } return { name: i, isv: !1, init: function (n) { if (!c) {
            if (!n.appName || !n.appId || !n.clientId)
                throw "Must specify appName, appId, and clientId to initialize janrain";
            for (var t in d)
                void 0 !== n[t] && (d[t] = n[t]);
            if (n.settings && (d.settings = n.settings), n.loginRequiredScreen && (d.loginRequiredScreen = n.loginRequiredScreen), d.settings) {
                "object" != typeof window.janrain && (window.janrain = {}), "object" != typeof window.janrain.settings && (window.janrain.settings = {});
                var r = window.janrain;
                r.settings = d.settings, "object" != typeof window.janrain.settings.capture && (window.janrain.settings.capture = {}), r.settings.appUrl = "https://" + d.appName + ".rpxnow.com", r.settings.capture.captureServer = "https://" + d.appName + ".janraincapture.com", r.settings.capture.appId = d.appId, r.settings.capture.clientId = d.clientId;
                var o, i = d.appName.replace(/\./g, "-"), a = "http://widget-cdn.rpxnow.com/load/" + i, s = "https://rpxnow.com/load/" + i;
                o = e.__protected__.isHttpsProtocol() ? s : a, pn.push(["addExternalLibrary", o, function () { r.ready = !0; }]);
            }
            e.log("JANRAIN:", "start refresh user token"), e.startCall("refreshUserToken", 3e4), e.waitCall("refreshUserToken", (function () { e.log("JANRAIN:", "end refresh user token"); })), function () { var n = 100, t = 0; function r() { var o = window.janrain; if (window.janrain && window.janrain.ready && window.janrain.capture && window.janrain.capture.ui && window.janrain.capture.ui.hasActiveSession)
                !function () { var n = window.janrain, t = function (t) { n.events[t].addHandler((function () { for (var n = [], r = 0; r < arguments.length; r++)
                    n[r] = arguments[r]; e.log("JANRAIN: ", t, n); })); }; pn.debug && n.events.captureEvents.forEach(t); }(), y(), d.startCapture && o.capture.ui.start(), l = !0;
            else {
                if (t > n)
                    throw "Janrain is not initialized";
                t++, window.setTimeout(r, 100);
            } } r(); }(), c = !0, pn.zIndexes = { backdrop: 900, modal: 950, close: 990 };
            var u = function (n) { e.log("JANRAIN: onLogin"), window.janrain.capture.ui.modal.close(), h(); };
            _("onCaptureLoginSuccess", u), _("onCaptureRegistrationSuccess", u);
        } }, isUserValid: s, getToken: a, getName: function () { return i; }, onLoginSuccess: function (n) { e.setAccessTokenListCookie({ value: n.token_list, cookie_domain: n.cookie_domain }, n.user_token); }, login: function (e, n) { if (!c)
            throw "Janrain is not configured"; var t = 0, r = function () { if (l)
            try {
                window.janrain.capture.ui.renderScreen(f(n)), "function" == typeof e && function (e, n) { u[e] = [], u[e].push(n); }("onCaptureSessionCreated", e);
            }
            catch (e) {
                return t++, void window.setTimeout(r, 100);
            }
        else {
            if (t > 100)
                throw "Janrain is not initialized";
            t++, window.setTimeout(r, 100);
        } }; r(); }, logout: function (e) { if (!c)
            throw "Janrain is not configured"; var n = 0, t = 0; function r() { t > 100 ? e() : v() ? (t++, window.setTimeout(r, 100)) : e(); } m(), function t() { if (l) {
            var i = window.janrain;
            i.capture.ui.modal.close(), i.capture.ui.endCaptureSession(), o.fireCallbacks("logout", null, void 0, !0), e && r();
        }
        else {
            if (n > 100)
                throw "Janrain is not initialized";
            n++, window.setTimeout(t, 100);
        } }(); }, isConfigured: function () { return c; }, getLoginRequiredScreen: f, addEventHandler: _, registerCallback: function (e, n) { o.addEvent(e), o.registerCallback(e, (function (e) { n(e); })); } }; }();
    pn.container.register("janrain", { useValue: Pe }), pn.janrain = pn.container.resolve("janrain");
    var Ee = { name: "sha1", hash: function (e, n) { function t(e, n) { return e << n | e >>> 32 - n; } function r(e) { var n, t = ""; for (n = 7; n >= 0; n--)
            t += (e >>> 4 * n & 15).toString(16); return t; } var o, i, a; n = n || 32; var s, c, l, u, d, p, f = new Array(80), m = 1732584193, g = 4023233417, v = 2562383102, h = 271733878, w = 3285377520, y = (e = function (e) { e = e.replace(/\r\n/g, "\n"); for (var n = "", t = 0; t < e.length; t++) {
            var r = e.charCodeAt(t);
            r < 128 ? n += String.fromCharCode(r) : r > 127 && r < 2048 ? (n += String.fromCharCode(r >> 6 | 192), n += String.fromCharCode(63 & r | 128)) : (n += String.fromCharCode(r >> 12 | 224), n += String.fromCharCode(r >> 6 & 63 | 128), n += String.fromCharCode(63 & r | 128));
        } return n; }(e)).length, b = new Array; for (i = 0; i < y - 3; i += 4)
            a = e.charCodeAt(i) << 24 | e.charCodeAt(i + 1) << 16 | e.charCodeAt(i + 2) << 8 | e.charCodeAt(i + 3), b.push(a); switch (y % 4) {
            case 0:
                i = 2147483648;
                break;
            case 1:
                i = e.charCodeAt(y - 1) << 24 | 8388608;
                break;
            case 2:
                i = e.charCodeAt(y - 2) << 24 | e.charCodeAt(y - 1) << 16 | 32768;
                break;
            case 3: i = e.charCodeAt(y - 3) << 24 | e.charCodeAt(y - 2) << 16 | e.charCodeAt(y - 1) << 8 | 128;
        } for (b.push(i); b.length % 16 != 14;)
            b.push(0); for (b.push(y >>> 29), b.push(y << 3 & 4294967295), o = 0; o < b.length; o += 16) {
            for (i = 0; i < 16; i++)
                f[i] = b[o + i];
            for (i = 16; i <= 79; i++)
                f[i] = t(f[i - 3] ^ f[i - 8] ^ f[i - 14] ^ f[i - 16], 1);
            for (s = m, c = g, l = v, u = h, d = w, i = 0; i <= 19; i++)
                p = t(s, 5) + (c & l | ~c & u) + d + f[i] + 1518500249 & 4294967295, d = u, u = l, l = t(c, 30), c = s, s = p;
            for (i = 20; i <= 39; i++)
                p = t(s, 5) + (c ^ l ^ u) + d + f[i] + 1859775393 & 4294967295, d = u, u = l, l = t(c, 30), c = s, s = p;
            for (i = 40; i <= 59; i++)
                p = t(s, 5) + (c & l | c & u | l & u) + d + f[i] + 2400959708 & 4294967295, d = u, u = l, l = t(c, 30), c = s, s = p;
            for (i = 60; i <= 79; i++)
                p = t(s, 5) + (c ^ l ^ u) + d + f[i] + 3395469782 & 4294967295, d = u, u = l, l = t(c, 30), c = s, s = p;
            m = m + s & 4294967295, g = g + c & 4294967295, v = v + l & 4294967295, h = h + u & 4294967295, w = w + d & 4294967295;
        } return (p = r(m) + r(g) + r(v) + r(h) + r(w)).toLowerCase().slice(0, n); } };
    pn.sha1 = Ee, pn.container.register("sha1", { useValue: Ee });
    var Te = function () { function e(e, n) { this._isActive = !1, this.targets = [], this.timeout = 200, this.util = n, this.callback = e; } return e.prototype._mutationSearch = function () { var e = this; this.targets.forEach((function (n) { var t = e._getState(n.element); !t === n.currentState && (n.currentState = t, e.callback([{ target: n.element }])); })), this._isActive && setTimeout(this._mutationSearch.bind(this), this.timeout); }, e.prototype._getState = function (e) { var n = [].slice.call(e.attributes).reduce((function (n, t) { return n[t.name] = e.getAttribute(t.name), n; }), {}); return JSON.stringify(n); }, e.prototype.observe = function (e) { this.targets.push({ id: this.util.randomString(), element: e, currentState: this._getState(e) }), this._isActive || (this._isActive = !0, this._mutationSearch()); }, e.prototype.disconnect = function () { this._isActive = !1, this.targets = []; }, e; }(), Ae = function () { pn.container.resolve("jqUtils"); var e = pn.container.resolve("util"), n = window.MutationObserver || window.WebKitMutationObserver || window.MozMutationObserver, t = { attributes: !0 }; return { name: "observer", create: function (r, o) { r || e.error("element must be NODE"); var i = new (n || Te)((function (e) { var n = e.map((function (e) { return e.target; })); return "function" == typeof o && o(n); }), e); return i.observe(r, t), i; } }; }();
    pn.container.register("observer", { useValue: Ae }), pn.observer = pn.container.resolve("observer");
    var Me = function () { var e, n, t = pn.container.resolve("jqUtils"), r = pn.container.resolve("util"), o = pn.container.resolve("postmessage"), i = pn.container.resolve("eventUtils"), a = pn.container.resolve("sha1"), s = {}, c = {}, l = i.createEventManager(["close"]), u = "tp-container-inner", d = new Map, p = [], f = "frozen-mobile-body", m = { _initialScrollPosition: { x: 0, y: 0 }, applyFix: function () { var e = window.visualViewport ? Math.max(window.scrollY, document.documentElement.scrollTop, window.visualViewport.pageTop) : Math.max(window.scrollY, document.documentElement.scrollTop), t = pn.dontScrollTopModal ? e : 0; this.saveInitialScroll(window.scrollX, e), n && (pn.dontScrollTopModal ? (document.body.style.touchAction = "none", document.documentElement.style.touchAction = "none", this.addEvents("scroll"), this.addEvents("touchmove")) : (v(), g(0, 0)), setTimeout((function () { var e = { overscrollBehavior: "contain", position: "absolute", top: t + "px", height: "100%", width: "100%", overflowX: "unset", overflowY: "scroll" }; Object.keys(e).forEach((function (t) { n.style[t] = e[t]; })), n.scrollHeight > document.documentElement.clientHeight && n.classList.add("tp-modal__margin-100"); }), 500)); }, addEvents: function (e) { document.body.addEventListener(e, this.scrollRevert, { passive: !1 }), document.addEventListener(e, this.scrollRevert, { passive: !1 }); }, removeEvents: function (e) { document.body.removeEventListener(e, this.scrollRevert, !1), document.removeEventListener(e, this.scrollRevert, !1); }, removeFix: function () { document.querySelectorAll(".tp-iframe-wrapper.tp-active").length || (pn.dontScrollTopModal ? (document.body.style.removeProperty("touch-action"), document.documentElement.style.removeProperty("touch-action"), this.removeEvents("scroll"), this.removeEvents("touchmove")) : (h(), this._scrollBack())); }, _scrollBack: function () { (this._initialScrollPosition.y || this._initialScrollPosition.x) && g(this._initialScrollPosition.x, this._initialScrollPosition.y); }, scrollRevert: function (e) { var n = e || window.event; return n.preventDefault && n.cancelable && n.preventDefault(), m._scrollBack(), !1; }, saveInitialScroll: function (e, n) { this._initialScrollPosition.x = e, this._initialScrollPosition.y = n; }, modalOpened: function () { this.applyFix(); }, modalClosed: function () { this.removeFix(); } }, g = function (e, n) { function t(e) { return /\{\s*\[native code\]\s*\}/.test("" + e); } try {
        if (t(window.scrollTo))
            return void window.scrollTo(e, n);
        if (t(window.scroll))
            return void window.scroll(e, n);
        document.body && (document.body.scrollTop = 0);
    }
    catch (e) {
        console.warn("Can not perform scroll: " + e.message);
    } }, v = function () { document.body.classList.contains(f) || document.body.classList.add(f); }, h = function () { document.body.classList.contains(f) && document.body.classList.remove(f); }; t.on(window, "resize", (function () { var e; if (q(), r.isAndroid()) {
        var n = null === (e = document.querySelector(".tp-iframe-wrapper.tp-active")) || void 0 === e ? void 0 : e.closest(".tp-modal");
        n && n.scrollBy(0, 1);
    } })), r.isIOS() && t.on(window, "orientationchange", (function () { setTimeout((function () { return q(); }), 100); })), o.subscribe("close", (function () { m.modalClosed(); })), o.subscribe("toggleIframeShadow", (function (e) { b(e.params.isEnabled); })), o.subscribe("toggleLoadingContainer", (function (e) { if (e.params.isEnabled)
        return J(); G(); })); var w, y, b = function (e) { var n = document.querySelector(".tp-iframe-wrapper"); if (n)
        return e ? n.classList.contains("no-shadow") && n.classList.remove("no-shadow") : void n.classList.add("no-shadow"); }, k = function (e) { !function (e) { o.send("checkProccessesForClose", {}, e.iframeId); }(e), "popup" === e.config.displayMode ? e.container.close() : function (e) { if (r.debug("Removing iframe", e), e.element && (t.hide(e.element), "inline" === e.config.displayMode)) {
        var n = e.element.parentElement;
        n && t.hide(n);
    } e.resizeObserver && e.resizeObserver.disconnect(), "modal" !== e.config.displayMode && "inline" !== e.config.displayMode || (e.waitFinishProcesses = !0); }(e); }, _ = function () { for (var e in s) {
        var n = s[e];
        if ("modal" === n.config.displayMode && !n.waitFinishProcesses && !n.config.isPreload)
            return !0;
    } return !1; }, C = function (e) { return s[e]; }, I = function () { function e(e, n, t) { this.$ = e, this._operationWithContainer = t, this.util = n, this._initModalContainer(), this.iOSBottomToolbarHeight = 90; } return e.prototype._initModalContainer = function () { var e = this; return this.container || (this.container = document.createElement("div"), this.element = this.container, this.$.addClass("tp-modal", this.container), this.close = document.createElement("button"), this.$.setAttr("type", "button", this.close), this.$.setAttr("aria-label", "Close", this.close), this.$.addClass("tp-close", this.close), this.iframeWrapper = document.createElement("div"), this.$.addClass("tp-iframe-wrapper", this.iframeWrapper), this.$.append(this.iframeWrapper, this.close), this.container.style.zIndex = pn.zIndexes.modal + "", this.close.style.zIndex = pn.zIndexes.close + "", this.$.on(this.close, "click", (function () { "function" == typeof e.closeClick && e.closeClick(); })), this.util.isIOS() && !this.util.isFBOrInstWebView() && (this.iframeWrapper.style.marginBottom = this.iOSBottomToolbarHeight + "px"), this.$.append(this.container, this.iframeWrapper), this._operationWithContainer("body", (function (n) { e.$.append(n, e.container); }))), this.container; }, e.prototype.getContainer = function (e, n) { return this._initModalContainer(), this.closeClick = n, void 0 === e && (e = !0), e ? this.showCloseButton() : this.hideCloseButton(), this.iframeWrapper; }, e.prototype.show = function (e) { this._initModalContainer(), void 0 === e && (e = !0), e ? this.showCloseButton() : this.hideCloseButton(), this.$.addClass("tp-active", this.container); }, e.prototype.hide = function () { this._initModalContainer(), this.$.removeClass("tp-active", this.container); }, e.prototype.showCloseButton = function () { this._initModalContainer(), this.$.addClass("tp-active", this.close); }, e.prototype.hideCloseButton = function () { this._initModalContainer(), this.$.removeClass("tp-active", this.close); }, e; }(), S = function (e, n, t) { for (var o in r.debug("Search container to close", e, n, t), s) {
        var i = s[o];
        e && o !== e || (t && "inline" === i.config.displayMode || t && i.config.isPreload || (k(i), "modal" === i.config.displayMode && x(i)));
    } l.fireCallbacks("close", null, e, !0); }, x = function (e) { var r = p.shift(); w && !r && t.removeClass("tp-active", w), e.iframeParams.shown = !1, t.removeClass("tp-active", e.container), r ? (t.hide(n), n = r, t.show(n)) : (P(), T()); }, P = function () { n && (L("body", (function (e) { t.addClass("tp-modal-close", e), t.removeClass("tp-modal-open", e), e.classList.contains("body-fixed") && t.removeClass("body-fixed", e); })), t.hide(n)); }, E = function (e, o, i) { if (function () { if (w)
        return w; var e = document.createElement("div"); t.addClass("tp-backdrop", e), e.style.zIndex = pn.zIndexes.backdrop + "", L("body", (function (n) { t.append(n, e); })), w = e; }(), t.visible(w)) {
        var a = t.qa(".tp-modal").find((function (e) { return t.visible(e); }));
        o && !i ? (a && (t.hide(a), p.unshift(a)), e && t.show(e)) : o && (a ? (e && p.push(e), n = a) : e && t.show(e));
    }
    else
        e && function (e) { t.visible(e) || (L("body", (function (e) { t.removeClass("tp-modal-close", e), t.addClass("tp-modal-open", e); })), t.show(e), (r.isIphone() || r.isSafariOrIOsUiWebView() || r.isAndroid()) && m.modalOpened()); }(e), t.show(w), y = window.setTimeout((function () { t.addClass("tp-active", w); }), 50); }, T = function () { w && (t.removeClass("tp-active", w), t.hide(w), clearTimeout(y)), m.modalClosed(); }, A = function (e) { w && (w.style.height = "100%"); var n = t.queryEl(".tp-close", e); n && t.removeClass("tp-square", n); }, M = function (e, n) { if (e) {
        z(e.element, n);
        var r = Object.assign({}, n, { animate: !1 });
        switch (e.config.displayMode) {
            case "modal":
                z(e.container, r), L("body", (function (e) { t.addClass("tp-modal-resizing", e), setTimeout((function () { t.removeClass("tp-modal-resizing", e); }), 50); }));
                break;
            case "inline":
                var o = t.queryEl(".tp-container-inner", e.container);
                o && z(o, n);
        }
    } }, O = function (e, r, o) { var i = e.container, a = i.parentElement; a && a.classList.contains("tp-modal") ? n = a : a = n, e.iframeParams = e.iframeParams || {}, e.iframeParams.shown || (e.iframeParams.shown = !0, E(a, r, o), o || (i.classList.contains("tp-active") || t.addClass("tp-active", i), A(i))); }, R = {}, L = function (e, n) { var r = t.queryEl(e); R[e] || (R[e] = 0), r ? (delete R[e], n(r)) : R[e] < 100 && (R[e] += 1, setTimeout((function () { L(e, n); }), 50)); }, N = function (e, o) { if (void 0 === e.showCloseButton && (e.showCloseButton = !0), e.container)
        return e.container; var i = new I(t, r, L); return e.isPreload || (n = i.element), i.getContainer(e.showCloseButton, o); }, U = function (e) { var n = { container: null, containerReady: !1 }; if (!e.iframeParams.containerSelector)
        return r.log("Inline offer must have a valid containerSelector"), n; if (n.container = e.singleContainer || t.queryEl(e.iframeParams.containerSelector), !n.container)
        return r.log("Invalid containerSelector"), n; var o = e.config, i = "object" == typeof o && null !== o; return t.empty(n.container), i ? !0 == !!o.preview || (e.iframeParams.width = t.getWidth(n.container)) : e.iframeParams.width = e.iframeParams.width || t.getWidth(n.container), n.containerReady = !0, n; }, j = function (e) { var n = t.winSize(), o = e.width ? e.width : n.width, i = e.height ? e.height : n.height, a = r.centerScreen(o, i); return { width: o, height: i, top: a.top, left: a.left }; }, D = function (e, n) { var t = j(e), o = window.open(n, r.randomString(16), "scrollbars=yes,location=yes,status=0,toolbar=0,resizable=1, width=" + t.width + ", height=" + t.height + ", top=" + t.top + ", left=" + t.left); return window.focus && o && o.focus(), o; }, F = 1, B = function (e, n, o) { var i = "iframe-" + F++ + "-" + r.randomString(); n.iframeId && (i = n.iframeId); var a = document.createElement("iframe"), s = { id: i, name: i, title: i, scrolling: "no", allowtransparency: "true", src: o, allow: "payment" }; Object.keys(s).forEach((function (e) { t.setAttr(e, s[e], a); })); var c = { overflow: "hidden", backgroundColor: "transparent", border: "0", width: "inline" === e.displayMode ? n.width + "px" : "0px", height: "0px" }; Object.keys(c).forEach((function (e) { a.style[e] = c[e]; })); try {
        t.setAttr("frameBorder", "0", a);
    }
    catch (e) {
        r.log(e);
    } return a; }, V = function (e, n) { var r = setInterval((function () { t.empty(e); }), 150); t.ready((function () { clearInterval(r), t.append(e, n); })); }, q = function () { for (var e in s) {
        var n = s[e];
        if (!n.config.preview && "inline" === n.config.displayMode && n.container && M(n, { width: t.getWidth(n.container) }), "modal" === n.config.displayMode && n.container) {
            var r = Math.max(document.documentElement.clientWidth, document.body.offsetWidth, document.documentElement.offsetWidth);
            o.send("RESIZE_MODAL_CHECKOUT", { iframe: n, width: r }, n.iframeId);
        }
    } }, z = function (e, n) { e && (void 0 !== n.width && (e.style.width = n.width + "px", (0 === n.width && !e.classList.contains("no-width") || 0 !== n.width && e.classList.contains("no-width")) && t.toggleClass("no-width", e)), void 0 !== n.height && (n.animate, e.style.height = n.height + "px", (0 === n.height && !e.classList.contains("no-height") || 0 !== n.height && e.classList.contains("no-height")) && t.toggleClass("no-height", e))); }, H = function (e) { var n = document.createElement("div"); return n.innerHTML = e.trim(), n.firstChild; }, W = function (e) { return void 0 === e && (e = ""), '<div class="tp-please-wait tp-active tp-overlap ' + e + '"><div class="tp-icon tp-centered"><div class="pn-spinner"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div></div>'; }, J = function () { e || (e = H(W())) && document.body.appendChild(e); }, G = function () { e && (document.body.removeChild(e), e = null); }; function Q(e) { if (e && e.container) {
        !function (e) { if (e && (null == e ? void 0 : e.container) && !d.has(e.iframeId)) {
            var n = H(W("tp-local-overlap"));
            n && (e.container.appendChild(n), d.set(e.iframeId, n));
        } }(e);
        e.container.addEventListener("load", (function () { !function (e) { if (e && (null == e ? void 0 : e.container) && d.has(e.iframeId)) {
            var n = d.get(e.iframeId);
            n && (e.container.removeChild(n), d.delete(e.iframeId));
        } }(e); }), { once: !0, capture: !0 });
    } } function X(e) { e && e.element && (function (e) { var n; if (!e)
        return !1; return !!(null === (n = null == e ? void 0 : e.element.getBoundingClientRect()) || void 0 === n ? void 0 : n.width); }(e) && Q(e), e.element.src = e.element.src); } function $() { for (var e in s) {
        var n = s[e];
        n && X(n);
    } } return { name: "containerUtils", fakeOfferId: "fakeOfferId", createContainer: function (e) { var n, i, d, p = !0, f = e.iframeParams; if ("inline" === f.displayMode || f.width || (f.width = window.innerWidth), i = e.config.buildQueryStringFn ? function (n) { return e.config.buildQueryStringFn(n, t); } : function (e) { var n = t.param(e); return n + "&_qh=" + a.hash(n, 10); }, "popup" === f.displayMode) {
            f.width || (f.width = window.innerWidth);
            var m = e.url + "?" + i(f);
            n = D(f, m);
            try {
                d = n.document;
            }
            catch (e) {
                try {
                    d = n;
                }
                catch (e) {
                    d = null, console.warn("Unable to get popup element");
                }
            }
            c[f.iframeId] = { container: n, interval: setInterval((function () { c[f.iframeId].container.closed && (clearInterval(c[f.iframeId].interval), c[f.iframeId].container.close(), e.onCloseCallback && e.onCloseCallback()); }), 100) };
        }
        else {
            if ("inline" === f.displayMode) {
                void 0 !== e.config.showCloseButton && delete e.config.showCloseButton;
                var g = U(e);
                n = g.container, p = !!g.containerReady;
            }
            else
                n = N(e.config, (function () { S(f.iframeId, e.parent); }));
            var v = e.url + "?" + i(f);
            d = B(e.config, f, v);
        } l.registerCallback(e, f.iframeId); var h = s[f.iframeId] = { iframeId: f.iframeId, config: e.config, element: d, container: n, iframeParams: f, containerReady: p }; if (o.init({ postMessageUrl: e.postMessageUrl, parent: e.parent, receive: e.receive, iframe: h, iframeParams: f }), t.on(document, "keyup", (function (e) { })), "modal" === f.displayMode)
            t.on(window, "resize", (function () { A(n); })), t.append(n, d);
        else if ("inline" === f.displayMode) {
            if (s[f.iframeId].containerReady) {
                var w = document.createElement("div");
                t.addClass(u, w), t.append(w, d), e.config.isPreload && t.hide(w), ("complete" === document.readyState || "loading" !== document.readyState && !document.documentElement.doScroll) && n ? (t.empty(n), t.append(n, w)) : V(n, w);
            }
            else {
                var y = document.createElement("div");
                t.setAttr("id", "temp-inline-" + f.iframeId, y), t.hide(y), L("body", (function (e) { t.append(e, y); })), t.append(y, d);
            }
            if (window.ResizeObserver) {
                var b = new ResizeObserver((function (e) { var n = t.getWidth(h.container); n > 0 && M(h, { width: n }); }));
                b.observe(h.container), h.resizeObserver = b;
            }
        } return r.debug("creating iframe: ", e), h; }, showPreloadedContainer: function (e) { if ("modal" === e.config.displayMode) {
            if (_())
                return void r.log("Modal is already shown; must be one modal per time");
            !function (e) { (n = e.container.closest(".tp-modal")) ? n = n : r.error("there is no such modal container"), O(e, !0, !0); }(e);
        }
        else
            "inline" === e.config.displayMode ? function (e) { t.show(e.container); var n = t.queryEl(".tp-container-inner", e.container); n && t.show(n), M(e, { width: t.getWidth(e.container) }); }(e) : r.log("Unexpected displayMode of preloaded iframe\n"); return e.config.isPreload = !1, e.iframeParams.isPreload = !1, r.debug("show preloaded iframe: ", e.config), e; }, redirectContainer: function (e, n) { var r = n.url + "?" + t.param(n.iframeParams), i = s[e]; if ("popup" === i.config.displayMode)
            i.container.location = r;
        else {
            var a = i.element;
            (a.contentWindow || a).location = r;
        } i.config = n.config, o.init({ postMessageUrl: n.postMessageUrl, receive: n.receive, iframe: s[n.iframeParams.iframeId], iframeParams: n.iframeParams }); }, hasModalIframe: _, getIframe: C, generateIframe: B, generateIframeWrapper: function () { var e = document.createElement("div"), n = { overflow: "hidden", backgroundColor: "transparent", border: "0", width: "0px", height: "0px", position: "absolute", display: "block", top: "-1px", left: "-1px" }; return Object.keys(n).forEach((function (t) { e.style[t] = n[t]; })), e; }, getPopupPosition: j, generatePopup: D, initInlineContainer: U, getModalContainer: N, centerBackdrop: function (e) { if (w) {
            var n = t.winSize();
            e.offsetHeight > n.height ? w.style.height = n.height + "" : w.style.height = "100%";
        } }, showBackdrop: E, hideBackdrop: T, checkBackdropAndContainer: O, resizeIframe: M, centerIt: A, operationWithContainer: L, closeContainer: S, closeModalContainer: function (e, n) { S(e, n, !0); }, purgeIframe: function (e, n) { r.debug("Purging iframe", e); var i = s[e]; try {
            if (i.resizeObserver && i.resizeObserver.disconnect(), o.removeIframe(i.iframeId), t.remove(i.element), "inline" === i.config.displayMode) {
                var a = t.queryEl(".tp-container-inner", i.container);
                a && t.remove(a);
            }
        }
        catch (e) { } delete s[e]; }, hideModalContainer: function (e) { var n = []; for (var r in s) {
            var o = s[r];
            e && r !== e || "inline" !== o.config.displayMode && "modal" === o.config.displayMode && (x(o), t.hide(o.container), n.push(r));
        } return n; }, closeModal: x, hideCloseButton: function (e) { if (e) {
            var n = t.queryEl(".tp-close", e);
            n && n.classList.contains("tp-active") && t.removeClass("tp-active", n);
        } }, activateContainers: function (e) { if (e && e.length)
            for (var n in s)
                for (var r = s[n], o = 0; o < e.length; o++)
                    if (n === e[o]) {
                        var i = r.container, a = i.parentElement;
                        a && E(a), t.addClass("tp-active", i), t.show(i);
                    } }, showWaitPanel: J, hideWaitPanel: G, addClassToContainer: function (e, n) { t.addClass(n, e.container); }, turnOnRTL: function (e) { e.container && e.container.setAttribute && e.container.setAttribute("dir", "rtl"); }, turnOffRTL: function (e) { e.container && e.container.removeAttribute && e.container.removeAttribute("dir"); }, setIframesPopstateHandlers: function () { (r.isIphone() || r.isSafariOrIOsUiWebView()) && window.addEventListener("popstate", $); }, __protected__: { setElementSizes: z, closeInlineContainers: function (e) { Array.prototype.slice.call(document.querySelectorAll(e + " > ." + "tp-container-inner > iframe")).forEach((function (e) { var n, t; e.id && (n = e.id, (t = C(n)).config.child && S(t.config.child), S(n)); })); }, addChildToInlineIframe: function (e, n) { if (e) {
                var t = C(n);
                t && t.config && (t.config.child = e.iframeId);
            } }, closeAndRemoveIframe: k }, __private__: { mobileModalFix: m } }; }();
    pn.container.register("containerUtils", { useValue: Me }), pn.containerUtils = pn.container.resolve("containerUtils");
    var Oe = function (e) { void 0 === e && (e = pn.container); var n = e.resolve("ajax"), t = e.resolve("util"); e.resolve("postmessage").subscribe("iframeLogRequest", (function (e) { o(e.url, e.queryParams); })); var r = function (e) { var n = []; for (var t in e) {
        var r = e[t];
        n.push(encodeURIComponent(t) + "=" + encodeURIComponent("object" == typeof r ? JSON.stringify(r) : r));
    } return n.join("&"); }, o = function (e, o) { var i = r(o); t.isRelativeUrl(e.trim()) ? i.length > 6e3 ? n.request({ type: "POST", url: pn.getTrackingEndpoint() + e, data: i }) : n.request({ url: pn.getTrackingEndpoint() + e + "?" + i, dataType: "jsonp" }) : t.log("Url parameter is incorrect"); }, i = function (e, n, r, i, a) { e ? r ? n ? o("/api/v3/conversion/logEspMicroConversion", { tracking_id: e, esp_widget_id: n, event_type: i, event_group_id: r, custom_params: a || "" }) : t.log("Parameter espWidgetId is required to log esp micro conversion.") : t.log("Parameter eventGroupId is required to log esp micro conversion.") : t.log("Parameter trackingId is required to log esp micro conversion."); }, a = function (e, n, r, i, a, s, c, l) { var u = { tracking_id: e, term_id: n, term_name: r }; e ? n ? r ? (void 0 !== i && (u.step_number = i), void 0 !== a && (u.amount = a), void 0 !== s && (u.currency = s), void 0 !== c && (u.custom_params = c), void 0 !== l && (u.conversion_category = l), o("/api/v3/conversion/log", u)) : t.log("Parameter termName is required to log conversion.") : t.log("Parameter termId is required to log conversion.") : t.log("Parameter trackingId is required to log conversion."); }, s = function (e, o) { if (!(i = window.doNotTrack || window.navigator.doNotTrack || window.navigator.msDoNotTrack) || "1" !== i.charAt(0) && "yes" !== i) {
        var i, a, s = r(o), c = e + "?" + s;
        if (navigator.sendBeacon)
            if (c.length > 6e3) {
                var l = new Blob([s], { type: "application/x-www-form-urlencoded" });
                navigator.sendBeacon(e, l);
            }
            else
                navigator.sendBeacon(c);
        else
            (a = -1 !== navigator.appVersion.indexOf("MSIE 9") ? { dataType: "jsonp", url: c } : { type: "post", url: c, async: !1, xhrFields: { withCredentials: !0 } }).error = function () { for (var e = [], n = 0; n < arguments.length; n++)
                e[n] = arguments[n]; t.debug.apply(t, _e(["Beacon request has been failed"], e, !1)); }, n.request(a);
    } }; return { name: "log", logMicroConversion: function (e, n, r) { e ? n ? o("/api/v3/conversion/logMicroConversion", { tracking_id: e, event_group_id: n, custom_params: r || "" }) : t.log("Parameter eventGroupId is required to log micro conversion.") : t.log("Parameter trackingId is required to log micro conversion."); }, logConversion: function (e, n, t, r, o, i, s, c) { if ("object" == typeof e) {
            var l = e;
            a(l.tracking_id, l.term_id, l.term_name, l.step_number, l.amount, l.currency, l.custom_params, l.conversion_category);
        }
        else
            a(e, n, t, r, o, i, s, c); }, logFunnelStep: function (e, n, r, i) { e ? n ? r ? o("/api/v3/conversion/logFunnelStep", { tracking_id: e, step_number: n, step_name: r, custom_params: i || "" }) : t.log("Parameter stepName is required to log funnel step.") : t.log("Parameter stepNumber is required to log funnel step.") : t.log("Parameter trackingId is required to log funnel step."); }, logEspMicroConversion: i, logBeaconRequest: s, __protected__: { logCustomFormImpression: function (e, n, r) { n || t.log("Parameter formName is required to log impression."), r || t.log("Parameter source is required to log impression."); var i = { aid: pn.aid, pageview_id: pn.main.fetchPageViewId(), custom_form_name: n, custom_form_source: r }, a = pn.user.getProvider().getToken(); return a && (i.user_token = a), e && (i.tracking_id = e), o("/api/v3/customform/log/impression", i); }, logCustomFormSubmission: function (e, n, r) { n || t.log("Parameter formName is required to log submission."), r || t.log("Parameter source is required to log submission."); var i = { aid: pn.aid, pageview_id: pn.main.fetchPageViewId(), custom_form_name: n, custom_form_source: r }, a = pn.user.getProvider().getToken(); return a && (i.user_token = a), e && (i.tracking_id = e), o("/api/v3/customform/log/submission", i); }, logEspMicroConversion: i }, __private__: { doLog: o, logBeaconRequest: s } }; };
    pn.container.register("log", { useValue: Oe() }), pn.log = pn.container.resolve("log");
    var Re = function () { var e = pn.container.resolve("log"), n = pn.container.resolve("api"), t = { completeInit: 0, expExec: 0, idShow: 0, myAccountShow: 0, offerShow: 0, templateShow: 0, tpAccShow: 0, track: 0 }; setTimeout((function () { r(); }), 1e4); var r = function (r) { if (Math.floor(500 * Math.random()) + 1 === 255) {
        var o = r || (pn.fullTPVersion ? "ts_c" : "ts_s"), i = { completeInit: t.completeInit, track: t.track, expExec: t.expExec, idShow: t.idShow, myAccountShow: t.myAccountShow, offerShow: t.offerShow, templateShow: t.templateShow, tpAccShow: t.tpAccShow, aid: pn.aid, type: o };
        e.logBeaconRequest(n.getEndpoint() + "/internal/anon/telemetry/ux/init/time/log", i);
    } }; return { name: "logging", setTime: function (e) { 0 === t[e] && (t[e] = Math.round(performance.now() - window.pnInitPerformance)); } }; }();
    pn.container.register("logging", { useValue: Re }), pn.logging = pn.container.resolve("logging");
    var Le;
    !function (e) { e.AUTO = "A", e.MANUAL = "M"; }(Le || (Le = {}));
    var Ne = function () { var e = pn.container.resolve("util"), n = pn.container.resolve("ajax"), t = pn.container.resolve("jqUtils"), r = pn.container.resolve("eventUtils"), o = function (e) { return Object.entries(e).reduce((function (e, n) { var t = n[0], r = n[1]; return (r || 0 === r) && (e[t] = r), e; }), {}); }, i = r.createEventManager([]), a = function (r, i, a) { return new Promise((function (s, c) { var l = a ? "?" + t.param(a) : "", u = pn.getExperienceEndpoint(!1) + "/" + pn.aid + r + l, d = o({ xbc: e.__protected__.getCookie("xbc") || void 0, tbc: e.getTbcCookie() || void 0 }), p = o(ye(ye({}, d), i)); if (!(p.cid && p.itemId && p.xbc)) {
        var f = "credit: Error: Required params are absent";
        e.debug(f), c({ code: 0, message: f });
    } n.request({ type: "post", url: u, data: ye(ye({}, d), i), xhrFields: { withCredentials: !0 }, error: function (n) { var t = "credit: Error: Received error:" + n.status + " " + n.responseText; e.debug(t), c({ code: n.status, message: n.responseText }); }, success: function (e) { s(e); } }); })); }, s = function (e, n, t, r) { var o = function (e) { return function (n) { return i.fire(void 0, e, !0, n), n; }; }, s = o("string" == typeof e ? e : e.success), c = o("string" == typeof e ? e : e.failure); return a(n, t, r).then(s).catch(c); }; return { redeem: function (e) { return s("manualCreditRedeemed", "/execution/credit/redeem", e); }, check: function (e) { return s("creditChecked", "/execution/credit/check", e); }, registerCallback: function (e, n) { i.addEvent(e), i.registerCallback(e, n); } }; }();
    pn.container.register("credit", { useValue: Ne }), pn.credit = pn.container.resolve("credit");
    var Ue = function () { var e, n = pn.container.resolve("postmessage"), t = pn.container.resolve("containerUtils"), r = pn.container.resolve("util"), o = pn.container.resolve("eventUtils"), i = pn.container.resolve("logging"), a = o.createEventManager(["resize", "loginSuccess", "logout"]), s = function () { return pn.getEndpointRoot(!0) + "/checkout/user/loginShow"; }; function c(o) { r.debug("Login event received", o.event, o.params, o); var i = !t.getIframe(o.sender).config.parent; switch (o.event) {
        case "loaded":
            e = !1;
            break;
        case "close":
            t.closeModalContainer(), a.fireCallbacks(o.event, o.params, o.sender, i);
            break;
        case "cancel":
        case "error":
        case "customEvent":
            a.fireCallbacks(o.event, o.params, o.sender, i);
            break;
        case "loginSuccess":
            !function (e, n, o, i) { var s = t.getIframe(o); r.setAccessTokenListCookie({ value: n.token_list, cookie_domain: n.cookie_domain }, n.user_token), s.config.userToken = n.user_token, s && s.config && s.config.loginSuccess && s.config.loginSuccess(n.event, n.params, n.sender); a.fireCallbacks(e, n, o, i), s && s.config && s.config.closeAfterSuccess && t.closeModalContainer(o); var c = { reloadAfterLogin: !0, userToken: n.user_token, user: n.user }; u(c); }(o.event, o.params, o.sender, i);
            break;
        case "logoutSuccess":
            !function (e, n, t, o) { a.fireCallbacks("logout", null, void 0, !0), r.setAccessTokenListCookie({ value: n.token_list, cookie_domain: n.cookie_domain }, n.user_token, !0); }(o.event, o.params, o.sender);
            break;
        case "readyToSubmitStats":
            var s = { pageViewId: pn.main.fetchPageViewId(), tbc: r.getTbcCookie() };
            n.send("submitStats", s, o.sender);
            break;
        default: return void r.debug("Received invalid event type: " + o.event);
    } } var l, u = function (e) { n.broadcast("reloadOffer", e); }; function d(e) { l && t.closeModalContainer(l); var n = {}; Object.assign(n, { closeAfterSuccess: !0 }, e), n.displayMode = "popup", n.width = 360, n.height = 660, n.state = n.state ? n.state : "login"; var o, i = function (e) { var n = {}; return ["displayMode", "aid", "width", "height", "state"].forEach((function (t) { e[t] && (n[t] = e[t]); })), n; }(n); i.iframeId = r.randomString(16), i.url = window.location.href, i.host_url = window.location.href, l = i.iframeId, function (e) { ["aid", "gaClientId", "tags", "contentSection", "contentAuthor"].forEach((function (n) { pn[n] && (e[n] = pn[n]); })), pn.contentCreated && (e.contentCreated = pn.contentCreated); }(i), i.user_provider = "tinypass_accounts", e.userToken && (i.user_token = e.userToken), r.getCampaigns(i); var u = { url: s(), config: n, postMessageUrl: s(), receive: c, iframeParams: i }; return n.iframeId ? (u.iframeParams.iframeId = n.iframeId, o = t.redirectContainer(n.iframeId, u)) : o = t.createContainer(u), a.registerCallback(n, i.iframeId), o; } return { name: "tinypassLogin", show: function (n) { if (e)
            return !1; e = !0, setTimeout((function () { e = !1; }), 1e4), d(n) || r.error("Could not initialize login; check configuration"), i.setTime("tpAccShow"); }, close: function () { t.closeModalContainer(); }, showBackdrop: function () { t.showBackdrop(); }, hideBackdrop: function () { t.hideBackdrop(); }, centerBackdrop: function (e) { t.centerBackdrop(e); }, registerCallback: function (e, n) { a.registerCallback(e, n); }, listenLogin: function (e) { !function (e) { a.registerCallback(e, e.iframeId); var t = { iframeId: e.iframeId, config: e, iframeParams: e }; n.init({ postMessageUrl: s(), receive: c, iframe: t, iframeParams: {} }); }(e); } }; }();
    pn.container.register("tinypassLogin", { useValue: Ue }), pn.tinypassLogin = pn.container.resolve("tinypassLogin");
    var je = function () { var e = pn.container.resolve("ajax"), n = pn.container.resolve("jqUtils"), t = pn.container.resolve("util"), r = pn.container.resolve("tinypassLogin"), o = pn.container.resolve("eventUtils").createEventManager(["logout"]), i = function () { return t.getUserTokenCookie() || null; }; return { name: "tinypassAccounts", isv: !1, isUserValid: function () { return !!t.getUserTokenCookie(); }, getToken: i, getName: function () { return "tinypass_accounts"; }, onLoginSuccess: function (e) { t.setAccessTokenListCookie({ value: e.token_list, cookie_domain: e.cookie_domain }, e.user_token); }, isConfigured: function () { return !0 === pn.useTinypassAccounts || "string" == typeof pn.useTinypassAccounts && "true" === pn.useTinypassAccounts; }, login: function (e) { return (e = e || {}).userToken = i(), r.show(e); }, logout: function (r) { var i = { aid: pn.aid, url: document.location.href }, a = pn.getEndpointRoot(!0) + "/checkout/user/logout?" + n.param(i); t.setAccessTokenListCookie({ value: null }, void 0, !0), e.request({ url: a, dataType: "jsonp", success: function (e) { t.setAccessTokenListCookie({ value: "", cookie_domain: e.models.cookie_domain }, e.models.user_token, !0), o.fireCallbacks("logout", null, void 0, !0), r && r(e); }, error: function (e) { t.setAccessTokenListCookie(null, void 0, !0), o.fireCallbacks("logout", null, void 0, !0), r && r(e); } }); }, registerCallback: function (e, n) { o.addEvent(e), o.registerCallback(e, n); } }; }();
    pn.container.register("tinypassAccounts", { useValue: je }), pn.tinypassAccounts = pn.container.resolve("tinypassAccounts");
    var De = function () { var e = pn.container.resolve("jqUtils"), n = pn.container.resolve("cookie"), t = pn.container.resolve("util"), r = pn.container.resolve("eventUtils").createEventManager(["logout"]); return { isv: !1, name: "condeUserProvider", getName: function () { return "conde"; }, isUserValid: function () { return !!t.getUserTokenCookie(); }, getToken: function () { var e = t.findCookieByName("amg_user_partner"); return void 0 !== e && e && e.length >= 0 ? e : null; }, onLoginSuccess: function (r) { t.setAccessTokenListCookie({ value: r.token_list, cookie_domain: r.cookie_domain }, r.user_token); var o = { path: "/", expires: 730 }; r.cookie_domain && "localhost" !== r.cookie_domain && e.inArray(r.cookie_domain, t.getPossibleCookieDomains()) >= 0 && (o.domain = r.cookie_domain), n.raw = !0, t.__protected__.setCookie(r.params.cookieName, r.params.cookieValue, o), t.__protected__.setCookie("amg_user_partner", r.params.externalId, o), t.__protected__.setCookie("amg_user_info", r.params.userName, o), t.__protected__.setCookie("amg_user_ext", r.params.siteUserId, o), r.params.updateToken && t.__protected__.setCookie("amg_user_update", r.params.updateToken, o), n.raw = !1; }, logout: function (e) { t.setAccessTokenListCookie({ value: null }, void 0, !0); var n = t.getPossibleCookieDomains(); for (var o in n)
            t.deleteCookie("amg_user", n[o]), t.deleteCookie("amg_user_partner", n[o]), t.deleteCookie("amg_user_info", n[o]), t.deleteCookie("amg_user_ext", n[o]), t.deleteCookie("amg_user_update", n[o]); t.deleteCookie("amg_user"), t.deleteCookie("amg_user_partner"), t.deleteCookie("amg_user_info"), t.deleteCookie("amg_user_ext"), t.deleteCookie("amg_user_update"), r.fireCallbacks("logout", null, void 0, !0), e && e(); }, isConfigured: function () { return !0 === pn.useCondeUserProvider || "string" == typeof pn.useCondeUserProvider && "true" === pn.useCondeUserProvider; }, registerCallback: function (e, n) { r.addEvent(e), r.registerCallback(e, n); } }; }();
    pn.container.register("condeUserProvider", { useValue: De }), pn.condeUserProvider = pn.container.resolve("condeUserProvider");
    var Fe = function () { var e = pn.container.resolve("util"), n = pn.container.resolve("api"), t = pn.container.resolve("eventUtils"), r = pn.container.resolve("jqUtils"), o = !1; var i = t.createEventManager(["userChanged", "onHide", "logout"]), a = { apiKey: null, screenSet: "Default-RegistrationLogin", startScreen: null, enabledProviders: null, lang: null }; function s() { var n = e.getUserTokenCookie(); if (n && e.findCookieByName("glt_" + a.apiKey) === e.findCookieByName("__utg_" + a.apiKey))
        return n; return null; } var c = []; function l(t, s) { if (!o)
        throw "Gigya is not configured"; d(); (e.findCookieByName("glt_" + a.apiKey) !== e.findCookieByName("__utg_" + a.apiKey) || t) && (c.push(s), 1 === c.length && window.gigya.accounts.getAccountInfo({ callback: function (t) { if (0 === t.errorCode) {
            var o = { uid: t.UID, signature: t.UIDSignature, signature_timestamp: t.signatureTimestamp, url: e.prepareUrlParameter(window.location.href) };
            e.startCall("refreshUserToken"), n.callApi("/anon/gigya/verifyAccountInfo", o, (function (n) { if (n && n.result) {
                e.setAccessTokenListCookie(n.result.access_token, n.result.user_token);
                var t = { path: "/", expires: 730 };
                if (n.result.access_token) {
                    var o = n.result.access_token.cookie_domain;
                    o && "localhost" !== o && r.inArray(o, e.getPossibleCookieDomains()) >= 0 && (t.domain = o);
                }
                var s = e.findCookieByName("glt_" + a.apiKey);
                e.__protected__.setCookie("__utg_" + a.apiKey, s, t);
                for (var l = 0; l < c.length; l++) {
                    var u = c[l];
                    u && u(n.result);
                }
                n.result.user && (n.result.user = { uid: n.result.user.uid, email: n.result.user.email, firstName: n.result.user.first_name, lastName: n.result.user.last_name, valid: n.result.user.valid }), i.fireCallbacks("userChanged", n.result, void 0, !0);
            }
            else
                e.log("Can't verify gigya user: may be the configuration of gigya user provider is invalid"), e.setAccessTokenListCookie(); c = [], e.doneCall("refreshUserToken"); }));
        }
        else
            e.setAccessTokenListCookie(), c = []; } })); } var u = !1; function d() { if (!window.gigya || !window.gigya.__initialized)
        throw "Gigya is not initialized"; } return { isv: !1, name: "gigya", init: function (n) { if (!o) {
            for (var t in n)
                void 0 !== n[t] && (a[t] = n[t]);
            if (!a.screenSet)
                throw "Gigya is not configured: screenSet parameter required";
            if (!a.apiKey)
                throw "Gigya is not configured: apiKey parameter required";
            d(), window.gigya.accounts.addEventHandlers({ onLogin: function () { u = !0, l(); }, onLogout: function () { e.setAccessTokenListCookie({ value: null }, void 0, !0), i.fireCallbacks("logout", null, void 0, !0); } }), o = !0, l();
        } }, isUserValid: function () { var e = s(); return !!(void 0 !== e && e && e.length >= 0); }, getToken: s, getName: function () { return "gigya"; }, onLoginSuccess: function (n) { e.setAccessTokenListCookie({ value: n.token_list, cookie_domain: n.cookie_domain }, n.user_token); }, login: function (e) { if (!o)
            throw "Gigya is not configured"; d(), e && window.gigya.accounts.addEventHandlers({ onLogin: function () { l(!0, e); } }); var n = { screenSet: a.screenSet, onHide: function () { i.fireCallbacks("onHide", { afterLogin: u }, void 0, !0); } }, t = ["apiKey", "screenSet"]; for (var r in a) {
            r in t || (n[r] = a[r]);
        } u = !1, window.gigya.accounts.showScreenSet(n); }, logout: function (n) { if (!o)
            throw "Gigya is not configured"; d(), window.gigya.accounts.logout({ callback: function () { i.fireCallbacks("logout", null, void 0, !0), n && n(), e.setAccessTokenListCookie({ value: null }, void 0, !0); } }), e.setAccessTokenListCookie({ value: null }, void 0, !0); }, isConfigured: function () { return !0 === pn.useGigyaUserProvider || "string" == typeof pn.useGigyaUserProvider && "true" === pn.useGigyaUserProvider; }, registerCallback: function (e, n) { i.addEvent(e), i.registerCallback(e, (function (e) { return n(e); })); }, loginByPasswordless: function (n) { if (!n)
            throw "Session info is empty"; var t = n.accessTokenName, r = n.accessToken; e.__protected__.setCookie(t, r); var o = "glt_" + a.apiKey; e.__protected__.setCookie(o, r), l(!0); } }; }();
    pn.container.register("gigya", { useValue: Fe }), pn.gigya = pn.container.resolve("gigya");
    var Be = function () { var e = function (e) { function n() { return null !== e && e.apply(this, arguments) || this; } return function (e, n) { if ("function" != typeof n && null !== n)
        throw new TypeError("Class extends value " + String(n) + " is not a constructor or null"); function t() { this.constructor = e; } we(e, n), e.prototype = null === n ? Object.create(n) : (t.prototype = n.prototype, new t); }(n, e), n.prototype.construct = function (e) { this.message = e, this.name = "InvalidCharacterError"; }, n; }(Error); function n(n) { var t = String(n).replace(/=+$/, ""); if (t.length % 4 == 1)
        throw new e("'atob' failed: The string to be decoded is not correctly encoded."); for (var r, o, i = 0, a = 0, s = ""; o = t.charAt(a++); ~o && (r = i % 4 ? 64 * r + o : o, i++ % 4) ? s += String.fromCharCode(255 & r >> (-2 * i & 6)) : 0)
        o = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(o); return s; } try {
        var t = window.atob && window.atob.bind(window) || n;
    }
    catch (e) {
        t = n;
    } var r = function (e) { var n = e.replace(/-/g, "+").replace(/_/g, "/"); switch (n.length % 4) {
        case 0: break;
        case 2:
            n += "==";
            break;
        case 3:
            n += "=";
            break;
        default: throw "Illegal base64url string!";
    } try {
        return function (e) { return decodeURIComponent(t(e).replace(/(.)/g, (function (e, n) { var t = n.charCodeAt(0).toString(16).toUpperCase(); return t.length < 2 && (t = "0" + t), "%" + t; }))); }(n);
    }
    catch (e) {
        return t(n);
    } }; return function (e, n) { if ("string" != typeof e)
        throw new Error("Invalid token specified"); var t = !0 === (n = n || {}).header ? 0 : 1; return JSON.parse(r(e.split(".")[t])); }; }();
    pn.jwtDecode = Be, pn.container.register("jwtDecode", { useValue: Be });
    var Ve = function () { var e, n = pn.container.resolve("util"), t = pn.container.resolve("api"), r = pn.container.resolve("postmessage"), o = "pianoTracker", i = "gaAccount", a = "metricsGAAccount", s = "trackOnlyAids", c = "disabled", l = 86400, u = { gaAccount: void 0, trackerName: o, trackOnlyAids: [], metricsGAAccount: void 0, isGAEnabled: !1, isGAAppended: !1, isMetricsEnabled: !1, isTrackerAppended: !1, isMetricsTrackerAppended: !1 }, d = [], p = !1, f = !0, m = !1, g = !1, v = []; function h() { m || (f ? setTimeout((function () { f = !1, w(); }), 3e3) : w()); } function w() { m = !0, S(), u.gaAccount ? E().catch((function () { })) : new Promise((function (e, n) { t.callApi("/anon/assets/gaAccount", { aid: tp.aid }, (function (t) { 0 === t.code ? (x(t.data), e(null)) : n(); })); })).then((function () { return E(); })).catch((function () { })); } var y = function (e, n) { d.push({ action: e, params: n }); }, b = function () { if (window.ga && u.isTrackerAppended)
        for (; d.length;) {
            var e = d.pop();
            C(e.action, e.params);
        } }, k = function (e, n) { v.push({ action: e, params: n }); }, _ = function () { if (window.ga && u.isMetricsTrackerAppended)
        for (; v.length;) {
            var e = v.pop();
            I(e.action, e.params);
        } }, C = function (e, n) { window.ga && u.isTrackerAppended ? window.ga(u.trackerName + "." + e, n) : y(e, n); }, I = function (e, n) { u.isMetricsEnabled && (window.ga && u.isMetricsTrackerAppended ? window.ga("performanceTracker." + e, n) : k(e, n)); }, S = function () { if (!p) {
        if (tp.gaClientId && (e = tp.gaClientId), n.__protected__.hasLocalStorage()) {
            var t = n.__protected__.getLocalStorageItem(i), r = n.__protected__.getLocalStorageItem(a), o = n.__protected__.getLocalStorageItem(s);
            u.isGAEnabled = !!t && t !== c, u.isMetricsEnabled = !!r && r !== c, u.gaAccount = t, u.metricsGAAccount = r, u.trackOnlyAids = o || [];
        }
        p = !0;
    } }; var x = function (e) { u.isGAEnabled = !!e, u.gaAccount = e || c, n.__protected__.setLocalStorageItem(i, u.gaAccount, l); }, P = function (e) { u.isMetricsEnabled = JSON.parse(e.is_enabled), u.metricsGAAccount = u.isMetricsEnabled ? e.ga_account : c, u.trackOnlyAids = u.isMetricsEnabled ? JSON.parse(e.track_only_aids) : [], n.__protected__.setLocalStorageItem(s, u.trackOnlyAids, l), n.__protected__.setLocalStorageItem(a, u.metricsGAAccount, l); }; function E() { return new Promise((function (n, t) { u.isGAEnabled ? A().then((function () { if (u.isGAAppended)
        if (u.isTrackerAppended)
            n(null);
        else
            try {
                var r = document.createElement("script");
                r.innerHTML = function () { var n = new RegExp("^UA-[0-9a-zA-Z]*-[0-9a-zA-Z]*$").test(u.gaAccount), t = new RegExp("([{]?[0-9a-fA-F]{8}-([0-9a-fA-F]{4}-){3}[0-9a-fA-F]{12}[}]?)|([0-9]*\\.[0-9]*)").test(e || ""); if (!n)
                    return ""; var r = "ga(function() {\n        ga('create', '" + u.gaAccount + "', 'auto', '" + "pianoTracker'"; r += e && t ? ", { clientId: '" + e + "' });" : ");\n        tp.gaService.setClientId(ga.getByName('pianoTracker').get('clientId'));"; return r += "tp.gaService.trackerAppended(); });"; }(), document.head.appendChild(r), u.isTrackerAppended = !0, n(null);
            }
            catch (e) {
                t();
            }
    else
        t(); })).catch((function (e) { })) : t(); })); } function T() { return new Promise((function (e, n) { u.isMetricsEnabled ? A().then((function () { if (u.isGAAppended)
        if (u.isMetricsTrackerAppended)
            e(null);
        else
            try {
                var t = !u.trackOnlyAids.length || u.trackOnlyAids.contains(tp.aid), r = document.createElement("script");
                if (!new RegExp("^UA-[0-9a-zA-Z]*-[0-9a-zA-Z]*$").test(u.metricsGAAccount))
                    return void n();
                r.innerHTML = "\nga(function() {\n  if (" + t + ") {\n    ga('create', '" + u.metricsGAAccount + "', 'auto', '" + "performanceTracker', { storage: 'none' });\n    tp.gaService.metricsTrackerAppended();\n  }\n});\n", document.head.appendChild(r), u.isMetricsTrackerAppended = !0, e(null);
            }
            catch (e) {
                n();
            }
    else
        n(); })) : e("isMetricsEnabled !== true"); })); } function A() { return new Promise((function (e, n) { if (u.isGAAppended)
        e(null);
    else
        try {
            var t = document.createElement("script");
            t.innerHTML = "\n            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){\n            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),\n            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)\n            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');\n          ", document.head.appendChild(t), u.isGAAppended = !0, e(null);
        }
        catch (e) {
            n();
        } })); } return { name: "gaService", emitEvent: function (e) { if (e.hitType = "event", !u.isTrackerAppended)
            return y("send", e), void h(); u.isGAEnabled && (window.ga && u.isTrackerAppended ? (d.length && b(), C("send", e)) : y("send", e)); }, emitMetricsEvent: function (e) { if (e.hitType = "timing", !u.isMetricsTrackerAppended)
            return k("send", e), void function () { if (g)
                return; if (g = !0, S(), !u.metricsGAAccount)
                return void new Promise((function (e, n) { t.callApi("/anon/assets/performanceMetrics", null, (function (t) { 0 === t.code ? (P(t.performance_metrics_dto), e(null)) : n(); })); })).then((function () { return T(); })).catch((function (e) { n.error("PN catch: something vent wrong with GA injection: " + e); })); T().catch((function (e) { n.error("PN catch: something vent wrong with GA injection: " + e); })); }(); u.isMetricsEnabled && (window.ga && u.isMetricsTrackerAppended ? (v.length && _(), I("send", e)) : k("send", e)); }, getClientId: function () { return e; }, getGAAccount: function () { return u.gaAccount; }, metricsTrackerAppended: function () { u.isMetricsTrackerAppended = !0, g = !1, _(); }, recreateWithClientId: function (n) { e = n, h(); }, setClientId: function (n) { e = n; }, setTrackerName: function (e) { u.trackerName = e; }, trackerAppended: function () { u.isTrackerAppended = !0, r.broadcast("gaAppended", { clientId: e, gaAccount: u.gaAccount }), m = !1, b(); } }; }();
    pn.container.register("gaService", { useValue: Ve }), pn.gaService = pn.container.resolve("gaService");
    var qe = function (e) { void 0 === e && (e = pn.container); var n, t, r, o, i, a = e.resolve("cookie"), s = e.resolve("jqUtils"), c = e.resolve("ajax"), l = e.resolve("jwtDecode"), u = e.resolve("util"), d = e.resolve("containerUtils"), p = e.resolve("postmessage"), f = e.resolve("log"), m = e.resolve("observer"), g = e.resolve("gaService"), v = e.resolve("api"), h = e.resolve("logging"), w = e.resolve("localStorage"), y = "piano_social_token", b = u.getAidSpecifiedName("__utp"), k = "__pil", _ = "__pid", C = "__idr", I = "__eea", S = "PIANOID", x = "show_form", P = "registration", E = "checkout", T = 300, A = "pnid-tc-string", M = ["he_IL", "ar_EG"], O = {}, R = [], L = { loggedIn: [], loggedOut: [], loginSuccess: [], registrationSuccess: [], profileUpdate: [], langChange: [], langChangeFromIframe: {}, fire_loginSuccess: [], loginDisplayed: [], registerDisplayed: [], loginFailed: [], registrationFailed: [], onShow: [], layoutReady: [] }, N = {}, U = {}, j = [], D = !1, F = ["G18rIJWQ2G", "45L2BaS6pu"]; s.on(window, "resize", (function () { return B(); })); var B = function (e) { R.filter((function (e) { return "inline" === e.config.displayMode; })).filter((function (n) { return !e || e.some((function (e) { return n.container === e; })); })).forEach((function (e) { var n = s.getWidth(e.container); d.resizeIframe(e, { width: n }), p.send("resize", { width: n }, e.iframeId); })); }, V = function (e) { if (r && !e)
        return r; var n; O = Object.assign({}, e), r = new Promise((function (e) { n = e; })), Qe() || pn.setUsePianoIdUserProvider(!0), ae(O); var t = u.getQueryParamByName("reset_token"); void 0 === O.resetPasswordToken && t && (O.resetPasswordToken = t); var o = u.getQueryParamByName("passwordless_token"); void 0 === O.passwordlessToken && o && (O.passwordlessToken = o); var i = u.getQueryParamByName("verification_code"); void 0 === O.verification_code && i && (O.verification_code = i); var a = u.getQueryParamByName(y); return a && (u.removeQueryParamByName(y), Oe() || (pn.inappBrowserReturn = !0, function (e, n) { var t = l(e); t.rememberMe = !!n, Se({ user: t, token: e }); }(a, !0))), setTimeout((function () { return n(); }), 50), r; }, q = function (e, n) { if (t && !e)
        return t; var r; t = new Promise((function (e) { r = e; })); var o = function () { u.doneCall("refreshUserToken"), t = null, r(); }; return e && e.preview ? (setTimeout((function () { return r(); }), 10), t) : (u.startCall("refreshUserToken"), V(e).then((function () { return O.passwordlessToken ? J() : n ? Promise.resolve() : Re(); })).then(o, o), t); }, z = function (e) { var t = !Oe(); q().then((function () { var r = Object.assign({}, O, e, { isRegistration: !0 }), o = Oe(); o ? (ne(r, { emitGlobalLoginSuccessEvent: t && o }), D && !Xe() && (ae(e), se(r), _e(r))) : n ? (ae(e), u.log("Modal login window already shown")) : (ae(e), se(r), _e(r)); h.setTime("idShow"); })); }, H = function () { var e = "email_is_not_confirmed", n = u.getQueryParamByName(e); if (n) {
        u.removeQueryParamByName(e);
        var t = "registration" === n ? "email_is_not_confirmed" : "email_confirmation_required", r = Te();
        W({ screen: t, email: r && r.email });
    } }, W = function (e) { if (n)
        u.log("Modal window already shown");
    else {
        e || (e = {});
        var t = Object.assign({}, e, O);
        e.customEvents && "object" == typeof e.customEvents && (N = e.customEvents), se(t), ae(e), _e(t);
    } }, J = function () { return new Promise((function (e, n) { c.request({ url: he() + "api/v1/identity/passwordless/authorization/code", dataType: "jsonp", data: { aid: O.aid || pn.aid, passwordless_token: O.passwordlessToken }, success: function (t) { t.error ? (Q(t), n()) : (G(t), e(null)); }, xhrFields: { withCredentials: !0 }, crossDomain: !0 }); })); }, G = function (e) { !e.error && e.access_token && (X(e), Me({ source: S, token: e.access_token, user: l(e.access_token), extendExpiredAccessEnabled: e.extend_expired_access_enabled }, !1, !0), delete O.passwordlessToken, u.removeQueryParamByName("passwordless_token")), u.doneCall("refreshUserToken"); }, Q = function (e) { W({ screen: "passwordless_confirmation", jsonpError: e }), delete O.passwordlessToken, u.removeQueryParamByName("passwordless_token"); }, X = function (e) { var n = { aid: O.aid || pn.aid, login_token_id: e.login_token_id, user_token: e.access_token }, t = { passwordlessToken: e.passwordless_token, redirectUri: e.direction_url }; $(n, t); }, $ = function (e, n) { d.showWaitPanel(), v.callApi("/anon/passwordless/complete", e, (function (e) { if (e.result && e.result.polling_enabled)
        return Y(e).then((function (e) { Z(e, n); })); Z(e, n); })); }, Y = function (e) { return new Promise((function (n) { var t = { aid: pn.aid, oid: e.result.oid, process_id: e.result.process_id, user_token: pn.user.getProvider().getToken() }; K(t, 0, e.result.polling_timeouts, n); })); }, K = function (e, n, t, r) { v.callApi("/anon/passwordless/check", e, (function (o) { n++, o && o.result && "waiting" !== o.result.poll_status ? r(o) : !o.result && o.message ? (u.error("Passwordless purchase failed", o.message), r()) : n <= t.length ? setTimeout((function () { K(e, n, t, r); }), t[n - 1]) : r(); })); }, Z = function (e, n) { try {
        var t = e.result.resource || {}, r = JSON.parse(e.result.show_offer_params), o = ee(n);
        if (!Object.keys(t).length && !Object.keys(r).length)
            return W(o);
        o = t.name ? ee(n, { customParams: { resourceName: t.name } }) : ee(n, { customEvents: { checkoutContinue: function () { Ce(), d.closeModalContainer(), pn.offer.show(r); } } }), W(o);
    }
    catch (e) {
        W(ee(n));
    }
    finally {
        d.hideWaitPanel();
    } }, ee = function (e, n) { var t = { screen: "passwordless_confirmation" }; return e && (t.passwordlessToken = e.passwordlessToken, t.redirectUri = e.redirectUri), n ? Object.assign(t, n) : Object.assign(t, { passwordlessSuccess: !0 }); }, ne = function (e, n) { n = n || {}; var t = Te(); if (t) {
        var r = { token: Pe(), user: t, source: n.source, stage: n.stage }, i = { event: "loginSuccess", source: n.source, params: r.user, user_token: r.token, registration: o, stage: n.stage };
        e ? (e.loggedIn && e.loggedIn(r), n.emitGlobalLoginSuccessEvent && oe("loginSuccess", i)) : (re("loggedIn", r), re("loginSuccess", r), n.source === S && (re("fire_loginSuccess", i), oe("loginSuccess", i)));
    } }, te = function (e, n) { ie({ login: "loginDisplayed", register: "registerDisplayed" }[e], {}, n); }, re = function (e, n) { L[e] && L[e].forEach((function (e) { e(n); })); }, oe = function (e, n) { U[e] && U[e].forEach((function (e) { e(n); })); }, ie = function (e, n, t) { !t && re(e, n), oe(e, n); }, ae = function (e) { e && Object.keys(L).forEach((function (n) { e[n] && L[n].push(e[n]); })); }, se = function (e) { e.aid || (e.aid = pn.aid), e.displayMode || (e.displayMode = "modal"), "popup" === e.displayMode ? (e.width = parseInt(e.width) || le(), e.height = parseInt(e.height) || 460) : "modal" === e.displayMode && (e.width = parseInt(e.width) || le()), e.accessToken = Pe(); }, ce = function (e) { T = e; }, le = function () { var e = window.innerWidth || document.documentElement.clientWidth || window.screen.width; return Math.min(e, 400); }, ue = function (e, n, t) { o = !1, Ee(), w.remove(A), u.setAccessTokenListCookie({ value: null }, void 0, !0), Ue().then((function () { t || function (e) { var n = { source: e }; re("loggedOut", n), oe("logout", n); }(n), e && e(); })), Ye(); }; function de(e) { return function (n) { var t, r, o = e.config.trackingId, i = e.config.formName; switch (n.event) {
        case "loaded":
            "modal" === e.config.displayMode && d.checkBackdropAndContainer(e, !0), e.config.loadedCallback && e.config.loadedCallback(e);
            break;
        case "stateReady":
            e.config.readyCallback && e.config.readyCallback(e);
            break;
        case "resize":
            d.resizeIframe(e, n.params);
            break;
        case "restoreSize":
            "inline" === e.config.displayMode && d.resizeIframe(e, { width: s.getWidth(e.container) });
            break;
        case "loginSuccess":
            ve(n, (function () { e.config.callback && e.config.callback(), pn.user.refreshAccessToken(!0), p.broadcast("pianoIdLoginSuccess", n.params); }));
            break;
        case "loginFailed":
            ie("loginFailed", n.params);
            break;
        case "registrationSuccess":
            ve(n, (function () { ie("registrationSuccess", n.params), p.broadcast("pianoIdLoginSuccess", n.params); }));
            break;
        case "registrationFailed":
            ie("registrationFailed", n.params);
            break;
        case "lang":
            Be(n.params.lang, !0), Ge(n.params.lang, e);
            break;
        case "customEvent":
            t = e.config, r = n.params, t && t.customEvent && t.customEvent(r), oe("customEvent", r);
            break;
        case "closed":
            De(e, !0), e.config.closedCallback && e.config.closedCallback(e);
            break;
        case "cfFormSubmission":
            f.__protected__.logCustomFormSubmission(o, i, x);
            break;
        case "formSend":
        case "formSkip":
            De(e);
            break;
        case "cfAppImpression":
            f.__protected__.logCustomFormImpression(o, i, P);
            break;
        case "cfAppSubmission":
            f.__protected__.logCustomFormSubmission(o, i, P);
            break;
        case "cfFormImpression":
            f.__protected__.logCustomFormImpression(o, i, x);
            break;
        case "changeScreen":
            te(n.params.screen);
            break;
        case "screenReady":
            ie("onShow");
            break;
        case "layoutReady":
            ie("layoutReady", n.params);
            break;
        case "confirmationEmailSent":
            "inline" === e.config.displayMode || n.params.isDOI || n.params.isPasswordlessDigitalCode || De(e);
            break;
        case "verificationCodeStartCheckout":
            var a = {};
            try {
                a = JSON.parse(n.params.startCheckoutParams);
            }
            catch (e) {
                u.log("error parse start checkout params"), a = {};
            }
            De(e, !0), Re(!0, !0), u.waitCall("refreshUserToken", (function () { pn.offer.show(a); }));
            break;
        case "removeParamFromGlobalConfig":
            fe(n);
            break;
        case "verifyCode":
            me(n, e);
            break;
        case "openPasswordlessLoginWithCreatingUser":
            pe();
            break;
        case "fireCustomEvent":
            !function (e) { N && "function" == typeof N[e] && N[e](); }(n.params.name);
            break;
        case "passwordRestored":
            u.removeQueryParamByName("reset_token"), O.resetPasswordToken = void 0;
            break;
        case "emitGAEvent":
            g.emitEvent(n.params);
            break;
        case "redirect":
            document.location.href = n.params.url;
            break;
        case "designVersion":
            d.addClassToContainer(e, "piano-id-modal-ver-" + n.params.version);
            break;
        case "profileUpdated":
            re("profileUpdate", n.params);
            break;
        case "logout":
            ue();
            break;
        default: u.debug("Received invalid event type: " + n.event);
    } }; } var pe = function () { z({ createPasswordlessUser: !0 }); }, fe = function (e) { var n = e.params.name, t = u.fromUnderscoreToCamelCase(n); delete O[t], e.params.removeFromUrl && u.removeQueryParamByName(n); }, me = function (e, n) { var t = e.params.verificationCode, r = e.params.locale, o = O.aid || pn.aid, i = Ae(), a = document.location.href; c.request({ url: he() + "api/v1/identity/verification/code", dataType: "jsonp", data: { client_id: o, access_token: i, site: a, verification_code: t, lang: r }, success: function (e) { e.error || ge(e, n); }, xhrFields: { withCredentials: !0 }, crossDomain: !0 }); }, ge = function (e, n) { !e.error && e.access_token && Se({ token: e.access_token, user: l(e.access_token), cookie_domain: e.site_cookie_domain }), p.send("verificationCodeComplete", e, n.iframeId); }, ve = function (e, n) { e && e.params && !e.params.areCookiesSet ? (e.params.source = S, o = !!e.params.registration, Me(e.params).then((function (e) { n(e); }))) : "function" == typeof n && n(), $e(); }, he = function () { return function () { var e = pn.sandbox || pn.isNonProdEndpoint(), n = O.iframeUrl || pn.pianoIdUrl || !e && "https://id.tinypass.com" || "/"; return "/" === n && (n = pn.getEndpointRoot(!0)), n.replace(/\/$/, ""); }() + "/id/"; }, we = function () { var e = O.aid || pn.aid; return F.indexOf(e) >= 0; }, be = function (e, n, t, r) { e.match("proxy.html") || (e += we() ? "index3.html" : ""); var o = { client_id: n.aid, sender: t.iframeId, origin: r || window.location.origin || window.location.href, site: window.location.href, display_mode: n.displayMode, pageViewId: pn.main.fetchPageViewId(), tbc: u.getTbcCookie() }, i = Ve(); if (i && (o.lang = i), g.getClientId() && (o.ga_client_id = g.getClientId()), g.getGAAccount() && (o.ga = g.getGAAccount()), n.disableSignUp && (o.disable_sign_up = !0), n.screen && (o.screen = n.screen), n.resetPasswordToken && (o.reset = n.resetPasswordToken), n.verification_code && (o.verification_code = n.verification_code), n.stage && (o.stage = n.stage), n.resetPasswordLandingUrl && (o.reset_uri = n.resetPasswordLandingUrl), n.width && "modal" === n.displayMode && (o.width = n.width), n.formName && (o.form_name = n.formName), ke(n, e) && (e += "form"), "profile" === n.template && (e += "profile"), n.hideIfComplete && (o.hide_if_complete = n.hideIfComplete), n.preview && (o.preview = n.preview), n.templateVersion && (o.templateVersion = n.templateVersion), n.template && (o.template = n.template), n.accessToken && (o.access_token = n.accessToken), n.email && (o.email = n.email), n.singleStep && (o.single_step = !0), n.createPasswordlessUser && (o.create_passwordless_user = !0), n.customParams && (o.custom_params = JSON.stringify(n.customParams)), n.customEvents) {
        var a = [];
        Object.keys(n.customEvents).forEach((function (e) { a.push(e); })), a.length && (o.custom_events = JSON.stringify(a));
    } return n.jsonpError && (o.jsonp_error = JSON.stringify(n.jsonpError)), n.passwordlessSuccess && (o.passwordless_success = !0), n.passwordlessToken && (o.passwordless_token = n.passwordlessToken), n.redirectUri && (o.redirect_uri = n.redirectUri), t.iframeUrl && (o.url = t.iframeUrl), n.returnBack && (o.return_back = n.returnBack), t.pos && (o.width = t.pos.width, o.height = t.pos.height, o.top = t.pos.top, o.left = t.pos.left), n.templateId && (o.template_id = n.templateId), n.variantId && (o.variant_id = n.variantId), [e, s.param(o)].join("?"); }, ke = function (e, n) { var t = we(), r = !e.isRegistration, o = !/\.html$/.test(n) || t; return e.formName && o && r; }, _e = function (e) { var t = s.queryEl(e.containerSelector), r = "piano-id-" + (e.isRegistration ? "" : "form-") + u.randomString(); e.singleContainer = t; var o, i, a, c = { iframeId: r, containerSelector: e.containerSelector, width: e.width, height: e.height }, l = be(he(), e, c), f = he(), g = !0; if (e.iframeParams = c, "inline" === e.displayMode) {
        var v = d.initInlineContainer(e);
        if (!(o = v.container))
            return;
        i = d.generateIframe(e, c, l), g = !!v.containerReady, e.observeContainer && (a = m.create(o, B));
    }
    else if ("modal" === e.displayMode)
        o = d.getModalContainer(e, (function () { return De(n); })), i = d.generateIframe(e, c, l);
    else if ("popup" === e.displayMode)
        if (u.isIE()) {
            o = d.generateIframeWrapper(), l = be(he(), e, c, he() + "proxy.html"), c.iframeUrl = l, c.pos = d.getPopupPosition(c);
            var h = be(he() + "proxy.html", e, c);
            e.displayMode = "inlinePopup", i = d.generateIframe({}, c, h);
        }
        else {
            o = d.generatePopup(c, l);
            try {
                try {
                    i = o.document;
                }
                catch (e) {
                    i = o;
                }
            }
            catch (e) {
                i = window.document;
            }
        } var w = { iframeId: c.iframeId, config: e, element: i, container: o, iframeParams: c, containerReady: g }, y = { center: u.centerScreen(), originUrl: document.location.href }; if (p.init({ postMessageUrl: f, receive: de(w), iframe: w, iframeParams: c }, y), "inline" === e.displayMode) {
        var b = document.createElement("div");
        s.addClass("piano-id-container", b), s.append(b, i), s.append(o, b);
    }
    else
        "modal" === e.displayMode ? s.append(o, i) : "inlinePopup" === e.displayMode && (s.append(o, i), s.append(document.body, o)); if (u.debug("creating iframe: ", e), R.push(w), "modal" === e.displayMode) {
        (n = w).observer = a, (u.isIphone() || u.isSafariOrIOsUiWebView() || u.isAndroid()) && d.__private__.mobileModalFix.modalOpened();
        var k = Ve();
        Ge(k, w);
    } return w; }, Ce = function (e) { if (n) {
        var t = d.__private__.mobileModalFix;
        d.closeModal(n), s.remove(n.element), n.observer && n.observer.disconnect(), t.isIphoneCaretFixed && t.modalClosed(), n = void 0;
    } }, Ie = function (e) { var n = { path: "/" }, t = u.__protected__.getCookie(_), r = u.extractCookieDomain(e || t); return r && (n.domain = r), (pn.cookieDomain || pn.cookiePath) && (n.domain = pn.cookieDomain ? pn.cookieDomain : n.domain, n.path = pn.cookiePath ? pn.cookiePath : n.path), n; }, Se = function (e) { if (e && e.user && e.token) {
        Ee(null, !0, !0);
        var n = Ie(e.cookie_domain);
        e.extendExpiredAccessEnabled && xe(e.extendExpiredAccessEnabled, e.cookie_domain), (e.user.rememberMe || He()) && (n.expires = new Date(1e3 * e.user.exp), qe(n));
        var t = u.getPossibleCookieDomains();
        for (var r in t)
            u.deleteCookie(b, t[r]);
        u.__protected__.setCookie(b, e.token, n), e.cookie_domain && (n.expires = 30, u.__protected__.setCookie(_, e.cookie_domain, n));
    } }, xe = function (e, n) { Je("setExtendExpiredAccess", e, "broadcast"); var t = Ie(n); t.expires = 30, u.__protected__.setCookie(I, e ? "true" : "false", t); }, Pe = function () { var e = u.findCookieByName(b); return e || null; }, Ee = function (e, n, t) { var r = Ie(), o = u.getPossibleCookieDomains(r.domain); e && u.__protected__.logRemoveTokens(e), o.forEach((function (e) { var o = ye(ye({}, r), { domain: e }); a.remove(b, o), t || a.remove(I, o), n || ze(o); })); }, Te = function () { var e = null, n = Pe(); if (n)
        try {
            if (e = l(n)) {
                e.firstName = e.given_name, e.lastName = e.family_name, e.valid = !0, e.uid = e.sub, e.confirmed = !e.email_confirmation_required;
                var t = new Date;
                new Date(1e3 * e.exp) < t && (u.log("Removing expired tokens"), Ee(n), e = null);
            }
        }
        catch (e) { } return e; }, Ae = function () { return pn.externalJWT && Qe() ? pn.externalJWT : Pe(); }, Me = function (e, n, t) { Se(e); var r = je(e).then((function () { !n && ne(null, { stage: e.stage, source: e.source }); })); if (!(t = t || e.withoutCloseModal)) {
        var o = e && e.user && e.user.email_confirmation_required, i = O.verification_code;
        o || i ? d.hideCloseButton() : Fe();
    } return r; }, Oe = function () { return Qe() ? !!pn.externalJWT : !!Te(); }, Re = function (e, n) { return new Promise((function (t, r) { u.startCall("refreshUserToken"); var o = function (e) { var n = void 0 === e ? {} : e, o = n.isSuccessful, i = n.gmSSOEnabled; o ? t(null) : r(), u.doneCall("refreshUserToken"), o && (D = i) && !Xe() && z({ screen: "sso_confirm" }); }, i = function (t) { !t.error && t.access_token ? Me({ token: t.access_token, user: l(t.access_token), cookie_domain: t.site_cookie_domain, extendExpiredAccessEnabled: t.extend_expired_access_enabled }, e, n).then((function () { return o({ isSuccessful: !0, gmSSOEnabled: t.authorized_by_sso }); })) : (Ee(Ae()), o({ isSuccessful: !1 })); }, a = Ae() || void 0, s = { client_id: O.aid || pn.aid, site: document.location.origin || document.location.href }, d = Le(); d && (s.tcf = d), a ? c.request({ url: he() + "api/v1/identity/token/validation", data: s, headers: { Authorization: a }, success: function (e) { i(e), e.access_token && Ne(d); }, error: o }) : c.request({ url: he() + "api/v1/identity/token/verify", data: s, success: function (e) { i(e), e.access_token && Ne(d); }, error: o, dataType: "jsonp", xhrFields: { withCredentials: !0 }, crossDomain: !0 }), setTimeout(o, 10 * T); })); }, Le = function () { var e, n = window; return function (e) { if (!e)
        return !1; var n = e; if (!n || !n.tcString || !n.date)
        return !1; var t = new Date, r = new Date(n.date), o = Math.abs(r.getTime() - t.getTime()); return Math.ceil(o / 864e5) <= 1; }(w.get(A)) ? null : (e = null, n.__tcfapi && n.__tcfapi("getTCData", 2, (function (n, t) { t && n.tcString && (e = n.tcString); }), [412]), e); }, Ne = function (e) { if (e) {
        var n = { date: (new Date).toString(), tcString: e };
        w.set(A, JSON.stringify(n));
    } }, Ue = function () { return new Promise((function (e) { c.request({ url: he() + "api/v1/identity/logout", data: { client_id: O.aid || pn.aid }, dataType: "jsonp", complete: e, xhrFields: { withCredentials: !0 }, crossDomain: !0 }), setTimeout(e, T); })); }, je = function (e) { return new Promise((function (n) { var t = !(e && e.user && e.user.rememberMe || He()); c.request({ url: he() + "api/v1/identity/vxauth/cookie", data: { client_id: O.aid || pn.aid, session_cookie: t }, headers: { Authorization: e.token || void 0 }, complete: n }), setTimeout(n, T); })); }, De = function (e, n) { e && (n ? e.closed || (e.closed = !0, "inline" === e.config.displayMode ? s.empty(e.container) : "popup" === e.config.displayMode ? e.container.close() : "modal" === e.config.displayMode && (Ce(), s.remove(e.container.parentElement)), D && Ae() && $e()) : (p.send("close", {}, e.iframeId), R = R.filter((function (n) { return n.iframeId !== e.iframeId; })), setTimeout((function () { De(e, !0); }), 600))); }, Fe = function () { R.forEach((function (e) { De(e); })), R = []; }, Be = function (e, n) { var t = Ie(); t.expires = 30, u.__protected__.setCookie(k, e, t), n || R.forEach((function (n) { p.send("lang", { lang: e }, n.iframeId); })), Object.keys(L.langChangeFromIframe).forEach((function (n) { var t = L.langChangeFromIframe[n]; p.__protected__.isIframeManaged(n) && t ? t(e) : delete L.langChangeFromIframe[n]; })), ie("langChange", e); }, Ve = function () { return pn.locale || u.__protected__.getCookie(k) || ""; }, qe = function (e) { u.__protected__.setCookie(C, 1, e); }, ze = function (e) { e && a.remove(C, e); }, He = function () { return !!u.__protected__.getCookie(C); }, We = function (e) { return new Promise((function (n) { var t = Object.assign({}, O, e); c.request({ url: he() + "api/v1/identity/userinfo", data: { client_id: O.aid || pn.aid, form_name: t.formName }, headers: { Authorization: Ae() || void 0 }, success: n, complete: function () { return n(null); } }), setTimeout(n, 10 * T); })); }, Je = function (e, n, t) { j.push({ type: t, name: e, data: n }); }, Ge = function (e, n) { M.includes(e) ? d.turnOnRTL(n) : d.turnOffRTL(n); }, Qe = function () { return !0 === pn.usePianoIdLiteUserProvider || "string" == typeof pn.usePianoIdLiteUserProvider && "true" === pn.usePianoIdLiteUserProvider; }, Xe = function () { return !!w.get("piano-id-initial-gm-sso-shown-" + (O.aid || pn.aid)); }, $e = function () { w.set("piano-id-initial-gm-sso-shown-" + (O.aid || pn.aid), "1"); }, Ye = function () { w.remove("piano-id-initial-gm-sso-shown-" + (O.aid || pn.aid)); }; return { name: "pianoId", isv: !1, init: q, prepare: function () { return V(); }, show: z, showForm: function (e) { q().then((function () { var t = Object.assign({}, O, e, { isRegistration: !1 }); if (!t.formName)
            throw new Error('Form name should be specified, like\ntp.pianosId.showForm({formName: "..."});'); var r = function () { if (n)
            u.log("Modal login window already shown");
        else {
            if (se(t), ae(e), !t.preview && o)
                return void u.log("Skip show form, register new user");
            if (!t.hideIfComplete)
                return Object.assign(t, { readyCallback: function (e) { p.send("setToken", Ae(), e.iframeId); } }), _e(t);
            We(t).then((function (e) { if (e && e.has_all_custom_field_values_filled && t.hideIfComplete)
                u.log("Skip show form, all fields are completed");
            else {
                var n = Object.assign({}, t, { readyCallback: function (n) { p.send("userData", e, n.iframeId); } });
                _e(n);
            } }));
        } }; if (e.preview || Oe())
            r();
        else {
            var i = Object.assign({}, e, { closedCallback: function () { Oe() && r(); } });
            z(i);
        } })); }, checkAndShowEmailIsNotConfirmed: H, showEmailConfirmationRequired: function (e) { n ? u.log("Modal window already shown") : q().then((function () { var n = Object.assign({ screen: "email_confirmation_required" }, O, e); ae(e), se(n), _e(n); })); }, submitLoginForm: function () { p.send("submitLoginForm", null, null == n ? void 0 : n.iframeId); }, loginByToken: function (e) { var n = l(e); Me({ user: n, token: e }); }, logout: ue, getToken: Ae, getUser: Te, loadExtendedUser: function (e) { var n = Object.assign({}, O, e); We(n).then((function (e) { var t = Object.assign({}, e); e && Array.isArray(e.custom_field_values) && (e.custom_field_values = e.custom_field_values.map((function (e) { var n; try {
            n = JSON.parse(e.value);
        }
        catch (t) {
            n = e.value;
        } return { field_name: e.field_name, value: n, created: e.created }; }))), "function" == typeof n.extendedUserLoaded && n.extendedUserLoaded(t), oe("extendedUserLoaded", t); })); }, getName: function () { return "piano_id"; }, isConfigured: function () { return !0 === pn.usePianoIdUserProvider || "string" == typeof pn.usePianoIdUserProvider && "true" === pn.usePianoIdUserProvider; }, onLoginSuccess: function (e) { if (!i) {
            i = !0;
            var n = { source: e.source, token: e.user_token, user: e.params, cookie_domain: e.cookie_domain, stage: e.stage };
            u.setAccessTokenListCookie({ value: e.token_list, cookie_domain: e.cookie_domain }, e.user_token), Me(n).then((function () { i = !1; }));
        } }, onProfileUpdate: function (e, n) { var t = { token: e.token, user: e.user, cookie_domain: e.cookie_domain }; Me(t, !0).then((function () { n(), function (e) { re("profileUpdate", e); }(t); })); }, onExtendedUserLoginRequired: function () { W(); }, isUserValid: Oe, setCallbacks: ae, getIframeUrl: function () { return he(); }, updateLang: Be, onLangChange: function (e, n) { return L.langChangeFromIframe[n] = e, function () { delete L.langChangeFromIframe[n]; }; }, getLang: Ve, isAot: function () { R.forEach((function (e) { p.send("isAOT", {}, e.iframeId); })); }, registerCallback: function (e, n) { U[e] = U[e] || [], U[e].push(n); }, setRequestTimeout: ce, __protected__: { offerMessageReceiver: function (e) { switch (e.params.event) {
                case "cfAppImpression":
                case "cfFormImpression":
                    f.__protected__.logCustomFormImpression(e.params.trackingId, e.params.trackingId, E);
                    break;
                case "cfFormSubmission":
                    f.__protected__.logCustomFormSubmission(e.params.trackingId, e.params.trackingId, E);
                    break;
                case "changeScreen":
                    te(e.params.params.screen, !0);
                    break;
                case "loginFailed":
                case "registrationFailed":
                case "registrationSuccess":
                case "customEvent":
                    ie(e.params.event, e.params.params, !0);
                    break;
                case "emitGAEvent":
                    g.emitEvent(e.params.params);
                    break;
                default: return void u.debug("Received invalid event type: " + e.params.event);
            } }, showEmailConfirmation: function (e) { n ? u.log("Modal window already shown") : q().then((function () { var n = Object.assign({ screen: "email_confirmation" }, O, e); ae(e), se(n), _e(n); })); }, checkAndShowEmailIsNotConfirmed: H, closeModalContainer: Ce, executePostMessagesBatch: function () { for (; j.length;) {
                var e = j.pop();
                "broadcast" === e.type ? p.broadcast(e.name, e.data) : p.send(e.name, e.data);
            } } }, __private__: { prepareConfig: se, extendUserToken: function () { var e = Pe(); if (e) {
                var n = (new Date).getTime(), t = u.__protected__.getCookie(I), r = n - l(e).login_timestamp > 864e5;
                t && r && Re(!1, !0);
            } }, setRequestTimeout: ce } }; };
    pn.container.register("pianoId", { useValue: qe() }), pn.pianoId = pn.container.resolve("pianoId");
    var ze = function () { var e = pn.container.resolve("util"), n = pn.container.resolve("pianoId"), t = pn.container.resolve("eventUtils").createEventManager(["userChanged", "onHide"]), r = e.getAidSpecifiedName("__utp"), o = function () { return pn.externalJWT || i(); }, i = function () { return e.findCookieByName(r) || null; }; return { name: "pianoIdLite", isv: !1, isConfigured: function () { return !0 === pn.usePianoIdLiteUserProvider || "string" == typeof pn.usePianoIdLiteUserProvider && "true" === pn.usePianoIdLiteUserProvider; }, isUserValid: function () { return !!o(); }, getToken: o, getName: function () { return "piano_id_lite"; }, onLoginSuccess: function (n) { e.setAccessTokenListCookie({ value: n.token_list, cookie_domain: n.cookie_domain }, n.user_token); }, registerCallback: function (e, n) { t.addEvent(e), t.registerCallback(e, n); }, loginByToken: function (e) { n.loginByToken(e); }, logout: function (n) { e.waitCall("refreshUserToken", (function () { "function" == typeof n && n(); })); } }; }();
    pn.container.register("pianoIdLite", { useValue: ze }), pn.pianoIdLite = pn.container.resolve("pianoIdLite");
    var He = function (e) { void 0 === e && (e = pn.container); var n = e.resolve("api"), t = e.resolve("util"), r = e.resolve("janrain"), o = e.resolve("tinypassAccounts"), i = e.resolve("condeUserProvider"), a = e.resolve("gigya"), s = e.resolve("pianoId"), c = e.resolve("pianoIdLite"), l = e.resolve("eventUtils").createEventManager([]), u = { isv: !1, getName: function () { return "publisher_user_ref"; }, getToken: function () { return pn.userRef ? pn.userRef.constructor === "".constructor ? pn.userRef : pn.userRef.constructor === {}.constructor ? "{jox}" + JSON.stringify(pn.userRef) : pn.userRef : null; }, isUserValid: function () { return !!(void 0 !== pn.userRef && pn.userRef && pn.userRef.length > 0); }, onLoginSuccess: function (e) { t.setAccessTokenListCookie({ value: e.token_list, cookie_domain: e.cookie_domain }, e.user_token); }, logout: function (e) { t.setAccessTokenListCookie(), e && e(); } }, d = function () { var e = [r, o, i, a, s, c].find((function (e) { return e.isConfigured() && !e.isv; })); return e || u; }; return { name: "user", getProvider: d, providerInit: function (e) { void 0 !== e && e || (e = function () { }); var n = d(); "function" == typeof n.prepare ? "prepare" in n && n.prepare().then(e, e) : e(); }, refreshAccessToken: function (e, r) { void 0 !== r && r || (r = function () { }); var o = !1; if (void 0 !== e && e)
            o = !0;
        else {
            var i = t.__protected__.getCookie("__tae");
            if (void 0 !== i && i) {
                var a = new Date(parseInt(i));
                (new Date).getTime() - a.getTime() > 864e5 && (o = !0);
            }
            else
                o = !0;
        } o ? t.waitCall("refreshUserToken", (function () { t.waitCall("offerCreate", (function () { t.waitCall("experienceExecute", (function () { if (d().isUserValid()) {
            t.startCall("refreshAccessTokenList");
            var e = { url: t.prepareUrlParameter(window.location.href) };
            n.callApi("/access/token/list", e, (function (e) { t.doneCall("refreshAccessTokenList"), void 0 !== e.access_token_list ? (t.setAccessTokenListCookie(e.access_token_list), r && r(e.access_token_list.value)) : r && r(null); }), void 0, void 0, !0);
        }
        else
            r && r(""); })); })); })) : r(null); }, showLogin: function (e) { var n = d().getName(); if ("tinypass_accounts" === n)
            o.login(e);
        else if ("piano_id" === n) {
            var t = e || {};
            s.show(t);
        }
        else
            "publisher_user_ref" === n && l.fireCallbacks("loginRequired", {}, void 0, !0); }, isUserValid: function () { return d().isUserValid(); }, logout: function (e, n) { d().logout(e, n); }, registerCallback: function (e, n) { l.addEvent(e), l.registerCallback(e, n); }, getUserInfoParams: function (e) { var n = e.userToken; if (!n) {
            var r = d().getToken();
            n = r && r.length > 0 ? r : "";
        } return { user_token: n, user_lang: t.__protected__.getCookie("LANG") || "", is_preview: e.preview, is_non_logged_user: e.previewNonLoggedUser }; } }; };
    pn.container.register("user", { useValue: He() }), pn.user = pn.container.resolve("user");
    var We = function () { var e = pn.container.resolve("jqUtils"), n = pn.container.resolve("util"), t = "viewport-exit-activated", r = "viewport-exit-prepared", o = !1, i = !1, a = 0, s = 0, c = ["top", "right", "bottom", "left"], l = !0, u = !1, d = !1, p = [], f = { top: { visited: !1, value: 1 }, right: { visited: !1, value: 2 }, bottom: { visited: !1, value: 4 }, left: { visited: !1, value: 8 } }, m = 0, g = function () { if (!u) {
        u = !0, m = 0;
        var n = /(?:Firefox|Safari)[\/\s](\d+\.\d+)/.test(navigator.userAgent) ? document.body : document;
        e.on(n, "mouseleave", (function (e) { return v(e); })), e.on(document, "mousemove", (function (e) { return h(e); }));
    } }; var v = function (t) { var r, o, l, u, d, p, g; (r = function (e) { return e.clientX === e.clientY && e.clientX < 0 && e.clientX >= -1; }(t) ? "" : (o = t.clientX, l = t.clientY, u = e.winSize(), d = u.width, p = u.height, g = "", o >= d && (g = "right"), l >= p && (g = "bottom"), o <= 0 && (g = "left"), l <= 0 && (g = "top"), g)) || (r = function () { if (!i)
        return ""; var n = e.winSize(), t = n.width, r = n.height; return c[function (e) { if (0 === e.length)
        return -1; for (var n = e[0], t = 0, r = 1; r < e.length; r++)
        e[r] < n && (t = r, n = e[r]); return t; }([s, t - a, r - s, a])]; }(), r || n.debug("viewportExit: the detect of the exit side failed")), r && function (e) { -1 !== c.indexOf(e) ? f[e].visited || (f[e].visited = !0, m += f[e].value) : n.debug("viewportExit: the detect of the exit side failed"); }(r), w("all"), "top" === r && w("top"); }, h = function (e) { i = !0, s = e.clientY, a = e.clientX; }, w = function (e) { if (l) {
        for (var t, r = [], o = [], i = 0; i < p.length; i++)
            ((t = p[i]).detectExitMode === e || "back" === e && t.detectBackButtonForMobile) && t.consumeEventFn() ? r.push(t) : o.push(t);
        r.length && n.debug("viewportExit: listeners was run fire with type: ", e), p = o;
        for (i = 0; i < r.length; i++)
            (t = r[i]).callback();
    } }; return { name: "viewportExit", initialize: g, isInitialized: function () { return u; }, addListener: function (e, n, i) { "mobile" !== n.clientDevice && "tablet" !== n.clientDevice || !n.detectBackButtonForMobile || function () { if (!d) {
            d = !0, window.addEventListener("popstate", (function (e) { o && e.state && e.state.pianoViewportExitState === t && (o = !1, w("back")); }));
            var e = window.history.state || {};
            e && e.pianoViewportExitState !== r && (e.pianoViewportExitState !== t && (e.pianoViewportExitState = t, window.history.replaceState(e, document.title)), window.history.pushState({ pianoViewportExitState: r }, document.title)), o = !0;
        } }(), g(), "function" != typeof i && (i = function () { return !0; }), p.push({ callback: e, detectExitMode: n.detectExitMode, detectBackButtonForMobile: n.detectBackButtonForMobile, consumeEventFn: i }); }, resetSumOfCodesDirectionToDefault: function () { m = 0; }, getSumOfCodesDirection: function () { return m; }, removeListeners: function () { p = []; }, enable: function () { l = !0; }, disable: function () { l = !1; } }; }();
    pn.container.register("viewportExit", { useValue: We }), pn.viewportExit = pn.container.resolve("viewportExit");
    var Je = function () { var e = pn.container.resolve("postmessage"), n = pn.container.resolve("containerUtils"), t = pn.container.resolve("user"), r = pn.container.resolve("api"); pn.container.resolve("util"); function o(e) { return a(e, "/checkout/template/show"); } function i(e) { return e.initContextLoadPromise = function (e, n) { e.contextLoadingPromise = s(e, n); }, a(e, "/checkout/template/cacheableShow"); } var a = function (e, n) { var t = pn.getEndpointRoot(!0) + n; return e.iframeUrl = t, e.postMessageUrl = t, e.widget = "template", pn.offer.createOfferIframe(e); }, s = function (e, n) { var o = t.getUserInfoParams(e); return o.tracking_id = e.trackingId, o.templateId = e.templateId, o.templateVariantId = e.templateVariantId, o.aid = pn.aid, o.preload = e.isPreload, e.affiliateState && (o.affiliateState = JSON.stringify(e.affiliateState)), Object.keys(n).forEach((function (e) { o[e] = n[e]; })), new Promise((function (e, n) { r.callApi("/anon/template/loadTemplateContext", o, (function (t) { var r = t.code, o = t.templateContext, i = t.message; 0 === r ? e(o) : n(i); }), void 0, void 0, !0); })); }, c = function (e, n) { var t = {}; return ["aid", "templateId", "templateVariantId", "previewTemplateVersion", "preload", "preview", "previewUncached", "deploymentItemId", "gaClientId", "zuoraSelectedRatePlanIds", "newscycleSelectedIds", "addNewsletterAssets", "offerId", "experienceId", "iframeId", "displayMode", "debug", "pianoIdUrl", "widget", "url"].forEach((function (n) { e[n] && (t[n] = e[n]); })), n.param(t); }; function l(e) { pn.getCacheableShowTemplate() ? (!function (e) { e.deferredContextLoading = !0, e.buildQueryStringFn = c; }(e), e.createIframeFn = i) : e.createIframeFn = o; } return { name: "template", show: function (e) { return e.offerId = n.fakeOfferId, e.trackStatsOnShow = !0, l(e), pn.offer.show(e); }, deferredShow: function (e) { return e.offerId = n.fakeOfferId, l(e), pn.offer.deferredShow(e); }, close: function () { n.closeModalContainer(); }, closeInline: function (e) { n.__protected__.closeInlineContainers(e); }, createTemplateIframe: o, showBackdrop: function () { n.showBackdrop(); }, hideBackdrop: function () { n.hideBackdrop(); }, centerBackdrop: function (e) { n.centerBackdrop(e); }, registerCallback: function (e, n) { }, refreshUser: function (n) { t.refreshAccessToken(!0, (function () { e.send("externalLoginSuccess", { user_token: t.getProvider().getToken() }, n); })); } }; }();
    pn.container.register("template", { useValue: Je }), pn.template = pn.container.resolve("template");
    var Ge = function (e) { void 0 === e && (e = pn.container); var n, t, r = e.resolve("jqUtils"), o = e.resolve("util"), i = e.resolve("postmessage"), a = e.resolve("user"), s = e.resolve("containerUtils"), c = e.resolve("eventUtils"), l = e.resolve("viewportExit"), u = e.resolve("gaService"), d = e.resolve("sha1"), p = e.resolve("logging"), f = e.resolve("template"), m = {}, g = 0, v = "close", h = "OFFER", w = !1, y = !1, b = !1, k = {}, _ = new Map, C = {}, I = ["he_IL", "ar_EG"], S = c.createEventManager(["complete", "cancel", "close", "error", "loginRequired", "loginSuccess", "loaded", "customEvent", "startCheckout", "resize", "onMeterExpired", "onMeterActive", "onAccessGranted", "onShowOffer", "pianoIdEvent", "parentSize", "redeemCredit", "onStartCreditRedemption"]); s.setIframesPopstateHandlers(); var x = function () { return pn.offerBaseUrl ? pn.offerBaseUrl : pn.getEndpointRoot() + "/checkout/offer/show"; }; function P(e, n) { var c = s.getIframe(e.sender), d = !0; switch (c && c.config && (d = !c.config.parent), e.event) {
        case "initContext":
            if (e.params && e.params.resultCallbackId) {
                var p = { resultCallbackId: e.params.resultCallbackId, affiliateState: c.config.affiliateState };
                i.send("resultCallback", p, e.sender);
            }
            break;
        case "storeCustomVariables":
            tp.saveCustomVariablesToLocalStorage(300);
            break;
        case "fullRedirectThreeDS":
            window.location.href = e.params.bankSecureUrl;
            break;
        case "resize":
            if (e.params.iframeId === e.sender) {
                var f = void 0 === e.params.width ? ye(ye({}, e.params), { width: r.getWidth(c.container) }) : e.params;
                s.resizeIframe(c, f), "modal" === c.config.displayMode && ("boilerplate" === e.params.closeButtonType && s.hideCloseButton(c.container), s.centerIt(c.container)), i.send("afterResize", {}, c.iframeId);
            }
            S.fireCallbacks(e.event, e.params, e.sender, d);
            break;
        case "startCheckout":
            if (e.params.width = null, "inline" === e.displayMode) {
                e.params.closeOnLogout = !0;
                var m = q(e.params, c.statParams);
                m.browserId = c.browserId, m.isOpenedFromInlineCheckout = !0, K(m, e.sender);
            }
            e.params.iframeId === e.sender && S.fireCallbacks(e.event, e.params, e.sender, d);
            break;
        case "loaded":
            if (e.params.iframeId === e.sender) {
                if (i.send("setupCustomVariables", k[e.params.iframeId], e.params.iframeId), i.send("setupEVTFields", c.config.externalVerificationFields, e.params.iframeId), c.config.deferredContextLoading && T(c, e), c.waitFinishProcesses)
                    return void s.__protected__.closeAndRemoveIframe(c);
                "pianoId" === a.getProvider().name && pn.pianoId.__protected__.executePostMessagesBatch(), "modal" === c.config.displayMode && (s.resizeIframe(c, e.params), c.config.isPreload || s.checkBackdropAndContainer(c, !0)), "popup" === c.config.displayMode && s.resizeIframe(c, e.params), c.config.isPreload || c.config.trackStatsOnShow || B(c), V(c), S.fireCallbacks(e.event, e.params, e.sender, d), "inline" === c.config.displayMode && (c.containerReady ? s.resizeIframe(c, e.params) : s.operationWithContainer(c.iframeParams.containerSelector, (function (n) { var t = r.queryEl("#temp-inline-" + c.iframeId); t && (n.innerHTML = t.innerHTML, r.remove(t)), c.element = r.queryEl("iframe", n), c.containerReady = !0, s.resizeIframe(c, e.params); }))), R(c.config), o.doneCall("offerCreate");
            }
            break;
        case "downForMaintenance":
            s.resizeIframe(c, { width: 300, height: 200 }), "modal" === c.config.displayMode && (c.config.isPreload || s.checkBackdropAndContainer(c));
            break;
        case "removeQueryParamByName":
            e && e.params && Array.isArray(e.params.paramsToRemove) && e.params.paramsToRemove.forEach((function (e) { o.removeQueryParamByName(e); }));
            break;
        case "purge":
            n || (e && e.params && e.params.alreadyPurchased && (v = "alreadyHasAccess"), e && e.params && e.params.completePayment && (v = "checkoutCompleted"), s.purgeIframe(e.sender, c.config.parent), R(c.config));
            break;
        case "close":
            n || (e && e.params && e.params.alreadyPurchased && (v = "alreadyHasAccess"), e && e.params && e.params.completePayment && (v = "checkoutCompleted"), o.hasQueryParamByName("voucher_code") && (v = "voucherRedemptionCompleted"), s.closeContainer(e.sender, c.config.parent), R(c.config));
            break;
        case "closeAndRefresh":
            var g = e.params;
            g ? window.location.assign(g) : window.location.reload();
            break;
        case "selectTerm":
            v = e && e.params && e.params.alreadyPurchased ? "alreadyHasAccess" : "close";
            break;
        case "submitPayment":
        case "checkoutSelectTerm":
            S.fireCallbacks(e.event, q(e.params, { offerId: c.iframeParams.offerId }), e.sender, d);
            break;
        case "complete":
            if (void 0 !== e.params.token_list) {
                var h = e.params.user_token;
                !h && a.isUserValid() && "pianoId" === a.getProvider().name && (h = a.getProvider().getToken()), o.setAccessTokenListCookie({ value: e.params.token_list, cookie_domain: e.params.cookie_domain }, h);
            }
            var y = q(e.params, { offerId: c.iframeParams.offerId });
            S.fireCallbacks(e.event, y, e.sender, d), v = "checkoutCompleted";
            break;
        case "checkoutStateChange":
        case "checkoutPaymentError":
        case "alreadyPurchased":
        case "startThreeDBankSecure":
        case "cancel":
        case "error":
        case "customEvent":
            S.fireCallbacks(e.event, e.params, e.sender, d);
            break;
        case "loginRequired":
            w = !0, S.fireCallbacks(e.event, ne(c, e.params), e.sender, d);
            break;
        case "logout":
            A(e.event, e.params, e.sender, c.config.parent);
            break;
        case "loginSuccess":
            M(e.event, e.params, e.sender, d);
            break;
        case "inputFocus":
            var b = r.queryEl(".tp-modal");
            b && (b.style.zIndex = pn.zIndexes.modal + 1 + "", b.style.zIndex = pn.zIndexes.modal + "");
            break;
        case "inputBlur":
            var _ = r.queryEl(".tp-modal");
            _ && (_.style.zIndex = pn.zIndexes.modal + 1 + "", _.style.zIndex = pn.zIndexes.modal + "");
            break;
        case "getLocation":
            e.params && e.params.resultCallbackId && (e.params.result = window.location.href, i.send("resultCallback", e.params, e.sender));
            break;
        case "setLocationHash":
            e.params && e.params.hash && (window.location.hash = e.params.hash);
            break;
        case "langChangedWithinOffer":
            pn.pianoId.isConfigured() && pn.pianoId.updateLang(e.params.lang), I.indexOf(e.params.lang) >= 0 ? s.turnOnRTL(c) : s.turnOffRTL(c);
            break;
        case "loginStart":
            l.disable();
            break;
        case "loginEnd":
            l.enable();
            break;
        case "pianoIdEvent":
            e.params.iframeId === e.sender && ("closed" === e.params.event && s.closeContainer(e.sender), pn.pianoId.__protected__.offerMessageReceiver(e)), E(e.params, e.sender);
            break;
        case "swgCheckoutStart": break;
        case "sharedAccountsSuccessfullyAdded":
            i.broadcast("refreshMyAccount", { userToken: a.getProvider().getToken() });
            break;
        case "newsletterSignupImpression":
        case "newsletterSignupSubmission":
            pn.pianoEsp.__protected__.offerMessageReceiver(e), S.fireCallbacks(e.event, e.params, e.sender, d);
            break;
        case "parentSize":
            var C = r.winSize(), x = { width: C.width, height: C.height };
            i.send("parentSize", x, e.sender);
            break;
        case "gigyaPasswordlessLogin":
            e.params.iframeId === e.sender && (t = e.params.iframeId, pn.gigya.loginByPasswordless(e.params));
            break;
        case "emitGAEvent": return void (!n && u.emitEvent(e.params));
        case "emitMetricsEvent":
            !n && u.emitMetricsEvent(e.params);
            break;
        case "bannerInit":
            c.config.singleContainer.classList.add("tp-banner");
            break;
        case "bannerDestroy":
            c.config.singleContainer.classList.remove("tp-banner");
            break;
        case "redeemCredit":
            var P = S.fireCallbacks("onStartCreditRedemption", e.params, e.sender, d);
            P && P.then && P.then((function (n) { i.send("successfullyCreditRedeem", n, e.sender); }), (function (n) { i.send("creditRedeemFailed", n, e.sender); }));
            break;
        default: return void o.debug("Received invalid event type: " + e.event);
    } } var E = function (e, n) { "successDOI" === e.event && (e.iframeId !== n && s.closeContainer(e.iframeId), i.send("afterSuccessDOI", e.params, n)); }, T = function (e, n) { e.config.contextLoadingPromise.then((function (t) { var r = { iframeParams: e.iframeParams, userContext: t }; r.iframeParams.url = o.prepareUrlParameter(window.location.href), i.send("userDataContextLoaded", r, n.params.iframeId); })); }, A = function (e, n, t, r, o) { a.logout((function () { var e = {}; e.userProvider = a.getProvider().getName(), e.userToken = a.getProvider().getToken() && a.getProvider().getToken().length > 0 ? a.getProvider().getToken() : "", e.noNeedStartCheckout = !0, ee(e); }), h), n.closeOnLogout && s.closeModalContainer(t, r); }, M = function (e, n, t, r) { if (n.source = h, a.getProvider().onLoginSuccess(n), S.fireCallbacks("loginSuccess", n, t, r), !b) {
        var o = { userToken: n.user_token, user: n.user, reloadAfterLogin: !0 };
        ee(o, t);
    } }, O = function (e) { var n = e.displayMode || "modal"; return [e.offerId, n, e.containerSelector].join("|"); }, R = function (e) { var n = O(e); delete m[n]; }, L = function (e) { if (v = "close", Q(e), void 0 === e.displayMode)
        e.displayMode = "modal";
    else if ("modal" !== e.displayMode && "inline" !== e.displayMode && "popup" !== e.displayMode)
        return o.log("Invalid offer displayMode; must be one of: modal, inline, popup"), void R(e); if ("modal" === e.displayMode && !e.isPreload && s.hasModalIframe())
        return o.log("Modal offer is already shown; must be one modal offer per time"), void R(e); if ("modal" !== e.displayMode) {
        var n, t = r.qa(e.containerSelector);
        if (!e.isPreload)
            if (t.forEach((function (t) { var r = q({}, e); r.singleContainer = t, n = N(r); })), n)
                return n;
        var i = t[t.length - 1];
        i && (e.singleContainer = i);
    } return N(e); }; function N(e, c) { var l = function (e) { var n = {}; e.termIds && (e.termIds instanceof Array || (e.termIds = [e.termIds])); var t = e.additionalParamNames ? e.additionalParamNames : []; ["displayMode", "containerSelector", "templateId", "templateVariantId", "offerId", "termId", "termIds", "rid", "aid", "isCheckout", "isOpenedFromInlineCheckout", "pw_id", "paywallId", "width", "preview", "previewUncached", "previewTemplateType", "previewTemplateVersion", "tokenType", "janrainCaptureToken", "closeOnLogout", "voucherCode", "isRedemption", "allowReturnToStartState", "startFromInlineCheckout", "formNameByTermId", "hideCompletedFields", "startFromInlineCheckout", "reloadAfterLogin", "preventReloadAfterLogin", "isAuth", "authStartScreen", "showCloseButton", "closeButtonType", "checkoutFlowId", "offerState", "oid", "promoCode", "promoCodeId", "promoCodeTermId", "rurl_3ds", "thirdPartyParams", "termId3ds", "providerId", "deploymentItemId", "sharedAccountCode", "targetedTermId", "widget"].concat(["trackingId", "experienceId", "activeMeters"], t).forEach((function (t) { e[t] && (n[t] = e[t]), "showCloseButton" === t && (void 0 === e[t] ? n[t] = !0 : n[t] = e[t]); })); var r = decodeURIComponent(o.getQueryParamByName("_ptid")); return r && (n.trackingId = r), e.preview && (n.activeMeters = JSON.stringify([{ meterName: "preview-meter", views: 10, viewsLeft: 5, maxViews: 20, totalViews: 20 }])), n; }(e); l.widget || (l.widget = "offer"); var d = o.getTbcCookie(); d && d.length > 0 && (l.tbc = d), e.deferredContextLoading ? (l.iframeId = U(e), l.url = window.location.origin) : (l.iframeId = "offer-" + g++ + "-" + o.randomString(), l.url = o.prepareUrlParameter(window.location.href)); var f = r.winSize(); l.parentDualScreenLeft = void 0 !== window.screenLeft ? window.screenLeft : screen.left, l.parentDualScreenTop = void 0 !== window.screenTop ? window.screenTop : screen.top, l.parentWidth = f.width ? f.width : document.documentElement.clientWidth ? document.documentElement.clientWidth : screen.width, l.parentHeight = f.height ? f.height : document.documentElement.clientHeight ? document.documentElement.clientHeight : screen.height, l.parentOuterHeight = window.outerHeight, e.previewNonLoggedUser && (l.previewNonLoggedUser = e.previewNonLoggedUser), e.isPreload && (l.preload = 1), pn.locale && (l.lang = pn.locale), u.getClientId() && (l.gaClientId = u.getClientId()), u.getGAAccount() && (l.gaAccount = u.getGAAccount()), function (e) { ["debug", "aid", "gaClientId", "tags", "contentSection", "contentAuthor", "debug", "zone"].forEach((function (n) { pn[n] && (e[n] = pn[n]); })), pn.customVariables && (k[e.iframeId] = JSON.stringify(pn.customVariables)); var n = pn.contentCreated; n && (e.contentCreated = n), pn && pn.main && (e.pageViewId = pn.main.fetchPageViewId(), e.visitId = pn.main.fetchVisitId()); }(l); var m = S.hasCallback("loginRequired"); if (!pn.janrain.isConfigured() || void 0 !== e.loginRequired && e.loginRequired)
        if (!pn.gigya.isConfigured() || void 0 !== e.loginRequired && e.loginRequired)
            if (pn.pianoId.isConfigured()) {
                void 0 !== e.loginRequired && e.loginRequired || (e.loginRequired = function (e) { if (!e.preventExternalLogin)
                    return n = e.termId, t = l.iframeId, pn.pianoId.show({ screen: e.startScreen }), !1; }), W(), l.pianoIdUrl = pn.pianoId.getIframeUrl();
                var h = pn.pianoId.getLang();
                h && (l.lang = h), pn.pianoId.onLangChange((function (e) { i.send("langChanged", { lang: e }, l.iframeId); }), l.iframeId);
            }
            else
                pn.pianoIdLite.isConfigured() && (l.pianoIdUrl = pn.pianoId.getIframeUrl());
        else {
            b = [];
            pn.gigya.registerCallback("onHide", (function (e) { s.activateContainers(b), i.send("gigyaHide", e, t); })), z(), e.loginRequired = function (e) { return y = e.allowReturnToStartState, w = !1, b = s.hideModalContainer(), n = e.termId, t = l.iframeId, o.waitCall("refreshUserToken", (function () { pn.gigya.login(); })), !1; };
        }
    else {
        var b = [];
        pn.janrain.addEventHandler("onModalClose", (function () { s.activateContainers(b); })), H(), e.loginRequired = function (e) { return b = s.hideModalContainer(), y = e.allowReturnToStartState, w = !1, n = e.termId, t = l.iframeId, o.waitCall("refreshUserToken", (function () { pn.janrain.login(void 0, e); })), !1; };
    } l.userProvider = a.getProvider().getName(), e.userToken ? l.userToken = e.userToken : l.userToken = a.getProvider().getToken() && a.getProvider().getToken().length > 0 ? a.getProvider().getToken() : "", o.getCampaigns(l), l.customCookies = JSON.stringify(o.getCustomCookies()), S.registerCallback(e, l.iframeId), l.hasLoginRequiredCallback = S.hasIframeCallback("loginRequired", l.iframeId) || m, l.initMode = "context", j(l); var _ = e.iframeUrl ? e.iframeUrl : l.isCheckout ? pn.getEndpointRoot(!0) + "/checkout/offer/show" : x(), I = e.postMessageUrl ? e.postMessageUrl : x(); e.deferredContextLoading && e.initContextLoadPromise(e, D(l)); var E = F(l, e), T = s.createContainer({ url: _, config: e, parent: e.parent, postMessageUrl: I, receive: P, iframeParams: l, singleContainer: e.singleContainer, close: function () { S.fireCallbacks("close", { state: v }, l.iframeId, !0); } }), A = _.indexOf("/offer/") ? "offerShow" : "templateShow"; return p.setTime(A), C = _.indexOf("/template/") && l.offerId === s.fakeOfferId ? l : C, T.statParams = E, T.browserId = e.browserId, T; } var U = function (e) { var n = 0, t = "offer_" + d.hash(e.iframeUrl + "?" + e.buildQueryStringFn(e, r), 20); return _.has(t) && (n = _.get(t) + 1), _.set(t, n), t + "-" + n; }, j = function (e) { var n = o.getQueryParamByName("termId"), t = o.getQueryParamByName("paySource"); n && (e.termId = n), t && (e.paySource = t); }, D = function (e) { var n = {}; return ["tbc", "trackingId", "pageViewId", "visitId", "tags", "contentCreated", "contentSection", "contentAuthor"].forEach((function (t) { e[t] && (n[t] = e[t]); })), Object.keys(e).forEach((function (t) { 0 === t.indexOf("tpcc_") && (n[t] = e[t]); })), n; }, F = function (e, n) { var t = {}; return n.trackStatsOnShow || n.deferredContextLoading || (t = D(e), Object.keys(t).forEach((function (n) { delete e[n]; }))), t; }, B = function (e) { var n = q(e.iframeParams, e.statParams); e.config.affiliateState && (n.affiliateState = e.config.affiliateState), i.send("trackStat", n, e.iframeId); }, V = function (e) { var n = { browserId: e.browserId }; i.send("passBrowserId", n, e.iframeId); }, q = function (e, n) { var t = {}; return Object.keys(e).forEach((function (n) { t[n] = e[n]; })), Object.keys(n).forEach((function (e) { t[e] = n[e]; })), t; }, z = function () { b || (pn.gigya.registerCallback("userChanged", (function (e) { if (e && e.user_token) {
        var r = { token_list: e.access_token.value, user_token: e.user_token, userToken: e.user_token, cookie_domain: e.access_token.cookie_domain, user: e.user, allowReturnToStartState: y, termId: n };
        if (t)
            s.getIframe(t) ? (i.send("externalLoginSuccess", r, t), delete r.termId, ee(r, t)) : ee(r);
        else
            ee(r);
    } })), pn.gigya.registerCallback("logout", (function () { var e, r = {}; r.userProvider = a.getProvider().getName(), r.userToken = a.getProvider().getToken() && a.getProvider().getToken().length > 0 ? a.getProvider().getToken() : "", r.noNeedStartCheckout = !0, t && (e = s.getIframe(t)), e && "inline" === e.config.displayMode && s.closeModalContainer(), n = "", t = "", y = !1, ee(r); })), b = !0); }, H = function () { b || (pn.janrain.registerCallback("userChanged", (function (e) { if (e && e.user_token) {
        var r = { token_list: e.access_token.value, user_token: e.user_token, userToken: e.user_token, cookie_domain: e.access_token.cookie_domain, user: e.user, allowReturnToStartState: y, termId: n };
        if (t)
            s.getIframe(t) ? (i.send("externalLoginSuccess", r, t), delete r.termId, ee(r, t)) : ee(r);
        else
            ee(r);
    } })), pn.janrain.addEventHandler("onCaptureSessionEnded", (function () { var e, r = {}; r.userProvider = a.getProvider().getName(), r.userToken = a.getProvider().getToken() && a.getProvider().getToken().length > 0 ? a.getProvider().getToken() : "", r.noNeedStartCheckout = !0, t && (e = s.getIframe(t)), e && "inline" === e.config.displayMode && s.closeModalContainer(), n = "", t = "", y = !1, ee(r); })), b = !0); }, W = function () { b || (pn.pianoId.setCallbacks({ loggedIn: function (e) { o.log("offer.js - piano id user logged in"); var r = { user_token: e.token, userToken: e.token, user: e.user, reloadAfterLogin: !0, termId: n }; t ? s.getIframe(t) ? (i.send("externalLoginSuccess", r, t), Z(t, r), delete r.termId, ee(r, t)) : ee(r) : ee(r); }, loggedOut: function (e) { if (e.source !== h) {
            var r = {};
            r.userProvider = a.getProvider().getName(), r.userToken = a.getProvider().getToken() && a.getProvider().getToken().length > 0 ? a.getProvider().getToken() : "", r.noNeedStartCheckout = !0, ee(r);
        } n = "", t = ""; } }), b = !0); }; function J(e) { return s.showPreloadedContainer(e); } var G = function (e) { var n = e.offerId === s.fakeOfferId ? "showTemplate" : "showOffer"; S.hasCallback(n) && S.fireCallbacks(n, e, void 0, !0); }, Q = function (e) { [{ queryParam: "promo_code", configParam: "promoCode" }].forEach((function (n) { var t = o.getQueryParamByName(n.queryParam); t.length && (e[n.configParam] = t); })); }, X = function (e) { if (e.offerId || !0 === e.preview) {
        if (function (e) { var n = O(e); return !!m[n]; }(e))
            return !1;
        e.preview || function (e) { var n = O(e); m[n] = !0; }(e), setTimeout((function () { R(e); }), 1e4), o.waitCall("refreshUserToken", (function () { o.waitCall("refreshAccessTokenList", (function () { o.waitCall("myAccountLogin", (function () { var n; if (o.startCall("offerCreate"), e.createIframeFn ? (Q(e), n = e.createIframeFn(e)) : n = L(e), !n)
            return o.doneCall("offerCreate"), void o.error("Could not initialize offer; check configuration"); $(e) && Y(n.iframeId), G(e); })); })); }));
    }
    else
        o.error("Must specify offerId"); }; var $ = function (e) { return !!e.directCheckout && "inline" !== e.displayMode; }, Y = function (e) { o.waitCall("offerCreate", (function () { i.send("startDirectCheckout", {}, e); })); }, K = function (e, n) { if (!function (e) { return !e.offerId && !e.isRedemption && !e.preview; }(e)) {
        var t = S.hasCallback("loginRequired");
        e.isSiteLicensing && t && (te() || re()) ? f.refreshUser(C.iframeId) : (s.hasModalIframe() && s.closeModalContainer(), o.debug("creating checkout: ", e), e.displayMode = "popup" === e.displayMode ? "popup" : "modal", e.isCheckout = !0, e.parent = n, o.waitCall("refreshUserToken", (function () { o.waitCall("refreshAccessTokenList", (function () { var t; o.startCall("offerCreate"), t = e.createIframeFn ? e.createIframeFn(e) : L(e), s.__protected__.addChildToInlineIframe(t, n), t ? w && o.waitCall("offerCreate", (function () { w = !1; var e = {}; e.userProvider = a.getProvider().getName(), a.getProvider().getToken() && a.getProvider().getToken().length > 0 ? e.userToken = a.getProvider().getToken() : e.userToken = "", e.noNeedStartCheckout = !0, e.noNeedStartCheckoutAfterLogin = !0, ee(e, t.iframeId); })) : (o.doneCall("offerCreate"), o.error("Could not start checkout; check configuration")); })); })));
    } }, Z = function (e, n) { i.send("reloadOffer", n, e); }, ee = function (e, n) { i.broadcast("reloadOffer", e, n); }, ne = function (e, n) { var t = { reloadAfterLogin: !0 }; return Object.assign(t, e.config), t.singleContainer && delete t.singleContainer, n.termId && (t.termId = n.termId), n.term && (t.term = {}, t.term = q(t.term, n.term)), n.startScreen && (t.startScreen = n.startScreen), n.isRedemption && (t.isRedemption = n.isRedemption, t.voucherCode = n.redemption && n.redemption.form && n.redemption.form.redeemCode, t.termId = null), n && n.currentState && "modal" === e.config.displayMode && (t.allowReturnToStartState = !0), n.preventExternalLogin && (t.preventExternalLogin = n.preventExternalLogin), n.sharedAccountCode && (t.sharedAccountCode = n.sharedAccountCode), n.isSiteLicensing && (t.isSiteLicensing = n.isSiteLicensing), n.campaignCode && (t.campaignCode = n.campaignCode), n.campaignGroupId && (t.campaignGroupId = n.campaignGroupId), t.displayMode = "modal", t; }, te = function () { return "publisher_user_ref" === a.getProvider().getName(); }, re = function () { return "piano_id_lite" === a.getProvider().getName(); }; return { name: "offer", show: function (e) { "inline" === e.displayMode ? s.operationWithContainer(e.containerSelector, (function () { X(e); })) : X(e); }, deferredShow: function (e) { return function (e) { var n, t, r, i = new Promise((function (e, r) { n = e, t = r; })), a = new Promise((function (e, n) { r = e; })); return "popup" !== e.displayMode && e.offerId ? o.waitCall("refreshAccessTokenList", (function () { var i; e.isPreload = !0, o.startCall("offerCreate"), e.createIframeFn ? (Q(e), i = e.createIframeFn(e)) : i = L(e), i ? (i.element.onload = function () { r(i); }, n(i)) : (o.doneCall("offerCreate"), o.error("Could not initialize offer; check configuration"), t()); })) : t(), { promise: i, show: function () { i.then(J).then((function () { return a; })).then((function (n) { B(n), $(e) && Y(n.iframeId), G(e); }), (function () { X(e), delete e.isPreload; })); } }; }(e); }, close: function () { s.closeModalContainer(); }, closeInline: function (e) { s.__protected__.closeInlineContainers(e); }, startCheckout: K, startRedeemVoucher: function (e, n) { s.closeModalContainer(), e || (e = {}), e.isRedemption = !0, o.debug("starting redeem voucher: ", e), e.displayMode = "popup" === e.displayMode ? "popup" : "modal", e.isCheckout = !1, e.parent = n, o.waitCall("refreshAccessTokenList", (function () { o.startCall("offerCreate"), (e.createIframeFn ? e.createIframeFn(e) : L(e)) || (o.doneCall("offerCreate"), o.error("Could not start redeem; check configuration")); })); }, createOfferIframe: L, showBackdrop: function () { s.showBackdrop(); }, hideBackdrop: function () { s.hideBackdrop(); }, centerBackdrop: function (e) { s.centerBackdrop(e); }, registerCallback: function (e, n) { S.addEvent(e), S.registerCallback(e, n); }, reload: Z, reloadAll: function (e, n) { var t = e || {}; o.waitCall("refreshUserToken", (function () { ee(Object.assign(t, { userToken: pn.user.getProvider().getToken() }), n); })); }, resetUserAndReloadAll: function (e, n) { var t = e || {}; ee(Object.assign(t, { userToken: "" }), n); }, checkThreeDSRedirect: function () { var e = "pn_rurl_3ds", n = o.getQueryParamByName(e); if (n) {
            var t = { offerId: "pn_offer_id", oid: "pn_oid", termId3ds: "pn_term_id", providerId: "pn_provider_id", thirdPartyParams: "third_party_params" }, r = [e], i = Object.keys(t).reduce((function (e, n) { var i = Object.assign({}, e); return i[n] = o.getQueryParamByName(t[n]), r.push(t[n]), i; }), {});
            o.removeQueryParamByName(r), X(Object.assign({ displayMode: "modal", rurl_3ds: n }, i));
        } } }; };
    pn.container.register("offer", { useValue: Ge() }), pn.offer = pn.container.resolve("offer");
    var Qe = function () { var e, n = pn.container.resolve("jqUtils"), t = pn.container.resolve("util"), r = pn.container.resolve("postmessage"), o = pn.container.resolve("offer"), i = pn.container.resolve("user"), a = pn.container.resolve("containerUtils"), s = pn.container.resolve("pianoId"), c = pn.container.resolve("logging"), l = {}, u = !1, d = { loginRequired: [], loginSuccess: [] }, p = function () { return pn.getEndpointRoot() + "/checkout/myaccount/show"; }, f = function (e, n) { e.element.style.height = (e.config.maxHeight ? Math.min(n.height, e.config.maxHeight) : n.height) + "px", e.container.style.height = (e.config.maxHeight ? Math.min(n.height, e.config.maxHeight) : n.height) + "px", e.element.style.width = n.width + "px", "modal" === e.config.displayMode && (e.container.style.width = n.width + "px"), r.send("resized", { height: e.config.maxHeight ? Math.min(n.height, e.config.maxHeight) : n.height, width: n.width }, e.iframeId); }, m = function (t, r, i) { return function () { e && (n.removeClass("tp-active", e), o.hideBackdrop(), window.setTimeout((function () { n.remove(e); }), 250), r.result = i, t(r)); }; }, g = function (e) { var t = n.winSize(); e.offsetHeight > t.height ? (!1 === u && (e.style.position = "absolute", u = !0), e.style.marginTop = window.scrollY - .5 * t.height + "") : (!0 === u && (e.style.position = "fixed", u = !1), e.style.marginTop = 0 - .5 * e.offsetHeight + ""), o.centerBackdrop(e), e.style.marginLeft = 0 - .5 * e.offsetWidth + ""; }, v = function (t, i) { !function (t, r) { var i = document.createElement("div"); n.addClass("tp-modal", i); var a = document.createElement("div"); n.addClass("tp-close", a); var s = document.createElement("div"); n.addClass("tp-message", s), i.style.width = (t.width ? t.width : 400) + "px", s.innerHTML = t.message; var c = document.createElement("div"); n.addClass("tp-btn-container", c); var l = document.createElement("button"); n.addClass("tp-btn", l), n.addClass("tp-ok-btn", l), l.innerHTML = t.ok ? t.ok : "Ok"; var u = document.createElement("button"); n.addClass("tp-btn", u), n.addClass("tp-cancel-btn", u), u.innerHTML = t.cancel ? t.cancel : "Cancel", n.on(a, "click", m(r, t, "cancel")), n.on(u, "click", m(r, t, "cancel")), n.on(l, "click", m(r, t, "ok")), n.append(i, a), n.append(i, s), n.append(c, l), n.append(c, u), n.append(i, c), n.append(document.body, i), o.showBackdrop(), n.addClass("tp-active", i), g(i), e = i; }(i.params, (function (e) { r.send("closeDialog", e, l[i.sender].iframeId); })); }, h = function (e, n) { d[e] = d[e] || [], d[e].push(n); }, w = function (e, n, o) { if (t.debug("received event: " + e, n), void 0 !== d[e]) {
        for (var i = 0; i < d[e].length; ++i) {
            t.debug("firing callback for event: " + e);
            var a = d[e][i](n);
            n && n.resultCallbackId && (n.result = a, n.event = e, r.send("resultCallback", n, o));
        }
        !d[e].length && n && n.resultCallbackId && (n.callbackNotFound = !0, n.event = e, r.send("resultCallback", n, o));
    } }, y = function (e) { switch (t.log("*** My account event received", e.event, e.params), e.event) {
        case "resize":
            t.debug("*** Resize event", e.params.width, e.params.height), f(l[e.sender], e.params), "modal" === l[e.sender].config.displayMode && g(l[e.sender].container);
            break;
        case "loaded":
            r.send("initMaxHeight", { height: l[e.sender].config.maxHeight }, l[e.sender].iframeId), f(l[e.sender], e.params), "pianoId" === i.getProvider().name && s.__protected__.executePostMessagesBatch(), "modal" === l[e.sender].config.displayMode && window.setTimeout((function () { n.addClass("tp-active", l[e.sender].container), g(l[e.sender].container); }), 25);
            break;
        case "cancel":
        case "complete":
        case "error":
        case "loginRequired":
        case "customEvent":
            w(e.event, e.params, e.sender);
            break;
        case "openDialog":
            v(e.event, e);
            break;
        case "pianoIdProfileUpdated":
            s.onProfileUpdate(e.params, (function () { var n = e.params; n && n.resultCallbackId && r.send("resultCallback", n, e.sender); var t = { userToken: e.params.token, user: e.params.user }; b(t); }));
            break;
        case "extendedUserLoginRequired":
            s.onExtendedUserLoginRequired();
            break;
        case "loginSuccess":
            i.getProvider().onLoginSuccess(e.params);
            var o = { reloadAfterLogin: !0, userToken: e.params.user_token, user: e.params.user };
            b(o), w(e.event, e.params, e.sender);
            break;
        case "logout":
            i.logout((function () { var e = {}; e.userProvider = i.getProvider().getName(), e.userToken = i.getProvider().getToken() && i.getProvider().getToken().length > 0 ? i.getProvider().getToken() : "", b(e); })), w(e.event, e.params, e.sender);
            break;
        case "userProfileUpdateSuccess":
            var a = e, c = a.event, u = a.params, d = a.sender;
            i.getProvider().onLoginSuccess(u);
            var p = { userProvider: u.user_provider, userToken: u.user_token };
            for (var m in b(p), w(c, u, d), l)
                if (l.hasOwnProperty(m)) {
                    var h = l[m].config;
                    h.hasOwnProperty("userToken") && delete h.userToken, I(h);
                }
            break;
        case "langChangedWithinMyAccount":
            s.isConfigured() && s.updateLang(e.params.lang);
            break;
        case "requestScrollData":
            k(e.sender);
            break;
        case "downForMaintenance":
            f(l[e.sender], { width: 300, height: 200 });
            break;
        case "removeQueryParamByName":
            Array.isArray(e.params.paramsToRemove) && e.params.paramsToRemove.forEach((function (e) { t.removeQueryParamByName(e); }));
            break;
        case "getTrackingData":
            r.send("getTrackingDataResponseEvent", { pageViewId: pn.main.fetchPageViewId(), tbc: t.getTbcCookie() }, e.sender);
            break;
        default: return void t.log("Received invalid event type: " + e.event);
    } }, b = function (e) { r.broadcast("reloadOffer", e); }, k = function (e) { var n = l[e].element.getBoundingClientRect(), t = { iframeRect: { bottom: n.bottom, height: n.height, left: n.left, right: n.right, top: n.top, width: n.width } }; r.send("returnScrollData", t, e); }; function _(e) { var o = { widget: "myaccount" }; if (e.templateId && (o.templateId = e.templateId), void 0 === e.displayMode)
        e.displayMode = "inline";
    else if ("modal" !== e.displayMode && "inline" !== e.displayMode)
        return void t.log("Invalid offer displayMode; must be one of: modal, inline"); if (o.displayMode = e.displayMode, o.iframeId = t.randomString(16), o.url = window.location.href, o.initialWidth = e.width, o.initialHeight = e.height, o.maxHeight = e.maxHeight, pn.locale && (o.lang = pn.locale), !pn.janrain.isConfigured() || void 0 !== e.loginRequired && e.loginRequired)
        if (!pn.gigya.isConfigured() || void 0 !== e.loginRequired && e.loginRequired)
            if (pn.pianoId.isConfigured()) {
                v = e;
                if (pn.pianoId.setCallbacks({ loggedIn: function (n) { var t; o.userToken !== n.token && (e.loginSuccess && (t = e.loginSuccess(n)), (void 0 === t || t) && (v.userToken = n.token, I(v))); }, loggedOut: function () { var e = {}; e.userProvider = i.getProvider().getName(), e.userToken = i.getProvider().getToken() && i.getProvider().getToken().length > 0 ? i.getProvider().getToken() : "", b(e); } }), void 0 === e.loginRequired || !e.loginRequired) {
                    var s = 0;
                    e.loginRequired = function () { if (++s > 10)
                        t.log("Too many attemps to login for myAccount");
                    else {
                        var e = t.getQueryParamByName("verification_code");
                        pn.pianoId.show({ verificationCode: e });
                    } };
                }
                o.pianoIdUrl = pn.pianoId.getIframeUrl();
                var u = pn.pianoId.getLang();
                u && (o.lang = u), pn.pianoId.onLangChange((function (e) { r.send("langChanged", { lang: e }, o.iframeId); }), o.iframeId);
            }
            else
                pn.pianoIdLite.isConfigured() && (o.pianoIdUrl = pn.pianoId.getIframeUrl());
        else {
            m = [];
            pn.gigya.registerCallback("onHide", (function () { a.activateContainers(m), t.doneCall("myAccountLogin"); })), e.loginRequired = function () { var n = e; t.waitCall("refreshAccessTokenList", (function () { t.waitCall("offerCreate", (function () { t.startCall("myAccountLogin"), m = a.hideModalContainer(), pn.gigya.login((function (t) { var r; e.loginSuccess && (r = e.loginSuccess(t)), (void 0 === r || r) && (n.userToken = t.user_token, I(n)); })); })); })); };
        }
    else {
        var m = [], v = e;
        pn.janrain.addEventHandler("onModalClose", (function () { a.activateContainers(m), t.doneCall("myAccountLogin"); })), pn.janrain.registerCallback("userChanged", (function (n) { var t; n && n.user_token && (e.loginSuccess && (t = e.loginSuccess(n)), (void 0 === t || t) && (v.userToken = n.user_token, I(v))); })), pn.janrain.addEventHandler("onCaptureSessionEnded", (function (n) { var t; e.loginSuccess && (t = e.loginSuccess(n)), (void 0 === t || t) && (v.userToken = null, I(v)); })), e.loginRequired = function () { return t.waitCall("refreshAccessTokenList", (function () { t.waitCall("offerCreate", (function () { t.startCall("myAccountLogin"), m = a.hideModalContainer(), pn.janrain.login(); })); })), !1; };
    } return new Promise((function (a) { t.waitCall("refreshUserToken", (function () { var s, u = {}; if ("inline" === e.displayMode) {
        if (!e.containerSelector)
            return void t.log("My account must have a valid containerSelector");
        if (!(s = n.queryEl(e.containerSelector)))
            return void t.log("My account must have a valid containerSelector");
        o.width = n.getWidth(s);
    }
    else
        s = function () { var e = document.createElement("div"); n.addClass("tp-modal", e); var t = document.createElement("div"); return n.addClass("tp-close", t), n.append(e, t), n.append(document.body, e), e; }(); for (var m in o.pageViewId = pn.main.fetchPageViewId(), o.tbc = t.getTbcCookie(), o.userProvider = i.getProvider().getName(), e.userToken ? o.userToken = e.userToken : o.userToken = i.getProvider().getToken(), d)
        "function" == typeof e[m] && (t.debug("Registering " + m + " callback for iframe " + o.iframeId), h(m, e[m])); o.aid = pn.aid, pn.isSensitiveDataProtectionEnabled && (u = { userToken: o.userToken, iframeId: o.iframeId }, delete o.userToken); var v = p() + "?" + n.param(o), w = document.createElement("iframe"), b = { scrolling: "no", allowtransparency: "true", name: o.iframeId, id: o.iframeId, allow: "payment" }; pn.isSensitiveDataProtectionEnabled || (b.src = v), Object.keys(b).forEach((function (e) { n.setAttr(e, b[e], w); })); var k = { overflow: "hidden", border: "0", height: "0" }; if ("inline" === e.displayMode ? k.width = o.width + "px" : k.width = 0, Object.keys(k).forEach((function (e) { w.style[e] = k[e]; })), l[o.iframeId] = { iframeId: o.iframeId, config: e, element: w, container: s, containerWidth: n.getWidth(s), containerHeight: n.getHeight(s) }, r.init({ postMessageUrl: p(), receive: y, iframe: l[o.iframeId] }), n.on(window, "keyup", (function (e) { })), "modal" === e.displayMode && n.on(window, "resize", (function () { g(s); })), "modal" === e.displayMode ? g(s) : n.empty(s), pn.isSensitiveDataProtectionEnabled) {
        u.iframeSrc = v;
        var _ = C(u);
        n.append(s, w), n.append(s, _), _.submit();
    }
    else
        n.append(s, w); if (n.on(window, "resize", (function () { !function () { for (var e in l) {
        var t = l[e], o = !1, i = n.getWidth(t.container);
        i !== t.containerWidth && (t.element.style.width = i + "", t.containerWidth = i, o = !0);
        var a = n.getHeight(t.container);
        a !== t.containerHeight && (t.element.style.height = a + "", t.containerHeight = a, o = !0), o && r.send("resize", { width: i, height: a }, e);
    } }(); })), "inline" === e.displayMode && window.ResizeObserver) {
        var I = new ResizeObserver((function (e) { var t = n.getWidth(s); t > 0 && f(l[o.iframeId], { width: t }); }));
        I.observe(s), l[o.iframeId].resizeObserver = I;
    } pn.offer && pn.offer.registerCallback("complete", (function () { r.send("refreshNow", {}, o.iframeId); })), a(l[o.iframeId]), c.setTime("myAccountShow"); })); })); } var C = function (e) { var t = document.createElement("form"), r = { id: "form_" + e.iframeId, method: "post", action: e.iframeSrc, target: e.iframeId }; return n.setAttrs(r, t), [{ name: "userToken", value: e.userToken }].forEach((function (e) { var r = document.createElement("input"), o = { type: "hidden", name: e.name }; n.setAttrs(o, r), r.value = e.value, n.append(t, r); })), t; }, I = function (e) { t.waitCall("offerCreate", (function () { t.waitCall("refreshAccessTokenList", (function () { var n; null === (n = _(e)) || void 0 === n || n.then((function (e) { e || t.log("Could not initialize my account; check configuration"); })); })); })); }; return { name: "myaccount", show: I, registerCallback: h }; }();
    pn.container.register("myaccount", { useValue: Qe }), pn.myaccount = pn.container.resolve("myaccount");
    var Xe = function () { var e = pn.container.resolve("jqUtils"), n = pn.container.resolve("util"), t = pn.container.resolve("api"), r = pn.container.resolve("offer"), o = pn.container.resolve("eventUtils").createEventManager(["onCheckoutSuccess", "onMeterExpired", "onMeterError", "onAccessGranted", "onMeterActive", "onMeterInactive", "meterSelector"]), i = { state: "ok", views_left: null, offer_id: "", curtain_template_id: "", reminder_template_id: "", cookie_name: "", cookie_value: "", cookie_expires: "", show_reminder: !1, show_close_button: !1 }, a = function (e, t) { return o.fire(void 0, e, !0, t), !u[e] || "function" != typeof u[e] || (n.debug("_customCaller called with " + e), u[e](t)); }, s = function (n) { (n = n || {}).offerId || (n.offerId = i.offer_id), n.templateId || (n.templateId = i.curtain_template_id), n.displayMode || (n.displayMode = u.displayMode), n.containerSelector || (n.containerSelector = u.containerSelector), n.showCloseButton || (n.showCloseButton = i.show_close_button), "function" === e.type(u.close) && (n.close = u.close), "function" === e.type(u.loginRequired) && (n.loginRequired = u.loginRequired), "function" === e.type(u.customEvent) && (n.customEvent = u.customEvent), "function" === e.type(u.onCheckoutSuccess) && (n.complete = u.onCheckoutSuccess), r.createOfferIframe(n); }, c = function (e) { if (a("___onProcessMeter", e), !e.user_meter)
        return n.log("Could not load meter", e), void a("onMeterError", e); if ((i = e.user_meter) && i.cookie_name && i.cookie_value && i.cookie_expires) {
        var t = { path: "/", expires: i.cookie_expires };
        i.cookie_domain && (t.domain = i.cookie_domain), n.__protected__.setCookie(i.cookie_name, i.cookie_value, t);
    } "ok" === i.state ? function (e) { n.debug("_handleMeterActive", e), e.show_reminder && e.reminder_template_id && e.track_page_view && a("onShowOffer", e) && s({ templateId: e.reminder_template_id }), a("onMeterActive", e); }(i) : "ap" === i.state ? function (e) { n.debug("_handleAccessGranted", e), a("onAccessGranted", e); }(i) : "ia" === i.state ? function (e) { n.debug("_handleMeterInactive", e), a("onMeterInactive", e); }(i) : function (e) { n.debug("_handleExpired", e), a("onMeterExpired", e), e.track_page_view && a("onShowOffer", e) && s(); }(i); }, l = function (e, r, o) { if (null !== u.paywallId && "" !== u.paywallId) {
        var i = document.URL;
        e && "function" == typeof e.getAttribute && e.getAttribute("href") ? i = e.getAttribute("href") : e && "function" == typeof e.attr && e.attr("href") && (i = e.attr("href"));
        var a = u.trackPageview;
        a && delete u.trackPageview;
        var s = u.meterSelector();
        s || (s = "");
        var l = { paywall_id: u.paywallId, url: encodeURI(i), referer: encodeURI(u.referer), track_page_view: a, meter_name: s, pageview_id: pn.main.fetchPageViewId() };
        r && (l.transaction_id = r), u.referer = "";
        var d = n.__protected__.getCookie("umc");
        if (d)
            l.umc = d;
        else {
            var p = n.__protected__.getCookie("umc_" + u.paywallId);
            p && (l.umc = p);
        }
        t.callApi("/anon/meter/load", l, (function (e) { c(e), "function" == typeof o && o(); }));
    }
    else
        n.debug("You must specify a paywallId in your configuration"); }, u = { paywallId: null, trackPageview: !0, trackExternalReferrer: !0, referer: document.referrer, offerURL: "", displayMode: "modal", containerSelector: "", onCheckoutSuccess: function () { }, onMeterExpired: function () { }, onMeterError: function () { }, onAccessGranted: function () { }, onMeterActive: function () { }, onMeterInactive: function () { }, meterSelector: function () { } }; return { name: "meter", init: function (e) { if (void 0 !== e)
            if (void 0 !== e.paywallID || void 0 !== e.paywallId) {
                for (var t in void 0 === e.paywallId && (e.paywallId = e.paywallID), e)
                    u[t] = e[t];
                u.referer = document.referrer, n.debug("Initializing paywall: " + u.paywallId), l();
            }
            else
                n.error("Must specify paywallId to load Piano paywall");
        else
            n.error("Must specify paywall configuration to load Piano paywall"); }, isExpired: function () { return i.state && "ex" === i.state; }, isExpiredNextClick: function () { return void 0 !== i.views_left && 0 === i.views_left; }, checkMeter: function (e) { u.trackPageview = !0, l(e); }, showCurtain: s, last: function () { return i; }, registerCallback: function (e, n) { o.addEvent(e), o.registerCallback(e, n); } }; }();
    pn.container.register("meter", { useValue: Xe }), pn.meter = pn.container.resolve("meter");
    var $e = function () { var e = pn.container.resolve("util"), n = pn.container.resolve("sha1"), t = "", r = function () { var e = ""; return ["ShockwaveFlash.ShockwaveFlash.6", "ShockwaveFlash.ShockwaveFlash.7", "SWCt1.SWCt1.9", "SWCtl.SWCtl", "Adobe.SVGCtl", "WMPlayer.OCX", "AgControl.AgControl", "AcroPDF.PDF", "PDF.PdfCtrl", "RealPlayer.RealPlayer(tm) ActiveX Control (32-bit)", "RealPlayer", "Skype.Detection", "3dmlw.IEPlugin", "GoogleTalk.Plugin", "GoogleTalk.Plugin.1"].map((function (n) { try {
        new window.ActiveXObject(n), e += n + "|";
    }
    catch (e) { } })), e; }, o = function () { if (t)
        return t; var o = function () { try {
        var e;
        return e = window.navigator.userLanguage || window.navigator.language, (new Date).getTimezoneOffset() + ":" + e;
    }
    catch (e) {
        return "";
    } }(); return o += function () { if (window.ActiveXObject)
        return r(); try {
        var e = "", n = navigator.plugins.length;
        if (n > 0)
            for (var t = 0; t < n; t++)
                e += navigator.plugins[t].name + "|";
        return e;
    }
    catch (e) {
        return "";
    } }(), o += function () { try {
        return screen.height + "x" + screen.width + "+" + screen.colorDepth;
    }
    catch (e) {
        return "";
    } }(), o += navigator.userAgent, o += function () { var e = ""; try {
        e += document.getElementById ? 1 : 0, e += window.getComputedStyle ? 1 : 0, e += screen.globalStorage ? 1 : 0, e += window.localStorage ? 1 : 0, e += window.sessionStorage ? 1 : 0, e += document.getElementsByClassName ? 1 : 0, e += document.querySelector ? 1 : 0, e += document.all ? 1 : 0, e += window.attachEvent ? 1 : 0, e += window.createPopup ? 1 : 0, e += window.XMLHttpRequest ? 1 : 0, e += window.ActiveXObject ? 1 : 0, e += window.XDomainRequest ? 1 : 0, e += window.msPerformance ? 1 : 0, e += document.documentMode ? 1 : 0, e += navigator.cpuClass ? 1 : 0, e += navigator.browserLanguage ? 1 : 0, e += window.opera ? 1 : 0, e += window.chrome ? 1 : 0;
    }
    catch (e) { } return e; }(), t = n.hash(o), e.debug("Current browser fingerprint is: " + t), t; }; return o(), { name: "fingerprint", getFingerprint: o }; }();
    pn.container.register("fingerprint", { useValue: $e }), pn.fingerprint = pn.container.resolve("fingerprint");
    var Ye = function () { var e, n = pn.container.resolve("jqUtils"), t = 0, r = 0, o = 200, i = 0, a = []; n.on(window, "scroll", (function () { c(); })); var s = function () { var e = n.scrollTop(); e > i && (i = e); }, c = function () { s(), u(); }, l = function (e) { if (e.consumeEventFn())
        return "pixels" === e.measureType ? e.position <= i : "percentage" === e.measureType ? i / (t - n.winSize().height) >= e.position / 100 : void 0; }, u = function () { for (var e, n = [], t = [], r = 0; r < a.length; r++)
        e = a[r], l(e) ? n.push(e) : t.push(e); a = t; for (r = 0; r < n.length; r++)
        n[r].callback(); }; return { name: "scrollDepth", initialize: function (i) { var a = document; i && i > 0 && (o = i || o); var s = function () { var i = a.body || {}, c = a.documentElement || {}, l = Math.max(i.scrollHeight, c.scrollHeight, i.offsetHeight, c.offsetHeight, i.clientHeight, c.clientHeight); l > t && (t = l); var u = n.scrollTop() + n.winSize().height; u > r && (r = u) > t && (t = r), e && clearTimeout(e), e = setTimeout(s, o); }; s(); }, getMaxScrollDepth: function () { return r; }, getMaxDocumentHeight: function () { return t; }, addListener: function (e, n, t) { "function" != typeof t && (t = function () { return !0; }), a.push({ callback: e, position: n.scrollDepth, measureType: n.measureType, repeat: "once", consumeEventFn: t }), s(), u(); }, removeListeners: function () { a = []; }, clearMaxScrolledPosition: function () { i = 0; } }; }();
    pn.container.register("scrollDepth", { useValue: Ye }), pn.scrollDepth = pn.container.resolve("scrollDepth");
    var Ke = function () { var e, n = pn.container.resolve("util"), t = pn.container.resolve("jqUtils"), r = !1, o = []; function i() { r || (r = !0, t.on(document, "mousemove", (function () { return s(); })), t.on(document, "keypress", (function () { return s(); })), t.on(window, "scroll", (function () { return s(); }))); } function a() { o.length && function () { for (var e, t, r = [], i = [], a = Date.now(), s = 0; s < o.length; s++)
        t = !1, a - (e = o[s]).startTime >= e.idleTime && (e.consumeEventFn() ? t = !0 : e.startTime = a), t ? r.push(e) : i.push(e); r.length && n.debug("idle: run fire"); o = i; for (s = 0; s < r.length; s++)
        (e = r[s]).callback(); }(), e && clearTimeout(e), o.length && (e = setTimeout((function () { return a(); }), 200)); } function s() { for (var n = Date.now(), t = 0; t < o.length; t++)
        o[t].startTime = n; clearTimeout(e), o.length && (e = setTimeout((function () { return a(); }), 200)); } return { name: "idle", initialize: i, addListener: function (n, t, r) { i(), "function" != typeof r && (r = function () { return !0; }), o.push({ callback: n, idleTime: 1e3 * t, startTime: Date.now(), consumeEventFn: r }), e || (e = setTimeout((function () { return a(); }), 200)); }, removeListeners: function () { o = []; } }; }();
    pn.container.register("idle", { useValue: Ke }), pn.idle = pn.container.resolve("idle");
    var Ze = function () { var e = pn.container.resolve("util"), n = pn.container.resolve("jqUtils"), t = []; return { name: "interaction", bind: function (r, o, i) { var a = function (e) { for (var n = { click: "click", doubleClick: "dblclick", rightClick: "contextmenu", mouseOut: "mouseout", mouseIn: "mouseover" }, t = [], r = 0; r < e.length; r++) {
            var o = e[r];
            t.push(n[o]);
        } return t; }; "function" != typeof i && (i = function () { return !0; }), e.__protected__.documentReady((function () { for (var e = 0; e < o.length; e++) {
            var s = o[e], c = a(s.elementActions).join(" "), l = s.elementSelector, u = s.repetitive;
            c.trim().length && function (e, o, a) { var s = function () { i() && (a || n.undelegate(document.body, e), r()); }; n.delegate(document.body, e, o, s), t.push({ action: c, selector: l, func: s }); }(l, c, u);
        } })); }, unbindAll: function () { t.forEach((function (e) { n.undelegate(document.body, e.selector); })), t = []; } }; }();
    pn.container.register("interaction", { useValue: Ze }), pn.interaction = pn.container.resolve("interaction");
    var en = function () { var e = pn.container.resolve("jqUtils"), n = pn.container.resolve("util"), t = pn.container.resolve("containerUtils"), r = function (e) { return "inline" === e.displayMode; }, o = function (e) { return "modal" === e.displayMode; }; return { name: "recWidgetService", __protected__: { getInstance: function () { var i, a = []; function s(n) { var s = n || {}, c = s.widget || {}; r(c.config) ? e.empty(c.container) : o(c.config) && (!function (n) { if (!i)
                return; t.closeModal(i), e.empty(i.container); var r = t.__private__.mobileModalFix; r.isIphoneCaretFixed && r.modalClosed(); i = null; }(), e.remove(c.container)), !s.skipOnclose && e.isFunction(c.onclose) && c.onclose(), a = a.filter((function (e) { return e.uuid !== c.uuid; })); } function c(e) { return a.filter((function (n) { return e === n.widgetId; }))[0]; } return { showRecommendation: function (l) { var u = l.widgetConfig || {}, d = l.createPlaceholderFn, p = u.widgetId; if (!p)
                    throw new Error("widgetId should be specified"); if (c(p))
                    n.log("widget with id " + u.widgetId + " already initialize");
                else if (o(u) && i)
                    n.log("modal widget already shown");
                else {
                    var f = function (t) { var r = e.queryEl(t.containerSelector), o = "widget-id-" + n.randomString(), i = { singleContainer: r || void 0, displayMode: t.displayMode || "modal", showCloseButton: t.showCloseButton, iframeParams: { iframeId: o, containerSelector: t.containerSelector, width: t.width, height: t.height } }; return { uuid: o, widgetId: t.widgetId, placeholder: t.placeholder, trackingId: t.trackingId, config: i }; }(u), m = f.config, g = d();
                    if (f.container = function (e, n) { var i; return r(e) ? i = t.initInlineContainer(e).container : o(e) && (i = t.getModalContainer(e, (function () { n instanceof Function && n(); }))), i; }(m, (function () { s({ widget: f }); })), f.container)
                        return e.append(f.container, g), f.element = g, o(m) && (i = f, (n.isIphone() || n.isSafariOrIOsUiWebView() || n.isAndroid()) && t.__private__.mobileModalFix.modalOpened()), function (n, t) { void 0 === t && (t = {}), Object.keys(t).forEach((function (r) { e.isFunction(t[r]) && (n[r] = t[r](n)); })); }(f, l.widgetCallbacks), a.push(f), f;
                    n.log('widget has invalid selector "' + m.iframeParams.containerSelector + '"');
                } }, fireWidgetCallback: function (n, t, r) { a.forEach((function (o) { if (o.widgetId === t.toString()) {
                    var i = o["on" + n];
                    e.isFunction(i) && i(r);
                } })); }, findWidget: c, clearWidgets: function () { a = [], i = null; }, closeWidget: s, fixWidgetModalWidth: function (n, r) { if (!n || o(n.config)) {
                    var i = n.container, a = r ? e.queryEl("iframe", i) : e.queryEl(".tp-widget-placeholder", i);
                    t.checkBackdropAndContainer(n, !0, !0), setTimeout((function () { a && t.__protected__.setElementSizes(i, { width: e.getWidth(a) }); }), 100);
                } } }; }, insertWidgetLib: function (n) { var t = document.getElementsByTagName("script")[0], r = document.createElement("script"); n.id && r.setAttribute("id", n.id), e.isFunction(n.onerror) && (r.onerror = n.onerror), e.isFunction(n.onload) && (r.onload = n.onload), n.defer && (r.defer = !0), r.type = "text/javascript", r.src = n.src, t && t.parentNode && t.parentNode.insertBefore(r, t); } } }; }();
    pn.container.register("recWidgetService", { useValue: en }), pn.recWidgetService = pn.container.resolve("recWidgetService");
    var nn = function () { pn.container.resolve("predefinedOptions"); return { testPianoOption: "" }; }();
    pn.container.register("piano", { useValue: nn });
    var tn = pn.container.resolve("piano");
    for (var rn in tn)
        pn[rn] = tn[rn];
    var on = function (e) { void 0 === e && (e = pn.container); var n = e.resolve("util"), t = e.resolve("log"), r = e.resolve("user"); e.resolve("api"); var o, i = e.resolve("jqUtils"), a = e.resolve("recWidgetService"), s = "__pnml", c = "EXTERNAL_EVENT", l = { granted: "ALLOWED", default: "UNKNOWN", denied: "FORBIDDEN" }, u = a.__protected__.getInstance(); function d() { return o || (o = new Promise((function (e, t) { var r = window.PianoESPConfig || {}; r.id ? (Object.assign(r, { onload: function () { return e(null); }, widget_init_on_event: { rec: !0, "opt-in": !1 }, onclick: function (e) { u.fireWidgetCallback("click", e.widgetId, e); }, onwidgetinit: function (e) { u.fireWidgetCallback("init", e.widgetId, e); }, onrecsloaded: function (e) { u.fireWidgetCallback("recsloaded", e.widgetId, e); } }), window.PianoESPConfig = r, n.debug("pianoESP: loading PianoESP with config:", window.PianoESPConfig), a.__protected__.insertWidgetLib({ id: "pnesplucidsdksel", src: p() + "/public/sdk/v04/sdk.js?v=" + (localStorage && localStorage.lucidsdkver || "xxx"), onerror: function () { return t(); } })) : t(); }))); } setTimeout((function () { pn.addHandler("logout", (function () { m([]); })); var e = r.getProvider(); e.registerCallback && e.registerCallback("logout", (function () { m([]); })); }), 300); var p = function () { var e = "//api-esp.piano.io"; return pn.espEndpoint ? e = pn.espEndpoint : pn.isSandbox() && (e = "//sandbox-api-esp.piano.io"), e; }, f = function (e, r) { d().then((function () { window.PianoESP.getCurrentPushState().then((function (e) { "prompt" === e && t.logMicroConversion(r, "showPrompt"); })), window.PianoESP.subscribeToPushSquads([e]).then((function (o) { var i = o || {}; !0 === i.result ? (n.setPushListsCookie(e), n.debug("pianoESP: Push notification was set:", i), t.logMicroConversion(r, "enrollPushCampaign")) : !1 === i.result && ("closed" === i.reason ? t.logMicroConversion(r, "closePrompt") : t.logMicroConversion(r, "declineEnrollPushCampaign")); })).catch((function (e) { n.log("pianoESP: Push notification error:", e); })); })); }, m = function (e) { try {
        var t = JSON.stringify(e);
        localStorage.setItem(s, t);
    }
    catch (e) {
        n.debug("can't save mailing lists to storage", e);
    } }, g = function () { var e = []; try {
        var t = localStorage.getItem(s);
        if (!t)
            throw new Error("MAINLING_LIST should be array");
        if (e = JSON.parse(t), !Array.isArray(e))
            throw new Error("MAINLING_LIST should be array");
    }
    catch (e) {
        n.debug("can't load mailing lists from storage", e);
    } return e || []; }; var v = function (e) { return function () { var n = document.createElement("pnespwgtplaceholder"); return i.setAttr("holdername", e, n), n; }; }; function h() { return { onrecsloaded: function (e) { return function (r) { 0 !== r.countOfRecs ? (u.fixWidgetModalWidth(e, !0), t.logEspMicroConversion(e.trackingId, e.widgetId, "init", c), n.debug("creating recommendation widget: ", e.config)) : u.closeWidget({ widget: e, skipOnclose: !0 }); }; }, onclick: function (e) { return function (n) { var r = { href: n.url }; t.logEspMicroConversion(e.trackingId, e.widgetId, "click", "EXTERNAL_LINK", r); }; }, onclose: function (e) { return function () { t.logEspMicroConversion(e.trackingId, e.widgetId, "close", c, { event: "widgetClosed" }); }; } }; } return { name: "pianoEsp", __protected__: { init: d, setVisitorId: function (e) { window.PianoESPConfig = Object.assign({}, window.PianoESPConfig, { visitor: e }); }, showRecommendation: function (e) { var n = h(); return u.showRecommendation({ widgetConfig: e, widgetCallbacks: n, createPlaceholderFn: v(e.placeholder) }), d().then((function () { window.PianoESP.initWidget(parseInt(e.widgetId)); })); }, showPushSignup: function (e) { var n = e || {}; n.templateId ? (t.__protected__.logCustomFormImpression(n.trackingId, "pushSignup", "show_form"), pn.template.show({ templateId: n.templateId, templateVariantId: n.templateVariantId, displayMode: "modal", customEvent: function (e) { switch (e.eventName) {
                    case "push-allow":
                        t.logMicroConversion(n.trackingId, "allowSoftEnrollPushCampaign"), f(n.pushListId, n.trackingId);
                        break;
                    case "push-dont-allow":
                        t.logMicroConversion(n.trackingId, "declineSoftEnrollPushCampaign");
                        break;
                    case "push-close": t.logMicroConversion(n.trackingId, "close");
                } } })) : f(n.pushListId, n.trackingId); }, getNotificationStatus: function () { if (window.Notification)
                return l[window.Notification.permission] || l.default; }, showNewsletterSignup: function (e) { if (e && e.mailingListIds) {
                var t = g().indexOf(e.mailingListIds) > -1;
                e.notShowIfFilled && t ? n.log("Mailing list with ids " + e.mailingListIds + " already shown") : pn.template.show(e);
            }
            else
                n.log("mailingListIds should be specified"); }, offerMessageReceiver: function (e) { if ("newsletterSignupSubmission" === e.event) {
                var n = g();
                -1 === n.indexOf(e.params.mailingListIds) && (n.push(e.params.mailingListIds), m(n));
            } }, loadCompleteMailingLists: g }, __private__: { removeWidgetsAndSdk: function () { u.clearWidgets(), o = null, delete window.PianoESP; }, getWidgetCallbacks: h, onInit: function (e) { o && "function" == typeof e && o.then(e); } } }; };
    pn.container.register("pianoEsp", { useValue: on() }), pn.pianoEsp = pn.container.resolve("pianoEsp");
    var an = function () { var e, n = pn.container.resolve("postmessage"), t = pn.container.resolve("user"), r = pn.container.resolve("util"), o = pn.container.resolve("eventUtils"), i = "externalCheckoutComplete", a = "loginPrompt", s = "deferredAccountCreation", c = "buy", l = o.createEventManager([i]), u = !1, d = !1; window.SWG = window.SWG || [], window.SWG.push((function (n) { n.setOnPaymentResponse((function (n) { d || (r.debug("swg: onPaymentResponse is triggered"), d = !0, n.then((function (n) { r.debug("swg: onPaymentResponse", n), e && g(n, n.purchaseData, n.userData, e, c); })).catch((function (e) { r.log("swg: onPaymentResponse failed", e); }))); })); })), n.subscribe("swgCheckoutStart", (function (n) { u || r.log("swg: incorrect SwG configuration. Please make sure that Experience user segment is configured properly. Details at https://docs.piano.io/subscribe-with-google/#SwGscript"); var t = n.params.sku; e = n.params.termId, window.SWG.push((function (e) { e.subscribe(t); })); })); var p = function (e) { if (l.hasCallback(i)) {
        var n = { type: "swg", flow: e };
        l.fireCallbacks(i, n, void 0, !0);
    } }, f = function (e) { return new Promise((function (n, t) { pn.api.callApi("/swg/check", { entitlement: JSON.stringify(e) }, (function (e) { 0 !== e.code && (r.log("swg: check subscription response - " + e.message), t()), n(e.CheckSubscriptionResponse); })); })); }, m = function (e) { return new Promise((function (n, t) { pn.api.callApi("/swg/check/external", { entitlements: JSON.stringify(e) }, (function (e) { 0 !== e.code && (r.log("swg: check external entitlement response - " + e.message), t()); var o = e.data; o || (r.log("swg: check external entitlement empty response"), t()), n(o); })); })); }, g = function (e, t, o, i, a) { pn.api.callApi("/swg/subscribe", { term_id: i, purchase_data: JSON.stringify(t), user_data: JSON.stringify(o) }, (function (t) { if (0 === t.code) {
        var o = t.data;
        v(o), n.broadcast("swgCheckoutComplete"), e.complete().then((function () { p(a); })).catch((function (e) { r.log("swg: complete failed:", e); }));
    }
    else
        r.log("swg: subscribe response - " + t.message); })); }, v = function (e) { e && t.getProvider().loginByToken && t.getProvider().loginByToken(e); }, h = !1, w = !1; return { name: "swg", __protected__: { injectMarkup: function (e) { var n; if (!h && e) {
                r.debug("swg: rendering swg markup with config:", e);
                var t = '{\n   "@context": "http://schema.org",\n   "@type": "CreativeWork",\n   "isAccessibleForFree": ' + e.isAccessibleForFree;
                !1 === e.isAccessibleForFree && e.productId && (t = t + ',\n   "isPartOf": {\n       "@type": ["CreativeWork", "Product"],\n       "name" : "' + e.resourceName + '",\n       "productID": "' + e.productId + '"\n   }'), t += "\n}";
                var o = document.createElement("script");
                o.type = "application/ld+json", o.innerHTML = t, null === (n = document.getElementsByTagName("script")[0].parentNode) || void 0 === n || n.appendChild(o), h = !0;
            } }, addLibrary: function () { var e; if (!w) {
                r.debug("swg: adding swg.js library");
                var n = document.createElement("script");
                n.type = "text/javascript", n.setAttribute("subscriptions-control", "manual"), n.async = !0, n.src = "https://news.google.com/swg/js/v1/swg.js", null === (e = document.getElementsByTagName("script")[0].parentNode) || void 0 === e || e.appendChild(n), w = !0;
            } }, initSwgFlow: function () { window.SWG.push((function (e) { e.getEntitlements().then((function (n) { if (u = !0, r.debug("swg: getEntitlements", n), n.enablesThis()) {
                var o = n.getEntitlementForSource("google");
                if (!o) {
                    var i = n.entitlements;
                    return void (i && m(i).then((function () { r.debug("swg: checkExternalEntitlement"), n.ack(); }), (function () { r.log("swg: checkExternalEntitlement failed"); })));
                }
                f(o).then((function (o) { if (d)
                    r.debug("swg: onPaymentResponse is already triggered. Skipping entitlements flow.");
                else if (o)
                    switch (o.type) {
                        case "USER_FOUND":
                            if (t.isUserValid())
                                return void r.error("swg: user found, but not valid");
                            r.debug("swg: user found, initiate login prompt");
                            var i = o.user_token;
                            e.showLoginPrompt().then((function () { v(i), p(a); })).catch((function (e) { r.log("swg: showLoginPrompt failed", e); }));
                            break;
                        case "TERM_FOUND":
                            r.debug("swg: term found, initiate deferred account creation");
                            var c = o.term_id;
                            e.completeDeferredAccountCreation({ entitlements: n, consent: !0 }).then((function (e) { r.debug("swg: completeDeferredAccountCreation", e), g(e, e.purchaseData, e.userData, c, s); })).catch((function (e) { r.log("swg: completeDeferredAccountCreation failed", e); }));
                            break;
                        default: r.debug("swg: check subscription response type " + o.type + ". Nothing to do");
                    } }), (function () { r.log("swg: checkSubscription failed"); })), n.ack();
            } })).catch((function (e) { r.log("swg: get entitlements failed", e); })); })); } }, registerCallback: function (e, n) { l.addEvent(e), l.registerCallback(e, n); } }; }();
    pn.container.register("swg", { useValue: an }), pn.swg = pn.container.resolve("swg");
    var sn = function () { var e = pn.container.resolve("util"), n = !1, t = function (t, r, o) { n ? (o || (o = {}), e.log("fbpixel: Track Facebook Pixel event", r, o), window.fbq(t, r, o)) : e.log("fbpixel: Skip tracking event - Facebook Pixel is not initalized", r, o); }, r = function () { return n; }; return { name: "fbpixel", isInitialized: r, __private__: { isInitialized: r }, __protected__: { init: function () { if (!n) {
                var t, r, o, i, a, s, c = pn.getFbPixelId();
                if (c)
                    e.log("fbpixel: Initialize Facebook Pixel tracking", c), t = window, r = document, o = "script", t.fbq || (i = t.fbq = function () { i.callMethod ? i.callMethod.apply(i, arguments) : i.queue.push(arguments); }, t._fbq || (t._fbq = i), i.push = i, i.loaded = !0, i.version = "2.0", i.queue = [], (a = r.createElement(o)).async = !0, a.src = "https://connect.facebook.net/en_US/fbevents.js", (s = r.getElementsByTagName(o)[0]).parentNode.insertBefore(a, s)), window.fbq("set", "autoConfig", "false", c), window.fbq("init", c), n = !0;
                else
                    e.error("fbpixel: Facebook Pixel ID is not defined");
            } } }, trackEvent: function (e, n) { t("track", e, n); }, trackCustomEvent: function (e, n) { t("trackCustom", e, n); } }; }();
    pn.container.register("fbpixel", { useValue: sn }), pn.fbpixel = pn.container.resolve("fbpixel");
    var cn = function () { var e = pn.container.resolve("util"), n = pn.container.resolve("fbpixel"), t = pn.container.resolve("offer"), r = pn.container.resolve("user"), o = pn.container.resolve("api"), i = !1, a = "", s = {}, c = {}; function l(n) { return new Promise((function (t) { var i = { aid: pn.aid, rid: "", account_linking_token: e.getQueryParamByName("account_linking_token"), user_token: r.getProvider().getToken(), user_provider: r.getProvider().getName() }; n && (i.rid = n), o.callApi("/fbia/subscriptionPayload/generate", i, (function (e) { e && e.data && (a = e.data), t(null); })); })); } var u = function () { l().then((function () { a && p(); })); }, d = function (n) { if (n) {
        var t = new Promise((function (e) { setTimeout((function () { e(null); }), 1e3 * pn.redirectToFbTimeout); })), r = l(n);
        e.__protected__.waitAllPromises([t, r]).then((function () { p(); }));
    }
    else
        e.error("fbsubscriptions: 'rid' could not be empty on generating subscription payload"); }, p = function () { var n = e.getQueryParamByName("account_linking_token"), t = e.getQueryParamByName("redirect_uri") + "?account_linking_token=" + encodeURIComponent(n); a && (t += "&subscription_payload=" + encodeURIComponent(a)), window.location.href = t; }, f = function (e, t) { s[e] || (s[e] = !0, n.trackEvent(e, t)); }, m = function (e, t) { c[e] || (c[e] = !0, n.trackCustomEvent(e, t)); }, g = function () { return i; }; return { name: "fbsubscriptions", checkUserAccessAndRedirectToFb: function () { l().then((function () { p(); })); }, isInitialized: g, __private__: { isInitialized: g }, __protected__: { init: function () { if (!i) {
                n.__protected__.init(), t.registerCallback("loaded", (function () { var n = e.getQueryParamByName("surface"); "meter_limit_reached" !== n && "locked_article" !== n || pn.inappBrowserReturn || m("ViewPaywall", { surface: "IA" }); }));
                pn.addHandler("loginSuccess", (function (e) { l().then((function () { e.registration ? m("CreateAccount") : m("LogIntoAccount", { is_subscriber: !!a }), a && setTimeout((function () { p(); }), 200); })); })), pn.addHandler("experienceExecute", (function () { r.isUserValid() && u(); })), t.registerCallback("alreadyPurchased", (function (e) { d(e.rid); })), t.registerCallback("startCheckout", (function (e) { f("InitiateCheckout", { offer_code: e.offerId, campaign_code: e.termId }); })), t.registerCallback("complete", (function (e) { e.hasOwnProperty("chargeCurrency") && e.hasOwnProperty("chargeAmount") && f("Purchase", { currency: e.chargeCurrency, value: e.chargeAmount, offer_code: e.offerId, campaign_code: e.termId }), d(e.rid); })), t.registerCallback("close", (function () { p(); })), i = !0;
            } } } }; }();
    pn.container.register("fbsubscriptions", { useValue: cn }), pn.fbsubscriptions = pn.container.resolve("fbsubscriptions");
    var ln = function (e) { void 0 === e && (e = pn.container); var n = e.resolve("jqUtils"), t = e.resolve("util"), r = e.resolve("recWidgetService").__protected__.getInstance(), o = [], i = function () { return void 0 !== pn.cxCdnUrl && "" !== pn.cxCdnUrl ? pn.cxCdnUrl : "https://cdn.cxense.com"; }, a = function () { return void 0 !== pn.cxenseSiteId && "" !== pn.cxenseSiteId; }, s = function (e) { return void 0 !== window.cX && void 0 !== window.cX.library && (e || void 0 !== window.cX.CCE && void 0 !== window.cX.CCE.library); }, c = function (e) { return void 0 !== e.cxenseCustomerPrefix && "" !== e.cxenseCustomerPrefix; }, l = function (e) { var n, r, o = window.cX = window.cX || {}; o.callQueue = o.callQueue || []; var i = "anon"; e.uid && "anon" !== e.uid && "" !== e.uid && (i = !!(null === (r = null === (n = e.eventExecutionContext) || void 0 === n ? void 0 : n.accessList) || void 0 === r ? void 0 : r.length) ? "hasActiveAccess" : "registered", o.callQueue.push(["addExternalId", { id: e.uid, type: e.cxenseCustomerPrefix }]), t.debug("c1x: adding externalId", { uid: e.uid, prefix: e.cxenseCustomerPrefix })); o.callQueue.push(["setCustomParameters", { userState: i }]), t.debug("c1x: adding CustomParameters userState", { userState: i }), d(!1, e.browserId, e.pageViewId, pn.cxenseSiteId), t.debug("c1x: sending pageview event"), o.callQueue.push(["sendPageViewEvent"]); }, u = function (e, n, t, r) { t && (!0 === r ? e.callQueue.unshift([n, t]) : e.callQueue.push([n, t])); }, d = function (e, n, r, o) { var i = window.cX = window.cX || {}; i.callQueue = i.callQueue || [], u(i, "setSiteId", o, e), n && u(i, "invoke", (function () { window.cXNative = { getUserId: function () { return n; } }; }), e), u(i, "setRandomId", r, e), t.debug("c1x: injecting ids", { browserId: n, pageViewId: r, siteId: o }); }, p = function (e) { var n = null, t = []; function r() { n && clearTimeout(n), n = null, e(t), t = []; } return function (e) { n || (n = setTimeout(r, 10)), t.push(e); }; }((function (e) { if (a()) {
        for (var n = [], i = function () { var t = e[s] || {}; r.showRecommendation({ widgetConfig: t, createPlaceholderFn: f(t.widgetId, t.displayMode) }) && n.push({ widgetParams: { widgetId: t.widgetId, targetElementId: "cxense-" + t.widgetId, experienceId: t.experienceId }, widgetCallback: function (e) { var n = e && e.response; if (n && !e.response.error) {
                "modal" === t.displayMode && r.fixWidgetModalWidth(r.findWidget(t.widgetId));
                for (var i = 0; i < n.items.length; i++) {
                    var a = n.items[i].id;
                    -1 === o.indexOf(a) && o.push(a);
                }
            } } }); }, s = 0; s < e.length; s++)
            i();
        m((function () { var e; e = pn.cxenseSiteId, t.debug("c1x: setting siteId: ", e), window.cX.setSiteId(e), window.cX.CCE.runMulti(n, ["id"], o); }));
    }
    else
        t.debug("c1x: can not show recommendation because siteId is not configured using `setCxenseSiteId`"); })), f = function (e, t) { return function () { var r = document.createElement("div"); n.addClass("tp-cxense-placeholder-" + t, r), n.addClass("tp-widget-placeholder", r); var o = document.createElement("div"); return o.id = "cxense-" + e, r.appendChild(o), r; }; }, m = function (e) { window.cX = window.cX || {}, window.cX.CCE = window.cX.CCE || {}, window.cX.CCE.callQueue = window.cX.CCE.callQueue || [], window.cX.CCE.callQueue.push(["invoke", e]); }, g = function (e) { return s(e); }; return { name: "cxense", __protected__: { showRecommendation: p, sendPageViewEvent: function (e) { (a() || c(e)) && (a() || !c(e) ? !a() || c(e) ? l(e) : t.debug("cxense: can not send pageview because customer prefix is not configured in app settings") : t.debug("cxense: can not send pageview because siteId is not configured using `setCxenseSiteId`")); }, isActivated: a, isCustomerPrefixConfigured: c, isConfiguredPollingAsync: function (e, n, t) { n = n || 0, t = t || 0; var r = 0; return new Promise((function (o, i) { var a = function () { g(e) ? o(!0) : r >= t ? i(e ? "c1x: cX object is not found after " + t + " retries with " + n + "ms interval" : "c1x: cX and cX.CCE objects are not found after " + t + " retries with " + n + "ms interval") : (r++, setTimeout(a, n)); }; g(e) ? o(!0) : setTimeout(a, n); })); }, invokeCxenseFn: m, getC1XIntegrationVersion: function () { return void 0 !== pn.c1XIntegrationVersion && "" !== pn.cxenseSiteId ? pn.c1XIntegrationVersion : "N/A"; }, getOrGenerateCxCompatibleBid: function () { var e = t.__protected__.getCookie("cX_P"), n = null; try {
                t.__protected__.hasLocalStorage() && (n = localStorage.getItem("_cX_P"));
            }
            catch (e) { } var r = e || n; return r ? (t.debug("c1x: existing cX_P value has been found: ", r), r) : (t.debug("c1x: can not find existing cX_P value, generating a new one"), t.__protected__.randomStringCxCompatible()); }, loadCxLibIfNeeded: function () { var e; if (!a() || !s(!0)) {
                var n = document.getElementsByTagName("script")[0], r = document.createElement("script");
                r.onerror = function (e) { t.debug("c1x: error during load of cx.js. ", e); }, r.onload = function () { t.debug("c1x: cx.js has been successfully loaded"); }, r.async = !0, r.type = "text/javascript", pn.c1XLoadCce ? r.src = i() + "/cx.cce.js" : r.src = i() + "/cx.js", t.debug("c1x: start loading cx.js on the page..."), null === (e = n.parentNode) || void 0 === e || e.insertBefore(r, n);
            } }, setCxBidCookie: function (e, n) { var r; r = { path: "/", expires: 730 }, n && (r.domain = n, t.__protected__.deleteTLDCookieForSpecificDomains("cX_P", n)), t.deleteCookie("cX_P"), t.__protected__.setCookie("cX_P", e, r); }, tryToGetCxPageViewId: function (e) { var n, t, r = window.cX; return (null === (t = null === (n = null == r ? void 0 : r.getPageContext) || void 0 === n ? void 0 : n.call(r)) || void 0 === t ? void 0 : t.pageViewRandom) || e; }, injectIds: d } }; };
    pn.container.register("cxense", { useValue: ln() }), pn.cxense = pn.container.resolve("cxense");
    var un = function (e) { void 0 === e && (e = pn.container); var n, t, r = e.resolve("jqUtils"), o = e.resolve("util"), i = e.resolve("api"), a = e.resolve("eventUtils"), s = e.resolve("scrollDepth"), c = e.resolve("log"), l = e.resolve("ajax"), u = e.resolve("viewportExit"), d = e.resolve("idle"), p = e.resolve("interaction"), f = e.resolve("pianoEsp"), m = e.resolve("swg"), g = e.resolve("fbsubscriptions"), v = e.resolve("user"), h = e.resolve("cxense"), w = e.resolve("logging"), y = [], b = {}, k = "", _ = !1, C = "reader_id", I = !1, S = {}, x = (n = { applyCss: { fn: function (e) { e.eventParams.ruleList.forEach((function (e) { var n, t = e.classes, i = e.elements; t && (t = t.replace(/[,.]/g, " ").split(" ").filter((function (e) { return "" !== e; })), "add" === e.type && (n = r.qa(i)) && n.length && n.forEach((function (e) { t.forEach((function (n) { r.addClass(n, e); })); })), "remove" === e.type && (n = r.qa(i)) && n.length && n.forEach((function (e) { t.forEach((function (n) { r.removeClass(n, e); })); }))); o.debug("exp: css applied with rule:", e); })); }, isAction: !0, shouldFireCallback: !0 }, runJs: { fn: function (e) { if (e.eventParams && e.eventParams.snippet) {
                var n = e.eventParams.snippet;
                o.debug("exp: run js with snippet:", n);
                var t = e.eventExecutionContext;
                o.debug("exp: set publisher's context and custom:", t), fe("var context = " + JSON.stringify(t) + ";\nvar custom = " + JSON.stringify(pn.customVariables) + ";\n" + n);
            } }, isAction: !0, shouldFireCallback: !0 }, setCookie: { fn: function (e) { var n = e.eventParams; if (n && void 0 !== n.cookieName && void 0 !== n.cookieValue) {
                o.debug("exp: set cookie with parameters:", n);
                var t = (n.isReadableCookie ? "_pc_" : "") + n.cookieName, r = { domain: n.cookieDomain, path: n.cookiePath };
                if (!n.isSessionCookie) {
                    var i = new Date;
                    switch (n.expirationUnit) {
                        case "seconds":
                            i.setSeconds(i.getSeconds() + n.expirationValue);
                            break;
                        case "minutes":
                            i.setMinutes(i.getMinutes() + n.expirationValue);
                            break;
                        case "hours":
                            i.setHours(i.getHours() + n.expirationValue);
                            break;
                        case "days":
                            i.setDate(i.getDate() + n.expirationValue);
                            break;
                        case "months":
                            i.setMonth(i.getMonth() + n.expirationValue);
                            break;
                        case "years":
                            i.setFullYear(i.getFullYear() + n.expirationValue);
                            break;
                        default: o.log("Wrong eventParams.expirationUnit : ", n.expirationUnit);
                    }
                    r.expires = i;
                }
                o.__protected__.setCookie(t, n.cookieValue, r);
            } }, isAction: !0, shouldFireCallback: !0 }, nonSite: { fn: function (e) { o.debug("exp: non-site action:", e); }, isAction: !0, shouldFireCallback: !0 }, showForm: { fn: function (e) { var n = e.eventParams; if (n && n.formName) {
                var t = { formName: n.formName, hideIfComplete: n.hideCompletedFields, trackingId: e.eventExecutionContext.trackingId, displayMode: n.displayMode, containerSelector: n.containerSelector, showCloseButton: n.showCloseButton, accessToken: v.getProvider().getToken() };
                n.formWidth && n.formWidth.enabled && (t = r.deepExtend({}, { width: n.formWidth.width }, t)), o.debug("exp: show form with params:", n), pn.pianoId.showForm(t);
            } }, isAction: !0, shouldFireCallback: !0 }, showRecommendations: { fn: function (e) { return me(e, function (e) { return { ESP: f.__protected__.showRecommendation.bind(f), CXENSE: h.__protected__.showRecommendation.bind(h) }[e] || function () { }; }(e.eventParams.type)); }, isAction: !0, shouldFireCallback: !0 }, showOffer: { fn: function (e) { return me(e, (function (e) { return pn.offer.show(e); })); }, isAction: !0, shouldFireCallback: !1 }, showTemplate: { fn: ge, isAction: !0, shouldFireCallback: !1 }, showZuoraOffer: { fn: ge, isAction: !0, shouldFireCallback: !1 }, showNewscycleOffer: { fn: ge, isAction: !0, shouldFireCallback: !1 }, showNewsletterSignup: { fn: function (e) { return me(e, (function (e) { return f.__protected__.showNewsletterSignup(e); })); }, isAction: !0, shouldFireCallback: !1 }, showPushSignUp: { fn: function (e) { return me(e, (function (e) { return f.__protected__.showPushSignup(e); })); }, isAction: !0, shouldFireCallback: !1 }, showLogin: { fn: function () { v.showLogin({}); }, isAction: !0, shouldFireCallback: !0 }, continueExecution: { fn: function (e, n) { o.debug("exp: continue execution action:", e, "with requestParameters", n); var t = n || {}; t.experience_id = e.eventExecutionContext.experienceId, t.experience_version = e.eventExecutionContext.experienceVersion, t.context_data = e.eventParams.contextData, Q("auto", t, !0); }, shouldFireCallback: !0 }, continueExecutionCompleted: { fn: be, shouldFireCallback: !0 }, meterActive: { fn: be, shouldFireCallback: !0 }, meterExpired: { fn: be, shouldFireCallback: !0 }, userSegmentTrue: { fn: pe, shouldFireCallback: !0 }, userSegmentFalse: { fn: pe, shouldFireCallback: !0 }, experienceExecutionFailed: { fn: be, shouldFireCallback: !0 }, log: { fn: function (e) { ee(e.eventModuleParams.moduleId, e); }, shouldFireCallback: !1 }, experienceExecute: { fn: function (e, n, t) { e.eventParams.result = t; }, shouldFireCallback: !0 }, setResponseVariable: { fn: function (e) { return e.eventParams; }, isAction: !0, shouldFireCallback: !0 }, creditRedeemed: { fn: function (e) { o.debug("exp: credit redeemed action:", e); }, isAction: !0, shouldFireCallback: !0 } }, t = {}, Object.keys(n).forEach((function (e) { if ("function" != typeof n[e].fn)
        throw new Error("Unsupported config for " + e + " handler"); t[e] = function (e, n) { return function (t, r, i) { if (e.isAction) {
        var a = function (e) { var n = e.eventParams, t = e.eventModuleParams, r = e.eventExecutionContext; return o.debug("exp: fire event 'beforeComposerAction' with eventParams:", n, ", moduleParams:", t, ", context:", r), B.fireCallbacksAndStopOnFirstFalse("beforeComposerAction", n, t, r); }(t);
        if (!a)
            return;
        var s = re(t), c = te(t);
        (s || c) && ee(t.eventModuleParams.moduleId, t);
    } var l, u = t.eventModuleParams.moduleId; S[u] || "N/A" === u || (S[u] = { experienceId: t.eventExecutionContext.experienceId, moduleName: t.eventModuleParams.moduleName }), e.fn(t, r, i), e.shouldFireCallback && (l = n, function (e) { var n = e.eventParams.callback, t = e.eventParams, r = e.eventModuleParams, i = e.eventExecutionContext; o.debug("exp: fire event ", l, " with eventParams:", t, ", moduleParams:", r, ", context:", i), B.fire("experience", l, !0, t, r, i), n && l !== n && (o.debug("exp: execute event ", l, " with callback: ", n), fe(n)); })(t); }; }(n[e], e); })), t), P = { showOffer: function (e) { return ve(e, (function (e) { return pn.offer.deferredShow(e); })); }, showTemplate: he, showZuoraOffer: he, showNewscycleOffer: he }, E = o.profile((function (e) { Q("manual", e, !1); })), T = function (e, n) { B.addEvent(e), B.registerCallback(e, n); }, A = "xbc", M = {}, O = "", R = "", L = "", N = [], U = "handler", j = "eventCondition", D = "innerEventCondition", F = "preload", B = a.createEventManager([]), V = ["showOffer", "showZuoraOffer", "showNewscycleOffer", "showTemplate"]; var q, z = function () { return y; }, H = function () { y = []; }, W = function () { return pn.getTrackingEndpoint(pn.composerHost) + "/api/v3"; }, J = function () { g.__protected__.init(); }, G = function (e) { var n = z(); n.length && (c.logBeaconRequest(W() + "/composer/logExecutionStats", { aid: pn.aid, items: JSON.stringify(n), execution_stats_context: k, ts: (new Date).getTime(), source: e }), H()), window.clearTimeout(q), q = window.setTimeout((function () { G("timer" + q); }), 2e3); }, Q = function (e, n, t) { void 0 === pn.main.appHasApplePay() && B.fireCallbacks("experienceFlow", null, "experience", !0); var i = new Promise((function (e) { setTimeout((function () { e({}); }), 3e4); })); return Promise.race([pn.main.externalResourcesDelay(), i]).then((function (i) { if (r.isPlainObject(i) || (o.error("exp: error get external resources ", i), i = {}), h.__protected__.isActivated()) {
        o.debug("c1x: integration is activated"), h.__protected__.loadCxLibIfNeeded();
        var a = r.deepExtend({}, n, i, { c1x_integration_version: "v2", new_bid: pn.main.fetchCxBrowserId() });
        X(e, a, t);
    }
    else
        X(e, r.deepExtend({}, n, i), t); })).catch((function (e) { })); }, X = function (e, n, t) { n = n || {}; var a = r.deepExtend({}, { protocol_version: 1 }, n); $(a), Y(a), o.hasQueryParamByName(C) && (a.reader_id = o.getQueryParamByName(C)), o.waitCall("refreshUserToken", (function () { if (t)
        a.executed_nodes = JSON.stringify(S);
    else {
        pn.main.trackPageUnloadIfNecessary(), K(a), i.getCallParams(a, v.getProvider()), o.removeAffiliateToken();
        var n = { url: window.location.href, tags: pn.tags, submitType: e };
        pn.main.buildPageTrackParams(a, n);
    } o.debug("exp: Experience initialized with params:", a), o.waitCall("refreshAccessTokenList", (function () { o.startCall("experienceExecute"); var e, n, i = (o.__protected__.cameFromFbSubscriptions() ? (e = "/xbuilder/experience/executeFbia", J()) : e = "/xbuilder/experience/execute", pn.getExperienceEndpoint(!1) + e); if (-1 !== navigator.appVersion.indexOf("MSIE 9"))
        n = { dataType: "jsonp", url: i + "?" + r.param(a) };
    else {
        var s = "?" + r.param({ aid: a.aid });
        n = { type: "post", url: i + s, data: a, xhrFields: { withCredentials: !0 } };
    } n.success = function (e) { o.doneCall("experienceExecute"); var n = r.deepExtend({}, a); t || (we(), pn.main.registerTrackUnload()), Z(e.errors), de(e.models, n); }, n.error = function () { o.doneCall("experienceExecute"), t || we(); var e = { code: 503, message: "Error: Received error when requesting API response from URL: " + i }; o.debug(e.message); }, l.request(n); })); })); }, $ = function (e) { var n = o.__protected__.getCookie(A); n && (e.xbc = n); var t = o.getTbcCookie(); t && t.length > 0 && (e.tbc = t), o.getCampaigns(e), e.custom_cookies = JSON.stringify(o.getCustomCookies()); }, Y = function (e) { var n = o.getPushListsCookie(), t = f.__protected__.getNotificationStatus(); n && n.length > 0 && (e.push_list_subscriptions = JSON.stringify(n)), t && (e.push_notification_settings = t); }, K = function (e) { return [{ property: "debug", parameter: "debug" }, { property: "trackPageView", parameter: "increment_pageview_meter" }].forEach((function (n) { void 0 !== pn[n.property] && (e[n.parameter] = pn[n.property]); })), e; }, Z = function (e) { Array.isArray(e) && (e.length && o.debug("exp: composer execution has been failed with errors"), e.forEach((function (e) { o.debug("exp: " + e.msg); }))); }, ee = function (e, n) { var t; t = { mId: e, eId: n.eventExecutionContext.experienceId, eV: n.eventExecutionContext.experienceVersion, eeId: n.eventExecutionContext.executionId }, y.push(t); }; function ne(e, n, t, r) { return { type: U, eventType: n.eventType, children: [], run: function () { e.bind(this, n, t, r)(); } }; } var te = function (e) { var n, t = e.eventParams.delayBy || {}; return t.value && ("time" === t.type ? n = { type: "timer", timer: t.value } : "scroll" === t.type && (n = { type: "scrollDepth", scrollDepth: t.value, measureType: "pixels" })), n; }, re = function (e) { return e.eventConditions && Array.isArray(e.eventConditions) ? e.eventConditions.length : 0; }, oe = function (e, n) { return r = !1, { type: F, eventType: n.eventType, children: [], run: function () { !1 === r && (t = e(n), r = !0); }, getPreloadResult: function () { return t; } }; var t, r; }; function ie(e, n) { var t = function () { return B.fireCallbacksAndStopOnFirstFalse("beforeBrowserEvent", e); }; switch (e.type) {
        case "viewportExit":
            u.addListener(n, { detectExitMode: e.detectExitMode, detectBackButtonForMobile: e.detectBackButtonForMobile, clientDevice: e.clientDevice }, t);
            break;
        case "scrollDepth":
            s.addListener(n, { scrollDepth: e.scrollDepth, measureType: e.measureType }, t);
            break;
        case "timer":
            var r = setTimeout((function () { t() && n(); }), 1e3 * e.timer);
            N.push(r);
            break;
        case "interaction":
            p.bind(n, e.interactions, t);
            break;
        case "idle": d.addListener(n, e.idleTime, t);
    } } var ae = function (e) { return e.type === U && -1 === ["continueExecution", "meterActive", "meterExpired"].indexOf(e.eventType); }; function se(e, n) { return t = !1, r = function () { ee(e.moduleId, n); for (var r = b[e.moduleId].children, i = 0; i < r.length; i++) {
        var a = r[i], s = b[a];
        if (!1 === t || ae(s))
            try {
                s.run();
            }
            catch (e) {
                o.error("exp: error execute chain event", s, e);
            }
    } t = !0, _ && G("chain"); }, { type: j, children: [], run: function () { ie(e, r); } }; var t, r; } function ce(e, n) { return t = !1, r = function () { for (var e = b[n + D].children, r = 0; r < e.length; r++) {
        var i = e[r], a = b[i];
        if (!1 === t || ae(a))
            try {
                a.run();
            }
            catch (e) {
                o.error("exp: error execute chain event", a, e);
            }
    } t = !0; }, { type: D, children: [n], run: function () { ie(e, r); } }; var t, r; } var le = function (e) { var n; e.swgMarkupData && (o.debug("exp: swg markup data :", e.swgMarkupData), n = e.swgMarkupData, m.__protected__.injectMarkup(n), e.swgMarkupData.isAccessibleForFree || m.__protected__.addLibrary()), e.swgEnabled && m.__protected__.initSwgFlow(); }, ue = function (e) { if (e) {
        for (var n = {}, t = 0; t < e.events.length; t++) {
            var i = e.events[t];
            try {
                "experienceExecute" === i.eventType && ((n = r.deepExtend({}, i.eventExecutionContext)).result = r.deepExtend({}, e));
            }
            catch (e) {
                o.error("exp: error on execute event: ", i, e);
            }
        }
        return n;
    } o.debug("exp: no composer execution result"); }, de = function (e, n) { if (e) {
        var t, i;
        if (o.setTbcCookieFromResponse(e), o.setTacCookieFromResponse(e), t = e, h.__protected__.isActivated() && h.__protected__.isCustomerPrefixConfigured(t) && t && t.bid && h.__protected__.setCxBidCookie(t.bid, null === (i = t.tbc) || void 0 === i ? void 0 : i.cookie_domain), o.setAppTimezoneOffsetFromResponse(e), o.setCurrentDomainFromResponse(e), function (e) { f.__protected__.setVisitorId(e.bid); }(e), function (e) { h.__protected__.sendPageViewEvent({ browserId: e.bid, uid: e.uid, cxenseCustomerPrefix: e.cxenseCustomerPrefix, pageViewId: pn.main.fetchPageViewId(), eventExecutionContext: ue(e.result) }); }(e), function (e) { O = e.bid; }(e), function (e) { e.iss && (R = e.iss); }(e), function (e) { L = e.itemId; }(e), e.xbc && e.xbc.cookie_value) {
            var a = { path: "/", expires: 730 };
            if (e.xbc.cookie_domain && "localhost" !== e.xbc.cookie_domain && (a.domain = e.xbc.cookie_domain, o.__protected__.deleteTLDCookieForSpecificDomains(A, e.xbc.cookie_domain)), pn.cookieDomain || pn.cookiePath) {
                var s = o.getPossibleCookieDomains();
                for (var c in s)
                    o.deleteCookie(A, s[c]);
                a.domain = pn.cookieDomain ? pn.cookieDomain : a.domain, o.__protected__.deleteTLDCookieForSpecificDomains(A, a.domain, a.path), a.path = pn.cookiePath ? pn.cookiePath : a.path, o.__protected__.deleteTLDCookieForSpecificDomains(A, a.domain, a.path);
            }
            o.deleteCookie(A), o.__protected__.setCookie(A, e.xbc.cookie_value, a);
        }
        var l = e.result, u = {};
        if (l) {
            le(l), o.debug("exp: processed experiences :", l.experiences), k = e.executionStatsContext, l.debugMessages.forEach((function (e) { o.debug("exp: execute :", e); }));
            for (var d, p = function (e, n, t) { for (var r = e.eventConditions, i = 0; i < r.length; i++) {
                var a = r[i], s = a.moduleId, c = r[i - 1], l = !r[i + 1];
                if (b[s] || (b[s] = se(a, e)), l)
                    if (b[s].children.push(n), -1 !== V.indexOf(e.eventType) && "viewportExit" === a.type && !te(e)) {
                        var u = P[e.eventType];
                        if (!u) {
                            o.error("exp: not found preload handler for event: ", e);
                            continue;
                        }
                        var d = n + F;
                        b[d] = oe(u, e), c ? b[c.moduleId].children.push(d) : t.push(d);
                    }
                c && -1 === b[c.moduleId].children.indexOf(s) && b[c.moduleId].children.push(s);
            } }, m = [], g = 0, v = 0; v < l.events.length; v++) {
                var w = l.events[v];
                try {
                    var y = w.eventType, C = w.eventModuleParams || {};
                    if (o.debug("exp: process event '" + y + "' (" + C.moduleId + ")"), "experienceExecute" === y && ((u = r.deepExtend({}, w.eventExecutionContext)).result = r.deepExtend({}, l)), !(d = C.moduleId)) {
                        o.error("exp: not found moduleId for linked node event: ", w);
                        continue;
                    }
                    var I = x[y];
                    if (!I) {
                        o.error("exp: not found handler for event: ", w);
                        continue;
                    }
                    b[d] = ne(I, w, n, l);
                    var S = re(w), E = te(w);
                    if (S || E) {
                        var T = d;
                        if (E) {
                            var N = ce(E, d);
                            b[T = d + D] = N;
                        }
                        S ? -1 === m.indexOf(w.eventConditions[0].moduleId) && m.push(w.eventConditions[0].moduleId) : E && m.push(T), p(w, T, m), g++;
                    }
                    else
                        m.push(d);
                }
                catch (e) {
                    o.error("exp: error on execute event: ", w, e);
                }
            }
            g <= 3 && (_ = !0);
            for (var U = 0; U < m.length; U++)
                d = m[U], b[d] && b[d].run();
            window.clearTimeout(q), q = window.setTimeout((function () { G("rootTimer" + q); }), 2e3), M = u;
        }
        else
            o.debug("exp: no composer execution result");
    } }; function pe(e) { re(e) && ee(e.eventModuleParams.moduleId, e); } function fe(e) { try {
        eval.call(window, "(function () {" + e + "\n})();");
    }
    catch (e) {
        o.log("Error occurred in RunJS\n", e);
    } } function me(e, n) { var t = b[e.eventModuleParams.moduleId + F]; return t && t.getPreloadResult ? t.getPreloadResult().show() : ye(e, n); } function ge(e) { return me(e, (function (e) { return pn.template.show(e); })); } function ve(e, n) { return o.debug("exp: run preloading for:", e), ye(e, (function (e) { return n(e); })); } function he(e) { return ve(e, (function (e) { return pn.template.deferredShow(e); })); } function we() { G("reset"), N.forEach((function (e, n) { clearTimeout(n); })), N = [], u.removeListeners(), d.removeListeners(), s.removeListeners(), p.unbindAll(), b = {}, S = {}; } function ye(e, n) { var t = r.deepExtend({}, e.eventParams), i = e.eventExecutionContext.splitTests, a = e.eventExecutionContext.activeMeters, s = e.eventParams.formNameByTermId, c = e.eventParams.hideCompletedFields, l = function (e) { var n; if (!R)
        return null; var t = e || {}; return { issuerId: R, premium: t.user && t.user.premium || null, redemptionCandidateItemId: L || null, creditStates: t.creditStates || null, userId: (null === (n = t.user) || void 0 === n ? void 0 : n.uid) || null, targetGroups: { l1: "target", l2: null } }; }(e.eventExecutionContext); if (t.trackingId = e.eventExecutionContext.trackingId, t.experienceId = e.eventExecutionContext.experienceId, t.experienceExecutionId = e.eventExecutionContext.executionId, t.experienceActionId = e.eventModuleParams.moduleId, t.experienceConditions = e.eventConditions, t.browserId = O, t.onStartCreditRedemption = function (n) { var t = r.deepExtend({}, n), o = "https://www.piano.io" === R, i = e.eventExecutionContext.user && "anon" !== e.eventExecutionContext.uid; return t.trackingId = e.eventExecutionContext.trackingId || void 0, o && i && (t.uid = e.eventExecutionContext.user.uid || void 0), pn.credit.redeem(t); }, i && i.length > 0) {
        var u = i.map((function (e) { return e.variantId; }));
        t.splitTestIds = JSON.stringify(u);
    } if (t.additionalParamNames = [], a && a.length > 0 && (t.activeMeters = JSON.stringify(a)), "showZuoraOffer" === e.eventType) {
        var d = e.eventParams.ratePlanIds;
        d && d.length > 0 && (t.zuoraSelectedRatePlanIds = JSON.stringify(d), t.additionalParamNames.push("zuoraSelectedRatePlanIds"));
    } if ("showNewscycleOffer" === e.eventType) {
        var p = e.eventParams.ids;
        p && p.length > 0 && (t.newscycleSelectedIds = JSON.stringify(p), t.additionalParamNames.push("newscycleSelectedIds", "campaignCode", "campaignGroupId"));
    } if ("showNewsletterSignup" === e.eventType) {
        var f = e.eventParams.mailingListIds, m = e.eventParams.siteId;
        f && f.length > 0 && (t.mailingListIds = JSON.stringify(f), t.siteId = m, t.additionalParamNames.push("mailingListIds", "siteId"));
    } return "showRecommendations" === e.eventType && (t.widgetId = e.eventParams.widgetId, t.placeholder = e.eventParams.placeholder), s && (t.formNameByTermId = JSON.stringify(s), t.hideCompletedFields = c), l && (t.affiliateState = l), o.debug("exp: show with params:", t), n(t); } function be() { return function () { }; } return { name: "experience", init: function () { if (!I && !o.__protected__.isCxenseBot()) {
            I = !0;
            var e = !0;
            if (pn.customPreChecks && pn.customPreChecks.length)
                for (var n = null, t = pn.customPreChecks.length; t--;)
                    try {
                        1 !== (n = pn.customPreChecks[t]()) && !0 !== n && (e = !1);
                    }
                    catch (e) { }
            e && Q("auto").then((function () { w.setTime("expExec"); }));
        } }, execute: E, _getLastExecutionResult: function () { return M; }, registerCallback: T, __private__: { handlers: x, executedNodes: y, linkedNodes: b, processResult: de, processErrors: Z, show: ye, getTrackingEndpoint: W, initialized: I, registerCallback: T }, __protected__: { sendStatisticsExecutedNodes: G } }; };
    pn.container.register("experience", { useValue: un() }), pn.experience = pn.container.resolve("experience");
    var dn = function () { var e, n, t, r, o, i = 0, a = document, s = !1, c = "active", l = 6e4, u = (r = {}, t = "__ceGUID", { add: function (e, n, o) { return e[t] = void 0, e[t] || (e[t] = "ifvisible.object.event.identifier"), r[e[t]] || (r[e[t]] = {}), r[e[t]][n] || (r[e[t]][n] = []), r[e[t]][n].push(o); }, remove: function (e, n, o) { var i, a, s, c, l; if (o) {
            if (e[t] && r[e[t]] && r[e[t]][n])
                for (a = s = 0, c = (l = r[e[t]][n]).length; s < c; a = ++s)
                    if ((i = l[a]) === o)
                        return r[e[t]][n].splice(a, 1), i;
        }
        else if (e[t] && r[e[t]] && r[e[t]][n])
            return delete r[e[t]][n]; }, fire: function (e, n, o) { var i, a, s, c, l; if (e[t] && r[e[t]] && r[e[t]][n]) {
            for (l = [], a = 0, s = (c = r[e[t]][n]).length; a < s; a++)
                i = c[a], l.push(i(o || {}));
            return l;
        } } }), d = function (e, n, t) { return o || (o = e.addEventListener ? function (e, n, t) { return e.addEventListener(n, t.bind(dn), !1); } : e.attachEvent ? function (e, n, t) { return e.attachEvent("on" + n, t, !1); } : function (e, n, t) { return e["on" + n] = t; }), o(e, n, t); }, p = function () { var e, n = a.createElement("div"), t = n.getElementsByTagName("i"), r = 3; for (e = function () { return n.innerHTML = "\x3c!--[if gt IE " + ++r + "]><i></i><![endif]--\x3e", t[0]; }; e();)
        ; return r > 4 ? r : void 0; }(); function f() { var t, r, o; return !!s || (e ? d(a, n, (function () { return a.hidden ? g() : m(); }), !1) : (t = "blur", p && p < 9 && (t = "focusout"), d(window, t, (function () { return dn.blur(); })), d(window, "focus", (function () { return dn.focus(); }))), s = !0, (o = function () { return clearTimeout(r), "active" !== c && h(), i = +new Date, r = setTimeout((function () { if ("active" === c)
        return v(); }), l); })(), d(a, "mousemove", o), d(a, "mouseup", o), d(a, "keyup", o), d(a, "touchstart", o), d(window, "scroll", o), d(window, "resize", o), m(o), h(o)); } void 0 !== a.hidden ? (e = "hidden", n = "visibilitychange") : void 0 !== a.mozHidden ? (e = "mozHidden", n = "mozvisibilitychange") : void 0 !== a.msHidden ? (e = "msHidden", n = "msvisibilitychange") : void 0 !== a.webkitHidden && (e = "webkitHidden", n = "webkitvisibilitychange"); function m(e) { return "function" == typeof e ? w("focus", (function (n) { e(n); })) : (c = "active", u.fire(dn, "focus"), u.fire(dn, "wakeup"), u.fire(dn, "statusChanged", { status: c })), dn; } function g(e) { return "function" == typeof e ? w("blur", (function (n) { e(n); })) : (c = "hidden", u.fire(dn, "blur"), u.fire(dn, "idle"), u.fire(dn, "statusChanged", { status: c })), dn; } function v(e) { return "function" == typeof e ? w("idle", (function (n) { e(n); })) : (c = "idle", u.fire(dn, "idle"), u.fire(dn, "statusChanged", { status: c })), dn; } function h(e) { return "function" == typeof e ? w("wakeup", (function (n) { return e(n); })) : (c = "active", u.fire(dn, "wakeup"), u.fire(dn, "statusChanged", { status: c })), dn; } function w(e, n) { return f(), u.add(dn, e, n), dn; } return { name: "ifvisible", setIdleDuration: function (e) { return l = 1e3 * e; }, getIdleDuration: function () { return l; }, getIdleInfo: function () { var e, n; return e = +new Date, n = {}, "idle" === c ? (n.isIdle = !0, n.idleFor = e - i, n.timeLeft = 0, n.timeLeftPer = 100) : (n.isIdle = !1, n.idleFor = e - i, n.timeLeft = i + l - e, n.timeLeftPer = (100 - 100 * n.timeLeft / l).toFixed(2)), n; }, wakeup: h, idle: v, focus: m, blur: g, on: w, off: function (e, n) { return f(), u.remove(dn, e, n), dn; }, onEvery: function (e, n) { var t, r = !1; return f(), n && (t = setInterval((function () { if ("active" === c && !r)
            return n(); }), 1e3 * e)), { stop: function () { return clearInterval(t); }, pause: function () { return r = !0; }, resume: function () { return r = !1; }, code: t, callback: n }; }, now: function (e) { return f(), c === (e || "active"); } }; }();
    pn.container.register("ifvisible", { useValue: dn }), pn.ifvisible = pn.container.resolve("ifvisible");
    var fn = function () { var e, n = pn.container.resolve("jqUtils"), t = pn.container.resolve("ifvisible"), r = 0, o = [], i = 60, a = !0, s = function () { m(); var e = o[o.length - 1]; void 0 !== e && void 0 === e.stopTime || o.push({ startTime: new Date, startMinute: r, stopTime: void 0 }); }, c = function () { if (0 !== o.length && !a)
        if (d())
            f();
        else {
            var e = o[o.length - 1];
            void 0 === e.stopTime && (e.stopTime = new Date, e.stopMinute = r);
        } }, l = function (e, n, t, r) { var o = Math.abs(e.getTime() - n.getTime()), i = t - r; return o > 6e4 * (i + 10) && (o = 6e4 * i), o; }, u = function (e) { var n = parseFloat(e); if (isNaN(n))
        throw { name: "InvalidDurationException", message: "An invalid duration time (" + e + ") was provided." }; t.setIdleDuration(n), i = n; }, d = function () { return !!(e = n.filter("video,audio", (function (e) { return !e.paused; }))).length; }, p = function () { setTimeout((function () { c(); }), 15e3); }, f = function () { e && e.forEach((function (e) { n.on(e, "pause", p); })); }, m = function () { e && e.forEach((function (e) { n.off(e, "pause", p); })); }; return { name: "activetimer", setIdleDurationInSeconds: u, getActiveTimeInSeconds: function () { for (var e = 0, n = 0; n < o.length; n++) {
            var t = o[n].startTime, i = o[n].stopTime, a = o[n].startMinute, s = o[n].stopMinute;
            void 0 === i && (i = new Date, s = r), e += l(i, t, s, a);
        } return Math.floor(e / 1e3); }, getTotalTimeInSeconds: function () { var e = 0, n = o[0]; if (void 0 !== n) {
            var t = n.startTime, i = n.startMinute, a = new Date;
            e = l(a, t, r, i);
        } return Math.floor(e / 1e3); }, resetRecordedTime: function () { o = [], s(); }, startTimer: s, stopTimer: c, initialize: function (e) { e && u(e), t.on("blur", (function () { a = !1, c(); })), t.on("focus", (function () { a = !0, s(); })), t.on("idle", (function () { i > 0 && (a = !1, c()); })), t.on("wakeup", (function () { i > 0 && (a = !0, s()); })), s(), setInterval((function () { r++; }), 6e4); } }; }();
    pn.container.register("activetimer", { useValue: fn }), pn.activetimer = pn.container.resolve("activetimer");
    var mn = function () { var e, n = {}, t = [], r = !1, o = 1, i = 2, a = 3; function s(e) { e && (u(), r = !1), function () { if (r)
        return !1; r = !0; try {
        var e = window.googletag = window.googletag || {};
        e.cmd = e.cmd || [], e.cmd.push((function () { e.pubads().addEventListener("slotRenderEnded", f), e.pubads().addEventListener("impressionViewable", m), e.companionAds().addEventListener("slotRenderEnded", f), e.companionAds().addEventListener("impressionViewable", m); })), e.apiReady && e.cmd.push((function () { d(e.pubads().getSlots()), d(e.companionAds().getSlots()); }));
    }
    catch (e) {
        return v(e), !1;
    } }(); } function c(n, t) { "function" == typeof e && e(n, t); } function l(e) { return e && void 0 !== n[e] && null !== n[e] && n.hasOwnProperty(e); } function u() { n = {}, t = []; } function d(e) { for (var n = 0; n < e.length; n++) {
        var t = e[n];
        f({ eventSource: a, slot: t });
    } } function p(e) { var n; try {
        var t = e.serviceName, r = e.slot;
        if (!t) {
            var o = e.slot.getServices();
            o && o.length && (t = o[0].getName());
        }
        var i = r.getResponseInformation() || {}, a = r.getSlotId ? r.getSlotId() : {}, s = r.getSlotElementId ? r.getSlotElementId() : a.getDomId ? a.getDomId() : null;
        n = { companion: !!t && "companion_ads" === t, adUnit: r.getAdUnitPath ? r.getAdUnitPath() : 0, isEmpty: e.isEmpty, elementId: s, advertiserId: e.advertiserId || i.advertiserId, campaignId: e.campaignId || i.campaignId, lineItemId: e.lineItemId || i.lineItemId, creativeId: e.creativeId || i.creativeId, eventSource: e.eventSource || null, size: e.size && e.size.slice(0, 2) || null, viewed: !1, position: null };
        var c = document.getElementById(s);
        if (s && c && (n.position = { top: c.offsetTop, left: c.offsetLeft }, void 0 === e.isEmpty && (n.isEmpty = c.offsetWidth <= 0 && c.offsetHeight <= 0, !n.isEmpty && !n.size))) {
            var l = r.getSizes();
            l && l.length && (n.size = "object" == typeof l[0] ? [l[0].getWidth(), l[0].getHeight()] : l[0]);
        }
    }
    catch (e) {
        v(e);
    } return n; } function f(e) { e.eventSource = e.eventSource || o; var r = p(e), i = g(e.slot); i && (n[i] ? r.viewed = n[i].viewed : t.push(i), n[i] = r, c(r, i)); } function m(e) { var r = g(e.slot); if (r) {
        var o = n[r] || p(e);
        l(r) || (n[r] = o, t.push(r)), void 0 === o.companion && (o.companion = "companion_ads" === e.serviceName), (!o.eventSource || o.eventSource > i) && (o.eventSource = i), o.viewed = !0, c(o, r);
    } } function g(e) { try {
        var n = e.getSlotId ? e.getSlotId() : {}, t = e.getSlotElementId ? e.getSlotElementId() : n.getDomId ? n.getDomId() : null, r = e.getAdUnitPath ? e.getAdUnitPath() : 0;
        return [t, n.getId ? n.getId() : 0, r].join(":");
    }
    catch (e) {
        v(e);
    } } function v(e) { pn && pn.util && pn.util.error && pn.util.error("DFP module error: ", e); } return s(), { name: "doubleClickForPublisher", initialize: s, setCustomHandler: function (n) { e = n; }, getAds: function (e) { var r, o = [], i = 0, a = t.length; e && ("number" == typeof (r = e) && isFinite(r) && Math.floor(r) === r) && e > 0 && e < a && (i = a - e); for (var s = i; s < a; s++) {
            var c = t[s];
            l(c) && o.push(n[c]);
        } return o; }, resetAds: u }; }();
    pn.container.register("doubleClickForPublisher", { useValue: mn }), pn.doubleClickForPublisher = pn.container.resolve("doubleClickForPublisher");
    var gn = function () { var e, n, t, r, o, i, a = pn.container.resolve("postmessage"), s = pn.container.resolve("util"), c = "https://js.braintreegateway.com/web/3.79.1/js/client.min.js", l = "https://js.braintreegateway.com/web/3.79.1/js/apple-pay.min.js", u = ""; a.subscribe("loaded", (function () { d(); })), a.subscribe("startCheckout", (function () { d(); })), a.subscribe("applePayBtClientToken", (function (e) { g(e.params.clientToken); })), a.subscribe("applePayBtCheckoutFlowProperties", (function (e) { r = e.params.requestEmail, o = e.params.requestPostalAddress; })), a.subscribe("applyTaxFailed", (function (n) { e.abort(); })), a.subscribe("checkApplePayBtInstance", (function (e) { n && a.broadcast("applePayInit", {}); })), a.subscribe("applyTaxCompleted", (function (e) { m(e.params.nonce); })), a.subscribe("applePayBtBeginSession", (function (i) { var s = {}, c = i.params; c.resourceTitle && (s = c), c.termId && (u = c.termId || ""); var l = { currencyCode: c.currencyCode, total: { label: c.resourceTitle, amount: c.chargeAmount } }; p(l); try {
        t = n.createPaymentRequest(l);
    }
    catch (e) {
        a.broadcast("payment-error", { errorCode: 101 });
    } (e = new window.ApplePaySession(2, t)).onvalidatemerchant = function (t) { n.performValidation({ validationURL: t.validationURL, displayName: c.resourceTitle || s.resourceTitle }, (function (n, t) { if (n)
        return e.abort(), void a.broadcast("payment-error", { errorCode: 102 }); e.completeMerchantValidation(t); })); }, e.onpaymentauthorized = function (t) { n.tokenize({ token: t.payment.token }, (function (n, i) { if (n)
        return a.broadcast("payment-error", { errorCode: 103 }), void e.completePayment(window.ApplePaySession.STATUS_FAILURE); var s = { nonce: i.nonce }; r || o ? f(t, s) : m(s); })); }, e.begin(); })); var d = function () { var e = s.__protected__.isApplePayAllowed(); a.broadcast("EVENT_APPLE_PAY_CAN_MAKE_PAYMENTS", { canMakePayments: e }); }, p = function (e) { r && (e.requiredShippingContactFields = ["email"]), o && (e.requiredBillingContactFields = ["postalAddress"]); }, f = function (e, n) { e.payment.shippingContact && (n.user = { email: e.payment.shippingContact.emailAddress }); var t = e.payment.billingContact, r = { countryCode: t.countryCode ? t.countryCode.toUpperCase() : t.countryCode, zipCode: t.postalCode, billingZipCode: t.postalCode, nonce: n }; a.broadcast("applePayPaymentAuthorized" + u, r); }, m = function (n) { e.completePayment(window.ApplePaySession.STATUS_SUCCESS), a.broadcast("applePayNonce" + u, n); }, g = function (e) { i = e, v(); }, v = function () { y() || w(c, (function () { h(); })); }, h = function () { b() || w(l, (function () { window.braintree.client.create({ authorization: i }).then((function (e) { window.braintree.applePay.create({ client: e }, (function (e, t) { e ? a.broadcast("payment-error", { errorCode: 101 }) : (n = t, a.broadcast("applePayInit", {})); })); })).catch((function (e) { if (e)
        return a.broadcast("payment-error", { errorCode: 100 }), void s.error("[TP] Client error: " + e.message); })); })); }, w = function (e, n) { s.addScript(e, n); }, y = function () { for (var e = document.getElementsByTagName("script"), n = 0, t = e.length; n < t; n++)
        if (e[n].src.indexOf(c) > -1)
            return !0; }, b = function () { for (var e = document.getElementsByTagName("script"), n = 0, t = e.length; n < t; n++)
        if (e[n].src.indexOf(l) > -1)
            return !0; }; return { name: "applePay" }; }();
    pn.container.register("applePay", { useValue: gn }), pn.applePay = pn.container.resolve("applePay");
    var vn = function () { var e = pn.container.resolve("postmessage"), n = pn.container.resolve("util"), t = "", r = { environment: "", billingRequestFlowId: "" }, o = { customer: "", mandate: "", bank_account_ending: "", bank_account_holder: "", bank_name: "", currency: "" }, i = !1, a = "https://pay.gocardless.com/billing/static/dropin/v2/initialise.js"; e.subscribe("loaded", (function (e) { t = e.sender, i || "inline" === e.displayMode || c(a, (function () { i = !0; })); })), e.subscribe("LOAD_GOCARDLESS_DROPIN", (function (n) { t = n.sender, i ? e.send("GOCARDLESS_DROPIN_LOADED", null, t) : c(a, (function () { i = !0, e.send("GOCARDLESS_DROPIN_LOADED", null, t); })); })), e.subscribe("GOCARDLESS_DROPIN_MANDATE_CREATION_INIT", (function (e) { r = e.params, i && s(); })); var s = function () { window.GoCardlessDropin.create({ billingRequestFlowID: r.billingRequestFlowId, environment: r.environment, onSuccess: function (n) { var r = n.links, i = r.customer, a = r.mandate_request_mandate, s = n.resources.customer_bank_account, c = s.account_number_ending, l = s.account_holder_name, u = s.bank_name, d = n.mandate_request.currency; o = { customer: i, mandate: a, bank_account_ending: c, bank_account_holder: l, bank_name: u, currency: d }, e.send("GOCARDLESS_DROPIN_MANDATE_CREATION_COMPLETE", o, t); }, onExit: function (n) { n ? e.send("payment-error", { message: n }, t) : e.send("GOCARDLESS_DROPIN_ENABLE_PLUGIN", null, t); } }).open(); }, c = function (e, t) { n.addScript(e, t); }; return { name: "goCardlessDropin" }; }();
    pn.container.register("goCardlessDropin", { useValue: vn }), pn.goCardlessDropin = pn.container.resolve("goCardlessDropin");
    var hn = function () { var e, n, t, r = pn.container.resolve("postmessage"), o = pn.container.resolve("util"), i = !1; return { name: "applePayIntegrationService", initialize: function () { var a = function () { i = o.__protected__.isApplePayAllowed(), r.broadcast("EVENT_APPLE_PAY_CAN_MAKE_PAYMENTS", { canMakePayments: i }); }; r.subscribe("provider-component-initiated", (function () { i && r.broadcast("apple-pay-init", {}); })), r.subscribe("initPwApplePay", (function () { a(); })), r.subscribe("startCheckout", (function () { a(); })), r.subscribe("pay-session-received", (function (e) { try {
            n.completeMerchantValidation(e.params.applePaySession);
        }
        catch (e) {
            r.broadcast("payment-error", { errorCode: 111, errors: e });
        } })), r.subscribe("apple-pay-complete-payment", (function (e) { var r; (r = e.params.termId, t && t !== r) || n.completePayment(e.params.status, e.params.errors); })), r.subscribe("start-purchase", (function (o) { t = o.params.termId || "", e = o.params.resourceName, n = new window.ApplePaySession(3, function (e) { return { countryCode: e.params.countryCode, currencyCode: e.params.currencyCode, supportedNetworks: ["visa", "masterCard", "amex", "discover"], merchantCapabilities: ["supports3DS"], requiredShippingContactFields: e.params.requiredShippingContactFields || [], requiredBillingContactFields: e.params.requiredBillingContactFields || [], total: { label: e.params.resourceName, amount: e.params.chargeAmount } }; }(o)), n.onvalidatemerchant = function (n) { var o, i; o = n.validationURL, i = { validationUrl: o, displayedCaption: e, userToken: null, userProvider: null, userRef: null, janrainCaptureToken: null, domainName: window.location.hostname, aid: null, termId: t }, r.broadcast("apple-pay-pay-session-request", i); }, n.onpaymentauthorized = function (e) { try {
            r.broadcast("apple-pay-payment-authorized", { paymentData: e.payment, termId: t });
        }
        catch (e) {
            r.broadcast("payment-error", { errorCode: 110, error: e });
        } }; try {
            n.begin();
        }
        catch (e) {
            r.broadcast("payment-error", { errorCode: 112, error: e, termId: t });
        } })), r.subscribe("abort-apple-pay-session", (function () { !function () { try {
            n.abort();
        }
        catch (e) {
            o.error(e);
        } }(); })); }, __protected__: { applePayCanMakePaymentsWithActiveCard: function () { var e = { then: function (e) { return e(null); }, catch: function () { } }; return pn.applePayMerchantId && o.__protected__.isApplePayAllowed() && pn.applePayMerchantId ? window.ApplePaySession.canMakePaymentsWithActiveCard(pn.applePayMerchantId) : e; } } }; }();
    pn.container.register("applePayIntegrationService", { useValue: hn }), pn.applePayIntegrationService = pn.container.resolve("applePayIntegrationService");
    var wn = function () { var e, n, t = pn.container.resolve("postmessage"), r = pn.container.resolve("util"), o = pn.container.resolve("ajax"), i = "datatrans-applepay-button", a = null, s = null, c = !1, l = function (n) { e = n.sender, m().then(g).then(v); }, u = function (n) { var r = null; n || (r = { message: n }), t.send("datatrans-applepay-service-error", r, e); }, d = function (e) { n = e.params, m().then(g).then(p).catch((function () { u("Apple Pay button init error"); })); }, p = function () { PaymentButton.init(n.applePayConfig); }, f = function () { var e = document.getElementById(i); null !== e && null !== e.firstElementChild ? e.firstElementChild.click() : u("Could not process with Apple Pay. Please, try again."); }, m = function () { return null !== s ? s : s = new Promise((function (e) { o.request({ url: tp.getApiEndpoint() + "/anon/datatrans/applepay/config", data: { aid: tp.aid }, dataType: "jsonp", jsonpCallback: "jsonpCallback", success: function (n) { var t = n.config; e(t.url); } }); })); }, g = function (e) { if (null !== a)
        return a; var n = "datatrans-apple-pay"; if (!document.getElementById(n)) {
        var t = document.createElement("script");
        return t.src = e, t.id = n, document.body.appendChild(t), a = new Promise((function (e) { t.onload = function () { e(null); }; }));
    } }, v = function () { c || (PaymentButton.on("init", h), PaymentButton.on("create", w), PaymentButton.on("token", y), PaymentButton.on("abort", (function () { u(null); })), PaymentButton.on("unsupported", (function () { u("No payment method is supported"); })), PaymentButton.on("error", (function (e) { e && (r.error("datatransApplePayIntegrationService. apple pay button error: " + e), u("Could not process with Apple Pay. Please, try again.")); })), c = !0); }, h = function () { var e = b(); PaymentButton.create(e, n.paymentConfig).catch((function () { u("Apple Pay button create error"); })); }, w = function () { r.log("datatransApplePayIntegrationService paymentButtonOnCreate"), t.send("datatrans-applepay-service-ready", null, e); }, y = function (n) { r.log("datatransApplePayIntegrationService paymentButtonOnToken"), t.send("datatrans-applepay-service-token", n.token.details.token, e); }, b = function () { var e = document.getElementById(i); return null === e && ((e = document.createElement("div")).setAttribute("id", i), e.style.display = "none", document.body.appendChild(e)), e.innerHTML = "", e; }; return { name: "datatransApplePayIntegrationService", initialize: function () { r.__protected__.isApplePayAllowed() && (t.subscribe("datatrans-applepay-loaded", l), t.subscribe("datatrans-applepay-checkout-initiate-purchase", d), t.subscribe("datatrans-applepay-make-purchase", f)); } }; }();
    pn.container.register("datatransApplePayIntegrationService", { useValue: wn }), pn.datatransApplePayIntegrationService = pn.container.resolve("datatransApplePayIntegrationService");
    var yn = function () { var e, n = pn.container.resolve("postmessage"), t = pn.container.resolve("util"), r = null, o = null, i = !1, a = ""; n.subscribe("stripe-applepay-initialized", (function () { s(); })), n.subscribe("stripe-applepay-initiate-purchase", (function (e) { s().then((function () { var n = e.params.apiKey; null === r && (r = window.Stripe(n)); var t = e.params.paymentRequestPayload; return r.paymentRequest(t); })).then((function (e) { return o = e, e.canMakePayment(); })).then((function (e) { i = e && e.applePay, n.broadcast("stripe-applepay-initiate-purchase-complete", { canMakePayment: i }), i && (o.on("cancel", (function () { n.broadcast("stripe-applepay-start-purchase-complete" + a, { status: "fail" }); })), o.on("paymentmethod", (function (e) { var t = e.paymentMethod.billing_details.address, r = { countryCode: t.country, zipCode: t.postal_code, billingZipCode: t.postal_code }, o = e.paymentMethod.id; n.broadcast("stripe-applepay-start-purchase-complete" + a, { status: "success", paymentMethodId: o, payerEmail: e.payerEmail, billingAddress: r }), e.complete("success"); }))); })).catch((function (e) { t.error(e), n.broadcast("stripe-applepay-initiate-purchase-complete", { canMakePayment: !1 }); })); })), n.subscribe("stripe-applepay-start-purchase", (function (e) { a = e.params.termId || ""; var n = e.params.paymentRequestPayload; o.update(n), o.show(); })), n.subscribe("stripe-applepay-abort-request", (function () { o && o.abort(), n.broadcast("stripe-applepay-reopen-request"); })); var s = function () { if (null != e)
        return e; if (!document.getElementById("stripe.js")) {
        var n = document.createElement("script");
        return n.src = "https://js.stripe.com/v3/", n.id = "stripe.js", document.body.appendChild(n), e = new Promise((function (e) { n.onload = function () { e(null); }; }));
    } }; return { name: "stripeApplePayIntegrationService" }; }();
    pn.container.register("stripeApplePayIntegrationService", { useValue: yn }), pn.stripeApplePayIntegrationService = pn.container.resolve("stripeApplePayIntegrationService");
    var bn = function () { var e = pn.container.resolve("postmessage"), n = pn.container.resolve("util"); e.subscribe("obi-handle-3ds-challenge", (function (e) { var r = e.params; if (window.obick)
        t(r);
    else {
        if (-1 === ["https://jsl.qat.obi.aol.com/obipmservice/obick.umd.js", "https://jsl.prod.obi.aol.com/obipmservice/obick.umd.js"].indexOf(r.obickUrl))
            return void n.error("Untrusted obickUrl detected: " + r.obickUrl);
        var o = document.createElement("script");
        o.src = r.obickUrl, o.id = "obick.js", document.body.appendChild(o), o.onload = function () { n.log(o.id + " onload"), t(r); };
    } })); var t = function (t) { if (t.stepUpUrl && 0 !== t.stepUpUrl.indexOf("http"))
        n.error("There is no link in params.stepUpUrl for OBI");
    else {
        var r = { stepUpUrl: t.stepUpUrl, jwt: t.jwt, transactionId: t.transactionId, zIndex: t.zIndex };
        window.obick.handle3dsChallenge(r).then((function (t) { n.debug(t), e.broadcast("obi-3ds-challenge-complete", { threeDSTransactionId: t.threeDSTransactionId, challengeStatus: t.challengeStatus }); })).catch((function (t) { n.error(t), e.broadcast("obi-3ds-challenge-complete", { error: "challenge-error", payload: t }); }));
    } }; return { name: "obi3DSChallenge" }; }();
    pn.container.register("obi3DSChallenge", { useValue: bn }), pn.obi3DSChallenge = pn.container.resolve("obi3DSChallenge");
    var kn = function () { var e = pn.container.resolve("jqUtils"), n = pn.container.resolve("util"), t = pn.container.resolve("api"), r = pn.container.resolve("user"), o = pn.container.resolve("pianoId"), i = { displayMode: "inline", containerSelector: "body", loginSuccess: d }, a = "reader_id", s = function () { return "/" + pn.aid + "/execution/amp"; }, c = function () { window.location.href = n.getQueryParamByName("return") + "#success=true"; }; var l = function (e) { return /^\w+$/i.test(e); }, u = function (e) { var r = {}; if (r.reader_id = n.getQueryParamByName(a), r.reader_id) {
        var o = pn.getExperienceEndpoint(!1);
        t.callApi(s() + "/logout", r, e, o, !1, !0);
    }
    else
        n.log("reader_id cannot be empty"); }; function d(e, r) { var o = e || {}; if (o.reader_id || (o.reader_id = n.getQueryParamByName(a)), o.reader_id) {
        var i = pn.getExperienceEndpoint(!1);
        t.callApi(s() + "/login", o, r, i, !1, !0);
    }
    else
        n.log("reader_id cannot be empty"); } return { name: "amp", showLogin: function (t) { t = t || {}; var a = r.getProvider(); if (a.getName() === o.getName()) {
            var s;
            s = t.loginSuccess && e.isFunction(t.loginSuccess) ? t.loginSuccess : c;
            var l = function () { d({}, s); }, u = Object.assign({}, i, t);
            r.isUserValid() ? l() : (u.loginSuccess = l, o.show(u));
        }
        else
            n.log("Current user provider" + a.name + " is not allowed for amp"); }, logout: function (n) { n = e.isFunction(n) ? n : c, r.getProvider().getName() === o.getName() ? o.logout((function () { u(n); })) : u(n); }, login: function (t) { var i = r.getProvider().getName(); i === o.getName() && (t = t ? e.deepExtend({}, t, { userProvider: i }) : { userProvider: i }); var a = { user_transient: !0, user_provider: "publisher_user" }; if (t && t.readerId && (a.reader_id = t.readerId), t && t.userToken && (a.user_token = t.userToken), t && t.userProvider && (a.user_provider = t.userProvider, a.user_transient = !1), !function (t) { if (t && t.userState && e.isPlainObject(t.userState)) {
            var r = Object.keys(t.userState);
            if (r.filter(l).length !== r.length)
                return n.error("user_state accept only contain letters, numbers and underscore"), !1;
        } return !0; }(t))
            return !1; t && t.userState && (a.user_state = JSON.stringify(t.userState)); d(a, (function (n) { 0 === n.code ? t.loginSuccess && e.isFunction(t.loginSuccess) && t.loginSuccess() : t.loginFail && e.isFunction(t.loginFail) && t.loginFail(); })); } }; }();
    pn.container.register("amp", { useValue: kn }), pn.amp = pn.container.resolve("amp");
    var _n = function () { var e, n = pn.container.resolve("postmessage"), t = [{ resourceRegExp: new RegExp("/checkout/offer/show"), label: "showOffer" }, { resourceRegExp: new RegExp("tinypass.min.js$"), label: "tinypassMinJS" }, { resourceRegExp: new RegExp("/xbuilder/experience/execute"), label: "experienceExecute" }], r = !1, o = []; function i(e) { e.forEach((function (e) { !function (e) { if (!function (e) { return t.some((function (n) { return e.name.match(n.resourceRegExp); })); }(e))
        return; !function (e) { if (!a())
        return void o.push(e); o.push(e), s(); }(e); }(e); })); } function a() { return r && e; } function s() { a() && (o.forEach((function (t) { n.send("EVENT_TP_PERFORMANCE_DATA", { entry: t }, e); })), o = []); } return function () { if (window.performance && window.PerformanceObserver && "function" == typeof performance.getEntries) {
        var t = window.PerformanceObserver.prototype.observe;
        window.PerformanceObserver.prototype.observe = function () { for (var e = [], n = 0; n < arguments.length; n++)
            e[n] = arguments[n]; try {
            t.apply(this, e);
        }
        catch (e) { } }, n.subscribe("EVENT_LOGGER_READY", (function (n) { e = n.sender, r = !0, s(); })), i(performance.getEntries()), new PerformanceObserver((function (e) { i(e.getEntries()); })).observe({ entryTypes: ["measure", "resource"] });
    } }(), { name: "performanceMetrics" }; }();
    pn.container.register("performanceMetrics", { useValue: _n }), pn.performanceMetrics = pn.container.resolve("performanceMetrics");
    var Cn = function () { var e = pn.container.resolve("api"), n = pn.container.resolve("pianoId"); return { name: "doubleOptIn", check: function () { pn.user.isUserValid() && new Promise((function (n) { e.callApi("/email/confirmation/check", {}, (function (e) { n(e); })); })).then((function (e) { e && !1 === e.data && n.showEmailConfirmationRequired(); })); } }; }();
    pn.container.register("doubleOptIn", { useValue: Cn }), pn.doubleOptIn = pn.container.resolve("doubleOptIn");
    var In = function () { var e = pn.container.resolve("api"), n = pn.container.resolve("postmessage"), t = pn.container.resolve("util"), r = t.debounce((function () { new Promise((function (n, t) { var r = { aid: pn.aid }; e.callApi(o, r, (function (e) { e && e.data && n(e.data), t(e.message); })); })).then(i, a); }), 1500), o = "/externalVerification/synchronizeSubscriptions", i = function (e) { n.broadcast("NEWSCYCLE_HAS_BEEN_SYNCHRONIZED_SUCCESS", { data: e }); }, a = function (e) { t.error("newscycle module: sync request failed with error: " + e); }; return { name: "newscycle", syncSubscriptions: r }; }();
    pn.container.register("newscycle", { useValue: In }), pn.newscycle = pn.container.resolve("newscycle");
    var Sn = function () { var e = pn.container.resolve("ajax"), n = pn.container.resolve("postmessage"), t = pn.container.resolve("util"), r = { enabled: !1, captcha3_site_key: "", aid: "" }, o = function (n) { e.request({ url: tp.getApiEndpoint() + "/anon/captcha/get.js", data: { aid: tp.aid }, dataType: "jsonp", jsonpCallback: "jsonpCallback", cache: !0, success: function (e) { !function (e, n) { e.config && e.config.enabled ? (r = e.config, n && n()) : e.message && t.error(e.message); }(e, n); } }); }; function i() { window.grecaptcha.ready(a), c(); } var a = function () { var e = document.createElement("div"); e.id = "tp-recaptcha", document.body.appendChild(e), window.grecaptcha.render("tp-recaptcha", { sitekey: r.captcha3_site_key, size: "invisible", "error-callback": function () { e.style.display = "none"; } }); }, s = function () { window.onCaptchaV3Load = i; var e = document.createElement("script"); e.src = "https://www.google.com/recaptcha/api.js?onload=onCaptchaV3Load&render=explicit", e.type = "text/javascript", e.async = !0, e.defer = !0, document.head.appendChild(e); }, c = function () { n.subscribe("get-captcha-v3-enabled", (function () { l(); })), n.subscribe("get-captcha-v3-token", (function (e) { window.grecaptcha.ready((function () { return u(e.params.action); })); })); }, l = function () { n.broadcast("captcha-v3-enabled-value", { isEnabled: r.enabled }); }, u = function (e) { window.grecaptcha.execute({ action: e }).then((function (e) { n.broadcast("captcha-v3-token", { token: e }); })).catch((function () { n.broadcast("captcha-v3-token", { token: "" }); })); }; return { name: "captchaV3", addCaptchaV3: function () { o(s); } }; }();
    pn.container.register("captchaV3", { useValue: Sn }), pn.captchaV3 = pn.container.resolve("captchaV3");
    var xn = function (e) { void 0 === e && (e = pn.container); var n = e.resolve("log"), t = e.resolve("postmessage"), r = e.resolve("api"), o = e.resolve("util"), i = e.resolve("versionService"), a = "EVENT_TP_ERROR_HANDLER", s = "sdk", c = [], l = !0, u = function (e) { if (h() && !g(c, e)) {
        e.tags || (e.tags = ["unknown"]), e.aid = pn.aid, e.v = i.getTinypassVersion();
        var n = { details: e };
        c.push(n);
    } }; var d = function (e) { var n = e.params; Array.isArray(n) && n.forEach((function (e) { u(e); })); }; function p(e) { var n, t; if (e.message.toLowerCase().indexOf("script error") > -1)
        u({ message: "Probably that is Piano error.", url: window.location.href, tags: [s] });
    else {
        var r = null == e ? void 0 : e.error;
        if (v(null == r ? void 0 : r.stack))
            return !1;
        u({ stack: null !== (n = null == r ? void 0 : r.stack) && void 0 !== n ? n : "n/a", message: null !== (t = null == r ? void 0 : r.message) && void 0 !== t ? t : "n/a", userAgent: navigator.userAgent, tags: [s] });
    } return !1; } var f = function () { setInterval((function () { m(), l = !1; }), 15e3); }, m = function () { var e = c.filter((function (e) { return !e.send; })); if (0 !== e.length) {
        var t = e.map((function (e) { return e.details; })), o = { type: "console-error-message", srcType: "ts", log_message: JSON.stringify(t) };
        n.logBeaconRequest(r.getEndpoint() + "/anon/error/log", o), e.forEach((function (e) { return e.send = !0; }));
    } }, g = function (e, n) { var t = e.map((function (e) { return JSON.stringify(e.details); })), r = JSON.stringify(n); return -1 !== t.indexOf(r); }, v = function (e) { return -1 === (null == e ? void 0 : e.indexOf("tinypass")); }, h = function () { return !!o.__protected__.getLocalStorageItem("tinypassErrorHandlerTestMode") || 0 === w(0, 1e3); }, w = function (e, n) { var t = e - .5 + Math.random() * (n - e + 1); return Math.round(t); }, y = function (e, n) { return void 0 === e && (e = []), n ? e.concat(n) : e; }; return { name: "tinypassErrorHandler", addError: function (e, n) { try {
            var t = { place: n, tags: [s] };
            e instanceof Error ? (t.stack = e.stack, t.message = e.message) : t.stack = JSON.stringify(e), l && (t.tags = y(t.tags, "initError")), u(t);
        }
        catch (e) { } }, initialize: function () { try {
            pn.isSandbox() || (t.subscribe(a, d), null === (e = window.addEventListener) || void 0 === e || e.call(window, "error", p), f());
        }
        catch (e) {
            console.warn("Cannot start watching errors", e);
        } var e; } }; };
    pn.container.register("tinypassErrorHandler", { useValue: xn() }), pn.tinypassErrorHandler = pn.container.resolve("tinypassErrorHandler");
    var Pn = function (e) { void 0 === e && (e = pn.container); var n = e.resolve("api"), t = e.resolve("cookie"), r = e.resolve("log"), o = e.resolve("jqUtils"), i = e.resolve("util"), a = e.resolve("logging"), s = e.resolve("fingerprint"), c = e.resolve("user"), l = e.resolve("sha1"), u = e.resolve("activetimer"), d = e.resolve("scrollDepth"), p = e.resolve("doubleClickForPublisher"), f = e.resolve("offer"), m = e.resolve("viewportExit"), g = e.resolve("idle"), v = e.resolve("experience"), h = e.resolve("pianoId"), w = e.resolve("pianoEsp"), y = e.resolve("applePayIntegrationService"), b = e.resolve("datatransApplePayIntegrationService"), k = e.resolve("cxense"); e.resolve("tinypassErrorHandler"); var _ = e.resolve("captchaV3"), C = pn.container.resolve("postmessage"), I = "exrs", S = null, x = "voucher_code", P = "__pvi", E = !1, T = !1, A = {}, M = null, O = k.__protected__.getOrGenerateCxCompatibleBid(), R = { APPLE_PAY_BT: 25, APPLE_PAY_SS: 38, APPLE_PAY_STRIPE: 41, APPLE_PAY_PW: 42, DATATRANS_APPLE_PAY: 61 }, L = new Set(Object.values(R)), N = void 0, U = [], j = !1, D = !1, F = function () { if ("iP" === navigator.platform.substr(0, 2)) {
        var e = /constructor/i.test(window.HTMLElement), n = window.navigator, t = n.userAgent, r = !!window.indexedDB;
        if (-1 === t.indexOf("Safari") || -1 === t.indexOf("Version") || n.standalone) {
            if (!r && e || !window.statusbar.visible)
                ;
            else if (window.webkit && window.webkit.messageHandlers || !e || r)
                return !0;
        }
        else
            ;
    } return !1; }(); var B, V, q, z = function () { var e; try {
        e = JSON.parse(i.__protected__.getCookie(P));
    }
    catch (n) {
        e = {};
    } return e; }, H = function () { return i.getCurrentDomainFromCookie(P); }, W = function (e, n) { var t = A; A = {}; var r = {}; for (var o in t)
        if (t.hasOwnProperty(o))
            for (var i in r[o] = r[o] || [], t[o])
                t[o].hasOwnProperty(i) && r[o].push(t[o][i]); be(r, e, n); }, J = function () { if (v.execute.invokeCount > 0) {
        var e = G();
        return Ce() && Ie(re(), e, pn.cxenseSiteId), e;
    } return Ce() ? k.__protected__.tryToGetCxPageViewId(Se()) : G(); }; function G() { function e(e, n, t) { t = t || "0"; var r = String(e); return r.length >= n ? r : new Array(n - r.length + 1).join(t) + r; } if (Ce())
        return Se(); var n = i.randomString(16), t = l.hash([s.getFingerprint(), window.location.href].join("")), r = new Date; return [[e(r.getFullYear(), 4), e(r.getMonth() + 1, 2), e(r.getDate(), 2), e(r.getHours(), 2), e(r.getMinutes(), 2), e(r.getSeconds(), 2), e(r.getMilliseconds(), 3)].join("-"), n, t].join("-"); } var Q = function (e) { var n = { path: "/", expires: 1, domain: V.currentDomain }; return e && (n.domain = e), n; }, X = function (e, n) { e.domain = n.domain, e.time = (new Date).getTime(), i.__protected__.setCookie(P, JSON.stringify(e), n); }, $ = function (e) { var n = (new Date).getTime(), t = 6e4 * i.getBrowserTimezoneOffset(), r = i.getAppTimezoneOffset(), o = new Date(e.time).setHours(0, 0, 0, 0) + 864e5 - t - r; return e.time + 18e5 < n || n >= o; }, Y = function () { if (i.__protected__.cameFromFbSubscriptions())
        return !1; if (!V.currentDomain)
        return !1; var e = i.getReferrer(); if (M && M === e)
        return !1; var n = i.getHostname(e), t = new RegExp(V.currentDomain.replace(/\./g, "\\.").replace(/^\\./, "\\.?") + "$").test(n); return Boolean(n) && !t; }, K = function () { var e = z(); (!e || !e.id || !e.time || $(e) || Y()) && (e.id = "v-" + G()), function (e) { var n = Q(); e.domain || V.currentDomain ? X(e, n) : i.waitCall("domainIsReceived", (function (t) { ce(t), n.domain = t, X(e, n); })); }(e), V.visit = e; }, Z = function (e, n, t) { var r, a, c = "manual"; if (void 0 === n)
        n = window.location.href;
    else {
        if ("object" != typeof n)
            throw new Error("First parameter to track page must be a URL or an object");
        var l = n;
        if (void 0 === l.url)
            throw new Error("Must supply url property");
        n = l.url, void 0 !== l.tags && (t = l.tags), void 0 !== l.submitType && (c = l.submitType);
    } t || (t = pn.tags), pn.customPageUrl && (e.custom_page_url = i.prepareUrlParameter(pn.customPageUrl)), void 0 !== t ? "[object Array]" !== Object.prototype.toString.call(t) && "[object String]" !== Object.prototype.toString.call(t) ? (i.log("Tags must be an array or a comma-separated string, ignoring supplied tags"), t = "") : t instanceof Array && (t = t.join(",")) : t = "", q.track(), e.page_session_id = q.pageSessionId, e.track_count = q.trackCount, we(e), pn.contentCreated ? a = pn.contentCreated : pn.contentCreatedSelector && o.queryEl(pn.contentCreatedSelector) && (a = null === (r = o.queryEl(pn.contentCreatedSelector)) || void 0 === r ? void 0 : r.innerHTML), a && (e.content_created = a), "boolean" == typeof pn.contentIsNative && (e.content_is_native = pn.contentIsNative), pn.zone && (e.zone = pn.zone), pn.itemId && (e.item_id = pn.itemId); var u = pn.contentSection || se("section"); u && (e.content_section = u); var d = pn.contentAuthor || se("author"); d && (e.content_author = d); var p = pn.contentId || se("id"); p && (e.content_id = p); var f, m = i.__protected__.getCookie("sailthru_hid"); m && (e.sailthru_hid = m), M && M === i.getReferrer() ? f = "" : (f = i.getReferrer(), M = f), e.referer = i.prepareUrlParameter(f), t && (e.tags = t), e.url = i.prepareUrlParameter(n), e.fingerprint = s.getFingerprint(), e.adblocker = i.getAdblockStatus(), e.adblocker !== i.ADBLOCKER_STATUS.ENABLED_AFTER_DISABLED && e.adblocker !== i.ADBLOCKER_STATUS.ENABLED || (pn.setCustomParam("_abr", i.getAdblockerStatusReason(), "user", !0), pn.setCustomParam("_absh", i.getAdblockerHistoryCookieInfo().cookieValue + "", "user", !0)), e.timezone_offset = i.getBrowserTimezoneOffset(), e.submit_type = c; var g = ae(); return e.visit_id = g, e.new_visit = oe(g), e.keywords = o.getAttr('meta[name="keywords"]', "content") || o.getAttr('meta[name="news_keywords"]', "content") || "", e.title = o.getAttr('meta[property="og:title"]', "content") || "", e.description = o.getAttr('meta[property="og:description"]', "content") || "", e.content_type = o.getAttr('meta[property="og:type"]', "content") || "", ["keywords", "title", "description", "content_type"].forEach((function (n) { e[n] = e[n].substr(0, 8192); })), e.custom_variables = JSON.stringify(pn.customVariables), ne(e), e; }, ee = function () { var e = { aid: pn.aid }, n = i.getTbcCookie(), t = { active: u.getActiveTimeInSeconds(), total: u.getTotalTimeInSeconds() }; n && (e.tbc = n), t.total < t.active && (t.total = t.active), e.time_spent = JSON.stringify(t), e.scroll = JSON.stringify({ max_page_height: d.getMaxDocumentHeight(), max_depth: d.getMaxScrollDepth() }), e.viewport_exit = m.getSumOfCodesDirection(), e.url = i.prepareUrlParameter(window.location.href), we(e), e.visit_id = ae(), ie(); var r = {}, a = p.getAds(200); return a.length && (r.dfp = a), o.isEmptyObject(r) || (e.ads = JSON.stringify(r)), e; }, ne = function (e) { var n = {}; return pn.customParams && (n = o.deepExtend({}, pn.customParams)), o.isEmptyObject(n) || (e.custom_params = JSON.stringify(n)), e; }, te = function () { return q.id; }, re = function () { return O; }, oe = function (e) { var n = V.lastTrackedVisitId !== e; return V.lastTrackedVisitId = e, n; }, ie = function () { V.checkForRefresh = !0; }, ae = function () { return V.checkForRefresh && (K(), V.checkForRefresh = !1), V.visit.id; }, se = function (e) { return (document.head.querySelector("meta[name=" + e + "]") || {}).content; }, ce = function (e) { V.currentDomain = e; }, le = function () { return !(pn.endpoint && pn.endpoint.match(/sandbox/)); }, ue = function (e, t, r, o) { pn.aid && 0 !== pn.aid.length ? le() && i.waitCall("refreshAccessTokenList", (function () { i.waitCall("offerCreate", (function () { a.setTime("track"), i.startCall("pageTrack"), n.callApi(e, t, (function (e) { i.doneCall("pageTrack"), r && r(e); }), pn.getTrackingEndpoint() + "/api/v3", o); })); })) : i.log("Must supply a valid tp.aid before calling tp.init()"); }, de = function () { E && q.trackCount > 0 && (pe(), he()); }, pe = function (e) { if (le())
        try {
            var n = ee();
            m.isInitialized() && m.resetSumOfCodesDirectionToDefault(), r.logBeaconRequest(pn.getTrackingEndpoint() + "/api/v3/page/unload", n), ge();
        }
        catch (e) {
            i.error("main: error on tracking page unload event: ", e);
        } }, fe = function () { T || (T = !0, pe()); }, me = function () { E = !0; }, ge = function () { E = !1; }, ve = function () { E && fe(), W(!0, "beacon_request"), v.__protected__.sendStatisticsExecutedNodes("unload"); }, he = function () { u.resetRecordedTime(); }, we = function (e) { e && (e.pageview_id = te()); }, ye = function (e, n) { if (le())
        try {
            de();
            var t = Z({}, e, n);
            ue("/page/track", t), me();
        }
        catch (e) {
            i.error("main: error on page tracking event: ", e);
        } }, be = function (e, n, t) { }, ke = function () { var e = i.getQueryParamByName(x); e && f.startRedeemVoucher({ voucherCode: e }); }, _e = function () { return S || (S = new Promise((function (e) { if (null !== i.__protected__.getLocalStorageItem(I) && e({ has_active_apple_pay_card: i.__protected__.getLocalStorageItem(I) }), !pn.applePayMerchantId)
        return e({ has_active_apple_pay_card: null }), S; Pe().then((function (n) { var t = function (n) { e({ has_active_apple_pay_card: n }), i.__protected__.setLocalStorageItem(I, n, 7200); }; n ? y.__protected__.applePayCanMakePaymentsWithActiveCard().then(t) : t(null); })); })), S); }; function Ce() { return k.__protected__.isActivated(); } var Ie = function (e, n, t) { return k.__protected__.injectIds(!1, e, n, t); }, Se = function () { return i.__protected__.randomStringCxCompatible(); }; function xe(e) { return function (n) { var t = n.params; void 0 === N && (N = function (e) { if (!Array.isArray(e) || !e.length)
        return !1; for (var n = 0, t = e; n < t.length; n++) {
        var r = t[n];
        if (L.has(r))
            return !0;
    } return !1; }(t)), U = t || [], e(N); }; } function Pe() { return void 0 !== N ? Promise.resolve(N) : F ? (N = !1, Promise.resolve(!1)) : new Promise((function (e) { v.registerCallback("experienceFlow", (function () { N = !0, e(!0); })), C.subscribe("ACTIVE_PAYMENT_METHODS_IDS_INITIALIZED", xe(e)), C.subscribe("MY_ACCOUNT_ACTIVE_PAYMENT_METHODS_IDS_INITIALIZED", xe(e)); })); } return { name: "main", fetchVisitId: ae, trackPageUnloadIfNecessary: de, externalResourcesDelay: _e, pageTrack: ye, trackPage: function (e, n) { return ye(e, n); }, buildPageTrackParams: Z, fetchPageViewId: te, fetchCxBrowserId: re, trackPageUnload: pe, registerTrackUnload: me, isRegisteredTrackUnload: function () { return E; }, unregisterTrackUnload: ge, resetTimer: he, resetAds: function () { p.resetAds(); }, trackAd: function (e, n, t) { A[e] || (A[e] = {}), A[e][n] = t, B(); }, init: function () { if (pn.aid && 0 !== pn.aid.length) {
            var e, n, t;
            B = i.debounce(W, 3e3), V = { currentDomain: H(), lastTrackedVisitId: z().id, visit: {}, checkForRefresh: !1 }, q = { id: J(), pageSessionId: "s-" + G(), trackCount: 0, tracked: !1, track: function () { q.tracked ? q.id = J() : q.tracked = !0, q.trackCount++; } }, Ce() && (e = re(), n = te(), t = pn.cxenseSiteId, k.__protected__.injectIds(!0, e, n, t)), K(), pn.isMockMode || (o.isFunction(p.initialize) && p.initialize(), o.isFunction(u.initialize) && u.initialize(), o.isFunction(d.initialize) && d.initialize()), o.isFunction(g.initialize) && g.initialize(), Pe().then((function (e) { e && (!j && o.isFunction(y.initialize) && (j = !0, y.initialize()), D || -1 !== U.indexOf(R.DATATRANS_APPLE_PAY) && o.isFunction(b.initialize) && (D = !0, b.initialize())); })), o.isFunction(w.__protected__.init) && setTimeout((function () { w.__protected__.init().catch((function () { })); }), 5e3), o.isFunction(c.refreshAccessToken) && c.refreshAccessToken(), _e();
            var r = c.getProvider();
            r && o.isFunction(r.extendUserToken) && r.extendUserToken(), o.on(window, "beforeunload", (function () { return ve(); })), o.on(window, "unload", (function () { return ve(); })), _.addCaptchaV3();
        }
        else
            i.log("Must supply a valid tp.aid before calling tp.init()"); }, checkToRunWidgetImmediately: function () { var e; ke(), (e = i.getQueryParamByName("verification_code")) && "pianoId" === c.getProvider().name && i.waitCall("offerCreate", (function () { h.isUserValid() ? h.__protected__.showEmailConfirmation({ verification_code: e }) : h.show({ verification_code: e }); })), h.checkAndShowEmailIsNotConfirmed(), o.isFunction(f.checkThreeDSRedirect) && f.checkThreeDSRedirect(); }, trackAds: be, appHasApplePay: function () { return N; }, __private__: { VISIT_ID_COOKIE: P, VOUCHER_QUERY: x, collectedAds: A, unloadRegistered: E, unloadTriggered: T, getPageView: function () { return q; }, getVisitContainer: function () { return V; }, track: ue, checkVoucher: ke, setPageViewId: we, currentEnvironmentSupportsPageTrack: le, buildPageUnloadParams: ee, invalidateLastVisit: function () { var e = Q(); t.remove(P, e); }, getCurrentDomain: H, loadLastVisit: z, setVisitCurrentDomain: ce, saveVisitCookie: X, getVisitCookieOptions: Q, isTimeExpired: $, refreshVisit: K, generatePageViewId: G, trackCollectedAds: W, unloadHandler: ve, unloadAction: fe, buildPageCustomParams: ne, hasExternalReferrer: Y } }; };
    pn.container.register("main", { useValue: Pn() }), pn.main = pn.container.resolve("main");
    var En = { predefineValues: [] };
    window.tp && window.tp.length && (En.predefineValues = _e([], window.tp || [], !0)), pn.tpPredefinedOptions = En, pn.container.register("tpPredefinedOptions", { useValue: En });
    var Tn = function () { function e(e, n, t, r, o) { this.tpPredefinedOptions = e, this.css = n, this.tinypassErrorHandler = t, this.gaService = r, this.utilService = o, this.fullTPVersion = !1, this.isInitialized = !1, this.aid = "", this.isSensitiveDataProtectionEnabled = !1, this.affiliateTokenName = "affiliateToken", this.cxCdnUrl = "https://cdn.cxense.com", this.c1XLoadCce = !0, this.c1XIntegrationVersion = "v2", this.cxenseLibAwaitingTimeout = 0, this.cxenseLibAwaitingRetryCount = 0, this.trackPages = !0, this.debug = !1, this.userRef = "", this.usePianoIdLiteUserProvider = !1, this.useTinypassAccounts = !1, this.useCondeUserProvider = !1, this.useGigyaUserProvider = !1, this.usePianoIdUserProvider = !1, this.useAidSpecifiedCookies = !1, this.sandbox = !1, this.zIndexes = { backdrop: 3e5, modal: 300050, close: 300100 }, this.customPreChecks = [], this.customParams = {}, this.externalLibraries = [], this.externalLibrariesCallbacks = [], this.customVariables = {}, this.locale = "", this.trackPageView = !0, this.redirectToFbTimeout = 3, this.isDoubleOptInCheckOnAccessCheckEnabled = !1, this.isMockMode = !1, this.inappBrowserReturn = !1, this.events = [], this.appList = [], this.cacheableShowTemplate = !0, this.initCallbacks = [], this.mainModuleInited = !1, this.restCallbacks = [], this.initTries = 0, this.callbacks = [], n.loadOfferCss(); } return e.prototype.initTp = function () { var e = this; try {
        var n = this.tpPredefinedOptions.predefineValues;
        if (this.tpPredefinedOptions.predefineValues = [], n.forEach((function (n) { "function" == typeof n[1] ? "init" === n[0] ? e.initCallbacks.push(n[1]) : e.restCallbacks.push(n) : "init" === n[1] && "function" == typeof n[2] ? e.initCallbacks.push(n[2]) : e.push(n); })), !this.aid && this.initTries < 10)
            return this.initTries++, void setTimeout((function () { return e.initTp(); }), 50);
        if (!this.aid)
            return;
        for (this.tinypassErrorHandler.initialize(); this.restCallbacks.length;)
            try {
                var t = this.restCallbacks.shift();
                this.push(t);
            }
            catch (e) {
                console.error(e), pn.tinypassErrorHandler.addError(e);
            }
        this._init(), this.externalLibraries.length && this.realizeExternalLibraries(), this.isInitialized = !0, window.___tp = function () { };
    }
    catch (e) {
        pn.tinypassErrorHandler.addError(e, "initTP");
    } }, e.prototype.realizeExternalLibraries = function () { var e = this, n = []; this.externalLibraries.forEach((function (t) { var r = e.requireJsFile(t); n.push(r); })), Promise.all(n).then((function () { if (e.externalLibraries = [], e.externalLibrariesCallbacks)
        for (var n = 0; n < e.externalLibrariesCallbacks.length; ++n)
            Mn.externalLibrariesCallbacks[n](); Mn.externalLibrariesCallbacks = []; })); }, e.prototype.push = function () { for (var e, n, t, r = [], o = 0; o < arguments.length; o++)
        r[o] = arguments[o]; for (e = 0; e < r.length; e++)
        if ("string" == typeof (n = (t = r[e]).shift()) || n instanceof String) {
            if (!this[n])
                return void console.error("Undefined method " + n);
            this[n].apply(this, t);
        }
        else
            n.apply(this, t); }, e.prototype.init = function (e) { this.isInitialized ? (this.mainModuleInited || (this.mainModuleInited = !0, this.initMainModuleAfterInitCbk()), e && e()) : (e && this.tpPredefinedOptions.predefineValues.push(["init", e]), this.initTp()); }, e.prototype._init = function () { if (pn.util && pn.util.hasQueryParamByName && pn.util.hasQueryParamByName("xpdebug") && pn.setDebug(!0), pn.util.setTpccCookies(), pn.util.isSafariOrIOsUiWebView() && !pn.user.isUserValid() && pn.util.getQueryParamByName("userToken")) {
        var e = pn.util.getQueryParamByName("cookieDomain"), n = pn.util.getQueryParamByName("userToken"), t = pn.util.getQueryParamByName("tokenListValue");
        pn.util.setAccessTokenListCookie({ cookie_domain: e, value: t }, n), pn.util.removeQueryParamByName("userToken"), pn.util.removeQueryParamByName("cookieDomain"), pn.util.removeQueryParamByName("tokenListValue");
    } if (this.mainModuleInited || (this.mainModuleInited = !0, this.initMainModuleAfterInitCbk()), !this.aid) {
        var r = new Error("Incorrect aid integration: " + Mn.aid + " url: " + window.location.href);
        this.tinypassErrorHandler.addError(r);
    } pn.logging.setTime("completeInit"); }, e.prototype.initMainModuleAfterInitCbk = function () { for (pn.user.providerInit(), this.appList.indexOf(this.aid) < 0 && (this.appList.push(this.aid), pn.main.init()); this.initCallbacks.length;)
        try {
            this.initCallbacks.shift()();
        }
        catch (e) {
            console.error(e), pn.tinypassErrorHandler.addError(e);
        } if (pn.main.checkToRunWidgetImmediately(), this.events) {
        for (var e = 0; e < this.events.length; e++)
            this.events[e]();
        this.events = [];
    } }, e.prototype.requireJsFile = function (e) { return new Promise((function (n, t) { var r = document.createElement("script"); r.onload = n, r.onerror = n, r.type = "text/javascript", r.charset = "utf-8", r.async = !0, r.src = e, document.getElementsByTagName("head")[0].appendChild(r); })); }, e.prototype.setAid = function (e) { this.aid = e; }, e.prototype.enableSensitiveDataProtection = function (e) { this.isSensitiveDataProtectionEnabled = e; }, e.prototype.reload = function () { location.href = pn.util.removeVoucherCodeFromUrl(location.href); }, e.prototype.removeSharedAccountCodeFromUrl = function () { location.href = pn.util.removeSharedAccountCodeFromUrl(location.href); }, e.prototype.setGAClientId = function (e) { this.gaClientId = e, this.gaService.recreateWithClientId(e); }, e.prototype.getGAClientId = function () { return this.gaClientId; }, e.prototype.enableGACrossDomainLinking = function (e) { var n = this; this.gaCrossDomainLinking = !0; var t = Date.now(), r = function () { var o = window.ga; if (o && "function" == typeof o)
        try {
            o((function (t) { if (void 0 !== t && void 0 === e)
                n.setGAClientId(t.get("clientId"));
            else if (void 0 !== e)
                for (var r = o.getAll(), i = 0; i < r.length; i++) {
                    var a = r[i];
                    if (a.get("trackingId") === e) {
                        n.setGAClientId(a.get("clientId"));
                        break;
                    }
                } }));
        }
        catch (e) { }
    else
        Date.now() - t < 6e4 && setTimeout(r, 500); }; r(); }, e.prototype.setTags = function (e) { this.tags = e instanceof Array ? e.join(",") : e; }, e.prototype.setCookieDomain = function (e) { "." !== e[0] && (e = "." + e), this.cookieDomain = e; }, e.prototype.setCookiePath = function (e) { this.cookiePath = e; }, e.prototype.setDontScrollTopModal = function (e) { this.dontScrollTopModal = e; }, e.prototype.setUseExperience = function (e) { this.useExperience = e; }, e.prototype.setExperimentalIosModal = function (e) { this.experimentalIosModal = e; }, e.prototype.setApplePayMerchantId = function (e) { this.applePayMerchantId = e; }, e.prototype.setContentIsNative = function (e) { this.contentIsNative = e; }, e.prototype.setComposerHost = function (e) { this.composerHost = e; }, e.prototype.setEndpoint = function (e) { this.endpoint = e; }, e.prototype.setAffiliateTokenName = function (e) { this.affiliateTokenName = e; }, e.prototype.setEspEndpoint = function (e) { this.espEndpoint = e; }, e.prototype.setCxCdnUrl = function (e) { this.cxCdnUrl = e; }, e.prototype.setC1XLoadCce = function (e) { this.c1XLoadCce = e; }, e.prototype.setC1XIntegrationVersion = function (e) { this.c1XIntegrationVersion = e; }, e.prototype.setCxenseSiteId = function (e) { this.cxenseSiteId = e; }, e.prototype.setCxenseLibAwaitingTimeout = function (e) { this.cxenseLibAwaitingTimeout = e; }, e.prototype.setCxenseLibAwaitingRetryCount = function (e) { this.cxenseLibAwaitingRetryCount = e; }, e.prototype.setContentId = function (e) { this.contentId = e; }, e.prototype.setTrackPages = function (e) { this.trackPages = e; }, e.prototype.setDebug = function (e) { this.debug = e; }, e.prototype.setUserRef = function (e) { this.userRef = e; }, e.prototype.setUsePianoIdLiteUserProvider = function (e) { this.usePianoIdLiteUserProvider = e; }, e.prototype.setExternalJWT = function (e) { this.externalJWT = e; }, e.prototype.getExternalJWT = function () { return this.externalJWT; }, e.prototype.setUseTinypassAccounts = function (e) { this.useTinypassAccounts = e; }, e.prototype.setUseCondeUserProvider = function (e) { this.useCondeUserProvider = e; }, e.prototype.setUseGigyaUserProvider = function (e) { this.useGigyaUserProvider = e; }, e.prototype.setUsePianoIdUserProvider = function (e) { this.usePianoIdUserProvider = e; }, e.prototype.setPianoIdUrl = function (e) { this.pianoIdUrl = e; }, e.prototype.setItemId = function (e) { this.itemId = e; }, e.prototype.setUseAidSpecifiedCookies = function (e) { this.useAidSpecifiedCookies = e; }, e.prototype.setSandbox = function (e) { this.sandbox = e; }, e.prototype.setContentCreatedSelector = function (e) { this.contentCreatedSelector = e; }, e.prototype.setContentCreated = function (e) { this.contentCreated = e; }, e.prototype.setContentAuthor = function (e) { this.contentAuthor = e; }, e.prototype.setContentSection = function (e) { this.contentSection = e; }, e.prototype.setZone = function (e) { this.zone = e || ""; }, e.prototype.isNonProdEndpoint = function () { return "sandbox" === this.endpoint || /^https?:\/\/(.*sandbox.*|\d+\.dev)\.(tinypass\.com|piano\.io)/i.test(this.endpoint); }, e.prototype.setZIndexes = function (e) { this.zIndexes = e; }, e.prototype.setCustomPreCheck = function (e) { this.customPreChecks.push(e); }, e.prototype.setCustomParam = function (e, n, t, r) { var o = ["content", "user", "request"]; if (t || (t = "content"), t = t.toLowerCase(), o.indexOf(t) < 0)
        throw new Error("Undefined scope " + t + "\nAvailable scopes: " + o.join(", ")); void 0 === this.customParams[t] && (this.customParams[t] = {}), (void 0 === this.customParams[t][e] || r) && (this.customParams[t][e] = []); for (var i = [].concat(n), a = 0; a < i.length; a++) {
        if ("string" != typeof i[a])
            throw new Error("setCustomParam accept only string values or array of strings");
        this.customParams[t][e].push(i[a]);
    } }, e.prototype.resetCustomParam = function (e) { e || (e = "content"), delete this.customParams[e]; }, e.prototype.addExternalLibrary = function (e, n) { if ("string" == typeof e)
        this.externalLibraries.push(e);
    else
        for (var t = 0; t < e.length; ++t)
            this.externalLibraries.push(e[t]); n && this.externalLibrariesCallbacks.push(n), this.isInitialized && this.realizeExternalLibraries(); }, e.prototype.setCustomVariable = function (e, n) { this.customVariables[e] = n; }, e.prototype.saveCustomVariablesToLocalStorage = function (e) { if (this.customVariables && "localStorage" in window && null !== window.localStorage) {
        var n = "__tp-customVariables";
        window.localStorage.setItem(n, JSON.stringify(this.customVariables)), e && window.localStorage.setItem(n + "-expiration", Math.floor((new Date).getTime() / 1e3) + e + "");
    } }, e.prototype.restoreCustomVaribalesFromLocalstorage = function () { if ("localStorage" in window && null !== window.localStorage) {
        var e = Mn.util.__protected__.getLocalStorageItem("customVariables");
        if (Mn.util.__protected__.removeLocalStorageItem("customVariables"), e)
            for (var n in e)
                this.customVariables[n] = e[n];
    } }, e.prototype.handler = function (e, n) { var t = this.registerPrefixedEvents; return function () { for (var r, o = [pn.offer, pn.template, pn.meter, pn.experience, pn.myaccount, pn.pianoId, pn.tinypassLogin, pn.swg, pn.user, pn.credit], i = 0; i < o.length; i++) {
        var a = o[i];
        if (a) {
            var s = a.registerCallback(e, n);
            void 0 !== s && (r = s), void 0 !== (s = t(a, e, n)) && (r = s);
        }
    } return r; }; }, e.prototype.registerPrefixedEvents = function (e, n, t) { for (var r, o, i, a = [{ module: "offer", prefix: "checkout" }, { module: "pianoId", prefix: "pianoId" }], s = 0; s < a.length; s++) {
        var c = a[s];
        e.name === c.module && n.substring(0, c.prefix.length) === c.prefix && (r = n.substring(c.prefix.length, c.prefix.length + 1).toLowerCase() + n.substring(c.prefix.length + 1, n.length), void 0 !== (o = e.registerCallback(r, t)) && (i = o));
    } return i; }, e.prototype.addHandler = function (e, n) { var t = this.handler(e, n); this.isInitialized ? t() : this.events.push(t); }, e.prototype.setTrackPageview = function (e) { this.trackPageView = e; }, e.prototype.setLocale = function (e) { var n = this; this.locale = e, this.utilService.__protected__.setCookie("LANG", this.locale), this.isInitialized ? this.changeLocale(e) : this.initCallbacks.push((function () { n.changeLocale(e); })); }, e.prototype.setPageURL = function (e) { this.customPageUrl = e; }, e.prototype.setAdblockerCookieName = function (e) { this.adblockerCookieName = e; }, e.prototype.setMaxCookieExpirationInDays = function (e) { var n = "string" == typeof e ? parseInt(e, 10) : e; if (!(isFinite(n) && n > 0))
        throw new Error("maxCookieExpirationInDays must be a positive number"); this.maxCookieExpirationInDays = n; }, e.prototype.getMaxCookieExpirationInDays = function () { return this.maxCookieExpirationInDays; }, e.prototype.setFbPixelId = function (e) { this.fbPixelId = e; }, e.prototype.getFbPixelId = function () { return this.fbPixelId; }, e.prototype.setRedirectToFbTimeout = function (e) { this.redirectToFbTimeout = e; }, e.prototype.enableDoubleOptInCheckOnAccessCheck = function () { this.isDoubleOptInCheckOnAccessCheckEnabled = !0; }, e.prototype.setCloudflareWorkerUrl = function (e) { this.cloudflareWorkerUrl = e; }, e.prototype.getEndpoint = function (e, n) { return e.lastIndexOf("/") === e.length - 1 && (e = e.substr(0, e.length - 1)), e.match(/\/v3$/) && (e = e.substr(0, e.lastIndexOf("/v3"))), e.match(/\/api$/) && (e = e.substr(0, e.lastIndexOf("/api"))), e.match(/^(http[s]?:)?\/\//) || (e = "//" + e), void 0 !== n && n && !e.match(/^http[s]?:/) && (e = "https:" + e), e; }, e.prototype._getEndpointRoot = function (e) { var n = "https://buy.tinypass.com"; return !0 === this.sandbox && (this.endpoint = "sandbox"), this.endpoint && ("sandbox" === this.endpoint ? n = "https://sandbox.tinypass.com" : "prod" !== this.endpoint && "production" !== this.endpoint && (n = this.endpoint)), this.getEndpoint(n, e); }, e.prototype._getApiEndpoint = function () { return this._getEndpointRoot() + "/api/v3"; }, e.prototype._getTrackingEndpoint = function (e) { void 0 === e && (e = ""); var n = e || this.endpoint; return !0 === this.sandbox ? n = "https://sandbox.tinypass.com" : (void 0 === this.endpoint || null === this.endpoint || "" === this.endpoint || "prod" === this.endpoint || "production" === this.endpoint || this.endpoint.match(/(buy|api|api-v3)\.tinypass\.com/)) && (n = e || "https://api-v3.tinypass.com"), this.getEndpoint(n, !0); }, e.prototype._getExperienceEndpoint = function (e) { var n = "https://c2.piano.io"; return this.composerHost ? n = this.composerHost : (!0 === this.sandbox && (this.endpoint = "sandbox"), this.endpoint && ("sandbox" === this.endpoint ? n = "https://c2-sandbox.piano.io" : "prod" !== this.endpoint && "production" !== this.endpoint && (n = (n = (n = (n = (n = (n = (n = (n = (n = (n = (n = (n = (n = (n = (n = (n = (n = (n = this.endpoint).replace("//buy.tinypass.com", "//c2.piano.io")).replace("//api.tinypass.com", "//c2.piano.io")).replace("//buy-au.piano.io", "//c2-au.piano.io")).replace("//api-au.piano.io", "//c2-au.piano.io")).replace("//buy-ap.piano.io", "//c2-ap.piano.io")).replace("//api-ap.piano.io", "//c2-ap.piano.io")).replace("//buy-eu.piano.io", "//c2-eu.piano.io")).replace("//api-eu.piano.io", "//c2-eu.piano.io")).replace("//sandbox.tinypass.com", "//c2-sandbox.piano.io")).replace("//sandbox.piano.io", "//c2-sandbox.piano.io")).replace("//experience-au.piano.io", "//c2-au.piano.io")).replace("//experience-eu.piano.io", "//c2-eu.piano.io")).replace("//experience-ap.piano.io", "//c2-ap.piano.io")).replace("//experience.tinypass.com", "//c2.piano.io")).replace("//buy.piano.io", "//c2.piano.io")).replace("//api.piano.io", "//c2.piano.io")).replace("//experience.piano.io", "//c2.piano.io")))), this.getEndpoint(n, e); }, e.prototype._isSandbox = function () { return this.sandbox || "sandbox" === this.endpoint || !!this.endpoint && -1 !== this.endpoint.indexOf("//sandbox.tinypass.com"); }, e.prototype.changeLocale = function (e) { pn.pianoId.isConfigured() && pn.pianoId.updateLang(e), pn.postmessage.broadcast("langChanged", { lang: e }); }, e.prototype.pageTrack = function (e, n) { pn.main.pageTrack(e, n); }, e.prototype.trackPage = function (e, n) { pn.main.pageTrack(e, n); }, e.prototype.trackPageUnload = function () { pn.main.trackPageUnload(); }, e.prototype.trackAds = function (e) { pn.main.trackAds(e); }, e.prototype.trackAd = function (e, n, t) { pn.main.trackAd(e, n, t); }, e.prototype.onLoad = function (e) { this.callbacks.push(e); }, e.prototype.getEndpointRoot = function (e) { return this._getEndpointRoot(e); }, e.prototype.getExperienceEndpoint = function (e) { return this._getExperienceEndpoint(e); }, e.prototype.getApiEndpoint = function () { return this._getApiEndpoint(); }, e.prototype.getTrackingEndpoint = function (e) { return void 0 === e && (e = ""), this._getTrackingEndpoint(e); }, e.prototype.isSandbox = function () { return this._isSandbox(); }, e.prototype.setCacheableShowTemplate = function (e) { this.cacheableShowTemplate = e; }, e.prototype.getCacheableShowTemplate = function () { return this.cacheableShowTemplate; }, e = function (e, n, t, r) { var o, i = arguments.length, a = i < 3 ? n : null === r ? r = Object.getOwnPropertyDescriptor(n, t) : r; if ("object" == typeof Reflect && "function" == typeof Reflect.decorate)
        a = Reflect.decorate(e, n, t, r);
    else
        for (var s = e.length - 1; s >= 0; s--)
            (o = e[s]) && (a = (i < 3 ? o(a) : i > 3 ? o(n, t, a) : o(n, t)) || a); return i > 3 && a && Object.defineProperty(n, t, a), a; }([pn.singleton(), be(0, pn.inject("tpPredefinedOptions")), be(1, pn.inject("css")), be(2, pn.inject("tinypassErrorHandler")), be(3, pn.inject("gaService")), be(4, pn.inject("util")), ke("design:paramtypes", [Object, Object, Object, Object, Object])], e), e; }();
    pn.container.registerSingleton("tinypass", Tn);
    var An = pn.container.resolve("tinypass");
    [{ n: "polyfill", hM: !1 }, { n: "predefine", hM: !1 }, { n: "predefineTinypass", hM: !1 }, { n: "checkTinypass", hM: !1 }, { n: "css", hM: !0 }, { n: "ajax", hM: !0 }, { n: "jqUtils", hM: !0 }, { n: "cookie", hM: !0 }, { n: "localStorage", hM: !0 }, { n: "versionService", hM: !0 }, { n: "itp", hM: !0 }, { n: "util", hM: !0 }, { n: "api", hM: !0 }, { n: "postmessage", hM: !0 }, { n: "eventUtils", hM: !0 }, { n: "janrain", hM: !0 }, { n: "sha1", hM: !0 }, { n: "containerUtils", hM: !0 }, { n: "tinypassLogin", hM: !0 }, { n: "tinypassAccounts", hM: !0 }, { n: "condeUserProvider", hM: !0 }, { n: "gigya", hM: !0 }, { n: "jwtDecode", hM: !0 }, { n: "log", hM: !0 }, { n: "logging", hM: !0 }, { n: "observer", hM: !0 }, { n: "gaService", hM: !0 }, { n: "pianoIdLite", hM: !0 }, { n: "pianoId", hM: !0 }, { n: "user", hM: !0 }, { n: "viewportExit", hM: !0 }, { n: "template", hM: !0 }, { n: "offer", hM: !0 }, { n: "myaccount", hM: !0 }, { n: "meter", hM: !0 }, { n: "fingerprint", hM: !0 }, { n: "scrollDepth", hM: !0 }, { n: "idle", hM: !0 }, { n: "interaction", hM: !0 }, { n: "recWidgetService", hM: !0 }, { n: "piano", hM: !0 }, { n: "pianoEsp", hM: !0 }, { n: "swg", hM: !0 }, { n: "fbpixel", hM: !0 }, { n: "fbsubscriptions", hM: !0 }, { n: "cxense", hM: !0 }, { n: "experience", hM: !0 }, { n: "ifvisible", hM: !0 }, { n: "activetimer", hM: !0 }, { n: "doubleClickForPublisher", hM: !0 }, { n: "applePay", hM: !0 }, { n: "goCardlessDropin", hM: !0 }, { n: "applePayIntegrationService", hM: !0 }, { n: "datatransApplePayIntegrationService", hM: !0 }, { n: "stripeApplePayIntegrationService", hM: !0 }, { n: "obi3DSChallenge", hM: !0 }, { n: "amp", hM: !0 }, { n: "performanceMetrics", hM: !0 }, { n: "doubleOptIn", hM: !0 }, { n: "newscycle", hM: !0 }, { n: "captchaV3", hM: !0 }, { n: "main", hM: !0 }, { n: "tinypassErrorHandler", hM: !0 }, { n: "tinypass", hM: !0 }, { n: "postProcessing", hM: !1 }].forEach((function (e) { e.hM && !pn.container.isRegistered(e.n) && pn.container.resolve(e.n); })), Object.assign(pn, An), Object.setPrototypeOf(pn, Tn.prototype);
    var Mn = window.tp = pn;
    pn.initTp(), console.log("Piano SDK 2.0 loaded.");
    e.cxense = ln, e.experience = un, e.jqUtils = de, e.log = Oe, e.main = Pn, e.offer = Ge, e.pianoEsp = on, e.pianoId = qe, e.postProcessing = "postProcessing", e.tinypassErrorHandler = xn, e.user = He, e.util = Ce, Object.defineProperty(e, "__esModule", { value: !0 });
}({});
//# sourceMappingURL=tinypass.js.map

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/compat get default export */
/******/ 	(() => {
/******/ 		// getDefaultExport function for compatibility with non-harmony modules
/******/ 		__webpack_require__.n = (module) => {
/******/ 			var getter = module && module.__esModule ?
/******/ 				() => (module['default']) :
/******/ 				() => (module);
/******/ 			__webpack_require__.d(getter, { a: getter });
/******/ 			return getter;
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/define property getters */
/******/ 	(() => {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = (exports, definition) => {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	(() => {
/******/ 		__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	(() => {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = (exports) => {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	})();
/******/ 	
/************************************************************************/
var __webpack_exports__ = {};
// This entry need to be wrapped in an IIFE because it need to be in strict mode.
(() => {
"use strict";
/*!*****************!*\
  !*** ./main.js ***!
  \*****************/
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _dist_index__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../dist/index */ "../dist/index.js");


const mixpanelPresented = {
    service: 'mixpanel',
    action: 'Membership Block',
    status: 'Presented',
};
const mixpanelAccepted = {
    service: 'mixpanel',
    action: 'Membership Block',
    status: 'Accepted',
};

const anon = [["userSegment", 'demon']];

const piano = new _dist_index__WEBPACK_IMPORTED_MODULE_0__["default"]({
    adServicer: 'piano',
    matchers: anon,
    thirdPartyCallbacks: [
        mixpanelPresented,
        mixpanelAccepted,
    ],
    tags: [["testing"]],
});

piano.dispatchAd();
})();

/******/ })()
;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q0FBK0MsSUFBSSw4QkFBOEIsSUFBSSxrQkFBa0IsSUFBSSxpQ0FBaUMsSUFBSSwwQkFBMEIsSUFBSSx3QkFBd0IsSUFBSSx3QkFBd0IsSUFBSSxtQkFBbUIsSUFBSSxtQ0FBbUMsSUFBSSx1QkFBdUIsSUFBSSw2QkFBNkIsMEJBQTBCLHVFQUF1RTtBQUMxOUQ7QUFDQTtBQUNBLG1RQUFtUSxXQUFXO0FBQzlRLENBQUMsR0FBRztBQUNKOzs7Ozs7VUNyakZBO1VBQ0E7O1VBRUE7VUFDQTtVQUNBO1VBQ0E7VUFDQTtVQUNBO1VBQ0E7VUFDQTtVQUNBO1VBQ0E7VUFDQTtVQUNBO1VBQ0E7O1VBRUE7VUFDQTs7VUFFQTtVQUNBO1VBQ0E7Ozs7O1dDdEJBO1dBQ0E7V0FDQTtXQUNBO1dBQ0E7V0FDQSxpQ0FBaUMsV0FBVztXQUM1QztXQUNBOzs7OztXQ1BBO1dBQ0E7V0FDQTtXQUNBO1dBQ0EseUNBQXlDLHdDQUF3QztXQUNqRjtXQUNBO1dBQ0E7Ozs7O1dDUEE7Ozs7O1dDQUE7V0FDQTtXQUNBO1dBQ0EsdURBQXVELGlCQUFpQjtXQUN4RTtXQUNBLGdEQUFnRCxhQUFhO1dBQzdEOzs7Ozs7Ozs7Ozs7O0FDTnFDOztBQUVyQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQSxrQkFBa0IsbURBQVE7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDOztBQUVELG1CIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZXhhbXBsZS8uLi9kaXN0L2luZGV4LmpzIiwid2VicGFjazovL2V4YW1wbGUvLi4vZGlzdC9waWFuby1hZGFwdGVyLmpzIiwid2VicGFjazovL2V4YW1wbGUvLi4vZGlzdC9waWFuby9pbmRleC5qcyIsIndlYnBhY2s6Ly9leGFtcGxlLy4uL2Rpc3QvcGlhbm8vdGlueXBhc3MuanMiLCJ3ZWJwYWNrOi8vZXhhbXBsZS93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9leGFtcGxlL3dlYnBhY2svcnVudGltZS9jb21wYXQgZ2V0IGRlZmF1bHQgZXhwb3J0Iiwid2VicGFjazovL2V4YW1wbGUvd2VicGFjay9ydW50aW1lL2RlZmluZSBwcm9wZXJ0eSBnZXR0ZXJzIiwid2VicGFjazovL2V4YW1wbGUvd2VicGFjay9ydW50aW1lL2hhc093blByb3BlcnR5IHNob3J0aGFuZCIsIndlYnBhY2s6Ly9leGFtcGxlL3dlYnBhY2svcnVudGltZS9tYWtlIG5hbWVzcGFjZSBvYmplY3QiLCJ3ZWJwYWNrOi8vZXhhbXBsZS8uL21haW4uanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFBpYW5vQWRhcHRlciBmcm9tIFwiLi9waWFuby1hZGFwdGVyXCI7XG4vKipcbiAqXG4gKiAgV2hlbiB3ZSBkZWNpZGUgdG8gYWQgYSBuZXcgYWQgc2VydmljZSB3ZSB3aWxsIGhhdmUgdG8gY2hhbmdlIHRoZSB0eXBlIG9mIGFkU2VydmljZXJcbiAqICBDdXJyZW50bHkgaXQgaXMganVzdCByZWxpYW50IG9uIHRoZSBQaWFub0FkYXB0ZXIsIGJ1dCBpdCBjb3VsZCBiZSBhbnkgYWRhcHRlciB0aGF0IHJlc3BvbmRzIHRvXG4gKiAgLmluaXQoKSBhbmQgdGFrZXMgdGhlIGxpZmVjeWNsZSBtZXRob2RzIGFsb25nIHdpdGggbWF0Y2hlcnMvdGFncy5cbiAqXG4gKi9cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEFkU2VydmVyIHtcbiAgICBjb25zdHJ1Y3Rvcih7IGFmdGVyQWRSZW5kZXIgPSBbXSwgYWZ0ZXJBZEluaXQgPSBbXSwgYmVmb3JlQWRJbml0ID0gW10sIG1hdGNoZXJzID0gW10sIHRoaXJkUGFydHlDYWxsYmFja3MgPSBbXSwgdGFncyA9IFtdLCBhZFNlcnZpY2VyLCB9KSB7XG4gICAgICAgIHRoaXMuYWZ0ZXJBZEluaXQgPSBhZnRlckFkSW5pdDtcbiAgICAgICAgdGhpcy5hZnRlckFkUmVuZGVyID0gYWZ0ZXJBZFJlbmRlcjtcbiAgICAgICAgdGhpcy5iZWZvcmVBZEluaXQgPSBiZWZvcmVBZEluaXQ7XG4gICAgICAgIHRoaXMubWF0Y2hlcnMgPSBtYXRjaGVycztcbiAgICAgICAgdGhpcy50YWdzID0gdGFncztcbiAgICAgICAgdGhpcy50aGlyZFBhcnR5Q2FsbGJhY2tzID0gdGhpcmRQYXJ0eUNhbGxiYWNrcztcbiAgICAgICAgdGhpcy51c2VyID0gdGhpcy5zZXRVc2VyKCk7XG4gICAgICAgIHRoaXMuYWRTZXJ2aWNlciA9IHRoaXMuc2V0QWRhcHRlcihhZFNlcnZpY2VyKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogU2V0cyB1cCB0aGUgYWRhcHRlciBmb3Igb3VyIEFkIFNlcnZpY2VcbiAgICAgKiBBZGFwdGVycyBhcGk6XG4gICAgICogVG8gcmVuZGVyIGEgdGVtcGxhdGUgaXQgUkVRVUlSRVMgYW4gaW5pdCgpIG1ldGhvZFxuICAgICAqIFRvIGludGVyYWN0IHdpdGggdGhpcmQtcGFydHkgc2VydmljZXMgdGhlIGFkYXB0ZXIgY29uc3RydWN0b3IgUkVRVUlSRVMgYW4gaW50ZXJmYWNlIHRvIHJlY2VpdmUgYW4gYXJyYXkgb2YgY2FsbGJhY2tzLlxuICAgICAqIFRvIG1hdGNoIG9uIGN1c3RvbSB2YXJpYWJsZXMgaXQgTUFZIGhhdmUgdGFncywgbWF0Y2hlcnMsIG9yIHVzZXItc3RhdGVcbiAgICAgKiBMaWZlY3ljbGUgbWV0aG9kcyBjYW4gYmUgZmlyZWQgZnJvbSB0aGUgQWRTZXJ2ZXIgY2xhc3Mgb3IgcGFzc2VkIHRocm91Z2ggdG8gdGhlIEFkYXB0ZXIuXG4gICAgICpcbiAgICAgKiBAcmVtYXJrc1xuICAgICAqIFBpYW5vIGxpZmVjeWNsZSBtZXRob2RzIGxpdmVzIGluc2lkZSB0aGUgd2luZG93LnRwIG9iamVjdCBzbyB3ZSBoYXZlIHRvIHBhc3MgdGhyb3VnaCBjYWxsYmFja3MuXG4gICAgICogQHBhcmFtIGFkU2VydmljZXJcbiAgICAgKiBAcmV0dXJucyBBZGFwdGVyIENsYXNzXG4gICAgICovXG4gICAgc2V0QWRhcHRlcihhZFNlcnZpY2VyKSB7XG4gICAgICAgIGNvbnN0IHBpYW5vQ29uZmlnID0ge1xuICAgICAgICAgICAgYWZ0ZXJSZW5kZXJDYWxsYmFja3M6IHRoaXMuYWZ0ZXJBZFJlbmRlcixcbiAgICAgICAgICAgIG1hdGNoZXJzOiB0aGlzLm1hdGNoZXJzLFxuICAgICAgICAgICAgdGFnczogdGhpcy50YWdzLFxuICAgICAgICAgICAgdGhpcmRQYXJ0eUNhbGxiYWNrczogdGhpcy50aGlyZFBhcnR5Q2FsbGJhY2tzLFxuICAgICAgICAgICAgdXNlcjogdGhpcy51c2VyXG4gICAgICAgIH07XG4gICAgICAgIHN3aXRjaCAoYWRTZXJ2aWNlcikge1xuICAgICAgICAgICAgY2FzZSBcInBpYW5vXCI6IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFBpYW5vQWRhcHRlcihwaWFub0NvbmZpZyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXNlIFwiYXRrXCI6IHtcbiAgICAgICAgICAgICAgICAvL2NvbmZpZ3VyZSBpbiBob3VzZSBBZFNlcnZpY2VcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFBpYW5vQWRhcHRlcihwaWFub0NvbmZpZyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogQHJlbWFya3NcbiAgICAgKiBUaGVzZSBtZXRob2RzIGFyZSBwcml2YXRlIGFuZCBzaG91bGQgYmUgb25seSBjYWxsZWQgdGhyb3VnaCAjZGlzcGF0Y2hBZFxuICAgICAqL1xuICAgIGV4ZWN1dGVCZWZvcmVBZEluaXQoKSB7XG4gICAgICAgIHRoaXMuYmVmb3JlQWRJbml0LmZvckVhY2goKGNiKSA9PiBjYigpKTtcbiAgICB9XG4gICAgZXhlY3V0ZUFmdGVyQWRSZW5kZXIoKSB7XG4gICAgICAgIHRoaXMuYWZ0ZXJBZFJlbmRlci5mb3JFYWNoKChjYikgPT4gY2IoKSk7XG4gICAgfVxuICAgIGV4ZWN1dGVBZnRlckFkSW5pdCgpIHtcbiAgICAgICAgdGhpcy5hZnRlckFkSW5pdC5mb3JFYWNoKChjYikgPT4gY2IoKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEdhdGhlcnMgbmVlZGVkIHByb3BlcnRpZXMgYW5kIGNyZWF0ZXMgYSBjb25maWd1cmF0aW9uIG9ialxuICAgICAqXG4gICAgICogQHJlbWFya3NcbiAgICAgKiBUaGUgdXNlciBkYXRhIGNvdWxkIGNvbWUgZnJvbSBjb250ZXh0IG9yIGl0IGNvdWxkIGNvbWUgZnJvbVxuICAgICAqIEByZXR1cm5zIFVzZXJcbiAgICAgKi9cbiAgICBzZXRVc2VyKCkge1xuICAgICAgICByZXR1cm4ge307XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEV4ZWN1dGUgYWR2ZXJ0aXNlbWVudCBhbmQgbGlmZWN5Y2xlIG1ldGhvZHMuXG4gICAgICovXG4gICAgZGlzcGF0Y2hBZCgpIHtcbiAgICAgICAgdGhpcy5leGVjdXRlQmVmb3JlQWRJbml0KCk7XG4gICAgICAgIHRoaXMuYWRTZXJ2aWNlci5pbml0KCk7XG4gICAgICAgIHRoaXMuZXhlY3V0ZUFmdGVyQWRJbml0KCk7XG4gICAgfVxufVxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguanMubWFwIiwidmFyIF9fY2xhc3NQcml2YXRlRmllbGRHZXQgPSAodGhpcyAmJiB0aGlzLl9fY2xhc3NQcml2YXRlRmllbGRHZXQpIHx8IGZ1bmN0aW9uIChyZWNlaXZlciwgc3RhdGUsIGtpbmQsIGYpIHtcbiAgICBpZiAoa2luZCA9PT0gXCJhXCIgJiYgIWYpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJQcml2YXRlIGFjY2Vzc29yIHdhcyBkZWZpbmVkIHdpdGhvdXQgYSBnZXR0ZXJcIik7XG4gICAgaWYgKHR5cGVvZiBzdGF0ZSA9PT0gXCJmdW5jdGlvblwiID8gcmVjZWl2ZXIgIT09IHN0YXRlIHx8ICFmIDogIXN0YXRlLmhhcyhyZWNlaXZlcikpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW5ub3QgcmVhZCBwcml2YXRlIG1lbWJlciBmcm9tIGFuIG9iamVjdCB3aG9zZSBjbGFzcyBkaWQgbm90IGRlY2xhcmUgaXRcIik7XG4gICAgcmV0dXJuIGtpbmQgPT09IFwibVwiID8gZiA6IGtpbmQgPT09IFwiYVwiID8gZi5jYWxsKHJlY2VpdmVyKSA6IGYgPyBmLnZhbHVlIDogc3RhdGUuZ2V0KHJlY2VpdmVyKTtcbn07XG52YXIgX1BpYW5vQWRhcHRlcl9pbnN0YW5jZXMsIF9QaWFub0FkYXB0ZXJfZ2V0QWlkLCBfUGlhbm9BZGFwdGVyX2dldFVzZXJUb2tlbjtcbmltcG9ydCBcIi4vcGlhbm9cIjtcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBpYW5vQWRhcHRlciB7XG4gICAgY29uc3RydWN0b3IoeyB0aGlyZFBhcnR5Q2FsbGJhY2tzID0gW10sIGFmdGVyUmVuZGVyQ2FsbGJhY2tzID0gW10sIG1hdGNoZXJzID0gW10sIHRhZ3MgPSBbXSwgdXNlciB9KSB7XG4gICAgICAgIF9QaWFub0FkYXB0ZXJfaW5zdGFuY2VzLmFkZCh0aGlzKTtcbiAgICAgICAgdGhpcy50cCA9IHdpbmRvdy50cCB8fCBbXTtcbiAgICAgICAgdGhpcy51c2VyID0gdGhpcy5zZXRVc2VyKHVzZXIpO1xuICAgICAgICB0aGlzLnNldEVudkNvbmZpZygpO1xuICAgICAgICB0aGlzLnNldFRoaXJkUGFydHlDYWxsYmFja3ModGhpcmRQYXJ0eUNhbGxiYWNrcyk7XG4gICAgICAgIHRoaXMuc2V0Q3VzdG9tVmFyaWFibGVzKG1hdGNoZXJzKTtcbiAgICAgICAgdGhpcy5zZXRBZnRlckFkUmVuZGVyKGFmdGVyUmVuZGVyQ2FsbGJhY2tzKTtcbiAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHRhZ3NbMF0pKSB7XG4gICAgICAgICAgICB0YWdzID0gW3RhZ3NdO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2V0VGFncyh0YWdzKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogU2V0cyByZXF1aXJlZCB1c2VyIGZpZWxkcyB0byBleGVjdXRlIGEgcGlhbm8gZXhwZXJpZW5jZS5cbiAgICAgKlxuICAgICAqIEByZW1hcmtzXG4gICAgICogUGlhbm8gb25seSBuZWVkcyB0aGUgY3VzdG9tIHZhcmlhYmxlIHRvIG1hdGNoLCBidXQgdGhlIHVzZXItdG9rZW4gaGFzIHNvbWV0aGluZyB0byBkbyBvbiB0aGVpciBzaWRlLlxuICAgICAqIEkgYW0gbm90IHN1cmUgd2hhdCBpdCBkb2VzLCBidXQgdG8gYmUgYmFja3dhcmRzIGNvbXBhdGlibGUgd2Ugd2lsbCBhZGQgaXQgaW4gdGhlcmUuXG4gICAgICpcbiAgICAgKiBXZSBhcmUgcGFzc2luZyBpbiBhIHVzZXIgYXJndW1lbnQganVzdCBpbi1jYXNlIHdlIG5lZWQgYWRkaXRpb25hbCBwcm9wZXJ0aWVzIGZyb20gb3VyXG4gICAgICogY29udGV4dCBvciBjb29raWUgaW4gYSBmdXR1cmUgaXRlcmF0aW9uLlxuICAgICAqXG4gICAgICogQHBhcmFtIHVzZXJcbiAgICAgKi9cbiAgICBzZXRVc2VyKHVzZXIpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGFpZDogX19jbGFzc1ByaXZhdGVGaWVsZEdldCh0aGlzLCBfUGlhbm9BZGFwdGVyX2luc3RhbmNlcywgXCJtXCIsIF9QaWFub0FkYXB0ZXJfZ2V0QWlkKS5jYWxsKHRoaXMpLFxuICAgICAgICAgICAgdG9rZW46IF9fY2xhc3NQcml2YXRlRmllbGRHZXQodGhpcywgX1BpYW5vQWRhcHRlcl9pbnN0YW5jZXMsIFwibVwiLCBfUGlhbm9BZGFwdGVyX2dldFVzZXJUb2tlbikuY2FsbCh0aGlzKSxcbiAgICAgICAgfTtcbiAgICB9XG4gICAgaW5pdCgpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICogSW5pdGlhbGl6ZXMgdGhlIHBpYW5vIGV4cGVyaWVuY2VcbiAgICAgICAgKiB0aGlzIGlzIHdoZXJlIHdlIGNvdWxkIGV2ZW50dWFsbHkgZXhwYW5kIG91ciBjYWxsYmFja3MgdXNpbmcgdGhlIHRwIGFwaS5cbiAgICAgICAgKiBodHRwczovL2RvY3MucGlhbm8uaW8vY2FsbGJhY2tzL1xuICAgICAgICAqXG4gICAgICAgICogQHR5cGVkZWYge3N0cmluZ30gQ29tbWFuZCAtIEluaXRpYWxpemF0aW9uIGNvbW1hbmQgZm9yIHBpYW5vIGV4cGVyaWVuY2UuXG4gICAgICAgICogQHR5cGVkZWYgeygpPT52b2lkfSBDYWxsYmFjayAtIEluIHRoaXMgY2FsbGJhY2sgeW91IGNhbiBhY2Nlc3MgYSBsb3Qgb2YgdXNlciBpbmZvcm1hdGlvbiBiZWZvcmUgaW5pdGlhbGl6aW5nIHRoZSBleHBlcmllbmNlLlxuICAgICAgICAqIEB0eXBlZGVmIHtbQ29tbWFuZCwgQ2FsbGJhY2tdfSBJbml0UGFyYW1zXG4gICAgICAgICogQHBhcmFtIHtJbml0UGFyYW1zfVxuICAgICAgICAqL1xuICAgICAgICB0aGlzLnRwLnB1c2goW1wiaW5pdFwiLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy50cC5leHBlcmllbmNlLmluaXQoKTtcbiAgICAgICAgICAgIH0sXSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENvbmZpZ3VyYXRpb24gb2JqZWN0cyBjYXJyeSB0aGUgbmVjZXNzYXJ5IGRhdGEgdG8gdGhlIHRoaXJkIHBhcnR5IGNhbGxiYWNrXG4gICAgICogRWFjaCBjb25maWd1cmF0aW9uIG9iamVjdCBpcyBnb2luZyB0byBiZSBkaWZmZXJlbnQgYmFzZWQgb24gdGhlICdzZXJ2aWNlJy5cbiAgICAgKiBSZXF1aXJlZCBwcm9wZXJ0aWVzIGFyZSBzZXJ2aWNlLCBhbmQgY2FsbGJhY2tzLlxuICAgICAqXG4gICAgICogQHR5cGVkZWYgU2VydmljZSB7c3RyaW5nfVxuICAgICAqIEB0eXBlZGVmIENhbGxiYWNrcyB7WygpPT52b2lkXX1cbiAgICAgKiBAdHlwZWRlZiB7U2VydmljZSwgQ2FsbGJhY2tzfSBDb25maWdPYmpcbiAgICAgKiBAcGFyYW0gdGhpcmRQYXJ0eUNvbmZpZ3MgQ29uZmlnT2JqW11cbiAgICAgKi9cbiAgICBzZXRUaGlyZFBhcnR5Q2FsbGJhY2tzKHRoaXJkUGFydHlDb25maWdzKSB7XG4gICAgICAgIHRoaXJkUGFydHlDb25maWdzLmZvckVhY2goKGNvbmZpZykgPT4ge1xuICAgICAgICAgICAgc3dpdGNoIChjb25maWcuc2VydmljZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgJ21peHBhbmVsJzoge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldE1peHBhbmVsKGNvbmZpZyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYXNlICdhdGsnOiB7XG4gICAgICAgICAgICAgICAgICAgIC8vZG8gb3RoZXIgc3R1ZmYuXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldE1peHBhbmVsKGNvbmZpZyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ29uZmlndXJlcyBtaXhwYW5lbCdzIGdsb2JhbCBhcGkgZm9yIHRyYWNraW5nIGV2ZW50cyB3aXRoIHBpYW5vIHRlbXBsYXRlIGNvbnRlbnQgZmllbGRzXG4gICAgICpcbiAgICAgKiBAcmVtYXJrc1xuICAgICAqIFdlIGFyZSBib3Jyb3dpbmcgYSBwYXR0ZXJuIGZyb20gcmVkdXgsIGluc3RlYWQgb2YgYWN0aW9uIGFuZCBwYXlsb2FkIHdlIGhhdmUgbWl4cGFuZWwgcHJvcGVydGllcyBvZiBzdGF0dXMgYW5kIGFjdGlvbnNcbiAgICAgKiBBY3Rpb25zIGFyZSB0aGUgZXZlbnQgY2FsbGJhY2tzIHRha2luZyBwaWFubyBjb250ZW50IGZpZWxkcyBhbmQgcGFyc2luZyB0aGUgaW5mb3JtYXRpb24gd2UgcmVxdWlyZSBmb3IgZWFjaCBzcGVjaWZpYyBldmVudC5cbiAgICAgKlxuICAgICAqIFdlIGFyZSB1c2luZyBleHRlcm5hbCBldmVudHMgbGF1bmNoIHRoZXNlIGNhbGxiYWNrLiBBIGhhY2t5IHNvbHV0aW9uIGN1cnJlbnRseSBidXQgd2UgYXJlIGluamVjdGluZyBhIHRoaXJkIHBhcnR5IGlmcmFtZSBpbnRvIG91clxuICAgICAqIGFwcGxpY2F0aW9uLiBUaGVyZSBpcyBhIGxpbWl0ZWQgc2NvcGUgb2YgaW50ZXJhY3Rpb24gd2UgY2FuIGhhdmUgd2l0aCB0aGUgdGVtcGxhdGUuIEJ1dCB3aGF0IHdlIGRvbid0IHdhbnQgaXMgdG8gY291cGxlIG91ciBjb2RlXG4gICAgICogd2hlcmUgdGhlIHRlbXBsYXRlIGlzIGdldHRpbmcgcmVuZGVyZWQuIFNvIGhhY2t5ID4gaGVhdmlseSBjb3VwbGVkIGN1cnJlbnRseS5cbiAgICAgKlxuICAgICAqIGh0dHBzOi8vZG9jcy5waWFuby5pby9vZmZlci10ZW1wbGF0ZS1lc3NlbnRpYWxzLyNleHRlcm5hbGV2ZW50XG4gICAgICpcbiAgICAgKiBFdmVyeSBhY3Rpb24gdGhhdCB3ZSB3YW50IHRvIHRyYWNrIHdpdGggbWl4cGFuZWwgd2UgYWRkIGFuIGFkZGl0aW9uYWwgY2FzZSBhbmQgYWRkIGFuIGV4dGVybmFsIGV2ZW50IG9uIHRoZSB0ZW1wbGF0ZVxuICAgICAqIFdlIGhhdmUgdG8gdHJpZ2dlciBpdCB3aXRoIGphdmFzY3JpcHQgb24gdGhlIHRlbXBsYXRlIGlmIGl0IGlzIG5vdCBhIHVzZXIgdHJpZ2dlcmVkIGV2ZW50ICh1bnRpbCB3ZSBmaW5kIGEgYmV0dGVyIHdheSkuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gQ29uZmlnT2JqXG4gICAgICpcbiAgICAgKi9cbiAgICBzZXRNaXhwYW5lbCh7IHN0YXR1cywgYWN0aW9uIH0pIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIHRvZG86IGFkZCBhbGwgb2YgdGhlIGF2YWlsYWJsZSBmaWVsZHMgd2UgZ2V0IGZyb20gdGhlIHBpYW5vIHBhcmFtcyBvYmogYW5kIHRoZSBwYXJhbXMucGFyYW1zIG9ialxuICAgICAgICAgKiBUaGlzIGZ1bmN0aW9uIG1hcHMgdGhlIHBhcmFtcyBkYXRhIHJlY2VpdmVkIGZyb20gdGhlIGV2ZW50IHdlIGdldCBmcm9tIHBpYW5vXG4gICAgICAgICAqIGluY2x1ZGluZyBjdXN0b20gcGFyYW1ldGVycyB3ZSBoYXZlIHRvIHNldCB1cCBpbiB0aGUgZXh0ZXJuYWwtZXZlbnQgZGF0YS1hdHRyaWJ1dGVzXG4gICAgICAgICAqIFdlIGNhbiBub3QgdGFyZ2V0IHRyYWRpdGlvbmFsIGRhdGEtYXR0cmlidXRlcyA6ZnJvd246XG4gICAgICAgICAqXG4gICAgICAgICAqXG4gICAgICAgICAqQGV4YW1wbGVcbiAgICAgICAgICogPHNwYW5cbiAgICAgICAgICogaWQ9XCJtaXhwYW5lbC1wYXJhbXNcIlxuICAgICAgICAgKiBleHRlcm5hbC1ldmVudD1cInByZXNlbnRlZFwiXG4gICAgICAgICAqIGV4dGVybmFsLWV2ZW50LXBhcmFtcz1cInt7cGFyYW1zfX1cIlxuICAgICAgICAgKiBleHRlcm5hbC1ldmVudC1hZHR5cGU9XCJbJSUgYWQtdHlwZSAlJV1cIlxuICAgICAgICAgKiBleHRlcm5hbC1ldmVudC1pbmNvZGU9XCJbJSUgaW5jb2RlICUlXVwiXG4gICAgICAgICAqIGV4dGVybmFsLWV2ZW50LWRldmljZVR5cGU9XCJbJSUgZGV2aWNlVHlwZSAlJV1cIlxuICAgICAgICAgKiBleHRlcm5hbC1ldmVudC1jbGlja2RvbWFpbj1cIlslJSBjbGljay1kb21haW4gJSVdXCJcbiAgICAgICAgICogZXh0ZXJuYWwtZXZlbnQtbWRjPVwiWyUlIG1kYyAlJV1cIlxuICAgICAgICAgKiA+PC9zcGFuPlxuICAgICAgICAgKlxuICAgICAgICAgKlxuICAgICAgICAgKiBJbiB0aGUgY3VzdG9tIHNjcmlwdCB3ZSBoYXZlIHRvIG1hbnVhbGx5IHRyaWdnZXIgYW4gZXZlbnQgdGhhdCBpcyBub3QgY2F1c2UgYnlcbiAgICAgICAgICogdXNlciBpbnRlcmFjdGlvbi4gRm9yIHRoaXMgZXhhbXBsZSB3ZSB3YW50IHRvIGJlIGFibGUgdG8gZmlyZSBhIHByZXNlbnRlZCBldmVudCB0byBtaXhwYW5lbFxuICAgICAgICAgKiBidXQgYmVjYXVzZSBpdCBpc24ndCB1c2VyIHRyaWdnZXJlZCB3ZSB3aWxsIGNsaWNrIG9uIHRoZSBzcGFuIHRoYXQgd2lsbCBmaXJlIHRoZSBleHRlcm5hbC1ldmVudC5cbiAgICAgICAgICpcbiAgICAgICAgICogPGRpdiBjdXN0b20tc2NyaXB0PlxuICAgICAgICAgKiAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwibWl4cGFuZWwtcGFyYW1zXCIpLmNsaWNrKCk7XG4gICAgICAgICAqIDwvZGl2PlxuICAgICAgICAgKi9cbiAgICAgICAgYXN5bmMgZnVuY3Rpb24gdHJhY2tNaXhwYW5lbCh7IGFjdGlvbiwgc3RhdHVzLCBwYXJhbXMsIGN1c3RvbVBhcmFtczogeyBpbmNvZGUsIGNsaWNrZG9tYWluIH0gfSkge1xuICAgICAgICAgICAgbGV0IHsgdXJsIH0gPSBhd2FpdCBKU09OLnBhcnNlKHBhcmFtcyk7XG4gICAgICAgICAgICAvLyBUT0RPOiBjaGFuZ2UgMTcyIHRvIHN1cHBvcnQgc3ViZG9tYWluc1xuICAgICAgICAgICAgY29uc3QgWywgbG9jYXRpb24gPSBcImhvbWVwYWdlXCJdID0gdXJsLnNwbGl0KFwiOjU1MDAvXCIpO1xuICAgICAgICAgICAgd2luZG93Lm1peHBhbmVsLnRyYWNrKGFjdGlvbiwgeyBpbmNvZGUsIHN0YXR1cywgbG9jYXRpb24sIHR5cGU6IGNsaWNrZG9tYWluIH0pO1xuICAgICAgICB9XG4gICAgICAgIHN3aXRjaCAoc3RhdHVzKSB7XG4gICAgICAgICAgICBjYXNlICdBY2NlcHRlZCc6IHtcbiAgICAgICAgICAgICAgICB0aGlzLnRwLnB1c2goW1wiYWRkSGFuZGxlclwiLCBcImN1c3RvbUV2ZW50XCIsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50Py5ldmVudE5hbWUgIT09ICdzaWduLXVwLWJ1dHRvbicpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgdHJhY2tNaXhwYW5lbCh7IGFjdGlvbiwgc3RhdHVzLCBwYXJhbXM6IGV2ZW50LnBhcmFtcy5wYXJhbXMsIGN1c3RvbVBhcmFtczogZXZlbnQucGFyYW1zIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXNlICdQcmVzZW50ZWQnOiB7XG4gICAgICAgICAgICAgICAgdGhpcy50cC5wdXNoKFtcImFkZEhhbmRsZXJcIiwgXCJjdXN0b21FdmVudFwiLCBhc3luYyBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChldmVudD8uZXZlbnROYW1lICE9PSAncHJlc2VudGVkJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICB0cmFja01peHBhbmVsKHsgYWN0aW9uLCBzdGF0dXMsIHBhcmFtczogZXZlbnQucGFyYW1zLnBhcmFtcywgY3VzdG9tUGFyYW1zOiBldmVudC5wYXJhbXMgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1dKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogV2UgYXR0YWNoIGNhbGxiYWNrcyB0aGF0IGZpcmUgYmVmb3JlIHRoZSBicm93c2VyIHJlbmRlcnMgdGhlIHRlbXBsYXRlXG4gICAgICpcbiAgICAgKiBAcmVtYXJrc1xuICAgICAqICBUaGlzIGlzIG5vdCBidWlsdCB0byBzdXBwb3J0IHRoaXJkLXBhcnR5IGNhbGxiYWNrcy4gVGhvc2UgbmVlZCB0byBiZSBoYW5kbGVkIGluZGl2aWR1YWxseSBieSB0aGVpciBoYW5kbGVycy5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBjYnNcbiAgICAgKi9cbiAgICBzZXRCZWZvcmVBZEluaXQoY2JzKSB7XG4gICAgICAgIGNicy5mb3JFYWNoKChjYWxsYmFjaykgPT4ge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBjYWxsYmFjayA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgICAgICAgICAgdGhpcy50cC5wdXNoKFtcImFkZEhhbmRsZXJcIiwgXCJiZWZvcmVCcm93c2VyRXZlbnRcIiwgY2FsbGJhY2tdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFdlIGF0dGFjaCBjYWxsYmFja3MgdGhhdCBmaXJlIGFmdGVyIHRoZSBicm93c2VyIHJlbmRlcnMgdGhlIHRlbXBsYXRlXG4gICAgICpcbiAgICAgKiBAcmVtYXJrc1xuICAgICAqICBUaGlzIGlzIG5vdCBidWlsdCB0byBzdXBwb3J0IHRoaXJkLXBhcnR5IGNhbGxiYWNrcy4gVGhvc2UgbmVlZCB0byBiZSBoYW5kbGVkIGluZGl2aWR1YWxseSBieSB0aGVpciBoYW5kbGVycy5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBjYnNcbiAgICAgKi9cbiAgICBzZXRBZnRlckFkUmVuZGVyKGNicykge1xuICAgICAgICBjYnMuZm9yRWFjaCgoY2FsbGJhY2spID0+IHtcbiAgICAgICAgICAgIHRoaXMudHAucHVzaChbXCJhZGRIYW5kbGVyXCIsIFwic2hvd1RlbXBsYXRlXCIsIGZ1bmN0aW9uICh0ZW1wbGF0ZVBhcmFtcykge1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgICAgIH1dKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNldCB0aGUgdXNlciBzZWdtZW50cyB0aGF0IHdpbGwgbWF0Y2ggb24gdGhlIHBpYW5vIHNlZ21lbnRcbiAgICAgKiBpbiB0aGUgaW5pdGlhbCB1c2VyIHNlZ21lbnRzIHBoYXNlIG9mIHRoZSBjb21wb3NlciBleHBlcmllbmNlXG4gICAgICpcbiAgICAgKiBpLmUuIGV4cGVyaWVuY2UgcnVsZXMsIGluaXRpYWwgdXNlciBzZWdtZW50cywgZXZlbnRzIGFuZCB0cmlnZ2VycywgYWN0aW9uc1xuICAgICAqIGh0dHBzOi8vZG9jcy5waWFuby5pby90cmFjay9vdmVydmlldy1jb21wb3Nlcj9jaGFwdGVyPTU1NTYjbWVudTU1NTZcbiAgICAgKlxuICAgICAqIEBwYXJhbSBtYXRjaGVyc1xuICAgICAqL1xuICAgIHNldEN1c3RvbVZhcmlhYmxlcyhtYXRjaGVycykge1xuICAgICAgICBtYXRjaGVycy5mb3JFYWNoKChjdikgPT4ge1xuICAgICAgICAgICAgY29uc3QgW2tleSwgdmFsdWVdID0gY3Y7XG4gICAgICAgICAgICB0aGlzLnRwLnB1c2goW1wic2V0Q3VzdG9tVmFyaWFibGVcIiwga2V5LCB2YWx1ZV0pO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRWFjaCBleHBlcmllbmNlIGluIGNvbXBvc2VyIHJlcXVpcmVzIHByb3BlciBjb25maWd1cmF0aW9uLlxuICAgICAqIFRoaXMgb2JqZWN0IHdpbGwgc2V0IHVwIG91ciBjb25maWd1cmF0aW9uIG9iamVjdCBwcm9wZXJseSB0byBsYXVuY2ggdGhlIGV4cGVjdGVkIGV4cGVyaWVuY2UuXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyBQaWFub0NvbmZpZ1xuICAgICAqL1xuICAgIC8vIGRlYnVnIGlmIG5vbiBwcm9kXG4gICAgZ2V0Q29uZmlnUHJvcGVydGllcygpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHNldEFpZDogdGhpcy51c2VyLmFpZCxcbiAgICAgICAgICAgIHNldERlYnVnOiB0cnVlLFxuICAgICAgICAgICAgc2V0RW5kcG9pbnQ6IFwiaHR0cHM6Ly9idXkudGlueXBhc3MuY29tL2FwaS92M1wiLFxuICAgICAgICAgICAgc2V0RXh0ZXJuYWxKV1Q6IHRoaXMudXNlci50b2tlbixcbiAgICAgICAgICAgIHNldFVzZVBpYW5vSWRVc2VyUHJvdmlkZXI6IHRydWUsXG4gICAgICAgICAgICBzZXRVc2VUaW55cGFzc0FjY291bnRzOiBmYWxzZSxcbiAgICAgICAgfTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogU2V0cyB1cCB0aGUgd2luZG93LnRwIHBpYW5vIG9iamVjdCBpbiB0aGUgc3BlY2lmaWMgd2F5IGl0IHJlcXVpcmVzLlxuICAgICAqXG4gICAgICogQHJlbWFya3NcbiAgICAgKiB3aW5kb3cudHAgZXhwZWN0cyB0byBwdXNoIHR1cGxlcyB3aXRoIHRoZSBwcm9wZXIgJ2tleScgKGF0IHBvc2l0aW9uIHR1cGxlWzBdKS5cbiAgICAgKiB0b2RvOiBleHBhbmQgZXhwbGFuYXRpb25cbiAgICAgKi9cbiAgICBzZXRFbnZDb25maWcoKSB7XG4gICAgICAgIGNvbnN0IGNvbmZpZyA9IHRoaXMuZ2V0Q29uZmlnUHJvcGVydGllcygpO1xuICAgICAgICBPYmplY3QuZW50cmllcyhjb25maWcpLmZvckVhY2goKGQpID0+IHRoaXMudHAucHVzaChkKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFRoaXMgY29uZmlndXJlcyB0aGUgd2luZG93IHRwIG9iamVjdCB0byBhY2NlcHQgY3VzdG9tIHRhZ3MuXG4gICAgICpcbiAgICAgKiBAcmVtYXJrc1xuICAgICAqIFRhZ3MgYXJlIGEgd2F5IGZvciB1cyB0byBtYXRjaCBleHBlcmllbmNlcyB3aXRoIGdyZWF0IHNwZWNpZmljaXR5LiAoRXhwZXJpZW5jZSBSdWxlcyBQaGFzZSlcbiAgICAgKiBUYWdzIGFyZSB1c2VkIGluIHRoZSBleHBlcmllbmNlLCBhbmQgY2FuIGJlIHJlbmRlcmVkIG9uIHRoZSB0ZW1wbGF0ZS5cbiAgICAgKiBUYWdzIGNhbiBiZSByZXR1cm5lZCB0byBiZSB1c2VkIGluIHRoaXJkLXBhcnR5IGludGVncmF0aW9uc1xuICAgICAqIGh0dHBzOi8vZG9jcy5waWFuby5pby9jb250ZW50LXRyYWNraW5nLyNjdXN0YWdzXG4gICAgICpcbiAgICAgKiBAcGFyYW0gdGFnc1xuICAgICAqL1xuICAgIHNldFRhZ3ModGFncykge1xuICAgICAgICB0YWdzLmZvckVhY2goKHRhZykgPT4ge1xuICAgICAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHRhZykpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnRwLnB1c2goW1wic2V0VGFnc1wiLCB0YWddKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxufVxuX1BpYW5vQWRhcHRlcl9pbnN0YW5jZXMgPSBuZXcgV2Vha1NldCgpLCBfUGlhbm9BZGFwdGVyX2dldEFpZCA9IGZ1bmN0aW9uIF9QaWFub0FkYXB0ZXJfZ2V0QWlkKCkge1xuICAgIC8vIGNvbnN0IFtzdWJkb21haW4sIGRvbWFpbl0gPSB3aW5kb3cubG9jYXRpb24uaG9zdG5hbWUuc3BsaXQoJy4nKVxuICAgIC8vIGlmKHN1YmRvbWFpbiA9PT0gJ3d3dycpe1xuICAgIC8vICAgcmV0dXJuIHtcbiAgICAvLyAgICAgXCJhbWVyaWNhc3Rlc3RraXRjaGVuXCI6IFwibzhpdDRKS1RwdVwiLFxuICAgIC8vICAgICBcImNvb2tzaWxsdXN0cmF0ZWRcIjogXCIwbDRDWFJCQnB1XCIsXG4gICAgLy8gICAgIFwiY29va3Njb3VudHJ5XCI6IFwidlJxdHRzdTFwdVwiLFxuICAgIC8vICAgfVtkb21haW5dXG4gICAgLy8gfSBlbHNlIHtcbiAgICAvLyAgIHJldHVybiB7XG4gICAgLy8gICAgIFwiYW1lcmljYXN0ZXN0a2l0Y2hlblwiOiBcIlAzTVVtbVU5cHVcIixcbiAgICAvLyAgICAgXCJjb29rc2lsbHVzdHJhdGVkXCI6IFwiQ0xSZkFNcXFwdVwiLFxuICAgIC8vICAgICBcImNvb2tzY291bnRyeVwiOiBcInJrSWdkUGF0cHVcIixcbiAgICAvLyAgIH1bZG9tYWluXVxuICAgIC8vIH1cbiAgICAvKipcbiAgICAgKiBleGFtcGxlIGltcGxlbWVudGF0aW9uIHN0YXRpYyBhaWRcbiAgICAgKi9cbiAgICByZXR1cm4gXCJQM01VbW1VOXB1XCI7XG59LCBfUGlhbm9BZGFwdGVyX2dldFVzZXJUb2tlbiA9IGZ1bmN0aW9uIF9QaWFub0FkYXB0ZXJfZ2V0VXNlclRva2VuKCkge1xuICAgIHZhciBjID0gZG9jdW1lbnQuY29va2llLm1hdGNoKFwiKF58OylcXFxccyp1c2VyX3Rva2VuXFxcXHMqPVxcXFxzKihbXjtdKylcIik7XG4gICAgaWYgKGMgJiYgYy5sZW5ndGggPiAwKVxuICAgICAgICByZXR1cm4gYy5wb3AoKTtcbiAgICBlbHNlXG4gICAgICAgIHJldHVybiBudWxsO1xufTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXBpYW5vLWFkYXB0ZXIuanMubWFwIiwidmFyIHBpYW5vU0RLID0gcmVxdWlyZSgnLi90aW55cGFzcycpO1xubW9kdWxlLmV4cG9ydHMgPSB7XG4gICAgcGlhbm9TREtcbn07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5qcy5tYXAiLCIhZnVuY3Rpb24gKGUpIHtcbiAgICBcInVzZSBzdHJpY3RcIjtcbiAgICB3aW5kb3cucG5GdWxsVFBWZXJzaW9uID0gITAsIFwiZnVuY3Rpb25cIiAhPSB0eXBlb2YgT2JqZWN0LmFzc2lnbiAmJiBPYmplY3QuZGVmaW5lUHJvcGVydHkoT2JqZWN0LCBcImFzc2lnblwiLCB7IHZhbHVlOiBmdW5jdGlvbiAoZSwgbikgeyBpZiAobnVsbCA9PSBlKVxuICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCBjb252ZXJ0IHVuZGVmaW5lZCBvciBudWxsIHRvIG9iamVjdFwiKTsgZm9yICh2YXIgdCA9IE9iamVjdChlKSwgciA9IDE7IHIgPCBhcmd1bWVudHMubGVuZ3RoOyByKyspIHtcbiAgICAgICAgICAgIHZhciBvID0gYXJndW1lbnRzW3JdO1xuICAgICAgICAgICAgaWYgKG51bGwgIT0gbylcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpIGluIG8pXG4gICAgICAgICAgICAgICAgICAgIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvLCBpKSAmJiAodFtpXSA9IG9baV0pO1xuICAgICAgICB9IHJldHVybiB0OyB9LCB3cml0YWJsZTogITAsIGNvbmZpZ3VyYWJsZTogITAgfSk7XG4gICAgdmFyIG4gPSBuZXcgV2Vha01hcDtcbiAgICBmdW5jdGlvbiB0KGUsIHQpIHsgcmV0dXJuIG4uZ2V0KGUpICYmIG4uZ2V0KGUpLmdldCh0KTsgfVxuICAgIGZ1bmN0aW9uIHIoZSwgbiwgcikgeyBpZiAodm9pZCAwID09PSBuKVxuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yOyB2YXIgbyA9IHQobiwgcik7IHJldHVybiBvICYmIG8uZ2V0KGUpOyB9XG4gICAgZnVuY3Rpb24gbyhlLCByLCBvLCBpKSB7IGlmIChpICYmICFbXCJzdHJpbmdcIiwgXCJzeW1ib2xcIl0uaW5jbHVkZXModHlwZW9mIGkpKVxuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yOyAodChvLCBpKSB8fCBmdW5jdGlvbiAoZSwgdCkgeyB2YXIgciA9IG4uZ2V0KGUpIHx8IG5ldyBNYXA7IG4uc2V0KGUsIHIpOyB2YXIgbyA9IHIuZ2V0KHQpIHx8IG5ldyBNYXA7IHJldHVybiByLnNldCh0LCBvKSwgbzsgfShvLCBpKSkuc2V0KGUsIHIpOyB9XG4gICAgZnVuY3Rpb24gaShlLCBuLCB0KSB7IHJldHVybiByKGUsIG4sIHQpID8gcihlLCBuLCB0KSA6IE9iamVjdC5nZXRQcm90b3R5cGVPZihuKSA/IGkoZSwgT2JqZWN0LmdldFByb3RvdHlwZU9mKG4pLCB0KSA6IHZvaWQgMDsgfVxuICAgIHZhciBhLCBzID0geyBkZWNvcmF0ZTogZnVuY3Rpb24gKGUsIG4sIHQsIHIpIHsgaWYgKCFBcnJheS5pc0FycmF5KGUpIHx8IDAgPT09IGUubGVuZ3RoKVxuICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcjsgcmV0dXJuIHZvaWQgMCAhPT0gdCA/IGZ1bmN0aW9uIChlLCBuLCB0LCByKSB7IHJldHVybiBlLnJldmVyc2UoKS5mb3JFYWNoKChmdW5jdGlvbiAoZSkgeyByID0gZShuLCB0LCByKSB8fCByOyB9KSksIHI7IH0oZSwgbiwgdCwgcikgOiBcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIG4gPyBmdW5jdGlvbiAoZSwgbikgeyByZXR1cm4gZS5yZXZlcnNlKCkuZm9yRWFjaCgoZnVuY3Rpb24gKGUpIHsgdmFyIHQgPSBlKG4pOyB0ICYmIChuID0gdCk7IH0pKSwgbjsgfShlLCBuKSA6IHZvaWQgMDsgfSwgZGVmaW5lTWV0YWRhdGE6IGZ1bmN0aW9uIChlLCBuLCB0LCByKSB7IG8oZSwgbiwgdCwgcik7IH0sIGdldE1ldGFkYXRhOiBmdW5jdGlvbiAoZSwgbiwgdCkgeyByZXR1cm4gaShlLCBuLCB0KTsgfSwgZ2V0T3duTWV0YWRhdGE6IGZ1bmN0aW9uIChlLCBuLCB0KSB7IHJldHVybiByKGUsIG4sIHQpOyB9LCBoYXNNZXRhZGF0YTogZnVuY3Rpb24gKGUsIG4sIHQpIHsgcmV0dXJuICEhaShlLCBuLCB0KTsgfSwgaGFzT3duTWV0YWRhdGE6IGZ1bmN0aW9uIChlLCBuLCB0KSB7IHJldHVybiAhIXIoZSwgbiwgdCk7IH0sIG1ldGFkYXRhOiBmdW5jdGlvbiAoZSwgbikgeyByZXR1cm4gZnVuY3Rpb24gKHQsIHIpIHsgbyhlLCBuLCB0LCByKTsgfTsgfSB9O1xuICAgIHdpbmRvdy5SZWZsZWN0ID0gd2luZG93LlJlZmxlY3QgfHwge30sIE9iamVjdC5hc3NpZ24od2luZG93LlJlZmxlY3QsIHMpLCBmdW5jdGlvbiAoZSkgeyBlW2UuVHJhbnNpZW50ID0gMF0gPSBcIlRyYW5zaWVudFwiLCBlW2UuU2luZ2xldG9uID0gMV0gPSBcIlNpbmdsZXRvblwiLCBlW2UuUmVzb2x1dGlvblNjb3BlZCA9IDJdID0gXCJSZXNvbHV0aW9uU2NvcGVkXCIsIGVbZS5Db250YWluZXJTY29wZWQgPSAzXSA9IFwiQ29udGFpbmVyU2NvcGVkXCI7IH0oYSB8fCAoYSA9IHt9KSk7XG4gICAgdmFyIGMgPSBhLCBsID0gZnVuY3Rpb24gKGUsIG4pIHsgcmV0dXJuIGwgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwgeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZSwgbikgeyBlLl9fcHJvdG9fXyA9IG47IH0gfHwgZnVuY3Rpb24gKGUsIG4pIHsgZm9yICh2YXIgdCBpbiBuKVxuICAgICAgICBuLmhhc093blByb3BlcnR5KHQpICYmIChlW3RdID0gblt0XSk7IH0sIGwoZSwgbik7IH07XG4gICAgZnVuY3Rpb24gdShlLCBuKSB7IGZ1bmN0aW9uIHQoKSB7IHRoaXMuY29uc3RydWN0b3IgPSBlOyB9IGwoZSwgbiksIGUucHJvdG90eXBlID0gbnVsbCA9PT0gbiA/IE9iamVjdC5jcmVhdGUobikgOiAodC5wcm90b3R5cGUgPSBuLnByb3RvdHlwZSwgbmV3IHQpOyB9XG4gICAgZnVuY3Rpb24gZChlKSB7IHZhciBuID0gXCJmdW5jdGlvblwiID09IHR5cGVvZiBTeW1ib2wgJiYgU3ltYm9sLml0ZXJhdG9yLCB0ID0gbiAmJiBlW25dLCByID0gMDsgaWYgKHQpXG4gICAgICAgIHJldHVybiB0LmNhbGwoZSk7IGlmIChlICYmIFwibnVtYmVyXCIgPT0gdHlwZW9mIGUubGVuZ3RoKVxuICAgICAgICByZXR1cm4geyBuZXh0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBlICYmIHIgPj0gZS5sZW5ndGggJiYgKGUgPSB2b2lkIDApLCB7IHZhbHVlOiBlICYmIGVbcisrXSwgZG9uZTogIWUgfTsgfSB9OyB0aHJvdyBuZXcgVHlwZUVycm9yKG4gPyBcIk9iamVjdCBpcyBub3QgaXRlcmFibGUuXCIgOiBcIlN5bWJvbC5pdGVyYXRvciBpcyBub3QgZGVmaW5lZC5cIik7IH1cbiAgICBmdW5jdGlvbiBwKGUsIG4pIHsgdmFyIHQgPSBcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIFN5bWJvbCAmJiBlW1N5bWJvbC5pdGVyYXRvcl07IGlmICghdClcbiAgICAgICAgcmV0dXJuIGU7IHZhciByLCBvLCBpID0gdC5jYWxsKGUpLCBhID0gW107IHRyeSB7XG4gICAgICAgIGZvciAoOyAodm9pZCAwID09PSBuIHx8IG4tLSA+IDApICYmICEociA9IGkubmV4dCgpKS5kb25lOylcbiAgICAgICAgICAgIGEucHVzaChyLnZhbHVlKTtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgbyA9IHsgZXJyb3I6IGUgfTtcbiAgICB9XG4gICAgZmluYWxseSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICByICYmICFyLmRvbmUgJiYgKHQgPSBpLnJldHVybikgJiYgdC5jYWxsKGkpO1xuICAgICAgICB9XG4gICAgICAgIGZpbmFsbHkge1xuICAgICAgICAgICAgaWYgKG8pXG4gICAgICAgICAgICAgICAgdGhyb3cgby5lcnJvcjtcbiAgICAgICAgfVxuICAgIH0gcmV0dXJuIGE7IH1cbiAgICBmdW5jdGlvbiBmKCkgeyBmb3IgKHZhciBlID0gW10sIG4gPSAwOyBuIDwgYXJndW1lbnRzLmxlbmd0aDsgbisrKVxuICAgICAgICBlID0gZS5jb25jYXQocChhcmd1bWVudHNbbl0pKTsgcmV0dXJuIGU7IH1cbiAgICB2YXIgbSA9IFwiaW5qZWN0aW9uVG9rZW5zXCI7XG4gICAgZnVuY3Rpb24gZyhlKSB7IHJldHVybiAhIWUudXNlQ2xhc3M7IH1cbiAgICBmdW5jdGlvbiB2KGUpIHsgcmV0dXJuICEhZS51c2VGYWN0b3J5OyB9XG4gICAgdmFyIGggPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGUoZSkgeyB0aGlzLndyYXAgPSBlLCB0aGlzLnJlZmxlY3RNZXRob2RzID0gW1wiZ2V0XCIsIFwiZ2V0UHJvdG90eXBlT2ZcIiwgXCJzZXRQcm90b3R5cGVPZlwiLCBcImdldE93blByb3BlcnR5RGVzY3JpcHRvclwiLCBcImRlZmluZVByb3BlcnR5XCIsIFwiaGFzXCIsIFwic2V0XCIsIFwiZGVsZXRlUHJvcGVydHlcIiwgXCJhcHBseVwiLCBcImNvbnN0cnVjdFwiLCBcIm93bktleXNcIl07IH0gcmV0dXJuIGUucHJvdG90eXBlLmNyZWF0ZVByb3h5ID0gZnVuY3Rpb24gKGUpIHsgdmFyIG4sIHQgPSB0aGlzLCByID0gITE7IHJldHVybiBuZXcgUHJveHkoe30sIHRoaXMuY3JlYXRlSGFuZGxlcigoZnVuY3Rpb24gKCkgeyByZXR1cm4gciB8fCAobiA9IGUodC53cmFwKCkpLCByID0gITApLCBuOyB9KSkpOyB9LCBlLnByb3RvdHlwZS5jcmVhdGVIYW5kbGVyID0gZnVuY3Rpb24gKGUpIHsgdmFyIG4gPSB7fTsgcmV0dXJuIHRoaXMucmVmbGVjdE1ldGhvZHMuZm9yRWFjaCgoZnVuY3Rpb24gKHQpIHsgblt0XSA9IGZ1bmN0aW9uICgpIHsgZm9yICh2YXIgbiA9IFtdLCByID0gMDsgciA8IGFyZ3VtZW50cy5sZW5ndGg7IHIrKylcbiAgICAgICAgbltyXSA9IGFyZ3VtZW50c1tyXTsgblswXSA9IGUoKTsgdmFyIG8gPSBSZWZsZWN0W3RdOyByZXR1cm4gby5hcHBseSh2b2lkIDAsIGYobikpOyB9OyB9KSksIG47IH0sIGU7IH0oKTtcbiAgICBmdW5jdGlvbiB3KGUpIHsgcmV0dXJuIFwic3RyaW5nXCIgPT0gdHlwZW9mIGUgfHwgXCJzeW1ib2xcIiA9PSB0eXBlb2YgZTsgfVxuICAgIGZ1bmN0aW9uIHkoZSkgeyByZXR1cm4gXCJvYmplY3RcIiA9PSB0eXBlb2YgZSAmJiBcInRva2VuXCIgaW4gZSAmJiBcInRyYW5zZm9ybVwiIGluIGU7IH1cbiAgICBmdW5jdGlvbiBiKGUpIHsgcmV0dXJuICEhZS51c2VUb2tlbjsgfVxuICAgIGZ1bmN0aW9uIGsoZSkgeyByZXR1cm4gbnVsbCAhPSBlLnVzZVZhbHVlOyB9XG4gICAgdmFyIF8gPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGUoKSB7IHRoaXMuX3JlZ2lzdHJ5TWFwID0gbmV3IE1hcDsgfSByZXR1cm4gZS5wcm90b3R5cGUuZW50cmllcyA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuX3JlZ2lzdHJ5TWFwLmVudHJpZXMoKTsgfSwgZS5wcm90b3R5cGUuZ2V0QWxsID0gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIHRoaXMuZW5zdXJlKGUpLCB0aGlzLl9yZWdpc3RyeU1hcC5nZXQoZSk7IH0sIGUucHJvdG90eXBlLmdldCA9IGZ1bmN0aW9uIChlKSB7IHRoaXMuZW5zdXJlKGUpOyB2YXIgbiA9IHRoaXMuX3JlZ2lzdHJ5TWFwLmdldChlKTsgcmV0dXJuIG5bbi5sZW5ndGggLSAxXSB8fCBudWxsOyB9LCBlLnByb3RvdHlwZS5zZXQgPSBmdW5jdGlvbiAoZSwgbikgeyB0aGlzLmVuc3VyZShlKSwgdGhpcy5fcmVnaXN0cnlNYXAuZ2V0KGUpLnB1c2gobik7IH0sIGUucHJvdG90eXBlLnNldEFsbCA9IGZ1bmN0aW9uIChlLCBuKSB7IHRoaXMuX3JlZ2lzdHJ5TWFwLnNldChlLCBuKTsgfSwgZS5wcm90b3R5cGUuaGFzID0gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIHRoaXMuZW5zdXJlKGUpLCB0aGlzLl9yZWdpc3RyeU1hcC5nZXQoZSkubGVuZ3RoID4gMDsgfSwgZS5wcm90b3R5cGUuY2xlYXIgPSBmdW5jdGlvbiAoKSB7IHRoaXMuX3JlZ2lzdHJ5TWFwLmNsZWFyKCk7IH0sIGUucHJvdG90eXBlLmVuc3VyZSA9IGZ1bmN0aW9uIChlKSB7IHRoaXMuX3JlZ2lzdHJ5TWFwLmhhcyhlKSB8fCB0aGlzLl9yZWdpc3RyeU1hcC5zZXQoZSwgW10pOyB9LCBlOyB9KCksIEMgPSBmdW5jdGlvbiAoZSkgeyBmdW5jdGlvbiBuKCkgeyByZXR1cm4gbnVsbCAhPT0gZSAmJiBlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpczsgfSByZXR1cm4gdShuLCBlKSwgbjsgfShfKSwgSSA9IGZ1bmN0aW9uICgpIHsgdGhpcy5zY29wZWRSZXNvbHV0aW9ucyA9IG5ldyBNYXA7IH07XG4gICAgZnVuY3Rpb24gUyhlLCBuLCB0KSB7IHZhciByLCBvLCBpID0gcChlLnRvU3RyaW5nKCkubWF0Y2goL2NvbnN0cnVjdG9yXFwoKFtcXHcsIF0rKVxcKS8pIHx8IFtdLCAyKVsxXSwgYSA9IGZ1bmN0aW9uIChlLCBuKSB7IHJldHVybiBudWxsID09PSBlID8gXCJhdCBwb3NpdGlvbiAjXCIgKyBuIDogJ1wiJyArIGUuc3BsaXQoXCIsXCIpW25dLnRyaW0oKSArICdcIiBhdCBwb3NpdGlvbiAjJyArIG47IH0odm9pZCAwID09PSBpID8gbnVsbCA6IGksIG4pOyByZXR1cm4gciA9IFwiQ2Fubm90IGluamVjdCB0aGUgZGVwZW5kZW5jeSBcIiArIGEgKyAnIG9mIFwiJyArIGUubmFtZSArICdcIiBjb25zdHJ1Y3Rvci4gUmVhc29uOicsIHZvaWQgMCA9PT0gbyAmJiAobyA9IFwiICAgIFwiKSwgZihbcl0sIHQubWVzc2FnZS5zcGxpdChcIlxcblwiKS5tYXAoKGZ1bmN0aW9uIChlKSB7IHJldHVybiBvICsgZTsgfSkpKS5qb2luKFwiXFxuXCIpOyB9XG4gICAgdmFyIHggPSBmdW5jdGlvbiAoZSkgeyBmdW5jdGlvbiBuKCkgeyByZXR1cm4gbnVsbCAhPT0gZSAmJiBlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpczsgfSByZXR1cm4gdShuLCBlKSwgbjsgfShfKSwgUCA9IGZ1bmN0aW9uIChlKSB7IGZ1bmN0aW9uIG4oKSB7IHJldHVybiBudWxsICE9PSBlICYmIGUuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOyB9IHJldHVybiB1KG4sIGUpLCBuOyB9KF8pLCBFID0gZnVuY3Rpb24gKCkgeyB0aGlzLnByZVJlc29sdXRpb24gPSBuZXcgeCwgdGhpcy5wb3N0UmVzb2x1dGlvbiA9IG5ldyBQOyB9LCBUID0gbmV3IE1hcCwgQSA9IGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZShlKSB7IHRoaXMucGFyZW50ID0gZSwgdGhpcy5fcmVnaXN0cnkgPSBuZXcgQywgdGhpcy5pbnRlcmNlcHRvcnMgPSBuZXcgRTsgfSByZXR1cm4gZS5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAoZSwgbiwgdCkgeyB2YXIgcjsgaWYgKHZvaWQgMCA9PT0gdCAmJiAodCA9IHsgbGlmZWN5Y2xlOiBjLlRyYW5zaWVudCB9KSwgciA9IGZ1bmN0aW9uIChlKSB7IHJldHVybiBnKGUpIHx8IGsoZSkgfHwgYihlKSB8fCB2KGUpOyB9KG4pID8gbiA6IHsgdXNlQ2xhc3M6IG4gfSwgYihyKSlcbiAgICAgICAgZm9yICh2YXIgbyA9IFtlXSwgaSA9IHI7IG51bGwgIT0gaTspIHtcbiAgICAgICAgICAgIHZhciBhID0gaS51c2VUb2tlbjtcbiAgICAgICAgICAgIGlmIChvLmluY2x1ZGVzKGEpKVxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlRva2VuIHJlZ2lzdHJhdGlvbiBjeWNsZSBkZXRlY3RlZCEgXCIgKyBmKG8sIFthXSkuam9pbihcIiAtPiBcIikpO1xuICAgICAgICAgICAgby5wdXNoKGEpO1xuICAgICAgICAgICAgdmFyIHMgPSB0aGlzLl9yZWdpc3RyeS5nZXQoYSk7XG4gICAgICAgICAgICBpID0gcyAmJiBiKHMucHJvdmlkZXIpID8gcy5wcm92aWRlciA6IG51bGw7XG4gICAgICAgIH0gaWYgKCh0LmxpZmVjeWNsZSA9PT0gYy5TaW5nbGV0b24gfHwgdC5saWZlY3ljbGUgPT0gYy5Db250YWluZXJTY29wZWQgfHwgdC5saWZlY3ljbGUgPT0gYy5SZXNvbHV0aW9uU2NvcGVkKSAmJiAoayhyKSB8fCB2KHIpKSlcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdDYW5ub3QgdXNlIGxpZmVjeWNsZSBcIicgKyBjW3QubGlmZWN5Y2xlXSArICdcIiB3aXRoIFZhbHVlUHJvdmlkZXJzIG9yIEZhY3RvcnlQcm92aWRlcnMnKTsgcmV0dXJuIHRoaXMuX3JlZ2lzdHJ5LnNldChlLCB7IHByb3ZpZGVyOiByLCBvcHRpb25zOiB0IH0pLCB0aGlzOyB9LCBlLnByb3RvdHlwZS5yZWdpc3RlclR5cGUgPSBmdW5jdGlvbiAoZSwgbikgeyByZXR1cm4gdyhuKSA/IHRoaXMucmVnaXN0ZXIoZSwgeyB1c2VUb2tlbjogbiB9KSA6IHRoaXMucmVnaXN0ZXIoZSwgeyB1c2VDbGFzczogbiB9KTsgfSwgZS5wcm90b3R5cGUucmVnaXN0ZXJJbnN0YW5jZSA9IGZ1bmN0aW9uIChlLCBuKSB7IHJldHVybiB0aGlzLnJlZ2lzdGVyKGUsIHsgdXNlVmFsdWU6IG4gfSk7IH0sIGUucHJvdG90eXBlLnJlZ2lzdGVyU2luZ2xldG9uID0gZnVuY3Rpb24gKGUsIG4pIHsgaWYgKHcoZSkpIHtcbiAgICAgICAgaWYgKHcobikpXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5yZWdpc3RlcihlLCB7IHVzZVRva2VuOiBuIH0sIHsgbGlmZWN5Y2xlOiBjLlNpbmdsZXRvbiB9KTtcbiAgICAgICAgaWYgKG4pXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5yZWdpc3RlcihlLCB7IHVzZUNsYXNzOiBuIH0sIHsgbGlmZWN5Y2xlOiBjLlNpbmdsZXRvbiB9KTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdDYW5ub3QgcmVnaXN0ZXIgYSB0eXBlIG5hbWUgYXMgYSBzaW5nbGV0b24gd2l0aG91dCBhIFwidG9cIiB0b2tlbicpO1xuICAgIH0gdmFyIHQgPSBlOyByZXR1cm4gbiAmJiAhdyhuKSAmJiAodCA9IG4pLCB0aGlzLnJlZ2lzdGVyKGUsIHsgdXNlQ2xhc3M6IHQgfSwgeyBsaWZlY3ljbGU6IGMuU2luZ2xldG9uIH0pOyB9LCBlLnByb3RvdHlwZS5yZXNvbHZlID0gZnVuY3Rpb24gKGUsIG4pIHsgdm9pZCAwID09PSBuICYmIChuID0gbmV3IEkpOyB2YXIgdCA9IHRoaXMuZ2V0UmVnaXN0cmF0aW9uKGUpOyBpZiAoIXQgJiYgdyhlKSlcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdBdHRlbXB0ZWQgdG8gcmVzb2x2ZSB1bnJlZ2lzdGVyZWQgZGVwZW5kZW5jeSB0b2tlbjogXCInICsgZS50b1N0cmluZygpICsgJ1wiJyk7IGlmICh0aGlzLmV4ZWN1dGVQcmVSZXNvbHV0aW9uSW50ZXJjZXB0b3IoZSwgXCJTaW5nbGVcIiksIHQpIHtcbiAgICAgICAgdmFyIHIgPSB0aGlzLnJlc29sdmVSZWdpc3RyYXRpb24odCwgbik7XG4gICAgICAgIHJldHVybiB0aGlzLmV4ZWN1dGVQb3N0UmVzb2x1dGlvbkludGVyY2VwdG9yKGUsIHIsIFwiU2luZ2xlXCIpLCByO1xuICAgIH0gaWYgKGZ1bmN0aW9uIChlKSB7IHJldHVybiBcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIGUgfHwgZSBpbnN0YW5jZW9mIGg7IH0oZSkpIHtcbiAgICAgICAgciA9IHRoaXMuY29uc3RydWN0KGUsIG4pO1xuICAgICAgICByZXR1cm4gdGhpcy5leGVjdXRlUG9zdFJlc29sdXRpb25JbnRlcmNlcHRvcihlLCByLCBcIlNpbmdsZVwiKSwgcjtcbiAgICB9IHRocm93IG5ldyBFcnJvcihcIkF0dGVtcHRlZCB0byBjb25zdHJ1Y3QgYW4gdW5kZWZpbmVkIGNvbnN0cnVjdG9yLiBDb3VsZCBtZWFuIGEgY2lyY3VsYXIgZGVwZW5kZW5jeSBwcm9ibGVtLiBUcnkgdXNpbmcgYGRlbGF5YCBmdW5jdGlvbi5cIik7IH0sIGUucHJvdG90eXBlLmV4ZWN1dGVQcmVSZXNvbHV0aW9uSW50ZXJjZXB0b3IgPSBmdW5jdGlvbiAoZSwgbikgeyB2YXIgdCwgcjsgaWYgKHRoaXMuaW50ZXJjZXB0b3JzLnByZVJlc29sdXRpb24uaGFzKGUpKSB7XG4gICAgICAgIHZhciBvID0gW107XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gZCh0aGlzLmludGVyY2VwdG9ycy5wcmVSZXNvbHV0aW9uLmdldEFsbChlKSksIGEgPSBpLm5leHQoKTsgIWEuZG9uZTsgYSA9IGkubmV4dCgpKSB7XG4gICAgICAgICAgICAgICAgdmFyIHMgPSBhLnZhbHVlO1xuICAgICAgICAgICAgICAgIFwiT25jZVwiICE9IHMub3B0aW9ucy5mcmVxdWVuY3kgJiYgby5wdXNoKHMpLCBzLmNhbGxiYWNrKGUsIG4pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICB0ID0geyBlcnJvcjogZSB9O1xuICAgICAgICB9XG4gICAgICAgIGZpbmFsbHkge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBhICYmICFhLmRvbmUgJiYgKHIgPSBpLnJldHVybikgJiYgci5jYWxsKGkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZmluYWxseSB7XG4gICAgICAgICAgICAgICAgaWYgKHQpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IHQuZXJyb3I7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5pbnRlcmNlcHRvcnMucHJlUmVzb2x1dGlvbi5zZXRBbGwoZSwgbyk7XG4gICAgfSB9LCBlLnByb3RvdHlwZS5leGVjdXRlUG9zdFJlc29sdXRpb25JbnRlcmNlcHRvciA9IGZ1bmN0aW9uIChlLCBuLCB0KSB7IHZhciByLCBvOyBpZiAodGhpcy5pbnRlcmNlcHRvcnMucG9zdFJlc29sdXRpb24uaGFzKGUpKSB7XG4gICAgICAgIHZhciBpID0gW107XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBmb3IgKHZhciBhID0gZCh0aGlzLmludGVyY2VwdG9ycy5wb3N0UmVzb2x1dGlvbi5nZXRBbGwoZSkpLCBzID0gYS5uZXh0KCk7ICFzLmRvbmU7IHMgPSBhLm5leHQoKSkge1xuICAgICAgICAgICAgICAgIHZhciBjID0gcy52YWx1ZTtcbiAgICAgICAgICAgICAgICBcIk9uY2VcIiAhPSBjLm9wdGlvbnMuZnJlcXVlbmN5ICYmIGkucHVzaChjKSwgYy5jYWxsYmFjayhlLCBuLCB0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgciA9IHsgZXJyb3I6IGUgfTtcbiAgICAgICAgfVxuICAgICAgICBmaW5hbGx5IHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgcyAmJiAhcy5kb25lICYmIChvID0gYS5yZXR1cm4pICYmIG8uY2FsbChhKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZpbmFsbHkge1xuICAgICAgICAgICAgICAgIGlmIChyKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyByLmVycm9yO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuaW50ZXJjZXB0b3JzLnBvc3RSZXNvbHV0aW9uLnNldEFsbChlLCBpKTtcbiAgICB9IH0sIGUucHJvdG90eXBlLnJlc29sdmVSZWdpc3RyYXRpb24gPSBmdW5jdGlvbiAoZSwgbikgeyBpZiAoZS5vcHRpb25zLmxpZmVjeWNsZSA9PT0gYy5SZXNvbHV0aW9uU2NvcGVkICYmIG4uc2NvcGVkUmVzb2x1dGlvbnMuaGFzKGUpKVxuICAgICAgICByZXR1cm4gbi5zY29wZWRSZXNvbHV0aW9ucy5nZXQoZSk7IHZhciB0LCByID0gZS5vcHRpb25zLmxpZmVjeWNsZSA9PT0gYy5TaW5nbGV0b24sIG8gPSBlLm9wdGlvbnMubGlmZWN5Y2xlID09PSBjLkNvbnRhaW5lclNjb3BlZCwgaSA9IHIgfHwgbzsgcmV0dXJuIHQgPSBrKGUucHJvdmlkZXIpID8gZS5wcm92aWRlci51c2VWYWx1ZSA6IGIoZS5wcm92aWRlcikgPyBpID8gZS5pbnN0YW5jZSB8fCAoZS5pbnN0YW5jZSA9IHRoaXMucmVzb2x2ZShlLnByb3ZpZGVyLnVzZVRva2VuLCBuKSkgOiB0aGlzLnJlc29sdmUoZS5wcm92aWRlci51c2VUb2tlbiwgbikgOiBnKGUucHJvdmlkZXIpID8gaSA/IGUuaW5zdGFuY2UgfHwgKGUuaW5zdGFuY2UgPSB0aGlzLmNvbnN0cnVjdChlLnByb3ZpZGVyLnVzZUNsYXNzLCBuKSkgOiB0aGlzLmNvbnN0cnVjdChlLnByb3ZpZGVyLnVzZUNsYXNzLCBuKSA6IHYoZS5wcm92aWRlcikgPyBlLnByb3ZpZGVyLnVzZUZhY3RvcnkodGhpcykgOiB0aGlzLmNvbnN0cnVjdChlLnByb3ZpZGVyLCBuKSwgZS5vcHRpb25zLmxpZmVjeWNsZSA9PT0gYy5SZXNvbHV0aW9uU2NvcGVkICYmIG4uc2NvcGVkUmVzb2x1dGlvbnMuc2V0KGUsIHQpLCB0OyB9LCBlLnByb3RvdHlwZS5yZXNvbHZlQWxsID0gZnVuY3Rpb24gKGUsIG4pIHsgdmFyIHQgPSB0aGlzOyB2b2lkIDAgPT09IG4gJiYgKG4gPSBuZXcgSSk7IHZhciByID0gdGhpcy5nZXRBbGxSZWdpc3RyYXRpb25zKGUpOyBpZiAoIXIgJiYgdyhlKSlcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdBdHRlbXB0ZWQgdG8gcmVzb2x2ZSB1bnJlZ2lzdGVyZWQgZGVwZW5kZW5jeSB0b2tlbjogXCInICsgZS50b1N0cmluZygpICsgJ1wiJyk7IGlmICh0aGlzLmV4ZWN1dGVQcmVSZXNvbHV0aW9uSW50ZXJjZXB0b3IoZSwgXCJBbGxcIiksIHIpIHtcbiAgICAgICAgdmFyIG8gPSByLm1hcCgoZnVuY3Rpb24gKGUpIHsgcmV0dXJuIHQucmVzb2x2ZVJlZ2lzdHJhdGlvbihlLCBuKTsgfSkpO1xuICAgICAgICByZXR1cm4gdGhpcy5leGVjdXRlUG9zdFJlc29sdXRpb25JbnRlcmNlcHRvcihlLCBvLCBcIkFsbFwiKSwgbztcbiAgICB9IHZhciBpID0gW3RoaXMuY29uc3RydWN0KGUsIG4pXTsgcmV0dXJuIHRoaXMuZXhlY3V0ZVBvc3RSZXNvbHV0aW9uSW50ZXJjZXB0b3IoZSwgaSwgXCJBbGxcIiksIGk7IH0sIGUucHJvdG90eXBlLmlzUmVnaXN0ZXJlZCA9IGZ1bmN0aW9uIChlLCBuKSB7IHJldHVybiB2b2lkIDAgPT09IG4gJiYgKG4gPSAhMSksIHRoaXMuX3JlZ2lzdHJ5LmhhcyhlKSB8fCBuICYmICh0aGlzLnBhcmVudCB8fCAhMSkgJiYgdGhpcy5wYXJlbnQuaXNSZWdpc3RlcmVkKGUsICEwKTsgfSwgZS5wcm90b3R5cGUucmVzZXQgPSBmdW5jdGlvbiAoKSB7IHRoaXMuX3JlZ2lzdHJ5LmNsZWFyKCksIHRoaXMuaW50ZXJjZXB0b3JzLnByZVJlc29sdXRpb24uY2xlYXIoKSwgdGhpcy5pbnRlcmNlcHRvcnMucG9zdFJlc29sdXRpb24uY2xlYXIoKTsgfSwgZS5wcm90b3R5cGUuY2xlYXJJbnN0YW5jZXMgPSBmdW5jdGlvbiAoKSB7IHZhciBlLCBuOyB0cnkge1xuICAgICAgICBmb3IgKHZhciB0ID0gZCh0aGlzLl9yZWdpc3RyeS5lbnRyaWVzKCkpLCByID0gdC5uZXh0KCk7ICFyLmRvbmU7IHIgPSB0Lm5leHQoKSkge1xuICAgICAgICAgICAgdmFyIG8gPSBwKHIudmFsdWUsIDIpLCBpID0gb1swXSwgYSA9IG9bMV07XG4gICAgICAgICAgICB0aGlzLl9yZWdpc3RyeS5zZXRBbGwoaSwgYS5maWx0ZXIoKGZ1bmN0aW9uIChlKSB7IHJldHVybiAhayhlLnByb3ZpZGVyKTsgfSkpLm1hcCgoZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGUuaW5zdGFuY2UgPSB2b2lkIDAsIGU7IH0pKSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY2F0Y2ggKG4pIHtcbiAgICAgICAgZSA9IHsgZXJyb3I6IG4gfTtcbiAgICB9XG4gICAgZmluYWxseSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICByICYmICFyLmRvbmUgJiYgKG4gPSB0LnJldHVybikgJiYgbi5jYWxsKHQpO1xuICAgICAgICB9XG4gICAgICAgIGZpbmFsbHkge1xuICAgICAgICAgICAgaWYgKGUpXG4gICAgICAgICAgICAgICAgdGhyb3cgZS5lcnJvcjtcbiAgICAgICAgfVxuICAgIH0gfSwgZS5wcm90b3R5cGUuY3JlYXRlQ2hpbGRDb250YWluZXIgPSBmdW5jdGlvbiAoKSB7IHZhciBuLCB0LCByID0gbmV3IGUodGhpcyk7IHRyeSB7XG4gICAgICAgIGZvciAodmFyIG8gPSBkKHRoaXMuX3JlZ2lzdHJ5LmVudHJpZXMoKSksIGkgPSBvLm5leHQoKTsgIWkuZG9uZTsgaSA9IG8ubmV4dCgpKSB7XG4gICAgICAgICAgICB2YXIgYSA9IHAoaS52YWx1ZSwgMiksIHMgPSBhWzBdLCBsID0gYVsxXTtcbiAgICAgICAgICAgIGwuc29tZSgoZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGUub3B0aW9ucy5saWZlY3ljbGUgPT09IGMuQ29udGFpbmVyU2NvcGVkOyB9KSkgJiYgci5fcmVnaXN0cnkuc2V0QWxsKHMsIGwubWFwKChmdW5jdGlvbiAoZSkgeyByZXR1cm4gZS5vcHRpb25zLmxpZmVjeWNsZSA9PT0gYy5Db250YWluZXJTY29wZWQgPyB7IHByb3ZpZGVyOiBlLnByb3ZpZGVyLCBvcHRpb25zOiBlLm9wdGlvbnMgfSA6IGU7IH0pKSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgbiA9IHsgZXJyb3I6IGUgfTtcbiAgICB9XG4gICAgZmluYWxseSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBpICYmICFpLmRvbmUgJiYgKHQgPSBvLnJldHVybikgJiYgdC5jYWxsKG8pO1xuICAgICAgICB9XG4gICAgICAgIGZpbmFsbHkge1xuICAgICAgICAgICAgaWYgKG4pXG4gICAgICAgICAgICAgICAgdGhyb3cgbi5lcnJvcjtcbiAgICAgICAgfVxuICAgIH0gcmV0dXJuIHI7IH0sIGUucHJvdG90eXBlLmJlZm9yZVJlc29sdXRpb24gPSBmdW5jdGlvbiAoZSwgbiwgdCkgeyB2b2lkIDAgPT09IHQgJiYgKHQgPSB7IGZyZXF1ZW5jeTogXCJBbHdheXNcIiB9KSwgdGhpcy5pbnRlcmNlcHRvcnMucHJlUmVzb2x1dGlvbi5zZXQoZSwgeyBjYWxsYmFjazogbiwgb3B0aW9uczogdCB9KTsgfSwgZS5wcm90b3R5cGUuYWZ0ZXJSZXNvbHV0aW9uID0gZnVuY3Rpb24gKGUsIG4sIHQpIHsgdm9pZCAwID09PSB0ICYmICh0ID0geyBmcmVxdWVuY3k6IFwiQWx3YXlzXCIgfSksIHRoaXMuaW50ZXJjZXB0b3JzLnBvc3RSZXNvbHV0aW9uLnNldChlLCB7IGNhbGxiYWNrOiBuLCBvcHRpb25zOiB0IH0pOyB9LCBlLnByb3RvdHlwZS5nZXRSZWdpc3RyYXRpb24gPSBmdW5jdGlvbiAoZSkgeyByZXR1cm4gdGhpcy5pc1JlZ2lzdGVyZWQoZSkgPyB0aGlzLl9yZWdpc3RyeS5nZXQoZSkgOiB0aGlzLnBhcmVudCA/IHRoaXMucGFyZW50LmdldFJlZ2lzdHJhdGlvbihlKSA6IG51bGw7IH0sIGUucHJvdG90eXBlLmdldEFsbFJlZ2lzdHJhdGlvbnMgPSBmdW5jdGlvbiAoZSkgeyByZXR1cm4gdGhpcy5pc1JlZ2lzdGVyZWQoZSkgPyB0aGlzLl9yZWdpc3RyeS5nZXRBbGwoZSkgOiB0aGlzLnBhcmVudCA/IHRoaXMucGFyZW50LmdldEFsbFJlZ2lzdHJhdGlvbnMoZSkgOiBudWxsOyB9LCBlLnByb3RvdHlwZS5jb25zdHJ1Y3QgPSBmdW5jdGlvbiAoZSwgbikgeyB2YXIgdCA9IHRoaXM7IGlmIChlIGluc3RhbmNlb2YgaClcbiAgICAgICAgcmV0dXJuIGUuY3JlYXRlUHJveHkoKGZ1bmN0aW9uIChlKSB7IHJldHVybiB0LnJlc29sdmUoZSwgbik7IH0pKTsgdmFyIHIgPSBULmdldChlKTsgaWYgKCFyIHx8IDAgPT09IHIubGVuZ3RoKSB7XG4gICAgICAgIGlmICgwID09PSBlLmxlbmd0aClcbiAgICAgICAgICAgIHJldHVybiBuZXcgZTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUeXBlSW5mbyBub3Qga25vd24gZm9yIFwiJyArIGUubmFtZSArICdcIicpO1xuICAgIH0gdmFyIG8gPSByLm1hcCh0aGlzLnJlc29sdmVQYXJhbXMobiwgZSkpOyByZXR1cm4gbmV3IChlLmJpbmQuYXBwbHkoZSwgZihbdm9pZCAwXSwgbykpKTsgfSwgZS5wcm90b3R5cGUucmVzb2x2ZVBhcmFtcyA9IGZ1bmN0aW9uIChlLCBuKSB7IHZhciB0ID0gdGhpczsgcmV0dXJuIGZ1bmN0aW9uIChyLCBvKSB7IHZhciBpLCBhLCBzLCBjOyB0cnkge1xuICAgICAgICByZXR1cm4gXCJvYmplY3RcIiA9PSB0eXBlb2YgKGMgPSByKSAmJiBcInRva2VuXCIgaW4gYyAmJiBcIm11bHRpcGxlXCIgaW4gYyA/IHkocikgPyByLm11bHRpcGxlID8gKGkgPSB0LnJlc29sdmUoci50cmFuc2Zvcm0pKS50cmFuc2Zvcm0uYXBwbHkoaSwgZihbdC5yZXNvbHZlQWxsKHIudG9rZW4pXSwgci50cmFuc2Zvcm1BcmdzKSkgOiAoYSA9IHQucmVzb2x2ZShyLnRyYW5zZm9ybSkpLnRyYW5zZm9ybS5hcHBseShhLCBmKFt0LnJlc29sdmUoci50b2tlbiwgZSldLCByLnRyYW5zZm9ybUFyZ3MpKSA6IHIubXVsdGlwbGUgPyB0LnJlc29sdmVBbGwoci50b2tlbikgOiB0LnJlc29sdmUoci50b2tlbiwgZSkgOiB5KHIpID8gKHMgPSB0LnJlc29sdmUoci50cmFuc2Zvcm0sIGUpKS50cmFuc2Zvcm0uYXBwbHkocywgZihbdC5yZXNvbHZlKHIudG9rZW4sIGUpXSwgci50cmFuc2Zvcm1BcmdzKSkgOiB0LnJlc29sdmUociwgZSk7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihTKG4sIG8sIGUpKTtcbiAgICB9IH07IH0sIGU7IH0oKSwgTSA9IG5ldyBBO1xuICAgIGZ1bmN0aW9uIE8oKSB7IHJldHVybiBmdW5jdGlvbiAoZSkgeyBULnNldChlLCBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IFJlZmxlY3QuZ2V0TWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBlKSB8fCBbXSwgdCA9IFJlZmxlY3QuZ2V0T3duTWV0YWRhdGEobSwgZSkgfHwge307IHJldHVybiBPYmplY3Qua2V5cyh0KS5mb3JFYWNoKChmdW5jdGlvbiAoZSkgeyBuWytlXSA9IHRbZV07IH0pKSwgbjsgfShlKSk7IH07IH1cbiAgICBpZiAoXCJ1bmRlZmluZWRcIiA9PSB0eXBlb2YgUmVmbGVjdCB8fCAhUmVmbGVjdC5nZXRNZXRhZGF0YSlcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwidHN5cmluZ2UgcmVxdWlyZXMgYSByZWZsZWN0IHBvbHlmaWxsLiBQbGVhc2UgYWRkICdpbXBvcnQgXFxcInJlZmxlY3QtbWV0YWRhdGFcXFwiJyB0byB0aGUgdG9wIG9mIHlvdXIgZW50cnkgcG9pbnQuXCIpO1xuICAgIGlmICh3aW5kb3cucG5Jbml0UGVyZm9ybWFuY2UgPSBwZXJmb3JtYW5jZS5ub3coKSwgd2luZG93LnBuSGFzUG9seWZpbGxlZCB8fCAod2luZG93LnBuSGFzUG9seWZpbGxlZCA9ICExKSwgd2luZG93LnBuRnVsbFRQVmVyc2lvbiB8fCAod2luZG93LnBuRnVsbFRQVmVyc2lvbiA9ICExKSwgdm9pZCAwICE9PSB3aW5kb3cucG4gJiYgdm9pZCAwICE9PSB3aW5kb3cucG4uY29udGFpbmVyKVxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJQaWFubyBTREsgaXMgbG9hZGVkIHR3aWNlIG9uIHNhbWUgcGFnZS4gVHJ5IHRvIGZpeCB0aGF0IHRvIHByZXZlbnQgdGhlIG1lc3NhZ2UuXCIpO1xuICAgIGlmICghd2luZG93LnBuRnVsbFRQVmVyc2lvbiAmJiBcInVuZGVmaW5lZFwiICE9IHR5cGVvZiBQcm94eSkge1xuICAgICAgICB2YXIgUiA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIEw7IH0sIEwgPSBuZXcgUHJveHkoe30sIHsgZ2V0OiBmdW5jdGlvbiAoZSwgbiwgdCkgeyByZXR1cm4gXCJpc3ZcIiA9PT0gbiB8fCBSOyB9LCBhcHBseTogZnVuY3Rpb24gKGUsIG4sIHQpIHsgcmV0dXJuIEw7IH0gfSk7XG4gICAgICAgIE0ucmVzb2x2ZSA9IG5ldyBQcm94eShNLnJlc29sdmUsIHsgYXBwbHk6IGZ1bmN0aW9uIChlLCBuLCB0KSB7IGlmIChNLmlzUmVnaXN0ZXJlZCh0WzBdKSlcbiAgICAgICAgICAgICAgICByZXR1cm4gUmVmbGVjdC5hcHBseShlLCBuLCB0KTsgTS5yZWdpc3Rlcih0WzBdLCB7IHVzZVZhbHVlOiBMIH0pOyB2YXIgciA9IE0ucmVzb2x2ZSh0WzBdKTsgcmV0dXJuIFVbdFswXV0gPSByLCByOyB9IH0pO1xuICAgIH1cbiAgICB2YXIgTiA9IHdpbmRvdy5wbiB8fCB7fSwgVSA9IHdpbmRvdy5wbiA9IHt9O1xuICAgIFUuY29udGFpbmVyID0gTSwgVS5zaW5nbGV0b24gPSBmdW5jdGlvbiAoKSB7IHJldHVybiBmdW5jdGlvbiAoZSkgeyBPKCkoZSksIE0ucmVnaXN0ZXJTaW5nbGV0b24oZSk7IH07IH0sIFUuaW5qZWN0YWJsZSA9IE8sIFUuaW5qZWN0ID0gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIG4gPSBlLCBmdW5jdGlvbiAoZSwgciwgbykgeyB2YXIgaSA9IFJlZmxlY3QuZ2V0T3duTWV0YWRhdGEobSwgZSkgfHwge307IGlbb10gPSB0ID8geyB0b2tlbjogbiwgdHJhbnNmb3JtOiB0LnRyYW5zZm9ybVRva2VuLCB0cmFuc2Zvcm1BcmdzOiB0LmFyZ3MgfHwgW10gfSA6IG4sIFJlZmxlY3QuZGVmaW5lTWV0YWRhdGEobSwgaSwgZSk7IH07IHZhciBuLCB0OyB9LCBVLnJlZ2lzdHJ5ID0gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIHZvaWQgMCA9PT0gZSAmJiAoZSA9IFtdKSwgZnVuY3Rpb24gKG4pIHsgcmV0dXJuIGUuZm9yRWFjaCgoZnVuY3Rpb24gKGUpIHsgdmFyIG4gPSBlLnRva2VuLCB0ID0gZS5vcHRpb25zLCByID0gZnVuY3Rpb24gKGUsIG4pIHsgdmFyIHQgPSB7fTsgZm9yICh2YXIgciBpbiBlKVxuICAgICAgICBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgcikgJiYgbi5pbmRleE9mKHIpIDwgMCAmJiAodFtyXSA9IGVbcl0pOyBpZiAobnVsbCAhPSBlICYmIFwiZnVuY3Rpb25cIiA9PSB0eXBlb2YgT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scykge1xuICAgICAgICB2YXIgbyA9IDA7XG4gICAgICAgIGZvciAociA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMoZSk7IG8gPCByLmxlbmd0aDsgbysrKVxuICAgICAgICAgICAgbi5pbmRleE9mKHJbb10pIDwgMCAmJiBPYmplY3QucHJvdG90eXBlLnByb3BlcnR5SXNFbnVtZXJhYmxlLmNhbGwoZSwgcltvXSkgJiYgKHRbcltvXV0gPSBlW3Jbb11dKTtcbiAgICB9IHJldHVybiB0OyB9KGUsIFtcInRva2VuXCIsIFwib3B0aW9uc1wiXSk7IHJldHVybiBNLnJlZ2lzdGVyKG4sIHIsIHQpOyB9KSksIG47IH07IH0sIFUuaW5zdGFuY2VDYWNoaW5nRmFjdG9yeSA9IGZ1bmN0aW9uIChlKSB7IHZhciBuOyByZXR1cm4gZnVuY3Rpb24gKHQpIHsgcmV0dXJuIG51bGwgPT0gbiAmJiAobiA9IGUodCkpLCBuOyB9OyB9LCBVLnByZWRlZmluZWRPcHRpb25zID0gTiwgTS5yZWdpc3RlcihcInByZWRlZmluZWRPcHRpb25zXCIsIHsgdXNlVmFsdWU6IE4gfSk7XG4gICAgdmFyIGogPSAhMTtcbiAgICB0cnkge1xuICAgICAgICBpZiAoIXdpbmRvdy5wbkhhc1BvbHlmaWxsZWQpIHtcbiAgICAgICAgICAgIGlmIChcInVuZGVmaW5lZFwiID09IHR5cGVvZiBQcm94eSlcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJUaGUgYnJvd3NlciBjYW5ub3QgUHJveHlcIik7XG4gICAgICAgICAgICBpZiAobmV3IFByb21pc2UoKGZ1bmN0aW9uIChlKSB7IH0pKSwgT2JqZWN0LmFzc2lnbih7fSwge30pLCBbXCJcIl0uaW5jbHVkZXMoXCJcIiksICFFbGVtZW50LnByb3RvdHlwZS5jbG9zZXN0KVxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlRoZXJlIGlzIG5vIGNsb3Nlc3QgbWV0aG9kIG9mIGEgRE9NIGVsZW1lbnRcIik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgaiA9ICEwO1xuICAgIH1cbiAgICBpZiAoaikge1xuICAgICAgICB2YXIgRCA9IGZ1bmN0aW9uICgpIHsgdmFyIGUsIG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwic2NyaXB0XCIpOyBpZiAobi5sZW5ndGgpXG4gICAgICAgICAgICBmb3IgKHZhciB0ID0gMCwgciA9IG47IHQgPCByLmxlbmd0aDsgdCsrKSB7XG4gICAgICAgICAgICAgICAgdmFyIG8gPSByW3RdLCBpID0gbnVsbCA9PT0gKGUgPSBudWxsID09IG8gPyB2b2lkIDAgOiBvLnNyYykgfHwgdm9pZCAwID09PSBlID8gdm9pZCAwIDogZS5tYXRjaCgvXi4qPyh0aW55cGFzcy5jb218cGlhbm8uaW8pL2kpO1xuICAgICAgICAgICAgICAgIGlmIChpKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaVswXTtcbiAgICAgICAgICAgIH0gcmV0dXJuIFwiaHR0cHM6Ly9zYW5kYm94LnRpbnlwYXNzLmNvbVwiOyB9KCk7XG4gICAgICAgIGRlbGV0ZSB3aW5kb3cucG47XG4gICAgICAgIHZhciBGID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNjcmlwdFwiKTtcbiAgICAgICAgdGhyb3cgRi50eXBlID0gXCJ0ZXh0L2phdmFzY3JpcHRcIiwgRi5hc3luYyA9ICEwLCBGLnNyYyA9IEQgKyBcIi9hcGkvcGlhbm8uZXM1LmpzXCIsIGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiaGVhZFwiKVswXS5hcHBlbmRDaGlsZChGKSwgbmV3IEVycm9yKFwiTG9hZCBmdWxsIHZlcnNpb24gb2YgcGlhbm8gU0RLXCIpO1xuICAgIH1cbiAgICB2YXIgQiwgViA9IChCID0gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIG5ldyBQcm9taXNlKChmdW5jdGlvbiAobiwgdCkgeyB2YXIgciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzdHlsZVwiKTsgci50eXBlID0gXCJ0ZXh0L2Nzc1wiLCByLmlubmVySFRNTCA9IGUsIHIub25sb2FkID0gbiwgci5vbmVycm9yID0gdCwgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJoZWFkXCIpWzBdLmFwcGVuZENoaWxkKHIpOyB9KSk7IH0sIHsgbmFtZTogXCJjc3NcIiwgbG9hZE9mZmVyQ3NzOiBmdW5jdGlvbiAoKSB7IEIoXCIudHAtYmFja2Ryb3Age1xcbiAgICBkaXNwbGF5OiBub25lO1xcbiAgICBwb3NpdGlvbjogZml4ZWQ7XFxuICAgIHRvcDogMDtcXG4gICAgbGVmdDogMDtcXG4gICAgcmlnaHQ6IDA7XFxuICAgIGJvdHRvbTogMDtcXG4gICAgYmFja2dyb3VuZDogIzEyMTIxNDtcXG4gICAgei1pbmRleDogMzAwMDAwO1xcbiAgICBvcGFjaXR5OiAwO1xcbiAgICB0cmFuc2l0aW9uOiBvcGFjaXR5IC4yNXMgbGluZWFyO1xcbn1cXG4udHAtYmFja2Ryb3AudHAtYWN0aXZlIHtcXG4gICAgb3BhY2l0eTogLjk7XFxufVxcbi50cC1tb2RhbCAudHAtY2xvc2UudHAtc3F1YXJlIHtcXG4gICAgYmFja2dyb3VuZDogI2NjYztcXG4gICAgYm9yZGVyLXJhZGl1czogMDtcXG4gICAgYm9yZGVyOiAwO1xcbiAgICB0b3A6IDA7XFxuICAgIHJpZ2h0OiAtNDBweDtcXG59XFxuLnRwLW1vZGFsIC50cC1jbG9zZSB7XFxuICAgIGRpc3BsYXk6IG5vbmU7XFxuICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTtcXG4gICAgdG9wOiAtMjBweDtcXG4gICAgcmlnaHQ6IC0yMHB4O1xcbiAgICB3aWR0aDogNDBweDtcXG4gICAgaGVpZ2h0OiA0MHB4O1xcbiAgICBiYWNrZ3JvdW5kOiAjZmZmIHVybChcXFwiZGF0YTppbWFnZS9zdmcreG1sLCUzQ3N2ZyB3aWR0aD0nMTEnIGhlaWdodD0nMTEnIGZpbGw9J25vbmUnIHhtbG5zPSdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyclM0UlM0NwYXRoIGZpbGwtcnVsZT0nZXZlbm9kZCcgY2xpcC1ydWxlPSdldmVub2RkJyBkPSdNMTEgMS4zNjhMOS42MzIgMCA1LjUgNC4xNDIgMS4zNjggMCAwIDEuMzY4IDQuMTQyIDUuNSAwIDkuNjMyIDEuMzY4IDExIDUuNSA2Ljg1OCA5LjYzMiAxMSAxMSA5LjYzMiA2Ljg1OCA1LjUgMTEgMS4zNjh6JyBmaWxsPSclMjM5NTk1OTUnLyUzRSUzQy9zdmclM0VcXFwiKSBjZW50ZXIgY2VudGVyIG5vLXJlcGVhdDtcXG4gICAgYm9yZGVyOiBub25lO1xcbiAgICBib3gtc2hhZG93OiAwIDAgMTBweCAwIHJnYmEoMjgsIDM3LCA2OCwgMC4xNSk7XFxuICAgIG91dGxpbmU6IG5vbmU7XFxuICAgIHotaW5kZXg6IDMwMDEwMDtcXG4gICAgYm9yZGVyLXJhZGl1czogNDBweDtcXG4gICAgb3BhY2l0eTogMDtcXG4gICAgY3Vyc29yOiBwb2ludGVyO1xcbiAgICB0cmFuc2Zvcm06IHNjYWxlKC4yNSwgLjI1KTtcXG4gICAgLXdlYmtpdC1hcHBlYXJhbmNlOiBub25lO1xcbiAgICAtbW96LWFwcGVhcmFuY2U6IG5vbmU7XFxuICAgIGFwcGVhcmFuY2U6IG5vbmU7XFxufVxcbi50cC1tb2RhbCAudHAtY2xvc2U6aG92ZXIsXFxuLnRwLW1vZGFsIC50cC1jbG9zZTpmb2N1cyB7XFxuICAgIGJveC1zaGFkb3c6IDAgMCAxMHB4IDJweCByZ2JhKDI4LCAzNywgNjgsIDAuMTUpO1xcbn1cXG4udHAtbW9kYWwgLnRwLWNsb3NlOmZvY3VzIHtcXG4gICBib3JkZXI6IDFweCBzb2xpZDtcXG59XFxuLnRwLW1vZGFsIC50cC1jbG9zZS50cC1hY3RpdmUge1xcbiAgICBkaXNwbGF5OiBibG9jaztcXG4gICAgb3BhY2l0eTogMTtcXG4gICAgdHJhbnNmb3JtOiBzY2FsZSgxLCAxKTtcXG59XFxuLnRwLW1vZGFsIC50cC1pZnJhbWUtd3JhcHBlcltkaXI9XFxcInJ0bFxcXCJdIC50cC1jbG9zZSB7XFxuICByaWdodDogaW5pdGlhbDtcXG4gIGxlZnQ6IC0yMHB4O1xcbn1cXG5cXG4udHAtbW9kYWwgLnRwLWlmcmFtZS13cmFwcGVyLnBpYW5vLWlkLW1vZGFsLXZlci0yIC50cC1jbG9zZSB7XFxuICB0b3A6IDA7XFxuICByaWdodDogMDtcXG4gIHdpZHRoOiA2NHB4O1xcbiAgaGVpZ2h0OiA2NHB4O1xcbiAgYm94LXNoYWRvdzogbm9uZTtcXG4gIG91dGxpbmU6IG5vbmU7XFxuICBib3JkZXItcmFkaXVzOiAwO1xcbiAgYm9yZGVyLWxlZnQ6IDFweCBzb2xpZCByZ2JhKDE1LCAxNSwgMjEsIDAuMik7XFxuICBiYWNrZ3JvdW5kOiB1cmwoXFxcImRhdGE6aW1hZ2Uvc3ZnK3htbCwlM0Nzdmcgd2lkdGg9JzE2JyBoZWlnaHQ9JzE2JyB2aWV3Qm94PScwIDAgMTYgMTYnIGZpbGw9J25vbmUnIHhtbG5zPSdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyclM0UlM0NnICUzRSUzQ3BhdGggZD0nTTMgM0wxMyAxM00xMyAzTDMgMTMnIHN0cm9rZT0nJTIzMEYwRjE1JyBzdHJva2Utd2lkdGg9JzInLyUzRSUzQy9nJTNFJTNDL3N2ZyUzRSUwQVxcXCIpIGNlbnRlciBjZW50ZXIgbm8tcmVwZWF0O1xcbiAgb3BhY2l0eTogMC4zO1xcbn1cXG5cXG4udHAtbW9kYWwgLnRwLWlmcmFtZS13cmFwcGVyLnBpYW5vLWlkLW1vZGFsLXZlci0yIC50cC1jbG9zZS50cC1hY3RpdmUge1xcbiAgb3BhY2l0eTogMC4zO1xcbn1cXG5cXG4udHAtbW9kYWwgLnRwLWlmcmFtZS13cmFwcGVyLnBpYW5vLWlkLW1vZGFsLXZlci0yIC50cC1jbG9zZTpob3ZlcixcXG4udHAtbW9kYWwgLnRwLWlmcmFtZS13cmFwcGVyLnBpYW5vLWlkLW1vZGFsLXZlci0yIC50cC1jbG9zZTpmb2N1cyB7XFxuICBib3gtc2hhZG93OiBub25lO1xcbiAgYm9yZGVyOiBub25lO1xcbiAgYm9yZGVyLWxlZnQ6IDFweCBzb2xpZCByZ2JhKDE1LCAxNSwgMjEsIDAuMDYpO1xcbiAgb3BhY2l0eTogMTtcXG59XFxuXFxuLnRwLW1vZGFsIC50cC1pZnJhbWUtd3JhcHBlci5waWFuby1pZC1tb2RhbC12ZXItMltkaXI9XFxcInJ0bFxcXCJdIC50cC1jbG9zZSB7XFxuICByaWdodDogYXV0bztcXG4gIGxlZnQ6IDA7XFxuICBib3JkZXItbGVmdDogbm9uZTtcXG4gIGJvcmRlci1yaWdodDogMXB4IHNvbGlkIHJnYmEoMTUsIDE1LCAyMSwgMC4yKTtcXG59XFxuXFxuLnRwLW1vZGFsIC50cC1pZnJhbWUtd3JhcHBlci5waWFuby1pZC1tb2RhbC12ZXItMltkaXI9XFxcInJ0bFxcXCJdIC50cC1jbG9zZTpob3ZlcixcXG4udHAtbW9kYWwgLnRwLWlmcmFtZS13cmFwcGVyLnBpYW5vLWlkLW1vZGFsLXZlci0yW2Rpcj1cXFwicnRsXFxcIl0gLnRwLWNsb3NlOmZvY3VzIHtcXG4gIGJvcmRlci1sZWZ0OiBub25lO1xcbiAgYm9yZGVyLXJpZ2h0OiAxcHggc29saWQgcmdiYSgxNSwgMTUsIDIxLCAwLjA2KTtcXG59XFxuXFxuLnRwLW1vZGFsIHtcXG4gICAgei1pbmRleDogMzAwMDUwO1xcbn1cXG5AbWVkaWEgc2NyZWVuIGFuZCAobWF4LXdpZHRoOiA2NTBweCkge1xcbiAgICAudHAtbW9kYWwgLnRwLWNsb3NlIHtcXG4gICAgICAgIHJpZ2h0OiAwO1xcbiAgICB9XFxuXFxuICAgIC50cC1tb2RhbCAudHAtaWZyYW1lLXdyYXBwZXJbZGlyPVxcXCJydGxcXFwiXSAudHAtY2xvc2Uge1xcbiAgICAgIHJpZ2h0OiBpbml0aWFsO1xcbiAgICAgIGxlZnQ6IDA7XFxuICAgIH1cXG59XFxuLnRwLW1vZGFsIC50cC1pZnJhbWUtd3JhcHBlci50cC1jdXJ0YWluIHtcXG4gICAgd2lkdGg6IDYwMHB4O1xcbiAgICBoZWlnaHQ6IDQ4MHB4O1xcbn1cXG4udHAtbW9kYWwtb3BlbiB7XFxuICAgIG92ZXJmbG93OiBoaWRkZW4gIWltcG9ydGFudDtcXG4gICAgaGVpZ2h0OiAxMDB2aDtcXG4gICAgLXdlYmtpdC1vdmVyZmxvdy1zY3JvbGxpbmc6IHRvdWNoO1xcbn1cXG4udHAtbW9kYWwtb3Blbi50cC1tb2RhbC1yZXNpemluZyB7XFxuICAgIC13ZWJraXQtb3ZlcmZsb3ctc2Nyb2xsaW5nOiBhdXRvO1xcbn1cXG4vKkJ1ZyBmaXggb2YgZmlyZWZveCB2NTcqL1xcbi50cC1tb2RhbC1jbG9zZSB7XFxuICAgIG92ZXJmbG93OiBhdXRvO1xcbn1cXG4udHAtbW9kYWxfX21hcmdpbi0xMDAgLnRwLWlmcmFtZS13cmFwcGVyIHtcXG4gIG1hcmdpbi1ib3R0b206IDEwMHB4O1xcbn1cXG4udHAtaWZyYW1lLXdyYXBwZXIge1xcbiAgICBwb3NpdGlvbjogcmVsYXRpdmU7XFxuICAgIG1hcmdpbjogNTBweCBhdXRvO1xcbiAgICBib3gtc2hhZG93OiAwIDAgMTBweCByZ2JhKDAsIDAsIDAsIDAuMjEpO1xcbn1cXG4udHAtaWZyYW1lLXdyYXBwZXIubm8tc2hhZG93IHtcXG4gIGJveC1zaGFkb3c6IHVuc2V0O1xcbn1cXG4udHAtbW9kYWwge1xcbiAgICBvdmVyZmxvdy14OiBoaWRkZW47XFxuICAgIG92ZXJmbG93LXk6IHNjcm9sbCAhaW1wb3J0YW50O1xcbiAgICBkaXNwbGF5OiBub25lO1xcbiAgICBwb3NpdGlvbjogZml4ZWQ7XFxuICAgIHRvcDogMDtcXG4gICAgYm90dG9tOiAwO1xcbiAgICBsZWZ0OiAwO1xcbiAgICByaWdodDogMDtcXG4gICAgdHJhbnNmb3JtOiB0cmFuc2xhdGUzZCgwLCAwLCAwKTtcXG59XFxuLnRwLW1vZGFsIC50cC1tZXNzYWdlIHtcXG4gICAgZm9udC1mYW1pbHk6IFxcXCJHcmFwaGlrIFdlYiBSZWd1bGFyXFxcIiwgSGVsdmV0aWNhLCBBcmlhbCwgc2Fucy1zZXJpZjtcXG4gICAgcGFkZGluZzogMTBweDtcXG59XFxuLnRwLW1vZGFsIC50cC1idG4tY29udGFpbmVyIHtcXG4gICAgcGFkZGluZy1sZWZ0OiAxMHB4O1xcbiAgICBwYWRkaW5nLWJvdHRvbTogMTBweDtcXG59XFxuLnRwLWN4ZW5zZS1wbGFjZWhvbGRlci1tb2RhbCB7XFxuICAgIHdpZHRoOiAxMDAlO1xcbiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZmZmO1xcbiAgICBtYXgtd2lkdGg6IDkxMnB4O1xcbiAgICBkaXNwbGF5OiBibG9jaztcXG4gICAgb3ZlcmZsb3c6IGhpZGRlbjtcXG4gICAgaGVpZ2h0OiBhdXRvO1xcbiAgICBvcGFjaXR5OiAxO1xcbn1cXG4udHAtd2lkZ2V0LXBsYWNlaG9sZGVyID4gZGl2OjphZnRlciB7XFxuICAgIGRpc3BsYXk6IGJsb2NrO1xcbiAgICBjb250ZW50OiBcXFwiXFxcIjtcXG4gICAgY2xlYXI6IGJvdGg7XFxufVxcbi50cC1idG4ge1xcbiAgICB0ZXh0LWRlY29yYXRpb246IG5vbmU7XFxuICAgIGN1cnNvcjogcG9pbnRlcjtcXG4gICAgcGFkZGluZzogMCAxOHB4O1xcbiAgICBsaW5lLWhlaWdodDogNDBweDtcXG4gICAgYm9yZGVyLWNvbGxhcHNlOiBzZXBhcmF0ZTtcXG4gICAgYm9yZGVyLXJhZGl1czogNHB4O1xcbiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7XFxuICAgIHZlcnRpY2FsLWFsaWduOiBtaWRkbGU7XFxuICAgIGRpc3BsYXk6IGlubGluZS1ibG9jaztcXG4gICAgY29sb3I6ICNmZmY7XFxuICAgIGJvcmRlcjogbm9uZTtcXG4gICAgYm94LXNoYWRvdzogaW5zZXQgMCAtMXB4IDAgcmdiYSgyMTYsIDIxOCwgMjIxLCAwLjApO1xcbiAgICBiYWNrZ3JvdW5kOiAjMzg3OEQ4O1xcbiAgICBiYWNrZ3JvdW5kLXBvc2l0aW9uOiBib3R0b207XFxuICAgIHRleHQtc2hhZG93OiBub25lO1xcbiAgICBmb250LWZhbWlseTogXFxcIkdyYXBoaWsgV2ViIFJlZ3VsYXJcXFwiLCBIZWx2ZXRpY2EsIEFyaWFsLCBzYW5zLXNlcmlmO1xcbiAgICB3aGl0ZS1zcGFjZTogbm93cmFwO1xcbiAgICBvdXRsaW5lOiAwO1xcbn1cXG4udHAtcGxlYXNlLXdhaXQudHAtYWN0aXZlIHtcXG4gICAgZGlzcGxheTogYmxvY2s7XFxuICAgIG9wYWNpdHk6IC45O1xcbiAgICB0cmFuc2l0aW9uOiBvcGFjaXR5IC4yNXMgbGluZWFyO1xcbn1cXG4udHAtcGxlYXNlLXdhaXQge1xcbiAgICBwb3NpdGlvbjogYWJzb2x1dGU7XFxuICAgIHRvcDogMDtcXG4gICAgbGVmdDogMDtcXG4gICAgYmFja2dyb3VuZC1jb2xvcjogIzk5OTtcXG4gICAgb3BhY2l0eTogMDtcXG4gICAgd2lkdGg6IDEwMCU7XFxuICAgIGhlaWdodDogMTAwJTtcXG4gICAgZGlzcGxheTogbm9uZTtcXG4gICAgdGV4dC1hbGlnbjogY2VudGVyO1xcbiAgICBjb2xvcjogI2ZmZjtcXG4gICAgZm9udC13ZWlnaHQ6IGxpZ2h0ZXI7XFxuICAgIGZvbnQtZmFtaWx5OiBcXFwiT3BlbiBTYW5zXFxcIiwgc2Fucy1zZXJpZjtcXG4gICAgZm9udC1zaXplOiAxNXB4O1xcbn1cXG4udHAtcGxlYXNlLXdhaXQudHAtb3ZlcmxhcCB7XFxuICBwb3NpdGlvbjogZml4ZWQ7XFxuICB6LWluZGV4OiAzMDAxNTA7XFxufVxcblxcbi50cC1wbGVhc2Utd2FpdC50cC1sb2NhbC1vdmVybGFwIHtcXG4gIHBvc2l0aW9uOiBhYnNvbHV0ZTtcXG59XFxuXFxuLnRwLXBsZWFzZS13YWl0ID4gLnRwLWljb24ge1xcbiAgICB3aWR0aDogODBweDtcXG4gICAgaGVpZ2h0OiA4MHB4O1xcbiAgICBtYXJnaW46IDEwMHB4IGF1dG8gMjBweCBhdXRvO1xcbn1cXG5cXG4ucG4tc3Bpbm5lciB7XFxuICBjb2xvcjogZ3JleTtcXG4gIGRpc3BsYXk6IGlubGluZS1ibG9jaztcXG4gIHBvc2l0aW9uOiByZWxhdGl2ZTtcXG4gIHdpZHRoOiA4MHB4O1xcbiAgaGVpZ2h0OiA4MHB4O1xcbn1cXG4ucG4tc3Bpbm5lciBkaXYge1xcbiAgdHJhbnNmb3JtLW9yaWdpbjogNDBweCA0MHB4O1xcbiAgYW5pbWF0aW9uOiBwbi1zcGlubmVyIDEuMnMgbGluZWFyIGluZmluaXRlO1xcbn1cXG4ucG4tc3Bpbm5lciBkaXY6YWZ0ZXIge1xcbiAgY29udGVudDogXFxcIiBcXFwiO1xcbiAgZGlzcGxheTogYmxvY2s7XFxuICBwb3NpdGlvbjogYWJzb2x1dGU7XFxuICB0b3A6IDNweDtcXG4gIGxlZnQ6IDM3cHg7XFxuICB3aWR0aDogNnB4O1xcbiAgaGVpZ2h0OiAxOHB4O1xcbiAgYm9yZGVyLXJhZGl1czogMjAlO1xcbiAgYmFja2dyb3VuZDogI2ZmZjtcXG59XFxuLnBuLXNwaW5uZXIgZGl2Om50aC1jaGlsZCgxKSB7XFxuICB0cmFuc2Zvcm06IHJvdGF0ZSgwZGVnKTtcXG4gIGFuaW1hdGlvbi1kZWxheTogLTEuMXM7XFxufVxcbi5wbi1zcGlubmVyIGRpdjpudGgtY2hpbGQoMikge1xcbiAgdHJhbnNmb3JtOiByb3RhdGUoMzBkZWcpO1xcbiAgYW5pbWF0aW9uLWRlbGF5OiAtMXM7XFxufVxcbi5wbi1zcGlubmVyIGRpdjpudGgtY2hpbGQoMykge1xcbiAgdHJhbnNmb3JtOiByb3RhdGUoNjBkZWcpO1xcbiAgYW5pbWF0aW9uLWRlbGF5OiAtMC45cztcXG59XFxuLnBuLXNwaW5uZXIgZGl2Om50aC1jaGlsZCg0KSB7XFxuICB0cmFuc2Zvcm06IHJvdGF0ZSg5MGRlZyk7XFxuICBhbmltYXRpb24tZGVsYXk6IC0wLjhzO1xcbn1cXG4ucG4tc3Bpbm5lciBkaXY6bnRoLWNoaWxkKDUpIHtcXG4gIHRyYW5zZm9ybTogcm90YXRlKDEyMGRlZyk7XFxuICBhbmltYXRpb24tZGVsYXk6IC0wLjdzO1xcbn1cXG4ucG4tc3Bpbm5lciBkaXY6bnRoLWNoaWxkKDYpIHtcXG4gIHRyYW5zZm9ybTogcm90YXRlKDE1MGRlZyk7XFxuICBhbmltYXRpb24tZGVsYXk6IC0wLjZzO1xcbn1cXG4ucG4tc3Bpbm5lciBkaXY6bnRoLWNoaWxkKDcpIHtcXG4gIHRyYW5zZm9ybTogcm90YXRlKDE4MGRlZyk7XFxuICBhbmltYXRpb24tZGVsYXk6IC0wLjVzO1xcbn1cXG4ucG4tc3Bpbm5lciBkaXY6bnRoLWNoaWxkKDgpIHtcXG4gIHRyYW5zZm9ybTogcm90YXRlKDIxMGRlZyk7XFxuICBhbmltYXRpb24tZGVsYXk6IC0wLjRzO1xcbn1cXG4ucG4tc3Bpbm5lciBkaXY6bnRoLWNoaWxkKDkpIHtcXG4gIHRyYW5zZm9ybTogcm90YXRlKDI0MGRlZyk7XFxuICBhbmltYXRpb24tZGVsYXk6IC0wLjNzO1xcbn1cXG4ucG4tc3Bpbm5lciBkaXY6bnRoLWNoaWxkKDEwKSB7XFxuICB0cmFuc2Zvcm06IHJvdGF0ZSgyNzBkZWcpO1xcbiAgYW5pbWF0aW9uLWRlbGF5OiAtMC4ycztcXG59XFxuLnBuLXNwaW5uZXIgZGl2Om50aC1jaGlsZCgxMSkge1xcbiAgdHJhbnNmb3JtOiByb3RhdGUoMzAwZGVnKTtcXG4gIGFuaW1hdGlvbi1kZWxheTogLTAuMXM7XFxufVxcbi5wbi1zcGlubmVyIGRpdjpudGgtY2hpbGQoMTIpIHtcXG4gIHRyYW5zZm9ybTogcm90YXRlKDMzMGRlZyk7XFxuICBhbmltYXRpb24tZGVsYXk6IDBzO1xcbn1cXG5Aa2V5ZnJhbWVzIHBuLXNwaW5uZXIge1xcbiAgMCUge1xcbiAgICBvcGFjaXR5OiAxO1xcbiAgfVxcbiAgMTAwJSB7XFxuICAgIG9wYWNpdHk6IDA7XFxuICB9XFxufVxcblxcbi50cC1wbGVhc2Utd2FpdCA+IC50cC1pY29uLnRwLWNlbnRlcmVkIHtcXG4gIG1hcmdpbjogMDtcXG4gIHBvc2l0aW9uOiBhYnNvbHV0ZTtcXG4gIHRvcDogNTAlO1xcbiAgbGVmdDogNTAlO1xcbiAgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTUwJSwgLTUwJSk7XFxufVxcbi50cC1pZnJhbWUtd3JhcHBlci5uby13aWR0aCAudHAtY2xvc2UsXFxuLnRwLWlmcmFtZS13cmFwcGVyLm5vLWhlaWdodCAudHAtY2xvc2UsXFxuLnRwLW1vZGFsLm5vLXdpZHRoIC50cC1jbG9zZSxcXG4udHAtbW9kYWwubm8taGVpZ2h0IC50cC1jbG9zZSB7XFxuICAgIGRpc3BsYXk6IG5vbmU7XFxufVxcblxcbi50cC1iYW5uZXIge1xcbiAgcG9zaXRpb246IGZpeGVkO1xcbiAgYm90dG9tOiAwO1xcbiAgbGVmdDogMDtcXG4gIHdpZHRoOiAxMDAlO1xcbn1cXG5cXG4udHAtYmFubmVyID4gLnRwLWNvbnRhaW5lci1pbm5lcixcXG4udHAtYmFubmVyID4gLnRwLWNvbnRhaW5lci1pbm5lciA+IGlmcmFtZSB7XFxuICB3aWR0aDogaW5oZXJpdCAhaW1wb3J0YW50O1xcbn1cXG5cXG4uZnJvemVuLW1vYmlsZS1ib2R5IHtcXG4gIHdpZHRoOiAxMDAlO1xcbiAgbWFyZ2luOiAwO1xcbiAgcG9zaXRpb246IGZpeGVkICFpbXBvcnRhbnQ7XFxuICBtYXgtaGVpZ2h0OiAtd2Via2l0LWZpbGwtYXZhaWxhYmxlO1xcbiAgbWF4LWhlaWdodDogLW1vei1hdmFpbGFibGU7XFxufVxcblwiKTsgfSB9KTtcbiAgICBwbi5jb250YWluZXIucmVnaXN0ZXIoXCJjc3NcIiwgeyB1c2VWYWx1ZTogViB9KSwgcG4uY3NzID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJjc3NcIik7XG4gICAgdmFyIHEsIHosIEggPSBmdW5jdGlvbiAoZSkgeyByZXR1cm4ge30udG9TdHJpbmcuY2FsbChlKS5tYXRjaCgvXFxzKFthLXpBLVpdKykvKVsxXS50b0xvd2VyQ2FzZSgpOyB9LCBXID0gTWF0aC5yb3VuZCgxZTQgKiBNYXRoLnJhbmRvbSgpKSwgSiA9IHdpbmRvdy5kb2N1bWVudCwgRyA9IC9eKD86dGV4dHxhcHBsaWNhdGlvbilcXC9qYXZhc2NyaXB0L2ksIFEgPSAvXig/OnRleHR8YXBwbGljYXRpb24pXFwveG1sL2ksIFggPSBcImFwcGxpY2F0aW9uL2pzb25cIiwgJCA9IFwidGV4dC9odG1sXCIsIFkgPSAvXlxccyokLywgSyA9IGZ1bmN0aW9uIChlKSB7IHZhciBuID0gY2Uoe30sIGUgfHwge30pOyBmb3IgKHEgaW4gSy5zZXR0aW5ncylcbiAgICAgICAgdm9pZCAwID09PSBuW3FdICYmIChuW3FdID0gSy5zZXR0aW5nc1txXSk7ICFmdW5jdGlvbiAoZSkgeyBlLmdsb2JhbCAmJiAwID09IEsuYWN0aXZlKysgJiYgWihlKTsgfShuKSwgbi5jcm9zc0RvbWFpbiB8fCAobi5jcm9zc0RvbWFpbiA9IC9eKFtcXHctXSs6KT9cXC9cXC8oW15cXC9dKykvLnRlc3Qobi51cmwpICYmIFJlZ0V4cC4kMiAhPSB3aW5kb3cubG9jYXRpb24uaG9zdCk7IHZhciB0ID0gbi5kYXRhVHlwZSwgciA9IC89XFw/Ly50ZXN0KG4udXJsKTsgaWYgKFwianNvbnBcIiA9PSB0IHx8IHIpXG4gICAgICAgIHJldHVybiByIHx8IChuLnVybCA9IG9lKG4udXJsLCBcImNhbGxiYWNrPT9cIikpLCBLLkpTT05QKG4pOyBuLnVybCB8fCAobi51cmwgPSB3aW5kb3cubG9jYXRpb24udG9TdHJpbmcoKSksIGllKG4pOyB2YXIgbywgaSA9IG4uYWNjZXB0c1t0XSwgYSA9IHt9LCBzID0gL14oW1xcdy1dKzopXFwvXFwvLy50ZXN0KG4udXJsKSA/IFJlZ0V4cC4kMSA6IHdpbmRvdy5sb2NhdGlvbi5wcm90b2NvbCwgYyA9IEsuc2V0dGluZ3MueGhyKCk7IG4uY3Jvc3NEb21haW4gfHwgKGFbXCJYLVJlcXVlc3RlZC1XaXRoXCJdID0gXCJYTUxIdHRwUmVxdWVzdFwiKSwgaSAmJiAoYS5BY2NlcHQgPSBpLCBpLmluZGV4T2YoXCIsXCIpID4gLTEgJiYgKGkgPSBpLnNwbGl0KFwiLFwiLCAyKVswXSksIGMub3ZlcnJpZGVNaW1lVHlwZSAmJiBjLm92ZXJyaWRlTWltZVR5cGUoaSkpLCAobi5jb250ZW50VHlwZSB8fCBuLmRhdGEgJiYgXCJHRVRcIiAhPSBuLnR5cGUudG9VcHBlckNhc2UoKSkgJiYgKGFbXCJDb250ZW50LVR5cGVcIl0gPSBuLmNvbnRlbnRUeXBlIHx8IFwiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkXCIpLCBuLmhlYWRlcnMgPSBjZShhLCBuLmhlYWRlcnMgfHwge30pOyB2YXIgbCA9IG4ueGhyRmllbGRzICYmIG4ueGhyRmllbGRzLndpdGhDcmVkZW50aWFsczsgbCAmJiAoYy53aXRoQ3JlZGVudGlhbHMgPSBsKSwgYy5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbiAoKSB7IGlmICg0ID09IGMucmVhZHlTdGF0ZSkge1xuICAgICAgICBjbGVhclRpbWVvdXQobyk7XG4gICAgICAgIHZhciBlLCByID0gITE7XG4gICAgICAgIGlmIChjLnN0YXR1cyA+PSAyMDAgJiYgYy5zdGF0dXMgPCAzMDAgfHwgMzA0ID09IGMuc3RhdHVzIHx8IDAgPT0gYy5zdGF0dXMgJiYgXCJmaWxlOlwiID09IHMpIHtcbiAgICAgICAgICAgIHQgPSB0IHx8IGZ1bmN0aW9uIChlKSB7IHJldHVybiBlICYmIChlID09ICQgPyBcImh0bWxcIiA6IGUgPT0gWCA/IFwianNvblwiIDogRy50ZXN0KGUpID8gXCJzY3JpcHRcIiA6IFEudGVzdChlKSAmJiBcInhtbFwiKSB8fCBcInRleHRcIjsgfShjLmdldFJlc3BvbnNlSGVhZGVyKFwiY29udGVudC10eXBlXCIpKSwgZSA9IGMucmVzcG9uc2VUZXh0O1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBcInNjcmlwdFwiID09IHQgPyAoMCwgZXZhbCkoZSkgOiBcInhtbFwiID09IHQgPyBlID0gYy5yZXNwb25zZVhNTCA6IFwianNvblwiID09IHQgJiYgKGUgPSBZLnRlc3QoZSkgPyBudWxsIDogSlNPTi5wYXJzZShlKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIHIgPSBlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgciA/IG5lKHIsIFwicGFyc2VyZXJyb3JcIiwgYywgbikgOiBlZShlLCBjLCBuKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICBuZShudWxsLCBcImVycm9yXCIsIGMsIG4pO1xuICAgIH0gfTsgdmFyIHUgPSAhKFwiYXN5bmNcIiBpbiBuKSB8fCBuLmFzeW5jOyBmb3IgKHogaW4gYy5vcGVuKG4udHlwZSwgbi51cmwsIHUpLCBuLmhlYWRlcnMpXG4gICAgICAgIGMuc2V0UmVxdWVzdEhlYWRlcih6LCBuLmhlYWRlcnNbel0pOyByZXR1cm4gITEgPT09IGZ1bmN0aW9uIChlLCBuKSB7IHZhciB0ID0gbi5jb250ZXh0OyBpZiAoITEgPT09IG4uYmVmb3JlU2VuZC5jYWxsKHQsIGUsIG4pIHx8ICExID09PSBaKG4pKVxuICAgICAgICByZXR1cm4gITE7IFoobik7IH0oYywgbikgPyAoYy5hYm9ydCgpLCAhMSkgOiAobi50aW1lb3V0ID4gMCAmJiAobyA9IHNldFRpbWVvdXQoKGZ1bmN0aW9uICgpIHsgYy5vbnJlYWR5c3RhdGVjaGFuZ2UgPSByZSwgYy5hYm9ydCgpLCBuZShudWxsLCBcInRpbWVvdXRcIiwgYywgbik7IH0pLCBuLnRpbWVvdXQpKSwgYy5zZW5kKG4uZGF0YSA/IG4uZGF0YSA6IG51bGwpLCBjKTsgfTtcbiAgICBmdW5jdGlvbiBaKGUsIG4sIHQsIHIpIHsgaWYgKGUuZ2xvYmFsKVxuICAgICAgICByZXR1cm4gITA7IH1cbiAgICBmdW5jdGlvbiBlZShlLCBuLCB0KSB7IHZhciByID0gdC5jb250ZXh0LCBvID0gXCJzdWNjZXNzXCI7IHQuc3VjY2Vzcy5jYWxsKHIsIGUsIG8sIG4pLCBaKHQpLCB0ZShvLCBuLCB0KTsgfVxuICAgIGZ1bmN0aW9uIG5lKGUsIG4sIHQsIHIpIHsgdmFyIG8gPSByLmNvbnRleHQ7IHIuZXJyb3IuY2FsbChvLCB0LCBuLCBlKSwgWihyKSwgdGUobiwgdCwgcik7IH1cbiAgICBmdW5jdGlvbiB0ZShlLCBuLCB0KSB7IHZhciByID0gdC5jb250ZXh0OyB0LmNvbXBsZXRlLmNhbGwociwgbiwgZSksIFoodCksIGZ1bmN0aW9uIChlKSB7IGUuZ2xvYmFsICYmICEtLUsuYWN0aXZlICYmIFooZSk7IH0odCk7IH1cbiAgICBmdW5jdGlvbiByZSgpIHsgfVxuICAgIGZ1bmN0aW9uIG9lKGUsIG4pIHsgcmV0dXJuIChlICsgXCImXCIgKyBuKS5yZXBsYWNlKC9bJj9dezEsMn0vLCBcIj9cIik7IH1cbiAgICBmdW5jdGlvbiBpZShlKSB7IHZhciBuLCB0LCByOyBcIm9iamVjdFwiID09PSBIKGUuZGF0YSkgJiYgKGUuZGF0YSA9IChuID0gZS5kYXRhLCAociA9IFtdKS5hZGQgPSBmdW5jdGlvbiAoZSwgbikgeyB0aGlzLnB1c2goYWUoZSkgKyBcIj1cIiArIGFlKG4pKTsgfSwgc2UociwgbiwgdCksIHIuam9pbihcIiZcIikucmVwbGFjZShcIiUyMFwiLCBcIitcIikpKSwgIWUuZGF0YSB8fCBlLnR5cGUgJiYgXCJHRVRcIiAhPSBlLnR5cGUudG9VcHBlckNhc2UoKSB8fCAoZS51cmwgPSBvZShlLnVybCwgZS5kYXRhKSk7IH1cbiAgICBLLmFjdGl2ZSA9IDAsIEsuSlNPTlAgPSBmdW5jdGlvbiAoZSkgeyBpZiAoIShcInR5cGVcIiBpbiBlKSlcbiAgICAgICAgcmV0dXJuIEsoZSk7IHZhciBuLCB0ID0gXCJqc29ucFwiICsgKGUuY2FjaGUgPyBcIkNhbGxiYWNrXCIgOiArK1cpLCByID0gSi5jcmVhdGVFbGVtZW50KFwic2NyaXB0XCIpLCBvID0geyBhYm9ydDogZnVuY3Rpb24gKCkgeyB0IGluIHdpbmRvdyAmJiAod2luZG93W3RdID0gcmUpLCB0ZShcImFib3J0XCIsIG8sIGUpOyB9IH0sIGkgPSBKLmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiaGVhZFwiKVswXSB8fCBKLmRvY3VtZW50RWxlbWVudDsgcmV0dXJuIGUuZXJyb3IgJiYgKHIub25lcnJvciA9IGZ1bmN0aW9uICgpIHsgby5hYm9ydCgpLCBlLmVycm9yKCk7IH0pLCB3aW5kb3dbdF0gPSBmdW5jdGlvbiAocikgeyBjbGVhclRpbWVvdXQobiksIGRlbGV0ZSB3aW5kb3dbdF0sIGVlKHIsIG8sIGUpOyB9LCBpZShlKSwgci5zcmMgPSBlLnVybC5yZXBsYWNlKC89XFw/LywgXCI9XCIgKyB0KSwgaS5pbnNlcnRCZWZvcmUociwgaS5maXJzdENoaWxkKSwgZS50aW1lb3V0ID4gMCAmJiAobiA9IHNldFRpbWVvdXQoKGZ1bmN0aW9uICgpIHsgby5hYm9ydCgpLCB0ZShcInRpbWVvdXRcIiwgbywgZSk7IH0pLCBlLnRpbWVvdXQpKSwgbzsgfSwgSy5zZXR0aW5ncyA9IHsgdHlwZTogXCJHRVRcIiwgYmVmb3JlU2VuZDogcmUsIHN1Y2Nlc3M6IHJlLCBlcnJvcjogcmUsIGNvbXBsZXRlOiByZSwgY29udGV4dDogbnVsbCwgZ2xvYmFsOiAhMCwgeGhyOiBmdW5jdGlvbiAoKSB7IHJldHVybiBuZXcgd2luZG93LlhNTEh0dHBSZXF1ZXN0OyB9LCBhY2NlcHRzOiB7IHNjcmlwdDogXCJ0ZXh0L2phdmFzY3JpcHQsIGFwcGxpY2F0aW9uL2phdmFzY3JpcHRcIiwganNvbjogWCwgeG1sOiBcImFwcGxpY2F0aW9uL3htbCwgdGV4dC94bWxcIiwgaHRtbDogJCwgdGV4dDogXCJ0ZXh0L3BsYWluXCIgfSwgY3Jvc3NEb21haW46ICExLCB0aW1lb3V0OiAwIH0sIEsuZ2V0ID0gZnVuY3Rpb24gKGUsIG4pIHsgcmV0dXJuIEsoeyB1cmw6IGUsIHN1Y2Nlc3M6IG4gfSk7IH0sIEsucG9zdCA9IGZ1bmN0aW9uIChlLCBuLCB0LCByKSB7IHJldHVybiBcImZ1bmN0aW9uXCIgPT09IEgobikgJiYgKHIgPSByIHx8IHQsIHQgPSBuLCBuID0gbnVsbCksIEsoeyB0eXBlOiBcIlBPU1RcIiwgdXJsOiBlLCBkYXRhOiBuLCBzdWNjZXNzOiB0LCBkYXRhVHlwZTogciB9KTsgfSwgSy5nZXRKU09OID0gZnVuY3Rpb24gKGUsIG4pIHsgcmV0dXJuIEsoeyB1cmw6IGUsIHN1Y2Nlc3M6IG4sIGRhdGFUeXBlOiBcImpzb25cIiB9KTsgfTtcbiAgICB2YXIgYWUgPSBlbmNvZGVVUklDb21wb25lbnQ7XG4gICAgZnVuY3Rpb24gc2UoZSwgbiwgdCwgcikgeyB2YXIgbyA9IFwiYXJyYXlcIiA9PT0gSChuKTsgZm9yICh2YXIgaSBpbiBuKSB7XG4gICAgICAgIHZhciBhID0gbltpXTtcbiAgICAgICAgciAmJiAoaSA9IHQgPyByIDogciArIFwiW1wiICsgKG8gPyBcIlwiIDogaSkgKyBcIl1cIiksICFyICYmIG8gPyBlLmFkZChhLm5hbWUsIGEudmFsdWUpIDogKHQgPyBcImFycmF5XCIgPT09IEgoYSkgOiBcIm9iamVjdFwiID09PSBIKGEpKSA/IHNlKGUsIGEsIHQsIGkpIDogZS5hZGQoaSwgYSk7XG4gICAgfSB9XG4gICAgZnVuY3Rpb24gY2UoZSkgeyB2YXIgbiA9IEFycmF5LnByb3RvdHlwZS5zbGljZTsgcmV0dXJuIG4uY2FsbChhcmd1bWVudHMsIDEpLmZvckVhY2goKGZ1bmN0aW9uIChuKSB7IGZvciAocSBpbiBuKVxuICAgICAgICB2b2lkIDAgIT09IG5bcV0gJiYgKGVbcV0gPSBuW3FdKTsgfSkpLCBlOyB9XG4gICAgdmFyIGxlID0gSywgdWUgPSB7IHJlcXVlc3Q6IGZ1bmN0aW9uIChlKSB7IHJldHVybiBlLmRhdGFUeXBlID0gZS5kYXRhVHlwZSB8fCBcImpzb25cIiwgbGUoZSk7IH0gfTtcbiAgICBwbi5jb250YWluZXIucmVnaXN0ZXIoXCJhamF4XCIsIHsgdXNlVmFsdWU6IHVlIH0pLCBwbi5hamF4ID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJhamF4XCIpO1xuICAgIHZhciBkZSA9IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSBmdW5jdGlvbiAoZSkgeyByZXR1cm4gXCJmdW5jdGlvblwiID09IHR5cGVvZiBlOyB9LCBuID0gZnVuY3Rpb24gKGUsIG4pIHsgcmV0dXJuIGUgPyB0KGUsIG4pWzBdIDogbnVsbDsgfSwgdCA9IGZ1bmN0aW9uIChlLCBuKSB7IGlmICghZSlcbiAgICAgICAgcmV0dXJuIFtdOyB2YXIgdCA9IG4gfHwgZG9jdW1lbnQsIHIgPSBlLnNwbGl0KFwiLFwiKSwgbyA9IFtdOyByZXR1cm4gci5mb3JFYWNoKChmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IGUudHJpbSgpOyB0cnkge1xuICAgICAgICBvID0gby5jb25jYXQoQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwodC5xdWVyeVNlbGVjdG9yQWxsKG4pKSk7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIHZhciByID0gbi5pbmRleE9mKFwiIFwiKSA+IC0xO1xuICAgICAgICBpZiAoXCIuXCIgIT09IG5bMF0gfHwgcilcbiAgICAgICAgICAgIGlmIChcIiNcIiAhPT0gblswXSB8fCByKVxuICAgICAgICAgICAgICAgIG8gPSBvLmNvbmNhdChBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbCh0LnF1ZXJ5U2VsZWN0b3JBbGwobikpKTtcbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHZhciBpID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobi5zdWJzdHJpbmcoMSkpO1xuICAgICAgICAgICAgICAgIG8gPSBvLmNvbmNhdChpID8gW2ldIDogW10pO1xuICAgICAgICAgICAgfVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICBvID0gby5jb25jYXQoQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwodC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKG4uc3Vic3RyaW5nKDEpKSkpO1xuICAgIH0gfSkpLCBvOyB9LCByID0gZnVuY3Rpb24gKGUsIG4sIHQpIHsgdC5zZXRBdHRyaWJ1dGUoZSwgbik7IH0sIG8gPSBbXSwgaSA9IGZ1bmN0aW9uICgpIHsgZm9yICh2YXIgZSA9IFtdLCBuID0gMDsgbiA8IGFyZ3VtZW50cy5sZW5ndGg7IG4rKylcbiAgICAgICAgZVtuXSA9IGFyZ3VtZW50c1tuXTsgZm9yICh2YXIgdCA9IHt9LCByID0gMCwgbyA9IGZ1bmN0aW9uIChlKSB7IGZvciAodmFyIG4gaW4gZSlcbiAgICAgICAgZS5oYXNPd25Qcm9wZXJ0eShuKSAmJiAoXCJbb2JqZWN0IE9iamVjdF1cIiA9PT0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGVbbl0pID8gdFtuXSA9IGkodFtuXSwgZVtuXSkgOiB0W25dID0gZVtuXSk7IH07IHIgPCBlLmxlbmd0aDsgcisrKVxuICAgICAgICBvKGVbcl0pOyByZXR1cm4gdDsgfTsgcmV0dXJuIHsgc2Nyb2xsVG9wOiBmdW5jdGlvbiAoKSB7IHJldHVybiB3aW5kb3cucGFnZVlPZmZzZXQgfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcDsgfSwgd2luU2l6ZTogZnVuY3Rpb24gKCkgeyB2YXIgZSA9IHdpbmRvdywgbiA9IGRvY3VtZW50LCB0ID0gbi5kb2N1bWVudEVsZW1lbnQsIHIgPSBuLmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiYm9keVwiKVswXSwgbyA9IGUuaW5uZXJXaWR0aCB8fCB0LmNsaWVudFdpZHRoIHx8IHIuY2xpZW50V2lkdGg7IHJldHVybiB7IGhlaWdodDogZS5pbm5lckhlaWdodCB8fCB0LmNsaWVudEhlaWdodCB8fCByLmNsaWVudEhlaWdodCwgd2lkdGg6IG8gfTsgfSwgaXNQbGFpbk9iamVjdDogZnVuY3Rpb24gKGUpIHsgcmV0dXJuIFwiW29iamVjdCBPYmplY3RdXCIgPT09IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChlKTsgfSwgaXNFbXB0eU9iamVjdDogZnVuY3Rpb24gKGUpIHsgcmV0dXJuIDAgPT09IE9iamVjdC5rZXlzKGUpLmxlbmd0aCAmJiBlLmNvbnN0cnVjdG9yID09PSBPYmplY3Q7IH0sIGlzRnVuY3Rpb246IGUsIGluQXJyYXk6IGZ1bmN0aW9uIChlLCBuKSB7IHJldHVybiBuLmluZGV4T2YoZSk7IH0sIHR5cGU6IGZ1bmN0aW9uIChlKSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoZSkucmVwbGFjZSgvXlxcW29iamVjdCAoLispXFxdJC8sIFwiJDFcIikudG9Mb3dlckNhc2UoKTsgfSwgcmVtb3ZlOiBmdW5jdGlvbiAoZSkgeyB2YXIgbjsgbnVsbCA9PT0gKG4gPSBlLnBhcmVudE5vZGUpIHx8IHZvaWQgMCA9PT0gbiB8fCBuLnJlbW92ZUNoaWxkKGUpOyB9LCBlbXB0eTogZnVuY3Rpb24gKGUpIHsgZm9yICg7IGUuZmlyc3RDaGlsZDspXG4gICAgICAgICAgICBlLnJlbW92ZUNoaWxkKGUuZmlyc3RDaGlsZCk7IH0sIHF1ZXJ5RWw6IG4sIHFhOiB0LCBmaWx0ZXI6IGZ1bmN0aW9uIChlLCBuKSB7IHJldHVybiBBcnJheS5wcm90b3R5cGUuZmlsdGVyLmNhbGwoZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChlKSwgbik7IH0sIGFkZENsYXNzOiBmdW5jdGlvbiAoZSwgbikgeyBuLmNsYXNzTGlzdC5hZGQoZSk7IH0sIHRvZ2dsZUNsYXNzOiBmdW5jdGlvbiAoZSwgbikgeyBuLmNsYXNzTGlzdC50b2dnbGUoZSk7IH0sIHJlbW92ZUNsYXNzOiBmdW5jdGlvbiAoZSwgbikgeyBuLmNsYXNzTGlzdC5yZW1vdmUoZSk7IH0sIGdldFdpZHRoOiBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IGdldENvbXB1dGVkU3R5bGUoZSwgbnVsbCksIHQgPSBuLnBhZGRpbmdMZWZ0LCByID0gbi5wYWRkaW5nUmlnaHQsIG8gPSBlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRoOyByZXR1cm4gbyAtPSBwYXJzZUZsb2F0KHQpICsgcGFyc2VGbG9hdChyKTsgfSwgc2hvdzogZnVuY3Rpb24gKGUpIHsgZS5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiOyB9LCBoaWRlOiBmdW5jdGlvbiAoZSkgeyBlLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjsgfSwgZ2V0SGVpZ2h0OiBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IGdldENvbXB1dGVkU3R5bGUoZSwgbnVsbCksIHQgPSBuLnBhZGRpbmdUb3AsIHIgPSBuLnBhZGRpbmdCb3R0b20sIG8gPSBlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmhlaWdodDsgcmV0dXJuIG8gLT0gcGFyc2VGbG9hdCh0KSArIHBhcnNlRmxvYXQocik7IH0sIHZpc2libGU6IGZ1bmN0aW9uIChlKSB7IHJldHVybiAhIShlLm9mZnNldFdpZHRoIHx8IGUub2Zmc2V0SGVpZ2h0IHx8IGUuZ2V0Q2xpZW50UmVjdHMoKS5sZW5ndGgpOyB9LCBhcHBlbmQ6IGZ1bmN0aW9uIChlLCBuKSB7IGUuYXBwZW5kQ2hpbGQobik7IH0sIHNldEF0dHI6IHIsIHNldEF0dHJzOiBmdW5jdGlvbiAoZSwgbikgeyBPYmplY3Qua2V5cyhlKS5mb3JFYWNoKChmdW5jdGlvbiAodCkgeyByKHQsIGVbdF0sIG4pOyB9KSk7IH0sIGdldEF0dHI6IGZ1bmN0aW9uIChlLCB0KSB7IHJldHVybiBcInN0cmluZ1wiID09IHR5cGVvZiBlICYmIChlID0gbihlKSksIGUgPyBlLmdldEF0dHJpYnV0ZSh0KSA6IG51bGw7IH0sIHJlYWR5OiBmdW5jdGlvbiAoZSkgeyBcImxvYWRpbmdcIiAhPSBkb2N1bWVudC5yZWFkeVN0YXRlID8gZSgpIDogZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIkRPTUNvbnRlbnRMb2FkZWRcIiwgKGZ1bmN0aW9uICgpIHsgcmV0dXJuIGUoKTsgfSkpOyB9LCBkZWxlZ2F0ZTogZnVuY3Rpb24gKGUsIG4sIHQsIHIpIHsgdmFyIGkgPSBmdW5jdGlvbiAodCkgeyBmb3IgKHZhciBpID0gdC50YXJnZXQ7IGkgJiYgbnVsbCAhPSBpOyBpID0gaS5wYXJlbnROb2RlKSB7XG4gICAgICAgICAgICB2YXIgYSA9IG8uZmluZEluZGV4KChmdW5jdGlvbiAodCkgeyByZXR1cm4gdC5wYXJlbnRFbCA9PT0gZSAmJiB0LmVsZW1lbnRTZWxlY3RvciA9PT0gbjsgfSkpO1xuICAgICAgICAgICAgaWYgKGkubWF0Y2hlcyAmJiBpLm1hdGNoZXMobikgJiYgYSA+PSAwKSB7XG4gICAgICAgICAgICAgICAgci5jYWxsKGksIHQpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IH07IG8ucHVzaCh7IHBhcmVudEVsOiBlLCBlbGVtZW50U2VsZWN0b3I6IG4sIGhhbmRsZXI6IGksIGV2ZW50TmFtZTogdCB9KSwgZS5hZGRFdmVudExpc3RlbmVyKHQsIGksICExKTsgfSwgdW5kZWxlZ2F0ZTogZnVuY3Rpb24gKGUsIG4pIHsgbyA9IG8uZmlsdGVyKChmdW5jdGlvbiAodCkgeyB2YXIgciA9IHQucGFyZW50RWwgIT09IGUgJiYgdC5lbGVtZW50U2VsZWN0b3IgIT09IG47IHJldHVybiByIHx8IHQucGFyZW50RWwucmVtb3ZlRXZlbnRMaXN0ZW5lcih0LmV2ZW50TmFtZSwgdC5oYW5kbGVyKSwgcjsgfSkpOyB9LCBvbjogZnVuY3Rpb24gKGUsIG4sIHQpIHsgZS5hZGRFdmVudExpc3RlbmVyKG4sIChmdW5jdGlvbiAoZSkgeyB0KGUpOyB9KSwgITEpOyB9LCBvZmY6IGZ1bmN0aW9uIChlLCBuLCB0KSB7IGUucmVtb3ZlRXZlbnRMaXN0ZW5lcihuLCB0KTsgfSwgZGVlcEV4dGVuZDogaSwgcGFyYW06IGZ1bmN0aW9uIChuKSB7IHZhciB0ID0gW10sIHIgPSBmdW5jdGlvbiAobiwgdCkgeyByZXR1cm4gZW5jb2RlVVJJQ29tcG9uZW50KG4pICsgXCI9XCIgKyBlbmNvZGVVUklDb21wb25lbnQoZSh0KSA/IHQoKSA6IHQgfHwgMCA9PT0gdCB8fCAhMSA9PT0gdCA/IHQgOiBcIlwiKTsgfTsgcmV0dXJuIE9iamVjdC5rZXlzKG4pLmZvckVhY2goKGZ1bmN0aW9uIChlKSB7IEFycmF5LmlzQXJyYXkobltlXSkgPyBuW2VdLmZvckVhY2goKGZ1bmN0aW9uIChuKSB7IHQucHVzaChyKGUsIG4pKTsgfSkpIDogdC5wdXNoKHIoZSwgbltlXSkpOyB9KSksIHQuam9pbihcIiZcIik7IH0gfTsgfTtcbiAgICBwbi5jb250YWluZXIucmVnaXN0ZXIoXCJqcVV0aWxzXCIsIHsgdXNlVmFsdWU6IGRlKCkgfSksIHBuLmpxVXRpbHMgPSBwbi5jb250YWluZXIucmVzb2x2ZShcImpxVXRpbHNcIik7XG4gICAgdmFyIHBlID0gZnVuY3Rpb24gKCkgeyB2YXIgZSA9IHt9LCBuID0gL1xcKy9nLCB0ID0gZnVuY3Rpb24gKGUpIHsgdHJ5IHtcbiAgICAgICAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChlLnJlcGxhY2UobiwgXCIgXCIpKTtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHsgfSB9LCByID0gZnVuY3Rpb24gKGUpIHsgMCA9PT0gZS5pbmRleE9mKCdcIicpICYmIChlID0gZS5zbGljZSgxLCAtMSkucmVwbGFjZSgvXFxcXFwiL2csICdcIicpLnJlcGxhY2UoL1xcXFxcXFxcL2csIFwiXFxcXFwiKSksIGUgPSB0KGUpOyB0cnkge1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHsgfSB9LCBvID0gZnVuY3Rpb24gKG4sIG8sIGkpIHsgaWYgKHZvaWQgMCAhPT0gbykge1xuICAgICAgICBpZiAoXCJudW1iZXJcIiA9PSB0eXBlb2YgKGkgPSBPYmplY3QuYXNzaWduKHt9LCBlLCBpKSkuZXhwaXJlcykge1xuICAgICAgICAgICAgdmFyIGEgPSBpLmV4cGlyZXMsIHMgPSBpLmV4cGlyZXMgPSBuZXcgRGF0ZTtcbiAgICAgICAgICAgIHMuc2V0RGF0ZShzLmdldERhdGUoKSArIGEpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBvID0gU3RyaW5nKG8pLCBkb2N1bWVudC5jb29raWUgPSBbZW5jb2RlVVJJQ29tcG9uZW50KG4pLCBcIj1cIiwgZW5jb2RlVVJJQ29tcG9uZW50KG8pLCBpLmV4cGlyZXMgPyBcIjsgZXhwaXJlcz1cIiArIGkuZXhwaXJlcy50b1VUQ1N0cmluZygpIDogXCJcIiwgaS5wYXRoID8gXCI7IHBhdGg9XCIgKyBpLnBhdGggOiBcIlwiLCBpLmRvbWFpbiA/IFwiOyBkb21haW49XCIgKyBpLmRvbWFpbiA6IFwiXCIsIGkuc2VjdXJlID8gXCI7IHNlY3VyZVwiIDogXCJcIiwgaS5zYW1lc2l0ZSA/IFwiOyBzYW1lc2l0ZT1cIiArIGkuc2FtZXNpdGUgOiBcIlwiXS5qb2luKFwiXCIpO1xuICAgIH0gZm9yICh2YXIgYywgbCA9IGRvY3VtZW50LmNvb2tpZSA/IGRvY3VtZW50LmNvb2tpZS5zcGxpdChcIjsgXCIpIDogW10sIHUgPSAwLCBkID0gbC5sZW5ndGg7IHUgPCBkOyB1KyspIHtcbiAgICAgICAgdmFyIHAgPSBsW3VdLnNwbGl0KFwiPVwiKSwgZiA9IHQocC5zaGlmdCgpKSwgbSA9IHAuam9pbihcIj1cIik7XG4gICAgICAgIGlmIChuICYmIG4gPT09IGYpIHtcbiAgICAgICAgICAgIGMgPSByKG0pO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgbiB8fCB2b2lkIDAgPT09IChtID0gcihtKSkgfHwgKGNbZl0gPSBtKTtcbiAgICB9IHJldHVybiBjOyB9OyByZXR1cm4geyBuYW1lOiBcImNvb2tpZVwiLCBkZWZhdWx0czogZSwgcmF3OiAhMSwganNvbjogZmFsc2UsIHBsdXNlczogbiwgc2V0OiBmdW5jdGlvbiAoZSwgbiwgdCkgeyBvKGUsIG4sIHQpOyB9LCBnZXQ6IGZ1bmN0aW9uIChlKSB7IHJldHVybiBvKGUpOyB9LCByZW1vdmU6IGZ1bmN0aW9uIChlLCBuKSB7IHJldHVybiB2b2lkIDAgIT09IG8oZSkgJiYgKG8oZSwgXCJcIiwgT2JqZWN0LmFzc2lnbih7fSwgbiwgeyBleHBpcmVzOiAtMSB9KSksICEwKTsgfSB9OyB9KCk7XG4gICAgcG4uY29udGFpbmVyLnJlZ2lzdGVyKFwiY29va2llXCIsIHsgdXNlVmFsdWU6IHBlIH0pLCBwbi5jb29raWUgPSBwbi5jb250YWluZXIucmVzb2x2ZShcImNvb2tpZVwiKTtcbiAgICB2YXIgZmUgPSBmdW5jdGlvbiAoZSkgeyBmdW5jdGlvbiBuKGUpIHsgdmFyIG4sIHQsIHIsIG8gPSBhcmd1bWVudHMubGVuZ3RoLCBpID0gd2luZG93W2VdLCBhID0gYXJndW1lbnRzLCBzID0gYVsxXTsgaWYgKG8gPCAyKVxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJNaW5pbXVtIDIgYXJndW1lbnRzIG11c3QgYmUgZ2l2ZW5cIik7IGlmIChBcnJheS5pc0FycmF5KHMpKSB7XG4gICAgICAgIGZvciAodmFyIGMgaW4gdCA9IHt9LCBzKSB7XG4gICAgICAgICAgICBuID0gc1tjXTtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgdFtuXSA9IEpTT04ucGFyc2UoaS5nZXRJdGVtKG4pKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgdFtuXSA9IGkuZ2V0SXRlbShuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdDtcbiAgICB9IGlmICgyICE9IG8pIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHQgPSBKU09OLnBhcnNlKGkuZ2V0SXRlbShzKSk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcihzICsgXCIgaXMgbm90IGRlZmluZWQgaW4gdGhpcyBzdG9yYWdlXCIpO1xuICAgICAgICB9XG4gICAgICAgIGZvciAoYyA9IDI7IGMgPCBvIC0gMTsgYysrKVxuICAgICAgICAgICAgaWYgKHZvaWQgMCA9PT0gKHQgPSB0W2FbY11dKSlcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoW10uc2xpY2UuY2FsbChhLCAxLCBjICsgMSkuam9pbihcIi5cIikgKyBcIiBpcyBub3QgZGVmaW5lZCBpbiB0aGlzIHN0b3JhZ2VcIik7XG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KGFbY10pKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBsIGluIHIgPSB0LCB0ID0ge30sIGFbY10pXG4gICAgICAgICAgICAgICAgdFthW2NdW2xdXSA9IHJbYVtjXVtsXV07XG4gICAgICAgICAgICByZXR1cm4gdDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdFthW2NdXTtcbiAgICB9IHRyeSB7XG4gICAgICAgIHJldHVybiBKU09OLnBhcnNlKGkuZ2V0SXRlbShzKSk7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIHJldHVybiBpLmdldEl0ZW0ocyk7XG4gICAgfSB9IGZ1bmN0aW9uIHQobikgeyB2YXIgdCwgciwgbyA9IGFyZ3VtZW50cy5sZW5ndGgsIGkgPSB3aW5kb3dbbl0sIGEgPSBhcmd1bWVudHMsIHMgPSBhWzFdLCBjID0gYVsyXSwgbCA9IHt9OyBpZiAobyA8IDIgfHwgIWUuaXNQbGFpbk9iamVjdChzKSAmJiBvIDwgMylcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTWluaW11bSAzIGFyZ3VtZW50cyBtdXN0IGJlIGdpdmVuIG9yIHNlY29uZCBwYXJhbWV0ZXIgbXVzdCBiZSBhbiBvYmplY3RcIik7IGlmIChlLmlzUGxhaW5PYmplY3QocykpIHtcbiAgICAgICAgZm9yICh2YXIgdSBpbiBzKVxuICAgICAgICAgICAgdCA9IHNbdV0sIGUuaXNQbGFpbk9iamVjdCh0KSA/IGkuc2V0SXRlbSh1LCBKU09OLnN0cmluZ2lmeSh0KSkgOiBpLnNldEl0ZW0odSwgdCk7XG4gICAgICAgIHJldHVybiBzO1xuICAgIH0gaWYgKDMgPT0gbylcbiAgICAgICAgcmV0dXJuIFwib2JqZWN0XCIgPT0gdHlwZW9mIGMgPyBpLnNldEl0ZW0ocywgSlNPTi5zdHJpbmdpZnkoYykpIDogaS5zZXRJdGVtKHMsIGMpLCBjOyB0cnkge1xuICAgICAgICBudWxsICE9IChyID0gaS5nZXRJdGVtKHMpKSAmJiAobCA9IEpTT04ucGFyc2UocikpO1xuICAgIH1cbiAgICBjYXRjaCAoZSkgeyB9IHIgPSBsOyBmb3IgKHUgPSAyOyB1IDwgbyAtIDI7IHUrKylcbiAgICAgICAgclt0ID0gYVt1XV0gJiYgZS5pc1BsYWluT2JqZWN0KHJbdF0pIHx8IChyW3RdID0ge30pLCByID0gclt0XTsgcmV0dXJuIHJbYVt1XV0gPSBhW3UgKyAxXSwgaS5zZXRJdGVtKHMsIEpTT04uc3RyaW5naWZ5KGwpKSwgbDsgfSBmdW5jdGlvbiByKGUpIHsgdmFyIG4sIHQsIHIgPSBhcmd1bWVudHMubGVuZ3RoLCBvID0gd2luZG93W2VdLCBpID0gYXJndW1lbnRzLCBhID0gaVsxXTsgaWYgKHIgPCAyKVxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJNaW5pbXVtIDIgYXJndW1lbnRzIG11c3QgYmUgZ2l2ZW5cIik7IGlmIChBcnJheS5pc0FycmF5KGEpKSB7XG4gICAgICAgIGZvciAodmFyIHMgaW4gYSlcbiAgICAgICAgICAgIG8ucmVtb3ZlSXRlbShhW3NdKTtcbiAgICAgICAgcmV0dXJuICEwO1xuICAgIH0gaWYgKDIgPT0gcilcbiAgICAgICAgcmV0dXJuIG8ucmVtb3ZlSXRlbShhKSwgITA7IHRyeSB7XG4gICAgICAgIG4gPSB0ID0gSlNPTi5wYXJzZShvLmdldEl0ZW0oYSkpO1xuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgICB0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoYSArIFwiIGlzIG5vdCBkZWZpbmVkIGluIHRoaXMgc3RvcmFnZVwiKTtcbiAgICB9IGZvciAocyA9IDI7IHMgPCByIC0gMTsgcysrKVxuICAgICAgICBpZiAodm9pZCAwID09PSAodCA9IHRbaVtzXV0pKVxuICAgICAgICAgICAgdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKFtdLnNsaWNlLmNhbGwoaSwgMSwgcykuam9pbihcIi5cIikgKyBcIiBpcyBub3QgZGVmaW5lZCBpbiB0aGlzIHN0b3JhZ2VcIik7IGlmIChBcnJheS5pc0FycmF5KGlbc10pKVxuICAgICAgICBmb3IgKHZhciBjIGluIGlbc10pXG4gICAgICAgICAgICBkZWxldGUgdFtpW3NdW2NdXTtcbiAgICBlbHNlXG4gICAgICAgIGRlbGV0ZSB0W2lbc11dOyByZXR1cm4gby5zZXRJdGVtKGEsIEpTT04uc3RyaW5naWZ5KG4pKSwgITA7IH0gZnVuY3Rpb24gbyh0KSB7IHZhciByID0gYXJndW1lbnRzLmxlbmd0aCwgaSA9IGFyZ3VtZW50cywgcyA9IGlbMV07IGlmICgxID09IHIpXG4gICAgICAgIHJldHVybiAwID09IGEodCkubGVuZ3RoOyBpZiAoQXJyYXkuaXNBcnJheShzKSkge1xuICAgICAgICBmb3IgKHZhciBjID0gMDsgYyA8IHMubGVuZ3RoOyBjKyspXG4gICAgICAgICAgICBpZiAoIW8odCwgc1tjXSkpXG4gICAgICAgICAgICAgICAgcmV0dXJuICExO1xuICAgICAgICByZXR1cm4gITA7XG4gICAgfSB0cnkge1xuICAgICAgICB2YXIgbCA9IG4uYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgZm9yICh2YXIgYyBpbiBBcnJheS5pc0FycmF5KGlbciAtIDFdKSB8fCAobCA9IHsgdG90ZXN0OiBsIH0pLCBsKVxuICAgICAgICAgICAgaWYgKCEoZS5pc1BsYWluT2JqZWN0KGxbY10pICYmIGUuaXNFbXB0eU9iamVjdChsW2NdKSB8fCBBcnJheS5pc0FycmF5KGxbY10pICYmICFsW2NdLmxlbmd0aCkgJiYgbFtjXSlcbiAgICAgICAgICAgICAgICByZXR1cm4gITE7XG4gICAgICAgIHJldHVybiAhMDtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgcmV0dXJuICEwO1xuICAgIH0gfSBmdW5jdGlvbiBpKGUpIHsgdmFyIHQgPSBhcmd1bWVudHMubGVuZ3RoLCByID0gYXJndW1lbnRzLCBvID0gclsxXTsgaWYgKHQgPCAyKVxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJNaW5pbXVtIDIgYXJndW1lbnRzIG11c3QgYmUgZ2l2ZW5cIik7IGlmIChBcnJheS5pc0FycmF5KG8pKSB7XG4gICAgICAgIGZvciAodmFyIGEgPSAwOyBhIDwgby5sZW5ndGg7IGErKylcbiAgICAgICAgICAgIGlmICghaShlLCBvW2FdKSlcbiAgICAgICAgICAgICAgICByZXR1cm4gITE7XG4gICAgICAgIHJldHVybiAhMDtcbiAgICB9IHRyeSB7XG4gICAgICAgIHZhciBzID0gbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICBmb3IgKHZhciBhIGluIEFycmF5LmlzQXJyYXkoclt0IC0gMV0pIHx8IChzID0geyB0b3Rlc3Q6IHMgfSksIHMpXG4gICAgICAgICAgICBpZiAodm9pZCAwID09PSBzW2FdIHx8IG51bGwgPT09IHNbYV0pXG4gICAgICAgICAgICAgICAgcmV0dXJuICExO1xuICAgICAgICByZXR1cm4gITA7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIHJldHVybiAhMTtcbiAgICB9IH0gZnVuY3Rpb24gYSh0KSB7IHZhciByID0gYXJndW1lbnRzLmxlbmd0aCwgbyA9IHdpbmRvd1t0XSwgaSA9IGFyZ3VtZW50cywgYSA9IFtdLCBzID0ge307IGlmICgocyA9IHIgPiAxID8gbi5hcHBseSh0aGlzLCBpKSA6IG8pLl9jb29raWUpXG4gICAgICAgIGZvciAodmFyIGMgaW4gZS5jb29raWUoKSlcbiAgICAgICAgICAgIFwiXCIgIT0gYyAmJiBhLnB1c2goYy5yZXBsYWNlKHMuX3ByZWZpeCwgXCJcIikpO1xuICAgIGVsc2VcbiAgICAgICAgZm9yICh2YXIgbCBpbiBzKVxuICAgICAgICAgICAgYS5wdXNoKGwpOyByZXR1cm4gYTsgfSBmdW5jdGlvbiBzKG4pIHsgaWYgKCFuIHx8IFwic3RyaW5nXCIgIT0gdHlwZW9mIG4pXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkZpcnN0IHBhcmFtZXRlciBtdXN0IGJlIGEgc3RyaW5nXCIpOyBjID8gKHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbShuKSB8fCB3aW5kb3cubG9jYWxTdG9yYWdlLnNldEl0ZW0obiwgXCJ7fVwiKSwgd2luZG93LnNlc3Npb25TdG9yYWdlLmdldEl0ZW0obikgfHwgd2luZG93LnNlc3Npb25TdG9yYWdlLnNldEl0ZW0obiwgXCJ7fVwiKSkgOiAod2luZG93LmxvY2FsQ29va2llU3RvcmFnZS5nZXRJdGVtKG4pIHx8IHdpbmRvdy5sb2NhbENvb2tpZVN0b3JhZ2Uuc2V0SXRlbShuLCBcInt9XCIpLCB3aW5kb3cuc2Vzc2lvbkNvb2tpZVN0b3JhZ2UuZ2V0SXRlbShuKSB8fCB3aW5kb3cuc2Vzc2lvbkNvb2tpZVN0b3JhZ2Uuc2V0SXRlbShuLCBcInt9XCIpKTsgdmFyIHQgPSB7IGxvY2FsU3RvcmFnZTogT2JqZWN0LmFzc2lnbih7fSwgZS5sb2NhbFN0b3JhZ2UsIHsgX25zOiBuIH0pLCBzZXNzaW9uU3RvcmFnZTogT2JqZWN0LmFzc2lnbih7fSwgZS5zZXNzaW9uU3RvcmFnZSwgeyBfbnM6IG4gfSkgfTsgcmV0dXJuIGUuY29va2llICYmICh3aW5kb3cuY29va2llU3RvcmFnZS5nZXRJdGVtKG4pIHx8IHdpbmRvdy5jb29raWVTdG9yYWdlLnNldEl0ZW0obiwgXCJ7fVwiKSwgdC5jb29raWVTdG9yYWdlID0gT2JqZWN0LmFzc2lnbih7fSwgZS5jb29raWVTdG9yYWdlLCB7IF9uczogbiB9KSksIGUubmFtZXNwYWNlU3RvcmFnZXNbbl0gPSB0LCB0OyB9IHZhciBjID0gZnVuY3Rpb24gKGUpIHsgdmFyIG4gPSBcImpzYXBpXCI7IHRyeSB7XG4gICAgICAgIHJldHVybiAhIXdpbmRvd1tlXSAmJiAod2luZG93W2VdLnNldEl0ZW0obiwgbiksIHdpbmRvd1tlXS5yZW1vdmVJdGVtKG4pLCAhMCk7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIHJldHVybiAhMTtcbiAgICB9IH0oXCJsb2NhbFN0b3JhZ2VcIiksIGwgPSB7IF90eXBlOiBcIlwiLCBfbnM6IFwiXCIsIF9jYWxsTWV0aG9kOiBmdW5jdGlvbiAoZSwgbikgeyB2YXIgdCA9IFt0aGlzLl90eXBlXSwgciA9IChuID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwobikpWzBdOyByZXR1cm4gdGhpcy5fbnMgJiYgdC5wdXNoKHRoaXMuX25zKSwgXCJzdHJpbmdcIiA9PSB0eXBlb2YgciAmJiAtMSAhPT0gci5pbmRleE9mKFwiLlwiKSAmJiAobi5zaGlmdCgpLCBbXS51bnNoaWZ0LmFwcGx5KG4sIHIuc3BsaXQoXCIuXCIpKSksIFtdLnB1c2guYXBwbHkodCwgbiksIGUuYXBwbHkodGhpcywgdCk7IH0sIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5fY2FsbE1ldGhvZChuLCBhcmd1bWVudHMpOyB9LCBzZXQ6IGZ1bmN0aW9uICgpIHsgdmFyIG4gPSBhcmd1bWVudHMubGVuZ3RoLCByID0gYXJndW1lbnRzLCBvID0gclswXTsgaWYgKG4gPCAxIHx8ICFlLmlzUGxhaW5PYmplY3QobykgJiYgbiA8IDIpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJNaW5pbXVtIDIgYXJndW1lbnRzIG11c3QgYmUgZ2l2ZW4gb3IgZmlyc3QgcGFyYW1ldGVyIG11c3QgYmUgYW4gb2JqZWN0XCIpOyBpZiAoZS5pc1BsYWluT2JqZWN0KG8pICYmIHRoaXMuX25zKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBpIGluIG8pXG4gICAgICAgICAgICAgICAgdCh0aGlzLl90eXBlLCB0aGlzLl9ucywgaSwgb1tpXSk7XG4gICAgICAgICAgICByZXR1cm4gbztcbiAgICAgICAgfSB2YXIgYSA9IHRoaXMuX2NhbGxNZXRob2QodCwgcik7IHJldHVybiB0aGlzLl9ucyA/IGFbby5zcGxpdChcIi5cIilbMF1dIDogYTsgfSwgcmVtb3ZlOiBmdW5jdGlvbiAoKSB7IGlmIChhcmd1bWVudHMubGVuZ3RoIDwgMSlcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIk1pbmltdW0gMSBhcmd1bWVudCBtdXN0IGJlIGdpdmVuXCIpOyByZXR1cm4gdGhpcy5fY2FsbE1ldGhvZChyLCBhcmd1bWVudHMpOyB9LCByZW1vdmVBbGw6IGZ1bmN0aW9uIChuKSB7IHJldHVybiB0aGlzLl9ucyA/ICh0KHRoaXMuX3R5cGUsIHRoaXMuX25zLCB7fSksICEwKSA6IGZ1bmN0aW9uIChuLCB0KSB7IHZhciBvID0gYShuKTsgZm9yICh2YXIgaSBpbiBvKVxuICAgICAgICAgICAgcihuLCBvW2ldKTsgaWYgKHQpXG4gICAgICAgICAgICBmb3IgKHZhciBpIGluIGUubmFtZXNwYWNlU3RvcmFnZXMpXG4gICAgICAgICAgICAgICAgcyhpKTsgfSh0aGlzLl90eXBlLCBuKTsgfSwgaXNFbXB0eTogZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5fY2FsbE1ldGhvZChvLCBhcmd1bWVudHMpOyB9LCBpc1NldDogZnVuY3Rpb24gKCkgeyBpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDEpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJNaW5pbXVtIDEgYXJndW1lbnQgbXVzdCBiZSBnaXZlblwiKTsgcmV0dXJuIHRoaXMuX2NhbGxNZXRob2QoaSwgYXJndW1lbnRzKTsgfSwga2V5czogZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5fY2FsbE1ldGhvZChhLCBhcmd1bWVudHMpOyB9IH07IGUuY29va2llICYmICh3aW5kb3cubmFtZSB8fCAod2luZG93Lm5hbWUgPSBNYXRoLmZsb29yKDFlOCAqIE1hdGgucmFuZG9tKCkpKSksIGUuaW5pdE5hbWVzcGFjZVN0b3JhZ2UgPSBmdW5jdGlvbiAoZSkgeyByZXR1cm4gcyhlKTsgfSwgYyA/IChlLmxvY2FsU3RvcmFnZSA9IE9iamVjdC5hc3NpZ24oe30sIGwsIHsgX3R5cGU6IFwibG9jYWxTdG9yYWdlXCIgfSksIGUuc2Vzc2lvblN0b3JhZ2UgPSBPYmplY3QuYXNzaWduKHt9LCBsLCB7IF90eXBlOiBcInNlc3Npb25TdG9yYWdlXCIgfSkpIDogKGUubG9jYWxTdG9yYWdlID0gT2JqZWN0LmFzc2lnbih7fSwgbCwgeyBfdHlwZTogXCJsb2NhbENvb2tpZVN0b3JhZ2VcIiB9KSwgZS5zZXNzaW9uU3RvcmFnZSA9IE9iamVjdC5hc3NpZ24oe30sIGwsIHsgX3R5cGU6IFwic2Vzc2lvbkNvb2tpZVN0b3JhZ2VcIiB9KSksIGUubmFtZXNwYWNlU3RvcmFnZXMgPSB7fSwgZS5yZW1vdmVBbGxTdG9yYWdlcyA9IGZ1bmN0aW9uIChuKSB7IGUubG9jYWxTdG9yYWdlLnJlbW92ZUFsbChuKSwgZS5zZXNzaW9uU3RvcmFnZS5yZW1vdmVBbGwobiksIGUuY29va2llU3RvcmFnZSAmJiBlLmNvb2tpZVN0b3JhZ2UucmVtb3ZlQWxsKG4pLCBuIHx8IChlLm5hbWVzcGFjZVN0b3JhZ2VzID0ge30pOyB9OyB9LCBtZSA9IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSBwbi5jb250YWluZXIucmVzb2x2ZShcImNvb2tpZVwiKSwgbiA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwianFVdGlsc1wiKSwgdCA9IHsgY29va2llOiBlLnNldCwgaXNQbGFpbk9iamVjdDogbi5pc1BsYWluT2JqZWN0LCBpc0VtcHR5T2JqZWN0OiBuLmlzRW1wdHlPYmplY3QgfTsgZmUodCk7IHJldHVybiB7IGdldDogZnVuY3Rpb24gKGUpIHsgaWYgKHdpbmRvdy5sb2NhbFN0b3JhZ2UgJiYgXCJmdW5jdGlvblwiID09IHR5cGVvZiB3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0pXG4gICAgICAgICAgICByZXR1cm4gdC5sb2NhbFN0b3JhZ2UuZ2V0KGUpOyB9LCBzZXQ6IGZ1bmN0aW9uIChlLCBuKSB7IHdpbmRvdy5sb2NhbFN0b3JhZ2UgJiYgXCJmdW5jdGlvblwiID09IHR5cGVvZiB3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0gJiYgdC5sb2NhbFN0b3JhZ2Uuc2V0KGUsIG4pOyB9LCByZW1vdmU6IGZ1bmN0aW9uIChlKSB7IHdpbmRvdy5sb2NhbFN0b3JhZ2UgJiYgXCJmdW5jdGlvblwiID09IHR5cGVvZiB3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0gJiYgdC5sb2NhbFN0b3JhZ2UucmVtb3ZlKGUpOyB9IH07IH0oKTtcbiAgICBwbi5jb250YWluZXIucmVnaXN0ZXIoXCJsb2NhbFN0b3JhZ2VcIiwgeyB1c2VWYWx1ZTogbWUgfSksIHBuLmxvY2FsU3RvcmFnZSA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwibG9jYWxTdG9yYWdlXCIpO1xuICAgIHZhciBnZSwgdmUgPSAoZ2UgPSBmdW5jdGlvbiAoKSB7IHJldHVybiBcIjE0LjE0Mi4xLCBzZXJ2ZXItdjE0LjE0Mi4xLVRTLWVkaXRpb25cIjsgfSwgd2luZG93Ll9fdHBWZXJzaW9uID0gXCIxNC4xNDIuMSwgc2VydmVyLXYxNC4xNDIuMS1UUy1lZGl0aW9uXCIsIHsgbmFtZTogXCJ2ZXJzaW9uU2VydmljZVwiLCBnZXRUaW55cGFzc1ZlcnNpb246IGdlIH0pO1xuICAgIHBuLmNvbnRhaW5lci5yZWdpc3RlcihcInZlcnNpb25TZXJ2aWNlXCIsIHsgdXNlVmFsdWU6IHZlIH0pLCBwbi52ZXJzaW9uU2VydmljZSA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwidmVyc2lvblNlcnZpY2VcIik7XG4gICAgdmFyIGhlID0gZnVuY3Rpb24gKCkgeyB2YXIgZSwgbiA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwiYWpheFwiKSwgdCA9IHt9OyByZXR1cm4geyBuYW1lOiBcIml0cFwiLCBzeW5jaHJvbml6ZUNvb2tpZTogZnVuY3Rpb24gKHIsIG8sIGkpIHsgaWYgKHBuLmNsb3VkZmxhcmVXb3JrZXJVcmwpIHtcbiAgICAgICAgICAgICFmdW5jdGlvbiAoZSwgbiwgcikgeyBpZiAodFtlXSA9IHsgdmFsdWU6IG4gfSwgIXIpXG4gICAgICAgICAgICAgICAgcmV0dXJuOyByIGluc3RhbmNlb2YgRGF0ZSA/IHRbZV0uZXhwaXJlcyA9IHIgOiB0W2VdLm1heEFnZSA9IDM2MDAgKiByOyB9KHIsIG8sIGkpLCBlICYmIGNsZWFyVGltZW91dChlKSwgZSA9IHNldFRpbWVvdXQoKGZ1bmN0aW9uICgpIHsgbi5yZXF1ZXN0KHsgdXJsOiBwbi5jbG91ZGZsYXJlV29ya2VyVXJsICsgXCI/bWF4QWdlPTI2MjgwMDBcIiwgdHlwZTogXCJQT1NUXCIsIGRhdGE6IEpTT04uc3RyaW5naWZ5KHQpLCBjcm9zc0RvbWFpbjogITAsIHhockZpZWxkczogeyB3aXRoQ3JlZGVudGlhbHM6ICEwIH0sIGVycm9yOiBmdW5jdGlvbiAoZSwgbikgeyBjb25zb2xlLmVycm9yKG4pOyB9IH0pLCB0ID0ge307IH0pLCAyNTAwKTtcbiAgICAgICAgfSB9IH07IH0oKTtcbiAgICBwbi5jb250YWluZXIucmVnaXN0ZXIoXCJpdHBcIiwgeyB1c2VWYWx1ZTogaGUgfSksIHBuLml0cCA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwiaXRwXCIpO1xuICAgIHZhciB3ZSA9IGZ1bmN0aW9uIChlLCBuKSB7IHJldHVybiB3ZSA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCB7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChlLCBuKSB7IGUuX19wcm90b19fID0gbjsgfSB8fCBmdW5jdGlvbiAoZSwgbikgeyBmb3IgKHZhciB0IGluIG4pXG4gICAgICAgIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChuLCB0KSAmJiAoZVt0XSA9IG5bdF0pOyB9LCB3ZShlLCBuKTsgfTtcbiAgICB2YXIgeWUgPSBmdW5jdGlvbiAoKSB7IHJldHVybiB5ZSA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24gKGUpIHsgZm9yICh2YXIgbiwgdCA9IDEsIHIgPSBhcmd1bWVudHMubGVuZ3RoOyB0IDwgcjsgdCsrKVxuICAgICAgICBmb3IgKHZhciBvIGluIG4gPSBhcmd1bWVudHNbdF0pXG4gICAgICAgICAgICBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobiwgbykgJiYgKGVbb10gPSBuW29dKTsgcmV0dXJuIGU7IH0sIHllLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7IH07XG4gICAgZnVuY3Rpb24gYmUoZSwgbikgeyByZXR1cm4gZnVuY3Rpb24gKHQsIHIpIHsgbih0LCByLCBlKTsgfTsgfVxuICAgIGZ1bmN0aW9uIGtlKGUsIG4pIHsgaWYgKFwib2JqZWN0XCIgPT0gdHlwZW9mIFJlZmxlY3QgJiYgXCJmdW5jdGlvblwiID09IHR5cGVvZiBSZWZsZWN0Lm1ldGFkYXRhKVxuICAgICAgICByZXR1cm4gUmVmbGVjdC5tZXRhZGF0YShlLCBuKTsgfVxuICAgIGZ1bmN0aW9uIF9lKGUsIG4sIHQpIHsgaWYgKHQgfHwgMiA9PT0gYXJndW1lbnRzLmxlbmd0aClcbiAgICAgICAgZm9yICh2YXIgciwgbyA9IDAsIGkgPSBuLmxlbmd0aDsgbyA8IGk7IG8rKylcbiAgICAgICAgICAgICFyICYmIG8gaW4gbiB8fCAociB8fCAociA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKG4sIDAsIG8pKSwgcltvXSA9IG5bb10pOyByZXR1cm4gZS5jb25jYXQociB8fCBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChuKSk7IH1cbiAgICB2YXIgQ2UgPSBmdW5jdGlvbiAoZSkgeyB2b2lkIDAgPT09IGUgJiYgKGUgPSBwbi5jb250YWluZXIpOyB2YXIgbiwgdCA9IGUucmVzb2x2ZShcImpxVXRpbHNcIiksIHIgPSBlLnJlc29sdmUoXCJjb29raWVcIiksIG8gPSBlLnJlc29sdmUoXCJ2ZXJzaW9uU2VydmljZVwiKSwgaSA9IGUucmVzb2x2ZShcIml0cFwiKSwgYSA9IGUucmVzb2x2ZShcImxvY2FsU3RvcmFnZVwiKSwgcyA9IFwiXCIsIGMgPSB7IEVOQUJMRURfQUZURVJfRElTQUJMRUQ6IC0yLCBOT1RfREVURUNURUQ6IC0xLCBESVNBQkxFRDogMCwgRU5BQkxFRDogMSB9OyB2b2lkIDAgPT09IFwidGVzdFN0cmluZ1wiLnRvSGV4ICYmIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShTdHJpbmcucHJvdG90eXBlLCBcInRvSGV4XCIsIHsgZW51bWVyYWJsZTogITEsIHZhbHVlOiBmdW5jdGlvbiAoKSB7IGZvciAodmFyIGUgPSBcIlwiLCBuID0gMDsgbiA8IHRoaXMubGVuZ3RoOyArK24pXG4gICAgICAgICAgICBlICs9IFwiXCIgKyB0aGlzLmNoYXJDb2RlQXQobikudG9TdHJpbmcoMTYpOyByZXR1cm4gZTsgfSB9KTsgdmFyIGwgPSBmdW5jdGlvbiAoZSwgbiwgdCkgeyB2YXIgbyA9IHsgcGF0aDogXCIvXCIsIGV4cGlyZXM6IDAgfTsgdm9pZCAwICE9PSBuICYmIChvLmRvbWFpbiA9IG4pLCB2b2lkIDAgIT09IHQgJiYgKG8ucGF0aCA9IHQpLCByLnJlbW92ZShlLCBvKTsgfSwgdSA9IGZ1bmN0aW9uIChlLCBuLCB0KSB7IC0xICE9PSBuLmluZGV4T2YoXCJhYnJpbC5jb20uYnJcIikgJiYgbChlLCBcIi5hYnJpbC5jb20uYnJcIiwgdCksIC0xICE9PSBuLmluZGV4T2YoXCJzY290c21hbi5jb21cIikgJiYgbChlLCBcIi5zY290c21hbi5jb21cIiwgdCk7IH0sIGQgPSBmdW5jdGlvbiAoZSkgeyB2YXIgbjsgaWYgKDAgPT09IGRvY3VtZW50LmNvb2tpZS5sZW5ndGgpXG4gICAgICAgIHJldHVybiBudWxsOyBpZiAoZSBpbnN0YW5jZW9mIFJlZ0V4cClcbiAgICAgICAgZm9yICh2YXIgdCA9IGRvY3VtZW50LmNvb2tpZS5zcGxpdChcIjtcIiksIHIgPSAwOyByIDwgdC5sZW5ndGg7IHIrKykge1xuICAgICAgICAgICAgdmFyIG8gPSB0W3JdLmluZGV4T2YoXCI9XCIpO1xuICAgICAgICAgICAgaWYgKC0xICE9PSBvKSB7XG4gICAgICAgICAgICAgICAgdmFyIGksIGEgPSB0W3JdLnN1YnN0cigwLCBvKS50cmltKCk7XG4gICAgICAgICAgICAgICAgaWYgKGUudGVzdChhKSkge1xuICAgICAgICAgICAgICAgICAgICBpID0gdFtyXS5zdWJzdHIobyArIDEpLnRyaW0oKTtcbiAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQoaSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY2F0Y2ggKG4pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGYoJ0NvdWxkIG5vdCB1cmktZGVjb2RlIGNvb2tpZSBcIicgKyBlLnRvU3RyaW5nKCkgKyAnXCInLCBuKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgdmFyIHMgPSAoXCI7IFwiICsgZG9jdW1lbnQuY29va2llKS5zcGxpdChcIjsgXCIgKyBlICsgXCI9XCIpO1xuICAgICAgICBpZiAocy5sZW5ndGggPj0gMikge1xuICAgICAgICAgICAgdmFyIGMgPSBudWxsID09PSAobiA9IHMucG9wKCkpIHx8IHZvaWQgMCA9PT0gbiA/IHZvaWQgMCA6IG4uc3BsaXQoXCI7XCIpLnNoaWZ0KCk7XG4gICAgICAgICAgICBpZiAodm9pZCAwID09PSBjKVxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KGMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKG4pIHtcbiAgICAgICAgICAgICAgICBmKCdDb3VsZCBub3QgdXJpLWRlY29kZSBjb29raWUgXCInICsgZSArICdcIicsIG4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGM7XG4gICAgICAgIH1cbiAgICB9IHJldHVybiBudWxsOyB9LCBwID0gZnVuY3Rpb24gKGUpIHsgaWYgKDAgPT09IGRvY3VtZW50LmNvb2tpZS5sZW5ndGgpXG4gICAgICAgIHJldHVybiBbXTsgZm9yICh2YXIgbiA9IFtdLCB0ID0gZG9jdW1lbnQuY29va2llLnNwbGl0KFwiO1wiKSwgciA9IDA7IHIgPCB0Lmxlbmd0aDsgcisrKSB7XG4gICAgICAgIHZhciBvID0gdFtyXS5pbmRleE9mKFwiPVwiKTtcbiAgICAgICAgaWYgKC0xICE9PSBvKSB7XG4gICAgICAgICAgICB2YXIgaSwgYSA9IHRbcl0uc3Vic3RyKDAsIG8pLnRyaW0oKTtcbiAgICAgICAgICAgIGlmIChlIGluc3RhbmNlb2YgUmVnRXhwICYmIGUudGVzdChhKSkge1xuICAgICAgICAgICAgICAgIGkgPSB0W3JdLnN1YnN0cihvICsgMSkucmVwbGFjZSgvXlxccyt8XFxzKyQvZywgXCJcIik7XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgaSA9IGRlY29kZVVSSUNvbXBvbmVudChpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2F0Y2ggKG4pIHtcbiAgICAgICAgICAgICAgICAgICAgZignQ291bGQgbm90IHVyaS1kZWNvZGUgY29va2llIFwiJyArIGUudG9TdHJpbmcoKSArICdcIicsIG4pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBuLnB1c2goeyBuYW1lOiBhLCB2YWx1ZTogaSB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGEgPT09IGUpIHtcbiAgICAgICAgICAgICAgICBpID0gdFtyXS5zdWJzdHIobyArIDEpLnJlcGxhY2UoL15cXHMrfFxccyskL2csIFwiXCIpO1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIGkgPSBkZWNvZGVVUklDb21wb25lbnQoaSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhdGNoIChuKSB7XG4gICAgICAgICAgICAgICAgICAgIGYoJ0NvdWxkIG5vdCB1cmktZGVjb2RlIGNvb2tpZSBcIicgKyBlICsgJ1wiJywgbik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIG4ucHVzaCh7IG5hbWU6IGEsIHZhbHVlOiBpIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSByZXR1cm4gbjsgfTsgZnVuY3Rpb24gZigpIHsgZm9yICh2YXIgZSA9IFtdLCBuID0gMDsgbiA8IGFyZ3VtZW50cy5sZW5ndGg7IG4rKylcbiAgICAgICAgZVtuXSA9IGFyZ3VtZW50c1tuXTsgITAgPT09IHBuLmRlYnVnICYmIG0uYXBwbHkodm9pZCAwLCBlKTsgfSBmdW5jdGlvbiBtKCkgeyBmb3IgKHZhciBlID0gW10sIG4gPSAwOyBuIDwgYXJndW1lbnRzLmxlbmd0aDsgbisrKVxuICAgICAgICBlW25dID0gYXJndW1lbnRzW25dOyBpZiAod2luZG93LmNvbnNvbGUgJiYgd2luZG93LmNvbnNvbGUubG9nICYmIHdpbmRvdy5jb25zb2xlLmxvZy5hcHBseSAmJiB3aW5kb3cuY29uc29sZS5sb2cuYXBwbHkuY2FsbCAmJiB2b2lkIDAgIT09IHdpbmRvdy5jb25zb2xlICYmIHZvaWQgMCAhPT0gd2luZG93LmNvbnNvbGUubG9nKSB7XG4gICAgICAgIHZhciB0ID0gW1wiVFA6XCJdO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgZm9yICh2YXIgciA9IDA7IHIgPCBlLmxlbmd0aDsgcisrKVxuICAgICAgICAgICAgICAgIHQucHVzaChlW3JdKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAobikge1xuICAgICAgICAgICAgdCA9IGU7XG4gICAgICAgIH1cbiAgICAgICAgRygpICYmICh0ID0gdih0KSksIFwib2JqZWN0XCIgPT0gdHlwZW9mIHdpbmRvdy5jb25zb2xlLmxvZyA/IHdpbmRvdy5jb25zb2xlLmxvZy5hcHBseS5jYWxsKHRoaXMsIGNvbnNvbGUsIHQpIDogY29uc29sZS5sb2cuYXBwbHkoY29uc29sZSwgdCk7XG4gICAgfSB9IHZhciBnID0gZnVuY3Rpb24gKCkgeyB2YXIgZSA9IDA7IHJldHVybiB3aW5kb3cucGFnZVlPZmZzZXQgPyBlID0gd2luZG93LnBhZ2VZT2Zmc2V0IDogZSA9IFwibnVtYmVyXCIgPT0gdHlwZW9mIChlID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50IHx8IGRvY3VtZW50LmJvZHkucGFyZW50Tm9kZSkuc2Nyb2xsVG9wID8gZS5zY3JvbGxUb3AgOiBkb2N1bWVudC5ib2R5LnNjcm9sbFRvcCwgZTsgfSwgdiA9IGZ1bmN0aW9uIChlKSB7IHZhciBuID0gXCJcIjsgdHJ5IHtcbiAgICAgICAgZm9yICh2YXIgdCA9IDA7IHQgPCBlLmxlbmd0aDsgdCsrKVxuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBuICs9IEpTT04uc3RyaW5naWZ5KGVbdF0pICsgXCIsIFwiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICBuICs9IFwiXCIgKyBlO1xuICAgICAgICAgICAgfVxuICAgICAgICByZXR1cm4gW25dO1xuICAgIH1cbiAgICBjYXRjaCAobikge1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9IH0sIGggPSBmdW5jdGlvbiAoKSB7IHZhciBlLCBuOyByZXR1cm4gXCJDU1MxQ29tcGF0XCIgPT09IGRvY3VtZW50LmNvbXBhdE1vZGUgPyAoZSA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCwgbiA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQpIDogKGUgPSBkb2N1bWVudC5ib2R5LmNsaWVudFdpZHRoLCBuID0gZG9jdW1lbnQuYm9keS5jbGllbnRIZWlnaHQpLCB7IHg6IGUsIHk6IG4gfTsgfSwgdyA9IGZ1bmN0aW9uIChlKSB7IGUgPSBlLnJlcGxhY2UoL1tcXFtdLywgXCJcXFxcW1wiKS5yZXBsYWNlKC9bXFxdXS8sIFwiXFxcXF1cIik7IHZhciBuID0gbmV3IFJlZ0V4cChcIltcXFxcPyZdXCIgKyBlICsgXCI9KFteJiNdKilcIikuZXhlYyhsb2NhdGlvbi5zZWFyY2gpOyByZXR1cm4gbnVsbCA9PT0gbiA/IFwiXCIgOiBkZWNvZGVVUklDb21wb25lbnQoblsxXS5yZXBsYWNlKC9cXCsvZywgXCIgXCIpKTsgfSwgeSA9IGZ1bmN0aW9uIChlKSB7IHZhciBuID0gZShsb2NhdGlvbi5ocmVmKTsgaWYgKGhpc3RvcnkgJiYgXCJmdW5jdGlvblwiID09IHR5cGVvZiBoaXN0b3J5LnJlcGxhY2VTdGF0ZSkge1xuICAgICAgICB2YXIgdCA9IFwib2JqZWN0XCIgPT0gdHlwZW9mIHdpbmRvdy5uZXh0ICYmIFwib2JqZWN0XCIgPT0gdHlwZW9mIHdpbmRvdy5uZXh0LnJvdXRlciA/IHsgdXJsOiBlKGhpc3Rvcnkuc3RhdGUudXJsIHx8IFwiXCIpLCBhczogZShoaXN0b3J5LnN0YXRlLmFzIHx8IFwiXCIpLCBvcHRpb25zOiBoaXN0b3J5LnN0YXRlLm9wdGlvbnMgfSA6IGhpc3Rvcnkuc3RhdGU7XG4gICAgICAgIGhpc3RvcnkucmVwbGFjZVN0YXRlKHQsIGRvY3VtZW50LnRpdGxlLCBuKTtcbiAgICB9XG4gICAgZWxzZVxuICAgICAgICBsb2NhdGlvbi5ocmVmID0gbjsgfSwgYiA9IGZ1bmN0aW9uIChlLCBuLCB0KSB7IHZhciByID0geWUoeyBwYXRoOiBcIi9cIiwgZXhwaXJlczogNzMwIH0sIHQgJiYgeyBkb21haW46IHQgfSksIG8gPSBTKCk7IGZvciAodmFyIGkgaW4gbylcbiAgICAgICAgbChlLCBvW2ldKTsgci5kb21haW4gJiYgdShlLCByLmRvbWFpbiksIChwbi5jb29raWVEb21haW4gfHwgcG4uY29va2llUGF0aCkgJiYgKHIuZG9tYWluID0gcG4uY29va2llRG9tYWluID8gcG4uY29va2llRG9tYWluIDogci5kb21haW4sIGwoZSwgci5kb21haW4sIHIucGF0aCksIHIucGF0aCA9IHBuLmNvb2tpZVBhdGggPyBwbi5jb29raWVQYXRoIDogci5wYXRoLCBsKGUsIHIuZG9tYWluLCByLnBhdGgpKSwgbChlKSwgcShlLCBuLCByKTsgfSwgayA9IGZ1bmN0aW9uICgpIHsgdmFyIGUsIG4sIHQgPSBcImdldF90b3BfbGV2ZWxfZG9tYWluX2Nvb2tpZVwiLCByID0gZG9jdW1lbnQubG9jYXRpb24uaG9zdG5hbWUuc3BsaXQoXCIuXCIpOyBmb3IgKGUgPSByLmxlbmd0aCAtIDE7IGUgPj0gMDsgZS0tKSB7XG4gICAgICAgIHZhciBvID0geyBwYXRoOiBcIi9cIiwgZG9tYWluOiBuID0gXCIuXCIgKyByLnNsaWNlKGUpLmpvaW4oXCIuXCIpIH07XG4gICAgICAgIGlmIChxKHQsIG4sIG8pLCBWKHQpKVxuICAgICAgICAgICAgcmV0dXJuIG8uZXhwaXJlcyA9IG5ldyBEYXRlKDEpLCBxKHQsIG4sIG8pLCBuO1xuICAgIH0gfSwgXyA9IGZ1bmN0aW9uIChlKSB7IHJldHVybiBwbi51c2VBaWRTcGVjaWZpZWRDb29raWVzICYmIHBuLmFpZCA/IGUgKyBcIl9cIiArIHBuLmFpZCA6IGU7IH0sIEMgPSBmdW5jdGlvbiAoKSB7IHZhciBlLCBuID0gXyhcIl9fcGxzXCIpLCB0ID0gZChuKTsgaWYgKHQpXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBpZiAoKGUgPSBKU09OLnBhcnNlKHQpKSAmJiAhQXJyYXkuaXNBcnJheShlKSlcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJQdXNoIGxpc3Qgc3Vic2NyaXB0aW9ucyBtdXN0IGJlIGFuIGFycmF5XCIpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICBmKFwiQ2FuJ3QgZ2V0IHB1c2ggbGlzdCBzdWJzY3JpcHRpb25zXCIsIGUpO1xuICAgICAgICB9IHJldHVybiBlOyB9LCBJID0gZnVuY3Rpb24gKGUpIHsgbiA9IGU7IHZhciB0ID0gaygpOyBxKFwiX19wYXRcIiwgbiwgeyBwYXRoOiBcIi9cIiwgZXhwaXJlczogMzAsIGRvbWFpbjogdCB9KTsgfSwgUyA9IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSBbXTsgZS5wdXNoKGRvY3VtZW50LmRvbWFpbik7IGZvciAodmFyIG4gPSBkb2N1bWVudC5kb21haW4uc3BsaXQoXCIuXCIpOyBuLmxlbmd0aCA+PSAyOylcbiAgICAgICAgZS5wdXNoKFwiLlwiICsgbi5qb2luKFwiLlwiKSksIG4uc2hpZnQoKTsgcmV0dXJuIGU7IH0sIHggPSBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IFYoZSk7IHJldHVybiBcImJvb2xlYW5cIiA9PT0gdC50eXBlKG4pIHx8IFwic3RyaW5nXCIgPT09IHQudHlwZShuKSAmJiBuLmxlbmd0aCA/ICEwID09PSBuIHx8IFwidHJ1ZVwiID09PSBuID8gYy5FTkFCTEVEIDogYy5ESVNBQkxFRCA6IGMuTk9UX0RFVEVDVEVEOyB9LCBQID0gZnVuY3Rpb24gKCkgeyB2YXIgZSA9IFYoXCJfX3BuYWhjXCIpLCBuID0gITE7IHJldHVybiB2b2lkIDAgPT09IGUgJiYgKGUgPSBcIjBcIiwgbiA9ICEwKSwgeyBjb29raWVWYWx1ZTogcGFyc2VJbnQoZSwgMTApLCBpc0ZpcnN0OiBuIH07IH0sIEUgPSB7fSwgVCA9IGZ1bmN0aW9uIChlKSB7IEVbZV0gPyBFW2VdLmNvdW50ZXIrKyA6IEVbZV0gPSB7IGNvdW50ZXI6IDEsIHdhaXRlcnM6IFtdIH07IH0sIEEgPSBmdW5jdGlvbiAoZSwgbikgeyBpZiAoRVtlXSAmJiAoRVtlXS5jb3VudGVyLS0sIEVbZV0uY291bnRlciA8PSAwKSkge1xuICAgICAgICB2YXIgdCA9IFtdO1xuICAgICAgICBFW2VdLndhaXRlcnMuZm9yRWFjaCgoZnVuY3Rpb24gKGUpIHsgdC5wdXNoKGUpOyB9KSksIGRlbGV0ZSBFW2VdLCB0LmZvckVhY2goKGZ1bmN0aW9uIChlKSB7IGUodm9pZCAwICE9PSBuID8gbiA6IHt9KTsgfSkpO1xuICAgIH0gfSwgTSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIG5hdmlnYXRvci51c2VyQWdlbnQgfHwgbmF2aWdhdG9yLnZlbmRvciB8fCB3aW5kb3cub3BlcmE7IH0sIE8gPSBmdW5jdGlvbiAoKSB7IHJldHVybiBvLmdldFRpbnlwYXNzVmVyc2lvbigpLmluZGV4T2YoXCJTTkFQU0hPVFwiKSA+PSAwOyB9LCBSID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gXCJodHRwczpcIiA9PT0gZG9jdW1lbnQubG9jYXRpb24ucHJvdG9jb2w7IH0sIEwgPSBmdW5jdGlvbiAoZSwgbikgeyB2YXIgdCA9IFtdLCByID0gZS5pbmRleE9mKG4pOyByZXR1cm4gLTEgPT09IHIgPyB0LnB1c2goZSkgOiAodC5wdXNoKGUuc3Vic3RyKDAsIHIpKSwgdC5wdXNoKGUuc3Vic3RyKHIgKyAxKSkpLCB0OyB9LCBOID0gZnVuY3Rpb24gKGUpIHsgdmFyIG4sIHQsIHIgPSBMKGUsIFwiPVwiKTsgdm9pZCAwICE9PSBlICYmIChuID0gclswXSwgdCA9IHJbMV0pOyB2YXIgbyA9IFwiXCI7IHJldHVybiB2b2lkIDAgIT09IG4gJiYgKG8gKz0gZW5jb2RlVVJJQ29tcG9uZW50KGRlY29kZVVSSUNvbXBvbmVudChuKSkpLCB2b2lkIDAgIT09IHQgJiYgKG8gKz0gXCI9XCIgKyBlbmNvZGVVUklDb21wb25lbnQoZGVjb2RlVVJJQ29tcG9uZW50KHQpKSksIG87IH0sIFUgPSBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IHBhcnNlSW50KGUsIDEwKTsgcmV0dXJuICEoaXNOYU4ocGFyc2VGbG9hdChuKSkgfHwgbiA8IDAgfHwgbiA+IDI1NSk7IH0sIGogPSBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhXCIpOyBuLmhyZWYgPSAvXmh0dHBzPzpcXC9cXC8vaS50ZXN0KGUpID8gZSA6IFwiaHR0cDovL1wiICsgZTsgdmFyIHQgPSBuLmhvc3RuYW1lOyByZXR1cm4gMCA9PT0gdC5pbmRleE9mKFwid3d3LlwiKSAmJiAodCA9IHQucmVwbGFjZShcInd3dy5cIiwgXCJcIikpLCB0OyB9OyB2YXIgRCA9IGZ1bmN0aW9uIChlLCBuKSB7IHJldHVybiBuZXcgUmVnRXhwKFwiXFxcXD9cIiArIG4sIFwiZ2lcIikudGVzdChlKSA/IGUuc3BsaXQoXCImXCIpLmxlbmd0aCA+IDEgPyBlLnJlcGxhY2UobmV3IFJlZ0V4cChuICsgXCJbXiZdKyY/XCIsIFwiZ2lcIiksIFwiXCIpIDogZS5yZXBsYWNlKG5ldyBSZWdFeHAoXCJcXFxcP1wiICsgbiArIFwiW14mXSsmP1wiLCBcImdpXCIpLCBcIlwiKSA6IG5ldyBSZWdFeHAoXCJcXFxcJlwiICsgbiwgXCJnaVwiKS50ZXN0KGUpID8gZS5yZXBsYWNlKG5ldyBSZWdFeHAoXCJcXFxcJlwiICsgbiArIFwiW14mXStcIiwgXCJnaVwiKSwgXCJcIikgOiBlOyB9LCBGID0gZnVuY3Rpb24gKGUsIG4pIHsgdHJ5IHtcbiAgICAgICAgdmFyIHQgPSBuZXcgRXJyb3IsIHIgPSBwbi51c2VyLmdldFByb3ZpZGVyKCkuZ2V0TmFtZSgpLCBvID0gSlNPTi5zdHJpbmdpZnkoW3sgYWlkOiBwbi5haWQsIGRlc2NyaXB0aW9uOiBcImNsZWFyaW5nIF9fdHAgY29va2llXCIsIHVzZXJQcm92aWRlcjogciwgYWNjZXNzVG9rZW5MaXN0OiBlLCB1c2VyVG9rZW46IG4sIHVybDogd2luZG93LmxvY2F0aW9uLmhyZWYsIHRyYWNlOiBYKHQuc3RhY2ssIDMpLCB0YWdzOiBbXCJzZGtcIl0gfV0pO1xuICAgICAgICBwbi5hcGkuY2FsbEFwaShcIi9hbm9uL2Vycm9yL2xvZ1wiLCB7IGxvZ19tZXNzYWdlOiBvIH0pO1xuICAgIH1cbiAgICBjYXRjaCAoZSkgeyB9IH07IHZhciBCID0gZnVuY3Rpb24gKGUpIHsgZSB8fCAoZSA9IDczMCk7IHZhciBuID0gcG4uZ2V0TWF4Q29va2llRXhwaXJhdGlvbkluRGF5cygpOyBpZiAobnVsbCAhPT0gbikge1xuICAgICAgICB2YXIgdDtcbiAgICAgICAgXCJudW1iZXJcIiA9PSB0eXBlb2YgZSA/ICh0ID0gbmV3IERhdGUpLnNldERhdGUodC5nZXREYXRlKCkgKyBlKSA6IHQgPSBlO1xuICAgICAgICB2YXIgciA9IG5ldyBEYXRlO1xuICAgICAgICBpZiAoci5zZXREYXRlKHIuZ2V0RGF0ZSgpICsgbiksIHQgPiByKVxuICAgICAgICAgICAgcmV0dXJuIG47XG4gICAgfSByZXR1cm4gZTsgfSwgViA9IGZ1bmN0aW9uIChlKSB7IHJldHVybiByLmdldChlKTsgfSwgcSA9IGZ1bmN0aW9uIChlLCBuLCB0KSB7IHQgPSB0IHx8IHt9LCBcIjExQzZhWUh3dGJcIiA9PT0gcG4uYWlkID8gKHQuc2FtZXNpdGUgPSBcIm5vbmVcIiwgdC5zZWN1cmUgPSAhMCkgOiB0LnNhbWVzaXRlID0gXCJsYXhcIiwgdC5leHBpcmVzICYmICh0LmV4cGlyZXMgPSBCKHQuZXhwaXJlcykpLCByLnNldChlLCBuLCB0KSwgdm9pZCAwICE9PSBpLnN5bmNocm9uaXplQ29va2llICYmIGkuc3luY2hyb25pemVDb29raWUoZSwgbiwgdC5leHBpcmVzKTsgfSwgeiA9IFwiX190cC1cIiwgSCA9IFwiLWV4cGlyYXRpb25cIiwgVyA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIE1hdGguZmxvb3IoKG5ldyBEYXRlKS5nZXRUaW1lKCkgLyAxZTMpOyB9LCBKID0gZnVuY3Rpb24gKGUpIHsgdmFyIG4gPSB6ICsgZTsgYS5yZW1vdmUobiksIGEucmVtb3ZlKG4gKyBIKTsgfSwgRyA9IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSBbXCJfX3dlYmRyaXZlcl9ldmFsdWF0ZVwiLCBcIl9fc2VsZW5pdW1fZXZhbHVhdGVcIiwgXCJfX3dlYmRyaXZlcl9zY3JpcHRfZnVuY3Rpb25cIiwgXCJfX3dlYmRyaXZlcl9zY3JpcHRfZnVuY1wiLCBcIl9fd2ViZHJpdmVyX3NjcmlwdF9mblwiLCBcIl9fZnhkcml2ZXJfZXZhbHVhdGVcIiwgXCJfX2RyaXZlcl91bndyYXBwZWRcIiwgXCJfX3dlYmRyaXZlcl91bndyYXBwZWRcIiwgXCJfX2RyaXZlcl9ldmFsdWF0ZVwiLCBcIl9fc2VsZW5pdW1fdW53cmFwcGVkXCIsIFwiX19meGRyaXZlcl91bndyYXBwZWRcIl0sIG4gPSBbXCJfcGhhbnRvbVwiLCBcIl9fbmlnaHRtYXJlXCIsIFwiX3NlbGVuaXVtXCIsIFwiY2FsbFBoYW50b21cIiwgXCJjYWxsU2VsZW5pdW1cIiwgXCJfU2VsZW5pdW1fSURFX1JlY29yZGVyXCJdOyBmb3IgKHZhciB0IGluIG4pIHtcbiAgICAgICAgaWYgKHdpbmRvd1tuW3RdXSlcbiAgICAgICAgICAgIHJldHVybiAhMDtcbiAgICB9IGZvciAodmFyIHIgaW4gZSkge1xuICAgICAgICB2YXIgbyA9IGVbcl07XG4gICAgICAgIGlmICh3aW5kb3cuZG9jdW1lbnRbb10pXG4gICAgICAgICAgICByZXR1cm4gITA7XG4gICAgfSBmb3IgKHZhciBpIGluIHdpbmRvdy5kb2N1bWVudClcbiAgICAgICAgaWYgKGkubWF0Y2goL1xcJFthLXpdZGNfLykgJiYgd2luZG93LmRvY3VtZW50W2ldLmNhY2hlXylcbiAgICAgICAgICAgIHJldHVybiAhMDsgcmV0dXJuICEhKHdpbmRvdy5leHRlcm5hbCAmJiB3aW5kb3cuZXh0ZXJuYWwudG9TdHJpbmcgJiYgd2luZG93LmV4dGVybmFsLnRvU3RyaW5nKCkgJiYgLTEgIT09IHdpbmRvdy5leHRlcm5hbC50b1N0cmluZygpLmluZGV4T2YoXCJTZXF1ZW50dW1cIikpIHx8ICghIXdpbmRvdy5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuZ2V0QXR0cmlidXRlKFwic2VsZW5pdW1cIikgfHwgKCEhd2luZG93LmRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5nZXRBdHRyaWJ1dGUoXCJ3ZWJkcml2ZXJcIikgfHwgISF3aW5kb3cuZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmdldEF0dHJpYnV0ZShcImRyaXZlclwiKSkpOyB9LCBRID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gVihcIl9fdGFjXCIpOyB9LCBYID0gZnVuY3Rpb24gKGUsIG4pIHsgcmV0dXJuIGUgJiYgZS5zcGxpdChcIlxcblwiKS5maWx0ZXIoKGZ1bmN0aW9uIChlLCB0KSB7IHJldHVybiB0ID4gMCAmJiB0IDwgbiArIDE7IH0pKS5tYXAoKGZ1bmN0aW9uIChlKSB7IHJldHVybiBlLnRyaW0oKTsgfSkpLmpvaW4oXCJcXG5cIik7IH07IHJldHVybiB7IG5hbWU6IFwidXRpbFwiLCBfX3ByaXZhdGVfXzogeyBnZXRBZGp1c3RlZENvb2tpZUV4cGlyYXRpb246IEIgfSwgX19wcm90ZWN0ZWRfXzogeyBkZWxldGVUTERDb29raWVGb3JTcGVjaWZpY0RvbWFpbnM6IHUsIGRvY3VtZW50UmVhZHk6IGZ1bmN0aW9uIChlKSB7IHZhciBuID0gZnVuY3Rpb24gKCkgeyBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwiRE9NQ29udGVudExvYWRlZFwiLCBuKSwgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJsb2FkXCIsIG4pLCBlKCk7IH07IFwiY29tcGxldGVcIiA9PT0gZG9jdW1lbnQucmVhZHlTdGF0ZSB8fCBcImxvYWRpbmdcIiAhPT0gZG9jdW1lbnQucmVhZHlTdGF0ZSAmJiAhZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmRvU2Nyb2xsID8gd2luZG93LnNldFRpbWVvdXQoZSkgOiAoZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIkRPTUNvbnRlbnRMb2FkZWRcIiwgbiksIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwibG9hZFwiLCBuKSk7IH0sIGdldENvb2tpZTogViwgc2V0Q29va2llOiBxLCBnZXRMb2NhbFN0b3JhZ2VJdGVtOiBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IHogKyBlLCB0ID0gYS5nZXQobiksIHIgPSBhLmdldChuICsgSCk7IHJldHVybiByICYmIHIgPCBXKCkgPyAoSihlKSwgbnVsbCkgOiB0OyB9LCBoYXNMb2NhbFN0b3JhZ2U6IGZ1bmN0aW9uICgpIHsgdHJ5IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJvYmplY3RcIiA9PSB0eXBlb2Ygd2luZG93LmxvY2FsU3RvcmFnZSAmJiBcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICExO1xuICAgICAgICAgICAgfSB9LCByYW5kb21TdHJpbmdDeENvbXBhdGlibGU6IGZ1bmN0aW9uICgpIHsgZm9yICh2YXIgZSA9IChuZXcgRGF0ZSkuZ2V0VGltZSgpLnRvU3RyaW5nKDM2KTsgZS5sZW5ndGggPCAxNjspXG4gICAgICAgICAgICAgICAgZSArPSBNYXRoLnJvdW5kKDIxNDc0ODM2NDcgKiBNYXRoLnJhbmRvbSgpKS50b1N0cmluZygzNik7IHJldHVybiBlLnN1YnN0cigwLCAxNik7IH0sIHNldExvY2FsU3RvcmFnZUl0ZW06IGZ1bmN0aW9uIChlLCBuLCB0KSB7IHZhciByID0geiArIGU7IGEuc2V0KHIsIG4pLCB0ICYmIGEuc2V0KHIgKyBILCBXKCkgKyB0KTsgfSwgcmVtb3ZlTG9jYWxTdG9yYWdlSXRlbTogSiwgY2FtZUZyb21GYlN1YnNjcmlwdGlvbnM6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIDAgPT09IHcoXCJyZWRpcmVjdF91cmlcIikuaW5kZXhPZihcImh0dHBzOi8vd3d3LmZhY2Vib29rLmNvbS9zdWJzY3JpcHRpb25zL2FjY291bnQtbGlua2luZy9jb25maXJtL1wiKTsgfSwgbG9nUmVtb3ZlVG9rZW5zOiBmdW5jdGlvbiAoZSkgeyB0cnkge1xuICAgICAgICAgICAgICAgIHZhciBuID0gbmV3IEVycm9yLCB0ID0gcG4udXNlci5nZXRQcm92aWRlcigpLmdldE5hbWUoKSwgciA9IEpTT04uc3RyaW5naWZ5KFt7IGFpZDogcG4uYWlkLCBkZXNjcmlwdGlvbjogXCJjbGVhcmluZyBfX3V0cCBjb29raWVcIiwgdXNlclByb3ZpZGVyOiB0LCB1c2VyVG9rZW46IGUsIHVybDogd2luZG93LmxvY2F0aW9uLmhyZWYsIHRyYWNlOiBYKG4uc3RhY2ssIDMpLCB0YWdzOiBbXCJzZGtcIl0gfV0pO1xuICAgICAgICAgICAgICAgIHBuLmFwaS5jYWxsQXBpKFwiL2Fub24vZXJyb3IvbG9nXCIsIHsgbG9nX21lc3NhZ2U6IHIgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZSkgeyB9IH0sIHdhaXRBbGxQcm9taXNlczogZnVuY3Rpb24gKGUpIHsgcmV0dXJuIFByb21pc2UuYWxsKGUpOyB9LCBpc0ludGVnZXI6IGZ1bmN0aW9uIChlKSB7IHJldHVybiBcIm51bWJlclwiID09IHR5cGVvZiBlICYmIGlzRmluaXRlKGUpICYmIE1hdGguZmxvb3IoZSkgPT09IGU7IH0sIHJhY2VQcm9taXNlOiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gUHJvbWlzZS5yYWNlKGUpOyB9LCBpc0N4ZW5zZUJvdDogZnVuY3Rpb24gKCkgeyB2YXIgZSA9IE0oKTsgcmV0dXJuIC8oY3hlbnNlYm90KS9pLnRlc3QoZSk7IH0sIGlzSHR0cHNQcm90b2NvbDogUiwgaXNBcHBsZVBheUFsbG93ZWQ6IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSAhMTsgdHJ5IHtcbiAgICAgICAgICAgICAgICBlID0gd2luZG93LkFwcGxlUGF5U2Vzc2lvbiAmJiB3aW5kb3cuQXBwbGVQYXlTZXNzaW9uLmNhbk1ha2VQYXltZW50cygpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICBtKFwiQXBwbGVQYXkgZXJyb3JcIiwgZSk7XG4gICAgICAgICAgICB9IHJldHVybiAoTygpIHx8IFIoKSkgJiYgZTsgfSwgaXNEZXZFbmRwb2ludDogTyB9LCBhZGRTY3JpcHQ6IGZ1bmN0aW9uIChlLCBuKSB7IHZhciB0LCByID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNjcmlwdFwiKSwgbyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwic2NyaXB0XCIpWzBdOyBudWxsID09PSAodCA9IG8ucGFyZW50Tm9kZSkgfHwgdm9pZCAwID09PSB0IHx8IHQuaW5zZXJ0QmVmb3JlKHIsIG8pLCByLnR5cGUgPSBcInRleHQvamF2YXNjcmlwdFwiLCByLmFzeW5jID0gITAsIHIub25sb2FkID0gbiwgci5zcmMgPSBlOyB9LCBmcm9tVW5kZXJzY29yZVRvQ2FtZWxDYXNlOiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gZS5zbGljZSgpLnJlcGxhY2UoL19bYS16XS9nLCAoZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGUucmVwbGFjZShcIl9cIiwgXCJcIikudG9VcHBlckNhc2UoKTsgfSkpOyB9LCByYW5kb21TdHJpbmc6IGZ1bmN0aW9uIChlKSB7IGUgfHwgKGUgPSA1KTsgdmFyIG4gPSBcIlwiLCB0ID0gXCJBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWmFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MDEyMzQ1Njc4OVwiOyBpZiAod2luZG93LmNyeXB0byAmJiB3aW5kb3cuY3J5cHRvLmdldFJhbmRvbVZhbHVlcyAmJiBcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIFVpbnQzMkFycmF5KSB7XG4gICAgICAgICAgICB2YXIgciA9IG5ldyBVaW50MzJBcnJheShlKTtcbiAgICAgICAgICAgIHdpbmRvdy5jcnlwdG8uZ2V0UmFuZG9tVmFsdWVzKHIpO1xuICAgICAgICAgICAgZm9yICh2YXIgbyA9IDA7IG8gPCBlOyBvKyspXG4gICAgICAgICAgICAgICAgbiArPSB0LmNoYXJBdChyW29dICUgdC5sZW5ndGgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIGZvciAobyA9IDA7IG8gPCBlOyBvKyspXG4gICAgICAgICAgICAgICAgbiArPSB0LmNoYXJBdChNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiB0Lmxlbmd0aCkpOyByZXR1cm4gbjsgfSwgbG9nOiBtLCBkZWJ1ZzogZiwgZXJyb3I6IGZ1bmN0aW9uICgpIHsgZm9yICh2YXIgZSwgbiA9IFtdLCB0ID0gMDsgdCA8IGFyZ3VtZW50cy5sZW5ndGg7IHQrKylcbiAgICAgICAgICAgIG5bdF0gPSBhcmd1bWVudHNbdF07IG0uYXBwbHkodm9pZCAwLCBuKSwgKGUgPSBcInN0cmluZ1wiID09IHR5cGVvZiBhcmd1bWVudHNbMF0gPyBuZXcgRXJyb3IoYXJndW1lbnRzWzBdKSA6IG5ldyBFcnJvcikuc3RhY2sgJiYgbShlLnN0YWNrKTsgfSwgZmluZENvb2tpZUJ5TmFtZTogZCwgZmluZENvb2tpZXNCeU5hbWU6IHAsIHJlbW92ZVZvdWNoZXJDb2RlRnJvbVVybDogZnVuY3Rpb24gKGUpIHsgcmV0dXJuIEQoZSwgXCJ2b3VjaGVyX2NvZGVcIik7IH0sIHJlbW92ZVNoYXJlZEFjY291bnRDb2RlRnJvbVVybDogZnVuY3Rpb24gKGUpIHsgcmV0dXJuIEQoZSwgXCJzaGFyZWRfYWNjb3VudF9jb2RlXCIpOyB9LCBkZWxldGVDb29raWU6IGwsIG1hcEFycmF5SW5kZXg6IGZ1bmN0aW9uIChlLCBuKSB7IHJldHVybiBuOyB9LCBnZXRTY3JvbGw6IGcsIGdldFBhZ2VTaXplOiBmdW5jdGlvbiAoKSB7IHJldHVybiB7IHg6IE1hdGgubWF4KGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCwgZG9jdW1lbnQuYm9keS5zY3JvbGxXaWR0aCwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFdpZHRoLCBkb2N1bWVudC5ib2R5Lm9mZnNldFdpZHRoLCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQub2Zmc2V0V2lkdGgpLCB5OiBNYXRoLm1heChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0LCBkb2N1bWVudC5ib2R5LnNjcm9sbEhlaWdodCwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbEhlaWdodCwgZG9jdW1lbnQuYm9keS5vZmZzZXRIZWlnaHQsIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5vZmZzZXRIZWlnaHQpIH07IH0sIGdldFZpZXdwb3J0OiBoLCBjZW50ZXI6IGZ1bmN0aW9uIChlLCBuKSB7IHZhciB0ID0gZygpLCByID0gaCgpOyByZXR1cm4gKHIgPSB7IHg6IHIueCAvIDIgLSBlIC8gMiwgeTogci55IC8gMiAtIG4gLyAyICsgdCB9KS54ID0gTWF0aC5tYXgoMCwgci54KSwgci55ID0gTWF0aC5tYXgoMTAsIHIueSksIHI7IH0sIGNlbnRlclNjcmVlbjogZnVuY3Rpb24gKGUsIG4pIHsgZSA9IGUgfHwgMCwgbiA9IG4gfHwgMDsgdmFyIHIgPSB2b2lkIDAgIT09IHdpbmRvdy5zY3JlZW5MZWZ0ID8gd2luZG93LnNjcmVlbkxlZnQgOiB3aW5kb3cuc2NyZWVuLmxlZnQsIG8gPSB2b2lkIDAgIT09IHdpbmRvdy5zY3JlZW5Ub3AgPyB3aW5kb3cuc2NyZWVuVG9wIDogd2luZG93LnNjcmVlbi50b3AsIGkgPSB0LndpblNpemUoKTsgcmV0dXJuIHsgbGVmdDogKGkud2lkdGggfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoIHx8IHdpbmRvdy5zY3JlZW4ud2lkdGgpIC8gMiAtIGUgLyAyICsgciwgdG9wOiAoaS5oZWlnaHQgfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodCB8fCB3aW5kb3cuc2NyZWVuLmhlaWdodCkgLyAyIC0gbiAvIDIgKyBvIH07IH0sIGdldFF1ZXJ5UGFyYW1CeU5hbWU6IHcsIGhhc1F1ZXJ5UGFyYW1CeU5hbWU6IGZ1bmN0aW9uIChlKSB7IHZhciBuID0ge307IHJldHVybiBsb2NhdGlvbi5zZWFyY2guc3Vic3RyKDEpLnNwbGl0KFwiJlwiKS5mb3JFYWNoKChmdW5jdGlvbiAoZSkgeyB2YXIgdCA9IGUuc3BsaXQoXCI9XCIpLCByID0gdFswXSwgbyA9IHRbMV0gJiYgZGVjb2RlVVJJQ29tcG9uZW50KHRbMV0pOyByIGluIG4gPyBuW3JdLnB1c2gobykgOiBuW3JdID0gW29dOyB9KSksIG4uaGFzT3duUHJvcGVydHkoZSk7IH0sIHJlbW92ZVF1ZXJ5UGFyYW1CeU5hbWU6IGZ1bmN0aW9uIChlKSB7IHkoKGZ1bmN0aW9uIChuKSB7IHJldHVybiBmdW5jdGlvbiAoZSwgbikgeyB2YXIgdCwgciA9IGUuc3BsaXQoXCIjXCIpLCBvID0gclswXS5zcGxpdChcIj9cIik7IGlmIChyLmxlbmd0aCA+PSAyICYmICh0ID0gclsxXSksIG4gPSBBcnJheS5pc0FycmF5KG4pID8gbiA6IFtuXSwgby5sZW5ndGggPj0gMikge1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IG9bMV0uc3BsaXQoL1smO10vZyksIGEgPSAwOyBhIDwgbi5sZW5ndGg7IGErKylcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBzID0gZW5jb2RlVVJJQ29tcG9uZW50KG5bYV0pICsgXCI9XCIsIGMgPSBpLmxlbmd0aDsgYy0tID4gMDspXG4gICAgICAgICAgICAgICAgICAgIC0xICE9PSBpW2NdLmxhc3RJbmRleE9mKHMsIDApICYmIGkuc3BsaWNlKGMsIDEpO1xuICAgICAgICAgICAgcmV0dXJuIGUgPSBvWzBdICsgKGkubGVuZ3RoID4gMCA/IFwiP1wiICsgaS5qb2luKFwiJlwiKSA6IFwiXCIpLCB0ID8gZSArIFwiI1wiICsgdCA6IGU7XG4gICAgICAgIH0gcmV0dXJuIGU7IH0obiwgZSk7IH0pKTsgfSwgc2V0QWNjZXNzVG9rZW5MaXN0Q29va2llOiBmdW5jdGlvbiAoZSwgbiwgcikgeyB2YXIgbyA9IF8oXCJfX3V0XCIpOyBpZiAoZSAmJiBcInN0cmluZ1wiID09PSB0LnR5cGUoZS52YWx1ZSkpIHtcbiAgICAgICAgICAgIHZhciBpID0gbmV3IERhdGUsIGEgPSB7IGRvbWFpbjogdW5kZWZpbmVkLCBwYXRoOiBcIi9cIiwgZXhwaXJlczogNzMwIH07XG4gICAgICAgICAgICBlLmNvb2tpZV9kb21haW4gJiYgXCJsb2NhbGhvc3RcIiAhPT0gZS5jb29raWVfZG9tYWluICYmIHQuaW5BcnJheShlLmNvb2tpZV9kb21haW4sIFMoKSkgPj0gMCAmJiAoYS5kb21haW4gPSBlLmNvb2tpZV9kb21haW4pLCBwbi5jb29raWVEb21haW4gJiYgKGEuZG9tYWluID0gcG4uY29va2llRG9tYWluKSwgcG4uY29va2llUGF0aCAmJiAoYS5wYXRoID0gcG4uY29va2llUGF0aCk7XG4gICAgICAgICAgICB2YXIgcyA9IFMoKTtcbiAgICAgICAgICAgIGZvciAodmFyIGMgaW4gcylcbiAgICAgICAgICAgICAgICBsKFwiX190YWNcIiwgc1tjXSksIGwoXCJfX3RhZVwiLCBzW2NdKSwgbChvLCBzW2NdKTtcbiAgICAgICAgICAgIHEoXCJfX3RhY1wiLCBlLnZhbHVlLCBhKSwgcShcIl9fdGFlXCIsIGkuZ2V0VGltZSgpLCBhKSwgcShvLCBuLCBhKSwgXCJcIiAhPT0gbiB8fCByIHx8IEYoZSwgbik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB2YXIgdSA9IFMoKTtcbiAgICAgICAgICAgIGlmICh1LnB1c2godm9pZCAwKSwgcG4uY29va2llRG9tYWluICYmIHUucHVzaChwbi5jb29raWVEb21haW4pLCBwbi5jb29raWVQYXRoKVxuICAgICAgICAgICAgICAgIGZvciAodmFyIGMgaW4gdSlcbiAgICAgICAgICAgICAgICAgICAgbChcIl9fdGFjXCIsIHVbY10sIHBuLmNvb2tpZVBhdGgpLCBsKFwiX190YWVcIiwgdVtjXSwgcG4uY29va2llUGF0aCksIGwoXCJfX2VlYVwiLCB1W2NdLCBwbi5jb29raWVQYXRoKSwgbChvLCB1W2NdLCBwbi5jb29raWVQYXRoKTtcbiAgICAgICAgICAgIGZvciAodmFyIGMgaW4gdSlcbiAgICAgICAgICAgICAgICBsKFwiX190YWNcIiwgdVtjXSksIGwoXCJfX3RhZVwiLCB1W2NdKSwgbChcIl9fZWVhXCIsIHVbY10pLCBsKG8sIHVbY10pO1xuICAgICAgICAgICAgciB8fCBGKGUsIG4pO1xuICAgICAgICB9IH0sIHNldFRwY2NDb29raWVzOiBmdW5jdGlvbiAoKSB7IHZhciBlID0gdyhcInRwY2NcIik7IGlmIChlKSB7XG4gICAgICAgICAgICB2YXIgbiA9IG5ldyBEYXRlLCB0ID0gSlNPTi5zdHJpbmdpZnkoeyBkYXRlOiBuLmdldFRpbWUoKSB9KSwgciA9IGsoKTtcbiAgICAgICAgICAgIC9eKDI1WzAtNV18MlswLTRdWzAtOV18WzAxXT9bMC05XVswLTldPylcXC4oMjVbMC01XXwyWzAtNF1bMC05XXxbMDFdP1swLTldWzAtOV0/KVxcLigyNVswLTVdfDJbMC00XVswLTldfFswMV0/WzAtOV1bMC05XT8pXFwuKDI1WzAtNV18MlswLTRdWzAtOV18WzAxXT9bMC05XVswLTldPykkLy50ZXN0KGxvY2F0aW9uLmhvc3RuYW1lKSAmJiAociA9IFwiXCIpLCByIHx8IChyID0gXCJcIiksIHEoXCJ0cGNjX1wiICsgZSwgdCwgeyBwYXRoOiBcIi9cIiwgZXhwaXJlczogOTAsIGRvbWFpbjogciB9KTtcbiAgICAgICAgfSB9LCBnZXRDYW1wYWlnbnM6IGZ1bmN0aW9uIChlKSB7IHAoL150cGNjXy4rLykuZm9yRWFjaCgoZnVuY3Rpb24gKG4pIHsgZVtuLm5hbWVdID0gbi52YWx1ZTsgfSkpOyB9LCBnZXRDdXN0b21Db29raWVzOiBmdW5jdGlvbiAoKSB7IHZhciBlID0ge307IHJldHVybiBwKC9eX3BjXy4rLykuZm9yRWFjaCgoZnVuY3Rpb24gKG4pIHsgZVtkZWNvZGVVUklDb21wb25lbnQobi5uYW1lKV0gPSBuLnZhbHVlOyB9KSksIGU7IH0sIEFEQkxPQ0tFUl9TVEFUVVM6IGMsIGdldEFkYmxvY2tTdGF0dXM6IGZ1bmN0aW9uICgpIHsgdmFyIGUsIG4sIHQgPSBjLk5PVF9ERVRFQ1RFRCwgciA9IFAoKTsgcmV0dXJuIHBuLmFkYmxvY2tlckNvb2tpZU5hbWUgJiYgKHQgPSB4KHBuLmFkYmxvY2tlckNvb2tpZU5hbWUpKSwgdCA9PT0gYy5OT1RfREVURUNURUQgJiYgKHQgPSB4KFwiX19wYWNcIikpLCB0ID09PSBjLk5PVF9ERVRFQ1RFRCAmJiAodCA9IHgoXCJfX2FkYmxvY2tlclwiKSksIGUgPSByLmNvb2tpZVZhbHVlLCBlIDw8PSAxLCAobiA9IHQpID09PSBjLkVOQUJMRUQgPyBlIHw9IDEgOiBlICY9IC0yLCBuICE9PSBjLk5PVF9ERVRFQ1RFRCAmJiBxKFwiX19wbmFoY1wiLCBlICsgXCJcIiwgeyBwYXRoOiBcIi9cIiwgZXhwaXJlczogOTAgfSksIHQgPT09IGMuRU5BQkxFRCAmJiAoci5pc0ZpcnN0IHx8IDEgIT0gKHIuY29va2llVmFsdWUgPj4gMCAmIDEpICYmICh0ID0gYy5FTkFCTEVEX0FGVEVSX0RJU0FCTEVEKSksIHQ7IH0sIGdldEFkYmxvY2tlclN0YXR1c1JlYXNvbjogZnVuY3Rpb24gKCkgeyByZXR1cm4gdm9pZCAwICE9PSB3aW5kb3cuYmxvY2tBZEJsb2NrID8gXCIxXCIgOiBcIjBcIjsgfSwgZ2V0QWRibG9ja2VySGlzdG9yeUNvb2tpZUluZm86IFAsIHdhaXRDYWxsOiBmdW5jdGlvbiAoZSwgbikgeyBFW2VdID8gRVtlXS53YWl0ZXJzLnB1c2gobikgOiBuKCk7IH0sIHN0YXJ0Q2FsbDogVCwgZG9uZUNhbGw6IEEsIGhhc0NhbGw6IGZ1bmN0aW9uIChlKSB7IHJldHVybiAhIUVbZV07IH0sIGRlYm91bmNlOiBmdW5jdGlvbiAoZSwgbiwgdCkgeyB2YXIgcjsgcmV0dXJuIGZ1bmN0aW9uICgpIHsgdmFyIG8gPSB0aGlzLCBpID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKSwgYSA9IGZ1bmN0aW9uICgpIHsgciA9IG51bGwsIHQgfHwgZS5hcHBseShvLCBpKTsgfSwgcyA9IHQgJiYgIXI7IGNsZWFyVGltZW91dChyKSwgciA9IHNldFRpbWVvdXQoYSwgbiksIHMgJiYgZS5hcHBseShvLCBpKTsgfTsgfSwgdGhyb3R0bGU6IGZ1bmN0aW9uIChlLCBuKSB7IHZhciB0LCByLCBvID0gITE7IHJldHVybiBmdW5jdGlvbiBpKCkgeyBpZiAobylcbiAgICAgICAgICAgIHJldHVybiB0ID0gYXJndW1lbnRzLCB2b2lkIChyID0gdGhpcyk7IGUuYXBwbHkodGhpcywgYXJndW1lbnRzKSwgbyA9ICEwLCBzZXRUaW1lb3V0KChmdW5jdGlvbiAoKSB7IG8gPSAhMSwgdCAmJiAoaS5hcHBseShyLCB0KSwgdCA9IHIgPSBudWxsKTsgfSksIG4pOyB9OyB9LCBwcm9maWxlOiBmdW5jdGlvbiAoZSkgeyBmdW5jdGlvbiBuKCkgeyByZXR1cm4gbi5fX2ludm9rZUNvdW50KyssIGUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsgfSByZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KG4sIFwiX19pbnZva2VDb3VudFwiLCB7IHdyaXRhYmxlOiAhMCwgdmFsdWU6IDAgfSksIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShuLCBcImludm9rZUNvdW50XCIsIHsgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLl9faW52b2tlQ291bnQ7IH0gfSksIG47IH0sIHNldFRiY0Nvb2tpZUZyb21SZXNwb25zZTogZnVuY3Rpb24gKGUpIHsgZS5icm93c2VyICYmIHZvaWQgMCAhPT0gZS5icm93c2VyLnRiYyAmJiBiKFwiX190YmNcIiwgZS5icm93c2VyLnRiYywgZS5icm93c2VyLmNvb2tpZV9kb21haW4pLCBlLnRiYyAmJiBlLnRiYy5jb29raWVfdmFsdWUgJiYgYihcIl9fdGJjXCIsIGUudGJjLmNvb2tpZV92YWx1ZSwgZS50YmMuY29va2llX2RvbWFpbik7IH0sIHNldFRhY0Nvb2tpZUZyb21SZXNwb25zZTogZnVuY3Rpb24gKGUpIHsgdmFyIG4gPSAobmV3IERhdGUpLmdldFRpbWUoKSwgdCA9IFEoKSwgciA9IGZ1bmN0aW9uIChlLCByKSB7IGUgJiYgZSAhPT0gdCAmJiAoYihcIl9fdGFjXCIsIGUsIHIpLCBiKFwiX190YWVcIiwgbiwgcikpOyB9OyBlLmJyb3dzZXIgJiYgcihlLmJyb3dzZXIudGFjLCBlLmJyb3dzZXIuY29va2llX2RvbWFpbiksIGUudGFjICYmIHIoZS50YWMuY29va2llX3ZhbHVlLCBlLnRhYy5jb29raWVfZG9tYWluKTsgfSwgZ2V0VGJjQ29va2llOiBmdW5jdGlvbiAoKSB7IHJldHVybiBWKFwiX190YmNcIik7IH0sIGdldFRhY0Nvb2tpZTogUSwgZ2V0QWlkU3BlY2lmaWVkTmFtZTogXywgZ2V0VXNlclRva2VuQ29va2llOiBmdW5jdGlvbiAoKSB7IHZhciBlID0gXyhcIl9fdXRcIiksIG4gPSBkKGUpOyByZXR1cm4gdm9pZCAwICE9PSBuICYmIG4gJiYgbi5sZW5ndGggPj0gMCA/IG4gOiBudWxsOyB9LCBnZXRQdXNoTGlzdHNDb29raWU6IEMsIHNldFB1c2hMaXN0c0Nvb2tpZTogZnVuY3Rpb24gKGUpIHsgaWYgKGUpIHtcbiAgICAgICAgICAgIHZhciBuID0gXyhcIl9fcGxzXCIpLCB0ID0gQygpIHx8IFtdO1xuICAgICAgICAgICAgdC5pbmRleE9mKGUpID4gLTEgfHwgKHQucHVzaChlKSwgbChuKSwgcShuLCBKU09OLnN0cmluZ2lmeSh0KSwgeyBwYXRoOiBcIi9cIiwgZXhwaXJlczogNzMwLCBkb21haW46IGsoKSB9KSk7XG4gICAgICAgIH0gfSwgc2V0QXBwVGltZXpvbmVPZmZzZXRGcm9tUmVzcG9uc2U6IGZ1bmN0aW9uIChlKSB7IGUuYnJvd3NlciAmJiB2b2lkIDAgIT09IGUuYnJvd3Nlci5hcHBfdGltZXpvbmVfb2Zmc2V0ID8gSShlLmJyb3dzZXIuYXBwX3RpbWV6b25lX29mZnNldCkgOiB2b2lkIDAgIT09IGUudGltZXpvbmVfb2Zmc2V0ICYmIEkoZS50aW1lem9uZV9vZmZzZXQpOyB9LCBzZXRBcHBUaW1lem9uZU9mZnNldDogSSwgZ2V0QXBwVGltZXpvbmVPZmZzZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIG51bGwgPT0gbiAmJiAobiA9IFYoXCJfX3BhdFwiKSksIG4gfHwgMDsgfSwgZ2V0QnJvd3NlclRpbWV6b25lT2Zmc2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiAtTWF0aC5yb3VuZCgobmV3IERhdGUpLmdldFRpbWV6b25lT2Zmc2V0KCkpOyB9LCBzdHIydGltZXN0YW1wOiBmdW5jdGlvbiAoZSkgeyBpZiAodm9pZCAwICE9PSBlICYmIDAgIT09IGUubGVuZ3RoKSB7XG4gICAgICAgICAgICBpZiAoXCJzdHJpbmdcIiAhPSB0eXBlb2YgZSAmJiAoZSA9IFwiXCIgKyBlKSwgKGUgPSBlLnRyaW0oKSkubWF0Y2goL15bMC05XXswLDEwfSQvKSlcbiAgICAgICAgICAgICAgICByZXR1cm4gcGFyc2VJbnQoZSk7XG4gICAgICAgICAgICBpZiAoZS5tYXRjaCgvXlswLTldezEzLH0kLykpXG4gICAgICAgICAgICAgICAgcmV0dXJuIHBhcnNlSW50KGUpIC8gMWUzO1xuICAgICAgICAgICAgdmFyIG4gPSBEYXRlLnBhcnNlKGUpO1xuICAgICAgICAgICAgaWYgKG4pXG4gICAgICAgICAgICAgICAgcmV0dXJuIG4gLyAxZTM7XG4gICAgICAgICAgICBpZiAoKGUgPSAoZSA9IChlID0gKGUgPSBlLnJlcGxhY2UoLzAwOihbMC05XXsyfSg6WzAtOV17Mn0pP1xccypbQVBdTSkvaSwgXCIxMjokMVwiKS5yZXBsYWNlKC8oWzAtOV17Mn0pKFtBUHxNXSkvaSwgXCIkMSAkMlwiKSkucmVwbGFjZSgvXFxzKihhdHxAfFxcLXxvbnxcXHwpXFxzKi9naSwgXCIgXCIpKS5yZXBsYWNlKC9cXHMqKG1vbihkYXkpP3x0dWUocz9kYXkpP3x3ZWQobmVzZGF5KT98dGh1KChycyk/ZGF5KT98ZnJpKGRheSk/fHNhdCh1cmRheSk/fHN1bihkYXkpPylcXHMqL2dpLCBcIlwiKSkucmVwbGFjZSgvKFswLTldezEsMn0pKHN0fG5kfHJkfHRoKS8sIFwiJDFcIikpLm1hdGNoKC9cXHMrRVQkLykpXG4gICAgICAgICAgICAgICAgZSA9IDI0MCA9PT0gKG5ldyBEYXRlKS5nZXRUaW1lem9uZU9mZnNldCgpID8gZS5yZXBsYWNlKC9cXHMrRVQkLywgXCIgRURUXCIpIDogZS5yZXBsYWNlKC9cXHMrRVQkLywgXCIgRVNUXCIpO1xuICAgICAgICAgICAgaWYgKGUgPSBlLnRyaW0oKSwgbiA9IERhdGUucGFyc2UoZSkpXG4gICAgICAgICAgICAgICAgcmV0dXJuIG4gLyAxZTM7XG4gICAgICAgICAgICB2YXIgdCA9IGUubWF0Y2goLyFeKFthLXpdKylbLS8gXShbMC05XSspWy0vIF0oWzAtOV0rKSguKikkIWkvKTtcbiAgICAgICAgICAgIHJldHVybiB0ID8gZSA9IHRbMl0gKyBcIiBcIiArIHRbMV0gKyBcIiBcIiArIHRbM10gKyB0WzRdIDogKHQgPSBlLm1hdGNoKC8hXihbMC05XSspWy0vIF0oW2Etel0rKVstLyBdKFswLTldKykoLiopJCFpLykpICYmIChlID0gdFsxXSArIFwiIFwiICsgdFsyXSArIFwiIFwiICsgdFszXSArIHRbNF0pLCAobiA9IERhdGUucGFyc2UoZSkpID8gbiAvIDFlMyA6IHZvaWQgMDtcbiAgICAgICAgfSB9LCBnZXRQb3NzaWJsZUNvb2tpZURvbWFpbnM6IFMsIGlzTW9iaWxlVGFibGV0SU9zOiBmdW5jdGlvbiAoKSB7IHZhciBlID0gTSgpOyByZXR1cm4gL2lQYWR8aVBob25lfGlQb2QvLnRlc3QoZSkgJiYgIXdpbmRvdy5NU1N0cmVhbTsgfSwgaXNJcGhvbmU6IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSBNKCk7IHJldHVybiAvaVBob25lLy50ZXN0KGUpICYmICF3aW5kb3cuTVNTdHJlYW07IH0sIGlzSU9TOiBmdW5jdGlvbiAoKSB7IHZhciBlID0gTSgpOyByZXR1cm4gL2lQYWR8aVBob25lfGlQb2QvLnRlc3QoZSkgJiYgIXdpbmRvdy5NU1N0cmVhbTsgfSwgaXNJT3NVaVdlYlZpZXc6IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSBNKCk7IHJldHVybiAvKGlQaG9uZXxpUG9kfGlQYWQpLipBcHBsZVdlYktpdCg/IS4qU2FmYXJpKS9pLnRlc3QoZSk7IH0sIGlzU2FmYXJpT3JJT3NVaVdlYlZpZXc6IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSBNKCk7IHJldHVybiAvKGlQaG9uZXxpUG9kfGlQYWQpLipBcHBsZVdlYktpdC9pLnRlc3QoZSk7IH0sIGlzRkJPckluc3RXZWJWaWV3OiBmdW5jdGlvbiAoKSB7IHZhciBlID0gTSgpOyByZXR1cm4gZS5pbmRleE9mKFwiRkJBTlwiKSA+IC0xIHx8IGUuaW5kZXhPZihcIkZCQVZcIikgPiAtMSB8fCBlLmluZGV4T2YoXCJJbnN0YWdyYW1cIikgPiAtMTsgfSwgaXNBbmRyb2lkOiBmdW5jdGlvbiAoKSB7IHZhciBlID0gTSgpOyByZXR1cm4gLyhhbmRyb2lkKS9pLnRlc3QoZSk7IH0sIGlzSUU6IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSAtMSAhPT0gKG5hdmlnYXRvciAmJiBuYXZpZ2F0b3IuYXBwVmVyc2lvbiB8fCBcIlwiKS5pbmRleE9mKFwiTVNJRVwiKSwgbiA9IChuYXZpZ2F0b3IgJiYgbmF2aWdhdG9yLnVzZXJBZ2VudCB8fCBcIlwiKS5pbmRleE9mKFwiVHJpZGVudC9cIikgPiAwOyByZXR1cm4gZSB8fCBuOyB9LCBpc0NyaU9TOiBmdW5jdGlvbiAoKSB7IHJldHVybiAtMSAhPT0gKG5hdmlnYXRvciAmJiBuYXZpZ2F0b3IudXNlckFnZW50IHx8IFwiXCIpLmluZGV4T2YoXCJDcmlPU1wiKTsgfSwgaXNSZWxhdGl2ZVVybDogZnVuY3Rpb24gKGUpIHsgcmV0dXJuIC9eXFwvKD86XFx3K3xcXC57MSwyfVxcL1xcdyspLy50ZXN0KGUpOyB9LCBwcmVwYXJlVXJsUGFyYW1ldGVyOiBmdW5jdGlvbiAoZSkgeyBpZiAoIWUpXG4gICAgICAgICAgICByZXR1cm4gXCJcIjsgdmFyIG4gPSBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IGUuaW5kZXhPZihcIj9cIiksIHQgPSBlLmluZGV4T2YoXCIjXCIpLCByID0gITE7IC0xICE9PSB0ICYmIChyID0gITApOyB2YXIgbywgaSA9ICExOyAtMSAhPT0gbiAmJiAoaSA9ICEwKSwgciAmJiBpICYmIHQgPCBuICYmIChpID0gITEpOyB2YXIgYSA9IFwiXCIsIHMgPSBcIlwiOyBpZiAoaSkge1xuICAgICAgICAgICAgdmFyIGMgPSBMKGUsIFwiP1wiKTtcbiAgICAgICAgICAgIGlmIChvID0gY1swXSwgcikge1xuICAgICAgICAgICAgICAgIHZhciBsID0gTChjWzFdLCBcIiNcIik7XG4gICAgICAgICAgICAgICAgYSA9IGxbMF0sIHMgPSBsWzFdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIGEgPSBjWzFdO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHIpIHtcbiAgICAgICAgICAgIHZhciB1ID0gTChlLCBcIiNcIik7XG4gICAgICAgICAgICBvID0gdVswXSwgcyA9IHVbMV07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgbyA9IGU7IHJldHVybiB7IHNjaGVtZURvbWFpbkFuZFBhdGg6IG8sIHF1ZXJ5U3RyaW5nOiBhLCBoYXNoOiBzLCBoYXNRdWVyeVN0cmluZzogaSwgaGFzSGFzaDogciB9OyB9KGUgPSBlLnJlcGxhY2UoL14oKCUyMCl8XFxzKSsvLCBcIlwiKSksIHQgPSBlbmNvZGVVUkkoZGVjb2RlVVJJKG4uc2NoZW1lRG9tYWluQW5kUGF0aCkpOyByZXR1cm4gbi5oYXNRdWVyeVN0cmluZyAmJiAodCArPSBcIj9cIiArIGZ1bmN0aW9uIChlKSB7IHZhciBuID0gXCJcIjsgaWYgKHZvaWQgMCAhPT0gZSlcbiAgICAgICAgICAgIGZvciAodmFyIHQgPSBlLnNwbGl0KFwiJlwiKSwgciA9IDA7IHIgPCB0Lmxlbmd0aDsgcisrKVxuICAgICAgICAgICAgICAgIHIgPiAwICYmIChuICs9IFwiJlwiKSwgbiArPSBOKHRbcl0pOyByZXR1cm4gbjsgfShuLnF1ZXJ5U3RyaW5nKSksIG4uaGFzSGFzaCAmJiAodCArPSBcIiNcIiArIGVuY29kZVVSSUNvbXBvbmVudChkZWNvZGVVUklDb21wb25lbnQobi5oYXNoKSkpLCB0OyB9LCBnZXRSZWZlcnJlcjogZnVuY3Rpb24gKCkgeyByZXR1cm4gZG9jdW1lbnQucmVmZXJyZXI7IH0sIGdldEhvc3RuYW1lOiBqLCBleHRyYWN0Q29va2llRG9tYWluOiBmdW5jdGlvbiAoZSkgeyBpZiAoZSAmJiBlLmxlbmd0aCAmJiBcIi5cIiA9PT0gZVswXSlcbiAgICAgICAgICAgIHJldHVybiBlOyB2YXIgbiA9IGUgfHwgd2luZG93LmxvY2F0aW9uLmhyZWYsIHQgPSBqKG4pOyByZXR1cm4gZnVuY3Rpb24gKGUpIHsgdmFyIG4gPSBlLnNwbGl0KFwiLlwiKSwgdCA9ICEwOyByZXR1cm4gNCA9PT0gbi5sZW5ndGggJiYgVShuWzBdKSAmJiBVKG5bMV0pICYmIFUoblsyXSkgJiYgVShuWzNdKSB8fCAodCA9ICExKSwgdDsgfSh0KSA/IHQgOiBcImxvY2FsaG9zdFwiID09PSB0ID8gbnVsbCA6IFwiLlwiICsgdDsgfSwgc2V0Q3VycmVudERvbWFpbkZyb21SZXNwb25zZTogZnVuY3Rpb24gKGUpIHsgdm9pZCAwICE9PSBlLmJyb3dzZXIgJiYgdm9pZCAwICE9PSBlLmJyb3dzZXIuY29va2llX2RvbWFpbiAmJiBBKFwiZG9tYWluSXNSZWNlaXZlZFwiLCBlLmJyb3dzZXIuY29va2llX2RvbWFpbiksIGUudGJjICYmIGUudGJjLmNvb2tpZV9kb21haW4gJiYgQShcImRvbWFpbklzUmVjZWl2ZWRcIiwgZS50YmMuY29va2llX2RvbWFpbik7IH0sIGdldEN1cnJlbnREb21haW5Gcm9tQ29va2llOiBmdW5jdGlvbiAoZSkgeyB0cnkge1xuICAgICAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UoVihlKSkuZG9tYWluO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICBUKFwiZG9tYWluSXNSZWNlaXZlZFwiKTtcbiAgICAgICAgfSB9LCBpc0JvdDogRywgZ2V0QWZmaWxpYXRlVG9rZW46IGZ1bmN0aW9uIChlKSB7IHZhciBuID0gd2luZG93LmxvY2F0aW9uLmhhc2guc2xpY2UoMSk7IGlmIChuKSB7XG4gICAgICAgICAgICB2YXIgdCA9IG4uc3BsaXQoXCI9XCIpLCByID0gdFswXSwgbyA9IHRbMV07XG4gICAgICAgICAgICByICYmIG8gJiYgciA9PT0gZSAmJiAoeSgoZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGUuc3BsaXQoXCIjXCIpWzBdOyB9KSksIHMgPSBvKTtcbiAgICAgICAgfSByZXR1cm4gczsgfSwgcmVtb3ZlQWZmaWxpYXRlVG9rZW46IGZ1bmN0aW9uICgpIHsgcyA9IFwiXCI7IH0gfTsgfTtcbiAgICBwbi5jb250YWluZXIucmVnaXN0ZXIoXCJ1dGlsXCIsIHsgdXNlVmFsdWU6IENlKCkgfSksIHBuLnV0aWwgPSBwbi5jb250YWluZXIucmVzb2x2ZShcInV0aWxcIik7XG4gICAgdmFyIEllID0gZnVuY3Rpb24gKCkgeyB2YXIgZSwgbiA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwianFVdGlsc1wiKSwgdCA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwidXRpbFwiKSwgciA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwiYWpheFwiKSwgbyA9IHQuZmluZENvb2tpZUJ5TmFtZSgvX19UUF8qLyk7IGlmICh2b2lkIDAgIT09IHdpbmRvdy5fdHBtICYmIHZvaWQgMCAhPT0gd2luZG93Ll90cG0ucGF5d2FsbElEKSB7XG4gICAgICAgIHZhciBpID0gd2luZG93Ll90cG0ucGF5d2FsbElEO1xuICAgICAgICBlID0gdC5fX3Byb3RlY3RlZF9fLmdldENvb2tpZShcInVtY19cIiArIGkpO1xuICAgIH0gdmFyIGEgPSBmdW5jdGlvbiAoKSB7IHJldHVybiBwbi5nZXRBcGlFbmRwb2ludCgpOyB9LCBzID0gZnVuY3Rpb24gKG4sIHIpIHsgdmFyIGkgPSB0Ll9fcHJvdGVjdGVkX18uZ2V0Q29va2llKFwiX190YWNcIik7IHZvaWQgMCAhPT0gbiAmJiBuIHx8IChuID0ge30pLCBuLmFpZCA9IHBuLmFpZCwgZSAmJiAobi51bWMgPSBlKSwgbyAmJiAobi50cF9hY2Nlc3NfdG9rZW5fdjIgPSBvKSwgaSAmJiAobi50YWMgPSBpKSwgbi51c2VyX3Byb3ZpZGVyIHx8ICFyIHx8IHIuaXN2IHx8IChuLnVzZXJfcHJvdmlkZXIgPSByLmdldE5hbWUoKSksIHZvaWQgMCAhPT0gbi51c2VyX3Rva2VuICYmIG4udXNlcl90b2tlbiB8fCAhciB8fCByLmlzdiB8fCAobi51c2VyX3Rva2VuID0gXCJzdHJpbmdcIiA9PSB0eXBlb2Ygci5nZXRUb2tlbigpID8gci5nZXRUb2tlbigpIDogXCJcIik7IHZhciBhID0gdC5nZXRBZmZpbGlhdGVUb2tlbihwbi5hZmZpbGlhdGVUb2tlbk5hbWUpOyBhICYmIChuLmFmZmlsaWF0ZVRva2VuID0gYSk7IH07IGZ1bmN0aW9uIGMoZSwgbywgaSwgYywgbCwgdSkgeyB2YXIgZDsgdC5kZWJ1ZyhcIkNhbGxpbmcgQVBJIG1ldGhvZDogXCIgKyBlKSwgZCA9IHZvaWQgMCAhPT0gYyA/IGMgOiBhKCksIGQgKz0gZSwgdm9pZCAwICE9PSBvICYmIG8gfHwgKG8gPSB7fSk7IHZhciBwLCBmLCBtID0gdC5nZXRUYmNDb29raWUoKTsgbSAmJiAoby50YmMgPSBtKSwgcG4udXNlciAmJiAocCA9IHBuLnVzZXIuZ2V0UHJvdmlkZXIoKSksIHMobywgcCksIGYgPSBmdW5jdGlvbiAoZSkgeyB0LmRlYnVnKFwiQVBJIFJlc3BvbnNlXCIsIGUpLCB0LnNldFRiY0Nvb2tpZUZyb21SZXNwb25zZShlKSwgdC5zZXRBcHBUaW1lem9uZU9mZnNldEZyb21SZXNwb25zZShlKSwgdC5zZXRDdXJyZW50RG9tYWluRnJvbVJlc3BvbnNlKGUpLCB2b2lkIDAgIT09IGkgJiYgaShlKTsgfTsgdmFyIGcgPSBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IFwiL2FjY2Vzcy9saXN0XCIsIHQgPSBcIi9hY2Nlc3MvY2hlY2tcIjsgaWYgKGUgIT09IG4gJiYgZSAhPT0gdCAmJiBcIi91c2VyL2FjY2Vzcy9saXN0XCIgIT09IGUgJiYgXCIvdXNlci9hY2Nlc3MvY2hlY2suand0XCIgIT09IGUpXG4gICAgICAgIHJldHVybiBudWxsOyB2YXIgciA9IE1hdGguZmxvb3IoKG5ldyBEYXRlKS5nZXRUaW1lKCkgLyAxZTMpOyByZXR1cm4gZSA9PT0gbiA/IHsgY29kZTogMCwgY291bnQ6IDAsIGRhdGE6IFtdLCBsaW1pdDogMCwgb2Zmc2V0OiAwLCB0b3RhbDogMCwgdHM6IHIgfSA6IGUgPT09IHQgPyB7IGNvZGU6IDAsIHRzOiAxNTQ4OTQyMzE0LCBhY2Nlc3M6IHsgYWNjZXNzX2lkOiBudWxsLCBwYXJlbnRfYWNjZXNzX2lkOiBudWxsLCBncmFudGVkOiAhMSwgcmVzb3VyY2U6IG51bGwsIHVzZXI6IG51bGwsIGV4cGlyZV9kYXRlOiByIH0gfSA6IHsgY29kZTogNDAzLCB0czogciwgbWVzc2FnZTogXCJVc2VyIGRvZXNuJ3QgaGF2ZSBwZXJtaXNzaW9uIHRvIGNhbGwgdGhpcyBtZXRob2RcIiB9OyB9KGUpOyBpZiAobnVsbCA9PT0gZyB8fCBwbi51c2VyLmdldFByb3ZpZGVyKCkuaXNVc2VyVmFsaWQoKSkge1xuICAgICAgICB2YXIgdjtcbiAgICAgICAgIWZ1bmN0aW9uIChlKSB7IHBuLmlzRG91YmxlT3B0SW5DaGVja09uQWNjZXNzQ2hlY2tFbmFibGVkICYmIFwiL2FjY2Vzcy9jaGVja1wiID09PSBlICYmIHBuLmRvdWJsZU9wdEluLmNoZWNrKCk7IH0oZSk7XG4gICAgICAgIHZhciBoID0geyBkYXRhVHlwZTogXCJqc29ucFwiIH07XG4gICAgICAgIGlmICh1KSB7XG4gICAgICAgICAgICB2YXIgdyA9IG8uYWlkO1xuICAgICAgICAgICAgZGVsZXRlIG8uYWlkLCB2ID0gXCJhaWQ9XCIgKyB3LCBPYmplY3QuYXNzaWduKGgsIHsgdHlwZTogXCJQT1NUXCIsIGRhdGFUeXBlOiBcImpzb25cIiwgZGF0YTogbyB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICBvLmNhbGxBcGlKc29ucCA9ICEwLCB2ID0gbi5wYXJhbShvKTtcbiAgICAgICAgZCArPSBcIj9cIiArIHYsIGgudXJsID0gZCwgbCAmJiAoaC5hc3luYyA9ICExKSwgaC5zdWNjZXNzID0gZnVuY3Rpb24gKGUpIHsgZihlKTsgfSwgaC5lcnJvciA9IGZ1bmN0aW9uIChlKSB7IHZhciBuID0geyBjb2RlOiA1MDMsIG1lc3NhZ2U6IFwiRXJyb3I6IFJlY2VpdmVkIGVycm9yIHdoZW4gcmVxdWVzdGluZyBBUEkgcmVzcG9uc2UgZnJvbSBVUkw6IFwiICsgZCB9OyB0LmxvZyhuLm1lc3NhZ2UpLCBmKG4pOyB9LCByLnJlcXVlc3QoaCk7XG4gICAgfVxuICAgIGVsc2VcbiAgICAgICAgZihnKTsgfSByZXR1cm4geyBuYW1lOiBcImFwaVwiLCBjYWxsQXBpOiBmdW5jdGlvbiAoZSwgbiwgdCwgciwgbywgaSkgeyByZXR1cm4gYyhlLCBuLCB0LCByLCBvLCBpKTsgfSwgZ2V0RW5kcG9pbnQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGEoKTsgfSwgZ2V0Q2FsbFBhcmFtczogZnVuY3Rpb24gKGUsIG4pIHsgcmV0dXJuIHMoZSwgbik7IH0gfTsgfSgpO1xuICAgIHBuLmNvbnRhaW5lci5yZWdpc3RlcihcImFwaVwiLCB7IHVzZVZhbHVlOiBJZSB9KSwgcG4uYXBpID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJhcGlcIik7XG4gICAgdmFyIFNlID0gZnVuY3Rpb24gKCkgeyB2YXIgZSwgbiwgdCwgciwgbywgaSwgYSwgcywgYywgbCwgdSwgZCA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwianFVdGlsc1wiKSwgcCA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwidXRpbFwiKSwgZiA9IHt9LCBtID0ge30sIGcgPSBbXSwgdiA9IHt9LCBoID0gKGUgPSB7fSwgaSA9IDEsIGEgPSB3aW5kb3csIHMgPSAhMSwgbCA9IFwiYWRkRXZlbnRMaXN0ZW5lclwiLCB1ID0gYVtjID0gXCJwb3N0TWVzc2FnZVwiXSwgZVtjXSA9IGZ1bmN0aW9uIChlLCBuLCB0KSB7IG4gJiYgKGUgPSBcInN0cmluZ1wiID09IHR5cGVvZiBlID8gZSA6IGQucGFyYW0oZSksIHQgPSB0IHx8IHBhcmVudCwgdSA/IHRbY10oZSwgbi5yZXBsYWNlKC8oW146XSs6XFwvXFwvW15cXC9dKykuKi8sIFwiJDFcIikpIDogbiAmJiAodC5sb2NhdGlvbiA9IG4ucmVwbGFjZSgvIy4qJC8sIFwiXCIpICsgXCIjXCIgKyArbmV3IERhdGUgKyBpKysgKyBcIiZcIiArIGUpKTsgfSwgZS5yZWNlaXZlTWVzc2FnZSA9IG8gPSBmdW5jdGlvbiAoZSwgaSwgYykgeyB1ID8gKGUgJiYgKHIgJiYgbygpLCByID0gZnVuY3Rpb24gKG4pIHsgaWYgKFwic3RyaW5nXCIgPT0gdHlwZW9mIGkgJiYgbi5vcmlnaW4gIT09IGkgfHwgZC5pc0Z1bmN0aW9uKGkpICYmIGkobi5vcmlnaW4pID09PSBzKVxuICAgICAgICByZXR1cm4gczsgZShuKTsgfSksIGFbbF0gPyBhW2UgPyBsIDogXCJyZW1vdmVFdmVudExpc3RlbmVyXCJdKFwibWVzc2FnZVwiLCByLCBzKSA6IGFbZSA/IFwiYXR0YWNoRXZlbnRcIiA6IFwiZGV0YWNoRXZlbnRcIl0oXCJvbm1lc3NhZ2VcIiwgcikpIDogKG4gJiYgY2xlYXJJbnRlcnZhbChuKSwgbiA9IG51bGwsIGUgJiYgKGMgPSBcIm51bWJlclwiID09IHR5cGVvZiBpID8gaSA6IFwibnVtYmVyXCIgPT0gdHlwZW9mIGMgPyBjIDogMTAwLCBuID0gc2V0SW50ZXJ2YWwoKGZ1bmN0aW9uICgpIHsgdmFyIG4gPSBkb2N1bWVudC5sb2NhdGlvbi5oYXNoLCByID0gL14jP1xcZCsmLzsgbiAhPT0gdCAmJiByLnRlc3QobikgJiYgKHQgPSBuLCBlKHsgZGF0YTogbi5yZXBsYWNlKHIsIFwiXCIpIH0pKTsgfSksIGMpKSk7IH0sIGUpOyB2YXIgdyA9IGZ1bmN0aW9uIChlLCBuLCB0KSB7IHQgJiYgXyh0KSAmJiAhKHQgaW4gbSkgPyBwLmVycm9yKFwiQ2Fubm90IHNlbmQgbWVzc2FnZSB0byB1bm1hbmFnZWQgaWZyYW1lOiBcIiArIHQpIDogdCAmJiBtW3RdLmVsZW1lbnQgJiYgKFwicG9wdXBcIiA9PT0gbVt0XS5jb25maWcuZGlzcGxheU1vZGUgfHwgXCJwb3B1cFwiICE9PSBtW3RdLmNvbmZpZy5kaXNwbGF5TW9kZSAmJiBtW3RdLmVsZW1lbnQuY29udGVudFdpbmRvdyA/IHkoZSwgbiwgdCkgOiAoZy5wdXNoKHsgZXZlbnQ6IGUsIHBhcmFtczogbiwgcmVjaXBpZW50OiB0IH0pLCBkLm9uKG1bdF0uZWxlbWVudCwgXCJsb2FkXCIsIGZ1bmN0aW9uIChlKSB7IHJldHVybiBmdW5jdGlvbiAoKSB7IHZhciBuID0gZy5maWx0ZXIoKGZ1bmN0aW9uIChuKSB7IHJldHVybiBuLnJlY2lwaWVudCA9PT0gZTsgfSkpOyBnID0gZy5maWx0ZXIoKGZ1bmN0aW9uIChuKSB7IHJldHVybiBuLnJlY2lwaWVudCAhPT0gZTsgfSkpOyBmb3IgKHZhciB0ID0gbi5sZW5ndGg7IHQtLTspIHtcbiAgICAgICAgdmFyIHIgPSBuLnBvcCgpO1xuICAgICAgICB5KHIuZXZlbnQsIHIucGFyYW1zLCByLnJlY2lwaWVudCk7XG4gICAgfSB9OyB9KHQpKSkpOyB9LCB5ID0gZnVuY3Rpb24gKGUsIG4sIHQpIHsgdmFyIHIsIG8gPSB7fSwgaSA9IFwicG9wdXBcIiA9PT0gbVt0XS5jb25maWcuZGlzcGxheU1vZGUgPyBcIm9wZW5lclwiIDogXCJwYXJlbnRcIjsgby5zZW5kZXIgPSBfKHQpID8gaSA6IHQsIG8ucmVjaXBpZW50ID0gXyh0KSA/IHQgOiBpLCBvLmV2ZW50ID0gZSwgby5wYXJhbXMgPSBuOyB2YXIgYSA9IG1bdF0uZWxlbWVudDsgciA9IFwicG9wdXBcIiA9PT0gbVt0XS5jb25maWcuZGlzcGxheU1vZGUgPyBtW3RdLmNvbnRhaW5lciA6IGEgJiYgYS5jb250ZW50V2luZG93ID8gYS5jb250ZW50V2luZG93IDogYSAmJiBcIltvYmplY3QgV2luZG93XVwiID09PSBhLnRvU3RyaW5nKCkgPyBtW3RdLmVsZW1lbnQgOiB3aW5kb3dbaV0sIGgucG9zdE1lc3NhZ2UoSlNPTi5zdHJpbmdpZnkobyksIGZbdF0ucG9zdE1lc3NhZ2VVcmwsIHIpOyB9OyB2YXIgYiA9IGZ1bmN0aW9uIChlKSB7IGZbZS5pZnJhbWVJZF0gPSB7IGlmcmFtZUNvbmZpZzogbnVsbCwgcmVjZWl2ZTogbnVsbCwgcG9zdE1lc3NhZ2VVcmw6IG51bGwsIGluaXRpYWxpemVkTGlzdGVuZXI6ICExLCBpbml0aWFsaXplZEtleXN0cm9rZUhhbmRsZXI6ICExIH0sIG1bZS5pZnJhbWVJZF0gPSBlOyB9LCBrID0gZnVuY3Rpb24gKGUpIHsgcmV0dXJuICEoIWZbZV0gfHwgIWZbZV0uaWZyYW1lQ29uZmlnKTsgfSwgXyA9IGZ1bmN0aW9uIChlKSB7IHJldHVybiAhZltlXSB8fCAhZltlXS5pZnJhbWVDb25maWc7IH0sIEMgPSBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IEkoZSk7IHJldHVybiBuLnNob3dDbG9zZUJ1dHRvbiAmJiBcImlubGluZVwiICE9PSBuLmRpc3BsYXlNb2RlOyB9LCBJID0gZnVuY3Rpb24gKGUpIHsgdmFyIG4gPSBmW2VdLCB0ID0gbiAmJiBuLmlmcmFtZUNvbmZpZyAmJiBuLmlmcmFtZUNvbmZpZy5pZnJhbWU7IHJldHVybiB0ICYmIHQuY29uZmlnOyB9OyBmdW5jdGlvbiBTKGUpIHsgdmFyIG4sIHQsIHIsIG8sIGksIGEsIHMgPSAhMTsgdHJ5IHtcbiAgICAgICAgbiA9IEpTT04ucGFyc2UoZS5kYXRhKTtcbiAgICB9XG4gICAgY2F0Y2ggKHQpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHIgPSBlLmRhdGEsIGkgPSB7fSwgYSA9IHsgdHJ1ZTogITAsIGZhbHNlOiAhMSwgbnVsbDogbnVsbCB9LCByLnJlcGxhY2UoL1xcKy9nLCBcIiBcIikuc3BsaXQoXCImXCIpLmZvckVhY2goKGZ1bmN0aW9uIChlLCBuKSB7IHZhciB0ID0gbi5zcGxpdChcIj1cIiksIHIgPSBcIlwiOyB0cnkge1xuICAgICAgICAgICAgICAgIHIgPSBkZWNvZGVVUklDb21wb25lbnQodFswXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH0gdmFyIHMsIGMgPSBpLCBsID0gMCwgdSA9IHIuc3BsaXQoXCJdW1wiKSwgZCA9IHUubGVuZ3RoIC0gMTsgaWYgKC9cXFsvLnRlc3QodVswXSkgJiYgL1xcXSQvLnRlc3QodVtkXSkgPyAodVtkXSA9IHVbZF0ucmVwbGFjZSgvXFxdJC8sIFwiXCIpLCBkID0gKHUgPSB1LnNoaWZ0KCkuc3BsaXQoXCJbXCIpLmNvbmNhdCh1KSkubGVuZ3RoIC0gMSkgOiBkID0gMCwgMiA9PT0gdC5sZW5ndGgpXG4gICAgICAgICAgICAgICAgaWYgKHMgPSBkZWNvZGVVUklDb21wb25lbnQodFsxXSksIG8gJiYgKHMgPSBzICYmICFpc05hTihzKSA/ICtzIDogXCJ1bmRlZmluZWRcIiA9PT0gcyA/IHZvaWQgMCA6IHZvaWQgMCAhPT0gYVtzXSA/IGFbc10gOiBzKSwgZClcbiAgICAgICAgICAgICAgICAgICAgZm9yICg7IGwgPD0gZDsgbCsrKVxuICAgICAgICAgICAgICAgICAgICAgICAgYyA9IGNbciA9IFwiXCIgPT09IHVbbF0gPyBjLmxlbmd0aCA6IHVbbF1dID0gbCA8IGQgPyBjW3JdIHx8ICh1W2wgKyAxXSAmJiBpc05hTih1W2wgKyAxXSkgPyB7fSA6IFtdKSA6IHM7XG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICBBcnJheS5pc0FycmF5KGlbcl0pID8gaVtyXS5wdXNoKHMpIDogdm9pZCAwICE9PSBpW3JdID8gaVtyXSA9IFtpW3JdLCBzXSA6IGlbcl0gPSBzO1xuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIHIgJiYgKGlbcl0gPSBvID8gdm9pZCAwIDogXCJcIik7IH0pKSwgKG4gPSBpKSAmJiAocyA9ICEwKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAobikge1xuICAgICAgICAgICAgcmV0dXJuIHZvaWQgcC5kZWJ1ZyhcIkVycm9yIHBhcnNpbmcgcG9zdE1lc3NhZ2U6IFwiICsgZS5kYXRhKTtcbiAgICAgICAgfVxuICAgIH0gaWYgKHgobiksIHMpIHtcbiAgICAgICAgdmFyIGM7XG4gICAgICAgIGZvciAodmFyIGwgaW4gbSlcbiAgICAgICAgICAgICh0ID0gbVtsXSkuY29uZmlnLmlzQ3VydGFpbiAmJiAoYyA9ICEwLCB0LmNvbmZpZy5wYXJlbnQgJiYgZlt0LmNvbmZpZy5wYXJlbnRdLnJlY2VpdmUgJiYgZlt0LmNvbmZpZy5wYXJlbnRdLnJlY2VpdmUobiksIGZbbF0ucmVjZWl2ZSAmJiBmW2xdLnJlY2VpdmUobikpO1xuICAgICAgICBjIHx8IHAuZGVidWcoXCJFcnJvciBwYXJzaW5nIHBvc3RNZXNzYWdlOiBcIiArIGUuZGF0YSk7XG4gICAgfVxuICAgIGVsc2UgaWYgKCFfKG4uc2VuZGVyKSB8fCBuLnNlbmRlciAmJiBuLnNlbmRlciBpbiBtKSB7XG4gICAgICAgIGlmIChwLmRlYnVnKChrKG4uc2VuZGVyKSA/IFwiaWZyYW1lKFwiICsgbi5yZWNpcGllbnQgOiBcInRoZSBwYXJlbnRcIikgKyBcIikgcmVjZWl2ZWQgZXZlbnQgJ1wiICsgbi5ldmVudCArIFwiJyBmcm9tIGlmcmFtZShcIiArIG4uc2VuZGVyICsgXCIpXCIsIG4pLCBmW24uc2VuZGVyXS5yZWNlaXZlICYmIGZbbi5zZW5kZXJdLnJlY2VpdmUobiksIG1bbi5zZW5kZXJdICYmICh0ID0gbVtuLnNlbmRlcl0pLmNvbmZpZy5wYXJlbnQgJiYgZlt0LmNvbmZpZy5wYXJlbnRdLnJlY2VpdmUpIHtcbiAgICAgICAgICAgIG4uc2VuZGVyID0gdC5jb25maWcucGFyZW50LCBmW3QuY29uZmlnLnBhcmVudF0ucmVjZWl2ZShuLCAhMCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZVxuICAgICAgICBwLmRlYnVnKFwiUmVjZWl2ZWQgbWVzc2FnZSBmcm9tIHVubWFuYWdlZCBpZnJhbWU6IFwiICsgbi5zZW5kZXIpOyB9IHZhciB4ID0gZnVuY3Rpb24gKGUpIHsgKHZbZS5ldmVudF0gfHwgW10pLmZvckVhY2goKGZ1bmN0aW9uIChuKSB7IG4oZSk7IH0pKTsgfTsgcmV0dXJuIHsgbmFtZTogXCJwb3N0bWVzc2FnZVwiLCBpbml0OiBmdW5jdGlvbiAoZSwgbikgeyBpZiAoYihlLmlmcmFtZSksIGUucG9zdE1lc3NhZ2VVcmwpIHtcbiAgICAgICAgICAgIGlmIChlLmlmcmFtZS5pZnJhbWVJZCkge1xuICAgICAgICAgICAgICAgIGZbZS5pZnJhbWUuaWZyYW1lSWRdLmluaXRpYWxpemVkS2V5c3Ryb2tlSGFuZGxlciB8fCAoZltlLmlmcmFtZS5pZnJhbWVJZF0uaW5pdGlhbGl6ZWRLZXlzdHJva2VIYW5kbGVyID0gITAsIGQuZGVsZWdhdGUod2luZG93LCBcIiNcIiArIGUuaWZyYW1lLmlmcmFtZUlkLCBcImtleXVwXCIsIChmdW5jdGlvbiAoZSkgeyByZXR1cm4gZnVuY3Rpb24gKGUpIHsgMjcgPT09IGUua2V5Q29kZSAmJiBrKGUuZGF0YS5pZnJhbWVJZCkgJiYgQyhlLmRhdGEuaWZyYW1lSWQpICYmIHcoXCJjbG9zZVwiLCBudWxsLCBlLmRhdGEuaWZyYW1lSWQpOyB9KGUpOyB9KSkpLCBmW2UuaWZyYW1lLmlmcmFtZUlkXS5wb3N0TWVzc2FnZVVybCA9IGUucG9zdE1lc3NhZ2VVcmwsIGZbZS5pZnJhbWUuaWZyYW1lSWRdLmluaXRpYWxpemVkTGlzdGVuZXIgfHwgKGZbZS5pZnJhbWUuaWZyYW1lSWRdLmluaXRpYWxpemVkTGlzdGVuZXIgPSAhMCwgZltlLmlmcmFtZS5pZnJhbWVJZF0ucmVjZWl2ZSA9IGUucmVjZWl2ZSwgaC5yZWNlaXZlTWVzc2FnZShTKSksIGZbZS5pZnJhbWUuaWZyYW1lSWRdLmlmcmFtZUNvbmZpZyA9IGU7XG4gICAgICAgICAgICAgICAgdmFyIHQgPSBuIHx8IHt9O1xuICAgICAgICAgICAgICAgIHQuaGVpZ2h0ID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50Lm9mZnNldEhlaWdodCwgdC53aWR0aCA9IGUuaWZyYW1lUGFyYW1zICYmIGUuaWZyYW1lUGFyYW1zLndpZHRoID8gZS5pZnJhbWVQYXJhbXMud2lkdGggOiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQub2Zmc2V0V2lkdGgsIHcoXCJsb2FkZWRcIiwgdCwgZS5pZnJhbWUuaWZyYW1lSWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHAuZXJyb3IoXCJNdXN0IHNwZWNpZnkgcG9zdE1lc3NhZ2VVcmwgdG8gc2VuZCBhbmQgcmVjZWl2ZSBwb3N0TWVzc2FnZXNcIik7IH0sIF9fcHJvdGVjdGVkX186IHsgaXNJZnJhbWVNYW5hZ2VkOiBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IG1bZV07IHJldHVybiBuICYmIF8obik7IH0gfSwgc2VuZDogdywgcmVtb3ZlSWZyYW1lOiBmdW5jdGlvbiAoZSkgeyBkZWxldGUgbVtlXSwgZGVsZXRlIGZbZV07IH0sIGJyb2FkY2FzdDogZnVuY3Rpb24gKGUsIG4sIHQpIHsgZm9yICh2YXIgciBpbiBtKVxuICAgICAgICAgICAgbS5oYXNPd25Qcm9wZXJ0eShyKSAmJiByID09PSB0IHx8IHcoZSwgbiwgcik7IH0sIHN1YnNjcmliZTogZnVuY3Rpb24gKGUsIG4pIHsgdltlXSA9IHZbZV0gfHwgW10sIHZbZV0ucHVzaChuKTsgfSwgdW5zdWJzY3JpYmU6IGZ1bmN0aW9uIChlLCBuKSB7IHZbZV0gaW5zdGFuY2VvZiBBcnJheSAmJiAodltlXSA9IHZbZV0uZmlsdGVyKChmdW5jdGlvbiAoZSkgeyByZXR1cm4gZSAhPT0gbjsgfSkpKTsgfSB9OyB9KCk7XG4gICAgcG4uY29udGFpbmVyLnJlZ2lzdGVyKFwicG9zdG1lc3NhZ2VcIiwgeyB1c2VWYWx1ZTogU2UgfSksIHBuLnBvc3RtZXNzYWdlID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJwb3N0bWVzc2FnZVwiKTtcbiAgICB2YXIgeGUgPSBmdW5jdGlvbiAoKSB7IHZhciBlID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJqcVV0aWxzXCIpLCBuID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJ1dGlsXCIpLCB0ID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJwb3N0bWVzc2FnZVwiKTsgcmV0dXJuIHsgbmFtZTogXCJldmVudFV0aWxzXCIsIGNyZWF0ZUV2ZW50TWFuYWdlcjogZnVuY3Rpb24gKHIpIHsgdmFyIG8sIGkgPSB7fTsgZm9yIChvID0gMDsgbyA8IHIubGVuZ3RoOyBvKyspXG4gICAgICAgICAgICBpW3Jbb11dID0gW107IHZhciBhID0geyBhZGRFdmVudDogZnVuY3Rpb24gKGUpIHsgdm9pZCAwID09PSBpW2VdICYmIChpW2VdID0gW10pOyB9LCBoYXNJZnJhbWVDYWxsYmFjazogZnVuY3Rpb24gKGUsIG4pIHsgdmFyIHQsIHI7IGlmIChpW2VdICYmIGlbZV0ubGVuZ3RoID4gMClcbiAgICAgICAgICAgICAgICBmb3IgKHIgPSAwLCB0ID0gbnVsbDsgciA8IGlbZV0ubGVuZ3RoOyArK3IpXG4gICAgICAgICAgICAgICAgICAgIGlmIChcIm9iamVjdFwiID09IHR5cGVvZiAodCA9IGlbZV1bcl0pICYmIG4gPT09IHQuaWZyYW1lSWQpXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gITA7IHJldHVybiAhMTsgfSwgaGFzQ2FsbGJhY2s6IGZ1bmN0aW9uIChlKSB7IHJldHVybiBpW2VdICYmIGlbZV0ubGVuZ3RoID4gMDsgfSwgcmVnaXN0ZXJDYWxsYmFjazogZnVuY3Rpb24gKGUsIHQpIHsgdmFyIHIsIG8sIGEsIHMgPSBcInN0cmluZ1wiID09IHR5cGVvZiBlID8gZSA6IG51bGwsIGMgPSBcIm9iamVjdFwiID09IHR5cGVvZiBlID8gZSA6IG51bGw7IGlmIChzKSB7XG4gICAgICAgICAgICAgICAgaWYgKHIgPSBcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIHQgPyB0IDogbnVsbCwgdm9pZCAwID09PSBpW3NdKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgaVtzXS5wdXNoKHIpO1xuICAgICAgICAgICAgfSBpZiAoYylcbiAgICAgICAgICAgICAgICBmb3IgKGEgaW4gbyA9IFwic3RyaW5nXCIgPT0gdHlwZW9mIHQgPyB0IDogbnVsbCwgaSlcbiAgICAgICAgICAgICAgICAgICAgXCJmdW5jdGlvblwiID09IHR5cGVvZiBjW2FdICYmIChuLmRlYnVnKFwiUmVnaXN0ZXJpbmcgXCIgKyBhICsgXCIgY2FsbGJhY2sgZm9yIGlmcmFtZSBcIiArIG8pLCBpW2FdLnB1c2goeyBpZnJhbWVJZDogbywgY2FsbGJhY2s6IGNbYV0gfSkpOyB9LCBmaXJlQ2FsbGJhY2tzOiBmdW5jdGlvbiAoZSwgbiwgdCwgcikgeyByZXR1cm4gYS5maXJlKHQsIGUsIHIsIG4pOyB9LCBmaXJlOiBmdW5jdGlvbiAociwgbywgYSwgcywgYywgbCkgeyB2YXIgdSwgZCwgcCwgZiA9ICExLCBtID0gW107IHMgJiYgbS5wdXNoKHMpLCBjICYmIG0ucHVzaChjKSwgbCAmJiBtLnB1c2gobCk7IHZhciBnID0gcyAmJiBzLnJlc3VsdENhbGxiYWNrSWQsIHYgPSBmdW5jdGlvbiAodCkgeyBpZiAoYSlcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICBpZiAobS5sZW5ndGggPiAxKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQuYXBwbHkobnVsbCwgbSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChcImxvZ2luUmVxdWlyZWRcIiA9PT0gbykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGkgPSBlLmRlZXBFeHRlbmQoe30sIHQudGVybSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGVsZXRlIHQudGVybSwgZCh0LCByLCBpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZCh0LCByKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgbi5kZWJ1ZyhlKTtcbiAgICAgICAgICAgICAgICB9IH07IGlmICh2b2lkIDAgIT09IGlbb10pIHtcbiAgICAgICAgICAgICAgICBmb3IgKHAgPSAwLCB1ID0gbnVsbCwgZCA9IG51bGw7IHAgPCBpW29dLmxlbmd0aDsgKytwKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIChkID0gaVtvXVtwXSkpXG4gICAgICAgICAgICAgICAgICAgICAgICBuLmRlYnVnKFwiZmlyaW5nIGNhbGxiYWNrIGZvciBldmVudCAnXCIgKyBvICsgXCInIGZyb20gaWZyYW1lKFwiICsgciArIFwiKVwiKSwgdSA9IHYocyksIGYgPSAhMDtcbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoXCJvYmplY3RcIiA9PSB0eXBlb2YgZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHIgIT09IGQuaWZyYW1lSWQpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgICAgICAgICBuLmRlYnVnKFwiZmlyaW5nIGNhbGxiYWNrIGZvciBldmVudCAnXCIgKyBvICsgXCInIGZyb20gaWZyYW1lKFwiICsgciArIFwiKVwiKSwgZCA9IGQuY2FsbGJhY2ssIHUgPSB2KHMpLCBmID0gITA7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZyAmJiAocy5yZXN1bHQgPSB1LCBzLmV2ZW50ID0gbywgdC5zZW5kKFwicmVzdWx0Q2FsbGJhY2tcIiwgcywgcikpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gIWYgJiYgZyAmJiAocy5jYWxsYmFja05vdEZvdW5kID0gITAsIHMuZXZlbnQgPSBvLCB0LnNlbmQoXCJyZXN1bHRDYWxsYmFja1wiLCBzLCByKSksIHU7XG4gICAgICAgICAgICB9IH0sIGZpcmVDYWxsYmFja3NBbmRTdG9wT25GaXJzdEZhbHNlOiBmdW5jdGlvbiAoZSwgdCwgciwgbykgeyBmb3IgKHZhciBhID0gW10sIHMgPSA0OyBzIDwgYXJndW1lbnRzLmxlbmd0aDsgcysrKVxuICAgICAgICAgICAgICAgIGFbcyAtIDRdID0gYXJndW1lbnRzW3NdOyBpZiAodm9pZCAwID09PSBpW2VdKVxuICAgICAgICAgICAgICAgIHJldHVybiAhMDsgZm9yICh2YXIgYyA9ICEwLCBsID0gMDsgbCA8IGlbZV0ubGVuZ3RoOyBsKyspIHtcbiAgICAgICAgICAgICAgICB2YXIgdSA9IGlbZV1bbF07XG4gICAgICAgICAgICAgICAgaWYgKFwiZnVuY3Rpb25cIiA9PSB0eXBlb2YgdSkge1xuICAgICAgICAgICAgICAgICAgICBuLmRlYnVnKFwiZmlyaW5nIGNhbGxiYWNrIGZvciBldmVudCAnXCIgKyBlICsgXCInXCIpO1xuICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkLnB1c2godCksIGQucHVzaChyKSwgZC5wdXNoKG8pLCBkID0gZC5jb25jYXQoW10uc2xpY2UuY2FsbChhKSksICExID09PSB1LmFwcGx5KG51bGwsIGQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbi5kZWJ1ZyhcImNhbGxiYWNrIGZvciBldmVudCAnXCIgKyBlICsgXCInIHJldHVybmVkIGZhbHNlXCIpLCBjID0gITE7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY2F0Y2ggKHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG4uZGVidWcoXCJmaXJpbmcgY2FsbGJhY2sgZm9yIGV2ZW50ICdcIiArIGUgKyBcIicgZmFpbGVkXCIsIHQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSByZXR1cm4gYzsgfSB9OyByZXR1cm4gYTsgfSB9OyB9KCk7XG4gICAgcG4uY29udGFpbmVyLnJlZ2lzdGVyKFwiZXZlbnRVdGlsc1wiLCB7IHVzZVZhbHVlOiB4ZSB9KSwgcG4uZXZlbnRVdGlscyA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwiZXZlbnRVdGlsc1wiKTtcbiAgICB2YXIgUGUgPSBmdW5jdGlvbiAoKSB7IHZhciBlID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJ1dGlsXCIpLCBuID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJhcGlcIiksIHQgPSBwbi5jb250YWluZXIucmVzb2x2ZShcImV2ZW50VXRpbHNcIiksIHIgPSBwbi5jb250YWluZXIucmVzb2x2ZShcImxvY2FsU3RvcmFnZVwiKSwgbyA9IHQuY3JlYXRlRXZlbnRNYW5hZ2VyKFtcInVzZXJDaGFuZ2VkXCIsIFwibG9nb3V0XCJdKSwgaSA9IFwiamFucmFpblwiLCBhID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gZS5nZXRVc2VyVG9rZW5Db29raWUoKTsgfSwgcyA9IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSBhKCk7IHJldHVybiAhISh2b2lkIDAgIT09IGUgJiYgZSAmJiBlLmxlbmd0aCA+PSAwKTsgfSwgYyA9ICExLCBsID0gITEsIHUgPSB7IG9uQ2FwdHVyZVNlc3Npb25DcmVhdGVkOiBbXSB9LCBkID0geyBsb2dpblJlcXVpcmVkU2NyZWVuOiBcInNpZ25JblwiLCBhcHBOYW1lOiBudWxsLCBhcHBJZDogbnVsbCwgY2xpZW50SWQ6IG51bGwsIHNldHRpbmdzOiBudWxsLCBkaXNhYmxlTG9nb3V0OiAhMSwgc3RhcnRDYXB0dXJlOiAhMSB9LCBwID0geyByZWdpc3RlcjogXCJ0cmFkaXRpb25hbFJlZ2lzdHJhdGlvblwiLCBsb2dpbjogXCJzaWduSW5cIiB9OyB2YXIgZiA9IGZ1bmN0aW9uIChlKSB7IHJldHVybiBlICYmIHAuaGFzT3duUHJvcGVydHkoZS5zdGFydFNjcmVlbikgPyBwW2Uuc3RhcnRTY3JlZW5dIDogZC5sb2dpblJlcXVpcmVkU2NyZWVuOyB9OyB2YXIgbSA9IGZ1bmN0aW9uICgpIHsgZC5kaXNhYmxlTG9nb3V0IHx8IGUuc2V0QWNjZXNzVG9rZW5MaXN0Q29va2llKHZvaWQgMCwgdm9pZCAwLCAhMCk7IH0sIGcgPSAhMCwgdiA9IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSB3aW5kb3cuamFucmFpbjsgcmV0dXJuIGUgJiYgZS5jYXB0dXJlICYmIGUuY2FwdHVyZS51aSAmJiBlLmNhcHR1cmUudWkuaGFzQWN0aXZlU2Vzc2lvbigpOyB9OyBmdW5jdGlvbiBoKCkgeyBlLmxvZyhcIkpBTlJBSU46XCIsIFwiUHJvY2Vzc2luZyBqYW5yYWluIHVzZXJcIiksIGcgPyBnID0gITEgOiBlLnN0YXJ0Q2FsbChcInJlZnJlc2hVc2VyVG9rZW5cIiksIGUubG9nKFwiSkFOUkFJTjpcIiwgXCJoYXNBY3RpdmVTZXNzaW9uOlwiICsgdigpKTsgdmFyIHQgPSB3KCk7IGlmICghdigpKVxuICAgICAgICByZXR1cm4gZS5sb2coXCJKQU5SQUlOOlwiLCBcIk5vIHRva2VuIGZvdW5kLiAgRG9uZSBwcm9jZXNzaW5nIHVzZXJcIiksIG0oKSwgdm9pZCBlLmRvbmVDYWxsKFwicmVmcmVzaFVzZXJUb2tlblwiKTsgaWYgKHMoKSlcbiAgICAgICAgcmV0dXJuIGUubG9nKFwiSkFOUkFJTjpcIiwgXCJVc2luZyBfX3V0LiAgRG9uZSBwcm9jZXNzaW5nIHVzZXJcIiksIHZvaWQgZS5kb25lQ2FsbChcInJlZnJlc2hVc2VyVG9rZW5cIik7IHZhciByID0geyBqYW5yYWluX2NhcHR1cmVfdG9rZW46IHQsIHVybDogZS5wcmVwYXJlVXJsUGFyYW1ldGVyKHdpbmRvdy5sb2NhdGlvbi5ocmVmKSB9OyBuLmNhbGxBcGkoXCIvYW5vbi9qYW5yYWluL3ZlcmlmeUFjY291bnRJbmZvXCIsIHIsIChmdW5jdGlvbiAobikgeyBpZiAobiAmJiBuLmFjY2VzcylcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGUubG9nKFwiSkFOUkFJTjpcIiwgXCJWZXJpZnkgc3VjY2Vzcy4gIERvbmUgcHJvY2Vzc2luZyB1c2VyXCIpLCBlLnNldEFjY2Vzc1Rva2VuTGlzdENvb2tpZShuLmFjY2Vzcy5hY2Nlc3NfdG9rZW4sIG4uYWNjZXNzLnVzZXJfdG9rZW4pO1xuICAgICAgICAgICAgdmFyIHQgPSB7IGFjY2Vzc190b2tlbjogbi5hY2Nlc3MuYWNjZXNzX3Rva2VuLCB1c2VyX3Rva2VuOiBuLmFjY2Vzcy51c2VyX3Rva2VuIH07XG4gICAgICAgICAgICBuLmFjY2Vzcy51c2VyICYmICh0LnVzZXIgPSB7IHVpZDogbi5hY2Nlc3MudXNlci51aWQsIGVtYWlsOiBuLmFjY2Vzcy51c2VyLmVtYWlsLCBmaXJzdE5hbWU6IG4uYWNjZXNzLnVzZXIuZmlyc3RfbmFtZSwgbGFzdE5hbWU6IG4uYWNjZXNzLnVzZXIubGFzdF9uYW1lLCB2YWxpZDogbi5hY2Nlc3MudXNlci52YWxpZCB9KSwgZnVuY3Rpb24gKGUsIG4pIHsgaWYgKHZvaWQgMCAhPT0gdVtlXSAmJiAwICE9PSB1W2VdLmxlbmd0aClcbiAgICAgICAgICAgICAgICBmb3IgKHZhciB0ID0gMDsgdCA8IHVbZV0ubGVuZ3RoOyArK3QpXG4gICAgICAgICAgICAgICAgICAgIHVbZV1bdF0uYXBwbHkobnVsbCwgYXJndW1lbnRzKTsgfShcIm9uQ2FwdHVyZVNlc3Npb25DcmVhdGVkXCIsIHQpLCBvLmZpcmVDYWxsYmFja3MoXCJ1c2VyQ2hhbmdlZFwiLCB0LCB2b2lkIDAsICEwKTtcbiAgICAgICAgfVxuICAgICAgICBmaW5hbGx5IHtcbiAgICAgICAgICAgIGUuZG9uZUNhbGwoXCJyZWZyZXNoVXNlclRva2VuXCIpO1xuICAgICAgICB9XG4gICAgZWxzZVxuICAgICAgICBlLmxvZyhcIkpBTlJBSU46XCIsIFwiVmVyaWZ5IGZhaWxlZFwiKTsgfSkpOyB9IHZhciB3ID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gci5nZXQoXCJqYW5yYWluQ2FwdHVyZVRva2VuXCIpOyB9LCB5ID0gZnVuY3Rpb24gKCkgeyB2YXIgbiA9IHdpbmRvdy5qYW5yYWluOyBuLmV2ZW50cy5vblByb3ZpZGVyTG9nb3V0Q29tcGxldGUuYWRkSGFuZGxlcigoZnVuY3Rpb24gKCkgeyBtKCk7IH0pKSwgbi5ldmVudHMub25DYXB0dXJlU2Vzc2lvbkVuZGVkLmFkZEhhbmRsZXIoKGZ1bmN0aW9uIChuKSB7IGUubG9nKFwiSkFOUkFJTjogRXZlbnRzIHJlY2VpdmVkIGZvciBsb2dvdXRcIiwgbiksIG0oKTsgfSkpLCBiKCk7IH0sIGIgPSBmdW5jdGlvbiAoKSB7IGlmICh2KCkpXG4gICAgICAgIHJldHVybiBlLmxvZyhcIkpBTlJBSU46XCIsIFwiRm91bmQgZWFybHkgYWN0aXZlIHNlc3Npb24gdmlhIGZ1bmN0aW9uXCIpLCB2b2lkIGgoKTsgaWYgKCF2KCkgJiYgIXMoKSAmJiAhdygpKVxuICAgICAgICByZXR1cm4gZS5sb2coXCJKQU5SQUlOOlwiLCBcIm5vdCBmb3VuZCBfX3V0IGNvb2tpZSBhbmQgamFucmFpbiB0b2tlblwiKSwgdm9pZCBoKCk7IHZhciBuID0gITEsIHQgPSB3aW5kb3cuamFucmFpbjsgdC5ldmVudHMub25DYXB0dXJlU2Vzc2lvbkZvdW5kLmFkZEhhbmRsZXIoKGZ1bmN0aW9uICh0KSB7IGsoKSA/IG4gJiYgKGUubG9nKFwiSkFOUkFJTjogRXZlbnRzIHJlY2VpdmVkIGZvciBsb2dnZWQgaW4gdXNlclwiLCB0KSwgaCgpKSA6IGgoKTsgfSkpLCB0LmV2ZW50cy5vbkNhcHR1cmVTZXNzaW9uTm90Rm91bmQuYWRkSGFuZGxlcigoZnVuY3Rpb24gKHQpIHsgaygpID8gbiAmJiAoZS5sb2coXCJKQU5SQUlOOiBFdmVudHMgcmVjZWl2ZWQgZm9yIGxvZ2dlZCBvdXQgdXNlclwiLCB0KSwgaCgpKSA6IGgoKTsgfSkpLCB0LmV2ZW50cy5vbkNhcHR1cmVGZWRlcmF0ZU5vTG9naW4uYWRkSGFuZGxlcigoZnVuY3Rpb24gKGUpIHsgbiA9IGU7IH0pKSwgdC5ldmVudHMub25DYXB0dXJlRmVkZXJhdGVMb2dpbi5hZGRIYW5kbGVyKChmdW5jdGlvbiAobikgeyBlLmxvZyhcIkpBTlJBSU46IEV2ZW50cyByZWNlaXZlZCBmb3IgU1NPIGxvZ2luXCIsIG4pLCBoKCk7IH0pKTsgfSwgayA9IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSB3aW5kb3cuamFucmFpbjsgcmV0dXJuIGUgJiYgZS5zZXR0aW5ncyAmJiBlLnNldHRpbmdzLmNhcHR1cmUgJiYgZS5zZXR0aW5ncy5jYXB0dXJlLmZlZGVyYXRlOyB9OyBmdW5jdGlvbiBfKGUsIG4pIHsgaWYgKCFjKVxuICAgICAgICB0aHJvdyBcIkphbnJhaW4gaXMgbm90IGNvbmZpZ3VyZWRcIjsgdmFyIHQgPSAwOyAhZnVuY3Rpb24gcigpIHsgdmFyIG8gPSB3aW5kb3cuamFucmFpbjsgaWYgKGwpXG4gICAgICAgIG8uZXZlbnRzW2VdLmFkZEhhbmRsZXIoKGZ1bmN0aW9uIChlKSB7IG4oZSk7IH0pKTtcbiAgICBlbHNlIHtcbiAgICAgICAgaWYgKHQgPiAxMDApXG4gICAgICAgICAgICB0aHJvdyBcIkphbnJhaW4gaXMgbm90IGluaXRpYWxpemVkXCI7XG4gICAgICAgIHQrKywgd2luZG93LnNldFRpbWVvdXQociwgMTAwKTtcbiAgICB9IH0oKTsgfSByZXR1cm4geyBuYW1lOiBpLCBpc3Y6ICExLCBpbml0OiBmdW5jdGlvbiAobikgeyBpZiAoIWMpIHtcbiAgICAgICAgICAgIGlmICghbi5hcHBOYW1lIHx8ICFuLmFwcElkIHx8ICFuLmNsaWVudElkKVxuICAgICAgICAgICAgICAgIHRocm93IFwiTXVzdCBzcGVjaWZ5IGFwcE5hbWUsIGFwcElkLCBhbmQgY2xpZW50SWQgdG8gaW5pdGlhbGl6ZSBqYW5yYWluXCI7XG4gICAgICAgICAgICBmb3IgKHZhciB0IGluIGQpXG4gICAgICAgICAgICAgICAgdm9pZCAwICE9PSBuW3RdICYmIChkW3RdID0gblt0XSk7XG4gICAgICAgICAgICBpZiAobi5zZXR0aW5ncyAmJiAoZC5zZXR0aW5ncyA9IG4uc2V0dGluZ3MpLCBuLmxvZ2luUmVxdWlyZWRTY3JlZW4gJiYgKGQubG9naW5SZXF1aXJlZFNjcmVlbiA9IG4ubG9naW5SZXF1aXJlZFNjcmVlbiksIGQuc2V0dGluZ3MpIHtcbiAgICAgICAgICAgICAgICBcIm9iamVjdFwiICE9IHR5cGVvZiB3aW5kb3cuamFucmFpbiAmJiAod2luZG93LmphbnJhaW4gPSB7fSksIFwib2JqZWN0XCIgIT0gdHlwZW9mIHdpbmRvdy5qYW5yYWluLnNldHRpbmdzICYmICh3aW5kb3cuamFucmFpbi5zZXR0aW5ncyA9IHt9KTtcbiAgICAgICAgICAgICAgICB2YXIgciA9IHdpbmRvdy5qYW5yYWluO1xuICAgICAgICAgICAgICAgIHIuc2V0dGluZ3MgPSBkLnNldHRpbmdzLCBcIm9iamVjdFwiICE9IHR5cGVvZiB3aW5kb3cuamFucmFpbi5zZXR0aW5ncy5jYXB0dXJlICYmICh3aW5kb3cuamFucmFpbi5zZXR0aW5ncy5jYXB0dXJlID0ge30pLCByLnNldHRpbmdzLmFwcFVybCA9IFwiaHR0cHM6Ly9cIiArIGQuYXBwTmFtZSArIFwiLnJweG5vdy5jb21cIiwgci5zZXR0aW5ncy5jYXB0dXJlLmNhcHR1cmVTZXJ2ZXIgPSBcImh0dHBzOi8vXCIgKyBkLmFwcE5hbWUgKyBcIi5qYW5yYWluY2FwdHVyZS5jb21cIiwgci5zZXR0aW5ncy5jYXB0dXJlLmFwcElkID0gZC5hcHBJZCwgci5zZXR0aW5ncy5jYXB0dXJlLmNsaWVudElkID0gZC5jbGllbnRJZDtcbiAgICAgICAgICAgICAgICB2YXIgbywgaSA9IGQuYXBwTmFtZS5yZXBsYWNlKC9cXC4vZywgXCItXCIpLCBhID0gXCJodHRwOi8vd2lkZ2V0LWNkbi5ycHhub3cuY29tL2xvYWQvXCIgKyBpLCBzID0gXCJodHRwczovL3JweG5vdy5jb20vbG9hZC9cIiArIGk7XG4gICAgICAgICAgICAgICAgbyA9IGUuX19wcm90ZWN0ZWRfXy5pc0h0dHBzUHJvdG9jb2woKSA/IHMgOiBhLCBwbi5wdXNoKFtcImFkZEV4dGVybmFsTGlicmFyeVwiLCBvLCBmdW5jdGlvbiAoKSB7IHIucmVhZHkgPSAhMDsgfV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZS5sb2coXCJKQU5SQUlOOlwiLCBcInN0YXJ0IHJlZnJlc2ggdXNlciB0b2tlblwiKSwgZS5zdGFydENhbGwoXCJyZWZyZXNoVXNlclRva2VuXCIsIDNlNCksIGUud2FpdENhbGwoXCJyZWZyZXNoVXNlclRva2VuXCIsIChmdW5jdGlvbiAoKSB7IGUubG9nKFwiSkFOUkFJTjpcIiwgXCJlbmQgcmVmcmVzaCB1c2VyIHRva2VuXCIpOyB9KSksIGZ1bmN0aW9uICgpIHsgdmFyIG4gPSAxMDAsIHQgPSAwOyBmdW5jdGlvbiByKCkgeyB2YXIgbyA9IHdpbmRvdy5qYW5yYWluOyBpZiAod2luZG93LmphbnJhaW4gJiYgd2luZG93LmphbnJhaW4ucmVhZHkgJiYgd2luZG93LmphbnJhaW4uY2FwdHVyZSAmJiB3aW5kb3cuamFucmFpbi5jYXB0dXJlLnVpICYmIHdpbmRvdy5qYW5yYWluLmNhcHR1cmUudWkuaGFzQWN0aXZlU2Vzc2lvbilcbiAgICAgICAgICAgICAgICAhZnVuY3Rpb24gKCkgeyB2YXIgbiA9IHdpbmRvdy5qYW5yYWluLCB0ID0gZnVuY3Rpb24gKHQpIHsgbi5ldmVudHNbdF0uYWRkSGFuZGxlcigoZnVuY3Rpb24gKCkgeyBmb3IgKHZhciBuID0gW10sIHIgPSAwOyByIDwgYXJndW1lbnRzLmxlbmd0aDsgcisrKVxuICAgICAgICAgICAgICAgICAgICBuW3JdID0gYXJndW1lbnRzW3JdOyBlLmxvZyhcIkpBTlJBSU46IFwiLCB0LCBuKTsgfSkpOyB9OyBwbi5kZWJ1ZyAmJiBuLmV2ZW50cy5jYXB0dXJlRXZlbnRzLmZvckVhY2godCk7IH0oKSwgeSgpLCBkLnN0YXJ0Q2FwdHVyZSAmJiBvLmNhcHR1cmUudWkuc3RhcnQoKSwgbCA9ICEwO1xuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKHQgPiBuKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBcIkphbnJhaW4gaXMgbm90IGluaXRpYWxpemVkXCI7XG4gICAgICAgICAgICAgICAgdCsrLCB3aW5kb3cuc2V0VGltZW91dChyLCAxMDApO1xuICAgICAgICAgICAgfSB9IHIoKTsgfSgpLCBjID0gITAsIHBuLnpJbmRleGVzID0geyBiYWNrZHJvcDogOTAwLCBtb2RhbDogOTUwLCBjbG9zZTogOTkwIH07XG4gICAgICAgICAgICB2YXIgdSA9IGZ1bmN0aW9uIChuKSB7IGUubG9nKFwiSkFOUkFJTjogb25Mb2dpblwiKSwgd2luZG93LmphbnJhaW4uY2FwdHVyZS51aS5tb2RhbC5jbG9zZSgpLCBoKCk7IH07XG4gICAgICAgICAgICBfKFwib25DYXB0dXJlTG9naW5TdWNjZXNzXCIsIHUpLCBfKFwib25DYXB0dXJlUmVnaXN0cmF0aW9uU3VjY2Vzc1wiLCB1KTtcbiAgICAgICAgfSB9LCBpc1VzZXJWYWxpZDogcywgZ2V0VG9rZW46IGEsIGdldE5hbWU6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGk7IH0sIG9uTG9naW5TdWNjZXNzOiBmdW5jdGlvbiAobikgeyBlLnNldEFjY2Vzc1Rva2VuTGlzdENvb2tpZSh7IHZhbHVlOiBuLnRva2VuX2xpc3QsIGNvb2tpZV9kb21haW46IG4uY29va2llX2RvbWFpbiB9LCBuLnVzZXJfdG9rZW4pOyB9LCBsb2dpbjogZnVuY3Rpb24gKGUsIG4pIHsgaWYgKCFjKVxuICAgICAgICAgICAgdGhyb3cgXCJKYW5yYWluIGlzIG5vdCBjb25maWd1cmVkXCI7IHZhciB0ID0gMCwgciA9IGZ1bmN0aW9uICgpIHsgaWYgKGwpXG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHdpbmRvdy5qYW5yYWluLmNhcHR1cmUudWkucmVuZGVyU2NyZWVuKGYobikpLCBcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIGUgJiYgZnVuY3Rpb24gKGUsIG4pIHsgdVtlXSA9IFtdLCB1W2VdLnB1c2gobik7IH0oXCJvbkNhcHR1cmVTZXNzaW9uQ3JlYXRlZFwiLCBlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHQrKywgdm9pZCB3aW5kb3cuc2V0VGltZW91dChyLCAxMDApO1xuICAgICAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGlmICh0ID4gMTAwKVxuICAgICAgICAgICAgICAgIHRocm93IFwiSmFucmFpbiBpcyBub3QgaW5pdGlhbGl6ZWRcIjtcbiAgICAgICAgICAgIHQrKywgd2luZG93LnNldFRpbWVvdXQociwgMTAwKTtcbiAgICAgICAgfSB9OyByKCk7IH0sIGxvZ291dDogZnVuY3Rpb24gKGUpIHsgaWYgKCFjKVxuICAgICAgICAgICAgdGhyb3cgXCJKYW5yYWluIGlzIG5vdCBjb25maWd1cmVkXCI7IHZhciBuID0gMCwgdCA9IDA7IGZ1bmN0aW9uIHIoKSB7IHQgPiAxMDAgPyBlKCkgOiB2KCkgPyAodCsrLCB3aW5kb3cuc2V0VGltZW91dChyLCAxMDApKSA6IGUoKTsgfSBtKCksIGZ1bmN0aW9uIHQoKSB7IGlmIChsKSB7XG4gICAgICAgICAgICB2YXIgaSA9IHdpbmRvdy5qYW5yYWluO1xuICAgICAgICAgICAgaS5jYXB0dXJlLnVpLm1vZGFsLmNsb3NlKCksIGkuY2FwdHVyZS51aS5lbmRDYXB0dXJlU2Vzc2lvbigpLCBvLmZpcmVDYWxsYmFja3MoXCJsb2dvdXRcIiwgbnVsbCwgdm9pZCAwLCAhMCksIGUgJiYgcigpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaWYgKG4gPiAxMDApXG4gICAgICAgICAgICAgICAgdGhyb3cgXCJKYW5yYWluIGlzIG5vdCBpbml0aWFsaXplZFwiO1xuICAgICAgICAgICAgbisrLCB3aW5kb3cuc2V0VGltZW91dCh0LCAxMDApO1xuICAgICAgICB9IH0oKTsgfSwgaXNDb25maWd1cmVkOiBmdW5jdGlvbiAoKSB7IHJldHVybiBjOyB9LCBnZXRMb2dpblJlcXVpcmVkU2NyZWVuOiBmLCBhZGRFdmVudEhhbmRsZXI6IF8sIHJlZ2lzdGVyQ2FsbGJhY2s6IGZ1bmN0aW9uIChlLCBuKSB7IG8uYWRkRXZlbnQoZSksIG8ucmVnaXN0ZXJDYWxsYmFjayhlLCAoZnVuY3Rpb24gKGUpIHsgbihlKTsgfSkpOyB9IH07IH0oKTtcbiAgICBwbi5jb250YWluZXIucmVnaXN0ZXIoXCJqYW5yYWluXCIsIHsgdXNlVmFsdWU6IFBlIH0pLCBwbi5qYW5yYWluID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJqYW5yYWluXCIpO1xuICAgIHZhciBFZSA9IHsgbmFtZTogXCJzaGExXCIsIGhhc2g6IGZ1bmN0aW9uIChlLCBuKSB7IGZ1bmN0aW9uIHQoZSwgbikgeyByZXR1cm4gZSA8PCBuIHwgZSA+Pj4gMzIgLSBuOyB9IGZ1bmN0aW9uIHIoZSkgeyB2YXIgbiwgdCA9IFwiXCI7IGZvciAobiA9IDc7IG4gPj0gMDsgbi0tKVxuICAgICAgICAgICAgdCArPSAoZSA+Pj4gNCAqIG4gJiAxNSkudG9TdHJpbmcoMTYpOyByZXR1cm4gdDsgfSB2YXIgbywgaSwgYTsgbiA9IG4gfHwgMzI7IHZhciBzLCBjLCBsLCB1LCBkLCBwLCBmID0gbmV3IEFycmF5KDgwKSwgbSA9IDE3MzI1ODQxOTMsIGcgPSA0MDIzMjMzNDE3LCB2ID0gMjU2MjM4MzEwMiwgaCA9IDI3MTczMzg3OCwgdyA9IDMyODUzNzc1MjAsIHkgPSAoZSA9IGZ1bmN0aW9uIChlKSB7IGUgPSBlLnJlcGxhY2UoL1xcclxcbi9nLCBcIlxcblwiKTsgZm9yICh2YXIgbiA9IFwiXCIsIHQgPSAwOyB0IDwgZS5sZW5ndGg7IHQrKykge1xuICAgICAgICAgICAgdmFyIHIgPSBlLmNoYXJDb2RlQXQodCk7XG4gICAgICAgICAgICByIDwgMTI4ID8gbiArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKHIpIDogciA+IDEyNyAmJiByIDwgMjA0OCA/IChuICs9IFN0cmluZy5mcm9tQ2hhckNvZGUociA+PiA2IHwgMTkyKSwgbiArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKDYzICYgciB8IDEyOCkpIDogKG4gKz0gU3RyaW5nLmZyb21DaGFyQ29kZShyID4+IDEyIHwgMjI0KSwgbiArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKHIgPj4gNiAmIDYzIHwgMTI4KSwgbiArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKDYzICYgciB8IDEyOCkpO1xuICAgICAgICB9IHJldHVybiBuOyB9KGUpKS5sZW5ndGgsIGIgPSBuZXcgQXJyYXk7IGZvciAoaSA9IDA7IGkgPCB5IC0gMzsgaSArPSA0KVxuICAgICAgICAgICAgYSA9IGUuY2hhckNvZGVBdChpKSA8PCAyNCB8IGUuY2hhckNvZGVBdChpICsgMSkgPDwgMTYgfCBlLmNoYXJDb2RlQXQoaSArIDIpIDw8IDggfCBlLmNoYXJDb2RlQXQoaSArIDMpLCBiLnB1c2goYSk7IHN3aXRjaCAoeSAlIDQpIHtcbiAgICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgICAgICBpID0gMjE0NzQ4MzY0ODtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICBpID0gZS5jaGFyQ29kZUF0KHkgLSAxKSA8PCAyNCB8IDgzODg2MDg7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgaSA9IGUuY2hhckNvZGVBdCh5IC0gMikgPDwgMjQgfCBlLmNoYXJDb2RlQXQoeSAtIDEpIDw8IDE2IHwgMzI3Njg7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDM6IGkgPSBlLmNoYXJDb2RlQXQoeSAtIDMpIDw8IDI0IHwgZS5jaGFyQ29kZUF0KHkgLSAyKSA8PCAxNiB8IGUuY2hhckNvZGVBdCh5IC0gMSkgPDwgOCB8IDEyODtcbiAgICAgICAgfSBmb3IgKGIucHVzaChpKTsgYi5sZW5ndGggJSAxNiAhPSAxNDspXG4gICAgICAgICAgICBiLnB1c2goMCk7IGZvciAoYi5wdXNoKHkgPj4+IDI5KSwgYi5wdXNoKHkgPDwgMyAmIDQyOTQ5NjcyOTUpLCBvID0gMDsgbyA8IGIubGVuZ3RoOyBvICs9IDE2KSB7XG4gICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgMTY7IGkrKylcbiAgICAgICAgICAgICAgICBmW2ldID0gYltvICsgaV07XG4gICAgICAgICAgICBmb3IgKGkgPSAxNjsgaSA8PSA3OTsgaSsrKVxuICAgICAgICAgICAgICAgIGZbaV0gPSB0KGZbaSAtIDNdIF4gZltpIC0gOF0gXiBmW2kgLSAxNF0gXiBmW2kgLSAxNl0sIDEpO1xuICAgICAgICAgICAgZm9yIChzID0gbSwgYyA9IGcsIGwgPSB2LCB1ID0gaCwgZCA9IHcsIGkgPSAwOyBpIDw9IDE5OyBpKyspXG4gICAgICAgICAgICAgICAgcCA9IHQocywgNSkgKyAoYyAmIGwgfCB+YyAmIHUpICsgZCArIGZbaV0gKyAxNTE4NTAwMjQ5ICYgNDI5NDk2NzI5NSwgZCA9IHUsIHUgPSBsLCBsID0gdChjLCAzMCksIGMgPSBzLCBzID0gcDtcbiAgICAgICAgICAgIGZvciAoaSA9IDIwOyBpIDw9IDM5OyBpKyspXG4gICAgICAgICAgICAgICAgcCA9IHQocywgNSkgKyAoYyBeIGwgXiB1KSArIGQgKyBmW2ldICsgMTg1OTc3NTM5MyAmIDQyOTQ5NjcyOTUsIGQgPSB1LCB1ID0gbCwgbCA9IHQoYywgMzApLCBjID0gcywgcyA9IHA7XG4gICAgICAgICAgICBmb3IgKGkgPSA0MDsgaSA8PSA1OTsgaSsrKVxuICAgICAgICAgICAgICAgIHAgPSB0KHMsIDUpICsgKGMgJiBsIHwgYyAmIHUgfCBsICYgdSkgKyBkICsgZltpXSArIDI0MDA5NTk3MDggJiA0Mjk0OTY3Mjk1LCBkID0gdSwgdSA9IGwsIGwgPSB0KGMsIDMwKSwgYyA9IHMsIHMgPSBwO1xuICAgICAgICAgICAgZm9yIChpID0gNjA7IGkgPD0gNzk7IGkrKylcbiAgICAgICAgICAgICAgICBwID0gdChzLCA1KSArIChjIF4gbCBeIHUpICsgZCArIGZbaV0gKyAzMzk1NDY5NzgyICYgNDI5NDk2NzI5NSwgZCA9IHUsIHUgPSBsLCBsID0gdChjLCAzMCksIGMgPSBzLCBzID0gcDtcbiAgICAgICAgICAgIG0gPSBtICsgcyAmIDQyOTQ5NjcyOTUsIGcgPSBnICsgYyAmIDQyOTQ5NjcyOTUsIHYgPSB2ICsgbCAmIDQyOTQ5NjcyOTUsIGggPSBoICsgdSAmIDQyOTQ5NjcyOTUsIHcgPSB3ICsgZCAmIDQyOTQ5NjcyOTU7XG4gICAgICAgIH0gcmV0dXJuIChwID0gcihtKSArIHIoZykgKyByKHYpICsgcihoKSArIHIodykpLnRvTG93ZXJDYXNlKCkuc2xpY2UoMCwgbik7IH0gfTtcbiAgICBwbi5zaGExID0gRWUsIHBuLmNvbnRhaW5lci5yZWdpc3RlcihcInNoYTFcIiwgeyB1c2VWYWx1ZTogRWUgfSk7XG4gICAgdmFyIFRlID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiBlKGUsIG4pIHsgdGhpcy5faXNBY3RpdmUgPSAhMSwgdGhpcy50YXJnZXRzID0gW10sIHRoaXMudGltZW91dCA9IDIwMCwgdGhpcy51dGlsID0gbiwgdGhpcy5jYWxsYmFjayA9IGU7IH0gcmV0dXJuIGUucHJvdG90eXBlLl9tdXRhdGlvblNlYXJjaCA9IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSB0aGlzOyB0aGlzLnRhcmdldHMuZm9yRWFjaCgoZnVuY3Rpb24gKG4pIHsgdmFyIHQgPSBlLl9nZXRTdGF0ZShuLmVsZW1lbnQpOyAhdCA9PT0gbi5jdXJyZW50U3RhdGUgJiYgKG4uY3VycmVudFN0YXRlID0gdCwgZS5jYWxsYmFjayhbeyB0YXJnZXQ6IG4uZWxlbWVudCB9XSkpOyB9KSksIHRoaXMuX2lzQWN0aXZlICYmIHNldFRpbWVvdXQodGhpcy5fbXV0YXRpb25TZWFyY2guYmluZCh0aGlzKSwgdGhpcy50aW1lb3V0KTsgfSwgZS5wcm90b3R5cGUuX2dldFN0YXRlID0gZnVuY3Rpb24gKGUpIHsgdmFyIG4gPSBbXS5zbGljZS5jYWxsKGUuYXR0cmlidXRlcykucmVkdWNlKChmdW5jdGlvbiAobiwgdCkgeyByZXR1cm4gblt0Lm5hbWVdID0gZS5nZXRBdHRyaWJ1dGUodC5uYW1lKSwgbjsgfSksIHt9KTsgcmV0dXJuIEpTT04uc3RyaW5naWZ5KG4pOyB9LCBlLnByb3RvdHlwZS5vYnNlcnZlID0gZnVuY3Rpb24gKGUpIHsgdGhpcy50YXJnZXRzLnB1c2goeyBpZDogdGhpcy51dGlsLnJhbmRvbVN0cmluZygpLCBlbGVtZW50OiBlLCBjdXJyZW50U3RhdGU6IHRoaXMuX2dldFN0YXRlKGUpIH0pLCB0aGlzLl9pc0FjdGl2ZSB8fCAodGhpcy5faXNBY3RpdmUgPSAhMCwgdGhpcy5fbXV0YXRpb25TZWFyY2goKSk7IH0sIGUucHJvdG90eXBlLmRpc2Nvbm5lY3QgPSBmdW5jdGlvbiAoKSB7IHRoaXMuX2lzQWN0aXZlID0gITEsIHRoaXMudGFyZ2V0cyA9IFtdOyB9LCBlOyB9KCksIEFlID0gZnVuY3Rpb24gKCkgeyBwbi5jb250YWluZXIucmVzb2x2ZShcImpxVXRpbHNcIik7IHZhciBlID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJ1dGlsXCIpLCBuID0gd2luZG93Lk11dGF0aW9uT2JzZXJ2ZXIgfHwgd2luZG93LldlYktpdE11dGF0aW9uT2JzZXJ2ZXIgfHwgd2luZG93Lk1vek11dGF0aW9uT2JzZXJ2ZXIsIHQgPSB7IGF0dHJpYnV0ZXM6ICEwIH07IHJldHVybiB7IG5hbWU6IFwib2JzZXJ2ZXJcIiwgY3JlYXRlOiBmdW5jdGlvbiAociwgbykgeyByIHx8IGUuZXJyb3IoXCJlbGVtZW50IG11c3QgYmUgTk9ERVwiKTsgdmFyIGkgPSBuZXcgKG4gfHwgVGUpKChmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IGUubWFwKChmdW5jdGlvbiAoZSkgeyByZXR1cm4gZS50YXJnZXQ7IH0pKTsgcmV0dXJuIFwiZnVuY3Rpb25cIiA9PSB0eXBlb2YgbyAmJiBvKG4pOyB9KSwgZSk7IHJldHVybiBpLm9ic2VydmUociwgdCksIGk7IH0gfTsgfSgpO1xuICAgIHBuLmNvbnRhaW5lci5yZWdpc3RlcihcIm9ic2VydmVyXCIsIHsgdXNlVmFsdWU6IEFlIH0pLCBwbi5vYnNlcnZlciA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwib2JzZXJ2ZXJcIik7XG4gICAgdmFyIE1lID0gZnVuY3Rpb24gKCkgeyB2YXIgZSwgbiwgdCA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwianFVdGlsc1wiKSwgciA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwidXRpbFwiKSwgbyA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwicG9zdG1lc3NhZ2VcIiksIGkgPSBwbi5jb250YWluZXIucmVzb2x2ZShcImV2ZW50VXRpbHNcIiksIGEgPSBwbi5jb250YWluZXIucmVzb2x2ZShcInNoYTFcIiksIHMgPSB7fSwgYyA9IHt9LCBsID0gaS5jcmVhdGVFdmVudE1hbmFnZXIoW1wiY2xvc2VcIl0pLCB1ID0gXCJ0cC1jb250YWluZXItaW5uZXJcIiwgZCA9IG5ldyBNYXAsIHAgPSBbXSwgZiA9IFwiZnJvemVuLW1vYmlsZS1ib2R5XCIsIG0gPSB7IF9pbml0aWFsU2Nyb2xsUG9zaXRpb246IHsgeDogMCwgeTogMCB9LCBhcHBseUZpeDogZnVuY3Rpb24gKCkgeyB2YXIgZSA9IHdpbmRvdy52aXN1YWxWaWV3cG9ydCA/IE1hdGgubWF4KHdpbmRvdy5zY3JvbGxZLCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wLCB3aW5kb3cudmlzdWFsVmlld3BvcnQucGFnZVRvcCkgOiBNYXRoLm1heCh3aW5kb3cuc2Nyb2xsWSwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcCksIHQgPSBwbi5kb250U2Nyb2xsVG9wTW9kYWwgPyBlIDogMDsgdGhpcy5zYXZlSW5pdGlhbFNjcm9sbCh3aW5kb3cuc2Nyb2xsWCwgZSksIG4gJiYgKHBuLmRvbnRTY3JvbGxUb3BNb2RhbCA/IChkb2N1bWVudC5ib2R5LnN0eWxlLnRvdWNoQWN0aW9uID0gXCJub25lXCIsIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zdHlsZS50b3VjaEFjdGlvbiA9IFwibm9uZVwiLCB0aGlzLmFkZEV2ZW50cyhcInNjcm9sbFwiKSwgdGhpcy5hZGRFdmVudHMoXCJ0b3VjaG1vdmVcIikpIDogKHYoKSwgZygwLCAwKSksIHNldFRpbWVvdXQoKGZ1bmN0aW9uICgpIHsgdmFyIGUgPSB7IG92ZXJzY3JvbGxCZWhhdmlvcjogXCJjb250YWluXCIsIHBvc2l0aW9uOiBcImFic29sdXRlXCIsIHRvcDogdCArIFwicHhcIiwgaGVpZ2h0OiBcIjEwMCVcIiwgd2lkdGg6IFwiMTAwJVwiLCBvdmVyZmxvd1g6IFwidW5zZXRcIiwgb3ZlcmZsb3dZOiBcInNjcm9sbFwiIH07IE9iamVjdC5rZXlzKGUpLmZvckVhY2goKGZ1bmN0aW9uICh0KSB7IG4uc3R5bGVbdF0gPSBlW3RdOyB9KSksIG4uc2Nyb2xsSGVpZ2h0ID4gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodCAmJiBuLmNsYXNzTGlzdC5hZGQoXCJ0cC1tb2RhbF9fbWFyZ2luLTEwMFwiKTsgfSksIDUwMCkpOyB9LCBhZGRFdmVudHM6IGZ1bmN0aW9uIChlKSB7IGRvY3VtZW50LmJvZHkuYWRkRXZlbnRMaXN0ZW5lcihlLCB0aGlzLnNjcm9sbFJldmVydCwgeyBwYXNzaXZlOiAhMSB9KSwgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihlLCB0aGlzLnNjcm9sbFJldmVydCwgeyBwYXNzaXZlOiAhMSB9KTsgfSwgcmVtb3ZlRXZlbnRzOiBmdW5jdGlvbiAoZSkgeyBkb2N1bWVudC5ib2R5LnJlbW92ZUV2ZW50TGlzdGVuZXIoZSwgdGhpcy5zY3JvbGxSZXZlcnQsICExKSwgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihlLCB0aGlzLnNjcm9sbFJldmVydCwgITEpOyB9LCByZW1vdmVGaXg6IGZ1bmN0aW9uICgpIHsgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi50cC1pZnJhbWUtd3JhcHBlci50cC1hY3RpdmVcIikubGVuZ3RoIHx8IChwbi5kb250U2Nyb2xsVG9wTW9kYWwgPyAoZG9jdW1lbnQuYm9keS5zdHlsZS5yZW1vdmVQcm9wZXJ0eShcInRvdWNoLWFjdGlvblwiKSwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnN0eWxlLnJlbW92ZVByb3BlcnR5KFwidG91Y2gtYWN0aW9uXCIpLCB0aGlzLnJlbW92ZUV2ZW50cyhcInNjcm9sbFwiKSwgdGhpcy5yZW1vdmVFdmVudHMoXCJ0b3VjaG1vdmVcIikpIDogKGgoKSwgdGhpcy5fc2Nyb2xsQmFjaygpKSk7IH0sIF9zY3JvbGxCYWNrOiBmdW5jdGlvbiAoKSB7ICh0aGlzLl9pbml0aWFsU2Nyb2xsUG9zaXRpb24ueSB8fCB0aGlzLl9pbml0aWFsU2Nyb2xsUG9zaXRpb24ueCkgJiYgZyh0aGlzLl9pbml0aWFsU2Nyb2xsUG9zaXRpb24ueCwgdGhpcy5faW5pdGlhbFNjcm9sbFBvc2l0aW9uLnkpOyB9LCBzY3JvbGxSZXZlcnQ6IGZ1bmN0aW9uIChlKSB7IHZhciBuID0gZSB8fCB3aW5kb3cuZXZlbnQ7IHJldHVybiBuLnByZXZlbnREZWZhdWx0ICYmIG4uY2FuY2VsYWJsZSAmJiBuLnByZXZlbnREZWZhdWx0KCksIG0uX3Njcm9sbEJhY2soKSwgITE7IH0sIHNhdmVJbml0aWFsU2Nyb2xsOiBmdW5jdGlvbiAoZSwgbikgeyB0aGlzLl9pbml0aWFsU2Nyb2xsUG9zaXRpb24ueCA9IGUsIHRoaXMuX2luaXRpYWxTY3JvbGxQb3NpdGlvbi55ID0gbjsgfSwgbW9kYWxPcGVuZWQ6IGZ1bmN0aW9uICgpIHsgdGhpcy5hcHBseUZpeCgpOyB9LCBtb2RhbENsb3NlZDogZnVuY3Rpb24gKCkgeyB0aGlzLnJlbW92ZUZpeCgpOyB9IH0sIGcgPSBmdW5jdGlvbiAoZSwgbikgeyBmdW5jdGlvbiB0KGUpIHsgcmV0dXJuIC9cXHtcXHMqXFxbbmF0aXZlIGNvZGVcXF1cXHMqXFx9Ly50ZXN0KFwiXCIgKyBlKTsgfSB0cnkge1xuICAgICAgICBpZiAodCh3aW5kb3cuc2Nyb2xsVG8pKVxuICAgICAgICAgICAgcmV0dXJuIHZvaWQgd2luZG93LnNjcm9sbFRvKGUsIG4pO1xuICAgICAgICBpZiAodCh3aW5kb3cuc2Nyb2xsKSlcbiAgICAgICAgICAgIHJldHVybiB2b2lkIHdpbmRvdy5zY3JvbGwoZSwgbik7XG4gICAgICAgIGRvY3VtZW50LmJvZHkgJiYgKGRvY3VtZW50LmJvZHkuc2Nyb2xsVG9wID0gMCk7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIGNvbnNvbGUud2FybihcIkNhbiBub3QgcGVyZm9ybSBzY3JvbGw6IFwiICsgZS5tZXNzYWdlKTtcbiAgICB9IH0sIHYgPSBmdW5jdGlvbiAoKSB7IGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LmNvbnRhaW5zKGYpIHx8IGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LmFkZChmKTsgfSwgaCA9IGZ1bmN0aW9uICgpIHsgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QuY29udGFpbnMoZikgJiYgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QucmVtb3ZlKGYpOyB9OyB0Lm9uKHdpbmRvdywgXCJyZXNpemVcIiwgKGZ1bmN0aW9uICgpIHsgdmFyIGU7IGlmIChxKCksIHIuaXNBbmRyb2lkKCkpIHtcbiAgICAgICAgdmFyIG4gPSBudWxsID09PSAoZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIudHAtaWZyYW1lLXdyYXBwZXIudHAtYWN0aXZlXCIpKSB8fCB2b2lkIDAgPT09IGUgPyB2b2lkIDAgOiBlLmNsb3Nlc3QoXCIudHAtbW9kYWxcIik7XG4gICAgICAgIG4gJiYgbi5zY3JvbGxCeSgwLCAxKTtcbiAgICB9IH0pKSwgci5pc0lPUygpICYmIHQub24od2luZG93LCBcIm9yaWVudGF0aW9uY2hhbmdlXCIsIChmdW5jdGlvbiAoKSB7IHNldFRpbWVvdXQoKGZ1bmN0aW9uICgpIHsgcmV0dXJuIHEoKTsgfSksIDEwMCk7IH0pKSwgby5zdWJzY3JpYmUoXCJjbG9zZVwiLCAoZnVuY3Rpb24gKCkgeyBtLm1vZGFsQ2xvc2VkKCk7IH0pKSwgby5zdWJzY3JpYmUoXCJ0b2dnbGVJZnJhbWVTaGFkb3dcIiwgKGZ1bmN0aW9uIChlKSB7IGIoZS5wYXJhbXMuaXNFbmFibGVkKTsgfSkpLCBvLnN1YnNjcmliZShcInRvZ2dsZUxvYWRpbmdDb250YWluZXJcIiwgKGZ1bmN0aW9uIChlKSB7IGlmIChlLnBhcmFtcy5pc0VuYWJsZWQpXG4gICAgICAgIHJldHVybiBKKCk7IEcoKTsgfSkpOyB2YXIgdywgeSwgYiA9IGZ1bmN0aW9uIChlKSB7IHZhciBuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi50cC1pZnJhbWUtd3JhcHBlclwiKTsgaWYgKG4pXG4gICAgICAgIHJldHVybiBlID8gbi5jbGFzc0xpc3QuY29udGFpbnMoXCJuby1zaGFkb3dcIikgJiYgbi5jbGFzc0xpc3QucmVtb3ZlKFwibm8tc2hhZG93XCIpIDogdm9pZCBuLmNsYXNzTGlzdC5hZGQoXCJuby1zaGFkb3dcIik7IH0sIGsgPSBmdW5jdGlvbiAoZSkgeyAhZnVuY3Rpb24gKGUpIHsgby5zZW5kKFwiY2hlY2tQcm9jY2Vzc2VzRm9yQ2xvc2VcIiwge30sIGUuaWZyYW1lSWQpOyB9KGUpLCBcInBvcHVwXCIgPT09IGUuY29uZmlnLmRpc3BsYXlNb2RlID8gZS5jb250YWluZXIuY2xvc2UoKSA6IGZ1bmN0aW9uIChlKSB7IGlmIChyLmRlYnVnKFwiUmVtb3ZpbmcgaWZyYW1lXCIsIGUpLCBlLmVsZW1lbnQgJiYgKHQuaGlkZShlLmVsZW1lbnQpLCBcImlubGluZVwiID09PSBlLmNvbmZpZy5kaXNwbGF5TW9kZSkpIHtcbiAgICAgICAgdmFyIG4gPSBlLmVsZW1lbnQucGFyZW50RWxlbWVudDtcbiAgICAgICAgbiAmJiB0LmhpZGUobik7XG4gICAgfSBlLnJlc2l6ZU9ic2VydmVyICYmIGUucmVzaXplT2JzZXJ2ZXIuZGlzY29ubmVjdCgpLCBcIm1vZGFsXCIgIT09IGUuY29uZmlnLmRpc3BsYXlNb2RlICYmIFwiaW5saW5lXCIgIT09IGUuY29uZmlnLmRpc3BsYXlNb2RlIHx8IChlLndhaXRGaW5pc2hQcm9jZXNzZXMgPSAhMCk7IH0oZSk7IH0sIF8gPSBmdW5jdGlvbiAoKSB7IGZvciAodmFyIGUgaW4gcykge1xuICAgICAgICB2YXIgbiA9IHNbZV07XG4gICAgICAgIGlmIChcIm1vZGFsXCIgPT09IG4uY29uZmlnLmRpc3BsYXlNb2RlICYmICFuLndhaXRGaW5pc2hQcm9jZXNzZXMgJiYgIW4uY29uZmlnLmlzUHJlbG9hZClcbiAgICAgICAgICAgIHJldHVybiAhMDtcbiAgICB9IHJldHVybiAhMTsgfSwgQyA9IGZ1bmN0aW9uIChlKSB7IHJldHVybiBzW2VdOyB9LCBJID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiBlKGUsIG4sIHQpIHsgdGhpcy4kID0gZSwgdGhpcy5fb3BlcmF0aW9uV2l0aENvbnRhaW5lciA9IHQsIHRoaXMudXRpbCA9IG4sIHRoaXMuX2luaXRNb2RhbENvbnRhaW5lcigpLCB0aGlzLmlPU0JvdHRvbVRvb2xiYXJIZWlnaHQgPSA5MDsgfSByZXR1cm4gZS5wcm90b3R5cGUuX2luaXRNb2RhbENvbnRhaW5lciA9IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSB0aGlzOyByZXR1cm4gdGhpcy5jb250YWluZXIgfHwgKHRoaXMuY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKSwgdGhpcy5lbGVtZW50ID0gdGhpcy5jb250YWluZXIsIHRoaXMuJC5hZGRDbGFzcyhcInRwLW1vZGFsXCIsIHRoaXMuY29udGFpbmVyKSwgdGhpcy5jbG9zZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIiksIHRoaXMuJC5zZXRBdHRyKFwidHlwZVwiLCBcImJ1dHRvblwiLCB0aGlzLmNsb3NlKSwgdGhpcy4kLnNldEF0dHIoXCJhcmlhLWxhYmVsXCIsIFwiQ2xvc2VcIiwgdGhpcy5jbG9zZSksIHRoaXMuJC5hZGRDbGFzcyhcInRwLWNsb3NlXCIsIHRoaXMuY2xvc2UpLCB0aGlzLmlmcmFtZVdyYXBwZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpLCB0aGlzLiQuYWRkQ2xhc3MoXCJ0cC1pZnJhbWUtd3JhcHBlclwiLCB0aGlzLmlmcmFtZVdyYXBwZXIpLCB0aGlzLiQuYXBwZW5kKHRoaXMuaWZyYW1lV3JhcHBlciwgdGhpcy5jbG9zZSksIHRoaXMuY29udGFpbmVyLnN0eWxlLnpJbmRleCA9IHBuLnpJbmRleGVzLm1vZGFsICsgXCJcIiwgdGhpcy5jbG9zZS5zdHlsZS56SW5kZXggPSBwbi56SW5kZXhlcy5jbG9zZSArIFwiXCIsIHRoaXMuJC5vbih0aGlzLmNsb3NlLCBcImNsaWNrXCIsIChmdW5jdGlvbiAoKSB7IFwiZnVuY3Rpb25cIiA9PSB0eXBlb2YgZS5jbG9zZUNsaWNrICYmIGUuY2xvc2VDbGljaygpOyB9KSksIHRoaXMudXRpbC5pc0lPUygpICYmICF0aGlzLnV0aWwuaXNGQk9ySW5zdFdlYlZpZXcoKSAmJiAodGhpcy5pZnJhbWVXcmFwcGVyLnN0eWxlLm1hcmdpbkJvdHRvbSA9IHRoaXMuaU9TQm90dG9tVG9vbGJhckhlaWdodCArIFwicHhcIiksIHRoaXMuJC5hcHBlbmQodGhpcy5jb250YWluZXIsIHRoaXMuaWZyYW1lV3JhcHBlciksIHRoaXMuX29wZXJhdGlvbldpdGhDb250YWluZXIoXCJib2R5XCIsIChmdW5jdGlvbiAobikgeyBlLiQuYXBwZW5kKG4sIGUuY29udGFpbmVyKTsgfSkpKSwgdGhpcy5jb250YWluZXI7IH0sIGUucHJvdG90eXBlLmdldENvbnRhaW5lciA9IGZ1bmN0aW9uIChlLCBuKSB7IHJldHVybiB0aGlzLl9pbml0TW9kYWxDb250YWluZXIoKSwgdGhpcy5jbG9zZUNsaWNrID0gbiwgdm9pZCAwID09PSBlICYmIChlID0gITApLCBlID8gdGhpcy5zaG93Q2xvc2VCdXR0b24oKSA6IHRoaXMuaGlkZUNsb3NlQnV0dG9uKCksIHRoaXMuaWZyYW1lV3JhcHBlcjsgfSwgZS5wcm90b3R5cGUuc2hvdyA9IGZ1bmN0aW9uIChlKSB7IHRoaXMuX2luaXRNb2RhbENvbnRhaW5lcigpLCB2b2lkIDAgPT09IGUgJiYgKGUgPSAhMCksIGUgPyB0aGlzLnNob3dDbG9zZUJ1dHRvbigpIDogdGhpcy5oaWRlQ2xvc2VCdXR0b24oKSwgdGhpcy4kLmFkZENsYXNzKFwidHAtYWN0aXZlXCIsIHRoaXMuY29udGFpbmVyKTsgfSwgZS5wcm90b3R5cGUuaGlkZSA9IGZ1bmN0aW9uICgpIHsgdGhpcy5faW5pdE1vZGFsQ29udGFpbmVyKCksIHRoaXMuJC5yZW1vdmVDbGFzcyhcInRwLWFjdGl2ZVwiLCB0aGlzLmNvbnRhaW5lcik7IH0sIGUucHJvdG90eXBlLnNob3dDbG9zZUJ1dHRvbiA9IGZ1bmN0aW9uICgpIHsgdGhpcy5faW5pdE1vZGFsQ29udGFpbmVyKCksIHRoaXMuJC5hZGRDbGFzcyhcInRwLWFjdGl2ZVwiLCB0aGlzLmNsb3NlKTsgfSwgZS5wcm90b3R5cGUuaGlkZUNsb3NlQnV0dG9uID0gZnVuY3Rpb24gKCkgeyB0aGlzLl9pbml0TW9kYWxDb250YWluZXIoKSwgdGhpcy4kLnJlbW92ZUNsYXNzKFwidHAtYWN0aXZlXCIsIHRoaXMuY2xvc2UpOyB9LCBlOyB9KCksIFMgPSBmdW5jdGlvbiAoZSwgbiwgdCkgeyBmb3IgKHZhciBvIGluIHIuZGVidWcoXCJTZWFyY2ggY29udGFpbmVyIHRvIGNsb3NlXCIsIGUsIG4sIHQpLCBzKSB7XG4gICAgICAgIHZhciBpID0gc1tvXTtcbiAgICAgICAgZSAmJiBvICE9PSBlIHx8ICh0ICYmIFwiaW5saW5lXCIgPT09IGkuY29uZmlnLmRpc3BsYXlNb2RlIHx8IHQgJiYgaS5jb25maWcuaXNQcmVsb2FkIHx8IChrKGkpLCBcIm1vZGFsXCIgPT09IGkuY29uZmlnLmRpc3BsYXlNb2RlICYmIHgoaSkpKTtcbiAgICB9IGwuZmlyZUNhbGxiYWNrcyhcImNsb3NlXCIsIG51bGwsIGUsICEwKTsgfSwgeCA9IGZ1bmN0aW9uIChlKSB7IHZhciByID0gcC5zaGlmdCgpOyB3ICYmICFyICYmIHQucmVtb3ZlQ2xhc3MoXCJ0cC1hY3RpdmVcIiwgdyksIGUuaWZyYW1lUGFyYW1zLnNob3duID0gITEsIHQucmVtb3ZlQ2xhc3MoXCJ0cC1hY3RpdmVcIiwgZS5jb250YWluZXIpLCByID8gKHQuaGlkZShuKSwgbiA9IHIsIHQuc2hvdyhuKSkgOiAoUCgpLCBUKCkpOyB9LCBQID0gZnVuY3Rpb24gKCkgeyBuICYmIChMKFwiYm9keVwiLCAoZnVuY3Rpb24gKGUpIHsgdC5hZGRDbGFzcyhcInRwLW1vZGFsLWNsb3NlXCIsIGUpLCB0LnJlbW92ZUNsYXNzKFwidHAtbW9kYWwtb3BlblwiLCBlKSwgZS5jbGFzc0xpc3QuY29udGFpbnMoXCJib2R5LWZpeGVkXCIpICYmIHQucmVtb3ZlQ2xhc3MoXCJib2R5LWZpeGVkXCIsIGUpOyB9KSksIHQuaGlkZShuKSk7IH0sIEUgPSBmdW5jdGlvbiAoZSwgbywgaSkgeyBpZiAoZnVuY3Rpb24gKCkgeyBpZiAodylcbiAgICAgICAgcmV0dXJuIHc7IHZhciBlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTsgdC5hZGRDbGFzcyhcInRwLWJhY2tkcm9wXCIsIGUpLCBlLnN0eWxlLnpJbmRleCA9IHBuLnpJbmRleGVzLmJhY2tkcm9wICsgXCJcIiwgTChcImJvZHlcIiwgKGZ1bmN0aW9uIChuKSB7IHQuYXBwZW5kKG4sIGUpOyB9KSksIHcgPSBlOyB9KCksIHQudmlzaWJsZSh3KSkge1xuICAgICAgICB2YXIgYSA9IHQucWEoXCIudHAtbW9kYWxcIikuZmluZCgoZnVuY3Rpb24gKGUpIHsgcmV0dXJuIHQudmlzaWJsZShlKTsgfSkpO1xuICAgICAgICBvICYmICFpID8gKGEgJiYgKHQuaGlkZShhKSwgcC51bnNoaWZ0KGEpKSwgZSAmJiB0LnNob3coZSkpIDogbyAmJiAoYSA/IChlICYmIHAucHVzaChlKSwgbiA9IGEpIDogZSAmJiB0LnNob3coZSkpO1xuICAgIH1cbiAgICBlbHNlXG4gICAgICAgIGUgJiYgZnVuY3Rpb24gKGUpIHsgdC52aXNpYmxlKGUpIHx8IChMKFwiYm9keVwiLCAoZnVuY3Rpb24gKGUpIHsgdC5yZW1vdmVDbGFzcyhcInRwLW1vZGFsLWNsb3NlXCIsIGUpLCB0LmFkZENsYXNzKFwidHAtbW9kYWwtb3BlblwiLCBlKTsgfSkpLCB0LnNob3coZSksIChyLmlzSXBob25lKCkgfHwgci5pc1NhZmFyaU9ySU9zVWlXZWJWaWV3KCkgfHwgci5pc0FuZHJvaWQoKSkgJiYgbS5tb2RhbE9wZW5lZCgpKTsgfShlKSwgdC5zaG93KHcpLCB5ID0gd2luZG93LnNldFRpbWVvdXQoKGZ1bmN0aW9uICgpIHsgdC5hZGRDbGFzcyhcInRwLWFjdGl2ZVwiLCB3KTsgfSksIDUwKTsgfSwgVCA9IGZ1bmN0aW9uICgpIHsgdyAmJiAodC5yZW1vdmVDbGFzcyhcInRwLWFjdGl2ZVwiLCB3KSwgdC5oaWRlKHcpLCBjbGVhclRpbWVvdXQoeSkpLCBtLm1vZGFsQ2xvc2VkKCk7IH0sIEEgPSBmdW5jdGlvbiAoZSkgeyB3ICYmICh3LnN0eWxlLmhlaWdodCA9IFwiMTAwJVwiKTsgdmFyIG4gPSB0LnF1ZXJ5RWwoXCIudHAtY2xvc2VcIiwgZSk7IG4gJiYgdC5yZW1vdmVDbGFzcyhcInRwLXNxdWFyZVwiLCBuKTsgfSwgTSA9IGZ1bmN0aW9uIChlLCBuKSB7IGlmIChlKSB7XG4gICAgICAgIHooZS5lbGVtZW50LCBuKTtcbiAgICAgICAgdmFyIHIgPSBPYmplY3QuYXNzaWduKHt9LCBuLCB7IGFuaW1hdGU6ICExIH0pO1xuICAgICAgICBzd2l0Y2ggKGUuY29uZmlnLmRpc3BsYXlNb2RlKSB7XG4gICAgICAgICAgICBjYXNlIFwibW9kYWxcIjpcbiAgICAgICAgICAgICAgICB6KGUuY29udGFpbmVyLCByKSwgTChcImJvZHlcIiwgKGZ1bmN0aW9uIChlKSB7IHQuYWRkQ2xhc3MoXCJ0cC1tb2RhbC1yZXNpemluZ1wiLCBlKSwgc2V0VGltZW91dCgoZnVuY3Rpb24gKCkgeyB0LnJlbW92ZUNsYXNzKFwidHAtbW9kYWwtcmVzaXppbmdcIiwgZSk7IH0pLCA1MCk7IH0pKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJpbmxpbmVcIjpcbiAgICAgICAgICAgICAgICB2YXIgbyA9IHQucXVlcnlFbChcIi50cC1jb250YWluZXItaW5uZXJcIiwgZS5jb250YWluZXIpO1xuICAgICAgICAgICAgICAgIG8gJiYgeihvLCBuKTtcbiAgICAgICAgfVxuICAgIH0gfSwgTyA9IGZ1bmN0aW9uIChlLCByLCBvKSB7IHZhciBpID0gZS5jb250YWluZXIsIGEgPSBpLnBhcmVudEVsZW1lbnQ7IGEgJiYgYS5jbGFzc0xpc3QuY29udGFpbnMoXCJ0cC1tb2RhbFwiKSA/IG4gPSBhIDogYSA9IG4sIGUuaWZyYW1lUGFyYW1zID0gZS5pZnJhbWVQYXJhbXMgfHwge30sIGUuaWZyYW1lUGFyYW1zLnNob3duIHx8IChlLmlmcmFtZVBhcmFtcy5zaG93biA9ICEwLCBFKGEsIHIsIG8pLCBvIHx8IChpLmNsYXNzTGlzdC5jb250YWlucyhcInRwLWFjdGl2ZVwiKSB8fCB0LmFkZENsYXNzKFwidHAtYWN0aXZlXCIsIGkpLCBBKGkpKSk7IH0sIFIgPSB7fSwgTCA9IGZ1bmN0aW9uIChlLCBuKSB7IHZhciByID0gdC5xdWVyeUVsKGUpOyBSW2VdIHx8IChSW2VdID0gMCksIHIgPyAoZGVsZXRlIFJbZV0sIG4ocikpIDogUltlXSA8IDEwMCAmJiAoUltlXSArPSAxLCBzZXRUaW1lb3V0KChmdW5jdGlvbiAoKSB7IEwoZSwgbik7IH0pLCA1MCkpOyB9LCBOID0gZnVuY3Rpb24gKGUsIG8pIHsgaWYgKHZvaWQgMCA9PT0gZS5zaG93Q2xvc2VCdXR0b24gJiYgKGUuc2hvd0Nsb3NlQnV0dG9uID0gITApLCBlLmNvbnRhaW5lcilcbiAgICAgICAgcmV0dXJuIGUuY29udGFpbmVyOyB2YXIgaSA9IG5ldyBJKHQsIHIsIEwpOyByZXR1cm4gZS5pc1ByZWxvYWQgfHwgKG4gPSBpLmVsZW1lbnQpLCBpLmdldENvbnRhaW5lcihlLnNob3dDbG9zZUJ1dHRvbiwgbyk7IH0sIFUgPSBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IHsgY29udGFpbmVyOiBudWxsLCBjb250YWluZXJSZWFkeTogITEgfTsgaWYgKCFlLmlmcmFtZVBhcmFtcy5jb250YWluZXJTZWxlY3RvcilcbiAgICAgICAgcmV0dXJuIHIubG9nKFwiSW5saW5lIG9mZmVyIG11c3QgaGF2ZSBhIHZhbGlkIGNvbnRhaW5lclNlbGVjdG9yXCIpLCBuOyBpZiAobi5jb250YWluZXIgPSBlLnNpbmdsZUNvbnRhaW5lciB8fCB0LnF1ZXJ5RWwoZS5pZnJhbWVQYXJhbXMuY29udGFpbmVyU2VsZWN0b3IpLCAhbi5jb250YWluZXIpXG4gICAgICAgIHJldHVybiByLmxvZyhcIkludmFsaWQgY29udGFpbmVyU2VsZWN0b3JcIiksIG47IHZhciBvID0gZS5jb25maWcsIGkgPSBcIm9iamVjdFwiID09IHR5cGVvZiBvICYmIG51bGwgIT09IG87IHJldHVybiB0LmVtcHR5KG4uY29udGFpbmVyKSwgaSA/ICEwID09ICEhby5wcmV2aWV3IHx8IChlLmlmcmFtZVBhcmFtcy53aWR0aCA9IHQuZ2V0V2lkdGgobi5jb250YWluZXIpKSA6IGUuaWZyYW1lUGFyYW1zLndpZHRoID0gZS5pZnJhbWVQYXJhbXMud2lkdGggfHwgdC5nZXRXaWR0aChuLmNvbnRhaW5lciksIG4uY29udGFpbmVyUmVhZHkgPSAhMCwgbjsgfSwgaiA9IGZ1bmN0aW9uIChlKSB7IHZhciBuID0gdC53aW5TaXplKCksIG8gPSBlLndpZHRoID8gZS53aWR0aCA6IG4ud2lkdGgsIGkgPSBlLmhlaWdodCA/IGUuaGVpZ2h0IDogbi5oZWlnaHQsIGEgPSByLmNlbnRlclNjcmVlbihvLCBpKTsgcmV0dXJuIHsgd2lkdGg6IG8sIGhlaWdodDogaSwgdG9wOiBhLnRvcCwgbGVmdDogYS5sZWZ0IH07IH0sIEQgPSBmdW5jdGlvbiAoZSwgbikgeyB2YXIgdCA9IGooZSksIG8gPSB3aW5kb3cub3BlbihuLCByLnJhbmRvbVN0cmluZygxNiksIFwic2Nyb2xsYmFycz15ZXMsbG9jYXRpb249eWVzLHN0YXR1cz0wLHRvb2xiYXI9MCxyZXNpemFibGU9MSwgd2lkdGg9XCIgKyB0LndpZHRoICsgXCIsIGhlaWdodD1cIiArIHQuaGVpZ2h0ICsgXCIsIHRvcD1cIiArIHQudG9wICsgXCIsIGxlZnQ9XCIgKyB0LmxlZnQpOyByZXR1cm4gd2luZG93LmZvY3VzICYmIG8gJiYgby5mb2N1cygpLCBvOyB9LCBGID0gMSwgQiA9IGZ1bmN0aW9uIChlLCBuLCBvKSB7IHZhciBpID0gXCJpZnJhbWUtXCIgKyBGKysgKyBcIi1cIiArIHIucmFuZG9tU3RyaW5nKCk7IG4uaWZyYW1lSWQgJiYgKGkgPSBuLmlmcmFtZUlkKTsgdmFyIGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaWZyYW1lXCIpLCBzID0geyBpZDogaSwgbmFtZTogaSwgdGl0bGU6IGksIHNjcm9sbGluZzogXCJub1wiLCBhbGxvd3RyYW5zcGFyZW5jeTogXCJ0cnVlXCIsIHNyYzogbywgYWxsb3c6IFwicGF5bWVudFwiIH07IE9iamVjdC5rZXlzKHMpLmZvckVhY2goKGZ1bmN0aW9uIChlKSB7IHQuc2V0QXR0cihlLCBzW2VdLCBhKTsgfSkpOyB2YXIgYyA9IHsgb3ZlcmZsb3c6IFwiaGlkZGVuXCIsIGJhY2tncm91bmRDb2xvcjogXCJ0cmFuc3BhcmVudFwiLCBib3JkZXI6IFwiMFwiLCB3aWR0aDogXCJpbmxpbmVcIiA9PT0gZS5kaXNwbGF5TW9kZSA/IG4ud2lkdGggKyBcInB4XCIgOiBcIjBweFwiLCBoZWlnaHQ6IFwiMHB4XCIgfTsgT2JqZWN0LmtleXMoYykuZm9yRWFjaCgoZnVuY3Rpb24gKGUpIHsgYS5zdHlsZVtlXSA9IGNbZV07IH0pKTsgdHJ5IHtcbiAgICAgICAgdC5zZXRBdHRyKFwiZnJhbWVCb3JkZXJcIiwgXCIwXCIsIGEpO1xuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgICByLmxvZyhlKTtcbiAgICB9IHJldHVybiBhOyB9LCBWID0gZnVuY3Rpb24gKGUsIG4pIHsgdmFyIHIgPSBzZXRJbnRlcnZhbCgoZnVuY3Rpb24gKCkgeyB0LmVtcHR5KGUpOyB9KSwgMTUwKTsgdC5yZWFkeSgoZnVuY3Rpb24gKCkgeyBjbGVhckludGVydmFsKHIpLCB0LmFwcGVuZChlLCBuKTsgfSkpOyB9LCBxID0gZnVuY3Rpb24gKCkgeyBmb3IgKHZhciBlIGluIHMpIHtcbiAgICAgICAgdmFyIG4gPSBzW2VdO1xuICAgICAgICBpZiAoIW4uY29uZmlnLnByZXZpZXcgJiYgXCJpbmxpbmVcIiA9PT0gbi5jb25maWcuZGlzcGxheU1vZGUgJiYgbi5jb250YWluZXIgJiYgTShuLCB7IHdpZHRoOiB0LmdldFdpZHRoKG4uY29udGFpbmVyKSB9KSwgXCJtb2RhbFwiID09PSBuLmNvbmZpZy5kaXNwbGF5TW9kZSAmJiBuLmNvbnRhaW5lcikge1xuICAgICAgICAgICAgdmFyIHIgPSBNYXRoLm1heChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGgsIGRvY3VtZW50LmJvZHkub2Zmc2V0V2lkdGgsIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5vZmZzZXRXaWR0aCk7XG4gICAgICAgICAgICBvLnNlbmQoXCJSRVNJWkVfTU9EQUxfQ0hFQ0tPVVRcIiwgeyBpZnJhbWU6IG4sIHdpZHRoOiByIH0sIG4uaWZyYW1lSWQpO1xuICAgICAgICB9XG4gICAgfSB9LCB6ID0gZnVuY3Rpb24gKGUsIG4pIHsgZSAmJiAodm9pZCAwICE9PSBuLndpZHRoICYmIChlLnN0eWxlLndpZHRoID0gbi53aWR0aCArIFwicHhcIiwgKDAgPT09IG4ud2lkdGggJiYgIWUuY2xhc3NMaXN0LmNvbnRhaW5zKFwibm8td2lkdGhcIikgfHwgMCAhPT0gbi53aWR0aCAmJiBlLmNsYXNzTGlzdC5jb250YWlucyhcIm5vLXdpZHRoXCIpKSAmJiB0LnRvZ2dsZUNsYXNzKFwibm8td2lkdGhcIiwgZSkpLCB2b2lkIDAgIT09IG4uaGVpZ2h0ICYmIChuLmFuaW1hdGUsIGUuc3R5bGUuaGVpZ2h0ID0gbi5oZWlnaHQgKyBcInB4XCIsICgwID09PSBuLmhlaWdodCAmJiAhZS5jbGFzc0xpc3QuY29udGFpbnMoXCJuby1oZWlnaHRcIikgfHwgMCAhPT0gbi5oZWlnaHQgJiYgZS5jbGFzc0xpc3QuY29udGFpbnMoXCJuby1oZWlnaHRcIikpICYmIHQudG9nZ2xlQ2xhc3MoXCJuby1oZWlnaHRcIiwgZSkpKTsgfSwgSCA9IGZ1bmN0aW9uIChlKSB7IHZhciBuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTsgcmV0dXJuIG4uaW5uZXJIVE1MID0gZS50cmltKCksIG4uZmlyc3RDaGlsZDsgfSwgVyA9IGZ1bmN0aW9uIChlKSB7IHJldHVybiB2b2lkIDAgPT09IGUgJiYgKGUgPSBcIlwiKSwgJzxkaXYgY2xhc3M9XCJ0cC1wbGVhc2Utd2FpdCB0cC1hY3RpdmUgdHAtb3ZlcmxhcCAnICsgZSArICdcIj48ZGl2IGNsYXNzPVwidHAtaWNvbiB0cC1jZW50ZXJlZFwiPjxkaXYgY2xhc3M9XCJwbi1zcGlubmVyXCI+PGRpdj48L2Rpdj48ZGl2PjwvZGl2PjxkaXY+PC9kaXY+PGRpdj48L2Rpdj48ZGl2PjwvZGl2PjxkaXY+PC9kaXY+PGRpdj48L2Rpdj48ZGl2PjwvZGl2PjxkaXY+PC9kaXY+PGRpdj48L2Rpdj48ZGl2PjwvZGl2PjxkaXY+PC9kaXY+PC9kaXY+PC9kaXY+PC9kaXY+JzsgfSwgSiA9IGZ1bmN0aW9uICgpIHsgZSB8fCAoZSA9IEgoVygpKSkgJiYgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChlKTsgfSwgRyA9IGZ1bmN0aW9uICgpIHsgZSAmJiAoZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChlKSwgZSA9IG51bGwpOyB9OyBmdW5jdGlvbiBRKGUpIHsgaWYgKGUgJiYgZS5jb250YWluZXIpIHtcbiAgICAgICAgIWZ1bmN0aW9uIChlKSB7IGlmIChlICYmIChudWxsID09IGUgPyB2b2lkIDAgOiBlLmNvbnRhaW5lcikgJiYgIWQuaGFzKGUuaWZyYW1lSWQpKSB7XG4gICAgICAgICAgICB2YXIgbiA9IEgoVyhcInRwLWxvY2FsLW92ZXJsYXBcIikpO1xuICAgICAgICAgICAgbiAmJiAoZS5jb250YWluZXIuYXBwZW5kQ2hpbGQobiksIGQuc2V0KGUuaWZyYW1lSWQsIG4pKTtcbiAgICAgICAgfSB9KGUpO1xuICAgICAgICBlLmNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKFwibG9hZFwiLCAoZnVuY3Rpb24gKCkgeyAhZnVuY3Rpb24gKGUpIHsgaWYgKGUgJiYgKG51bGwgPT0gZSA/IHZvaWQgMCA6IGUuY29udGFpbmVyKSAmJiBkLmhhcyhlLmlmcmFtZUlkKSkge1xuICAgICAgICAgICAgdmFyIG4gPSBkLmdldChlLmlmcmFtZUlkKTtcbiAgICAgICAgICAgIG4gJiYgKGUuY29udGFpbmVyLnJlbW92ZUNoaWxkKG4pLCBkLmRlbGV0ZShlLmlmcmFtZUlkKSk7XG4gICAgICAgIH0gfShlKTsgfSksIHsgb25jZTogITAsIGNhcHR1cmU6ICEwIH0pO1xuICAgIH0gfSBmdW5jdGlvbiBYKGUpIHsgZSAmJiBlLmVsZW1lbnQgJiYgKGZ1bmN0aW9uIChlKSB7IHZhciBuOyBpZiAoIWUpXG4gICAgICAgIHJldHVybiAhMTsgcmV0dXJuICEhKG51bGwgPT09IChuID0gbnVsbCA9PSBlID8gdm9pZCAwIDogZS5lbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpKSB8fCB2b2lkIDAgPT09IG4gPyB2b2lkIDAgOiBuLndpZHRoKTsgfShlKSAmJiBRKGUpLCBlLmVsZW1lbnQuc3JjID0gZS5lbGVtZW50LnNyYyk7IH0gZnVuY3Rpb24gJCgpIHsgZm9yICh2YXIgZSBpbiBzKSB7XG4gICAgICAgIHZhciBuID0gc1tlXTtcbiAgICAgICAgbiAmJiBYKG4pO1xuICAgIH0gfSByZXR1cm4geyBuYW1lOiBcImNvbnRhaW5lclV0aWxzXCIsIGZha2VPZmZlcklkOiBcImZha2VPZmZlcklkXCIsIGNyZWF0ZUNvbnRhaW5lcjogZnVuY3Rpb24gKGUpIHsgdmFyIG4sIGksIGQsIHAgPSAhMCwgZiA9IGUuaWZyYW1lUGFyYW1zOyBpZiAoXCJpbmxpbmVcIiA9PT0gZi5kaXNwbGF5TW9kZSB8fCBmLndpZHRoIHx8IChmLndpZHRoID0gd2luZG93LmlubmVyV2lkdGgpLCBpID0gZS5jb25maWcuYnVpbGRRdWVyeVN0cmluZ0ZuID8gZnVuY3Rpb24gKG4pIHsgcmV0dXJuIGUuY29uZmlnLmJ1aWxkUXVlcnlTdHJpbmdGbihuLCB0KTsgfSA6IGZ1bmN0aW9uIChlKSB7IHZhciBuID0gdC5wYXJhbShlKTsgcmV0dXJuIG4gKyBcIiZfcWg9XCIgKyBhLmhhc2gobiwgMTApOyB9LCBcInBvcHVwXCIgPT09IGYuZGlzcGxheU1vZGUpIHtcbiAgICAgICAgICAgIGYud2lkdGggfHwgKGYud2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aCk7XG4gICAgICAgICAgICB2YXIgbSA9IGUudXJsICsgXCI/XCIgKyBpKGYpO1xuICAgICAgICAgICAgbiA9IEQoZiwgbSk7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGQgPSBuLmRvY3VtZW50O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICBkID0gbjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgZCA9IG51bGwsIGNvbnNvbGUud2FybihcIlVuYWJsZSB0byBnZXQgcG9wdXAgZWxlbWVudFwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjW2YuaWZyYW1lSWRdID0geyBjb250YWluZXI6IG4sIGludGVydmFsOiBzZXRJbnRlcnZhbCgoZnVuY3Rpb24gKCkgeyBjW2YuaWZyYW1lSWRdLmNvbnRhaW5lci5jbG9zZWQgJiYgKGNsZWFySW50ZXJ2YWwoY1tmLmlmcmFtZUlkXS5pbnRlcnZhbCksIGNbZi5pZnJhbWVJZF0uY29udGFpbmVyLmNsb3NlKCksIGUub25DbG9zZUNhbGxiYWNrICYmIGUub25DbG9zZUNhbGxiYWNrKCkpOyB9KSwgMTAwKSB9O1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaWYgKFwiaW5saW5lXCIgPT09IGYuZGlzcGxheU1vZGUpIHtcbiAgICAgICAgICAgICAgICB2b2lkIDAgIT09IGUuY29uZmlnLnNob3dDbG9zZUJ1dHRvbiAmJiBkZWxldGUgZS5jb25maWcuc2hvd0Nsb3NlQnV0dG9uO1xuICAgICAgICAgICAgICAgIHZhciBnID0gVShlKTtcbiAgICAgICAgICAgICAgICBuID0gZy5jb250YWluZXIsIHAgPSAhIWcuY29udGFpbmVyUmVhZHk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgbiA9IE4oZS5jb25maWcsIChmdW5jdGlvbiAoKSB7IFMoZi5pZnJhbWVJZCwgZS5wYXJlbnQpOyB9KSk7XG4gICAgICAgICAgICB2YXIgdiA9IGUudXJsICsgXCI/XCIgKyBpKGYpO1xuICAgICAgICAgICAgZCA9IEIoZS5jb25maWcsIGYsIHYpO1xuICAgICAgICB9IGwucmVnaXN0ZXJDYWxsYmFjayhlLCBmLmlmcmFtZUlkKTsgdmFyIGggPSBzW2YuaWZyYW1lSWRdID0geyBpZnJhbWVJZDogZi5pZnJhbWVJZCwgY29uZmlnOiBlLmNvbmZpZywgZWxlbWVudDogZCwgY29udGFpbmVyOiBuLCBpZnJhbWVQYXJhbXM6IGYsIGNvbnRhaW5lclJlYWR5OiBwIH07IGlmIChvLmluaXQoeyBwb3N0TWVzc2FnZVVybDogZS5wb3N0TWVzc2FnZVVybCwgcGFyZW50OiBlLnBhcmVudCwgcmVjZWl2ZTogZS5yZWNlaXZlLCBpZnJhbWU6IGgsIGlmcmFtZVBhcmFtczogZiB9KSwgdC5vbihkb2N1bWVudCwgXCJrZXl1cFwiLCAoZnVuY3Rpb24gKGUpIHsgfSkpLCBcIm1vZGFsXCIgPT09IGYuZGlzcGxheU1vZGUpXG4gICAgICAgICAgICB0Lm9uKHdpbmRvdywgXCJyZXNpemVcIiwgKGZ1bmN0aW9uICgpIHsgQShuKTsgfSkpLCB0LmFwcGVuZChuLCBkKTtcbiAgICAgICAgZWxzZSBpZiAoXCJpbmxpbmVcIiA9PT0gZi5kaXNwbGF5TW9kZSkge1xuICAgICAgICAgICAgaWYgKHNbZi5pZnJhbWVJZF0uY29udGFpbmVyUmVhZHkpIHtcbiAgICAgICAgICAgICAgICB2YXIgdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgICAgICAgICAgdC5hZGRDbGFzcyh1LCB3KSwgdC5hcHBlbmQodywgZCksIGUuY29uZmlnLmlzUHJlbG9hZCAmJiB0LmhpZGUodyksIChcImNvbXBsZXRlXCIgPT09IGRvY3VtZW50LnJlYWR5U3RhdGUgfHwgXCJsb2FkaW5nXCIgIT09IGRvY3VtZW50LnJlYWR5U3RhdGUgJiYgIWRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5kb1Njcm9sbCkgJiYgbiA/ICh0LmVtcHR5KG4pLCB0LmFwcGVuZChuLCB3KSkgOiBWKG4sIHcpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFyIHkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICAgICAgICAgIHQuc2V0QXR0cihcImlkXCIsIFwidGVtcC1pbmxpbmUtXCIgKyBmLmlmcmFtZUlkLCB5KSwgdC5oaWRlKHkpLCBMKFwiYm9keVwiLCAoZnVuY3Rpb24gKGUpIHsgdC5hcHBlbmQoZSwgeSk7IH0pKSwgdC5hcHBlbmQoeSwgZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAod2luZG93LlJlc2l6ZU9ic2VydmVyKSB7XG4gICAgICAgICAgICAgICAgdmFyIGIgPSBuZXcgUmVzaXplT2JzZXJ2ZXIoKGZ1bmN0aW9uIChlKSB7IHZhciBuID0gdC5nZXRXaWR0aChoLmNvbnRhaW5lcik7IG4gPiAwICYmIE0oaCwgeyB3aWR0aDogbiB9KTsgfSkpO1xuICAgICAgICAgICAgICAgIGIub2JzZXJ2ZShoLmNvbnRhaW5lciksIGgucmVzaXplT2JzZXJ2ZXIgPSBiO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IHJldHVybiByLmRlYnVnKFwiY3JlYXRpbmcgaWZyYW1lOiBcIiwgZSksIGg7IH0sIHNob3dQcmVsb2FkZWRDb250YWluZXI6IGZ1bmN0aW9uIChlKSB7IGlmIChcIm1vZGFsXCIgPT09IGUuY29uZmlnLmRpc3BsYXlNb2RlKSB7XG4gICAgICAgICAgICBpZiAoXygpKVxuICAgICAgICAgICAgICAgIHJldHVybiB2b2lkIHIubG9nKFwiTW9kYWwgaXMgYWxyZWFkeSBzaG93bjsgbXVzdCBiZSBvbmUgbW9kYWwgcGVyIHRpbWVcIik7XG4gICAgICAgICAgICAhZnVuY3Rpb24gKGUpIHsgKG4gPSBlLmNvbnRhaW5lci5jbG9zZXN0KFwiLnRwLW1vZGFsXCIpKSA/IG4gPSBuIDogci5lcnJvcihcInRoZXJlIGlzIG5vIHN1Y2ggbW9kYWwgY29udGFpbmVyXCIpLCBPKGUsICEwLCAhMCk7IH0oZSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgXCJpbmxpbmVcIiA9PT0gZS5jb25maWcuZGlzcGxheU1vZGUgPyBmdW5jdGlvbiAoZSkgeyB0LnNob3coZS5jb250YWluZXIpOyB2YXIgbiA9IHQucXVlcnlFbChcIi50cC1jb250YWluZXItaW5uZXJcIiwgZS5jb250YWluZXIpOyBuICYmIHQuc2hvdyhuKSwgTShlLCB7IHdpZHRoOiB0LmdldFdpZHRoKGUuY29udGFpbmVyKSB9KTsgfShlKSA6IHIubG9nKFwiVW5leHBlY3RlZCBkaXNwbGF5TW9kZSBvZiBwcmVsb2FkZWQgaWZyYW1lXFxuXCIpOyByZXR1cm4gZS5jb25maWcuaXNQcmVsb2FkID0gITEsIGUuaWZyYW1lUGFyYW1zLmlzUHJlbG9hZCA9ICExLCByLmRlYnVnKFwic2hvdyBwcmVsb2FkZWQgaWZyYW1lOiBcIiwgZS5jb25maWcpLCBlOyB9LCByZWRpcmVjdENvbnRhaW5lcjogZnVuY3Rpb24gKGUsIG4pIHsgdmFyIHIgPSBuLnVybCArIFwiP1wiICsgdC5wYXJhbShuLmlmcmFtZVBhcmFtcyksIGkgPSBzW2VdOyBpZiAoXCJwb3B1cFwiID09PSBpLmNvbmZpZy5kaXNwbGF5TW9kZSlcbiAgICAgICAgICAgIGkuY29udGFpbmVyLmxvY2F0aW9uID0gcjtcbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB2YXIgYSA9IGkuZWxlbWVudDtcbiAgICAgICAgICAgIChhLmNvbnRlbnRXaW5kb3cgfHwgYSkubG9jYXRpb24gPSByO1xuICAgICAgICB9IGkuY29uZmlnID0gbi5jb25maWcsIG8uaW5pdCh7IHBvc3RNZXNzYWdlVXJsOiBuLnBvc3RNZXNzYWdlVXJsLCByZWNlaXZlOiBuLnJlY2VpdmUsIGlmcmFtZTogc1tuLmlmcmFtZVBhcmFtcy5pZnJhbWVJZF0sIGlmcmFtZVBhcmFtczogbi5pZnJhbWVQYXJhbXMgfSk7IH0sIGhhc01vZGFsSWZyYW1lOiBfLCBnZXRJZnJhbWU6IEMsIGdlbmVyYXRlSWZyYW1lOiBCLCBnZW5lcmF0ZUlmcmFtZVdyYXBwZXI6IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpLCBuID0geyBvdmVyZmxvdzogXCJoaWRkZW5cIiwgYmFja2dyb3VuZENvbG9yOiBcInRyYW5zcGFyZW50XCIsIGJvcmRlcjogXCIwXCIsIHdpZHRoOiBcIjBweFwiLCBoZWlnaHQ6IFwiMHB4XCIsIHBvc2l0aW9uOiBcImFic29sdXRlXCIsIGRpc3BsYXk6IFwiYmxvY2tcIiwgdG9wOiBcIi0xcHhcIiwgbGVmdDogXCItMXB4XCIgfTsgcmV0dXJuIE9iamVjdC5rZXlzKG4pLmZvckVhY2goKGZ1bmN0aW9uICh0KSB7IGUuc3R5bGVbdF0gPSBuW3RdOyB9KSksIGU7IH0sIGdldFBvcHVwUG9zaXRpb246IGosIGdlbmVyYXRlUG9wdXA6IEQsIGluaXRJbmxpbmVDb250YWluZXI6IFUsIGdldE1vZGFsQ29udGFpbmVyOiBOLCBjZW50ZXJCYWNrZHJvcDogZnVuY3Rpb24gKGUpIHsgaWYgKHcpIHtcbiAgICAgICAgICAgIHZhciBuID0gdC53aW5TaXplKCk7XG4gICAgICAgICAgICBlLm9mZnNldEhlaWdodCA+IG4uaGVpZ2h0ID8gdy5zdHlsZS5oZWlnaHQgPSBuLmhlaWdodCArIFwiXCIgOiB3LnN0eWxlLmhlaWdodCA9IFwiMTAwJVwiO1xuICAgICAgICB9IH0sIHNob3dCYWNrZHJvcDogRSwgaGlkZUJhY2tkcm9wOiBULCBjaGVja0JhY2tkcm9wQW5kQ29udGFpbmVyOiBPLCByZXNpemVJZnJhbWU6IE0sIGNlbnRlckl0OiBBLCBvcGVyYXRpb25XaXRoQ29udGFpbmVyOiBMLCBjbG9zZUNvbnRhaW5lcjogUywgY2xvc2VNb2RhbENvbnRhaW5lcjogZnVuY3Rpb24gKGUsIG4pIHsgUyhlLCBuLCAhMCk7IH0sIHB1cmdlSWZyYW1lOiBmdW5jdGlvbiAoZSwgbikgeyByLmRlYnVnKFwiUHVyZ2luZyBpZnJhbWVcIiwgZSk7IHZhciBpID0gc1tlXTsgdHJ5IHtcbiAgICAgICAgICAgIGlmIChpLnJlc2l6ZU9ic2VydmVyICYmIGkucmVzaXplT2JzZXJ2ZXIuZGlzY29ubmVjdCgpLCBvLnJlbW92ZUlmcmFtZShpLmlmcmFtZUlkKSwgdC5yZW1vdmUoaS5lbGVtZW50KSwgXCJpbmxpbmVcIiA9PT0gaS5jb25maWcuZGlzcGxheU1vZGUpIHtcbiAgICAgICAgICAgICAgICB2YXIgYSA9IHQucXVlcnlFbChcIi50cC1jb250YWluZXItaW5uZXJcIiwgaS5jb250YWluZXIpO1xuICAgICAgICAgICAgICAgIGEgJiYgdC5yZW1vdmUoYSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHsgfSBkZWxldGUgc1tlXTsgfSwgaGlkZU1vZGFsQ29udGFpbmVyOiBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IFtdOyBmb3IgKHZhciByIGluIHMpIHtcbiAgICAgICAgICAgIHZhciBvID0gc1tyXTtcbiAgICAgICAgICAgIGUgJiYgciAhPT0gZSB8fCBcImlubGluZVwiICE9PSBvLmNvbmZpZy5kaXNwbGF5TW9kZSAmJiBcIm1vZGFsXCIgPT09IG8uY29uZmlnLmRpc3BsYXlNb2RlICYmICh4KG8pLCB0LmhpZGUoby5jb250YWluZXIpLCBuLnB1c2gocikpO1xuICAgICAgICB9IHJldHVybiBuOyB9LCBjbG9zZU1vZGFsOiB4LCBoaWRlQ2xvc2VCdXR0b246IGZ1bmN0aW9uIChlKSB7IGlmIChlKSB7XG4gICAgICAgICAgICB2YXIgbiA9IHQucXVlcnlFbChcIi50cC1jbG9zZVwiLCBlKTtcbiAgICAgICAgICAgIG4gJiYgbi5jbGFzc0xpc3QuY29udGFpbnMoXCJ0cC1hY3RpdmVcIikgJiYgdC5yZW1vdmVDbGFzcyhcInRwLWFjdGl2ZVwiLCBuKTtcbiAgICAgICAgfSB9LCBhY3RpdmF0ZUNvbnRhaW5lcnM6IGZ1bmN0aW9uIChlKSB7IGlmIChlICYmIGUubGVuZ3RoKVxuICAgICAgICAgICAgZm9yICh2YXIgbiBpbiBzKVxuICAgICAgICAgICAgICAgIGZvciAodmFyIHIgPSBzW25dLCBvID0gMDsgbyA8IGUubGVuZ3RoOyBvKyspXG4gICAgICAgICAgICAgICAgICAgIGlmIChuID09PSBlW29dKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaSA9IHIuY29udGFpbmVyLCBhID0gaS5wYXJlbnRFbGVtZW50O1xuICAgICAgICAgICAgICAgICAgICAgICAgYSAmJiBFKGEpLCB0LmFkZENsYXNzKFwidHAtYWN0aXZlXCIsIGkpLCB0LnNob3coaSk7XG4gICAgICAgICAgICAgICAgICAgIH0gfSwgc2hvd1dhaXRQYW5lbDogSiwgaGlkZVdhaXRQYW5lbDogRywgYWRkQ2xhc3NUb0NvbnRhaW5lcjogZnVuY3Rpb24gKGUsIG4pIHsgdC5hZGRDbGFzcyhuLCBlLmNvbnRhaW5lcik7IH0sIHR1cm5PblJUTDogZnVuY3Rpb24gKGUpIHsgZS5jb250YWluZXIgJiYgZS5jb250YWluZXIuc2V0QXR0cmlidXRlICYmIGUuY29udGFpbmVyLnNldEF0dHJpYnV0ZShcImRpclwiLCBcInJ0bFwiKTsgfSwgdHVybk9mZlJUTDogZnVuY3Rpb24gKGUpIHsgZS5jb250YWluZXIgJiYgZS5jb250YWluZXIucmVtb3ZlQXR0cmlidXRlICYmIGUuY29udGFpbmVyLnJlbW92ZUF0dHJpYnV0ZShcImRpclwiKTsgfSwgc2V0SWZyYW1lc1BvcHN0YXRlSGFuZGxlcnM6IGZ1bmN0aW9uICgpIHsgKHIuaXNJcGhvbmUoKSB8fCByLmlzU2FmYXJpT3JJT3NVaVdlYlZpZXcoKSkgJiYgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJwb3BzdGF0ZVwiLCAkKTsgfSwgX19wcm90ZWN0ZWRfXzogeyBzZXRFbGVtZW50U2l6ZXM6IHosIGNsb3NlSW5saW5lQ29udGFpbmVyczogZnVuY3Rpb24gKGUpIHsgQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChlICsgXCIgPiAuXCIgKyBcInRwLWNvbnRhaW5lci1pbm5lciA+IGlmcmFtZVwiKSkuZm9yRWFjaCgoZnVuY3Rpb24gKGUpIHsgdmFyIG4sIHQ7IGUuaWQgJiYgKG4gPSBlLmlkLCAodCA9IEMobikpLmNvbmZpZy5jaGlsZCAmJiBTKHQuY29uZmlnLmNoaWxkKSwgUyhuKSk7IH0pKTsgfSwgYWRkQ2hpbGRUb0lubGluZUlmcmFtZTogZnVuY3Rpb24gKGUsIG4pIHsgaWYgKGUpIHtcbiAgICAgICAgICAgICAgICB2YXIgdCA9IEMobik7XG4gICAgICAgICAgICAgICAgdCAmJiB0LmNvbmZpZyAmJiAodC5jb25maWcuY2hpbGQgPSBlLmlmcmFtZUlkKTtcbiAgICAgICAgICAgIH0gfSwgY2xvc2VBbmRSZW1vdmVJZnJhbWU6IGsgfSwgX19wcml2YXRlX186IHsgbW9iaWxlTW9kYWxGaXg6IG0gfSB9OyB9KCk7XG4gICAgcG4uY29udGFpbmVyLnJlZ2lzdGVyKFwiY29udGFpbmVyVXRpbHNcIiwgeyB1c2VWYWx1ZTogTWUgfSksIHBuLmNvbnRhaW5lclV0aWxzID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJjb250YWluZXJVdGlsc1wiKTtcbiAgICB2YXIgT2UgPSBmdW5jdGlvbiAoZSkgeyB2b2lkIDAgPT09IGUgJiYgKGUgPSBwbi5jb250YWluZXIpOyB2YXIgbiA9IGUucmVzb2x2ZShcImFqYXhcIiksIHQgPSBlLnJlc29sdmUoXCJ1dGlsXCIpOyBlLnJlc29sdmUoXCJwb3N0bWVzc2FnZVwiKS5zdWJzY3JpYmUoXCJpZnJhbWVMb2dSZXF1ZXN0XCIsIChmdW5jdGlvbiAoZSkgeyBvKGUudXJsLCBlLnF1ZXJ5UGFyYW1zKTsgfSkpOyB2YXIgciA9IGZ1bmN0aW9uIChlKSB7IHZhciBuID0gW107IGZvciAodmFyIHQgaW4gZSkge1xuICAgICAgICB2YXIgciA9IGVbdF07XG4gICAgICAgIG4ucHVzaChlbmNvZGVVUklDb21wb25lbnQodCkgKyBcIj1cIiArIGVuY29kZVVSSUNvbXBvbmVudChcIm9iamVjdFwiID09IHR5cGVvZiByID8gSlNPTi5zdHJpbmdpZnkocikgOiByKSk7XG4gICAgfSByZXR1cm4gbi5qb2luKFwiJlwiKTsgfSwgbyA9IGZ1bmN0aW9uIChlLCBvKSB7IHZhciBpID0gcihvKTsgdC5pc1JlbGF0aXZlVXJsKGUudHJpbSgpKSA/IGkubGVuZ3RoID4gNmUzID8gbi5yZXF1ZXN0KHsgdHlwZTogXCJQT1NUXCIsIHVybDogcG4uZ2V0VHJhY2tpbmdFbmRwb2ludCgpICsgZSwgZGF0YTogaSB9KSA6IG4ucmVxdWVzdCh7IHVybDogcG4uZ2V0VHJhY2tpbmdFbmRwb2ludCgpICsgZSArIFwiP1wiICsgaSwgZGF0YVR5cGU6IFwianNvbnBcIiB9KSA6IHQubG9nKFwiVXJsIHBhcmFtZXRlciBpcyBpbmNvcnJlY3RcIik7IH0sIGkgPSBmdW5jdGlvbiAoZSwgbiwgciwgaSwgYSkgeyBlID8gciA/IG4gPyBvKFwiL2FwaS92My9jb252ZXJzaW9uL2xvZ0VzcE1pY3JvQ29udmVyc2lvblwiLCB7IHRyYWNraW5nX2lkOiBlLCBlc3Bfd2lkZ2V0X2lkOiBuLCBldmVudF90eXBlOiBpLCBldmVudF9ncm91cF9pZDogciwgY3VzdG9tX3BhcmFtczogYSB8fCBcIlwiIH0pIDogdC5sb2coXCJQYXJhbWV0ZXIgZXNwV2lkZ2V0SWQgaXMgcmVxdWlyZWQgdG8gbG9nIGVzcCBtaWNybyBjb252ZXJzaW9uLlwiKSA6IHQubG9nKFwiUGFyYW1ldGVyIGV2ZW50R3JvdXBJZCBpcyByZXF1aXJlZCB0byBsb2cgZXNwIG1pY3JvIGNvbnZlcnNpb24uXCIpIDogdC5sb2coXCJQYXJhbWV0ZXIgdHJhY2tpbmdJZCBpcyByZXF1aXJlZCB0byBsb2cgZXNwIG1pY3JvIGNvbnZlcnNpb24uXCIpOyB9LCBhID0gZnVuY3Rpb24gKGUsIG4sIHIsIGksIGEsIHMsIGMsIGwpIHsgdmFyIHUgPSB7IHRyYWNraW5nX2lkOiBlLCB0ZXJtX2lkOiBuLCB0ZXJtX25hbWU6IHIgfTsgZSA/IG4gPyByID8gKHZvaWQgMCAhPT0gaSAmJiAodS5zdGVwX251bWJlciA9IGkpLCB2b2lkIDAgIT09IGEgJiYgKHUuYW1vdW50ID0gYSksIHZvaWQgMCAhPT0gcyAmJiAodS5jdXJyZW5jeSA9IHMpLCB2b2lkIDAgIT09IGMgJiYgKHUuY3VzdG9tX3BhcmFtcyA9IGMpLCB2b2lkIDAgIT09IGwgJiYgKHUuY29udmVyc2lvbl9jYXRlZ29yeSA9IGwpLCBvKFwiL2FwaS92My9jb252ZXJzaW9uL2xvZ1wiLCB1KSkgOiB0LmxvZyhcIlBhcmFtZXRlciB0ZXJtTmFtZSBpcyByZXF1aXJlZCB0byBsb2cgY29udmVyc2lvbi5cIikgOiB0LmxvZyhcIlBhcmFtZXRlciB0ZXJtSWQgaXMgcmVxdWlyZWQgdG8gbG9nIGNvbnZlcnNpb24uXCIpIDogdC5sb2coXCJQYXJhbWV0ZXIgdHJhY2tpbmdJZCBpcyByZXF1aXJlZCB0byBsb2cgY29udmVyc2lvbi5cIik7IH0sIHMgPSBmdW5jdGlvbiAoZSwgbykgeyBpZiAoIShpID0gd2luZG93LmRvTm90VHJhY2sgfHwgd2luZG93Lm5hdmlnYXRvci5kb05vdFRyYWNrIHx8IHdpbmRvdy5uYXZpZ2F0b3IubXNEb05vdFRyYWNrKSB8fCBcIjFcIiAhPT0gaS5jaGFyQXQoMCkgJiYgXCJ5ZXNcIiAhPT0gaSkge1xuICAgICAgICB2YXIgaSwgYSwgcyA9IHIobyksIGMgPSBlICsgXCI/XCIgKyBzO1xuICAgICAgICBpZiAobmF2aWdhdG9yLnNlbmRCZWFjb24pXG4gICAgICAgICAgICBpZiAoYy5sZW5ndGggPiA2ZTMpIHtcbiAgICAgICAgICAgICAgICB2YXIgbCA9IG5ldyBCbG9iKFtzXSwgeyB0eXBlOiBcImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZFwiIH0pO1xuICAgICAgICAgICAgICAgIG5hdmlnYXRvci5zZW5kQmVhY29uKGUsIGwpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIG5hdmlnYXRvci5zZW5kQmVhY29uKGMpO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICAoYSA9IC0xICE9PSBuYXZpZ2F0b3IuYXBwVmVyc2lvbi5pbmRleE9mKFwiTVNJRSA5XCIpID8geyBkYXRhVHlwZTogXCJqc29ucFwiLCB1cmw6IGMgfSA6IHsgdHlwZTogXCJwb3N0XCIsIHVybDogYywgYXN5bmM6ICExLCB4aHJGaWVsZHM6IHsgd2l0aENyZWRlbnRpYWxzOiAhMCB9IH0pLmVycm9yID0gZnVuY3Rpb24gKCkgeyBmb3IgKHZhciBlID0gW10sIG4gPSAwOyBuIDwgYXJndW1lbnRzLmxlbmd0aDsgbisrKVxuICAgICAgICAgICAgICAgIGVbbl0gPSBhcmd1bWVudHNbbl07IHQuZGVidWcuYXBwbHkodCwgX2UoW1wiQmVhY29uIHJlcXVlc3QgaGFzIGJlZW4gZmFpbGVkXCJdLCBlLCAhMSkpOyB9LCBuLnJlcXVlc3QoYSk7XG4gICAgfSB9OyByZXR1cm4geyBuYW1lOiBcImxvZ1wiLCBsb2dNaWNyb0NvbnZlcnNpb246IGZ1bmN0aW9uIChlLCBuLCByKSB7IGUgPyBuID8gbyhcIi9hcGkvdjMvY29udmVyc2lvbi9sb2dNaWNyb0NvbnZlcnNpb25cIiwgeyB0cmFja2luZ19pZDogZSwgZXZlbnRfZ3JvdXBfaWQ6IG4sIGN1c3RvbV9wYXJhbXM6IHIgfHwgXCJcIiB9KSA6IHQubG9nKFwiUGFyYW1ldGVyIGV2ZW50R3JvdXBJZCBpcyByZXF1aXJlZCB0byBsb2cgbWljcm8gY29udmVyc2lvbi5cIikgOiB0LmxvZyhcIlBhcmFtZXRlciB0cmFja2luZ0lkIGlzIHJlcXVpcmVkIHRvIGxvZyBtaWNybyBjb252ZXJzaW9uLlwiKTsgfSwgbG9nQ29udmVyc2lvbjogZnVuY3Rpb24gKGUsIG4sIHQsIHIsIG8sIGksIHMsIGMpIHsgaWYgKFwib2JqZWN0XCIgPT0gdHlwZW9mIGUpIHtcbiAgICAgICAgICAgIHZhciBsID0gZTtcbiAgICAgICAgICAgIGEobC50cmFja2luZ19pZCwgbC50ZXJtX2lkLCBsLnRlcm1fbmFtZSwgbC5zdGVwX251bWJlciwgbC5hbW91bnQsIGwuY3VycmVuY3ksIGwuY3VzdG9tX3BhcmFtcywgbC5jb252ZXJzaW9uX2NhdGVnb3J5KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICBhKGUsIG4sIHQsIHIsIG8sIGksIHMsIGMpOyB9LCBsb2dGdW5uZWxTdGVwOiBmdW5jdGlvbiAoZSwgbiwgciwgaSkgeyBlID8gbiA/IHIgPyBvKFwiL2FwaS92My9jb252ZXJzaW9uL2xvZ0Z1bm5lbFN0ZXBcIiwgeyB0cmFja2luZ19pZDogZSwgc3RlcF9udW1iZXI6IG4sIHN0ZXBfbmFtZTogciwgY3VzdG9tX3BhcmFtczogaSB8fCBcIlwiIH0pIDogdC5sb2coXCJQYXJhbWV0ZXIgc3RlcE5hbWUgaXMgcmVxdWlyZWQgdG8gbG9nIGZ1bm5lbCBzdGVwLlwiKSA6IHQubG9nKFwiUGFyYW1ldGVyIHN0ZXBOdW1iZXIgaXMgcmVxdWlyZWQgdG8gbG9nIGZ1bm5lbCBzdGVwLlwiKSA6IHQubG9nKFwiUGFyYW1ldGVyIHRyYWNraW5nSWQgaXMgcmVxdWlyZWQgdG8gbG9nIGZ1bm5lbCBzdGVwLlwiKTsgfSwgbG9nRXNwTWljcm9Db252ZXJzaW9uOiBpLCBsb2dCZWFjb25SZXF1ZXN0OiBzLCBfX3Byb3RlY3RlZF9fOiB7IGxvZ0N1c3RvbUZvcm1JbXByZXNzaW9uOiBmdW5jdGlvbiAoZSwgbiwgcikgeyBuIHx8IHQubG9nKFwiUGFyYW1ldGVyIGZvcm1OYW1lIGlzIHJlcXVpcmVkIHRvIGxvZyBpbXByZXNzaW9uLlwiKSwgciB8fCB0LmxvZyhcIlBhcmFtZXRlciBzb3VyY2UgaXMgcmVxdWlyZWQgdG8gbG9nIGltcHJlc3Npb24uXCIpOyB2YXIgaSA9IHsgYWlkOiBwbi5haWQsIHBhZ2V2aWV3X2lkOiBwbi5tYWluLmZldGNoUGFnZVZpZXdJZCgpLCBjdXN0b21fZm9ybV9uYW1lOiBuLCBjdXN0b21fZm9ybV9zb3VyY2U6IHIgfSwgYSA9IHBuLnVzZXIuZ2V0UHJvdmlkZXIoKS5nZXRUb2tlbigpOyByZXR1cm4gYSAmJiAoaS51c2VyX3Rva2VuID0gYSksIGUgJiYgKGkudHJhY2tpbmdfaWQgPSBlKSwgbyhcIi9hcGkvdjMvY3VzdG9tZm9ybS9sb2cvaW1wcmVzc2lvblwiLCBpKTsgfSwgbG9nQ3VzdG9tRm9ybVN1Ym1pc3Npb246IGZ1bmN0aW9uIChlLCBuLCByKSB7IG4gfHwgdC5sb2coXCJQYXJhbWV0ZXIgZm9ybU5hbWUgaXMgcmVxdWlyZWQgdG8gbG9nIHN1Ym1pc3Npb24uXCIpLCByIHx8IHQubG9nKFwiUGFyYW1ldGVyIHNvdXJjZSBpcyByZXF1aXJlZCB0byBsb2cgc3VibWlzc2lvbi5cIik7IHZhciBpID0geyBhaWQ6IHBuLmFpZCwgcGFnZXZpZXdfaWQ6IHBuLm1haW4uZmV0Y2hQYWdlVmlld0lkKCksIGN1c3RvbV9mb3JtX25hbWU6IG4sIGN1c3RvbV9mb3JtX3NvdXJjZTogciB9LCBhID0gcG4udXNlci5nZXRQcm92aWRlcigpLmdldFRva2VuKCk7IHJldHVybiBhICYmIChpLnVzZXJfdG9rZW4gPSBhKSwgZSAmJiAoaS50cmFja2luZ19pZCA9IGUpLCBvKFwiL2FwaS92My9jdXN0b21mb3JtL2xvZy9zdWJtaXNzaW9uXCIsIGkpOyB9LCBsb2dFc3BNaWNyb0NvbnZlcnNpb246IGkgfSwgX19wcml2YXRlX186IHsgZG9Mb2c6IG8sIGxvZ0JlYWNvblJlcXVlc3Q6IHMgfSB9OyB9O1xuICAgIHBuLmNvbnRhaW5lci5yZWdpc3RlcihcImxvZ1wiLCB7IHVzZVZhbHVlOiBPZSgpIH0pLCBwbi5sb2cgPSBwbi5jb250YWluZXIucmVzb2x2ZShcImxvZ1wiKTtcbiAgICB2YXIgUmUgPSBmdW5jdGlvbiAoKSB7IHZhciBlID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJsb2dcIiksIG4gPSBwbi5jb250YWluZXIucmVzb2x2ZShcImFwaVwiKSwgdCA9IHsgY29tcGxldGVJbml0OiAwLCBleHBFeGVjOiAwLCBpZFNob3c6IDAsIG15QWNjb3VudFNob3c6IDAsIG9mZmVyU2hvdzogMCwgdGVtcGxhdGVTaG93OiAwLCB0cEFjY1Nob3c6IDAsIHRyYWNrOiAwIH07IHNldFRpbWVvdXQoKGZ1bmN0aW9uICgpIHsgcigpOyB9KSwgMWU0KTsgdmFyIHIgPSBmdW5jdGlvbiAocikgeyBpZiAoTWF0aC5mbG9vcig1MDAgKiBNYXRoLnJhbmRvbSgpKSArIDEgPT09IDI1NSkge1xuICAgICAgICB2YXIgbyA9IHIgfHwgKHBuLmZ1bGxUUFZlcnNpb24gPyBcInRzX2NcIiA6IFwidHNfc1wiKSwgaSA9IHsgY29tcGxldGVJbml0OiB0LmNvbXBsZXRlSW5pdCwgdHJhY2s6IHQudHJhY2ssIGV4cEV4ZWM6IHQuZXhwRXhlYywgaWRTaG93OiB0LmlkU2hvdywgbXlBY2NvdW50U2hvdzogdC5teUFjY291bnRTaG93LCBvZmZlclNob3c6IHQub2ZmZXJTaG93LCB0ZW1wbGF0ZVNob3c6IHQudGVtcGxhdGVTaG93LCB0cEFjY1Nob3c6IHQudHBBY2NTaG93LCBhaWQ6IHBuLmFpZCwgdHlwZTogbyB9O1xuICAgICAgICBlLmxvZ0JlYWNvblJlcXVlc3Qobi5nZXRFbmRwb2ludCgpICsgXCIvaW50ZXJuYWwvYW5vbi90ZWxlbWV0cnkvdXgvaW5pdC90aW1lL2xvZ1wiLCBpKTtcbiAgICB9IH07IHJldHVybiB7IG5hbWU6IFwibG9nZ2luZ1wiLCBzZXRUaW1lOiBmdW5jdGlvbiAoZSkgeyAwID09PSB0W2VdICYmICh0W2VdID0gTWF0aC5yb3VuZChwZXJmb3JtYW5jZS5ub3coKSAtIHdpbmRvdy5wbkluaXRQZXJmb3JtYW5jZSkpOyB9IH07IH0oKTtcbiAgICBwbi5jb250YWluZXIucmVnaXN0ZXIoXCJsb2dnaW5nXCIsIHsgdXNlVmFsdWU6IFJlIH0pLCBwbi5sb2dnaW5nID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJsb2dnaW5nXCIpO1xuICAgIHZhciBMZTtcbiAgICAhZnVuY3Rpb24gKGUpIHsgZS5BVVRPID0gXCJBXCIsIGUuTUFOVUFMID0gXCJNXCI7IH0oTGUgfHwgKExlID0ge30pKTtcbiAgICB2YXIgTmUgPSBmdW5jdGlvbiAoKSB7IHZhciBlID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJ1dGlsXCIpLCBuID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJhamF4XCIpLCB0ID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJqcVV0aWxzXCIpLCByID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJldmVudFV0aWxzXCIpLCBvID0gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIE9iamVjdC5lbnRyaWVzKGUpLnJlZHVjZSgoZnVuY3Rpb24gKGUsIG4pIHsgdmFyIHQgPSBuWzBdLCByID0gblsxXTsgcmV0dXJuIChyIHx8IDAgPT09IHIpICYmIChlW3RdID0gciksIGU7IH0pLCB7fSk7IH0sIGkgPSByLmNyZWF0ZUV2ZW50TWFuYWdlcihbXSksIGEgPSBmdW5jdGlvbiAociwgaSwgYSkgeyByZXR1cm4gbmV3IFByb21pc2UoKGZ1bmN0aW9uIChzLCBjKSB7IHZhciBsID0gYSA/IFwiP1wiICsgdC5wYXJhbShhKSA6IFwiXCIsIHUgPSBwbi5nZXRFeHBlcmllbmNlRW5kcG9pbnQoITEpICsgXCIvXCIgKyBwbi5haWQgKyByICsgbCwgZCA9IG8oeyB4YmM6IGUuX19wcm90ZWN0ZWRfXy5nZXRDb29raWUoXCJ4YmNcIikgfHwgdm9pZCAwLCB0YmM6IGUuZ2V0VGJjQ29va2llKCkgfHwgdm9pZCAwIH0pLCBwID0gbyh5ZSh5ZSh7fSwgZCksIGkpKTsgaWYgKCEocC5jaWQgJiYgcC5pdGVtSWQgJiYgcC54YmMpKSB7XG4gICAgICAgIHZhciBmID0gXCJjcmVkaXQ6IEVycm9yOiBSZXF1aXJlZCBwYXJhbXMgYXJlIGFic2VudFwiO1xuICAgICAgICBlLmRlYnVnKGYpLCBjKHsgY29kZTogMCwgbWVzc2FnZTogZiB9KTtcbiAgICB9IG4ucmVxdWVzdCh7IHR5cGU6IFwicG9zdFwiLCB1cmw6IHUsIGRhdGE6IHllKHllKHt9LCBkKSwgaSksIHhockZpZWxkczogeyB3aXRoQ3JlZGVudGlhbHM6ICEwIH0sIGVycm9yOiBmdW5jdGlvbiAobikgeyB2YXIgdCA9IFwiY3JlZGl0OiBFcnJvcjogUmVjZWl2ZWQgZXJyb3I6XCIgKyBuLnN0YXR1cyArIFwiIFwiICsgbi5yZXNwb25zZVRleHQ7IGUuZGVidWcodCksIGMoeyBjb2RlOiBuLnN0YXR1cywgbWVzc2FnZTogbi5yZXNwb25zZVRleHQgfSk7IH0sIHN1Y2Nlc3M6IGZ1bmN0aW9uIChlKSB7IHMoZSk7IH0gfSk7IH0pKTsgfSwgcyA9IGZ1bmN0aW9uIChlLCBuLCB0LCByKSB7IHZhciBvID0gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGZ1bmN0aW9uIChuKSB7IHJldHVybiBpLmZpcmUodm9pZCAwLCBlLCAhMCwgbiksIG47IH07IH0sIHMgPSBvKFwic3RyaW5nXCIgPT0gdHlwZW9mIGUgPyBlIDogZS5zdWNjZXNzKSwgYyA9IG8oXCJzdHJpbmdcIiA9PSB0eXBlb2YgZSA/IGUgOiBlLmZhaWx1cmUpOyByZXR1cm4gYShuLCB0LCByKS50aGVuKHMpLmNhdGNoKGMpOyB9OyByZXR1cm4geyByZWRlZW06IGZ1bmN0aW9uIChlKSB7IHJldHVybiBzKFwibWFudWFsQ3JlZGl0UmVkZWVtZWRcIiwgXCIvZXhlY3V0aW9uL2NyZWRpdC9yZWRlZW1cIiwgZSk7IH0sIGNoZWNrOiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gcyhcImNyZWRpdENoZWNrZWRcIiwgXCIvZXhlY3V0aW9uL2NyZWRpdC9jaGVja1wiLCBlKTsgfSwgcmVnaXN0ZXJDYWxsYmFjazogZnVuY3Rpb24gKGUsIG4pIHsgaS5hZGRFdmVudChlKSwgaS5yZWdpc3RlckNhbGxiYWNrKGUsIG4pOyB9IH07IH0oKTtcbiAgICBwbi5jb250YWluZXIucmVnaXN0ZXIoXCJjcmVkaXRcIiwgeyB1c2VWYWx1ZTogTmUgfSksIHBuLmNyZWRpdCA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwiY3JlZGl0XCIpO1xuICAgIHZhciBVZSA9IGZ1bmN0aW9uICgpIHsgdmFyIGUsIG4gPSBwbi5jb250YWluZXIucmVzb2x2ZShcInBvc3RtZXNzYWdlXCIpLCB0ID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJjb250YWluZXJVdGlsc1wiKSwgciA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwidXRpbFwiKSwgbyA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwiZXZlbnRVdGlsc1wiKSwgaSA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwibG9nZ2luZ1wiKSwgYSA9IG8uY3JlYXRlRXZlbnRNYW5hZ2VyKFtcInJlc2l6ZVwiLCBcImxvZ2luU3VjY2Vzc1wiLCBcImxvZ291dFwiXSksIHMgPSBmdW5jdGlvbiAoKSB7IHJldHVybiBwbi5nZXRFbmRwb2ludFJvb3QoITApICsgXCIvY2hlY2tvdXQvdXNlci9sb2dpblNob3dcIjsgfTsgZnVuY3Rpb24gYyhvKSB7IHIuZGVidWcoXCJMb2dpbiBldmVudCByZWNlaXZlZFwiLCBvLmV2ZW50LCBvLnBhcmFtcywgbyk7IHZhciBpID0gIXQuZ2V0SWZyYW1lKG8uc2VuZGVyKS5jb25maWcucGFyZW50OyBzd2l0Y2ggKG8uZXZlbnQpIHtcbiAgICAgICAgY2FzZSBcImxvYWRlZFwiOlxuICAgICAgICAgICAgZSA9ICExO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJjbG9zZVwiOlxuICAgICAgICAgICAgdC5jbG9zZU1vZGFsQ29udGFpbmVyKCksIGEuZmlyZUNhbGxiYWNrcyhvLmV2ZW50LCBvLnBhcmFtcywgby5zZW5kZXIsIGkpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJjYW5jZWxcIjpcbiAgICAgICAgY2FzZSBcImVycm9yXCI6XG4gICAgICAgIGNhc2UgXCJjdXN0b21FdmVudFwiOlxuICAgICAgICAgICAgYS5maXJlQ2FsbGJhY2tzKG8uZXZlbnQsIG8ucGFyYW1zLCBvLnNlbmRlciwgaSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImxvZ2luU3VjY2Vzc1wiOlxuICAgICAgICAgICAgIWZ1bmN0aW9uIChlLCBuLCBvLCBpKSB7IHZhciBzID0gdC5nZXRJZnJhbWUobyk7IHIuc2V0QWNjZXNzVG9rZW5MaXN0Q29va2llKHsgdmFsdWU6IG4udG9rZW5fbGlzdCwgY29va2llX2RvbWFpbjogbi5jb29raWVfZG9tYWluIH0sIG4udXNlcl90b2tlbiksIHMuY29uZmlnLnVzZXJUb2tlbiA9IG4udXNlcl90b2tlbiwgcyAmJiBzLmNvbmZpZyAmJiBzLmNvbmZpZy5sb2dpblN1Y2Nlc3MgJiYgcy5jb25maWcubG9naW5TdWNjZXNzKG4uZXZlbnQsIG4ucGFyYW1zLCBuLnNlbmRlcik7IGEuZmlyZUNhbGxiYWNrcyhlLCBuLCBvLCBpKSwgcyAmJiBzLmNvbmZpZyAmJiBzLmNvbmZpZy5jbG9zZUFmdGVyU3VjY2VzcyAmJiB0LmNsb3NlTW9kYWxDb250YWluZXIobyk7IHZhciBjID0geyByZWxvYWRBZnRlckxvZ2luOiAhMCwgdXNlclRva2VuOiBuLnVzZXJfdG9rZW4sIHVzZXI6IG4udXNlciB9OyB1KGMpOyB9KG8uZXZlbnQsIG8ucGFyYW1zLCBvLnNlbmRlciwgaSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImxvZ291dFN1Y2Nlc3NcIjpcbiAgICAgICAgICAgICFmdW5jdGlvbiAoZSwgbiwgdCwgbykgeyBhLmZpcmVDYWxsYmFja3MoXCJsb2dvdXRcIiwgbnVsbCwgdm9pZCAwLCAhMCksIHIuc2V0QWNjZXNzVG9rZW5MaXN0Q29va2llKHsgdmFsdWU6IG4udG9rZW5fbGlzdCwgY29va2llX2RvbWFpbjogbi5jb29raWVfZG9tYWluIH0sIG4udXNlcl90b2tlbiwgITApOyB9KG8uZXZlbnQsIG8ucGFyYW1zLCBvLnNlbmRlcik7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcInJlYWR5VG9TdWJtaXRTdGF0c1wiOlxuICAgICAgICAgICAgdmFyIHMgPSB7IHBhZ2VWaWV3SWQ6IHBuLm1haW4uZmV0Y2hQYWdlVmlld0lkKCksIHRiYzogci5nZXRUYmNDb29raWUoKSB9O1xuICAgICAgICAgICAgbi5zZW5kKFwic3VibWl0U3RhdHNcIiwgcywgby5zZW5kZXIpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGRlZmF1bHQ6IHJldHVybiB2b2lkIHIuZGVidWcoXCJSZWNlaXZlZCBpbnZhbGlkIGV2ZW50IHR5cGU6IFwiICsgby5ldmVudCk7XG4gICAgfSB9IHZhciBsLCB1ID0gZnVuY3Rpb24gKGUpIHsgbi5icm9hZGNhc3QoXCJyZWxvYWRPZmZlclwiLCBlKTsgfTsgZnVuY3Rpb24gZChlKSB7IGwgJiYgdC5jbG9zZU1vZGFsQ29udGFpbmVyKGwpOyB2YXIgbiA9IHt9OyBPYmplY3QuYXNzaWduKG4sIHsgY2xvc2VBZnRlclN1Y2Nlc3M6ICEwIH0sIGUpLCBuLmRpc3BsYXlNb2RlID0gXCJwb3B1cFwiLCBuLndpZHRoID0gMzYwLCBuLmhlaWdodCA9IDY2MCwgbi5zdGF0ZSA9IG4uc3RhdGUgPyBuLnN0YXRlIDogXCJsb2dpblwiOyB2YXIgbywgaSA9IGZ1bmN0aW9uIChlKSB7IHZhciBuID0ge307IHJldHVybiBbXCJkaXNwbGF5TW9kZVwiLCBcImFpZFwiLCBcIndpZHRoXCIsIFwiaGVpZ2h0XCIsIFwic3RhdGVcIl0uZm9yRWFjaCgoZnVuY3Rpb24gKHQpIHsgZVt0XSAmJiAoblt0XSA9IGVbdF0pOyB9KSksIG47IH0obik7IGkuaWZyYW1lSWQgPSByLnJhbmRvbVN0cmluZygxNiksIGkudXJsID0gd2luZG93LmxvY2F0aW9uLmhyZWYsIGkuaG9zdF91cmwgPSB3aW5kb3cubG9jYXRpb24uaHJlZiwgbCA9IGkuaWZyYW1lSWQsIGZ1bmN0aW9uIChlKSB7IFtcImFpZFwiLCBcImdhQ2xpZW50SWRcIiwgXCJ0YWdzXCIsIFwiY29udGVudFNlY3Rpb25cIiwgXCJjb250ZW50QXV0aG9yXCJdLmZvckVhY2goKGZ1bmN0aW9uIChuKSB7IHBuW25dICYmIChlW25dID0gcG5bbl0pOyB9KSksIHBuLmNvbnRlbnRDcmVhdGVkICYmIChlLmNvbnRlbnRDcmVhdGVkID0gcG4uY29udGVudENyZWF0ZWQpOyB9KGkpLCBpLnVzZXJfcHJvdmlkZXIgPSBcInRpbnlwYXNzX2FjY291bnRzXCIsIGUudXNlclRva2VuICYmIChpLnVzZXJfdG9rZW4gPSBlLnVzZXJUb2tlbiksIHIuZ2V0Q2FtcGFpZ25zKGkpOyB2YXIgdSA9IHsgdXJsOiBzKCksIGNvbmZpZzogbiwgcG9zdE1lc3NhZ2VVcmw6IHMoKSwgcmVjZWl2ZTogYywgaWZyYW1lUGFyYW1zOiBpIH07IHJldHVybiBuLmlmcmFtZUlkID8gKHUuaWZyYW1lUGFyYW1zLmlmcmFtZUlkID0gbi5pZnJhbWVJZCwgbyA9IHQucmVkaXJlY3RDb250YWluZXIobi5pZnJhbWVJZCwgdSkpIDogbyA9IHQuY3JlYXRlQ29udGFpbmVyKHUpLCBhLnJlZ2lzdGVyQ2FsbGJhY2sobiwgaS5pZnJhbWVJZCksIG87IH0gcmV0dXJuIHsgbmFtZTogXCJ0aW55cGFzc0xvZ2luXCIsIHNob3c6IGZ1bmN0aW9uIChuKSB7IGlmIChlKVxuICAgICAgICAgICAgcmV0dXJuICExOyBlID0gITAsIHNldFRpbWVvdXQoKGZ1bmN0aW9uICgpIHsgZSA9ICExOyB9KSwgMWU0KSwgZChuKSB8fCByLmVycm9yKFwiQ291bGQgbm90IGluaXRpYWxpemUgbG9naW47IGNoZWNrIGNvbmZpZ3VyYXRpb25cIiksIGkuc2V0VGltZShcInRwQWNjU2hvd1wiKTsgfSwgY2xvc2U6IGZ1bmN0aW9uICgpIHsgdC5jbG9zZU1vZGFsQ29udGFpbmVyKCk7IH0sIHNob3dCYWNrZHJvcDogZnVuY3Rpb24gKCkgeyB0LnNob3dCYWNrZHJvcCgpOyB9LCBoaWRlQmFja2Ryb3A6IGZ1bmN0aW9uICgpIHsgdC5oaWRlQmFja2Ryb3AoKTsgfSwgY2VudGVyQmFja2Ryb3A6IGZ1bmN0aW9uIChlKSB7IHQuY2VudGVyQmFja2Ryb3AoZSk7IH0sIHJlZ2lzdGVyQ2FsbGJhY2s6IGZ1bmN0aW9uIChlLCBuKSB7IGEucmVnaXN0ZXJDYWxsYmFjayhlLCBuKTsgfSwgbGlzdGVuTG9naW46IGZ1bmN0aW9uIChlKSB7ICFmdW5jdGlvbiAoZSkgeyBhLnJlZ2lzdGVyQ2FsbGJhY2soZSwgZS5pZnJhbWVJZCk7IHZhciB0ID0geyBpZnJhbWVJZDogZS5pZnJhbWVJZCwgY29uZmlnOiBlLCBpZnJhbWVQYXJhbXM6IGUgfTsgbi5pbml0KHsgcG9zdE1lc3NhZ2VVcmw6IHMoKSwgcmVjZWl2ZTogYywgaWZyYW1lOiB0LCBpZnJhbWVQYXJhbXM6IHt9IH0pOyB9KGUpOyB9IH07IH0oKTtcbiAgICBwbi5jb250YWluZXIucmVnaXN0ZXIoXCJ0aW55cGFzc0xvZ2luXCIsIHsgdXNlVmFsdWU6IFVlIH0pLCBwbi50aW55cGFzc0xvZ2luID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJ0aW55cGFzc0xvZ2luXCIpO1xuICAgIHZhciBqZSA9IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSBwbi5jb250YWluZXIucmVzb2x2ZShcImFqYXhcIiksIG4gPSBwbi5jb250YWluZXIucmVzb2x2ZShcImpxVXRpbHNcIiksIHQgPSBwbi5jb250YWluZXIucmVzb2x2ZShcInV0aWxcIiksIHIgPSBwbi5jb250YWluZXIucmVzb2x2ZShcInRpbnlwYXNzTG9naW5cIiksIG8gPSBwbi5jb250YWluZXIucmVzb2x2ZShcImV2ZW50VXRpbHNcIikuY3JlYXRlRXZlbnRNYW5hZ2VyKFtcImxvZ291dFwiXSksIGkgPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0LmdldFVzZXJUb2tlbkNvb2tpZSgpIHx8IG51bGw7IH07IHJldHVybiB7IG5hbWU6IFwidGlueXBhc3NBY2NvdW50c1wiLCBpc3Y6ICExLCBpc1VzZXJWYWxpZDogZnVuY3Rpb24gKCkgeyByZXR1cm4gISF0LmdldFVzZXJUb2tlbkNvb2tpZSgpOyB9LCBnZXRUb2tlbjogaSwgZ2V0TmFtZTogZnVuY3Rpb24gKCkgeyByZXR1cm4gXCJ0aW55cGFzc19hY2NvdW50c1wiOyB9LCBvbkxvZ2luU3VjY2VzczogZnVuY3Rpb24gKGUpIHsgdC5zZXRBY2Nlc3NUb2tlbkxpc3RDb29raWUoeyB2YWx1ZTogZS50b2tlbl9saXN0LCBjb29raWVfZG9tYWluOiBlLmNvb2tpZV9kb21haW4gfSwgZS51c2VyX3Rva2VuKTsgfSwgaXNDb25maWd1cmVkOiBmdW5jdGlvbiAoKSB7IHJldHVybiAhMCA9PT0gcG4udXNlVGlueXBhc3NBY2NvdW50cyB8fCBcInN0cmluZ1wiID09IHR5cGVvZiBwbi51c2VUaW55cGFzc0FjY291bnRzICYmIFwidHJ1ZVwiID09PSBwbi51c2VUaW55cGFzc0FjY291bnRzOyB9LCBsb2dpbjogZnVuY3Rpb24gKGUpIHsgcmV0dXJuIChlID0gZSB8fCB7fSkudXNlclRva2VuID0gaSgpLCByLnNob3coZSk7IH0sIGxvZ291dDogZnVuY3Rpb24gKHIpIHsgdmFyIGkgPSB7IGFpZDogcG4uYWlkLCB1cmw6IGRvY3VtZW50LmxvY2F0aW9uLmhyZWYgfSwgYSA9IHBuLmdldEVuZHBvaW50Um9vdCghMCkgKyBcIi9jaGVja291dC91c2VyL2xvZ291dD9cIiArIG4ucGFyYW0oaSk7IHQuc2V0QWNjZXNzVG9rZW5MaXN0Q29va2llKHsgdmFsdWU6IG51bGwgfSwgdm9pZCAwLCAhMCksIGUucmVxdWVzdCh7IHVybDogYSwgZGF0YVR5cGU6IFwianNvbnBcIiwgc3VjY2VzczogZnVuY3Rpb24gKGUpIHsgdC5zZXRBY2Nlc3NUb2tlbkxpc3RDb29raWUoeyB2YWx1ZTogXCJcIiwgY29va2llX2RvbWFpbjogZS5tb2RlbHMuY29va2llX2RvbWFpbiB9LCBlLm1vZGVscy51c2VyX3Rva2VuLCAhMCksIG8uZmlyZUNhbGxiYWNrcyhcImxvZ291dFwiLCBudWxsLCB2b2lkIDAsICEwKSwgciAmJiByKGUpOyB9LCBlcnJvcjogZnVuY3Rpb24gKGUpIHsgdC5zZXRBY2Nlc3NUb2tlbkxpc3RDb29raWUobnVsbCwgdm9pZCAwLCAhMCksIG8uZmlyZUNhbGxiYWNrcyhcImxvZ291dFwiLCBudWxsLCB2b2lkIDAsICEwKSwgciAmJiByKGUpOyB9IH0pOyB9LCByZWdpc3RlckNhbGxiYWNrOiBmdW5jdGlvbiAoZSwgbikgeyBvLmFkZEV2ZW50KGUpLCBvLnJlZ2lzdGVyQ2FsbGJhY2soZSwgbik7IH0gfTsgfSgpO1xuICAgIHBuLmNvbnRhaW5lci5yZWdpc3RlcihcInRpbnlwYXNzQWNjb3VudHNcIiwgeyB1c2VWYWx1ZTogamUgfSksIHBuLnRpbnlwYXNzQWNjb3VudHMgPSBwbi5jb250YWluZXIucmVzb2x2ZShcInRpbnlwYXNzQWNjb3VudHNcIik7XG4gICAgdmFyIERlID0gZnVuY3Rpb24gKCkgeyB2YXIgZSA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwianFVdGlsc1wiKSwgbiA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwiY29va2llXCIpLCB0ID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJ1dGlsXCIpLCByID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJldmVudFV0aWxzXCIpLmNyZWF0ZUV2ZW50TWFuYWdlcihbXCJsb2dvdXRcIl0pOyByZXR1cm4geyBpc3Y6ICExLCBuYW1lOiBcImNvbmRlVXNlclByb3ZpZGVyXCIsIGdldE5hbWU6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIFwiY29uZGVcIjsgfSwgaXNVc2VyVmFsaWQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuICEhdC5nZXRVc2VyVG9rZW5Db29raWUoKTsgfSwgZ2V0VG9rZW46IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSB0LmZpbmRDb29raWVCeU5hbWUoXCJhbWdfdXNlcl9wYXJ0bmVyXCIpOyByZXR1cm4gdm9pZCAwICE9PSBlICYmIGUgJiYgZS5sZW5ndGggPj0gMCA/IGUgOiBudWxsOyB9LCBvbkxvZ2luU3VjY2VzczogZnVuY3Rpb24gKHIpIHsgdC5zZXRBY2Nlc3NUb2tlbkxpc3RDb29raWUoeyB2YWx1ZTogci50b2tlbl9saXN0LCBjb29raWVfZG9tYWluOiByLmNvb2tpZV9kb21haW4gfSwgci51c2VyX3Rva2VuKTsgdmFyIG8gPSB7IHBhdGg6IFwiL1wiLCBleHBpcmVzOiA3MzAgfTsgci5jb29raWVfZG9tYWluICYmIFwibG9jYWxob3N0XCIgIT09IHIuY29va2llX2RvbWFpbiAmJiBlLmluQXJyYXkoci5jb29raWVfZG9tYWluLCB0LmdldFBvc3NpYmxlQ29va2llRG9tYWlucygpKSA+PSAwICYmIChvLmRvbWFpbiA9IHIuY29va2llX2RvbWFpbiksIG4ucmF3ID0gITAsIHQuX19wcm90ZWN0ZWRfXy5zZXRDb29raWUoci5wYXJhbXMuY29va2llTmFtZSwgci5wYXJhbXMuY29va2llVmFsdWUsIG8pLCB0Ll9fcHJvdGVjdGVkX18uc2V0Q29va2llKFwiYW1nX3VzZXJfcGFydG5lclwiLCByLnBhcmFtcy5leHRlcm5hbElkLCBvKSwgdC5fX3Byb3RlY3RlZF9fLnNldENvb2tpZShcImFtZ191c2VyX2luZm9cIiwgci5wYXJhbXMudXNlck5hbWUsIG8pLCB0Ll9fcHJvdGVjdGVkX18uc2V0Q29va2llKFwiYW1nX3VzZXJfZXh0XCIsIHIucGFyYW1zLnNpdGVVc2VySWQsIG8pLCByLnBhcmFtcy51cGRhdGVUb2tlbiAmJiB0Ll9fcHJvdGVjdGVkX18uc2V0Q29va2llKFwiYW1nX3VzZXJfdXBkYXRlXCIsIHIucGFyYW1zLnVwZGF0ZVRva2VuLCBvKSwgbi5yYXcgPSAhMTsgfSwgbG9nb3V0OiBmdW5jdGlvbiAoZSkgeyB0LnNldEFjY2Vzc1Rva2VuTGlzdENvb2tpZSh7IHZhbHVlOiBudWxsIH0sIHZvaWQgMCwgITApOyB2YXIgbiA9IHQuZ2V0UG9zc2libGVDb29raWVEb21haW5zKCk7IGZvciAodmFyIG8gaW4gbilcbiAgICAgICAgICAgIHQuZGVsZXRlQ29va2llKFwiYW1nX3VzZXJcIiwgbltvXSksIHQuZGVsZXRlQ29va2llKFwiYW1nX3VzZXJfcGFydG5lclwiLCBuW29dKSwgdC5kZWxldGVDb29raWUoXCJhbWdfdXNlcl9pbmZvXCIsIG5bb10pLCB0LmRlbGV0ZUNvb2tpZShcImFtZ191c2VyX2V4dFwiLCBuW29dKSwgdC5kZWxldGVDb29raWUoXCJhbWdfdXNlcl91cGRhdGVcIiwgbltvXSk7IHQuZGVsZXRlQ29va2llKFwiYW1nX3VzZXJcIiksIHQuZGVsZXRlQ29va2llKFwiYW1nX3VzZXJfcGFydG5lclwiKSwgdC5kZWxldGVDb29raWUoXCJhbWdfdXNlcl9pbmZvXCIpLCB0LmRlbGV0ZUNvb2tpZShcImFtZ191c2VyX2V4dFwiKSwgdC5kZWxldGVDb29raWUoXCJhbWdfdXNlcl91cGRhdGVcIiksIHIuZmlyZUNhbGxiYWNrcyhcImxvZ291dFwiLCBudWxsLCB2b2lkIDAsICEwKSwgZSAmJiBlKCk7IH0sIGlzQ29uZmlndXJlZDogZnVuY3Rpb24gKCkgeyByZXR1cm4gITAgPT09IHBuLnVzZUNvbmRlVXNlclByb3ZpZGVyIHx8IFwic3RyaW5nXCIgPT0gdHlwZW9mIHBuLnVzZUNvbmRlVXNlclByb3ZpZGVyICYmIFwidHJ1ZVwiID09PSBwbi51c2VDb25kZVVzZXJQcm92aWRlcjsgfSwgcmVnaXN0ZXJDYWxsYmFjazogZnVuY3Rpb24gKGUsIG4pIHsgci5hZGRFdmVudChlKSwgci5yZWdpc3RlckNhbGxiYWNrKGUsIG4pOyB9IH07IH0oKTtcbiAgICBwbi5jb250YWluZXIucmVnaXN0ZXIoXCJjb25kZVVzZXJQcm92aWRlclwiLCB7IHVzZVZhbHVlOiBEZSB9KSwgcG4uY29uZGVVc2VyUHJvdmlkZXIgPSBwbi5jb250YWluZXIucmVzb2x2ZShcImNvbmRlVXNlclByb3ZpZGVyXCIpO1xuICAgIHZhciBGZSA9IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSBwbi5jb250YWluZXIucmVzb2x2ZShcInV0aWxcIiksIG4gPSBwbi5jb250YWluZXIucmVzb2x2ZShcImFwaVwiKSwgdCA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwiZXZlbnRVdGlsc1wiKSwgciA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwianFVdGlsc1wiKSwgbyA9ICExOyB2YXIgaSA9IHQuY3JlYXRlRXZlbnRNYW5hZ2VyKFtcInVzZXJDaGFuZ2VkXCIsIFwib25IaWRlXCIsIFwibG9nb3V0XCJdKSwgYSA9IHsgYXBpS2V5OiBudWxsLCBzY3JlZW5TZXQ6IFwiRGVmYXVsdC1SZWdpc3RyYXRpb25Mb2dpblwiLCBzdGFydFNjcmVlbjogbnVsbCwgZW5hYmxlZFByb3ZpZGVyczogbnVsbCwgbGFuZzogbnVsbCB9OyBmdW5jdGlvbiBzKCkgeyB2YXIgbiA9IGUuZ2V0VXNlclRva2VuQ29va2llKCk7IGlmIChuICYmIGUuZmluZENvb2tpZUJ5TmFtZShcImdsdF9cIiArIGEuYXBpS2V5KSA9PT0gZS5maW5kQ29va2llQnlOYW1lKFwiX191dGdfXCIgKyBhLmFwaUtleSkpXG4gICAgICAgIHJldHVybiBuOyByZXR1cm4gbnVsbDsgfSB2YXIgYyA9IFtdOyBmdW5jdGlvbiBsKHQsIHMpIHsgaWYgKCFvKVxuICAgICAgICB0aHJvdyBcIkdpZ3lhIGlzIG5vdCBjb25maWd1cmVkXCI7IGQoKTsgKGUuZmluZENvb2tpZUJ5TmFtZShcImdsdF9cIiArIGEuYXBpS2V5KSAhPT0gZS5maW5kQ29va2llQnlOYW1lKFwiX191dGdfXCIgKyBhLmFwaUtleSkgfHwgdCkgJiYgKGMucHVzaChzKSwgMSA9PT0gYy5sZW5ndGggJiYgd2luZG93LmdpZ3lhLmFjY291bnRzLmdldEFjY291bnRJbmZvKHsgY2FsbGJhY2s6IGZ1bmN0aW9uICh0KSB7IGlmICgwID09PSB0LmVycm9yQ29kZSkge1xuICAgICAgICAgICAgdmFyIG8gPSB7IHVpZDogdC5VSUQsIHNpZ25hdHVyZTogdC5VSURTaWduYXR1cmUsIHNpZ25hdHVyZV90aW1lc3RhbXA6IHQuc2lnbmF0dXJlVGltZXN0YW1wLCB1cmw6IGUucHJlcGFyZVVybFBhcmFtZXRlcih3aW5kb3cubG9jYXRpb24uaHJlZikgfTtcbiAgICAgICAgICAgIGUuc3RhcnRDYWxsKFwicmVmcmVzaFVzZXJUb2tlblwiKSwgbi5jYWxsQXBpKFwiL2Fub24vZ2lneWEvdmVyaWZ5QWNjb3VudEluZm9cIiwgbywgKGZ1bmN0aW9uIChuKSB7IGlmIChuICYmIG4ucmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBY2Nlc3NUb2tlbkxpc3RDb29raWUobi5yZXN1bHQuYWNjZXNzX3Rva2VuLCBuLnJlc3VsdC51c2VyX3Rva2VuKTtcbiAgICAgICAgICAgICAgICB2YXIgdCA9IHsgcGF0aDogXCIvXCIsIGV4cGlyZXM6IDczMCB9O1xuICAgICAgICAgICAgICAgIGlmIChuLnJlc3VsdC5hY2Nlc3NfdG9rZW4pIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG8gPSBuLnJlc3VsdC5hY2Nlc3NfdG9rZW4uY29va2llX2RvbWFpbjtcbiAgICAgICAgICAgICAgICAgICAgbyAmJiBcImxvY2FsaG9zdFwiICE9PSBvICYmIHIuaW5BcnJheShvLCBlLmdldFBvc3NpYmxlQ29va2llRG9tYWlucygpKSA+PSAwICYmICh0LmRvbWFpbiA9IG8pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2YXIgcyA9IGUuZmluZENvb2tpZUJ5TmFtZShcImdsdF9cIiArIGEuYXBpS2V5KTtcbiAgICAgICAgICAgICAgICBlLl9fcHJvdGVjdGVkX18uc2V0Q29va2llKFwiX191dGdfXCIgKyBhLmFwaUtleSwgcywgdCk7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgbCA9IDA7IGwgPCBjLmxlbmd0aDsgbCsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciB1ID0gY1tsXTtcbiAgICAgICAgICAgICAgICAgICAgdSAmJiB1KG4ucmVzdWx0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgbi5yZXN1bHQudXNlciAmJiAobi5yZXN1bHQudXNlciA9IHsgdWlkOiBuLnJlc3VsdC51c2VyLnVpZCwgZW1haWw6IG4ucmVzdWx0LnVzZXIuZW1haWwsIGZpcnN0TmFtZTogbi5yZXN1bHQudXNlci5maXJzdF9uYW1lLCBsYXN0TmFtZTogbi5yZXN1bHQudXNlci5sYXN0X25hbWUsIHZhbGlkOiBuLnJlc3VsdC51c2VyLnZhbGlkIH0pLCBpLmZpcmVDYWxsYmFja3MoXCJ1c2VyQ2hhbmdlZFwiLCBuLnJlc3VsdCwgdm9pZCAwLCAhMCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgZS5sb2coXCJDYW4ndCB2ZXJpZnkgZ2lneWEgdXNlcjogbWF5IGJlIHRoZSBjb25maWd1cmF0aW9uIG9mIGdpZ3lhIHVzZXIgcHJvdmlkZXIgaXMgaW52YWxpZFwiKSwgZS5zZXRBY2Nlc3NUb2tlbkxpc3RDb29raWUoKTsgYyA9IFtdLCBlLmRvbmVDYWxsKFwicmVmcmVzaFVzZXJUb2tlblwiKTsgfSkpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIGUuc2V0QWNjZXNzVG9rZW5MaXN0Q29va2llKCksIGMgPSBbXTsgfSB9KSk7IH0gdmFyIHUgPSAhMTsgZnVuY3Rpb24gZCgpIHsgaWYgKCF3aW5kb3cuZ2lneWEgfHwgIXdpbmRvdy5naWd5YS5fX2luaXRpYWxpemVkKVxuICAgICAgICB0aHJvdyBcIkdpZ3lhIGlzIG5vdCBpbml0aWFsaXplZFwiOyB9IHJldHVybiB7IGlzdjogITEsIG5hbWU6IFwiZ2lneWFcIiwgaW5pdDogZnVuY3Rpb24gKG4pIHsgaWYgKCFvKSB7XG4gICAgICAgICAgICBmb3IgKHZhciB0IGluIG4pXG4gICAgICAgICAgICAgICAgdm9pZCAwICE9PSBuW3RdICYmIChhW3RdID0gblt0XSk7XG4gICAgICAgICAgICBpZiAoIWEuc2NyZWVuU2V0KVxuICAgICAgICAgICAgICAgIHRocm93IFwiR2lneWEgaXMgbm90IGNvbmZpZ3VyZWQ6IHNjcmVlblNldCBwYXJhbWV0ZXIgcmVxdWlyZWRcIjtcbiAgICAgICAgICAgIGlmICghYS5hcGlLZXkpXG4gICAgICAgICAgICAgICAgdGhyb3cgXCJHaWd5YSBpcyBub3QgY29uZmlndXJlZDogYXBpS2V5IHBhcmFtZXRlciByZXF1aXJlZFwiO1xuICAgICAgICAgICAgZCgpLCB3aW5kb3cuZ2lneWEuYWNjb3VudHMuYWRkRXZlbnRIYW5kbGVycyh7IG9uTG9naW46IGZ1bmN0aW9uICgpIHsgdSA9ICEwLCBsKCk7IH0sIG9uTG9nb3V0OiBmdW5jdGlvbiAoKSB7IGUuc2V0QWNjZXNzVG9rZW5MaXN0Q29va2llKHsgdmFsdWU6IG51bGwgfSwgdm9pZCAwLCAhMCksIGkuZmlyZUNhbGxiYWNrcyhcImxvZ291dFwiLCBudWxsLCB2b2lkIDAsICEwKTsgfSB9KSwgbyA9ICEwLCBsKCk7XG4gICAgICAgIH0gfSwgaXNVc2VyVmFsaWQ6IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSBzKCk7IHJldHVybiAhISh2b2lkIDAgIT09IGUgJiYgZSAmJiBlLmxlbmd0aCA+PSAwKTsgfSwgZ2V0VG9rZW46IHMsIGdldE5hbWU6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIFwiZ2lneWFcIjsgfSwgb25Mb2dpblN1Y2Nlc3M6IGZ1bmN0aW9uIChuKSB7IGUuc2V0QWNjZXNzVG9rZW5MaXN0Q29va2llKHsgdmFsdWU6IG4udG9rZW5fbGlzdCwgY29va2llX2RvbWFpbjogbi5jb29raWVfZG9tYWluIH0sIG4udXNlcl90b2tlbik7IH0sIGxvZ2luOiBmdW5jdGlvbiAoZSkgeyBpZiAoIW8pXG4gICAgICAgICAgICB0aHJvdyBcIkdpZ3lhIGlzIG5vdCBjb25maWd1cmVkXCI7IGQoKSwgZSAmJiB3aW5kb3cuZ2lneWEuYWNjb3VudHMuYWRkRXZlbnRIYW5kbGVycyh7IG9uTG9naW46IGZ1bmN0aW9uICgpIHsgbCghMCwgZSk7IH0gfSk7IHZhciBuID0geyBzY3JlZW5TZXQ6IGEuc2NyZWVuU2V0LCBvbkhpZGU6IGZ1bmN0aW9uICgpIHsgaS5maXJlQ2FsbGJhY2tzKFwib25IaWRlXCIsIHsgYWZ0ZXJMb2dpbjogdSB9LCB2b2lkIDAsICEwKTsgfSB9LCB0ID0gW1wiYXBpS2V5XCIsIFwic2NyZWVuU2V0XCJdOyBmb3IgKHZhciByIGluIGEpIHtcbiAgICAgICAgICAgIHIgaW4gdCB8fCAobltyXSA9IGFbcl0pO1xuICAgICAgICB9IHUgPSAhMSwgd2luZG93LmdpZ3lhLmFjY291bnRzLnNob3dTY3JlZW5TZXQobik7IH0sIGxvZ291dDogZnVuY3Rpb24gKG4pIHsgaWYgKCFvKVxuICAgICAgICAgICAgdGhyb3cgXCJHaWd5YSBpcyBub3QgY29uZmlndXJlZFwiOyBkKCksIHdpbmRvdy5naWd5YS5hY2NvdW50cy5sb2dvdXQoeyBjYWxsYmFjazogZnVuY3Rpb24gKCkgeyBpLmZpcmVDYWxsYmFja3MoXCJsb2dvdXRcIiwgbnVsbCwgdm9pZCAwLCAhMCksIG4gJiYgbigpLCBlLnNldEFjY2Vzc1Rva2VuTGlzdENvb2tpZSh7IHZhbHVlOiBudWxsIH0sIHZvaWQgMCwgITApOyB9IH0pLCBlLnNldEFjY2Vzc1Rva2VuTGlzdENvb2tpZSh7IHZhbHVlOiBudWxsIH0sIHZvaWQgMCwgITApOyB9LCBpc0NvbmZpZ3VyZWQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuICEwID09PSBwbi51c2VHaWd5YVVzZXJQcm92aWRlciB8fCBcInN0cmluZ1wiID09IHR5cGVvZiBwbi51c2VHaWd5YVVzZXJQcm92aWRlciAmJiBcInRydWVcIiA9PT0gcG4udXNlR2lneWFVc2VyUHJvdmlkZXI7IH0sIHJlZ2lzdGVyQ2FsbGJhY2s6IGZ1bmN0aW9uIChlLCBuKSB7IGkuYWRkRXZlbnQoZSksIGkucmVnaXN0ZXJDYWxsYmFjayhlLCAoZnVuY3Rpb24gKGUpIHsgcmV0dXJuIG4oZSk7IH0pKTsgfSwgbG9naW5CeVBhc3N3b3JkbGVzczogZnVuY3Rpb24gKG4pIHsgaWYgKCFuKVxuICAgICAgICAgICAgdGhyb3cgXCJTZXNzaW9uIGluZm8gaXMgZW1wdHlcIjsgdmFyIHQgPSBuLmFjY2Vzc1Rva2VuTmFtZSwgciA9IG4uYWNjZXNzVG9rZW47IGUuX19wcm90ZWN0ZWRfXy5zZXRDb29raWUodCwgcik7IHZhciBvID0gXCJnbHRfXCIgKyBhLmFwaUtleTsgZS5fX3Byb3RlY3RlZF9fLnNldENvb2tpZShvLCByKSwgbCghMCk7IH0gfTsgfSgpO1xuICAgIHBuLmNvbnRhaW5lci5yZWdpc3RlcihcImdpZ3lhXCIsIHsgdXNlVmFsdWU6IEZlIH0pLCBwbi5naWd5YSA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwiZ2lneWFcIik7XG4gICAgdmFyIEJlID0gZnVuY3Rpb24gKCkgeyB2YXIgZSA9IGZ1bmN0aW9uIChlKSB7IGZ1bmN0aW9uIG4oKSB7IHJldHVybiBudWxsICE9PSBlICYmIGUuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOyB9IHJldHVybiBmdW5jdGlvbiAoZSwgbikgeyBpZiAoXCJmdW5jdGlvblwiICE9IHR5cGVvZiBuICYmIG51bGwgIT09IG4pXG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDbGFzcyBleHRlbmRzIHZhbHVlIFwiICsgU3RyaW5nKG4pICsgXCIgaXMgbm90IGEgY29uc3RydWN0b3Igb3IgbnVsbFwiKTsgZnVuY3Rpb24gdCgpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGU7IH0gd2UoZSwgbiksIGUucHJvdG90eXBlID0gbnVsbCA9PT0gbiA/IE9iamVjdC5jcmVhdGUobikgOiAodC5wcm90b3R5cGUgPSBuLnByb3RvdHlwZSwgbmV3IHQpOyB9KG4sIGUpLCBuLnByb3RvdHlwZS5jb25zdHJ1Y3QgPSBmdW5jdGlvbiAoZSkgeyB0aGlzLm1lc3NhZ2UgPSBlLCB0aGlzLm5hbWUgPSBcIkludmFsaWRDaGFyYWN0ZXJFcnJvclwiOyB9LCBuOyB9KEVycm9yKTsgZnVuY3Rpb24gbihuKSB7IHZhciB0ID0gU3RyaW5nKG4pLnJlcGxhY2UoLz0rJC8sIFwiXCIpOyBpZiAodC5sZW5ndGggJSA0ID09IDEpXG4gICAgICAgIHRocm93IG5ldyBlKFwiJ2F0b2InIGZhaWxlZDogVGhlIHN0cmluZyB0byBiZSBkZWNvZGVkIGlzIG5vdCBjb3JyZWN0bHkgZW5jb2RlZC5cIik7IGZvciAodmFyIHIsIG8sIGkgPSAwLCBhID0gMCwgcyA9IFwiXCI7IG8gPSB0LmNoYXJBdChhKyspOyB+byAmJiAociA9IGkgJSA0ID8gNjQgKiByICsgbyA6IG8sIGkrKyAlIDQpID8gcyArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKDI1NSAmIHIgPj4gKC0yICogaSAmIDYpKSA6IDApXG4gICAgICAgIG8gPSBcIkFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5Ky89XCIuaW5kZXhPZihvKTsgcmV0dXJuIHM7IH0gdHJ5IHtcbiAgICAgICAgdmFyIHQgPSB3aW5kb3cuYXRvYiAmJiB3aW5kb3cuYXRvYi5iaW5kKHdpbmRvdykgfHwgbjtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgdCA9IG47XG4gICAgfSB2YXIgciA9IGZ1bmN0aW9uIChlKSB7IHZhciBuID0gZS5yZXBsYWNlKC8tL2csIFwiK1wiKS5yZXBsYWNlKC9fL2csIFwiL1wiKTsgc3dpdGNoIChuLmxlbmd0aCAlIDQpIHtcbiAgICAgICAgY2FzZSAwOiBicmVhaztcbiAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgbiArPSBcIj09XCI7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgbiArPSBcIj1cIjtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBkZWZhdWx0OiB0aHJvdyBcIklsbGVnYWwgYmFzZTY0dXJsIHN0cmluZyFcIjtcbiAgICB9IHRyeSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KHQoZSkucmVwbGFjZSgvKC4pL2csIChmdW5jdGlvbiAoZSwgbikgeyB2YXIgdCA9IG4uY2hhckNvZGVBdCgwKS50b1N0cmluZygxNikudG9VcHBlckNhc2UoKTsgcmV0dXJuIHQubGVuZ3RoIDwgMiAmJiAodCA9IFwiMFwiICsgdCksIFwiJVwiICsgdDsgfSkpKTsgfShuKTtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgcmV0dXJuIHQobik7XG4gICAgfSB9OyByZXR1cm4gZnVuY3Rpb24gKGUsIG4pIHsgaWYgKFwic3RyaW5nXCIgIT0gdHlwZW9mIGUpXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgdG9rZW4gc3BlY2lmaWVkXCIpOyB2YXIgdCA9ICEwID09PSAobiA9IG4gfHwge30pLmhlYWRlciA/IDAgOiAxOyByZXR1cm4gSlNPTi5wYXJzZShyKGUuc3BsaXQoXCIuXCIpW3RdKSk7IH07IH0oKTtcbiAgICBwbi5qd3REZWNvZGUgPSBCZSwgcG4uY29udGFpbmVyLnJlZ2lzdGVyKFwiand0RGVjb2RlXCIsIHsgdXNlVmFsdWU6IEJlIH0pO1xuICAgIHZhciBWZSA9IGZ1bmN0aW9uICgpIHsgdmFyIGUsIG4gPSBwbi5jb250YWluZXIucmVzb2x2ZShcInV0aWxcIiksIHQgPSBwbi5jb250YWluZXIucmVzb2x2ZShcImFwaVwiKSwgciA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwicG9zdG1lc3NhZ2VcIiksIG8gPSBcInBpYW5vVHJhY2tlclwiLCBpID0gXCJnYUFjY291bnRcIiwgYSA9IFwibWV0cmljc0dBQWNjb3VudFwiLCBzID0gXCJ0cmFja09ubHlBaWRzXCIsIGMgPSBcImRpc2FibGVkXCIsIGwgPSA4NjQwMCwgdSA9IHsgZ2FBY2NvdW50OiB2b2lkIDAsIHRyYWNrZXJOYW1lOiBvLCB0cmFja09ubHlBaWRzOiBbXSwgbWV0cmljc0dBQWNjb3VudDogdm9pZCAwLCBpc0dBRW5hYmxlZDogITEsIGlzR0FBcHBlbmRlZDogITEsIGlzTWV0cmljc0VuYWJsZWQ6ICExLCBpc1RyYWNrZXJBcHBlbmRlZDogITEsIGlzTWV0cmljc1RyYWNrZXJBcHBlbmRlZDogITEgfSwgZCA9IFtdLCBwID0gITEsIGYgPSAhMCwgbSA9ICExLCBnID0gITEsIHYgPSBbXTsgZnVuY3Rpb24gaCgpIHsgbSB8fCAoZiA/IHNldFRpbWVvdXQoKGZ1bmN0aW9uICgpIHsgZiA9ICExLCB3KCk7IH0pLCAzZTMpIDogdygpKTsgfSBmdW5jdGlvbiB3KCkgeyBtID0gITAsIFMoKSwgdS5nYUFjY291bnQgPyBFKCkuY2F0Y2goKGZ1bmN0aW9uICgpIHsgfSkpIDogbmV3IFByb21pc2UoKGZ1bmN0aW9uIChlLCBuKSB7IHQuY2FsbEFwaShcIi9hbm9uL2Fzc2V0cy9nYUFjY291bnRcIiwgeyBhaWQ6IHRwLmFpZCB9LCAoZnVuY3Rpb24gKHQpIHsgMCA9PT0gdC5jb2RlID8gKHgodC5kYXRhKSwgZShudWxsKSkgOiBuKCk7IH0pKTsgfSkpLnRoZW4oKGZ1bmN0aW9uICgpIHsgcmV0dXJuIEUoKTsgfSkpLmNhdGNoKChmdW5jdGlvbiAoKSB7IH0pKTsgfSB2YXIgeSA9IGZ1bmN0aW9uIChlLCBuKSB7IGQucHVzaCh7IGFjdGlvbjogZSwgcGFyYW1zOiBuIH0pOyB9LCBiID0gZnVuY3Rpb24gKCkgeyBpZiAod2luZG93LmdhICYmIHUuaXNUcmFja2VyQXBwZW5kZWQpXG4gICAgICAgIGZvciAoOyBkLmxlbmd0aDspIHtcbiAgICAgICAgICAgIHZhciBlID0gZC5wb3AoKTtcbiAgICAgICAgICAgIEMoZS5hY3Rpb24sIGUucGFyYW1zKTtcbiAgICAgICAgfSB9LCBrID0gZnVuY3Rpb24gKGUsIG4pIHsgdi5wdXNoKHsgYWN0aW9uOiBlLCBwYXJhbXM6IG4gfSk7IH0sIF8gPSBmdW5jdGlvbiAoKSB7IGlmICh3aW5kb3cuZ2EgJiYgdS5pc01ldHJpY3NUcmFja2VyQXBwZW5kZWQpXG4gICAgICAgIGZvciAoOyB2Lmxlbmd0aDspIHtcbiAgICAgICAgICAgIHZhciBlID0gdi5wb3AoKTtcbiAgICAgICAgICAgIEkoZS5hY3Rpb24sIGUucGFyYW1zKTtcbiAgICAgICAgfSB9LCBDID0gZnVuY3Rpb24gKGUsIG4pIHsgd2luZG93LmdhICYmIHUuaXNUcmFja2VyQXBwZW5kZWQgPyB3aW5kb3cuZ2EodS50cmFja2VyTmFtZSArIFwiLlwiICsgZSwgbikgOiB5KGUsIG4pOyB9LCBJID0gZnVuY3Rpb24gKGUsIG4pIHsgdS5pc01ldHJpY3NFbmFibGVkICYmICh3aW5kb3cuZ2EgJiYgdS5pc01ldHJpY3NUcmFja2VyQXBwZW5kZWQgPyB3aW5kb3cuZ2EoXCJwZXJmb3JtYW5jZVRyYWNrZXIuXCIgKyBlLCBuKSA6IGsoZSwgbikpOyB9LCBTID0gZnVuY3Rpb24gKCkgeyBpZiAoIXApIHtcbiAgICAgICAgaWYgKHRwLmdhQ2xpZW50SWQgJiYgKGUgPSB0cC5nYUNsaWVudElkKSwgbi5fX3Byb3RlY3RlZF9fLmhhc0xvY2FsU3RvcmFnZSgpKSB7XG4gICAgICAgICAgICB2YXIgdCA9IG4uX19wcm90ZWN0ZWRfXy5nZXRMb2NhbFN0b3JhZ2VJdGVtKGkpLCByID0gbi5fX3Byb3RlY3RlZF9fLmdldExvY2FsU3RvcmFnZUl0ZW0oYSksIG8gPSBuLl9fcHJvdGVjdGVkX18uZ2V0TG9jYWxTdG9yYWdlSXRlbShzKTtcbiAgICAgICAgICAgIHUuaXNHQUVuYWJsZWQgPSAhIXQgJiYgdCAhPT0gYywgdS5pc01ldHJpY3NFbmFibGVkID0gISFyICYmIHIgIT09IGMsIHUuZ2FBY2NvdW50ID0gdCwgdS5tZXRyaWNzR0FBY2NvdW50ID0gciwgdS50cmFja09ubHlBaWRzID0gbyB8fCBbXTtcbiAgICAgICAgfVxuICAgICAgICBwID0gITA7XG4gICAgfSB9OyB2YXIgeCA9IGZ1bmN0aW9uIChlKSB7IHUuaXNHQUVuYWJsZWQgPSAhIWUsIHUuZ2FBY2NvdW50ID0gZSB8fCBjLCBuLl9fcHJvdGVjdGVkX18uc2V0TG9jYWxTdG9yYWdlSXRlbShpLCB1LmdhQWNjb3VudCwgbCk7IH0sIFAgPSBmdW5jdGlvbiAoZSkgeyB1LmlzTWV0cmljc0VuYWJsZWQgPSBKU09OLnBhcnNlKGUuaXNfZW5hYmxlZCksIHUubWV0cmljc0dBQWNjb3VudCA9IHUuaXNNZXRyaWNzRW5hYmxlZCA/IGUuZ2FfYWNjb3VudCA6IGMsIHUudHJhY2tPbmx5QWlkcyA9IHUuaXNNZXRyaWNzRW5hYmxlZCA/IEpTT04ucGFyc2UoZS50cmFja19vbmx5X2FpZHMpIDogW10sIG4uX19wcm90ZWN0ZWRfXy5zZXRMb2NhbFN0b3JhZ2VJdGVtKHMsIHUudHJhY2tPbmx5QWlkcywgbCksIG4uX19wcm90ZWN0ZWRfXy5zZXRMb2NhbFN0b3JhZ2VJdGVtKGEsIHUubWV0cmljc0dBQWNjb3VudCwgbCk7IH07IGZ1bmN0aW9uIEUoKSB7IHJldHVybiBuZXcgUHJvbWlzZSgoZnVuY3Rpb24gKG4sIHQpIHsgdS5pc0dBRW5hYmxlZCA/IEEoKS50aGVuKChmdW5jdGlvbiAoKSB7IGlmICh1LmlzR0FBcHBlbmRlZClcbiAgICAgICAgaWYgKHUuaXNUcmFja2VyQXBwZW5kZWQpXG4gICAgICAgICAgICBuKG51bGwpO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHZhciByID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNjcmlwdFwiKTtcbiAgICAgICAgICAgICAgICByLmlubmVySFRNTCA9IGZ1bmN0aW9uICgpIHsgdmFyIG4gPSBuZXcgUmVnRXhwKFwiXlVBLVswLTlhLXpBLVpdKi1bMC05YS16QS1aXSokXCIpLnRlc3QodS5nYUFjY291bnQpLCB0ID0gbmV3IFJlZ0V4cChcIihbe10/WzAtOWEtZkEtRl17OH0tKFswLTlhLWZBLUZdezR9LSl7M31bMC05YS1mQS1GXXsxMn1bfV0/KXwoWzAtOV0qXFxcXC5bMC05XSopXCIpLnRlc3QoZSB8fCBcIlwiKTsgaWYgKCFuKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJcIjsgdmFyIHIgPSBcImdhKGZ1bmN0aW9uKCkge1xcbiAgICAgICAgZ2EoJ2NyZWF0ZScsICdcIiArIHUuZ2FBY2NvdW50ICsgXCInLCAnYXV0bycsICdcIiArIFwicGlhbm9UcmFja2VyJ1wiOyByICs9IGUgJiYgdCA/IFwiLCB7IGNsaWVudElkOiAnXCIgKyBlICsgXCInIH0pO1wiIDogXCIpO1xcbiAgICAgICAgdHAuZ2FTZXJ2aWNlLnNldENsaWVudElkKGdhLmdldEJ5TmFtZSgncGlhbm9UcmFja2VyJykuZ2V0KCdjbGllbnRJZCcpKTtcIjsgcmV0dXJuIHIgKz0gXCJ0cC5nYVNlcnZpY2UudHJhY2tlckFwcGVuZGVkKCk7IH0pO1wiOyB9KCksIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQociksIHUuaXNUcmFja2VyQXBwZW5kZWQgPSAhMCwgbihudWxsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgdCgpO1xuICAgICAgICAgICAgfVxuICAgIGVsc2VcbiAgICAgICAgdCgpOyB9KSkuY2F0Y2goKGZ1bmN0aW9uIChlKSB7IH0pKSA6IHQoKTsgfSkpOyB9IGZ1bmN0aW9uIFQoKSB7IHJldHVybiBuZXcgUHJvbWlzZSgoZnVuY3Rpb24gKGUsIG4pIHsgdS5pc01ldHJpY3NFbmFibGVkID8gQSgpLnRoZW4oKGZ1bmN0aW9uICgpIHsgaWYgKHUuaXNHQUFwcGVuZGVkKVxuICAgICAgICBpZiAodS5pc01ldHJpY3NUcmFja2VyQXBwZW5kZWQpXG4gICAgICAgICAgICBlKG51bGwpO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHZhciB0ID0gIXUudHJhY2tPbmx5QWlkcy5sZW5ndGggfHwgdS50cmFja09ubHlBaWRzLmNvbnRhaW5zKHRwLmFpZCksIHIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic2NyaXB0XCIpO1xuICAgICAgICAgICAgICAgIGlmICghbmV3IFJlZ0V4cChcIl5VQS1bMC05YS16QS1aXSotWzAtOWEtekEtWl0qJFwiKS50ZXN0KHUubWV0cmljc0dBQWNjb3VudCkpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB2b2lkIG4oKTtcbiAgICAgICAgICAgICAgICByLmlubmVySFRNTCA9IFwiXFxuZ2EoZnVuY3Rpb24oKSB7XFxuICBpZiAoXCIgKyB0ICsgXCIpIHtcXG4gICAgZ2EoJ2NyZWF0ZScsICdcIiArIHUubWV0cmljc0dBQWNjb3VudCArIFwiJywgJ2F1dG8nLCAnXCIgKyBcInBlcmZvcm1hbmNlVHJhY2tlcicsIHsgc3RvcmFnZTogJ25vbmUnIH0pO1xcbiAgICB0cC5nYVNlcnZpY2UubWV0cmljc1RyYWNrZXJBcHBlbmRlZCgpO1xcbiAgfVxcbn0pO1xcblwiLCBkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKHIpLCB1LmlzTWV0cmljc1RyYWNrZXJBcHBlbmRlZCA9ICEwLCBlKG51bGwpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICBuKCk7XG4gICAgICAgICAgICB9XG4gICAgZWxzZVxuICAgICAgICBuKCk7IH0pKSA6IGUoXCJpc01ldHJpY3NFbmFibGVkICE9PSB0cnVlXCIpOyB9KSk7IH0gZnVuY3Rpb24gQSgpIHsgcmV0dXJuIG5ldyBQcm9taXNlKChmdW5jdGlvbiAoZSwgbikgeyBpZiAodS5pc0dBQXBwZW5kZWQpXG4gICAgICAgIGUobnVsbCk7XG4gICAgZWxzZVxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgdmFyIHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic2NyaXB0XCIpO1xuICAgICAgICAgICAgdC5pbm5lckhUTUwgPSBcIlxcbiAgICAgICAgICAgIChmdW5jdGlvbihpLHMsbyxnLHIsYSxtKXtpWydHb29nbGVBbmFseXRpY3NPYmplY3QnXT1yO2lbcl09aVtyXXx8ZnVuY3Rpb24oKXtcXG4gICAgICAgICAgICAoaVtyXS5xPWlbcl0ucXx8W10pLnB1c2goYXJndW1lbnRzKX0saVtyXS5sPTEqbmV3IERhdGUoKTthPXMuY3JlYXRlRWxlbWVudChvKSxcXG4gICAgICAgICAgICBtPXMuZ2V0RWxlbWVudHNCeVRhZ05hbWUobylbMF07YS5hc3luYz0xO2Euc3JjPWc7bS5wYXJlbnROb2RlLmluc2VydEJlZm9yZShhLG0pXFxuICAgICAgICAgICAgfSkod2luZG93LGRvY3VtZW50LCdzY3JpcHQnLCdodHRwczovL3d3dy5nb29nbGUtYW5hbHl0aWNzLmNvbS9hbmFseXRpY3MuanMnLCdnYScpO1xcbiAgICAgICAgICBcIiwgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZCh0KSwgdS5pc0dBQXBwZW5kZWQgPSAhMCwgZShudWxsKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgbigpO1xuICAgICAgICB9IH0pKTsgfSByZXR1cm4geyBuYW1lOiBcImdhU2VydmljZVwiLCBlbWl0RXZlbnQ6IGZ1bmN0aW9uIChlKSB7IGlmIChlLmhpdFR5cGUgPSBcImV2ZW50XCIsICF1LmlzVHJhY2tlckFwcGVuZGVkKVxuICAgICAgICAgICAgcmV0dXJuIHkoXCJzZW5kXCIsIGUpLCB2b2lkIGgoKTsgdS5pc0dBRW5hYmxlZCAmJiAod2luZG93LmdhICYmIHUuaXNUcmFja2VyQXBwZW5kZWQgPyAoZC5sZW5ndGggJiYgYigpLCBDKFwic2VuZFwiLCBlKSkgOiB5KFwic2VuZFwiLCBlKSk7IH0sIGVtaXRNZXRyaWNzRXZlbnQ6IGZ1bmN0aW9uIChlKSB7IGlmIChlLmhpdFR5cGUgPSBcInRpbWluZ1wiLCAhdS5pc01ldHJpY3NUcmFja2VyQXBwZW5kZWQpXG4gICAgICAgICAgICByZXR1cm4gayhcInNlbmRcIiwgZSksIHZvaWQgZnVuY3Rpb24gKCkgeyBpZiAoZylcbiAgICAgICAgICAgICAgICByZXR1cm47IGlmIChnID0gITAsIFMoKSwgIXUubWV0cmljc0dBQWNjb3VudClcbiAgICAgICAgICAgICAgICByZXR1cm4gdm9pZCBuZXcgUHJvbWlzZSgoZnVuY3Rpb24gKGUsIG4pIHsgdC5jYWxsQXBpKFwiL2Fub24vYXNzZXRzL3BlcmZvcm1hbmNlTWV0cmljc1wiLCBudWxsLCAoZnVuY3Rpb24gKHQpIHsgMCA9PT0gdC5jb2RlID8gKFAodC5wZXJmb3JtYW5jZV9tZXRyaWNzX2R0byksIGUobnVsbCkpIDogbigpOyB9KSk7IH0pKS50aGVuKChmdW5jdGlvbiAoKSB7IHJldHVybiBUKCk7IH0pKS5jYXRjaCgoZnVuY3Rpb24gKGUpIHsgbi5lcnJvcihcIlBOIGNhdGNoOiBzb21ldGhpbmcgdmVudCB3cm9uZyB3aXRoIEdBIGluamVjdGlvbjogXCIgKyBlKTsgfSkpOyBUKCkuY2F0Y2goKGZ1bmN0aW9uIChlKSB7IG4uZXJyb3IoXCJQTiBjYXRjaDogc29tZXRoaW5nIHZlbnQgd3Jvbmcgd2l0aCBHQSBpbmplY3Rpb246IFwiICsgZSk7IH0pKTsgfSgpOyB1LmlzTWV0cmljc0VuYWJsZWQgJiYgKHdpbmRvdy5nYSAmJiB1LmlzTWV0cmljc1RyYWNrZXJBcHBlbmRlZCA/ICh2Lmxlbmd0aCAmJiBfKCksIEkoXCJzZW5kXCIsIGUpKSA6IGsoXCJzZW5kXCIsIGUpKTsgfSwgZ2V0Q2xpZW50SWQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGU7IH0sIGdldEdBQWNjb3VudDogZnVuY3Rpb24gKCkgeyByZXR1cm4gdS5nYUFjY291bnQ7IH0sIG1ldHJpY3NUcmFja2VyQXBwZW5kZWQ6IGZ1bmN0aW9uICgpIHsgdS5pc01ldHJpY3NUcmFja2VyQXBwZW5kZWQgPSAhMCwgZyA9ICExLCBfKCk7IH0sIHJlY3JlYXRlV2l0aENsaWVudElkOiBmdW5jdGlvbiAobikgeyBlID0gbiwgaCgpOyB9LCBzZXRDbGllbnRJZDogZnVuY3Rpb24gKG4pIHsgZSA9IG47IH0sIHNldFRyYWNrZXJOYW1lOiBmdW5jdGlvbiAoZSkgeyB1LnRyYWNrZXJOYW1lID0gZTsgfSwgdHJhY2tlckFwcGVuZGVkOiBmdW5jdGlvbiAoKSB7IHUuaXNUcmFja2VyQXBwZW5kZWQgPSAhMCwgci5icm9hZGNhc3QoXCJnYUFwcGVuZGVkXCIsIHsgY2xpZW50SWQ6IGUsIGdhQWNjb3VudDogdS5nYUFjY291bnQgfSksIG0gPSAhMSwgYigpOyB9IH07IH0oKTtcbiAgICBwbi5jb250YWluZXIucmVnaXN0ZXIoXCJnYVNlcnZpY2VcIiwgeyB1c2VWYWx1ZTogVmUgfSksIHBuLmdhU2VydmljZSA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwiZ2FTZXJ2aWNlXCIpO1xuICAgIHZhciBxZSA9IGZ1bmN0aW9uIChlKSB7IHZvaWQgMCA9PT0gZSAmJiAoZSA9IHBuLmNvbnRhaW5lcik7IHZhciBuLCB0LCByLCBvLCBpLCBhID0gZS5yZXNvbHZlKFwiY29va2llXCIpLCBzID0gZS5yZXNvbHZlKFwianFVdGlsc1wiKSwgYyA9IGUucmVzb2x2ZShcImFqYXhcIiksIGwgPSBlLnJlc29sdmUoXCJqd3REZWNvZGVcIiksIHUgPSBlLnJlc29sdmUoXCJ1dGlsXCIpLCBkID0gZS5yZXNvbHZlKFwiY29udGFpbmVyVXRpbHNcIiksIHAgPSBlLnJlc29sdmUoXCJwb3N0bWVzc2FnZVwiKSwgZiA9IGUucmVzb2x2ZShcImxvZ1wiKSwgbSA9IGUucmVzb2x2ZShcIm9ic2VydmVyXCIpLCBnID0gZS5yZXNvbHZlKFwiZ2FTZXJ2aWNlXCIpLCB2ID0gZS5yZXNvbHZlKFwiYXBpXCIpLCBoID0gZS5yZXNvbHZlKFwibG9nZ2luZ1wiKSwgdyA9IGUucmVzb2x2ZShcImxvY2FsU3RvcmFnZVwiKSwgeSA9IFwicGlhbm9fc29jaWFsX3Rva2VuXCIsIGIgPSB1LmdldEFpZFNwZWNpZmllZE5hbWUoXCJfX3V0cFwiKSwgayA9IFwiX19waWxcIiwgXyA9IFwiX19waWRcIiwgQyA9IFwiX19pZHJcIiwgSSA9IFwiX19lZWFcIiwgUyA9IFwiUElBTk9JRFwiLCB4ID0gXCJzaG93X2Zvcm1cIiwgUCA9IFwicmVnaXN0cmF0aW9uXCIsIEUgPSBcImNoZWNrb3V0XCIsIFQgPSAzMDAsIEEgPSBcInBuaWQtdGMtc3RyaW5nXCIsIE0gPSBbXCJoZV9JTFwiLCBcImFyX0VHXCJdLCBPID0ge30sIFIgPSBbXSwgTCA9IHsgbG9nZ2VkSW46IFtdLCBsb2dnZWRPdXQ6IFtdLCBsb2dpblN1Y2Nlc3M6IFtdLCByZWdpc3RyYXRpb25TdWNjZXNzOiBbXSwgcHJvZmlsZVVwZGF0ZTogW10sIGxhbmdDaGFuZ2U6IFtdLCBsYW5nQ2hhbmdlRnJvbUlmcmFtZToge30sIGZpcmVfbG9naW5TdWNjZXNzOiBbXSwgbG9naW5EaXNwbGF5ZWQ6IFtdLCByZWdpc3RlckRpc3BsYXllZDogW10sIGxvZ2luRmFpbGVkOiBbXSwgcmVnaXN0cmF0aW9uRmFpbGVkOiBbXSwgb25TaG93OiBbXSwgbGF5b3V0UmVhZHk6IFtdIH0sIE4gPSB7fSwgVSA9IHt9LCBqID0gW10sIEQgPSAhMSwgRiA9IFtcIkcxOHJJSldRMkdcIiwgXCI0NUwyQmFTNnB1XCJdOyBzLm9uKHdpbmRvdywgXCJyZXNpemVcIiwgKGZ1bmN0aW9uICgpIHsgcmV0dXJuIEIoKTsgfSkpOyB2YXIgQiA9IGZ1bmN0aW9uIChlKSB7IFIuZmlsdGVyKChmdW5jdGlvbiAoZSkgeyByZXR1cm4gXCJpbmxpbmVcIiA9PT0gZS5jb25maWcuZGlzcGxheU1vZGU7IH0pKS5maWx0ZXIoKGZ1bmN0aW9uIChuKSB7IHJldHVybiAhZSB8fCBlLnNvbWUoKGZ1bmN0aW9uIChlKSB7IHJldHVybiBuLmNvbnRhaW5lciA9PT0gZTsgfSkpOyB9KSkuZm9yRWFjaCgoZnVuY3Rpb24gKGUpIHsgdmFyIG4gPSBzLmdldFdpZHRoKGUuY29udGFpbmVyKTsgZC5yZXNpemVJZnJhbWUoZSwgeyB3aWR0aDogbiB9KSwgcC5zZW5kKFwicmVzaXplXCIsIHsgd2lkdGg6IG4gfSwgZS5pZnJhbWVJZCk7IH0pKTsgfSwgViA9IGZ1bmN0aW9uIChlKSB7IGlmIChyICYmICFlKVxuICAgICAgICByZXR1cm4gcjsgdmFyIG47IE8gPSBPYmplY3QuYXNzaWduKHt9LCBlKSwgciA9IG5ldyBQcm9taXNlKChmdW5jdGlvbiAoZSkgeyBuID0gZTsgfSkpLCBRZSgpIHx8IHBuLnNldFVzZVBpYW5vSWRVc2VyUHJvdmlkZXIoITApLCBhZShPKTsgdmFyIHQgPSB1LmdldFF1ZXJ5UGFyYW1CeU5hbWUoXCJyZXNldF90b2tlblwiKTsgdm9pZCAwID09PSBPLnJlc2V0UGFzc3dvcmRUb2tlbiAmJiB0ICYmIChPLnJlc2V0UGFzc3dvcmRUb2tlbiA9IHQpOyB2YXIgbyA9IHUuZ2V0UXVlcnlQYXJhbUJ5TmFtZShcInBhc3N3b3JkbGVzc190b2tlblwiKTsgdm9pZCAwID09PSBPLnBhc3N3b3JkbGVzc1Rva2VuICYmIG8gJiYgKE8ucGFzc3dvcmRsZXNzVG9rZW4gPSBvKTsgdmFyIGkgPSB1LmdldFF1ZXJ5UGFyYW1CeU5hbWUoXCJ2ZXJpZmljYXRpb25fY29kZVwiKTsgdm9pZCAwID09PSBPLnZlcmlmaWNhdGlvbl9jb2RlICYmIGkgJiYgKE8udmVyaWZpY2F0aW9uX2NvZGUgPSBpKTsgdmFyIGEgPSB1LmdldFF1ZXJ5UGFyYW1CeU5hbWUoeSk7IHJldHVybiBhICYmICh1LnJlbW92ZVF1ZXJ5UGFyYW1CeU5hbWUoeSksIE9lKCkgfHwgKHBuLmluYXBwQnJvd3NlclJldHVybiA9ICEwLCBmdW5jdGlvbiAoZSwgbikgeyB2YXIgdCA9IGwoZSk7IHQucmVtZW1iZXJNZSA9ICEhbiwgU2UoeyB1c2VyOiB0LCB0b2tlbjogZSB9KTsgfShhLCAhMCkpKSwgc2V0VGltZW91dCgoZnVuY3Rpb24gKCkgeyByZXR1cm4gbigpOyB9KSwgNTApLCByOyB9LCBxID0gZnVuY3Rpb24gKGUsIG4pIHsgaWYgKHQgJiYgIWUpXG4gICAgICAgIHJldHVybiB0OyB2YXIgcjsgdCA9IG5ldyBQcm9taXNlKChmdW5jdGlvbiAoZSkgeyByID0gZTsgfSkpOyB2YXIgbyA9IGZ1bmN0aW9uICgpIHsgdS5kb25lQ2FsbChcInJlZnJlc2hVc2VyVG9rZW5cIiksIHQgPSBudWxsLCByKCk7IH07IHJldHVybiBlICYmIGUucHJldmlldyA/IChzZXRUaW1lb3V0KChmdW5jdGlvbiAoKSB7IHJldHVybiByKCk7IH0pLCAxMCksIHQpIDogKHUuc3RhcnRDYWxsKFwicmVmcmVzaFVzZXJUb2tlblwiKSwgVihlKS50aGVuKChmdW5jdGlvbiAoKSB7IHJldHVybiBPLnBhc3N3b3JkbGVzc1Rva2VuID8gSigpIDogbiA/IFByb21pc2UucmVzb2x2ZSgpIDogUmUoKTsgfSkpLnRoZW4obywgbyksIHQpOyB9LCB6ID0gZnVuY3Rpb24gKGUpIHsgdmFyIHQgPSAhT2UoKTsgcSgpLnRoZW4oKGZ1bmN0aW9uICgpIHsgdmFyIHIgPSBPYmplY3QuYXNzaWduKHt9LCBPLCBlLCB7IGlzUmVnaXN0cmF0aW9uOiAhMCB9KSwgbyA9IE9lKCk7IG8gPyAobmUociwgeyBlbWl0R2xvYmFsTG9naW5TdWNjZXNzRXZlbnQ6IHQgJiYgbyB9KSwgRCAmJiAhWGUoKSAmJiAoYWUoZSksIHNlKHIpLCBfZShyKSkpIDogbiA/IChhZShlKSwgdS5sb2coXCJNb2RhbCBsb2dpbiB3aW5kb3cgYWxyZWFkeSBzaG93blwiKSkgOiAoYWUoZSksIHNlKHIpLCBfZShyKSk7IGguc2V0VGltZShcImlkU2hvd1wiKTsgfSkpOyB9LCBIID0gZnVuY3Rpb24gKCkgeyB2YXIgZSA9IFwiZW1haWxfaXNfbm90X2NvbmZpcm1lZFwiLCBuID0gdS5nZXRRdWVyeVBhcmFtQnlOYW1lKGUpOyBpZiAobikge1xuICAgICAgICB1LnJlbW92ZVF1ZXJ5UGFyYW1CeU5hbWUoZSk7XG4gICAgICAgIHZhciB0ID0gXCJyZWdpc3RyYXRpb25cIiA9PT0gbiA/IFwiZW1haWxfaXNfbm90X2NvbmZpcm1lZFwiIDogXCJlbWFpbF9jb25maXJtYXRpb25fcmVxdWlyZWRcIiwgciA9IFRlKCk7XG4gICAgICAgIFcoeyBzY3JlZW46IHQsIGVtYWlsOiByICYmIHIuZW1haWwgfSk7XG4gICAgfSB9LCBXID0gZnVuY3Rpb24gKGUpIHsgaWYgKG4pXG4gICAgICAgIHUubG9nKFwiTW9kYWwgd2luZG93IGFscmVhZHkgc2hvd25cIik7XG4gICAgZWxzZSB7XG4gICAgICAgIGUgfHwgKGUgPSB7fSk7XG4gICAgICAgIHZhciB0ID0gT2JqZWN0LmFzc2lnbih7fSwgZSwgTyk7XG4gICAgICAgIGUuY3VzdG9tRXZlbnRzICYmIFwib2JqZWN0XCIgPT0gdHlwZW9mIGUuY3VzdG9tRXZlbnRzICYmIChOID0gZS5jdXN0b21FdmVudHMpLCBzZSh0KSwgYWUoZSksIF9lKHQpO1xuICAgIH0gfSwgSiA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIG5ldyBQcm9taXNlKChmdW5jdGlvbiAoZSwgbikgeyBjLnJlcXVlc3QoeyB1cmw6IGhlKCkgKyBcImFwaS92MS9pZGVudGl0eS9wYXNzd29yZGxlc3MvYXV0aG9yaXphdGlvbi9jb2RlXCIsIGRhdGFUeXBlOiBcImpzb25wXCIsIGRhdGE6IHsgYWlkOiBPLmFpZCB8fCBwbi5haWQsIHBhc3N3b3JkbGVzc190b2tlbjogTy5wYXNzd29yZGxlc3NUb2tlbiB9LCBzdWNjZXNzOiBmdW5jdGlvbiAodCkgeyB0LmVycm9yID8gKFEodCksIG4oKSkgOiAoRyh0KSwgZShudWxsKSk7IH0sIHhockZpZWxkczogeyB3aXRoQ3JlZGVudGlhbHM6ICEwIH0sIGNyb3NzRG9tYWluOiAhMCB9KTsgfSkpOyB9LCBHID0gZnVuY3Rpb24gKGUpIHsgIWUuZXJyb3IgJiYgZS5hY2Nlc3NfdG9rZW4gJiYgKFgoZSksIE1lKHsgc291cmNlOiBTLCB0b2tlbjogZS5hY2Nlc3NfdG9rZW4sIHVzZXI6IGwoZS5hY2Nlc3NfdG9rZW4pLCBleHRlbmRFeHBpcmVkQWNjZXNzRW5hYmxlZDogZS5leHRlbmRfZXhwaXJlZF9hY2Nlc3NfZW5hYmxlZCB9LCAhMSwgITApLCBkZWxldGUgTy5wYXNzd29yZGxlc3NUb2tlbiwgdS5yZW1vdmVRdWVyeVBhcmFtQnlOYW1lKFwicGFzc3dvcmRsZXNzX3Rva2VuXCIpKSwgdS5kb25lQ2FsbChcInJlZnJlc2hVc2VyVG9rZW5cIik7IH0sIFEgPSBmdW5jdGlvbiAoZSkgeyBXKHsgc2NyZWVuOiBcInBhc3N3b3JkbGVzc19jb25maXJtYXRpb25cIiwganNvbnBFcnJvcjogZSB9KSwgZGVsZXRlIE8ucGFzc3dvcmRsZXNzVG9rZW4sIHUucmVtb3ZlUXVlcnlQYXJhbUJ5TmFtZShcInBhc3N3b3JkbGVzc190b2tlblwiKTsgfSwgWCA9IGZ1bmN0aW9uIChlKSB7IHZhciBuID0geyBhaWQ6IE8uYWlkIHx8IHBuLmFpZCwgbG9naW5fdG9rZW5faWQ6IGUubG9naW5fdG9rZW5faWQsIHVzZXJfdG9rZW46IGUuYWNjZXNzX3Rva2VuIH0sIHQgPSB7IHBhc3N3b3JkbGVzc1Rva2VuOiBlLnBhc3N3b3JkbGVzc190b2tlbiwgcmVkaXJlY3RVcmk6IGUuZGlyZWN0aW9uX3VybCB9OyAkKG4sIHQpOyB9LCAkID0gZnVuY3Rpb24gKGUsIG4pIHsgZC5zaG93V2FpdFBhbmVsKCksIHYuY2FsbEFwaShcIi9hbm9uL3Bhc3N3b3JkbGVzcy9jb21wbGV0ZVwiLCBlLCAoZnVuY3Rpb24gKGUpIHsgaWYgKGUucmVzdWx0ICYmIGUucmVzdWx0LnBvbGxpbmdfZW5hYmxlZClcbiAgICAgICAgcmV0dXJuIFkoZSkudGhlbigoZnVuY3Rpb24gKGUpIHsgWihlLCBuKTsgfSkpOyBaKGUsIG4pOyB9KSk7IH0sIFkgPSBmdW5jdGlvbiAoZSkgeyByZXR1cm4gbmV3IFByb21pc2UoKGZ1bmN0aW9uIChuKSB7IHZhciB0ID0geyBhaWQ6IHBuLmFpZCwgb2lkOiBlLnJlc3VsdC5vaWQsIHByb2Nlc3NfaWQ6IGUucmVzdWx0LnByb2Nlc3NfaWQsIHVzZXJfdG9rZW46IHBuLnVzZXIuZ2V0UHJvdmlkZXIoKS5nZXRUb2tlbigpIH07IEsodCwgMCwgZS5yZXN1bHQucG9sbGluZ190aW1lb3V0cywgbik7IH0pKTsgfSwgSyA9IGZ1bmN0aW9uIChlLCBuLCB0LCByKSB7IHYuY2FsbEFwaShcIi9hbm9uL3Bhc3N3b3JkbGVzcy9jaGVja1wiLCBlLCAoZnVuY3Rpb24gKG8pIHsgbisrLCBvICYmIG8ucmVzdWx0ICYmIFwid2FpdGluZ1wiICE9PSBvLnJlc3VsdC5wb2xsX3N0YXR1cyA/IHIobykgOiAhby5yZXN1bHQgJiYgby5tZXNzYWdlID8gKHUuZXJyb3IoXCJQYXNzd29yZGxlc3MgcHVyY2hhc2UgZmFpbGVkXCIsIG8ubWVzc2FnZSksIHIoKSkgOiBuIDw9IHQubGVuZ3RoID8gc2V0VGltZW91dCgoZnVuY3Rpb24gKCkgeyBLKGUsIG4sIHQsIHIpOyB9KSwgdFtuIC0gMV0pIDogcigpOyB9KSk7IH0sIFogPSBmdW5jdGlvbiAoZSwgbikgeyB0cnkge1xuICAgICAgICB2YXIgdCA9IGUucmVzdWx0LnJlc291cmNlIHx8IHt9LCByID0gSlNPTi5wYXJzZShlLnJlc3VsdC5zaG93X29mZmVyX3BhcmFtcyksIG8gPSBlZShuKTtcbiAgICAgICAgaWYgKCFPYmplY3Qua2V5cyh0KS5sZW5ndGggJiYgIU9iamVjdC5rZXlzKHIpLmxlbmd0aClcbiAgICAgICAgICAgIHJldHVybiBXKG8pO1xuICAgICAgICBvID0gdC5uYW1lID8gZWUobiwgeyBjdXN0b21QYXJhbXM6IHsgcmVzb3VyY2VOYW1lOiB0Lm5hbWUgfSB9KSA6IGVlKG4sIHsgY3VzdG9tRXZlbnRzOiB7IGNoZWNrb3V0Q29udGludWU6IGZ1bmN0aW9uICgpIHsgQ2UoKSwgZC5jbG9zZU1vZGFsQ29udGFpbmVyKCksIHBuLm9mZmVyLnNob3cocik7IH0gfSB9KSwgVyhvKTtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgVyhlZShuKSk7XG4gICAgfVxuICAgIGZpbmFsbHkge1xuICAgICAgICBkLmhpZGVXYWl0UGFuZWwoKTtcbiAgICB9IH0sIGVlID0gZnVuY3Rpb24gKGUsIG4pIHsgdmFyIHQgPSB7IHNjcmVlbjogXCJwYXNzd29yZGxlc3NfY29uZmlybWF0aW9uXCIgfTsgcmV0dXJuIGUgJiYgKHQucGFzc3dvcmRsZXNzVG9rZW4gPSBlLnBhc3N3b3JkbGVzc1Rva2VuLCB0LnJlZGlyZWN0VXJpID0gZS5yZWRpcmVjdFVyaSksIG4gPyBPYmplY3QuYXNzaWduKHQsIG4pIDogT2JqZWN0LmFzc2lnbih0LCB7IHBhc3N3b3JkbGVzc1N1Y2Nlc3M6ICEwIH0pOyB9LCBuZSA9IGZ1bmN0aW9uIChlLCBuKSB7IG4gPSBuIHx8IHt9OyB2YXIgdCA9IFRlKCk7IGlmICh0KSB7XG4gICAgICAgIHZhciByID0geyB0b2tlbjogUGUoKSwgdXNlcjogdCwgc291cmNlOiBuLnNvdXJjZSwgc3RhZ2U6IG4uc3RhZ2UgfSwgaSA9IHsgZXZlbnQ6IFwibG9naW5TdWNjZXNzXCIsIHNvdXJjZTogbi5zb3VyY2UsIHBhcmFtczogci51c2VyLCB1c2VyX3Rva2VuOiByLnRva2VuLCByZWdpc3RyYXRpb246IG8sIHN0YWdlOiBuLnN0YWdlIH07XG4gICAgICAgIGUgPyAoZS5sb2dnZWRJbiAmJiBlLmxvZ2dlZEluKHIpLCBuLmVtaXRHbG9iYWxMb2dpblN1Y2Nlc3NFdmVudCAmJiBvZShcImxvZ2luU3VjY2Vzc1wiLCBpKSkgOiAocmUoXCJsb2dnZWRJblwiLCByKSwgcmUoXCJsb2dpblN1Y2Nlc3NcIiwgciksIG4uc291cmNlID09PSBTICYmIChyZShcImZpcmVfbG9naW5TdWNjZXNzXCIsIGkpLCBvZShcImxvZ2luU3VjY2Vzc1wiLCBpKSkpO1xuICAgIH0gfSwgdGUgPSBmdW5jdGlvbiAoZSwgbikgeyBpZSh7IGxvZ2luOiBcImxvZ2luRGlzcGxheWVkXCIsIHJlZ2lzdGVyOiBcInJlZ2lzdGVyRGlzcGxheWVkXCIgfVtlXSwge30sIG4pOyB9LCByZSA9IGZ1bmN0aW9uIChlLCBuKSB7IExbZV0gJiYgTFtlXS5mb3JFYWNoKChmdW5jdGlvbiAoZSkgeyBlKG4pOyB9KSk7IH0sIG9lID0gZnVuY3Rpb24gKGUsIG4pIHsgVVtlXSAmJiBVW2VdLmZvckVhY2goKGZ1bmN0aW9uIChlKSB7IGUobik7IH0pKTsgfSwgaWUgPSBmdW5jdGlvbiAoZSwgbiwgdCkgeyAhdCAmJiByZShlLCBuKSwgb2UoZSwgbik7IH0sIGFlID0gZnVuY3Rpb24gKGUpIHsgZSAmJiBPYmplY3Qua2V5cyhMKS5mb3JFYWNoKChmdW5jdGlvbiAobikgeyBlW25dICYmIExbbl0ucHVzaChlW25dKTsgfSkpOyB9LCBzZSA9IGZ1bmN0aW9uIChlKSB7IGUuYWlkIHx8IChlLmFpZCA9IHBuLmFpZCksIGUuZGlzcGxheU1vZGUgfHwgKGUuZGlzcGxheU1vZGUgPSBcIm1vZGFsXCIpLCBcInBvcHVwXCIgPT09IGUuZGlzcGxheU1vZGUgPyAoZS53aWR0aCA9IHBhcnNlSW50KGUud2lkdGgpIHx8IGxlKCksIGUuaGVpZ2h0ID0gcGFyc2VJbnQoZS5oZWlnaHQpIHx8IDQ2MCkgOiBcIm1vZGFsXCIgPT09IGUuZGlzcGxheU1vZGUgJiYgKGUud2lkdGggPSBwYXJzZUludChlLndpZHRoKSB8fCBsZSgpKSwgZS5hY2Nlc3NUb2tlbiA9IFBlKCk7IH0sIGNlID0gZnVuY3Rpb24gKGUpIHsgVCA9IGU7IH0sIGxlID0gZnVuY3Rpb24gKCkgeyB2YXIgZSA9IHdpbmRvdy5pbm5lcldpZHRoIHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCB8fCB3aW5kb3cuc2NyZWVuLndpZHRoOyByZXR1cm4gTWF0aC5taW4oZSwgNDAwKTsgfSwgdWUgPSBmdW5jdGlvbiAoZSwgbiwgdCkgeyBvID0gITEsIEVlKCksIHcucmVtb3ZlKEEpLCB1LnNldEFjY2Vzc1Rva2VuTGlzdENvb2tpZSh7IHZhbHVlOiBudWxsIH0sIHZvaWQgMCwgITApLCBVZSgpLnRoZW4oKGZ1bmN0aW9uICgpIHsgdCB8fCBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IHsgc291cmNlOiBlIH07IHJlKFwibG9nZ2VkT3V0XCIsIG4pLCBvZShcImxvZ291dFwiLCBuKTsgfShuKSwgZSAmJiBlKCk7IH0pKSwgWWUoKTsgfTsgZnVuY3Rpb24gZGUoZSkgeyByZXR1cm4gZnVuY3Rpb24gKG4pIHsgdmFyIHQsIHIsIG8gPSBlLmNvbmZpZy50cmFja2luZ0lkLCBpID0gZS5jb25maWcuZm9ybU5hbWU7IHN3aXRjaCAobi5ldmVudCkge1xuICAgICAgICBjYXNlIFwibG9hZGVkXCI6XG4gICAgICAgICAgICBcIm1vZGFsXCIgPT09IGUuY29uZmlnLmRpc3BsYXlNb2RlICYmIGQuY2hlY2tCYWNrZHJvcEFuZENvbnRhaW5lcihlLCAhMCksIGUuY29uZmlnLmxvYWRlZENhbGxiYWNrICYmIGUuY29uZmlnLmxvYWRlZENhbGxiYWNrKGUpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJzdGF0ZVJlYWR5XCI6XG4gICAgICAgICAgICBlLmNvbmZpZy5yZWFkeUNhbGxiYWNrICYmIGUuY29uZmlnLnJlYWR5Q2FsbGJhY2soZSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcInJlc2l6ZVwiOlxuICAgICAgICAgICAgZC5yZXNpemVJZnJhbWUoZSwgbi5wYXJhbXMpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJyZXN0b3JlU2l6ZVwiOlxuICAgICAgICAgICAgXCJpbmxpbmVcIiA9PT0gZS5jb25maWcuZGlzcGxheU1vZGUgJiYgZC5yZXNpemVJZnJhbWUoZSwgeyB3aWR0aDogcy5nZXRXaWR0aChlLmNvbnRhaW5lcikgfSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImxvZ2luU3VjY2Vzc1wiOlxuICAgICAgICAgICAgdmUobiwgKGZ1bmN0aW9uICgpIHsgZS5jb25maWcuY2FsbGJhY2sgJiYgZS5jb25maWcuY2FsbGJhY2soKSwgcG4udXNlci5yZWZyZXNoQWNjZXNzVG9rZW4oITApLCBwLmJyb2FkY2FzdChcInBpYW5vSWRMb2dpblN1Y2Nlc3NcIiwgbi5wYXJhbXMpOyB9KSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImxvZ2luRmFpbGVkXCI6XG4gICAgICAgICAgICBpZShcImxvZ2luRmFpbGVkXCIsIG4ucGFyYW1zKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwicmVnaXN0cmF0aW9uU3VjY2Vzc1wiOlxuICAgICAgICAgICAgdmUobiwgKGZ1bmN0aW9uICgpIHsgaWUoXCJyZWdpc3RyYXRpb25TdWNjZXNzXCIsIG4ucGFyYW1zKSwgcC5icm9hZGNhc3QoXCJwaWFub0lkTG9naW5TdWNjZXNzXCIsIG4ucGFyYW1zKTsgfSkpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJyZWdpc3RyYXRpb25GYWlsZWRcIjpcbiAgICAgICAgICAgIGllKFwicmVnaXN0cmF0aW9uRmFpbGVkXCIsIG4ucGFyYW1zKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwibGFuZ1wiOlxuICAgICAgICAgICAgQmUobi5wYXJhbXMubGFuZywgITApLCBHZShuLnBhcmFtcy5sYW5nLCBlKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiY3VzdG9tRXZlbnRcIjpcbiAgICAgICAgICAgIHQgPSBlLmNvbmZpZywgciA9IG4ucGFyYW1zLCB0ICYmIHQuY3VzdG9tRXZlbnQgJiYgdC5jdXN0b21FdmVudChyKSwgb2UoXCJjdXN0b21FdmVudFwiLCByKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiY2xvc2VkXCI6XG4gICAgICAgICAgICBEZShlLCAhMCksIGUuY29uZmlnLmNsb3NlZENhbGxiYWNrICYmIGUuY29uZmlnLmNsb3NlZENhbGxiYWNrKGUpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJjZkZvcm1TdWJtaXNzaW9uXCI6XG4gICAgICAgICAgICBmLl9fcHJvdGVjdGVkX18ubG9nQ3VzdG9tRm9ybVN1Ym1pc3Npb24obywgaSwgeCk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImZvcm1TZW5kXCI6XG4gICAgICAgIGNhc2UgXCJmb3JtU2tpcFwiOlxuICAgICAgICAgICAgRGUoZSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImNmQXBwSW1wcmVzc2lvblwiOlxuICAgICAgICAgICAgZi5fX3Byb3RlY3RlZF9fLmxvZ0N1c3RvbUZvcm1JbXByZXNzaW9uKG8sIGksIFApO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJjZkFwcFN1Ym1pc3Npb25cIjpcbiAgICAgICAgICAgIGYuX19wcm90ZWN0ZWRfXy5sb2dDdXN0b21Gb3JtU3VibWlzc2lvbihvLCBpLCBQKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiY2ZGb3JtSW1wcmVzc2lvblwiOlxuICAgICAgICAgICAgZi5fX3Byb3RlY3RlZF9fLmxvZ0N1c3RvbUZvcm1JbXByZXNzaW9uKG8sIGksIHgpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJjaGFuZ2VTY3JlZW5cIjpcbiAgICAgICAgICAgIHRlKG4ucGFyYW1zLnNjcmVlbik7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcInNjcmVlblJlYWR5XCI6XG4gICAgICAgICAgICBpZShcIm9uU2hvd1wiKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwibGF5b3V0UmVhZHlcIjpcbiAgICAgICAgICAgIGllKFwibGF5b3V0UmVhZHlcIiwgbi5wYXJhbXMpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJjb25maXJtYXRpb25FbWFpbFNlbnRcIjpcbiAgICAgICAgICAgIFwiaW5saW5lXCIgPT09IGUuY29uZmlnLmRpc3BsYXlNb2RlIHx8IG4ucGFyYW1zLmlzRE9JIHx8IG4ucGFyYW1zLmlzUGFzc3dvcmRsZXNzRGlnaXRhbENvZGUgfHwgRGUoZSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcInZlcmlmaWNhdGlvbkNvZGVTdGFydENoZWNrb3V0XCI6XG4gICAgICAgICAgICB2YXIgYSA9IHt9O1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBhID0gSlNPTi5wYXJzZShuLnBhcmFtcy5zdGFydENoZWNrb3V0UGFyYW1zKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgdS5sb2coXCJlcnJvciBwYXJzZSBzdGFydCBjaGVja291dCBwYXJhbXNcIiksIGEgPSB7fTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIERlKGUsICEwKSwgUmUoITAsICEwKSwgdS53YWl0Q2FsbChcInJlZnJlc2hVc2VyVG9rZW5cIiwgKGZ1bmN0aW9uICgpIHsgcG4ub2ZmZXIuc2hvdyhhKTsgfSkpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJyZW1vdmVQYXJhbUZyb21HbG9iYWxDb25maWdcIjpcbiAgICAgICAgICAgIGZlKG4pO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJ2ZXJpZnlDb2RlXCI6XG4gICAgICAgICAgICBtZShuLCBlKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwib3BlblBhc3N3b3JkbGVzc0xvZ2luV2l0aENyZWF0aW5nVXNlclwiOlxuICAgICAgICAgICAgcGUoKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiZmlyZUN1c3RvbUV2ZW50XCI6XG4gICAgICAgICAgICAhZnVuY3Rpb24gKGUpIHsgTiAmJiBcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIE5bZV0gJiYgTltlXSgpOyB9KG4ucGFyYW1zLm5hbWUpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJwYXNzd29yZFJlc3RvcmVkXCI6XG4gICAgICAgICAgICB1LnJlbW92ZVF1ZXJ5UGFyYW1CeU5hbWUoXCJyZXNldF90b2tlblwiKSwgTy5yZXNldFBhc3N3b3JkVG9rZW4gPSB2b2lkIDA7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImVtaXRHQUV2ZW50XCI6XG4gICAgICAgICAgICBnLmVtaXRFdmVudChuLnBhcmFtcyk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcInJlZGlyZWN0XCI6XG4gICAgICAgICAgICBkb2N1bWVudC5sb2NhdGlvbi5ocmVmID0gbi5wYXJhbXMudXJsO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJkZXNpZ25WZXJzaW9uXCI6XG4gICAgICAgICAgICBkLmFkZENsYXNzVG9Db250YWluZXIoZSwgXCJwaWFuby1pZC1tb2RhbC12ZXItXCIgKyBuLnBhcmFtcy52ZXJzaW9uKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwicHJvZmlsZVVwZGF0ZWRcIjpcbiAgICAgICAgICAgIHJlKFwicHJvZmlsZVVwZGF0ZVwiLCBuLnBhcmFtcyk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImxvZ291dFwiOlxuICAgICAgICAgICAgdWUoKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBkZWZhdWx0OiB1LmRlYnVnKFwiUmVjZWl2ZWQgaW52YWxpZCBldmVudCB0eXBlOiBcIiArIG4uZXZlbnQpO1xuICAgIH0gfTsgfSB2YXIgcGUgPSBmdW5jdGlvbiAoKSB7IHooeyBjcmVhdGVQYXNzd29yZGxlc3NVc2VyOiAhMCB9KTsgfSwgZmUgPSBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IGUucGFyYW1zLm5hbWUsIHQgPSB1LmZyb21VbmRlcnNjb3JlVG9DYW1lbENhc2Uobik7IGRlbGV0ZSBPW3RdLCBlLnBhcmFtcy5yZW1vdmVGcm9tVXJsICYmIHUucmVtb3ZlUXVlcnlQYXJhbUJ5TmFtZShuKTsgfSwgbWUgPSBmdW5jdGlvbiAoZSwgbikgeyB2YXIgdCA9IGUucGFyYW1zLnZlcmlmaWNhdGlvbkNvZGUsIHIgPSBlLnBhcmFtcy5sb2NhbGUsIG8gPSBPLmFpZCB8fCBwbi5haWQsIGkgPSBBZSgpLCBhID0gZG9jdW1lbnQubG9jYXRpb24uaHJlZjsgYy5yZXF1ZXN0KHsgdXJsOiBoZSgpICsgXCJhcGkvdjEvaWRlbnRpdHkvdmVyaWZpY2F0aW9uL2NvZGVcIiwgZGF0YVR5cGU6IFwianNvbnBcIiwgZGF0YTogeyBjbGllbnRfaWQ6IG8sIGFjY2Vzc190b2tlbjogaSwgc2l0ZTogYSwgdmVyaWZpY2F0aW9uX2NvZGU6IHQsIGxhbmc6IHIgfSwgc3VjY2VzczogZnVuY3Rpb24gKGUpIHsgZS5lcnJvciB8fCBnZShlLCBuKTsgfSwgeGhyRmllbGRzOiB7IHdpdGhDcmVkZW50aWFsczogITAgfSwgY3Jvc3NEb21haW46ICEwIH0pOyB9LCBnZSA9IGZ1bmN0aW9uIChlLCBuKSB7ICFlLmVycm9yICYmIGUuYWNjZXNzX3Rva2VuICYmIFNlKHsgdG9rZW46IGUuYWNjZXNzX3Rva2VuLCB1c2VyOiBsKGUuYWNjZXNzX3Rva2VuKSwgY29va2llX2RvbWFpbjogZS5zaXRlX2Nvb2tpZV9kb21haW4gfSksIHAuc2VuZChcInZlcmlmaWNhdGlvbkNvZGVDb21wbGV0ZVwiLCBlLCBuLmlmcmFtZUlkKTsgfSwgdmUgPSBmdW5jdGlvbiAoZSwgbikgeyBlICYmIGUucGFyYW1zICYmICFlLnBhcmFtcy5hcmVDb29raWVzU2V0ID8gKGUucGFyYW1zLnNvdXJjZSA9IFMsIG8gPSAhIWUucGFyYW1zLnJlZ2lzdHJhdGlvbiwgTWUoZS5wYXJhbXMpLnRoZW4oKGZ1bmN0aW9uIChlKSB7IG4oZSk7IH0pKSkgOiBcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIG4gJiYgbigpLCAkZSgpOyB9LCBoZSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGZ1bmN0aW9uICgpIHsgdmFyIGUgPSBwbi5zYW5kYm94IHx8IHBuLmlzTm9uUHJvZEVuZHBvaW50KCksIG4gPSBPLmlmcmFtZVVybCB8fCBwbi5waWFub0lkVXJsIHx8ICFlICYmIFwiaHR0cHM6Ly9pZC50aW55cGFzcy5jb21cIiB8fCBcIi9cIjsgcmV0dXJuIFwiL1wiID09PSBuICYmIChuID0gcG4uZ2V0RW5kcG9pbnRSb290KCEwKSksIG4ucmVwbGFjZSgvXFwvJC8sIFwiXCIpOyB9KCkgKyBcIi9pZC9cIjsgfSwgd2UgPSBmdW5jdGlvbiAoKSB7IHZhciBlID0gTy5haWQgfHwgcG4uYWlkOyByZXR1cm4gRi5pbmRleE9mKGUpID49IDA7IH0sIGJlID0gZnVuY3Rpb24gKGUsIG4sIHQsIHIpIHsgZS5tYXRjaChcInByb3h5Lmh0bWxcIikgfHwgKGUgKz0gd2UoKSA/IFwiaW5kZXgzLmh0bWxcIiA6IFwiXCIpOyB2YXIgbyA9IHsgY2xpZW50X2lkOiBuLmFpZCwgc2VuZGVyOiB0LmlmcmFtZUlkLCBvcmlnaW46IHIgfHwgd2luZG93LmxvY2F0aW9uLm9yaWdpbiB8fCB3aW5kb3cubG9jYXRpb24uaHJlZiwgc2l0ZTogd2luZG93LmxvY2F0aW9uLmhyZWYsIGRpc3BsYXlfbW9kZTogbi5kaXNwbGF5TW9kZSwgcGFnZVZpZXdJZDogcG4ubWFpbi5mZXRjaFBhZ2VWaWV3SWQoKSwgdGJjOiB1LmdldFRiY0Nvb2tpZSgpIH0sIGkgPSBWZSgpOyBpZiAoaSAmJiAoby5sYW5nID0gaSksIGcuZ2V0Q2xpZW50SWQoKSAmJiAoby5nYV9jbGllbnRfaWQgPSBnLmdldENsaWVudElkKCkpLCBnLmdldEdBQWNjb3VudCgpICYmIChvLmdhID0gZy5nZXRHQUFjY291bnQoKSksIG4uZGlzYWJsZVNpZ25VcCAmJiAoby5kaXNhYmxlX3NpZ25fdXAgPSAhMCksIG4uc2NyZWVuICYmIChvLnNjcmVlbiA9IG4uc2NyZWVuKSwgbi5yZXNldFBhc3N3b3JkVG9rZW4gJiYgKG8ucmVzZXQgPSBuLnJlc2V0UGFzc3dvcmRUb2tlbiksIG4udmVyaWZpY2F0aW9uX2NvZGUgJiYgKG8udmVyaWZpY2F0aW9uX2NvZGUgPSBuLnZlcmlmaWNhdGlvbl9jb2RlKSwgbi5zdGFnZSAmJiAoby5zdGFnZSA9IG4uc3RhZ2UpLCBuLnJlc2V0UGFzc3dvcmRMYW5kaW5nVXJsICYmIChvLnJlc2V0X3VyaSA9IG4ucmVzZXRQYXNzd29yZExhbmRpbmdVcmwpLCBuLndpZHRoICYmIFwibW9kYWxcIiA9PT0gbi5kaXNwbGF5TW9kZSAmJiAoby53aWR0aCA9IG4ud2lkdGgpLCBuLmZvcm1OYW1lICYmIChvLmZvcm1fbmFtZSA9IG4uZm9ybU5hbWUpLCBrZShuLCBlKSAmJiAoZSArPSBcImZvcm1cIiksIFwicHJvZmlsZVwiID09PSBuLnRlbXBsYXRlICYmIChlICs9IFwicHJvZmlsZVwiKSwgbi5oaWRlSWZDb21wbGV0ZSAmJiAoby5oaWRlX2lmX2NvbXBsZXRlID0gbi5oaWRlSWZDb21wbGV0ZSksIG4ucHJldmlldyAmJiAoby5wcmV2aWV3ID0gbi5wcmV2aWV3KSwgbi50ZW1wbGF0ZVZlcnNpb24gJiYgKG8udGVtcGxhdGVWZXJzaW9uID0gbi50ZW1wbGF0ZVZlcnNpb24pLCBuLnRlbXBsYXRlICYmIChvLnRlbXBsYXRlID0gbi50ZW1wbGF0ZSksIG4uYWNjZXNzVG9rZW4gJiYgKG8uYWNjZXNzX3Rva2VuID0gbi5hY2Nlc3NUb2tlbiksIG4uZW1haWwgJiYgKG8uZW1haWwgPSBuLmVtYWlsKSwgbi5zaW5nbGVTdGVwICYmIChvLnNpbmdsZV9zdGVwID0gITApLCBuLmNyZWF0ZVBhc3N3b3JkbGVzc1VzZXIgJiYgKG8uY3JlYXRlX3Bhc3N3b3JkbGVzc191c2VyID0gITApLCBuLmN1c3RvbVBhcmFtcyAmJiAoby5jdXN0b21fcGFyYW1zID0gSlNPTi5zdHJpbmdpZnkobi5jdXN0b21QYXJhbXMpKSwgbi5jdXN0b21FdmVudHMpIHtcbiAgICAgICAgdmFyIGEgPSBbXTtcbiAgICAgICAgT2JqZWN0LmtleXMobi5jdXN0b21FdmVudHMpLmZvckVhY2goKGZ1bmN0aW9uIChlKSB7IGEucHVzaChlKTsgfSkpLCBhLmxlbmd0aCAmJiAoby5jdXN0b21fZXZlbnRzID0gSlNPTi5zdHJpbmdpZnkoYSkpO1xuICAgIH0gcmV0dXJuIG4uanNvbnBFcnJvciAmJiAoby5qc29ucF9lcnJvciA9IEpTT04uc3RyaW5naWZ5KG4uanNvbnBFcnJvcikpLCBuLnBhc3N3b3JkbGVzc1N1Y2Nlc3MgJiYgKG8ucGFzc3dvcmRsZXNzX3N1Y2Nlc3MgPSAhMCksIG4ucGFzc3dvcmRsZXNzVG9rZW4gJiYgKG8ucGFzc3dvcmRsZXNzX3Rva2VuID0gbi5wYXNzd29yZGxlc3NUb2tlbiksIG4ucmVkaXJlY3RVcmkgJiYgKG8ucmVkaXJlY3RfdXJpID0gbi5yZWRpcmVjdFVyaSksIHQuaWZyYW1lVXJsICYmIChvLnVybCA9IHQuaWZyYW1lVXJsKSwgbi5yZXR1cm5CYWNrICYmIChvLnJldHVybl9iYWNrID0gbi5yZXR1cm5CYWNrKSwgdC5wb3MgJiYgKG8ud2lkdGggPSB0LnBvcy53aWR0aCwgby5oZWlnaHQgPSB0LnBvcy5oZWlnaHQsIG8udG9wID0gdC5wb3MudG9wLCBvLmxlZnQgPSB0LnBvcy5sZWZ0KSwgbi50ZW1wbGF0ZUlkICYmIChvLnRlbXBsYXRlX2lkID0gbi50ZW1wbGF0ZUlkKSwgbi52YXJpYW50SWQgJiYgKG8udmFyaWFudF9pZCA9IG4udmFyaWFudElkKSwgW2UsIHMucGFyYW0obyldLmpvaW4oXCI/XCIpOyB9LCBrZSA9IGZ1bmN0aW9uIChlLCBuKSB7IHZhciB0ID0gd2UoKSwgciA9ICFlLmlzUmVnaXN0cmF0aW9uLCBvID0gIS9cXC5odG1sJC8udGVzdChuKSB8fCB0OyByZXR1cm4gZS5mb3JtTmFtZSAmJiBvICYmIHI7IH0sIF9lID0gZnVuY3Rpb24gKGUpIHsgdmFyIHQgPSBzLnF1ZXJ5RWwoZS5jb250YWluZXJTZWxlY3RvciksIHIgPSBcInBpYW5vLWlkLVwiICsgKGUuaXNSZWdpc3RyYXRpb24gPyBcIlwiIDogXCJmb3JtLVwiKSArIHUucmFuZG9tU3RyaW5nKCk7IGUuc2luZ2xlQ29udGFpbmVyID0gdDsgdmFyIG8sIGksIGEsIGMgPSB7IGlmcmFtZUlkOiByLCBjb250YWluZXJTZWxlY3RvcjogZS5jb250YWluZXJTZWxlY3Rvciwgd2lkdGg6IGUud2lkdGgsIGhlaWdodDogZS5oZWlnaHQgfSwgbCA9IGJlKGhlKCksIGUsIGMpLCBmID0gaGUoKSwgZyA9ICEwOyBpZiAoZS5pZnJhbWVQYXJhbXMgPSBjLCBcImlubGluZVwiID09PSBlLmRpc3BsYXlNb2RlKSB7XG4gICAgICAgIHZhciB2ID0gZC5pbml0SW5saW5lQ29udGFpbmVyKGUpO1xuICAgICAgICBpZiAoIShvID0gdi5jb250YWluZXIpKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBpID0gZC5nZW5lcmF0ZUlmcmFtZShlLCBjLCBsKSwgZyA9ICEhdi5jb250YWluZXJSZWFkeSwgZS5vYnNlcnZlQ29udGFpbmVyICYmIChhID0gbS5jcmVhdGUobywgQikpO1xuICAgIH1cbiAgICBlbHNlIGlmIChcIm1vZGFsXCIgPT09IGUuZGlzcGxheU1vZGUpXG4gICAgICAgIG8gPSBkLmdldE1vZGFsQ29udGFpbmVyKGUsIChmdW5jdGlvbiAoKSB7IHJldHVybiBEZShuKTsgfSkpLCBpID0gZC5nZW5lcmF0ZUlmcmFtZShlLCBjLCBsKTtcbiAgICBlbHNlIGlmIChcInBvcHVwXCIgPT09IGUuZGlzcGxheU1vZGUpXG4gICAgICAgIGlmICh1LmlzSUUoKSkge1xuICAgICAgICAgICAgbyA9IGQuZ2VuZXJhdGVJZnJhbWVXcmFwcGVyKCksIGwgPSBiZShoZSgpLCBlLCBjLCBoZSgpICsgXCJwcm94eS5odG1sXCIpLCBjLmlmcmFtZVVybCA9IGwsIGMucG9zID0gZC5nZXRQb3B1cFBvc2l0aW9uKGMpO1xuICAgICAgICAgICAgdmFyIGggPSBiZShoZSgpICsgXCJwcm94eS5odG1sXCIsIGUsIGMpO1xuICAgICAgICAgICAgZS5kaXNwbGF5TW9kZSA9IFwiaW5saW5lUG9wdXBcIiwgaSA9IGQuZ2VuZXJhdGVJZnJhbWUoe30sIGMsIGgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgbyA9IGQuZ2VuZXJhdGVQb3B1cChjLCBsKTtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgaSA9IG8uZG9jdW1lbnQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIGkgPSBvO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgaSA9IHdpbmRvdy5kb2N1bWVudDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSB2YXIgdyA9IHsgaWZyYW1lSWQ6IGMuaWZyYW1lSWQsIGNvbmZpZzogZSwgZWxlbWVudDogaSwgY29udGFpbmVyOiBvLCBpZnJhbWVQYXJhbXM6IGMsIGNvbnRhaW5lclJlYWR5OiBnIH0sIHkgPSB7IGNlbnRlcjogdS5jZW50ZXJTY3JlZW4oKSwgb3JpZ2luVXJsOiBkb2N1bWVudC5sb2NhdGlvbi5ocmVmIH07IGlmIChwLmluaXQoeyBwb3N0TWVzc2FnZVVybDogZiwgcmVjZWl2ZTogZGUodyksIGlmcmFtZTogdywgaWZyYW1lUGFyYW1zOiBjIH0sIHkpLCBcImlubGluZVwiID09PSBlLmRpc3BsYXlNb2RlKSB7XG4gICAgICAgIHZhciBiID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgICAgcy5hZGRDbGFzcyhcInBpYW5vLWlkLWNvbnRhaW5lclwiLCBiKSwgcy5hcHBlbmQoYiwgaSksIHMuYXBwZW5kKG8sIGIpO1xuICAgIH1cbiAgICBlbHNlXG4gICAgICAgIFwibW9kYWxcIiA9PT0gZS5kaXNwbGF5TW9kZSA/IHMuYXBwZW5kKG8sIGkpIDogXCJpbmxpbmVQb3B1cFwiID09PSBlLmRpc3BsYXlNb2RlICYmIChzLmFwcGVuZChvLCBpKSwgcy5hcHBlbmQoZG9jdW1lbnQuYm9keSwgbykpOyBpZiAodS5kZWJ1ZyhcImNyZWF0aW5nIGlmcmFtZTogXCIsIGUpLCBSLnB1c2godyksIFwibW9kYWxcIiA9PT0gZS5kaXNwbGF5TW9kZSkge1xuICAgICAgICAobiA9IHcpLm9ic2VydmVyID0gYSwgKHUuaXNJcGhvbmUoKSB8fCB1LmlzU2FmYXJpT3JJT3NVaVdlYlZpZXcoKSB8fCB1LmlzQW5kcm9pZCgpKSAmJiBkLl9fcHJpdmF0ZV9fLm1vYmlsZU1vZGFsRml4Lm1vZGFsT3BlbmVkKCk7XG4gICAgICAgIHZhciBrID0gVmUoKTtcbiAgICAgICAgR2Uoaywgdyk7XG4gICAgfSByZXR1cm4gdzsgfSwgQ2UgPSBmdW5jdGlvbiAoZSkgeyBpZiAobikge1xuICAgICAgICB2YXIgdCA9IGQuX19wcml2YXRlX18ubW9iaWxlTW9kYWxGaXg7XG4gICAgICAgIGQuY2xvc2VNb2RhbChuKSwgcy5yZW1vdmUobi5lbGVtZW50KSwgbi5vYnNlcnZlciAmJiBuLm9ic2VydmVyLmRpc2Nvbm5lY3QoKSwgdC5pc0lwaG9uZUNhcmV0Rml4ZWQgJiYgdC5tb2RhbENsb3NlZCgpLCBuID0gdm9pZCAwO1xuICAgIH0gfSwgSWUgPSBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IHsgcGF0aDogXCIvXCIgfSwgdCA9IHUuX19wcm90ZWN0ZWRfXy5nZXRDb29raWUoXyksIHIgPSB1LmV4dHJhY3RDb29raWVEb21haW4oZSB8fCB0KTsgcmV0dXJuIHIgJiYgKG4uZG9tYWluID0gciksIChwbi5jb29raWVEb21haW4gfHwgcG4uY29va2llUGF0aCkgJiYgKG4uZG9tYWluID0gcG4uY29va2llRG9tYWluID8gcG4uY29va2llRG9tYWluIDogbi5kb21haW4sIG4ucGF0aCA9IHBuLmNvb2tpZVBhdGggPyBwbi5jb29raWVQYXRoIDogbi5wYXRoKSwgbjsgfSwgU2UgPSBmdW5jdGlvbiAoZSkgeyBpZiAoZSAmJiBlLnVzZXIgJiYgZS50b2tlbikge1xuICAgICAgICBFZShudWxsLCAhMCwgITApO1xuICAgICAgICB2YXIgbiA9IEllKGUuY29va2llX2RvbWFpbik7XG4gICAgICAgIGUuZXh0ZW5kRXhwaXJlZEFjY2Vzc0VuYWJsZWQgJiYgeGUoZS5leHRlbmRFeHBpcmVkQWNjZXNzRW5hYmxlZCwgZS5jb29raWVfZG9tYWluKSwgKGUudXNlci5yZW1lbWJlck1lIHx8IEhlKCkpICYmIChuLmV4cGlyZXMgPSBuZXcgRGF0ZSgxZTMgKiBlLnVzZXIuZXhwKSwgcWUobikpO1xuICAgICAgICB2YXIgdCA9IHUuZ2V0UG9zc2libGVDb29raWVEb21haW5zKCk7XG4gICAgICAgIGZvciAodmFyIHIgaW4gdClcbiAgICAgICAgICAgIHUuZGVsZXRlQ29va2llKGIsIHRbcl0pO1xuICAgICAgICB1Ll9fcHJvdGVjdGVkX18uc2V0Q29va2llKGIsIGUudG9rZW4sIG4pLCBlLmNvb2tpZV9kb21haW4gJiYgKG4uZXhwaXJlcyA9IDMwLCB1Ll9fcHJvdGVjdGVkX18uc2V0Q29va2llKF8sIGUuY29va2llX2RvbWFpbiwgbikpO1xuICAgIH0gfSwgeGUgPSBmdW5jdGlvbiAoZSwgbikgeyBKZShcInNldEV4dGVuZEV4cGlyZWRBY2Nlc3NcIiwgZSwgXCJicm9hZGNhc3RcIik7IHZhciB0ID0gSWUobik7IHQuZXhwaXJlcyA9IDMwLCB1Ll9fcHJvdGVjdGVkX18uc2V0Q29va2llKEksIGUgPyBcInRydWVcIiA6IFwiZmFsc2VcIiwgdCk7IH0sIFBlID0gZnVuY3Rpb24gKCkgeyB2YXIgZSA9IHUuZmluZENvb2tpZUJ5TmFtZShiKTsgcmV0dXJuIGUgfHwgbnVsbDsgfSwgRWUgPSBmdW5jdGlvbiAoZSwgbiwgdCkgeyB2YXIgciA9IEllKCksIG8gPSB1LmdldFBvc3NpYmxlQ29va2llRG9tYWlucyhyLmRvbWFpbik7IGUgJiYgdS5fX3Byb3RlY3RlZF9fLmxvZ1JlbW92ZVRva2VucyhlKSwgby5mb3JFYWNoKChmdW5jdGlvbiAoZSkgeyB2YXIgbyA9IHllKHllKHt9LCByKSwgeyBkb21haW46IGUgfSk7IGEucmVtb3ZlKGIsIG8pLCB0IHx8IGEucmVtb3ZlKEksIG8pLCBuIHx8IHplKG8pOyB9KSk7IH0sIFRlID0gZnVuY3Rpb24gKCkgeyB2YXIgZSA9IG51bGwsIG4gPSBQZSgpOyBpZiAobilcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGlmIChlID0gbChuKSkge1xuICAgICAgICAgICAgICAgIGUuZmlyc3ROYW1lID0gZS5naXZlbl9uYW1lLCBlLmxhc3ROYW1lID0gZS5mYW1pbHlfbmFtZSwgZS52YWxpZCA9ICEwLCBlLnVpZCA9IGUuc3ViLCBlLmNvbmZpcm1lZCA9ICFlLmVtYWlsX2NvbmZpcm1hdGlvbl9yZXF1aXJlZDtcbiAgICAgICAgICAgICAgICB2YXIgdCA9IG5ldyBEYXRlO1xuICAgICAgICAgICAgICAgIG5ldyBEYXRlKDFlMyAqIGUuZXhwKSA8IHQgJiYgKHUubG9nKFwiUmVtb3ZpbmcgZXhwaXJlZCB0b2tlbnNcIiksIEVlKG4pLCBlID0gbnVsbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHsgfSByZXR1cm4gZTsgfSwgQWUgPSBmdW5jdGlvbiAoKSB7IHJldHVybiBwbi5leHRlcm5hbEpXVCAmJiBRZSgpID8gcG4uZXh0ZXJuYWxKV1QgOiBQZSgpOyB9LCBNZSA9IGZ1bmN0aW9uIChlLCBuLCB0KSB7IFNlKGUpOyB2YXIgciA9IGplKGUpLnRoZW4oKGZ1bmN0aW9uICgpIHsgIW4gJiYgbmUobnVsbCwgeyBzdGFnZTogZS5zdGFnZSwgc291cmNlOiBlLnNvdXJjZSB9KTsgfSkpOyBpZiAoISh0ID0gdCB8fCBlLndpdGhvdXRDbG9zZU1vZGFsKSkge1xuICAgICAgICB2YXIgbyA9IGUgJiYgZS51c2VyICYmIGUudXNlci5lbWFpbF9jb25maXJtYXRpb25fcmVxdWlyZWQsIGkgPSBPLnZlcmlmaWNhdGlvbl9jb2RlO1xuICAgICAgICBvIHx8IGkgPyBkLmhpZGVDbG9zZUJ1dHRvbigpIDogRmUoKTtcbiAgICB9IHJldHVybiByOyB9LCBPZSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIFFlKCkgPyAhIXBuLmV4dGVybmFsSldUIDogISFUZSgpOyB9LCBSZSA9IGZ1bmN0aW9uIChlLCBuKSB7IHJldHVybiBuZXcgUHJvbWlzZSgoZnVuY3Rpb24gKHQsIHIpIHsgdS5zdGFydENhbGwoXCJyZWZyZXNoVXNlclRva2VuXCIpOyB2YXIgbyA9IGZ1bmN0aW9uIChlKSB7IHZhciBuID0gdm9pZCAwID09PSBlID8ge30gOiBlLCBvID0gbi5pc1N1Y2Nlc3NmdWwsIGkgPSBuLmdtU1NPRW5hYmxlZDsgbyA/IHQobnVsbCkgOiByKCksIHUuZG9uZUNhbGwoXCJyZWZyZXNoVXNlclRva2VuXCIpLCBvICYmIChEID0gaSkgJiYgIVhlKCkgJiYgeih7IHNjcmVlbjogXCJzc29fY29uZmlybVwiIH0pOyB9LCBpID0gZnVuY3Rpb24gKHQpIHsgIXQuZXJyb3IgJiYgdC5hY2Nlc3NfdG9rZW4gPyBNZSh7IHRva2VuOiB0LmFjY2Vzc190b2tlbiwgdXNlcjogbCh0LmFjY2Vzc190b2tlbiksIGNvb2tpZV9kb21haW46IHQuc2l0ZV9jb29raWVfZG9tYWluLCBleHRlbmRFeHBpcmVkQWNjZXNzRW5hYmxlZDogdC5leHRlbmRfZXhwaXJlZF9hY2Nlc3NfZW5hYmxlZCB9LCBlLCBuKS50aGVuKChmdW5jdGlvbiAoKSB7IHJldHVybiBvKHsgaXNTdWNjZXNzZnVsOiAhMCwgZ21TU09FbmFibGVkOiB0LmF1dGhvcml6ZWRfYnlfc3NvIH0pOyB9KSkgOiAoRWUoQWUoKSksIG8oeyBpc1N1Y2Nlc3NmdWw6ICExIH0pKTsgfSwgYSA9IEFlKCkgfHwgdm9pZCAwLCBzID0geyBjbGllbnRfaWQ6IE8uYWlkIHx8IHBuLmFpZCwgc2l0ZTogZG9jdW1lbnQubG9jYXRpb24ub3JpZ2luIHx8IGRvY3VtZW50LmxvY2F0aW9uLmhyZWYgfSwgZCA9IExlKCk7IGQgJiYgKHMudGNmID0gZCksIGEgPyBjLnJlcXVlc3QoeyB1cmw6IGhlKCkgKyBcImFwaS92MS9pZGVudGl0eS90b2tlbi92YWxpZGF0aW9uXCIsIGRhdGE6IHMsIGhlYWRlcnM6IHsgQXV0aG9yaXphdGlvbjogYSB9LCBzdWNjZXNzOiBmdW5jdGlvbiAoZSkgeyBpKGUpLCBlLmFjY2Vzc190b2tlbiAmJiBOZShkKTsgfSwgZXJyb3I6IG8gfSkgOiBjLnJlcXVlc3QoeyB1cmw6IGhlKCkgKyBcImFwaS92MS9pZGVudGl0eS90b2tlbi92ZXJpZnlcIiwgZGF0YTogcywgc3VjY2VzczogZnVuY3Rpb24gKGUpIHsgaShlKSwgZS5hY2Nlc3NfdG9rZW4gJiYgTmUoZCk7IH0sIGVycm9yOiBvLCBkYXRhVHlwZTogXCJqc29ucFwiLCB4aHJGaWVsZHM6IHsgd2l0aENyZWRlbnRpYWxzOiAhMCB9LCBjcm9zc0RvbWFpbjogITAgfSksIHNldFRpbWVvdXQobywgMTAgKiBUKTsgfSkpOyB9LCBMZSA9IGZ1bmN0aW9uICgpIHsgdmFyIGUsIG4gPSB3aW5kb3c7IHJldHVybiBmdW5jdGlvbiAoZSkgeyBpZiAoIWUpXG4gICAgICAgIHJldHVybiAhMTsgdmFyIG4gPSBlOyBpZiAoIW4gfHwgIW4udGNTdHJpbmcgfHwgIW4uZGF0ZSlcbiAgICAgICAgcmV0dXJuICExOyB2YXIgdCA9IG5ldyBEYXRlLCByID0gbmV3IERhdGUobi5kYXRlKSwgbyA9IE1hdGguYWJzKHIuZ2V0VGltZSgpIC0gdC5nZXRUaW1lKCkpOyByZXR1cm4gTWF0aC5jZWlsKG8gLyA4NjRlNSkgPD0gMTsgfSh3LmdldChBKSkgPyBudWxsIDogKGUgPSBudWxsLCBuLl9fdGNmYXBpICYmIG4uX190Y2ZhcGkoXCJnZXRUQ0RhdGFcIiwgMiwgKGZ1bmN0aW9uIChuLCB0KSB7IHQgJiYgbi50Y1N0cmluZyAmJiAoZSA9IG4udGNTdHJpbmcpOyB9KSwgWzQxMl0pLCBlKTsgfSwgTmUgPSBmdW5jdGlvbiAoZSkgeyBpZiAoZSkge1xuICAgICAgICB2YXIgbiA9IHsgZGF0ZTogKG5ldyBEYXRlKS50b1N0cmluZygpLCB0Y1N0cmluZzogZSB9O1xuICAgICAgICB3LnNldChBLCBKU09OLnN0cmluZ2lmeShuKSk7XG4gICAgfSB9LCBVZSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIG5ldyBQcm9taXNlKChmdW5jdGlvbiAoZSkgeyBjLnJlcXVlc3QoeyB1cmw6IGhlKCkgKyBcImFwaS92MS9pZGVudGl0eS9sb2dvdXRcIiwgZGF0YTogeyBjbGllbnRfaWQ6IE8uYWlkIHx8IHBuLmFpZCB9LCBkYXRhVHlwZTogXCJqc29ucFwiLCBjb21wbGV0ZTogZSwgeGhyRmllbGRzOiB7IHdpdGhDcmVkZW50aWFsczogITAgfSwgY3Jvc3NEb21haW46ICEwIH0pLCBzZXRUaW1lb3V0KGUsIFQpOyB9KSk7IH0sIGplID0gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIG5ldyBQcm9taXNlKChmdW5jdGlvbiAobikgeyB2YXIgdCA9ICEoZSAmJiBlLnVzZXIgJiYgZS51c2VyLnJlbWVtYmVyTWUgfHwgSGUoKSk7IGMucmVxdWVzdCh7IHVybDogaGUoKSArIFwiYXBpL3YxL2lkZW50aXR5L3Z4YXV0aC9jb29raWVcIiwgZGF0YTogeyBjbGllbnRfaWQ6IE8uYWlkIHx8IHBuLmFpZCwgc2Vzc2lvbl9jb29raWU6IHQgfSwgaGVhZGVyczogeyBBdXRob3JpemF0aW9uOiBlLnRva2VuIHx8IHZvaWQgMCB9LCBjb21wbGV0ZTogbiB9KSwgc2V0VGltZW91dChuLCBUKTsgfSkpOyB9LCBEZSA9IGZ1bmN0aW9uIChlLCBuKSB7IGUgJiYgKG4gPyBlLmNsb3NlZCB8fCAoZS5jbG9zZWQgPSAhMCwgXCJpbmxpbmVcIiA9PT0gZS5jb25maWcuZGlzcGxheU1vZGUgPyBzLmVtcHR5KGUuY29udGFpbmVyKSA6IFwicG9wdXBcIiA9PT0gZS5jb25maWcuZGlzcGxheU1vZGUgPyBlLmNvbnRhaW5lci5jbG9zZSgpIDogXCJtb2RhbFwiID09PSBlLmNvbmZpZy5kaXNwbGF5TW9kZSAmJiAoQ2UoKSwgcy5yZW1vdmUoZS5jb250YWluZXIucGFyZW50RWxlbWVudCkpLCBEICYmIEFlKCkgJiYgJGUoKSkgOiAocC5zZW5kKFwiY2xvc2VcIiwge30sIGUuaWZyYW1lSWQpLCBSID0gUi5maWx0ZXIoKGZ1bmN0aW9uIChuKSB7IHJldHVybiBuLmlmcmFtZUlkICE9PSBlLmlmcmFtZUlkOyB9KSksIHNldFRpbWVvdXQoKGZ1bmN0aW9uICgpIHsgRGUoZSwgITApOyB9KSwgNjAwKSkpOyB9LCBGZSA9IGZ1bmN0aW9uICgpIHsgUi5mb3JFYWNoKChmdW5jdGlvbiAoZSkgeyBEZShlKTsgfSkpLCBSID0gW107IH0sIEJlID0gZnVuY3Rpb24gKGUsIG4pIHsgdmFyIHQgPSBJZSgpOyB0LmV4cGlyZXMgPSAzMCwgdS5fX3Byb3RlY3RlZF9fLnNldENvb2tpZShrLCBlLCB0KSwgbiB8fCBSLmZvckVhY2goKGZ1bmN0aW9uIChuKSB7IHAuc2VuZChcImxhbmdcIiwgeyBsYW5nOiBlIH0sIG4uaWZyYW1lSWQpOyB9KSksIE9iamVjdC5rZXlzKEwubGFuZ0NoYW5nZUZyb21JZnJhbWUpLmZvckVhY2goKGZ1bmN0aW9uIChuKSB7IHZhciB0ID0gTC5sYW5nQ2hhbmdlRnJvbUlmcmFtZVtuXTsgcC5fX3Byb3RlY3RlZF9fLmlzSWZyYW1lTWFuYWdlZChuKSAmJiB0ID8gdChlKSA6IGRlbGV0ZSBMLmxhbmdDaGFuZ2VGcm9tSWZyYW1lW25dOyB9KSksIGllKFwibGFuZ0NoYW5nZVwiLCBlKTsgfSwgVmUgPSBmdW5jdGlvbiAoKSB7IHJldHVybiBwbi5sb2NhbGUgfHwgdS5fX3Byb3RlY3RlZF9fLmdldENvb2tpZShrKSB8fCBcIlwiOyB9LCBxZSA9IGZ1bmN0aW9uIChlKSB7IHUuX19wcm90ZWN0ZWRfXy5zZXRDb29raWUoQywgMSwgZSk7IH0sIHplID0gZnVuY3Rpb24gKGUpIHsgZSAmJiBhLnJlbW92ZShDLCBlKTsgfSwgSGUgPSBmdW5jdGlvbiAoKSB7IHJldHVybiAhIXUuX19wcm90ZWN0ZWRfXy5nZXRDb29raWUoQyk7IH0sIFdlID0gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIG5ldyBQcm9taXNlKChmdW5jdGlvbiAobikgeyB2YXIgdCA9IE9iamVjdC5hc3NpZ24oe30sIE8sIGUpOyBjLnJlcXVlc3QoeyB1cmw6IGhlKCkgKyBcImFwaS92MS9pZGVudGl0eS91c2VyaW5mb1wiLCBkYXRhOiB7IGNsaWVudF9pZDogTy5haWQgfHwgcG4uYWlkLCBmb3JtX25hbWU6IHQuZm9ybU5hbWUgfSwgaGVhZGVyczogeyBBdXRob3JpemF0aW9uOiBBZSgpIHx8IHZvaWQgMCB9LCBzdWNjZXNzOiBuLCBjb21wbGV0ZTogZnVuY3Rpb24gKCkgeyByZXR1cm4gbihudWxsKTsgfSB9KSwgc2V0VGltZW91dChuLCAxMCAqIFQpOyB9KSk7IH0sIEplID0gZnVuY3Rpb24gKGUsIG4sIHQpIHsgai5wdXNoKHsgdHlwZTogdCwgbmFtZTogZSwgZGF0YTogbiB9KTsgfSwgR2UgPSBmdW5jdGlvbiAoZSwgbikgeyBNLmluY2x1ZGVzKGUpID8gZC50dXJuT25SVEwobikgOiBkLnR1cm5PZmZSVEwobik7IH0sIFFlID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gITAgPT09IHBuLnVzZVBpYW5vSWRMaXRlVXNlclByb3ZpZGVyIHx8IFwic3RyaW5nXCIgPT0gdHlwZW9mIHBuLnVzZVBpYW5vSWRMaXRlVXNlclByb3ZpZGVyICYmIFwidHJ1ZVwiID09PSBwbi51c2VQaWFub0lkTGl0ZVVzZXJQcm92aWRlcjsgfSwgWGUgPSBmdW5jdGlvbiAoKSB7IHJldHVybiAhIXcuZ2V0KFwicGlhbm8taWQtaW5pdGlhbC1nbS1zc28tc2hvd24tXCIgKyAoTy5haWQgfHwgcG4uYWlkKSk7IH0sICRlID0gZnVuY3Rpb24gKCkgeyB3LnNldChcInBpYW5vLWlkLWluaXRpYWwtZ20tc3NvLXNob3duLVwiICsgKE8uYWlkIHx8IHBuLmFpZCksIFwiMVwiKTsgfSwgWWUgPSBmdW5jdGlvbiAoKSB7IHcucmVtb3ZlKFwicGlhbm8taWQtaW5pdGlhbC1nbS1zc28tc2hvd24tXCIgKyAoTy5haWQgfHwgcG4uYWlkKSk7IH07IHJldHVybiB7IG5hbWU6IFwicGlhbm9JZFwiLCBpc3Y6ICExLCBpbml0OiBxLCBwcmVwYXJlOiBmdW5jdGlvbiAoKSB7IHJldHVybiBWKCk7IH0sIHNob3c6IHosIHNob3dGb3JtOiBmdW5jdGlvbiAoZSkgeyBxKCkudGhlbigoZnVuY3Rpb24gKCkgeyB2YXIgdCA9IE9iamVjdC5hc3NpZ24oe30sIE8sIGUsIHsgaXNSZWdpc3RyYXRpb246ICExIH0pOyBpZiAoIXQuZm9ybU5hbWUpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Zvcm0gbmFtZSBzaG91bGQgYmUgc3BlY2lmaWVkLCBsaWtlXFxudHAucGlhbm9zSWQuc2hvd0Zvcm0oe2Zvcm1OYW1lOiBcIi4uLlwifSk7Jyk7IHZhciByID0gZnVuY3Rpb24gKCkgeyBpZiAobilcbiAgICAgICAgICAgIHUubG9nKFwiTW9kYWwgbG9naW4gd2luZG93IGFscmVhZHkgc2hvd25cIik7XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaWYgKHNlKHQpLCBhZShlKSwgIXQucHJldmlldyAmJiBvKVxuICAgICAgICAgICAgICAgIHJldHVybiB2b2lkIHUubG9nKFwiU2tpcCBzaG93IGZvcm0sIHJlZ2lzdGVyIG5ldyB1c2VyXCIpO1xuICAgICAgICAgICAgaWYgKCF0LmhpZGVJZkNvbXBsZXRlKVxuICAgICAgICAgICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKHQsIHsgcmVhZHlDYWxsYmFjazogZnVuY3Rpb24gKGUpIHsgcC5zZW5kKFwic2V0VG9rZW5cIiwgQWUoKSwgZS5pZnJhbWVJZCk7IH0gfSksIF9lKHQpO1xuICAgICAgICAgICAgV2UodCkudGhlbigoZnVuY3Rpb24gKGUpIHsgaWYgKGUgJiYgZS5oYXNfYWxsX2N1c3RvbV9maWVsZF92YWx1ZXNfZmlsbGVkICYmIHQuaGlkZUlmQ29tcGxldGUpXG4gICAgICAgICAgICAgICAgdS5sb2coXCJTa2lwIHNob3cgZm9ybSwgYWxsIGZpZWxkcyBhcmUgY29tcGxldGVkXCIpO1xuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFyIG4gPSBPYmplY3QuYXNzaWduKHt9LCB0LCB7IHJlYWR5Q2FsbGJhY2s6IGZ1bmN0aW9uIChuKSB7IHAuc2VuZChcInVzZXJEYXRhXCIsIGUsIG4uaWZyYW1lSWQpOyB9IH0pO1xuICAgICAgICAgICAgICAgIF9lKG4pO1xuICAgICAgICAgICAgfSB9KSk7XG4gICAgICAgIH0gfTsgaWYgKGUucHJldmlldyB8fCBPZSgpKVxuICAgICAgICAgICAgcigpO1xuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHZhciBpID0gT2JqZWN0LmFzc2lnbih7fSwgZSwgeyBjbG9zZWRDYWxsYmFjazogZnVuY3Rpb24gKCkgeyBPZSgpICYmIHIoKTsgfSB9KTtcbiAgICAgICAgICAgIHooaSk7XG4gICAgICAgIH0gfSkpOyB9LCBjaGVja0FuZFNob3dFbWFpbElzTm90Q29uZmlybWVkOiBILCBzaG93RW1haWxDb25maXJtYXRpb25SZXF1aXJlZDogZnVuY3Rpb24gKGUpIHsgbiA/IHUubG9nKFwiTW9kYWwgd2luZG93IGFscmVhZHkgc2hvd25cIikgOiBxKCkudGhlbigoZnVuY3Rpb24gKCkgeyB2YXIgbiA9IE9iamVjdC5hc3NpZ24oeyBzY3JlZW46IFwiZW1haWxfY29uZmlybWF0aW9uX3JlcXVpcmVkXCIgfSwgTywgZSk7IGFlKGUpLCBzZShuKSwgX2Uobik7IH0pKTsgfSwgc3VibWl0TG9naW5Gb3JtOiBmdW5jdGlvbiAoKSB7IHAuc2VuZChcInN1Ym1pdExvZ2luRm9ybVwiLCBudWxsLCBudWxsID09IG4gPyB2b2lkIDAgOiBuLmlmcmFtZUlkKTsgfSwgbG9naW5CeVRva2VuOiBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IGwoZSk7IE1lKHsgdXNlcjogbiwgdG9rZW46IGUgfSk7IH0sIGxvZ291dDogdWUsIGdldFRva2VuOiBBZSwgZ2V0VXNlcjogVGUsIGxvYWRFeHRlbmRlZFVzZXI6IGZ1bmN0aW9uIChlKSB7IHZhciBuID0gT2JqZWN0LmFzc2lnbih7fSwgTywgZSk7IFdlKG4pLnRoZW4oKGZ1bmN0aW9uIChlKSB7IHZhciB0ID0gT2JqZWN0LmFzc2lnbih7fSwgZSk7IGUgJiYgQXJyYXkuaXNBcnJheShlLmN1c3RvbV9maWVsZF92YWx1ZXMpICYmIChlLmN1c3RvbV9maWVsZF92YWx1ZXMgPSBlLmN1c3RvbV9maWVsZF92YWx1ZXMubWFwKChmdW5jdGlvbiAoZSkgeyB2YXIgbjsgdHJ5IHtcbiAgICAgICAgICAgIG4gPSBKU09OLnBhcnNlKGUudmFsdWUpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoICh0KSB7XG4gICAgICAgICAgICBuID0gZS52YWx1ZTtcbiAgICAgICAgfSByZXR1cm4geyBmaWVsZF9uYW1lOiBlLmZpZWxkX25hbWUsIHZhbHVlOiBuLCBjcmVhdGVkOiBlLmNyZWF0ZWQgfTsgfSkpKSwgXCJmdW5jdGlvblwiID09IHR5cGVvZiBuLmV4dGVuZGVkVXNlckxvYWRlZCAmJiBuLmV4dGVuZGVkVXNlckxvYWRlZCh0KSwgb2UoXCJleHRlbmRlZFVzZXJMb2FkZWRcIiwgdCk7IH0pKTsgfSwgZ2V0TmFtZTogZnVuY3Rpb24gKCkgeyByZXR1cm4gXCJwaWFub19pZFwiOyB9LCBpc0NvbmZpZ3VyZWQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuICEwID09PSBwbi51c2VQaWFub0lkVXNlclByb3ZpZGVyIHx8IFwic3RyaW5nXCIgPT0gdHlwZW9mIHBuLnVzZVBpYW5vSWRVc2VyUHJvdmlkZXIgJiYgXCJ0cnVlXCIgPT09IHBuLnVzZVBpYW5vSWRVc2VyUHJvdmlkZXI7IH0sIG9uTG9naW5TdWNjZXNzOiBmdW5jdGlvbiAoZSkgeyBpZiAoIWkpIHtcbiAgICAgICAgICAgIGkgPSAhMDtcbiAgICAgICAgICAgIHZhciBuID0geyBzb3VyY2U6IGUuc291cmNlLCB0b2tlbjogZS51c2VyX3Rva2VuLCB1c2VyOiBlLnBhcmFtcywgY29va2llX2RvbWFpbjogZS5jb29raWVfZG9tYWluLCBzdGFnZTogZS5zdGFnZSB9O1xuICAgICAgICAgICAgdS5zZXRBY2Nlc3NUb2tlbkxpc3RDb29raWUoeyB2YWx1ZTogZS50b2tlbl9saXN0LCBjb29raWVfZG9tYWluOiBlLmNvb2tpZV9kb21haW4gfSwgZS51c2VyX3Rva2VuKSwgTWUobikudGhlbigoZnVuY3Rpb24gKCkgeyBpID0gITE7IH0pKTtcbiAgICAgICAgfSB9LCBvblByb2ZpbGVVcGRhdGU6IGZ1bmN0aW9uIChlLCBuKSB7IHZhciB0ID0geyB0b2tlbjogZS50b2tlbiwgdXNlcjogZS51c2VyLCBjb29raWVfZG9tYWluOiBlLmNvb2tpZV9kb21haW4gfTsgTWUodCwgITApLnRoZW4oKGZ1bmN0aW9uICgpIHsgbigpLCBmdW5jdGlvbiAoZSkgeyByZShcInByb2ZpbGVVcGRhdGVcIiwgZSk7IH0odCk7IH0pKTsgfSwgb25FeHRlbmRlZFVzZXJMb2dpblJlcXVpcmVkOiBmdW5jdGlvbiAoKSB7IFcoKTsgfSwgaXNVc2VyVmFsaWQ6IE9lLCBzZXRDYWxsYmFja3M6IGFlLCBnZXRJZnJhbWVVcmw6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGhlKCk7IH0sIHVwZGF0ZUxhbmc6IEJlLCBvbkxhbmdDaGFuZ2U6IGZ1bmN0aW9uIChlLCBuKSB7IHJldHVybiBMLmxhbmdDaGFuZ2VGcm9tSWZyYW1lW25dID0gZSwgZnVuY3Rpb24gKCkgeyBkZWxldGUgTC5sYW5nQ2hhbmdlRnJvbUlmcmFtZVtuXTsgfTsgfSwgZ2V0TGFuZzogVmUsIGlzQW90OiBmdW5jdGlvbiAoKSB7IFIuZm9yRWFjaCgoZnVuY3Rpb24gKGUpIHsgcC5zZW5kKFwiaXNBT1RcIiwge30sIGUuaWZyYW1lSWQpOyB9KSk7IH0sIHJlZ2lzdGVyQ2FsbGJhY2s6IGZ1bmN0aW9uIChlLCBuKSB7IFVbZV0gPSBVW2VdIHx8IFtdLCBVW2VdLnB1c2gobik7IH0sIHNldFJlcXVlc3RUaW1lb3V0OiBjZSwgX19wcm90ZWN0ZWRfXzogeyBvZmZlck1lc3NhZ2VSZWNlaXZlcjogZnVuY3Rpb24gKGUpIHsgc3dpdGNoIChlLnBhcmFtcy5ldmVudCkge1xuICAgICAgICAgICAgICAgIGNhc2UgXCJjZkFwcEltcHJlc3Npb25cIjpcbiAgICAgICAgICAgICAgICBjYXNlIFwiY2ZGb3JtSW1wcmVzc2lvblwiOlxuICAgICAgICAgICAgICAgICAgICBmLl9fcHJvdGVjdGVkX18ubG9nQ3VzdG9tRm9ybUltcHJlc3Npb24oZS5wYXJhbXMudHJhY2tpbmdJZCwgZS5wYXJhbXMudHJhY2tpbmdJZCwgRSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJjZkZvcm1TdWJtaXNzaW9uXCI6XG4gICAgICAgICAgICAgICAgICAgIGYuX19wcm90ZWN0ZWRfXy5sb2dDdXN0b21Gb3JtU3VibWlzc2lvbihlLnBhcmFtcy50cmFja2luZ0lkLCBlLnBhcmFtcy50cmFja2luZ0lkLCBFKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcImNoYW5nZVNjcmVlblwiOlxuICAgICAgICAgICAgICAgICAgICB0ZShlLnBhcmFtcy5wYXJhbXMuc2NyZWVuLCAhMCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJsb2dpbkZhaWxlZFwiOlxuICAgICAgICAgICAgICAgIGNhc2UgXCJyZWdpc3RyYXRpb25GYWlsZWRcIjpcbiAgICAgICAgICAgICAgICBjYXNlIFwicmVnaXN0cmF0aW9uU3VjY2Vzc1wiOlxuICAgICAgICAgICAgICAgIGNhc2UgXCJjdXN0b21FdmVudFwiOlxuICAgICAgICAgICAgICAgICAgICBpZShlLnBhcmFtcy5ldmVudCwgZS5wYXJhbXMucGFyYW1zLCAhMCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJlbWl0R0FFdmVudFwiOlxuICAgICAgICAgICAgICAgICAgICBnLmVtaXRFdmVudChlLnBhcmFtcy5wYXJhbXMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OiByZXR1cm4gdm9pZCB1LmRlYnVnKFwiUmVjZWl2ZWQgaW52YWxpZCBldmVudCB0eXBlOiBcIiArIGUucGFyYW1zLmV2ZW50KTtcbiAgICAgICAgICAgIH0gfSwgc2hvd0VtYWlsQ29uZmlybWF0aW9uOiBmdW5jdGlvbiAoZSkgeyBuID8gdS5sb2coXCJNb2RhbCB3aW5kb3cgYWxyZWFkeSBzaG93blwiKSA6IHEoKS50aGVuKChmdW5jdGlvbiAoKSB7IHZhciBuID0gT2JqZWN0LmFzc2lnbih7IHNjcmVlbjogXCJlbWFpbF9jb25maXJtYXRpb25cIiB9LCBPLCBlKTsgYWUoZSksIHNlKG4pLCBfZShuKTsgfSkpOyB9LCBjaGVja0FuZFNob3dFbWFpbElzTm90Q29uZmlybWVkOiBILCBjbG9zZU1vZGFsQ29udGFpbmVyOiBDZSwgZXhlY3V0ZVBvc3RNZXNzYWdlc0JhdGNoOiBmdW5jdGlvbiAoKSB7IGZvciAoOyBqLmxlbmd0aDspIHtcbiAgICAgICAgICAgICAgICB2YXIgZSA9IGoucG9wKCk7XG4gICAgICAgICAgICAgICAgXCJicm9hZGNhc3RcIiA9PT0gZS50eXBlID8gcC5icm9hZGNhc3QoZS5uYW1lLCBlLmRhdGEpIDogcC5zZW5kKGUubmFtZSwgZS5kYXRhKTtcbiAgICAgICAgICAgIH0gfSB9LCBfX3ByaXZhdGVfXzogeyBwcmVwYXJlQ29uZmlnOiBzZSwgZXh0ZW5kVXNlclRva2VuOiBmdW5jdGlvbiAoKSB7IHZhciBlID0gUGUoKTsgaWYgKGUpIHtcbiAgICAgICAgICAgICAgICB2YXIgbiA9IChuZXcgRGF0ZSkuZ2V0VGltZSgpLCB0ID0gdS5fX3Byb3RlY3RlZF9fLmdldENvb2tpZShJKSwgciA9IG4gLSBsKGUpLmxvZ2luX3RpbWVzdGFtcCA+IDg2NGU1O1xuICAgICAgICAgICAgICAgIHQgJiYgciAmJiBSZSghMSwgITApO1xuICAgICAgICAgICAgfSB9LCBzZXRSZXF1ZXN0VGltZW91dDogY2UgfSB9OyB9O1xuICAgIHBuLmNvbnRhaW5lci5yZWdpc3RlcihcInBpYW5vSWRcIiwgeyB1c2VWYWx1ZTogcWUoKSB9KSwgcG4ucGlhbm9JZCA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwicGlhbm9JZFwiKTtcbiAgICB2YXIgemUgPSBmdW5jdGlvbiAoKSB7IHZhciBlID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJ1dGlsXCIpLCBuID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJwaWFub0lkXCIpLCB0ID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJldmVudFV0aWxzXCIpLmNyZWF0ZUV2ZW50TWFuYWdlcihbXCJ1c2VyQ2hhbmdlZFwiLCBcIm9uSGlkZVwiXSksIHIgPSBlLmdldEFpZFNwZWNpZmllZE5hbWUoXCJfX3V0cFwiKSwgbyA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHBuLmV4dGVybmFsSldUIHx8IGkoKTsgfSwgaSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGUuZmluZENvb2tpZUJ5TmFtZShyKSB8fCBudWxsOyB9OyByZXR1cm4geyBuYW1lOiBcInBpYW5vSWRMaXRlXCIsIGlzdjogITEsIGlzQ29uZmlndXJlZDogZnVuY3Rpb24gKCkgeyByZXR1cm4gITAgPT09IHBuLnVzZVBpYW5vSWRMaXRlVXNlclByb3ZpZGVyIHx8IFwic3RyaW5nXCIgPT0gdHlwZW9mIHBuLnVzZVBpYW5vSWRMaXRlVXNlclByb3ZpZGVyICYmIFwidHJ1ZVwiID09PSBwbi51c2VQaWFub0lkTGl0ZVVzZXJQcm92aWRlcjsgfSwgaXNVc2VyVmFsaWQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuICEhbygpOyB9LCBnZXRUb2tlbjogbywgZ2V0TmFtZTogZnVuY3Rpb24gKCkgeyByZXR1cm4gXCJwaWFub19pZF9saXRlXCI7IH0sIG9uTG9naW5TdWNjZXNzOiBmdW5jdGlvbiAobikgeyBlLnNldEFjY2Vzc1Rva2VuTGlzdENvb2tpZSh7IHZhbHVlOiBuLnRva2VuX2xpc3QsIGNvb2tpZV9kb21haW46IG4uY29va2llX2RvbWFpbiB9LCBuLnVzZXJfdG9rZW4pOyB9LCByZWdpc3RlckNhbGxiYWNrOiBmdW5jdGlvbiAoZSwgbikgeyB0LmFkZEV2ZW50KGUpLCB0LnJlZ2lzdGVyQ2FsbGJhY2soZSwgbik7IH0sIGxvZ2luQnlUb2tlbjogZnVuY3Rpb24gKGUpIHsgbi5sb2dpbkJ5VG9rZW4oZSk7IH0sIGxvZ291dDogZnVuY3Rpb24gKG4pIHsgZS53YWl0Q2FsbChcInJlZnJlc2hVc2VyVG9rZW5cIiwgKGZ1bmN0aW9uICgpIHsgXCJmdW5jdGlvblwiID09IHR5cGVvZiBuICYmIG4oKTsgfSkpOyB9IH07IH0oKTtcbiAgICBwbi5jb250YWluZXIucmVnaXN0ZXIoXCJwaWFub0lkTGl0ZVwiLCB7IHVzZVZhbHVlOiB6ZSB9KSwgcG4ucGlhbm9JZExpdGUgPSBwbi5jb250YWluZXIucmVzb2x2ZShcInBpYW5vSWRMaXRlXCIpO1xuICAgIHZhciBIZSA9IGZ1bmN0aW9uIChlKSB7IHZvaWQgMCA9PT0gZSAmJiAoZSA9IHBuLmNvbnRhaW5lcik7IHZhciBuID0gZS5yZXNvbHZlKFwiYXBpXCIpLCB0ID0gZS5yZXNvbHZlKFwidXRpbFwiKSwgciA9IGUucmVzb2x2ZShcImphbnJhaW5cIiksIG8gPSBlLnJlc29sdmUoXCJ0aW55cGFzc0FjY291bnRzXCIpLCBpID0gZS5yZXNvbHZlKFwiY29uZGVVc2VyUHJvdmlkZXJcIiksIGEgPSBlLnJlc29sdmUoXCJnaWd5YVwiKSwgcyA9IGUucmVzb2x2ZShcInBpYW5vSWRcIiksIGMgPSBlLnJlc29sdmUoXCJwaWFub0lkTGl0ZVwiKSwgbCA9IGUucmVzb2x2ZShcImV2ZW50VXRpbHNcIikuY3JlYXRlRXZlbnRNYW5hZ2VyKFtdKSwgdSA9IHsgaXN2OiAhMSwgZ2V0TmFtZTogZnVuY3Rpb24gKCkgeyByZXR1cm4gXCJwdWJsaXNoZXJfdXNlcl9yZWZcIjsgfSwgZ2V0VG9rZW46IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHBuLnVzZXJSZWYgPyBwbi51c2VyUmVmLmNvbnN0cnVjdG9yID09PSBcIlwiLmNvbnN0cnVjdG9yID8gcG4udXNlclJlZiA6IHBuLnVzZXJSZWYuY29uc3RydWN0b3IgPT09IHt9LmNvbnN0cnVjdG9yID8gXCJ7am94fVwiICsgSlNPTi5zdHJpbmdpZnkocG4udXNlclJlZikgOiBwbi51c2VyUmVmIDogbnVsbDsgfSwgaXNVc2VyVmFsaWQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuICEhKHZvaWQgMCAhPT0gcG4udXNlclJlZiAmJiBwbi51c2VyUmVmICYmIHBuLnVzZXJSZWYubGVuZ3RoID4gMCk7IH0sIG9uTG9naW5TdWNjZXNzOiBmdW5jdGlvbiAoZSkgeyB0LnNldEFjY2Vzc1Rva2VuTGlzdENvb2tpZSh7IHZhbHVlOiBlLnRva2VuX2xpc3QsIGNvb2tpZV9kb21haW46IGUuY29va2llX2RvbWFpbiB9LCBlLnVzZXJfdG9rZW4pOyB9LCBsb2dvdXQ6IGZ1bmN0aW9uIChlKSB7IHQuc2V0QWNjZXNzVG9rZW5MaXN0Q29va2llKCksIGUgJiYgZSgpOyB9IH0sIGQgPSBmdW5jdGlvbiAoKSB7IHZhciBlID0gW3IsIG8sIGksIGEsIHMsIGNdLmZpbmQoKGZ1bmN0aW9uIChlKSB7IHJldHVybiBlLmlzQ29uZmlndXJlZCgpICYmICFlLmlzdjsgfSkpOyByZXR1cm4gZSB8fCB1OyB9OyByZXR1cm4geyBuYW1lOiBcInVzZXJcIiwgZ2V0UHJvdmlkZXI6IGQsIHByb3ZpZGVySW5pdDogZnVuY3Rpb24gKGUpIHsgdm9pZCAwICE9PSBlICYmIGUgfHwgKGUgPSBmdW5jdGlvbiAoKSB7IH0pOyB2YXIgbiA9IGQoKTsgXCJmdW5jdGlvblwiID09IHR5cGVvZiBuLnByZXBhcmUgPyBcInByZXBhcmVcIiBpbiBuICYmIG4ucHJlcGFyZSgpLnRoZW4oZSwgZSkgOiBlKCk7IH0sIHJlZnJlc2hBY2Nlc3NUb2tlbjogZnVuY3Rpb24gKGUsIHIpIHsgdm9pZCAwICE9PSByICYmIHIgfHwgKHIgPSBmdW5jdGlvbiAoKSB7IH0pOyB2YXIgbyA9ICExOyBpZiAodm9pZCAwICE9PSBlICYmIGUpXG4gICAgICAgICAgICBvID0gITA7XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdmFyIGkgPSB0Ll9fcHJvdGVjdGVkX18uZ2V0Q29va2llKFwiX190YWVcIik7XG4gICAgICAgICAgICBpZiAodm9pZCAwICE9PSBpICYmIGkpIHtcbiAgICAgICAgICAgICAgICB2YXIgYSA9IG5ldyBEYXRlKHBhcnNlSW50KGkpKTtcbiAgICAgICAgICAgICAgICAobmV3IERhdGUpLmdldFRpbWUoKSAtIGEuZ2V0VGltZSgpID4gODY0ZTUgJiYgKG8gPSAhMCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgbyA9ICEwO1xuICAgICAgICB9IG8gPyB0LndhaXRDYWxsKFwicmVmcmVzaFVzZXJUb2tlblwiLCAoZnVuY3Rpb24gKCkgeyB0LndhaXRDYWxsKFwib2ZmZXJDcmVhdGVcIiwgKGZ1bmN0aW9uICgpIHsgdC53YWl0Q2FsbChcImV4cGVyaWVuY2VFeGVjdXRlXCIsIChmdW5jdGlvbiAoKSB7IGlmIChkKCkuaXNVc2VyVmFsaWQoKSkge1xuICAgICAgICAgICAgdC5zdGFydENhbGwoXCJyZWZyZXNoQWNjZXNzVG9rZW5MaXN0XCIpO1xuICAgICAgICAgICAgdmFyIGUgPSB7IHVybDogdC5wcmVwYXJlVXJsUGFyYW1ldGVyKHdpbmRvdy5sb2NhdGlvbi5ocmVmKSB9O1xuICAgICAgICAgICAgbi5jYWxsQXBpKFwiL2FjY2Vzcy90b2tlbi9saXN0XCIsIGUsIChmdW5jdGlvbiAoZSkgeyB0LmRvbmVDYWxsKFwicmVmcmVzaEFjY2Vzc1Rva2VuTGlzdFwiKSwgdm9pZCAwICE9PSBlLmFjY2Vzc190b2tlbl9saXN0ID8gKHQuc2V0QWNjZXNzVG9rZW5MaXN0Q29va2llKGUuYWNjZXNzX3Rva2VuX2xpc3QpLCByICYmIHIoZS5hY2Nlc3NfdG9rZW5fbGlzdC52YWx1ZSkpIDogciAmJiByKG51bGwpOyB9KSwgdm9pZCAwLCB2b2lkIDAsICEwKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICByICYmIHIoXCJcIik7IH0pKTsgfSkpOyB9KSkgOiByKG51bGwpOyB9LCBzaG93TG9naW46IGZ1bmN0aW9uIChlKSB7IHZhciBuID0gZCgpLmdldE5hbWUoKTsgaWYgKFwidGlueXBhc3NfYWNjb3VudHNcIiA9PT0gbilcbiAgICAgICAgICAgIG8ubG9naW4oZSk7XG4gICAgICAgIGVsc2UgaWYgKFwicGlhbm9faWRcIiA9PT0gbikge1xuICAgICAgICAgICAgdmFyIHQgPSBlIHx8IHt9O1xuICAgICAgICAgICAgcy5zaG93KHQpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIFwicHVibGlzaGVyX3VzZXJfcmVmXCIgPT09IG4gJiYgbC5maXJlQ2FsbGJhY2tzKFwibG9naW5SZXF1aXJlZFwiLCB7fSwgdm9pZCAwLCAhMCk7IH0sIGlzVXNlclZhbGlkOiBmdW5jdGlvbiAoKSB7IHJldHVybiBkKCkuaXNVc2VyVmFsaWQoKTsgfSwgbG9nb3V0OiBmdW5jdGlvbiAoZSwgbikgeyBkKCkubG9nb3V0KGUsIG4pOyB9LCByZWdpc3RlckNhbGxiYWNrOiBmdW5jdGlvbiAoZSwgbikgeyBsLmFkZEV2ZW50KGUpLCBsLnJlZ2lzdGVyQ2FsbGJhY2soZSwgbik7IH0sIGdldFVzZXJJbmZvUGFyYW1zOiBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IGUudXNlclRva2VuOyBpZiAoIW4pIHtcbiAgICAgICAgICAgIHZhciByID0gZCgpLmdldFRva2VuKCk7XG4gICAgICAgICAgICBuID0gciAmJiByLmxlbmd0aCA+IDAgPyByIDogXCJcIjtcbiAgICAgICAgfSByZXR1cm4geyB1c2VyX3Rva2VuOiBuLCB1c2VyX2xhbmc6IHQuX19wcm90ZWN0ZWRfXy5nZXRDb29raWUoXCJMQU5HXCIpIHx8IFwiXCIsIGlzX3ByZXZpZXc6IGUucHJldmlldywgaXNfbm9uX2xvZ2dlZF91c2VyOiBlLnByZXZpZXdOb25Mb2dnZWRVc2VyIH07IH0gfTsgfTtcbiAgICBwbi5jb250YWluZXIucmVnaXN0ZXIoXCJ1c2VyXCIsIHsgdXNlVmFsdWU6IEhlKCkgfSksIHBuLnVzZXIgPSBwbi5jb250YWluZXIucmVzb2x2ZShcInVzZXJcIik7XG4gICAgdmFyIFdlID0gZnVuY3Rpb24gKCkgeyB2YXIgZSA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwianFVdGlsc1wiKSwgbiA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwidXRpbFwiKSwgdCA9IFwidmlld3BvcnQtZXhpdC1hY3RpdmF0ZWRcIiwgciA9IFwidmlld3BvcnQtZXhpdC1wcmVwYXJlZFwiLCBvID0gITEsIGkgPSAhMSwgYSA9IDAsIHMgPSAwLCBjID0gW1widG9wXCIsIFwicmlnaHRcIiwgXCJib3R0b21cIiwgXCJsZWZ0XCJdLCBsID0gITAsIHUgPSAhMSwgZCA9ICExLCBwID0gW10sIGYgPSB7IHRvcDogeyB2aXNpdGVkOiAhMSwgdmFsdWU6IDEgfSwgcmlnaHQ6IHsgdmlzaXRlZDogITEsIHZhbHVlOiAyIH0sIGJvdHRvbTogeyB2aXNpdGVkOiAhMSwgdmFsdWU6IDQgfSwgbGVmdDogeyB2aXNpdGVkOiAhMSwgdmFsdWU6IDggfSB9LCBtID0gMCwgZyA9IGZ1bmN0aW9uICgpIHsgaWYgKCF1KSB7XG4gICAgICAgIHUgPSAhMCwgbSA9IDA7XG4gICAgICAgIHZhciBuID0gLyg/OkZpcmVmb3h8U2FmYXJpKVtcXC9cXHNdKFxcZCtcXC5cXGQrKS8udGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSA/IGRvY3VtZW50LmJvZHkgOiBkb2N1bWVudDtcbiAgICAgICAgZS5vbihuLCBcIm1vdXNlbGVhdmVcIiwgKGZ1bmN0aW9uIChlKSB7IHJldHVybiB2KGUpOyB9KSksIGUub24oZG9jdW1lbnQsIFwibW91c2Vtb3ZlXCIsIChmdW5jdGlvbiAoZSkgeyByZXR1cm4gaChlKTsgfSkpO1xuICAgIH0gfTsgdmFyIHYgPSBmdW5jdGlvbiAodCkgeyB2YXIgciwgbywgbCwgdSwgZCwgcCwgZzsgKHIgPSBmdW5jdGlvbiAoZSkgeyByZXR1cm4gZS5jbGllbnRYID09PSBlLmNsaWVudFkgJiYgZS5jbGllbnRYIDwgMCAmJiBlLmNsaWVudFggPj0gLTE7IH0odCkgPyBcIlwiIDogKG8gPSB0LmNsaWVudFgsIGwgPSB0LmNsaWVudFksIHUgPSBlLndpblNpemUoKSwgZCA9IHUud2lkdGgsIHAgPSB1LmhlaWdodCwgZyA9IFwiXCIsIG8gPj0gZCAmJiAoZyA9IFwicmlnaHRcIiksIGwgPj0gcCAmJiAoZyA9IFwiYm90dG9tXCIpLCBvIDw9IDAgJiYgKGcgPSBcImxlZnRcIiksIGwgPD0gMCAmJiAoZyA9IFwidG9wXCIpLCBnKSkgfHwgKHIgPSBmdW5jdGlvbiAoKSB7IGlmICghaSlcbiAgICAgICAgcmV0dXJuIFwiXCI7IHZhciBuID0gZS53aW5TaXplKCksIHQgPSBuLndpZHRoLCByID0gbi5oZWlnaHQ7IHJldHVybiBjW2Z1bmN0aW9uIChlKSB7IGlmICgwID09PSBlLmxlbmd0aClcbiAgICAgICAgcmV0dXJuIC0xOyBmb3IgKHZhciBuID0gZVswXSwgdCA9IDAsIHIgPSAxOyByIDwgZS5sZW5ndGg7IHIrKylcbiAgICAgICAgZVtyXSA8IG4gJiYgKHQgPSByLCBuID0gZVtyXSk7IHJldHVybiB0OyB9KFtzLCB0IC0gYSwgciAtIHMsIGFdKV07IH0oKSwgciB8fCBuLmRlYnVnKFwidmlld3BvcnRFeGl0OiB0aGUgZGV0ZWN0IG9mIHRoZSBleGl0IHNpZGUgZmFpbGVkXCIpKSwgciAmJiBmdW5jdGlvbiAoZSkgeyAtMSAhPT0gYy5pbmRleE9mKGUpID8gZltlXS52aXNpdGVkIHx8IChmW2VdLnZpc2l0ZWQgPSAhMCwgbSArPSBmW2VdLnZhbHVlKSA6IG4uZGVidWcoXCJ2aWV3cG9ydEV4aXQ6IHRoZSBkZXRlY3Qgb2YgdGhlIGV4aXQgc2lkZSBmYWlsZWRcIik7IH0ociksIHcoXCJhbGxcIiksIFwidG9wXCIgPT09IHIgJiYgdyhcInRvcFwiKTsgfSwgaCA9IGZ1bmN0aW9uIChlKSB7IGkgPSAhMCwgcyA9IGUuY2xpZW50WSwgYSA9IGUuY2xpZW50WDsgfSwgdyA9IGZ1bmN0aW9uIChlKSB7IGlmIChsKSB7XG4gICAgICAgIGZvciAodmFyIHQsIHIgPSBbXSwgbyA9IFtdLCBpID0gMDsgaSA8IHAubGVuZ3RoOyBpKyspXG4gICAgICAgICAgICAoKHQgPSBwW2ldKS5kZXRlY3RFeGl0TW9kZSA9PT0gZSB8fCBcImJhY2tcIiA9PT0gZSAmJiB0LmRldGVjdEJhY2tCdXR0b25Gb3JNb2JpbGUpICYmIHQuY29uc3VtZUV2ZW50Rm4oKSA/IHIucHVzaCh0KSA6IG8ucHVzaCh0KTtcbiAgICAgICAgci5sZW5ndGggJiYgbi5kZWJ1ZyhcInZpZXdwb3J0RXhpdDogbGlzdGVuZXJzIHdhcyBydW4gZmlyZSB3aXRoIHR5cGU6IFwiLCBlKSwgcCA9IG87XG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCByLmxlbmd0aDsgaSsrKVxuICAgICAgICAgICAgKHQgPSByW2ldKS5jYWxsYmFjaygpO1xuICAgIH0gfTsgcmV0dXJuIHsgbmFtZTogXCJ2aWV3cG9ydEV4aXRcIiwgaW5pdGlhbGl6ZTogZywgaXNJbml0aWFsaXplZDogZnVuY3Rpb24gKCkgeyByZXR1cm4gdTsgfSwgYWRkTGlzdGVuZXI6IGZ1bmN0aW9uIChlLCBuLCBpKSB7IFwibW9iaWxlXCIgIT09IG4uY2xpZW50RGV2aWNlICYmIFwidGFibGV0XCIgIT09IG4uY2xpZW50RGV2aWNlIHx8ICFuLmRldGVjdEJhY2tCdXR0b25Gb3JNb2JpbGUgfHwgZnVuY3Rpb24gKCkgeyBpZiAoIWQpIHtcbiAgICAgICAgICAgIGQgPSAhMCwgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJwb3BzdGF0ZVwiLCAoZnVuY3Rpb24gKGUpIHsgbyAmJiBlLnN0YXRlICYmIGUuc3RhdGUucGlhbm9WaWV3cG9ydEV4aXRTdGF0ZSA9PT0gdCAmJiAobyA9ICExLCB3KFwiYmFja1wiKSk7IH0pKTtcbiAgICAgICAgICAgIHZhciBlID0gd2luZG93Lmhpc3Rvcnkuc3RhdGUgfHwge307XG4gICAgICAgICAgICBlICYmIGUucGlhbm9WaWV3cG9ydEV4aXRTdGF0ZSAhPT0gciAmJiAoZS5waWFub1ZpZXdwb3J0RXhpdFN0YXRlICE9PSB0ICYmIChlLnBpYW5vVmlld3BvcnRFeGl0U3RhdGUgPSB0LCB3aW5kb3cuaGlzdG9yeS5yZXBsYWNlU3RhdGUoZSwgZG9jdW1lbnQudGl0bGUpKSwgd2luZG93Lmhpc3RvcnkucHVzaFN0YXRlKHsgcGlhbm9WaWV3cG9ydEV4aXRTdGF0ZTogciB9LCBkb2N1bWVudC50aXRsZSkpLCBvID0gITA7XG4gICAgICAgIH0gfSgpLCBnKCksIFwiZnVuY3Rpb25cIiAhPSB0eXBlb2YgaSAmJiAoaSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuICEwOyB9KSwgcC5wdXNoKHsgY2FsbGJhY2s6IGUsIGRldGVjdEV4aXRNb2RlOiBuLmRldGVjdEV4aXRNb2RlLCBkZXRlY3RCYWNrQnV0dG9uRm9yTW9iaWxlOiBuLmRldGVjdEJhY2tCdXR0b25Gb3JNb2JpbGUsIGNvbnN1bWVFdmVudEZuOiBpIH0pOyB9LCByZXNldFN1bU9mQ29kZXNEaXJlY3Rpb25Ub0RlZmF1bHQ6IGZ1bmN0aW9uICgpIHsgbSA9IDA7IH0sIGdldFN1bU9mQ29kZXNEaXJlY3Rpb246IGZ1bmN0aW9uICgpIHsgcmV0dXJuIG07IH0sIHJlbW92ZUxpc3RlbmVyczogZnVuY3Rpb24gKCkgeyBwID0gW107IH0sIGVuYWJsZTogZnVuY3Rpb24gKCkgeyBsID0gITA7IH0sIGRpc2FibGU6IGZ1bmN0aW9uICgpIHsgbCA9ICExOyB9IH07IH0oKTtcbiAgICBwbi5jb250YWluZXIucmVnaXN0ZXIoXCJ2aWV3cG9ydEV4aXRcIiwgeyB1c2VWYWx1ZTogV2UgfSksIHBuLnZpZXdwb3J0RXhpdCA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwidmlld3BvcnRFeGl0XCIpO1xuICAgIHZhciBKZSA9IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSBwbi5jb250YWluZXIucmVzb2x2ZShcInBvc3RtZXNzYWdlXCIpLCBuID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJjb250YWluZXJVdGlsc1wiKSwgdCA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwidXNlclwiKSwgciA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwiYXBpXCIpOyBwbi5jb250YWluZXIucmVzb2x2ZShcInV0aWxcIik7IGZ1bmN0aW9uIG8oZSkgeyByZXR1cm4gYShlLCBcIi9jaGVja291dC90ZW1wbGF0ZS9zaG93XCIpOyB9IGZ1bmN0aW9uIGkoZSkgeyByZXR1cm4gZS5pbml0Q29udGV4dExvYWRQcm9taXNlID0gZnVuY3Rpb24gKGUsIG4pIHsgZS5jb250ZXh0TG9hZGluZ1Byb21pc2UgPSBzKGUsIG4pOyB9LCBhKGUsIFwiL2NoZWNrb3V0L3RlbXBsYXRlL2NhY2hlYWJsZVNob3dcIik7IH0gdmFyIGEgPSBmdW5jdGlvbiAoZSwgbikgeyB2YXIgdCA9IHBuLmdldEVuZHBvaW50Um9vdCghMCkgKyBuOyByZXR1cm4gZS5pZnJhbWVVcmwgPSB0LCBlLnBvc3RNZXNzYWdlVXJsID0gdCwgZS53aWRnZXQgPSBcInRlbXBsYXRlXCIsIHBuLm9mZmVyLmNyZWF0ZU9mZmVySWZyYW1lKGUpOyB9LCBzID0gZnVuY3Rpb24gKGUsIG4pIHsgdmFyIG8gPSB0LmdldFVzZXJJbmZvUGFyYW1zKGUpOyByZXR1cm4gby50cmFja2luZ19pZCA9IGUudHJhY2tpbmdJZCwgby50ZW1wbGF0ZUlkID0gZS50ZW1wbGF0ZUlkLCBvLnRlbXBsYXRlVmFyaWFudElkID0gZS50ZW1wbGF0ZVZhcmlhbnRJZCwgby5haWQgPSBwbi5haWQsIG8ucHJlbG9hZCA9IGUuaXNQcmVsb2FkLCBlLmFmZmlsaWF0ZVN0YXRlICYmIChvLmFmZmlsaWF0ZVN0YXRlID0gSlNPTi5zdHJpbmdpZnkoZS5hZmZpbGlhdGVTdGF0ZSkpLCBPYmplY3Qua2V5cyhuKS5mb3JFYWNoKChmdW5jdGlvbiAoZSkgeyBvW2VdID0gbltlXTsgfSkpLCBuZXcgUHJvbWlzZSgoZnVuY3Rpb24gKGUsIG4pIHsgci5jYWxsQXBpKFwiL2Fub24vdGVtcGxhdGUvbG9hZFRlbXBsYXRlQ29udGV4dFwiLCBvLCAoZnVuY3Rpb24gKHQpIHsgdmFyIHIgPSB0LmNvZGUsIG8gPSB0LnRlbXBsYXRlQ29udGV4dCwgaSA9IHQubWVzc2FnZTsgMCA9PT0gciA/IGUobykgOiBuKGkpOyB9KSwgdm9pZCAwLCB2b2lkIDAsICEwKTsgfSkpOyB9LCBjID0gZnVuY3Rpb24gKGUsIG4pIHsgdmFyIHQgPSB7fTsgcmV0dXJuIFtcImFpZFwiLCBcInRlbXBsYXRlSWRcIiwgXCJ0ZW1wbGF0ZVZhcmlhbnRJZFwiLCBcInByZXZpZXdUZW1wbGF0ZVZlcnNpb25cIiwgXCJwcmVsb2FkXCIsIFwicHJldmlld1wiLCBcInByZXZpZXdVbmNhY2hlZFwiLCBcImRlcGxveW1lbnRJdGVtSWRcIiwgXCJnYUNsaWVudElkXCIsIFwienVvcmFTZWxlY3RlZFJhdGVQbGFuSWRzXCIsIFwibmV3c2N5Y2xlU2VsZWN0ZWRJZHNcIiwgXCJhZGROZXdzbGV0dGVyQXNzZXRzXCIsIFwib2ZmZXJJZFwiLCBcImV4cGVyaWVuY2VJZFwiLCBcImlmcmFtZUlkXCIsIFwiZGlzcGxheU1vZGVcIiwgXCJkZWJ1Z1wiLCBcInBpYW5vSWRVcmxcIiwgXCJ3aWRnZXRcIiwgXCJ1cmxcIl0uZm9yRWFjaCgoZnVuY3Rpb24gKG4pIHsgZVtuXSAmJiAodFtuXSA9IGVbbl0pOyB9KSksIG4ucGFyYW0odCk7IH07IGZ1bmN0aW9uIGwoZSkgeyBwbi5nZXRDYWNoZWFibGVTaG93VGVtcGxhdGUoKSA/ICghZnVuY3Rpb24gKGUpIHsgZS5kZWZlcnJlZENvbnRleHRMb2FkaW5nID0gITAsIGUuYnVpbGRRdWVyeVN0cmluZ0ZuID0gYzsgfShlKSwgZS5jcmVhdGVJZnJhbWVGbiA9IGkpIDogZS5jcmVhdGVJZnJhbWVGbiA9IG87IH0gcmV0dXJuIHsgbmFtZTogXCJ0ZW1wbGF0ZVwiLCBzaG93OiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gZS5vZmZlcklkID0gbi5mYWtlT2ZmZXJJZCwgZS50cmFja1N0YXRzT25TaG93ID0gITAsIGwoZSksIHBuLm9mZmVyLnNob3coZSk7IH0sIGRlZmVycmVkU2hvdzogZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGUub2ZmZXJJZCA9IG4uZmFrZU9mZmVySWQsIGwoZSksIHBuLm9mZmVyLmRlZmVycmVkU2hvdyhlKTsgfSwgY2xvc2U6IGZ1bmN0aW9uICgpIHsgbi5jbG9zZU1vZGFsQ29udGFpbmVyKCk7IH0sIGNsb3NlSW5saW5lOiBmdW5jdGlvbiAoZSkgeyBuLl9fcHJvdGVjdGVkX18uY2xvc2VJbmxpbmVDb250YWluZXJzKGUpOyB9LCBjcmVhdGVUZW1wbGF0ZUlmcmFtZTogbywgc2hvd0JhY2tkcm9wOiBmdW5jdGlvbiAoKSB7IG4uc2hvd0JhY2tkcm9wKCk7IH0sIGhpZGVCYWNrZHJvcDogZnVuY3Rpb24gKCkgeyBuLmhpZGVCYWNrZHJvcCgpOyB9LCBjZW50ZXJCYWNrZHJvcDogZnVuY3Rpb24gKGUpIHsgbi5jZW50ZXJCYWNrZHJvcChlKTsgfSwgcmVnaXN0ZXJDYWxsYmFjazogZnVuY3Rpb24gKGUsIG4pIHsgfSwgcmVmcmVzaFVzZXI6IGZ1bmN0aW9uIChuKSB7IHQucmVmcmVzaEFjY2Vzc1Rva2VuKCEwLCAoZnVuY3Rpb24gKCkgeyBlLnNlbmQoXCJleHRlcm5hbExvZ2luU3VjY2Vzc1wiLCB7IHVzZXJfdG9rZW46IHQuZ2V0UHJvdmlkZXIoKS5nZXRUb2tlbigpIH0sIG4pOyB9KSk7IH0gfTsgfSgpO1xuICAgIHBuLmNvbnRhaW5lci5yZWdpc3RlcihcInRlbXBsYXRlXCIsIHsgdXNlVmFsdWU6IEplIH0pLCBwbi50ZW1wbGF0ZSA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwidGVtcGxhdGVcIik7XG4gICAgdmFyIEdlID0gZnVuY3Rpb24gKGUpIHsgdm9pZCAwID09PSBlICYmIChlID0gcG4uY29udGFpbmVyKTsgdmFyIG4sIHQsIHIgPSBlLnJlc29sdmUoXCJqcVV0aWxzXCIpLCBvID0gZS5yZXNvbHZlKFwidXRpbFwiKSwgaSA9IGUucmVzb2x2ZShcInBvc3RtZXNzYWdlXCIpLCBhID0gZS5yZXNvbHZlKFwidXNlclwiKSwgcyA9IGUucmVzb2x2ZShcImNvbnRhaW5lclV0aWxzXCIpLCBjID0gZS5yZXNvbHZlKFwiZXZlbnRVdGlsc1wiKSwgbCA9IGUucmVzb2x2ZShcInZpZXdwb3J0RXhpdFwiKSwgdSA9IGUucmVzb2x2ZShcImdhU2VydmljZVwiKSwgZCA9IGUucmVzb2x2ZShcInNoYTFcIiksIHAgPSBlLnJlc29sdmUoXCJsb2dnaW5nXCIpLCBmID0gZS5yZXNvbHZlKFwidGVtcGxhdGVcIiksIG0gPSB7fSwgZyA9IDAsIHYgPSBcImNsb3NlXCIsIGggPSBcIk9GRkVSXCIsIHcgPSAhMSwgeSA9ICExLCBiID0gITEsIGsgPSB7fSwgXyA9IG5ldyBNYXAsIEMgPSB7fSwgSSA9IFtcImhlX0lMXCIsIFwiYXJfRUdcIl0sIFMgPSBjLmNyZWF0ZUV2ZW50TWFuYWdlcihbXCJjb21wbGV0ZVwiLCBcImNhbmNlbFwiLCBcImNsb3NlXCIsIFwiZXJyb3JcIiwgXCJsb2dpblJlcXVpcmVkXCIsIFwibG9naW5TdWNjZXNzXCIsIFwibG9hZGVkXCIsIFwiY3VzdG9tRXZlbnRcIiwgXCJzdGFydENoZWNrb3V0XCIsIFwicmVzaXplXCIsIFwib25NZXRlckV4cGlyZWRcIiwgXCJvbk1ldGVyQWN0aXZlXCIsIFwib25BY2Nlc3NHcmFudGVkXCIsIFwib25TaG93T2ZmZXJcIiwgXCJwaWFub0lkRXZlbnRcIiwgXCJwYXJlbnRTaXplXCIsIFwicmVkZWVtQ3JlZGl0XCIsIFwib25TdGFydENyZWRpdFJlZGVtcHRpb25cIl0pOyBzLnNldElmcmFtZXNQb3BzdGF0ZUhhbmRsZXJzKCk7IHZhciB4ID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gcG4ub2ZmZXJCYXNlVXJsID8gcG4ub2ZmZXJCYXNlVXJsIDogcG4uZ2V0RW5kcG9pbnRSb290KCkgKyBcIi9jaGVja291dC9vZmZlci9zaG93XCI7IH07IGZ1bmN0aW9uIFAoZSwgbikgeyB2YXIgYyA9IHMuZ2V0SWZyYW1lKGUuc2VuZGVyKSwgZCA9ICEwOyBzd2l0Y2ggKGMgJiYgYy5jb25maWcgJiYgKGQgPSAhYy5jb25maWcucGFyZW50KSwgZS5ldmVudCkge1xuICAgICAgICBjYXNlIFwiaW5pdENvbnRleHRcIjpcbiAgICAgICAgICAgIGlmIChlLnBhcmFtcyAmJiBlLnBhcmFtcy5yZXN1bHRDYWxsYmFja0lkKSB7XG4gICAgICAgICAgICAgICAgdmFyIHAgPSB7IHJlc3VsdENhbGxiYWNrSWQ6IGUucGFyYW1zLnJlc3VsdENhbGxiYWNrSWQsIGFmZmlsaWF0ZVN0YXRlOiBjLmNvbmZpZy5hZmZpbGlhdGVTdGF0ZSB9O1xuICAgICAgICAgICAgICAgIGkuc2VuZChcInJlc3VsdENhbGxiYWNrXCIsIHAsIGUuc2VuZGVyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwic3RvcmVDdXN0b21WYXJpYWJsZXNcIjpcbiAgICAgICAgICAgIHRwLnNhdmVDdXN0b21WYXJpYWJsZXNUb0xvY2FsU3RvcmFnZSgzMDApO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJmdWxsUmVkaXJlY3RUaHJlZURTXCI6XG4gICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IGUucGFyYW1zLmJhbmtTZWN1cmVVcmw7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcInJlc2l6ZVwiOlxuICAgICAgICAgICAgaWYgKGUucGFyYW1zLmlmcmFtZUlkID09PSBlLnNlbmRlcikge1xuICAgICAgICAgICAgICAgIHZhciBmID0gdm9pZCAwID09PSBlLnBhcmFtcy53aWR0aCA/IHllKHllKHt9LCBlLnBhcmFtcyksIHsgd2lkdGg6IHIuZ2V0V2lkdGgoYy5jb250YWluZXIpIH0pIDogZS5wYXJhbXM7XG4gICAgICAgICAgICAgICAgcy5yZXNpemVJZnJhbWUoYywgZiksIFwibW9kYWxcIiA9PT0gYy5jb25maWcuZGlzcGxheU1vZGUgJiYgKFwiYm9pbGVycGxhdGVcIiA9PT0gZS5wYXJhbXMuY2xvc2VCdXR0b25UeXBlICYmIHMuaGlkZUNsb3NlQnV0dG9uKGMuY29udGFpbmVyKSwgcy5jZW50ZXJJdChjLmNvbnRhaW5lcikpLCBpLnNlbmQoXCJhZnRlclJlc2l6ZVwiLCB7fSwgYy5pZnJhbWVJZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBTLmZpcmVDYWxsYmFja3MoZS5ldmVudCwgZS5wYXJhbXMsIGUuc2VuZGVyLCBkKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwic3RhcnRDaGVja291dFwiOlxuICAgICAgICAgICAgaWYgKGUucGFyYW1zLndpZHRoID0gbnVsbCwgXCJpbmxpbmVcIiA9PT0gZS5kaXNwbGF5TW9kZSkge1xuICAgICAgICAgICAgICAgIGUucGFyYW1zLmNsb3NlT25Mb2dvdXQgPSAhMDtcbiAgICAgICAgICAgICAgICB2YXIgbSA9IHEoZS5wYXJhbXMsIGMuc3RhdFBhcmFtcyk7XG4gICAgICAgICAgICAgICAgbS5icm93c2VySWQgPSBjLmJyb3dzZXJJZCwgbS5pc09wZW5lZEZyb21JbmxpbmVDaGVja291dCA9ICEwLCBLKG0sIGUuc2VuZGVyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGUucGFyYW1zLmlmcmFtZUlkID09PSBlLnNlbmRlciAmJiBTLmZpcmVDYWxsYmFja3MoZS5ldmVudCwgZS5wYXJhbXMsIGUuc2VuZGVyLCBkKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwibG9hZGVkXCI6XG4gICAgICAgICAgICBpZiAoZS5wYXJhbXMuaWZyYW1lSWQgPT09IGUuc2VuZGVyKSB7XG4gICAgICAgICAgICAgICAgaWYgKGkuc2VuZChcInNldHVwQ3VzdG9tVmFyaWFibGVzXCIsIGtbZS5wYXJhbXMuaWZyYW1lSWRdLCBlLnBhcmFtcy5pZnJhbWVJZCksIGkuc2VuZChcInNldHVwRVZURmllbGRzXCIsIGMuY29uZmlnLmV4dGVybmFsVmVyaWZpY2F0aW9uRmllbGRzLCBlLnBhcmFtcy5pZnJhbWVJZCksIGMuY29uZmlnLmRlZmVycmVkQ29udGV4dExvYWRpbmcgJiYgVChjLCBlKSwgYy53YWl0RmluaXNoUHJvY2Vzc2VzKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdm9pZCBzLl9fcHJvdGVjdGVkX18uY2xvc2VBbmRSZW1vdmVJZnJhbWUoYyk7XG4gICAgICAgICAgICAgICAgXCJwaWFub0lkXCIgPT09IGEuZ2V0UHJvdmlkZXIoKS5uYW1lICYmIHBuLnBpYW5vSWQuX19wcm90ZWN0ZWRfXy5leGVjdXRlUG9zdE1lc3NhZ2VzQmF0Y2goKSwgXCJtb2RhbFwiID09PSBjLmNvbmZpZy5kaXNwbGF5TW9kZSAmJiAocy5yZXNpemVJZnJhbWUoYywgZS5wYXJhbXMpLCBjLmNvbmZpZy5pc1ByZWxvYWQgfHwgcy5jaGVja0JhY2tkcm9wQW5kQ29udGFpbmVyKGMsICEwKSksIFwicG9wdXBcIiA9PT0gYy5jb25maWcuZGlzcGxheU1vZGUgJiYgcy5yZXNpemVJZnJhbWUoYywgZS5wYXJhbXMpLCBjLmNvbmZpZy5pc1ByZWxvYWQgfHwgYy5jb25maWcudHJhY2tTdGF0c09uU2hvdyB8fCBCKGMpLCBWKGMpLCBTLmZpcmVDYWxsYmFja3MoZS5ldmVudCwgZS5wYXJhbXMsIGUuc2VuZGVyLCBkKSwgXCJpbmxpbmVcIiA9PT0gYy5jb25maWcuZGlzcGxheU1vZGUgJiYgKGMuY29udGFpbmVyUmVhZHkgPyBzLnJlc2l6ZUlmcmFtZShjLCBlLnBhcmFtcykgOiBzLm9wZXJhdGlvbldpdGhDb250YWluZXIoYy5pZnJhbWVQYXJhbXMuY29udGFpbmVyU2VsZWN0b3IsIChmdW5jdGlvbiAobikgeyB2YXIgdCA9IHIucXVlcnlFbChcIiN0ZW1wLWlubGluZS1cIiArIGMuaWZyYW1lSWQpOyB0ICYmIChuLmlubmVySFRNTCA9IHQuaW5uZXJIVE1MLCByLnJlbW92ZSh0KSksIGMuZWxlbWVudCA9IHIucXVlcnlFbChcImlmcmFtZVwiLCBuKSwgYy5jb250YWluZXJSZWFkeSA9ICEwLCBzLnJlc2l6ZUlmcmFtZShjLCBlLnBhcmFtcyk7IH0pKSksIFIoYy5jb25maWcpLCBvLmRvbmVDYWxsKFwib2ZmZXJDcmVhdGVcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImRvd25Gb3JNYWludGVuYW5jZVwiOlxuICAgICAgICAgICAgcy5yZXNpemVJZnJhbWUoYywgeyB3aWR0aDogMzAwLCBoZWlnaHQ6IDIwMCB9KSwgXCJtb2RhbFwiID09PSBjLmNvbmZpZy5kaXNwbGF5TW9kZSAmJiAoYy5jb25maWcuaXNQcmVsb2FkIHx8IHMuY2hlY2tCYWNrZHJvcEFuZENvbnRhaW5lcihjKSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcInJlbW92ZVF1ZXJ5UGFyYW1CeU5hbWVcIjpcbiAgICAgICAgICAgIGUgJiYgZS5wYXJhbXMgJiYgQXJyYXkuaXNBcnJheShlLnBhcmFtcy5wYXJhbXNUb1JlbW92ZSkgJiYgZS5wYXJhbXMucGFyYW1zVG9SZW1vdmUuZm9yRWFjaCgoZnVuY3Rpb24gKGUpIHsgby5yZW1vdmVRdWVyeVBhcmFtQnlOYW1lKGUpOyB9KSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcInB1cmdlXCI6XG4gICAgICAgICAgICBuIHx8IChlICYmIGUucGFyYW1zICYmIGUucGFyYW1zLmFscmVhZHlQdXJjaGFzZWQgJiYgKHYgPSBcImFscmVhZHlIYXNBY2Nlc3NcIiksIGUgJiYgZS5wYXJhbXMgJiYgZS5wYXJhbXMuY29tcGxldGVQYXltZW50ICYmICh2ID0gXCJjaGVja291dENvbXBsZXRlZFwiKSwgcy5wdXJnZUlmcmFtZShlLnNlbmRlciwgYy5jb25maWcucGFyZW50KSwgUihjLmNvbmZpZykpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJjbG9zZVwiOlxuICAgICAgICAgICAgbiB8fCAoZSAmJiBlLnBhcmFtcyAmJiBlLnBhcmFtcy5hbHJlYWR5UHVyY2hhc2VkICYmICh2ID0gXCJhbHJlYWR5SGFzQWNjZXNzXCIpLCBlICYmIGUucGFyYW1zICYmIGUucGFyYW1zLmNvbXBsZXRlUGF5bWVudCAmJiAodiA9IFwiY2hlY2tvdXRDb21wbGV0ZWRcIiksIG8uaGFzUXVlcnlQYXJhbUJ5TmFtZShcInZvdWNoZXJfY29kZVwiKSAmJiAodiA9IFwidm91Y2hlclJlZGVtcHRpb25Db21wbGV0ZWRcIiksIHMuY2xvc2VDb250YWluZXIoZS5zZW5kZXIsIGMuY29uZmlnLnBhcmVudCksIFIoYy5jb25maWcpKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiY2xvc2VBbmRSZWZyZXNoXCI6XG4gICAgICAgICAgICB2YXIgZyA9IGUucGFyYW1zO1xuICAgICAgICAgICAgZyA/IHdpbmRvdy5sb2NhdGlvbi5hc3NpZ24oZykgOiB3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcInNlbGVjdFRlcm1cIjpcbiAgICAgICAgICAgIHYgPSBlICYmIGUucGFyYW1zICYmIGUucGFyYW1zLmFscmVhZHlQdXJjaGFzZWQgPyBcImFscmVhZHlIYXNBY2Nlc3NcIiA6IFwiY2xvc2VcIjtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwic3VibWl0UGF5bWVudFwiOlxuICAgICAgICBjYXNlIFwiY2hlY2tvdXRTZWxlY3RUZXJtXCI6XG4gICAgICAgICAgICBTLmZpcmVDYWxsYmFja3MoZS5ldmVudCwgcShlLnBhcmFtcywgeyBvZmZlcklkOiBjLmlmcmFtZVBhcmFtcy5vZmZlcklkIH0pLCBlLnNlbmRlciwgZCk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImNvbXBsZXRlXCI6XG4gICAgICAgICAgICBpZiAodm9pZCAwICE9PSBlLnBhcmFtcy50b2tlbl9saXN0KSB7XG4gICAgICAgICAgICAgICAgdmFyIGggPSBlLnBhcmFtcy51c2VyX3Rva2VuO1xuICAgICAgICAgICAgICAgICFoICYmIGEuaXNVc2VyVmFsaWQoKSAmJiBcInBpYW5vSWRcIiA9PT0gYS5nZXRQcm92aWRlcigpLm5hbWUgJiYgKGggPSBhLmdldFByb3ZpZGVyKCkuZ2V0VG9rZW4oKSksIG8uc2V0QWNjZXNzVG9rZW5MaXN0Q29va2llKHsgdmFsdWU6IGUucGFyYW1zLnRva2VuX2xpc3QsIGNvb2tpZV9kb21haW46IGUucGFyYW1zLmNvb2tpZV9kb21haW4gfSwgaCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgeSA9IHEoZS5wYXJhbXMsIHsgb2ZmZXJJZDogYy5pZnJhbWVQYXJhbXMub2ZmZXJJZCB9KTtcbiAgICAgICAgICAgIFMuZmlyZUNhbGxiYWNrcyhlLmV2ZW50LCB5LCBlLnNlbmRlciwgZCksIHYgPSBcImNoZWNrb3V0Q29tcGxldGVkXCI7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImNoZWNrb3V0U3RhdGVDaGFuZ2VcIjpcbiAgICAgICAgY2FzZSBcImNoZWNrb3V0UGF5bWVudEVycm9yXCI6XG4gICAgICAgIGNhc2UgXCJhbHJlYWR5UHVyY2hhc2VkXCI6XG4gICAgICAgIGNhc2UgXCJzdGFydFRocmVlREJhbmtTZWN1cmVcIjpcbiAgICAgICAgY2FzZSBcImNhbmNlbFwiOlxuICAgICAgICBjYXNlIFwiZXJyb3JcIjpcbiAgICAgICAgY2FzZSBcImN1c3RvbUV2ZW50XCI6XG4gICAgICAgICAgICBTLmZpcmVDYWxsYmFja3MoZS5ldmVudCwgZS5wYXJhbXMsIGUuc2VuZGVyLCBkKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwibG9naW5SZXF1aXJlZFwiOlxuICAgICAgICAgICAgdyA9ICEwLCBTLmZpcmVDYWxsYmFja3MoZS5ldmVudCwgbmUoYywgZS5wYXJhbXMpLCBlLnNlbmRlciwgZCk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImxvZ291dFwiOlxuICAgICAgICAgICAgQShlLmV2ZW50LCBlLnBhcmFtcywgZS5zZW5kZXIsIGMuY29uZmlnLnBhcmVudCk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImxvZ2luU3VjY2Vzc1wiOlxuICAgICAgICAgICAgTShlLmV2ZW50LCBlLnBhcmFtcywgZS5zZW5kZXIsIGQpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJpbnB1dEZvY3VzXCI6XG4gICAgICAgICAgICB2YXIgYiA9IHIucXVlcnlFbChcIi50cC1tb2RhbFwiKTtcbiAgICAgICAgICAgIGIgJiYgKGIuc3R5bGUuekluZGV4ID0gcG4uekluZGV4ZXMubW9kYWwgKyAxICsgXCJcIiwgYi5zdHlsZS56SW5kZXggPSBwbi56SW5kZXhlcy5tb2RhbCArIFwiXCIpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJpbnB1dEJsdXJcIjpcbiAgICAgICAgICAgIHZhciBfID0gci5xdWVyeUVsKFwiLnRwLW1vZGFsXCIpO1xuICAgICAgICAgICAgXyAmJiAoXy5zdHlsZS56SW5kZXggPSBwbi56SW5kZXhlcy5tb2RhbCArIDEgKyBcIlwiLCBfLnN0eWxlLnpJbmRleCA9IHBuLnpJbmRleGVzLm1vZGFsICsgXCJcIik7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImdldExvY2F0aW9uXCI6XG4gICAgICAgICAgICBlLnBhcmFtcyAmJiBlLnBhcmFtcy5yZXN1bHRDYWxsYmFja0lkICYmIChlLnBhcmFtcy5yZXN1bHQgPSB3aW5kb3cubG9jYXRpb24uaHJlZiwgaS5zZW5kKFwicmVzdWx0Q2FsbGJhY2tcIiwgZS5wYXJhbXMsIGUuc2VuZGVyKSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcInNldExvY2F0aW9uSGFzaFwiOlxuICAgICAgICAgICAgZS5wYXJhbXMgJiYgZS5wYXJhbXMuaGFzaCAmJiAod2luZG93LmxvY2F0aW9uLmhhc2ggPSBlLnBhcmFtcy5oYXNoKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwibGFuZ0NoYW5nZWRXaXRoaW5PZmZlclwiOlxuICAgICAgICAgICAgcG4ucGlhbm9JZC5pc0NvbmZpZ3VyZWQoKSAmJiBwbi5waWFub0lkLnVwZGF0ZUxhbmcoZS5wYXJhbXMubGFuZyksIEkuaW5kZXhPZihlLnBhcmFtcy5sYW5nKSA+PSAwID8gcy50dXJuT25SVEwoYykgOiBzLnR1cm5PZmZSVEwoYyk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImxvZ2luU3RhcnRcIjpcbiAgICAgICAgICAgIGwuZGlzYWJsZSgpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJsb2dpbkVuZFwiOlxuICAgICAgICAgICAgbC5lbmFibGUoKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwicGlhbm9JZEV2ZW50XCI6XG4gICAgICAgICAgICBlLnBhcmFtcy5pZnJhbWVJZCA9PT0gZS5zZW5kZXIgJiYgKFwiY2xvc2VkXCIgPT09IGUucGFyYW1zLmV2ZW50ICYmIHMuY2xvc2VDb250YWluZXIoZS5zZW5kZXIpLCBwbi5waWFub0lkLl9fcHJvdGVjdGVkX18ub2ZmZXJNZXNzYWdlUmVjZWl2ZXIoZSkpLCBFKGUucGFyYW1zLCBlLnNlbmRlcik7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcInN3Z0NoZWNrb3V0U3RhcnRcIjogYnJlYWs7XG4gICAgICAgIGNhc2UgXCJzaGFyZWRBY2NvdW50c1N1Y2Nlc3NmdWxseUFkZGVkXCI6XG4gICAgICAgICAgICBpLmJyb2FkY2FzdChcInJlZnJlc2hNeUFjY291bnRcIiwgeyB1c2VyVG9rZW46IGEuZ2V0UHJvdmlkZXIoKS5nZXRUb2tlbigpIH0pO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJuZXdzbGV0dGVyU2lnbnVwSW1wcmVzc2lvblwiOlxuICAgICAgICBjYXNlIFwibmV3c2xldHRlclNpZ251cFN1Ym1pc3Npb25cIjpcbiAgICAgICAgICAgIHBuLnBpYW5vRXNwLl9fcHJvdGVjdGVkX18ub2ZmZXJNZXNzYWdlUmVjZWl2ZXIoZSksIFMuZmlyZUNhbGxiYWNrcyhlLmV2ZW50LCBlLnBhcmFtcywgZS5zZW5kZXIsIGQpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJwYXJlbnRTaXplXCI6XG4gICAgICAgICAgICB2YXIgQyA9IHIud2luU2l6ZSgpLCB4ID0geyB3aWR0aDogQy53aWR0aCwgaGVpZ2h0OiBDLmhlaWdodCB9O1xuICAgICAgICAgICAgaS5zZW5kKFwicGFyZW50U2l6ZVwiLCB4LCBlLnNlbmRlcik7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImdpZ3lhUGFzc3dvcmRsZXNzTG9naW5cIjpcbiAgICAgICAgICAgIGUucGFyYW1zLmlmcmFtZUlkID09PSBlLnNlbmRlciAmJiAodCA9IGUucGFyYW1zLmlmcmFtZUlkLCBwbi5naWd5YS5sb2dpbkJ5UGFzc3dvcmRsZXNzKGUucGFyYW1zKSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImVtaXRHQUV2ZW50XCI6IHJldHVybiB2b2lkICghbiAmJiB1LmVtaXRFdmVudChlLnBhcmFtcykpO1xuICAgICAgICBjYXNlIFwiZW1pdE1ldHJpY3NFdmVudFwiOlxuICAgICAgICAgICAgIW4gJiYgdS5lbWl0TWV0cmljc0V2ZW50KGUucGFyYW1zKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiYmFubmVySW5pdFwiOlxuICAgICAgICAgICAgYy5jb25maWcuc2luZ2xlQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQoXCJ0cC1iYW5uZXJcIik7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImJhbm5lckRlc3Ryb3lcIjpcbiAgICAgICAgICAgIGMuY29uZmlnLnNpbmdsZUNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKFwidHAtYmFubmVyXCIpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJyZWRlZW1DcmVkaXRcIjpcbiAgICAgICAgICAgIHZhciBQID0gUy5maXJlQ2FsbGJhY2tzKFwib25TdGFydENyZWRpdFJlZGVtcHRpb25cIiwgZS5wYXJhbXMsIGUuc2VuZGVyLCBkKTtcbiAgICAgICAgICAgIFAgJiYgUC50aGVuICYmIFAudGhlbigoZnVuY3Rpb24gKG4pIHsgaS5zZW5kKFwic3VjY2Vzc2Z1bGx5Q3JlZGl0UmVkZWVtXCIsIG4sIGUuc2VuZGVyKTsgfSksIChmdW5jdGlvbiAobikgeyBpLnNlbmQoXCJjcmVkaXRSZWRlZW1GYWlsZWRcIiwgbiwgZS5zZW5kZXIpOyB9KSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgZGVmYXVsdDogcmV0dXJuIHZvaWQgby5kZWJ1ZyhcIlJlY2VpdmVkIGludmFsaWQgZXZlbnQgdHlwZTogXCIgKyBlLmV2ZW50KTtcbiAgICB9IH0gdmFyIEUgPSBmdW5jdGlvbiAoZSwgbikgeyBcInN1Y2Nlc3NET0lcIiA9PT0gZS5ldmVudCAmJiAoZS5pZnJhbWVJZCAhPT0gbiAmJiBzLmNsb3NlQ29udGFpbmVyKGUuaWZyYW1lSWQpLCBpLnNlbmQoXCJhZnRlclN1Y2Nlc3NET0lcIiwgZS5wYXJhbXMsIG4pKTsgfSwgVCA9IGZ1bmN0aW9uIChlLCBuKSB7IGUuY29uZmlnLmNvbnRleHRMb2FkaW5nUHJvbWlzZS50aGVuKChmdW5jdGlvbiAodCkgeyB2YXIgciA9IHsgaWZyYW1lUGFyYW1zOiBlLmlmcmFtZVBhcmFtcywgdXNlckNvbnRleHQ6IHQgfTsgci5pZnJhbWVQYXJhbXMudXJsID0gby5wcmVwYXJlVXJsUGFyYW1ldGVyKHdpbmRvdy5sb2NhdGlvbi5ocmVmKSwgaS5zZW5kKFwidXNlckRhdGFDb250ZXh0TG9hZGVkXCIsIHIsIG4ucGFyYW1zLmlmcmFtZUlkKTsgfSkpOyB9LCBBID0gZnVuY3Rpb24gKGUsIG4sIHQsIHIsIG8pIHsgYS5sb2dvdXQoKGZ1bmN0aW9uICgpIHsgdmFyIGUgPSB7fTsgZS51c2VyUHJvdmlkZXIgPSBhLmdldFByb3ZpZGVyKCkuZ2V0TmFtZSgpLCBlLnVzZXJUb2tlbiA9IGEuZ2V0UHJvdmlkZXIoKS5nZXRUb2tlbigpICYmIGEuZ2V0UHJvdmlkZXIoKS5nZXRUb2tlbigpLmxlbmd0aCA+IDAgPyBhLmdldFByb3ZpZGVyKCkuZ2V0VG9rZW4oKSA6IFwiXCIsIGUubm9OZWVkU3RhcnRDaGVja291dCA9ICEwLCBlZShlKTsgfSksIGgpLCBuLmNsb3NlT25Mb2dvdXQgJiYgcy5jbG9zZU1vZGFsQ29udGFpbmVyKHQsIHIpOyB9LCBNID0gZnVuY3Rpb24gKGUsIG4sIHQsIHIpIHsgaWYgKG4uc291cmNlID0gaCwgYS5nZXRQcm92aWRlcigpLm9uTG9naW5TdWNjZXNzKG4pLCBTLmZpcmVDYWxsYmFja3MoXCJsb2dpblN1Y2Nlc3NcIiwgbiwgdCwgciksICFiKSB7XG4gICAgICAgIHZhciBvID0geyB1c2VyVG9rZW46IG4udXNlcl90b2tlbiwgdXNlcjogbi51c2VyLCByZWxvYWRBZnRlckxvZ2luOiAhMCB9O1xuICAgICAgICBlZShvLCB0KTtcbiAgICB9IH0sIE8gPSBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IGUuZGlzcGxheU1vZGUgfHwgXCJtb2RhbFwiOyByZXR1cm4gW2Uub2ZmZXJJZCwgbiwgZS5jb250YWluZXJTZWxlY3Rvcl0uam9pbihcInxcIik7IH0sIFIgPSBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IE8oZSk7IGRlbGV0ZSBtW25dOyB9LCBMID0gZnVuY3Rpb24gKGUpIHsgaWYgKHYgPSBcImNsb3NlXCIsIFEoZSksIHZvaWQgMCA9PT0gZS5kaXNwbGF5TW9kZSlcbiAgICAgICAgZS5kaXNwbGF5TW9kZSA9IFwibW9kYWxcIjtcbiAgICBlbHNlIGlmIChcIm1vZGFsXCIgIT09IGUuZGlzcGxheU1vZGUgJiYgXCJpbmxpbmVcIiAhPT0gZS5kaXNwbGF5TW9kZSAmJiBcInBvcHVwXCIgIT09IGUuZGlzcGxheU1vZGUpXG4gICAgICAgIHJldHVybiBvLmxvZyhcIkludmFsaWQgb2ZmZXIgZGlzcGxheU1vZGU7IG11c3QgYmUgb25lIG9mOiBtb2RhbCwgaW5saW5lLCBwb3B1cFwiKSwgdm9pZCBSKGUpOyBpZiAoXCJtb2RhbFwiID09PSBlLmRpc3BsYXlNb2RlICYmICFlLmlzUHJlbG9hZCAmJiBzLmhhc01vZGFsSWZyYW1lKCkpXG4gICAgICAgIHJldHVybiBvLmxvZyhcIk1vZGFsIG9mZmVyIGlzIGFscmVhZHkgc2hvd247IG11c3QgYmUgb25lIG1vZGFsIG9mZmVyIHBlciB0aW1lXCIpLCB2b2lkIFIoZSk7IGlmIChcIm1vZGFsXCIgIT09IGUuZGlzcGxheU1vZGUpIHtcbiAgICAgICAgdmFyIG4sIHQgPSByLnFhKGUuY29udGFpbmVyU2VsZWN0b3IpO1xuICAgICAgICBpZiAoIWUuaXNQcmVsb2FkKVxuICAgICAgICAgICAgaWYgKHQuZm9yRWFjaCgoZnVuY3Rpb24gKHQpIHsgdmFyIHIgPSBxKHt9LCBlKTsgci5zaW5nbGVDb250YWluZXIgPSB0LCBuID0gTihyKTsgfSkpLCBuKVxuICAgICAgICAgICAgICAgIHJldHVybiBuO1xuICAgICAgICB2YXIgaSA9IHRbdC5sZW5ndGggLSAxXTtcbiAgICAgICAgaSAmJiAoZS5zaW5nbGVDb250YWluZXIgPSBpKTtcbiAgICB9IHJldHVybiBOKGUpOyB9OyBmdW5jdGlvbiBOKGUsIGMpIHsgdmFyIGwgPSBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IHt9OyBlLnRlcm1JZHMgJiYgKGUudGVybUlkcyBpbnN0YW5jZW9mIEFycmF5IHx8IChlLnRlcm1JZHMgPSBbZS50ZXJtSWRzXSkpOyB2YXIgdCA9IGUuYWRkaXRpb25hbFBhcmFtTmFtZXMgPyBlLmFkZGl0aW9uYWxQYXJhbU5hbWVzIDogW107IFtcImRpc3BsYXlNb2RlXCIsIFwiY29udGFpbmVyU2VsZWN0b3JcIiwgXCJ0ZW1wbGF0ZUlkXCIsIFwidGVtcGxhdGVWYXJpYW50SWRcIiwgXCJvZmZlcklkXCIsIFwidGVybUlkXCIsIFwidGVybUlkc1wiLCBcInJpZFwiLCBcImFpZFwiLCBcImlzQ2hlY2tvdXRcIiwgXCJpc09wZW5lZEZyb21JbmxpbmVDaGVja291dFwiLCBcInB3X2lkXCIsIFwicGF5d2FsbElkXCIsIFwid2lkdGhcIiwgXCJwcmV2aWV3XCIsIFwicHJldmlld1VuY2FjaGVkXCIsIFwicHJldmlld1RlbXBsYXRlVHlwZVwiLCBcInByZXZpZXdUZW1wbGF0ZVZlcnNpb25cIiwgXCJ0b2tlblR5cGVcIiwgXCJqYW5yYWluQ2FwdHVyZVRva2VuXCIsIFwiY2xvc2VPbkxvZ291dFwiLCBcInZvdWNoZXJDb2RlXCIsIFwiaXNSZWRlbXB0aW9uXCIsIFwiYWxsb3dSZXR1cm5Ub1N0YXJ0U3RhdGVcIiwgXCJzdGFydEZyb21JbmxpbmVDaGVja291dFwiLCBcImZvcm1OYW1lQnlUZXJtSWRcIiwgXCJoaWRlQ29tcGxldGVkRmllbGRzXCIsIFwic3RhcnRGcm9tSW5saW5lQ2hlY2tvdXRcIiwgXCJyZWxvYWRBZnRlckxvZ2luXCIsIFwicHJldmVudFJlbG9hZEFmdGVyTG9naW5cIiwgXCJpc0F1dGhcIiwgXCJhdXRoU3RhcnRTY3JlZW5cIiwgXCJzaG93Q2xvc2VCdXR0b25cIiwgXCJjbG9zZUJ1dHRvblR5cGVcIiwgXCJjaGVja291dEZsb3dJZFwiLCBcIm9mZmVyU3RhdGVcIiwgXCJvaWRcIiwgXCJwcm9tb0NvZGVcIiwgXCJwcm9tb0NvZGVJZFwiLCBcInByb21vQ29kZVRlcm1JZFwiLCBcInJ1cmxfM2RzXCIsIFwidGhpcmRQYXJ0eVBhcmFtc1wiLCBcInRlcm1JZDNkc1wiLCBcInByb3ZpZGVySWRcIiwgXCJkZXBsb3ltZW50SXRlbUlkXCIsIFwic2hhcmVkQWNjb3VudENvZGVcIiwgXCJ0YXJnZXRlZFRlcm1JZFwiLCBcIndpZGdldFwiXS5jb25jYXQoW1widHJhY2tpbmdJZFwiLCBcImV4cGVyaWVuY2VJZFwiLCBcImFjdGl2ZU1ldGVyc1wiXSwgdCkuZm9yRWFjaCgoZnVuY3Rpb24gKHQpIHsgZVt0XSAmJiAoblt0XSA9IGVbdF0pLCBcInNob3dDbG9zZUJ1dHRvblwiID09PSB0ICYmICh2b2lkIDAgPT09IGVbdF0gPyBuW3RdID0gITAgOiBuW3RdID0gZVt0XSk7IH0pKTsgdmFyIHIgPSBkZWNvZGVVUklDb21wb25lbnQoby5nZXRRdWVyeVBhcmFtQnlOYW1lKFwiX3B0aWRcIikpOyByZXR1cm4gciAmJiAobi50cmFja2luZ0lkID0gciksIGUucHJldmlldyAmJiAobi5hY3RpdmVNZXRlcnMgPSBKU09OLnN0cmluZ2lmeShbeyBtZXRlck5hbWU6IFwicHJldmlldy1tZXRlclwiLCB2aWV3czogMTAsIHZpZXdzTGVmdDogNSwgbWF4Vmlld3M6IDIwLCB0b3RhbFZpZXdzOiAyMCB9XSkpLCBuOyB9KGUpOyBsLndpZGdldCB8fCAobC53aWRnZXQgPSBcIm9mZmVyXCIpOyB2YXIgZCA9IG8uZ2V0VGJjQ29va2llKCk7IGQgJiYgZC5sZW5ndGggPiAwICYmIChsLnRiYyA9IGQpLCBlLmRlZmVycmVkQ29udGV4dExvYWRpbmcgPyAobC5pZnJhbWVJZCA9IFUoZSksIGwudXJsID0gd2luZG93LmxvY2F0aW9uLm9yaWdpbikgOiAobC5pZnJhbWVJZCA9IFwib2ZmZXItXCIgKyBnKysgKyBcIi1cIiArIG8ucmFuZG9tU3RyaW5nKCksIGwudXJsID0gby5wcmVwYXJlVXJsUGFyYW1ldGVyKHdpbmRvdy5sb2NhdGlvbi5ocmVmKSk7IHZhciBmID0gci53aW5TaXplKCk7IGwucGFyZW50RHVhbFNjcmVlbkxlZnQgPSB2b2lkIDAgIT09IHdpbmRvdy5zY3JlZW5MZWZ0ID8gd2luZG93LnNjcmVlbkxlZnQgOiBzY3JlZW4ubGVmdCwgbC5wYXJlbnREdWFsU2NyZWVuVG9wID0gdm9pZCAwICE9PSB3aW5kb3cuc2NyZWVuVG9wID8gd2luZG93LnNjcmVlblRvcCA6IHNjcmVlbi50b3AsIGwucGFyZW50V2lkdGggPSBmLndpZHRoID8gZi53aWR0aCA6IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCA/IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCA6IHNjcmVlbi53aWR0aCwgbC5wYXJlbnRIZWlnaHQgPSBmLmhlaWdodCA/IGYuaGVpZ2h0IDogZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodCA/IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQgOiBzY3JlZW4uaGVpZ2h0LCBsLnBhcmVudE91dGVySGVpZ2h0ID0gd2luZG93Lm91dGVySGVpZ2h0LCBlLnByZXZpZXdOb25Mb2dnZWRVc2VyICYmIChsLnByZXZpZXdOb25Mb2dnZWRVc2VyID0gZS5wcmV2aWV3Tm9uTG9nZ2VkVXNlciksIGUuaXNQcmVsb2FkICYmIChsLnByZWxvYWQgPSAxKSwgcG4ubG9jYWxlICYmIChsLmxhbmcgPSBwbi5sb2NhbGUpLCB1LmdldENsaWVudElkKCkgJiYgKGwuZ2FDbGllbnRJZCA9IHUuZ2V0Q2xpZW50SWQoKSksIHUuZ2V0R0FBY2NvdW50KCkgJiYgKGwuZ2FBY2NvdW50ID0gdS5nZXRHQUFjY291bnQoKSksIGZ1bmN0aW9uIChlKSB7IFtcImRlYnVnXCIsIFwiYWlkXCIsIFwiZ2FDbGllbnRJZFwiLCBcInRhZ3NcIiwgXCJjb250ZW50U2VjdGlvblwiLCBcImNvbnRlbnRBdXRob3JcIiwgXCJkZWJ1Z1wiLCBcInpvbmVcIl0uZm9yRWFjaCgoZnVuY3Rpb24gKG4pIHsgcG5bbl0gJiYgKGVbbl0gPSBwbltuXSk7IH0pKSwgcG4uY3VzdG9tVmFyaWFibGVzICYmIChrW2UuaWZyYW1lSWRdID0gSlNPTi5zdHJpbmdpZnkocG4uY3VzdG9tVmFyaWFibGVzKSk7IHZhciBuID0gcG4uY29udGVudENyZWF0ZWQ7IG4gJiYgKGUuY29udGVudENyZWF0ZWQgPSBuKSwgcG4gJiYgcG4ubWFpbiAmJiAoZS5wYWdlVmlld0lkID0gcG4ubWFpbi5mZXRjaFBhZ2VWaWV3SWQoKSwgZS52aXNpdElkID0gcG4ubWFpbi5mZXRjaFZpc2l0SWQoKSk7IH0obCk7IHZhciBtID0gUy5oYXNDYWxsYmFjayhcImxvZ2luUmVxdWlyZWRcIik7IGlmICghcG4uamFucmFpbi5pc0NvbmZpZ3VyZWQoKSB8fCB2b2lkIDAgIT09IGUubG9naW5SZXF1aXJlZCAmJiBlLmxvZ2luUmVxdWlyZWQpXG4gICAgICAgIGlmICghcG4uZ2lneWEuaXNDb25maWd1cmVkKCkgfHwgdm9pZCAwICE9PSBlLmxvZ2luUmVxdWlyZWQgJiYgZS5sb2dpblJlcXVpcmVkKVxuICAgICAgICAgICAgaWYgKHBuLnBpYW5vSWQuaXNDb25maWd1cmVkKCkpIHtcbiAgICAgICAgICAgICAgICB2b2lkIDAgIT09IGUubG9naW5SZXF1aXJlZCAmJiBlLmxvZ2luUmVxdWlyZWQgfHwgKGUubG9naW5SZXF1aXJlZCA9IGZ1bmN0aW9uIChlKSB7IGlmICghZS5wcmV2ZW50RXh0ZXJuYWxMb2dpbilcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG4gPSBlLnRlcm1JZCwgdCA9IGwuaWZyYW1lSWQsIHBuLnBpYW5vSWQuc2hvdyh7IHNjcmVlbjogZS5zdGFydFNjcmVlbiB9KSwgITE7IH0pLCBXKCksIGwucGlhbm9JZFVybCA9IHBuLnBpYW5vSWQuZ2V0SWZyYW1lVXJsKCk7XG4gICAgICAgICAgICAgICAgdmFyIGggPSBwbi5waWFub0lkLmdldExhbmcoKTtcbiAgICAgICAgICAgICAgICBoICYmIChsLmxhbmcgPSBoKSwgcG4ucGlhbm9JZC5vbkxhbmdDaGFuZ2UoKGZ1bmN0aW9uIChlKSB7IGkuc2VuZChcImxhbmdDaGFuZ2VkXCIsIHsgbGFuZzogZSB9LCBsLmlmcmFtZUlkKTsgfSksIGwuaWZyYW1lSWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIHBuLnBpYW5vSWRMaXRlLmlzQ29uZmlndXJlZCgpICYmIChsLnBpYW5vSWRVcmwgPSBwbi5waWFub0lkLmdldElmcmFtZVVybCgpKTtcbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBiID0gW107XG4gICAgICAgICAgICBwbi5naWd5YS5yZWdpc3RlckNhbGxiYWNrKFwib25IaWRlXCIsIChmdW5jdGlvbiAoZSkgeyBzLmFjdGl2YXRlQ29udGFpbmVycyhiKSwgaS5zZW5kKFwiZ2lneWFIaWRlXCIsIGUsIHQpOyB9KSksIHooKSwgZS5sb2dpblJlcXVpcmVkID0gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIHkgPSBlLmFsbG93UmV0dXJuVG9TdGFydFN0YXRlLCB3ID0gITEsIGIgPSBzLmhpZGVNb2RhbENvbnRhaW5lcigpLCBuID0gZS50ZXJtSWQsIHQgPSBsLmlmcmFtZUlkLCBvLndhaXRDYWxsKFwicmVmcmVzaFVzZXJUb2tlblwiLCAoZnVuY3Rpb24gKCkgeyBwbi5naWd5YS5sb2dpbigpOyB9KSksICExOyB9O1xuICAgICAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHZhciBiID0gW107XG4gICAgICAgIHBuLmphbnJhaW4uYWRkRXZlbnRIYW5kbGVyKFwib25Nb2RhbENsb3NlXCIsIChmdW5jdGlvbiAoKSB7IHMuYWN0aXZhdGVDb250YWluZXJzKGIpOyB9KSksIEgoKSwgZS5sb2dpblJlcXVpcmVkID0gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGIgPSBzLmhpZGVNb2RhbENvbnRhaW5lcigpLCB5ID0gZS5hbGxvd1JldHVyblRvU3RhcnRTdGF0ZSwgdyA9ICExLCBuID0gZS50ZXJtSWQsIHQgPSBsLmlmcmFtZUlkLCBvLndhaXRDYWxsKFwicmVmcmVzaFVzZXJUb2tlblwiLCAoZnVuY3Rpb24gKCkgeyBwbi5qYW5yYWluLmxvZ2luKHZvaWQgMCwgZSk7IH0pKSwgITE7IH07XG4gICAgfSBsLnVzZXJQcm92aWRlciA9IGEuZ2V0UHJvdmlkZXIoKS5nZXROYW1lKCksIGUudXNlclRva2VuID8gbC51c2VyVG9rZW4gPSBlLnVzZXJUb2tlbiA6IGwudXNlclRva2VuID0gYS5nZXRQcm92aWRlcigpLmdldFRva2VuKCkgJiYgYS5nZXRQcm92aWRlcigpLmdldFRva2VuKCkubGVuZ3RoID4gMCA/IGEuZ2V0UHJvdmlkZXIoKS5nZXRUb2tlbigpIDogXCJcIiwgby5nZXRDYW1wYWlnbnMobCksIGwuY3VzdG9tQ29va2llcyA9IEpTT04uc3RyaW5naWZ5KG8uZ2V0Q3VzdG9tQ29va2llcygpKSwgUy5yZWdpc3RlckNhbGxiYWNrKGUsIGwuaWZyYW1lSWQpLCBsLmhhc0xvZ2luUmVxdWlyZWRDYWxsYmFjayA9IFMuaGFzSWZyYW1lQ2FsbGJhY2soXCJsb2dpblJlcXVpcmVkXCIsIGwuaWZyYW1lSWQpIHx8IG0sIGwuaW5pdE1vZGUgPSBcImNvbnRleHRcIiwgaihsKTsgdmFyIF8gPSBlLmlmcmFtZVVybCA/IGUuaWZyYW1lVXJsIDogbC5pc0NoZWNrb3V0ID8gcG4uZ2V0RW5kcG9pbnRSb290KCEwKSArIFwiL2NoZWNrb3V0L29mZmVyL3Nob3dcIiA6IHgoKSwgSSA9IGUucG9zdE1lc3NhZ2VVcmwgPyBlLnBvc3RNZXNzYWdlVXJsIDogeCgpOyBlLmRlZmVycmVkQ29udGV4dExvYWRpbmcgJiYgZS5pbml0Q29udGV4dExvYWRQcm9taXNlKGUsIEQobCkpOyB2YXIgRSA9IEYobCwgZSksIFQgPSBzLmNyZWF0ZUNvbnRhaW5lcih7IHVybDogXywgY29uZmlnOiBlLCBwYXJlbnQ6IGUucGFyZW50LCBwb3N0TWVzc2FnZVVybDogSSwgcmVjZWl2ZTogUCwgaWZyYW1lUGFyYW1zOiBsLCBzaW5nbGVDb250YWluZXI6IGUuc2luZ2xlQ29udGFpbmVyLCBjbG9zZTogZnVuY3Rpb24gKCkgeyBTLmZpcmVDYWxsYmFja3MoXCJjbG9zZVwiLCB7IHN0YXRlOiB2IH0sIGwuaWZyYW1lSWQsICEwKTsgfSB9KSwgQSA9IF8uaW5kZXhPZihcIi9vZmZlci9cIikgPyBcIm9mZmVyU2hvd1wiIDogXCJ0ZW1wbGF0ZVNob3dcIjsgcmV0dXJuIHAuc2V0VGltZShBKSwgQyA9IF8uaW5kZXhPZihcIi90ZW1wbGF0ZS9cIikgJiYgbC5vZmZlcklkID09PSBzLmZha2VPZmZlcklkID8gbCA6IEMsIFQuc3RhdFBhcmFtcyA9IEUsIFQuYnJvd3NlcklkID0gZS5icm93c2VySWQsIFQ7IH0gdmFyIFUgPSBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IDAsIHQgPSBcIm9mZmVyX1wiICsgZC5oYXNoKGUuaWZyYW1lVXJsICsgXCI/XCIgKyBlLmJ1aWxkUXVlcnlTdHJpbmdGbihlLCByKSwgMjApOyByZXR1cm4gXy5oYXModCkgJiYgKG4gPSBfLmdldCh0KSArIDEpLCBfLnNldCh0LCBuKSwgdCArIFwiLVwiICsgbjsgfSwgaiA9IGZ1bmN0aW9uIChlKSB7IHZhciBuID0gby5nZXRRdWVyeVBhcmFtQnlOYW1lKFwidGVybUlkXCIpLCB0ID0gby5nZXRRdWVyeVBhcmFtQnlOYW1lKFwicGF5U291cmNlXCIpOyBuICYmIChlLnRlcm1JZCA9IG4pLCB0ICYmIChlLnBheVNvdXJjZSA9IHQpOyB9LCBEID0gZnVuY3Rpb24gKGUpIHsgdmFyIG4gPSB7fTsgcmV0dXJuIFtcInRiY1wiLCBcInRyYWNraW5nSWRcIiwgXCJwYWdlVmlld0lkXCIsIFwidmlzaXRJZFwiLCBcInRhZ3NcIiwgXCJjb250ZW50Q3JlYXRlZFwiLCBcImNvbnRlbnRTZWN0aW9uXCIsIFwiY29udGVudEF1dGhvclwiXS5mb3JFYWNoKChmdW5jdGlvbiAodCkgeyBlW3RdICYmIChuW3RdID0gZVt0XSk7IH0pKSwgT2JqZWN0LmtleXMoZSkuZm9yRWFjaCgoZnVuY3Rpb24gKHQpIHsgMCA9PT0gdC5pbmRleE9mKFwidHBjY19cIikgJiYgKG5bdF0gPSBlW3RdKTsgfSkpLCBuOyB9LCBGID0gZnVuY3Rpb24gKGUsIG4pIHsgdmFyIHQgPSB7fTsgcmV0dXJuIG4udHJhY2tTdGF0c09uU2hvdyB8fCBuLmRlZmVycmVkQ29udGV4dExvYWRpbmcgfHwgKHQgPSBEKGUpLCBPYmplY3Qua2V5cyh0KS5mb3JFYWNoKChmdW5jdGlvbiAobikgeyBkZWxldGUgZVtuXTsgfSkpKSwgdDsgfSwgQiA9IGZ1bmN0aW9uIChlKSB7IHZhciBuID0gcShlLmlmcmFtZVBhcmFtcywgZS5zdGF0UGFyYW1zKTsgZS5jb25maWcuYWZmaWxpYXRlU3RhdGUgJiYgKG4uYWZmaWxpYXRlU3RhdGUgPSBlLmNvbmZpZy5hZmZpbGlhdGVTdGF0ZSksIGkuc2VuZChcInRyYWNrU3RhdFwiLCBuLCBlLmlmcmFtZUlkKTsgfSwgViA9IGZ1bmN0aW9uIChlKSB7IHZhciBuID0geyBicm93c2VySWQ6IGUuYnJvd3NlcklkIH07IGkuc2VuZChcInBhc3NCcm93c2VySWRcIiwgbiwgZS5pZnJhbWVJZCk7IH0sIHEgPSBmdW5jdGlvbiAoZSwgbikgeyB2YXIgdCA9IHt9OyByZXR1cm4gT2JqZWN0LmtleXMoZSkuZm9yRWFjaCgoZnVuY3Rpb24gKG4pIHsgdFtuXSA9IGVbbl07IH0pKSwgT2JqZWN0LmtleXMobikuZm9yRWFjaCgoZnVuY3Rpb24gKGUpIHsgdFtlXSA9IG5bZV07IH0pKSwgdDsgfSwgeiA9IGZ1bmN0aW9uICgpIHsgYiB8fCAocG4uZ2lneWEucmVnaXN0ZXJDYWxsYmFjayhcInVzZXJDaGFuZ2VkXCIsIChmdW5jdGlvbiAoZSkgeyBpZiAoZSAmJiBlLnVzZXJfdG9rZW4pIHtcbiAgICAgICAgdmFyIHIgPSB7IHRva2VuX2xpc3Q6IGUuYWNjZXNzX3Rva2VuLnZhbHVlLCB1c2VyX3Rva2VuOiBlLnVzZXJfdG9rZW4sIHVzZXJUb2tlbjogZS51c2VyX3Rva2VuLCBjb29raWVfZG9tYWluOiBlLmFjY2Vzc190b2tlbi5jb29raWVfZG9tYWluLCB1c2VyOiBlLnVzZXIsIGFsbG93UmV0dXJuVG9TdGFydFN0YXRlOiB5LCB0ZXJtSWQ6IG4gfTtcbiAgICAgICAgaWYgKHQpXG4gICAgICAgICAgICBzLmdldElmcmFtZSh0KSA/IChpLnNlbmQoXCJleHRlcm5hbExvZ2luU3VjY2Vzc1wiLCByLCB0KSwgZGVsZXRlIHIudGVybUlkLCBlZShyLCB0KSkgOiBlZShyKTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgZWUocik7XG4gICAgfSB9KSksIHBuLmdpZ3lhLnJlZ2lzdGVyQ2FsbGJhY2soXCJsb2dvdXRcIiwgKGZ1bmN0aW9uICgpIHsgdmFyIGUsIHIgPSB7fTsgci51c2VyUHJvdmlkZXIgPSBhLmdldFByb3ZpZGVyKCkuZ2V0TmFtZSgpLCByLnVzZXJUb2tlbiA9IGEuZ2V0UHJvdmlkZXIoKS5nZXRUb2tlbigpICYmIGEuZ2V0UHJvdmlkZXIoKS5nZXRUb2tlbigpLmxlbmd0aCA+IDAgPyBhLmdldFByb3ZpZGVyKCkuZ2V0VG9rZW4oKSA6IFwiXCIsIHIubm9OZWVkU3RhcnRDaGVja291dCA9ICEwLCB0ICYmIChlID0gcy5nZXRJZnJhbWUodCkpLCBlICYmIFwiaW5saW5lXCIgPT09IGUuY29uZmlnLmRpc3BsYXlNb2RlICYmIHMuY2xvc2VNb2RhbENvbnRhaW5lcigpLCBuID0gXCJcIiwgdCA9IFwiXCIsIHkgPSAhMSwgZWUocik7IH0pKSwgYiA9ICEwKTsgfSwgSCA9IGZ1bmN0aW9uICgpIHsgYiB8fCAocG4uamFucmFpbi5yZWdpc3RlckNhbGxiYWNrKFwidXNlckNoYW5nZWRcIiwgKGZ1bmN0aW9uIChlKSB7IGlmIChlICYmIGUudXNlcl90b2tlbikge1xuICAgICAgICB2YXIgciA9IHsgdG9rZW5fbGlzdDogZS5hY2Nlc3NfdG9rZW4udmFsdWUsIHVzZXJfdG9rZW46IGUudXNlcl90b2tlbiwgdXNlclRva2VuOiBlLnVzZXJfdG9rZW4sIGNvb2tpZV9kb21haW46IGUuYWNjZXNzX3Rva2VuLmNvb2tpZV9kb21haW4sIHVzZXI6IGUudXNlciwgYWxsb3dSZXR1cm5Ub1N0YXJ0U3RhdGU6IHksIHRlcm1JZDogbiB9O1xuICAgICAgICBpZiAodClcbiAgICAgICAgICAgIHMuZ2V0SWZyYW1lKHQpID8gKGkuc2VuZChcImV4dGVybmFsTG9naW5TdWNjZXNzXCIsIHIsIHQpLCBkZWxldGUgci50ZXJtSWQsIGVlKHIsIHQpKSA6IGVlKHIpO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICBlZShyKTtcbiAgICB9IH0pKSwgcG4uamFucmFpbi5hZGRFdmVudEhhbmRsZXIoXCJvbkNhcHR1cmVTZXNzaW9uRW5kZWRcIiwgKGZ1bmN0aW9uICgpIHsgdmFyIGUsIHIgPSB7fTsgci51c2VyUHJvdmlkZXIgPSBhLmdldFByb3ZpZGVyKCkuZ2V0TmFtZSgpLCByLnVzZXJUb2tlbiA9IGEuZ2V0UHJvdmlkZXIoKS5nZXRUb2tlbigpICYmIGEuZ2V0UHJvdmlkZXIoKS5nZXRUb2tlbigpLmxlbmd0aCA+IDAgPyBhLmdldFByb3ZpZGVyKCkuZ2V0VG9rZW4oKSA6IFwiXCIsIHIubm9OZWVkU3RhcnRDaGVja291dCA9ICEwLCB0ICYmIChlID0gcy5nZXRJZnJhbWUodCkpLCBlICYmIFwiaW5saW5lXCIgPT09IGUuY29uZmlnLmRpc3BsYXlNb2RlICYmIHMuY2xvc2VNb2RhbENvbnRhaW5lcigpLCBuID0gXCJcIiwgdCA9IFwiXCIsIHkgPSAhMSwgZWUocik7IH0pKSwgYiA9ICEwKTsgfSwgVyA9IGZ1bmN0aW9uICgpIHsgYiB8fCAocG4ucGlhbm9JZC5zZXRDYWxsYmFja3MoeyBsb2dnZWRJbjogZnVuY3Rpb24gKGUpIHsgby5sb2coXCJvZmZlci5qcyAtIHBpYW5vIGlkIHVzZXIgbG9nZ2VkIGluXCIpOyB2YXIgciA9IHsgdXNlcl90b2tlbjogZS50b2tlbiwgdXNlclRva2VuOiBlLnRva2VuLCB1c2VyOiBlLnVzZXIsIHJlbG9hZEFmdGVyTG9naW46ICEwLCB0ZXJtSWQ6IG4gfTsgdCA/IHMuZ2V0SWZyYW1lKHQpID8gKGkuc2VuZChcImV4dGVybmFsTG9naW5TdWNjZXNzXCIsIHIsIHQpLCBaKHQsIHIpLCBkZWxldGUgci50ZXJtSWQsIGVlKHIsIHQpKSA6IGVlKHIpIDogZWUocik7IH0sIGxvZ2dlZE91dDogZnVuY3Rpb24gKGUpIHsgaWYgKGUuc291cmNlICE9PSBoKSB7XG4gICAgICAgICAgICB2YXIgciA9IHt9O1xuICAgICAgICAgICAgci51c2VyUHJvdmlkZXIgPSBhLmdldFByb3ZpZGVyKCkuZ2V0TmFtZSgpLCByLnVzZXJUb2tlbiA9IGEuZ2V0UHJvdmlkZXIoKS5nZXRUb2tlbigpICYmIGEuZ2V0UHJvdmlkZXIoKS5nZXRUb2tlbigpLmxlbmd0aCA+IDAgPyBhLmdldFByb3ZpZGVyKCkuZ2V0VG9rZW4oKSA6IFwiXCIsIHIubm9OZWVkU3RhcnRDaGVja291dCA9ICEwLCBlZShyKTtcbiAgICAgICAgfSBuID0gXCJcIiwgdCA9IFwiXCI7IH0gfSksIGIgPSAhMCk7IH07IGZ1bmN0aW9uIEooZSkgeyByZXR1cm4gcy5zaG93UHJlbG9hZGVkQ29udGFpbmVyKGUpOyB9IHZhciBHID0gZnVuY3Rpb24gKGUpIHsgdmFyIG4gPSBlLm9mZmVySWQgPT09IHMuZmFrZU9mZmVySWQgPyBcInNob3dUZW1wbGF0ZVwiIDogXCJzaG93T2ZmZXJcIjsgUy5oYXNDYWxsYmFjayhuKSAmJiBTLmZpcmVDYWxsYmFja3MobiwgZSwgdm9pZCAwLCAhMCk7IH0sIFEgPSBmdW5jdGlvbiAoZSkgeyBbeyBxdWVyeVBhcmFtOiBcInByb21vX2NvZGVcIiwgY29uZmlnUGFyYW06IFwicHJvbW9Db2RlXCIgfV0uZm9yRWFjaCgoZnVuY3Rpb24gKG4pIHsgdmFyIHQgPSBvLmdldFF1ZXJ5UGFyYW1CeU5hbWUobi5xdWVyeVBhcmFtKTsgdC5sZW5ndGggJiYgKGVbbi5jb25maWdQYXJhbV0gPSB0KTsgfSkpOyB9LCBYID0gZnVuY3Rpb24gKGUpIHsgaWYgKGUub2ZmZXJJZCB8fCAhMCA9PT0gZS5wcmV2aWV3KSB7XG4gICAgICAgIGlmIChmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IE8oZSk7IHJldHVybiAhIW1bbl07IH0oZSkpXG4gICAgICAgICAgICByZXR1cm4gITE7XG4gICAgICAgIGUucHJldmlldyB8fCBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IE8oZSk7IG1bbl0gPSAhMDsgfShlKSwgc2V0VGltZW91dCgoZnVuY3Rpb24gKCkgeyBSKGUpOyB9KSwgMWU0KSwgby53YWl0Q2FsbChcInJlZnJlc2hVc2VyVG9rZW5cIiwgKGZ1bmN0aW9uICgpIHsgby53YWl0Q2FsbChcInJlZnJlc2hBY2Nlc3NUb2tlbkxpc3RcIiwgKGZ1bmN0aW9uICgpIHsgby53YWl0Q2FsbChcIm15QWNjb3VudExvZ2luXCIsIChmdW5jdGlvbiAoKSB7IHZhciBuOyBpZiAoby5zdGFydENhbGwoXCJvZmZlckNyZWF0ZVwiKSwgZS5jcmVhdGVJZnJhbWVGbiA/IChRKGUpLCBuID0gZS5jcmVhdGVJZnJhbWVGbihlKSkgOiBuID0gTChlKSwgIW4pXG4gICAgICAgICAgICByZXR1cm4gby5kb25lQ2FsbChcIm9mZmVyQ3JlYXRlXCIpLCB2b2lkIG8uZXJyb3IoXCJDb3VsZCBub3QgaW5pdGlhbGl6ZSBvZmZlcjsgY2hlY2sgY29uZmlndXJhdGlvblwiKTsgJChlKSAmJiBZKG4uaWZyYW1lSWQpLCBHKGUpOyB9KSk7IH0pKTsgfSkpO1xuICAgIH1cbiAgICBlbHNlXG4gICAgICAgIG8uZXJyb3IoXCJNdXN0IHNwZWNpZnkgb2ZmZXJJZFwiKTsgfTsgdmFyICQgPSBmdW5jdGlvbiAoZSkgeyByZXR1cm4gISFlLmRpcmVjdENoZWNrb3V0ICYmIFwiaW5saW5lXCIgIT09IGUuZGlzcGxheU1vZGU7IH0sIFkgPSBmdW5jdGlvbiAoZSkgeyBvLndhaXRDYWxsKFwib2ZmZXJDcmVhdGVcIiwgKGZ1bmN0aW9uICgpIHsgaS5zZW5kKFwic3RhcnREaXJlY3RDaGVja291dFwiLCB7fSwgZSk7IH0pKTsgfSwgSyA9IGZ1bmN0aW9uIChlLCBuKSB7IGlmICghZnVuY3Rpb24gKGUpIHsgcmV0dXJuICFlLm9mZmVySWQgJiYgIWUuaXNSZWRlbXB0aW9uICYmICFlLnByZXZpZXc7IH0oZSkpIHtcbiAgICAgICAgdmFyIHQgPSBTLmhhc0NhbGxiYWNrKFwibG9naW5SZXF1aXJlZFwiKTtcbiAgICAgICAgZS5pc1NpdGVMaWNlbnNpbmcgJiYgdCAmJiAodGUoKSB8fCByZSgpKSA/IGYucmVmcmVzaFVzZXIoQy5pZnJhbWVJZCkgOiAocy5oYXNNb2RhbElmcmFtZSgpICYmIHMuY2xvc2VNb2RhbENvbnRhaW5lcigpLCBvLmRlYnVnKFwiY3JlYXRpbmcgY2hlY2tvdXQ6IFwiLCBlKSwgZS5kaXNwbGF5TW9kZSA9IFwicG9wdXBcIiA9PT0gZS5kaXNwbGF5TW9kZSA/IFwicG9wdXBcIiA6IFwibW9kYWxcIiwgZS5pc0NoZWNrb3V0ID0gITAsIGUucGFyZW50ID0gbiwgby53YWl0Q2FsbChcInJlZnJlc2hVc2VyVG9rZW5cIiwgKGZ1bmN0aW9uICgpIHsgby53YWl0Q2FsbChcInJlZnJlc2hBY2Nlc3NUb2tlbkxpc3RcIiwgKGZ1bmN0aW9uICgpIHsgdmFyIHQ7IG8uc3RhcnRDYWxsKFwib2ZmZXJDcmVhdGVcIiksIHQgPSBlLmNyZWF0ZUlmcmFtZUZuID8gZS5jcmVhdGVJZnJhbWVGbihlKSA6IEwoZSksIHMuX19wcm90ZWN0ZWRfXy5hZGRDaGlsZFRvSW5saW5lSWZyYW1lKHQsIG4pLCB0ID8gdyAmJiBvLndhaXRDYWxsKFwib2ZmZXJDcmVhdGVcIiwgKGZ1bmN0aW9uICgpIHsgdyA9ICExOyB2YXIgZSA9IHt9OyBlLnVzZXJQcm92aWRlciA9IGEuZ2V0UHJvdmlkZXIoKS5nZXROYW1lKCksIGEuZ2V0UHJvdmlkZXIoKS5nZXRUb2tlbigpICYmIGEuZ2V0UHJvdmlkZXIoKS5nZXRUb2tlbigpLmxlbmd0aCA+IDAgPyBlLnVzZXJUb2tlbiA9IGEuZ2V0UHJvdmlkZXIoKS5nZXRUb2tlbigpIDogZS51c2VyVG9rZW4gPSBcIlwiLCBlLm5vTmVlZFN0YXJ0Q2hlY2tvdXQgPSAhMCwgZS5ub05lZWRTdGFydENoZWNrb3V0QWZ0ZXJMb2dpbiA9ICEwLCBlZShlLCB0LmlmcmFtZUlkKTsgfSkpIDogKG8uZG9uZUNhbGwoXCJvZmZlckNyZWF0ZVwiKSwgby5lcnJvcihcIkNvdWxkIG5vdCBzdGFydCBjaGVja291dDsgY2hlY2sgY29uZmlndXJhdGlvblwiKSk7IH0pKTsgfSkpKTtcbiAgICB9IH0sIFogPSBmdW5jdGlvbiAoZSwgbikgeyBpLnNlbmQoXCJyZWxvYWRPZmZlclwiLCBuLCBlKTsgfSwgZWUgPSBmdW5jdGlvbiAoZSwgbikgeyBpLmJyb2FkY2FzdChcInJlbG9hZE9mZmVyXCIsIGUsIG4pOyB9LCBuZSA9IGZ1bmN0aW9uIChlLCBuKSB7IHZhciB0ID0geyByZWxvYWRBZnRlckxvZ2luOiAhMCB9OyByZXR1cm4gT2JqZWN0LmFzc2lnbih0LCBlLmNvbmZpZyksIHQuc2luZ2xlQ29udGFpbmVyICYmIGRlbGV0ZSB0LnNpbmdsZUNvbnRhaW5lciwgbi50ZXJtSWQgJiYgKHQudGVybUlkID0gbi50ZXJtSWQpLCBuLnRlcm0gJiYgKHQudGVybSA9IHt9LCB0LnRlcm0gPSBxKHQudGVybSwgbi50ZXJtKSksIG4uc3RhcnRTY3JlZW4gJiYgKHQuc3RhcnRTY3JlZW4gPSBuLnN0YXJ0U2NyZWVuKSwgbi5pc1JlZGVtcHRpb24gJiYgKHQuaXNSZWRlbXB0aW9uID0gbi5pc1JlZGVtcHRpb24sIHQudm91Y2hlckNvZGUgPSBuLnJlZGVtcHRpb24gJiYgbi5yZWRlbXB0aW9uLmZvcm0gJiYgbi5yZWRlbXB0aW9uLmZvcm0ucmVkZWVtQ29kZSwgdC50ZXJtSWQgPSBudWxsKSwgbiAmJiBuLmN1cnJlbnRTdGF0ZSAmJiBcIm1vZGFsXCIgPT09IGUuY29uZmlnLmRpc3BsYXlNb2RlICYmICh0LmFsbG93UmV0dXJuVG9TdGFydFN0YXRlID0gITApLCBuLnByZXZlbnRFeHRlcm5hbExvZ2luICYmICh0LnByZXZlbnRFeHRlcm5hbExvZ2luID0gbi5wcmV2ZW50RXh0ZXJuYWxMb2dpbiksIG4uc2hhcmVkQWNjb3VudENvZGUgJiYgKHQuc2hhcmVkQWNjb3VudENvZGUgPSBuLnNoYXJlZEFjY291bnRDb2RlKSwgbi5pc1NpdGVMaWNlbnNpbmcgJiYgKHQuaXNTaXRlTGljZW5zaW5nID0gbi5pc1NpdGVMaWNlbnNpbmcpLCBuLmNhbXBhaWduQ29kZSAmJiAodC5jYW1wYWlnbkNvZGUgPSBuLmNhbXBhaWduQ29kZSksIG4uY2FtcGFpZ25Hcm91cElkICYmICh0LmNhbXBhaWduR3JvdXBJZCA9IG4uY2FtcGFpZ25Hcm91cElkKSwgdC5kaXNwbGF5TW9kZSA9IFwibW9kYWxcIiwgdDsgfSwgdGUgPSBmdW5jdGlvbiAoKSB7IHJldHVybiBcInB1Ymxpc2hlcl91c2VyX3JlZlwiID09PSBhLmdldFByb3ZpZGVyKCkuZ2V0TmFtZSgpOyB9LCByZSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIFwicGlhbm9faWRfbGl0ZVwiID09PSBhLmdldFByb3ZpZGVyKCkuZ2V0TmFtZSgpOyB9OyByZXR1cm4geyBuYW1lOiBcIm9mZmVyXCIsIHNob3c6IGZ1bmN0aW9uIChlKSB7IFwiaW5saW5lXCIgPT09IGUuZGlzcGxheU1vZGUgPyBzLm9wZXJhdGlvbldpdGhDb250YWluZXIoZS5jb250YWluZXJTZWxlY3RvciwgKGZ1bmN0aW9uICgpIHsgWChlKTsgfSkpIDogWChlKTsgfSwgZGVmZXJyZWRTaG93OiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gZnVuY3Rpb24gKGUpIHsgdmFyIG4sIHQsIHIsIGkgPSBuZXcgUHJvbWlzZSgoZnVuY3Rpb24gKGUsIHIpIHsgbiA9IGUsIHQgPSByOyB9KSksIGEgPSBuZXcgUHJvbWlzZSgoZnVuY3Rpb24gKGUsIG4pIHsgciA9IGU7IH0pKTsgcmV0dXJuIFwicG9wdXBcIiAhPT0gZS5kaXNwbGF5TW9kZSAmJiBlLm9mZmVySWQgPyBvLndhaXRDYWxsKFwicmVmcmVzaEFjY2Vzc1Rva2VuTGlzdFwiLCAoZnVuY3Rpb24gKCkgeyB2YXIgaTsgZS5pc1ByZWxvYWQgPSAhMCwgby5zdGFydENhbGwoXCJvZmZlckNyZWF0ZVwiKSwgZS5jcmVhdGVJZnJhbWVGbiA/IChRKGUpLCBpID0gZS5jcmVhdGVJZnJhbWVGbihlKSkgOiBpID0gTChlKSwgaSA/IChpLmVsZW1lbnQub25sb2FkID0gZnVuY3Rpb24gKCkgeyByKGkpOyB9LCBuKGkpKSA6IChvLmRvbmVDYWxsKFwib2ZmZXJDcmVhdGVcIiksIG8uZXJyb3IoXCJDb3VsZCBub3QgaW5pdGlhbGl6ZSBvZmZlcjsgY2hlY2sgY29uZmlndXJhdGlvblwiKSwgdCgpKTsgfSkpIDogdCgpLCB7IHByb21pc2U6IGksIHNob3c6IGZ1bmN0aW9uICgpIHsgaS50aGVuKEopLnRoZW4oKGZ1bmN0aW9uICgpIHsgcmV0dXJuIGE7IH0pKS50aGVuKChmdW5jdGlvbiAobikgeyBCKG4pLCAkKGUpICYmIFkobi5pZnJhbWVJZCksIEcoZSk7IH0pLCAoZnVuY3Rpb24gKCkgeyBYKGUpLCBkZWxldGUgZS5pc1ByZWxvYWQ7IH0pKTsgfSB9OyB9KGUpOyB9LCBjbG9zZTogZnVuY3Rpb24gKCkgeyBzLmNsb3NlTW9kYWxDb250YWluZXIoKTsgfSwgY2xvc2VJbmxpbmU6IGZ1bmN0aW9uIChlKSB7IHMuX19wcm90ZWN0ZWRfXy5jbG9zZUlubGluZUNvbnRhaW5lcnMoZSk7IH0sIHN0YXJ0Q2hlY2tvdXQ6IEssIHN0YXJ0UmVkZWVtVm91Y2hlcjogZnVuY3Rpb24gKGUsIG4pIHsgcy5jbG9zZU1vZGFsQ29udGFpbmVyKCksIGUgfHwgKGUgPSB7fSksIGUuaXNSZWRlbXB0aW9uID0gITAsIG8uZGVidWcoXCJzdGFydGluZyByZWRlZW0gdm91Y2hlcjogXCIsIGUpLCBlLmRpc3BsYXlNb2RlID0gXCJwb3B1cFwiID09PSBlLmRpc3BsYXlNb2RlID8gXCJwb3B1cFwiIDogXCJtb2RhbFwiLCBlLmlzQ2hlY2tvdXQgPSAhMSwgZS5wYXJlbnQgPSBuLCBvLndhaXRDYWxsKFwicmVmcmVzaEFjY2Vzc1Rva2VuTGlzdFwiLCAoZnVuY3Rpb24gKCkgeyBvLnN0YXJ0Q2FsbChcIm9mZmVyQ3JlYXRlXCIpLCAoZS5jcmVhdGVJZnJhbWVGbiA/IGUuY3JlYXRlSWZyYW1lRm4oZSkgOiBMKGUpKSB8fCAoby5kb25lQ2FsbChcIm9mZmVyQ3JlYXRlXCIpLCBvLmVycm9yKFwiQ291bGQgbm90IHN0YXJ0IHJlZGVlbTsgY2hlY2sgY29uZmlndXJhdGlvblwiKSk7IH0pKTsgfSwgY3JlYXRlT2ZmZXJJZnJhbWU6IEwsIHNob3dCYWNrZHJvcDogZnVuY3Rpb24gKCkgeyBzLnNob3dCYWNrZHJvcCgpOyB9LCBoaWRlQmFja2Ryb3A6IGZ1bmN0aW9uICgpIHsgcy5oaWRlQmFja2Ryb3AoKTsgfSwgY2VudGVyQmFja2Ryb3A6IGZ1bmN0aW9uIChlKSB7IHMuY2VudGVyQmFja2Ryb3AoZSk7IH0sIHJlZ2lzdGVyQ2FsbGJhY2s6IGZ1bmN0aW9uIChlLCBuKSB7IFMuYWRkRXZlbnQoZSksIFMucmVnaXN0ZXJDYWxsYmFjayhlLCBuKTsgfSwgcmVsb2FkOiBaLCByZWxvYWRBbGw6IGZ1bmN0aW9uIChlLCBuKSB7IHZhciB0ID0gZSB8fCB7fTsgby53YWl0Q2FsbChcInJlZnJlc2hVc2VyVG9rZW5cIiwgKGZ1bmN0aW9uICgpIHsgZWUoT2JqZWN0LmFzc2lnbih0LCB7IHVzZXJUb2tlbjogcG4udXNlci5nZXRQcm92aWRlcigpLmdldFRva2VuKCkgfSksIG4pOyB9KSk7IH0sIHJlc2V0VXNlckFuZFJlbG9hZEFsbDogZnVuY3Rpb24gKGUsIG4pIHsgdmFyIHQgPSBlIHx8IHt9OyBlZShPYmplY3QuYXNzaWduKHQsIHsgdXNlclRva2VuOiBcIlwiIH0pLCBuKTsgfSwgY2hlY2tUaHJlZURTUmVkaXJlY3Q6IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSBcInBuX3J1cmxfM2RzXCIsIG4gPSBvLmdldFF1ZXJ5UGFyYW1CeU5hbWUoZSk7IGlmIChuKSB7XG4gICAgICAgICAgICB2YXIgdCA9IHsgb2ZmZXJJZDogXCJwbl9vZmZlcl9pZFwiLCBvaWQ6IFwicG5fb2lkXCIsIHRlcm1JZDNkczogXCJwbl90ZXJtX2lkXCIsIHByb3ZpZGVySWQ6IFwicG5fcHJvdmlkZXJfaWRcIiwgdGhpcmRQYXJ0eVBhcmFtczogXCJ0aGlyZF9wYXJ0eV9wYXJhbXNcIiB9LCByID0gW2VdLCBpID0gT2JqZWN0LmtleXModCkucmVkdWNlKChmdW5jdGlvbiAoZSwgbikgeyB2YXIgaSA9IE9iamVjdC5hc3NpZ24oe30sIGUpOyByZXR1cm4gaVtuXSA9IG8uZ2V0UXVlcnlQYXJhbUJ5TmFtZSh0W25dKSwgci5wdXNoKHRbbl0pLCBpOyB9KSwge30pO1xuICAgICAgICAgICAgby5yZW1vdmVRdWVyeVBhcmFtQnlOYW1lKHIpLCBYKE9iamVjdC5hc3NpZ24oeyBkaXNwbGF5TW9kZTogXCJtb2RhbFwiLCBydXJsXzNkczogbiB9LCBpKSk7XG4gICAgICAgIH0gfSB9OyB9O1xuICAgIHBuLmNvbnRhaW5lci5yZWdpc3RlcihcIm9mZmVyXCIsIHsgdXNlVmFsdWU6IEdlKCkgfSksIHBuLm9mZmVyID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJvZmZlclwiKTtcbiAgICB2YXIgUWUgPSBmdW5jdGlvbiAoKSB7IHZhciBlLCBuID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJqcVV0aWxzXCIpLCB0ID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJ1dGlsXCIpLCByID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJwb3N0bWVzc2FnZVwiKSwgbyA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwib2ZmZXJcIiksIGkgPSBwbi5jb250YWluZXIucmVzb2x2ZShcInVzZXJcIiksIGEgPSBwbi5jb250YWluZXIucmVzb2x2ZShcImNvbnRhaW5lclV0aWxzXCIpLCBzID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJwaWFub0lkXCIpLCBjID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJsb2dnaW5nXCIpLCBsID0ge30sIHUgPSAhMSwgZCA9IHsgbG9naW5SZXF1aXJlZDogW10sIGxvZ2luU3VjY2VzczogW10gfSwgcCA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHBuLmdldEVuZHBvaW50Um9vdCgpICsgXCIvY2hlY2tvdXQvbXlhY2NvdW50L3Nob3dcIjsgfSwgZiA9IGZ1bmN0aW9uIChlLCBuKSB7IGUuZWxlbWVudC5zdHlsZS5oZWlnaHQgPSAoZS5jb25maWcubWF4SGVpZ2h0ID8gTWF0aC5taW4obi5oZWlnaHQsIGUuY29uZmlnLm1heEhlaWdodCkgOiBuLmhlaWdodCkgKyBcInB4XCIsIGUuY29udGFpbmVyLnN0eWxlLmhlaWdodCA9IChlLmNvbmZpZy5tYXhIZWlnaHQgPyBNYXRoLm1pbihuLmhlaWdodCwgZS5jb25maWcubWF4SGVpZ2h0KSA6IG4uaGVpZ2h0KSArIFwicHhcIiwgZS5lbGVtZW50LnN0eWxlLndpZHRoID0gbi53aWR0aCArIFwicHhcIiwgXCJtb2RhbFwiID09PSBlLmNvbmZpZy5kaXNwbGF5TW9kZSAmJiAoZS5jb250YWluZXIuc3R5bGUud2lkdGggPSBuLndpZHRoICsgXCJweFwiKSwgci5zZW5kKFwicmVzaXplZFwiLCB7IGhlaWdodDogZS5jb25maWcubWF4SGVpZ2h0ID8gTWF0aC5taW4obi5oZWlnaHQsIGUuY29uZmlnLm1heEhlaWdodCkgOiBuLmhlaWdodCwgd2lkdGg6IG4ud2lkdGggfSwgZS5pZnJhbWVJZCk7IH0sIG0gPSBmdW5jdGlvbiAodCwgciwgaSkgeyByZXR1cm4gZnVuY3Rpb24gKCkgeyBlICYmIChuLnJlbW92ZUNsYXNzKFwidHAtYWN0aXZlXCIsIGUpLCBvLmhpZGVCYWNrZHJvcCgpLCB3aW5kb3cuc2V0VGltZW91dCgoZnVuY3Rpb24gKCkgeyBuLnJlbW92ZShlKTsgfSksIDI1MCksIHIucmVzdWx0ID0gaSwgdChyKSk7IH07IH0sIGcgPSBmdW5jdGlvbiAoZSkgeyB2YXIgdCA9IG4ud2luU2l6ZSgpOyBlLm9mZnNldEhlaWdodCA+IHQuaGVpZ2h0ID8gKCExID09PSB1ICYmIChlLnN0eWxlLnBvc2l0aW9uID0gXCJhYnNvbHV0ZVwiLCB1ID0gITApLCBlLnN0eWxlLm1hcmdpblRvcCA9IHdpbmRvdy5zY3JvbGxZIC0gLjUgKiB0LmhlaWdodCArIFwiXCIpIDogKCEwID09PSB1ICYmIChlLnN0eWxlLnBvc2l0aW9uID0gXCJmaXhlZFwiLCB1ID0gITEpLCBlLnN0eWxlLm1hcmdpblRvcCA9IDAgLSAuNSAqIGUub2Zmc2V0SGVpZ2h0ICsgXCJcIiksIG8uY2VudGVyQmFja2Ryb3AoZSksIGUuc3R5bGUubWFyZ2luTGVmdCA9IDAgLSAuNSAqIGUub2Zmc2V0V2lkdGggKyBcIlwiOyB9LCB2ID0gZnVuY3Rpb24gKHQsIGkpIHsgIWZ1bmN0aW9uICh0LCByKSB7IHZhciBpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTsgbi5hZGRDbGFzcyhcInRwLW1vZGFsXCIsIGkpOyB2YXIgYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7IG4uYWRkQ2xhc3MoXCJ0cC1jbG9zZVwiLCBhKTsgdmFyIHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpOyBuLmFkZENsYXNzKFwidHAtbWVzc2FnZVwiLCBzKSwgaS5zdHlsZS53aWR0aCA9ICh0LndpZHRoID8gdC53aWR0aCA6IDQwMCkgKyBcInB4XCIsIHMuaW5uZXJIVE1MID0gdC5tZXNzYWdlOyB2YXIgYyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7IG4uYWRkQ2xhc3MoXCJ0cC1idG4tY29udGFpbmVyXCIsIGMpOyB2YXIgbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIik7IG4uYWRkQ2xhc3MoXCJ0cC1idG5cIiwgbCksIG4uYWRkQ2xhc3MoXCJ0cC1vay1idG5cIiwgbCksIGwuaW5uZXJIVE1MID0gdC5vayA/IHQub2sgOiBcIk9rXCI7IHZhciB1ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTsgbi5hZGRDbGFzcyhcInRwLWJ0blwiLCB1KSwgbi5hZGRDbGFzcyhcInRwLWNhbmNlbC1idG5cIiwgdSksIHUuaW5uZXJIVE1MID0gdC5jYW5jZWwgPyB0LmNhbmNlbCA6IFwiQ2FuY2VsXCIsIG4ub24oYSwgXCJjbGlja1wiLCBtKHIsIHQsIFwiY2FuY2VsXCIpKSwgbi5vbih1LCBcImNsaWNrXCIsIG0ociwgdCwgXCJjYW5jZWxcIikpLCBuLm9uKGwsIFwiY2xpY2tcIiwgbShyLCB0LCBcIm9rXCIpKSwgbi5hcHBlbmQoaSwgYSksIG4uYXBwZW5kKGksIHMpLCBuLmFwcGVuZChjLCBsKSwgbi5hcHBlbmQoYywgdSksIG4uYXBwZW5kKGksIGMpLCBuLmFwcGVuZChkb2N1bWVudC5ib2R5LCBpKSwgby5zaG93QmFja2Ryb3AoKSwgbi5hZGRDbGFzcyhcInRwLWFjdGl2ZVwiLCBpKSwgZyhpKSwgZSA9IGk7IH0oaS5wYXJhbXMsIChmdW5jdGlvbiAoZSkgeyByLnNlbmQoXCJjbG9zZURpYWxvZ1wiLCBlLCBsW2kuc2VuZGVyXS5pZnJhbWVJZCk7IH0pKTsgfSwgaCA9IGZ1bmN0aW9uIChlLCBuKSB7IGRbZV0gPSBkW2VdIHx8IFtdLCBkW2VdLnB1c2gobik7IH0sIHcgPSBmdW5jdGlvbiAoZSwgbiwgbykgeyBpZiAodC5kZWJ1ZyhcInJlY2VpdmVkIGV2ZW50OiBcIiArIGUsIG4pLCB2b2lkIDAgIT09IGRbZV0pIHtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkW2VdLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICB0LmRlYnVnKFwiZmlyaW5nIGNhbGxiYWNrIGZvciBldmVudDogXCIgKyBlKTtcbiAgICAgICAgICAgIHZhciBhID0gZFtlXVtpXShuKTtcbiAgICAgICAgICAgIG4gJiYgbi5yZXN1bHRDYWxsYmFja0lkICYmIChuLnJlc3VsdCA9IGEsIG4uZXZlbnQgPSBlLCByLnNlbmQoXCJyZXN1bHRDYWxsYmFja1wiLCBuLCBvKSk7XG4gICAgICAgIH1cbiAgICAgICAgIWRbZV0ubGVuZ3RoICYmIG4gJiYgbi5yZXN1bHRDYWxsYmFja0lkICYmIChuLmNhbGxiYWNrTm90Rm91bmQgPSAhMCwgbi5ldmVudCA9IGUsIHIuc2VuZChcInJlc3VsdENhbGxiYWNrXCIsIG4sIG8pKTtcbiAgICB9IH0sIHkgPSBmdW5jdGlvbiAoZSkgeyBzd2l0Y2ggKHQubG9nKFwiKioqIE15IGFjY291bnQgZXZlbnQgcmVjZWl2ZWRcIiwgZS5ldmVudCwgZS5wYXJhbXMpLCBlLmV2ZW50KSB7XG4gICAgICAgIGNhc2UgXCJyZXNpemVcIjpcbiAgICAgICAgICAgIHQuZGVidWcoXCIqKiogUmVzaXplIGV2ZW50XCIsIGUucGFyYW1zLndpZHRoLCBlLnBhcmFtcy5oZWlnaHQpLCBmKGxbZS5zZW5kZXJdLCBlLnBhcmFtcyksIFwibW9kYWxcIiA9PT0gbFtlLnNlbmRlcl0uY29uZmlnLmRpc3BsYXlNb2RlICYmIGcobFtlLnNlbmRlcl0uY29udGFpbmVyKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwibG9hZGVkXCI6XG4gICAgICAgICAgICByLnNlbmQoXCJpbml0TWF4SGVpZ2h0XCIsIHsgaGVpZ2h0OiBsW2Uuc2VuZGVyXS5jb25maWcubWF4SGVpZ2h0IH0sIGxbZS5zZW5kZXJdLmlmcmFtZUlkKSwgZihsW2Uuc2VuZGVyXSwgZS5wYXJhbXMpLCBcInBpYW5vSWRcIiA9PT0gaS5nZXRQcm92aWRlcigpLm5hbWUgJiYgcy5fX3Byb3RlY3RlZF9fLmV4ZWN1dGVQb3N0TWVzc2FnZXNCYXRjaCgpLCBcIm1vZGFsXCIgPT09IGxbZS5zZW5kZXJdLmNvbmZpZy5kaXNwbGF5TW9kZSAmJiB3aW5kb3cuc2V0VGltZW91dCgoZnVuY3Rpb24gKCkgeyBuLmFkZENsYXNzKFwidHAtYWN0aXZlXCIsIGxbZS5zZW5kZXJdLmNvbnRhaW5lciksIGcobFtlLnNlbmRlcl0uY29udGFpbmVyKTsgfSksIDI1KTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiY2FuY2VsXCI6XG4gICAgICAgIGNhc2UgXCJjb21wbGV0ZVwiOlxuICAgICAgICBjYXNlIFwiZXJyb3JcIjpcbiAgICAgICAgY2FzZSBcImxvZ2luUmVxdWlyZWRcIjpcbiAgICAgICAgY2FzZSBcImN1c3RvbUV2ZW50XCI6XG4gICAgICAgICAgICB3KGUuZXZlbnQsIGUucGFyYW1zLCBlLnNlbmRlcik7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcIm9wZW5EaWFsb2dcIjpcbiAgICAgICAgICAgIHYoZS5ldmVudCwgZSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcInBpYW5vSWRQcm9maWxlVXBkYXRlZFwiOlxuICAgICAgICAgICAgcy5vblByb2ZpbGVVcGRhdGUoZS5wYXJhbXMsIChmdW5jdGlvbiAoKSB7IHZhciBuID0gZS5wYXJhbXM7IG4gJiYgbi5yZXN1bHRDYWxsYmFja0lkICYmIHIuc2VuZChcInJlc3VsdENhbGxiYWNrXCIsIG4sIGUuc2VuZGVyKTsgdmFyIHQgPSB7IHVzZXJUb2tlbjogZS5wYXJhbXMudG9rZW4sIHVzZXI6IGUucGFyYW1zLnVzZXIgfTsgYih0KTsgfSkpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJleHRlbmRlZFVzZXJMb2dpblJlcXVpcmVkXCI6XG4gICAgICAgICAgICBzLm9uRXh0ZW5kZWRVc2VyTG9naW5SZXF1aXJlZCgpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJsb2dpblN1Y2Nlc3NcIjpcbiAgICAgICAgICAgIGkuZ2V0UHJvdmlkZXIoKS5vbkxvZ2luU3VjY2VzcyhlLnBhcmFtcyk7XG4gICAgICAgICAgICB2YXIgbyA9IHsgcmVsb2FkQWZ0ZXJMb2dpbjogITAsIHVzZXJUb2tlbjogZS5wYXJhbXMudXNlcl90b2tlbiwgdXNlcjogZS5wYXJhbXMudXNlciB9O1xuICAgICAgICAgICAgYihvKSwgdyhlLmV2ZW50LCBlLnBhcmFtcywgZS5zZW5kZXIpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJsb2dvdXRcIjpcbiAgICAgICAgICAgIGkubG9nb3V0KChmdW5jdGlvbiAoKSB7IHZhciBlID0ge307IGUudXNlclByb3ZpZGVyID0gaS5nZXRQcm92aWRlcigpLmdldE5hbWUoKSwgZS51c2VyVG9rZW4gPSBpLmdldFByb3ZpZGVyKCkuZ2V0VG9rZW4oKSAmJiBpLmdldFByb3ZpZGVyKCkuZ2V0VG9rZW4oKS5sZW5ndGggPiAwID8gaS5nZXRQcm92aWRlcigpLmdldFRva2VuKCkgOiBcIlwiLCBiKGUpOyB9KSksIHcoZS5ldmVudCwgZS5wYXJhbXMsIGUuc2VuZGVyKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwidXNlclByb2ZpbGVVcGRhdGVTdWNjZXNzXCI6XG4gICAgICAgICAgICB2YXIgYSA9IGUsIGMgPSBhLmV2ZW50LCB1ID0gYS5wYXJhbXMsIGQgPSBhLnNlbmRlcjtcbiAgICAgICAgICAgIGkuZ2V0UHJvdmlkZXIoKS5vbkxvZ2luU3VjY2Vzcyh1KTtcbiAgICAgICAgICAgIHZhciBwID0geyB1c2VyUHJvdmlkZXI6IHUudXNlcl9wcm92aWRlciwgdXNlclRva2VuOiB1LnVzZXJfdG9rZW4gfTtcbiAgICAgICAgICAgIGZvciAodmFyIG0gaW4gYihwKSwgdyhjLCB1LCBkKSwgbClcbiAgICAgICAgICAgICAgICBpZiAobC5oYXNPd25Qcm9wZXJ0eShtKSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgaCA9IGxbbV0uY29uZmlnO1xuICAgICAgICAgICAgICAgICAgICBoLmhhc093blByb3BlcnR5KFwidXNlclRva2VuXCIpICYmIGRlbGV0ZSBoLnVzZXJUb2tlbiwgSShoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImxhbmdDaGFuZ2VkV2l0aGluTXlBY2NvdW50XCI6XG4gICAgICAgICAgICBzLmlzQ29uZmlndXJlZCgpICYmIHMudXBkYXRlTGFuZyhlLnBhcmFtcy5sYW5nKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwicmVxdWVzdFNjcm9sbERhdGFcIjpcbiAgICAgICAgICAgIGsoZS5zZW5kZXIpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJkb3duRm9yTWFpbnRlbmFuY2VcIjpcbiAgICAgICAgICAgIGYobFtlLnNlbmRlcl0sIHsgd2lkdGg6IDMwMCwgaGVpZ2h0OiAyMDAgfSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcInJlbW92ZVF1ZXJ5UGFyYW1CeU5hbWVcIjpcbiAgICAgICAgICAgIEFycmF5LmlzQXJyYXkoZS5wYXJhbXMucGFyYW1zVG9SZW1vdmUpICYmIGUucGFyYW1zLnBhcmFtc1RvUmVtb3ZlLmZvckVhY2goKGZ1bmN0aW9uIChlKSB7IHQucmVtb3ZlUXVlcnlQYXJhbUJ5TmFtZShlKTsgfSkpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJnZXRUcmFja2luZ0RhdGFcIjpcbiAgICAgICAgICAgIHIuc2VuZChcImdldFRyYWNraW5nRGF0YVJlc3BvbnNlRXZlbnRcIiwgeyBwYWdlVmlld0lkOiBwbi5tYWluLmZldGNoUGFnZVZpZXdJZCgpLCB0YmM6IHQuZ2V0VGJjQ29va2llKCkgfSwgZS5zZW5kZXIpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGRlZmF1bHQ6IHJldHVybiB2b2lkIHQubG9nKFwiUmVjZWl2ZWQgaW52YWxpZCBldmVudCB0eXBlOiBcIiArIGUuZXZlbnQpO1xuICAgIH0gfSwgYiA9IGZ1bmN0aW9uIChlKSB7IHIuYnJvYWRjYXN0KFwicmVsb2FkT2ZmZXJcIiwgZSk7IH0sIGsgPSBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IGxbZV0uZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSwgdCA9IHsgaWZyYW1lUmVjdDogeyBib3R0b206IG4uYm90dG9tLCBoZWlnaHQ6IG4uaGVpZ2h0LCBsZWZ0OiBuLmxlZnQsIHJpZ2h0OiBuLnJpZ2h0LCB0b3A6IG4udG9wLCB3aWR0aDogbi53aWR0aCB9IH07IHIuc2VuZChcInJldHVyblNjcm9sbERhdGFcIiwgdCwgZSk7IH07IGZ1bmN0aW9uIF8oZSkgeyB2YXIgbyA9IHsgd2lkZ2V0OiBcIm15YWNjb3VudFwiIH07IGlmIChlLnRlbXBsYXRlSWQgJiYgKG8udGVtcGxhdGVJZCA9IGUudGVtcGxhdGVJZCksIHZvaWQgMCA9PT0gZS5kaXNwbGF5TW9kZSlcbiAgICAgICAgZS5kaXNwbGF5TW9kZSA9IFwiaW5saW5lXCI7XG4gICAgZWxzZSBpZiAoXCJtb2RhbFwiICE9PSBlLmRpc3BsYXlNb2RlICYmIFwiaW5saW5lXCIgIT09IGUuZGlzcGxheU1vZGUpXG4gICAgICAgIHJldHVybiB2b2lkIHQubG9nKFwiSW52YWxpZCBvZmZlciBkaXNwbGF5TW9kZTsgbXVzdCBiZSBvbmUgb2Y6IG1vZGFsLCBpbmxpbmVcIik7IGlmIChvLmRpc3BsYXlNb2RlID0gZS5kaXNwbGF5TW9kZSwgby5pZnJhbWVJZCA9IHQucmFuZG9tU3RyaW5nKDE2KSwgby51cmwgPSB3aW5kb3cubG9jYXRpb24uaHJlZiwgby5pbml0aWFsV2lkdGggPSBlLndpZHRoLCBvLmluaXRpYWxIZWlnaHQgPSBlLmhlaWdodCwgby5tYXhIZWlnaHQgPSBlLm1heEhlaWdodCwgcG4ubG9jYWxlICYmIChvLmxhbmcgPSBwbi5sb2NhbGUpLCAhcG4uamFucmFpbi5pc0NvbmZpZ3VyZWQoKSB8fCB2b2lkIDAgIT09IGUubG9naW5SZXF1aXJlZCAmJiBlLmxvZ2luUmVxdWlyZWQpXG4gICAgICAgIGlmICghcG4uZ2lneWEuaXNDb25maWd1cmVkKCkgfHwgdm9pZCAwICE9PSBlLmxvZ2luUmVxdWlyZWQgJiYgZS5sb2dpblJlcXVpcmVkKVxuICAgICAgICAgICAgaWYgKHBuLnBpYW5vSWQuaXNDb25maWd1cmVkKCkpIHtcbiAgICAgICAgICAgICAgICB2ID0gZTtcbiAgICAgICAgICAgICAgICBpZiAocG4ucGlhbm9JZC5zZXRDYWxsYmFja3MoeyBsb2dnZWRJbjogZnVuY3Rpb24gKG4pIHsgdmFyIHQ7IG8udXNlclRva2VuICE9PSBuLnRva2VuICYmIChlLmxvZ2luU3VjY2VzcyAmJiAodCA9IGUubG9naW5TdWNjZXNzKG4pKSwgKHZvaWQgMCA9PT0gdCB8fCB0KSAmJiAodi51c2VyVG9rZW4gPSBuLnRva2VuLCBJKHYpKSk7IH0sIGxvZ2dlZE91dDogZnVuY3Rpb24gKCkgeyB2YXIgZSA9IHt9OyBlLnVzZXJQcm92aWRlciA9IGkuZ2V0UHJvdmlkZXIoKS5nZXROYW1lKCksIGUudXNlclRva2VuID0gaS5nZXRQcm92aWRlcigpLmdldFRva2VuKCkgJiYgaS5nZXRQcm92aWRlcigpLmdldFRva2VuKCkubGVuZ3RoID4gMCA/IGkuZ2V0UHJvdmlkZXIoKS5nZXRUb2tlbigpIDogXCJcIiwgYihlKTsgfSB9KSwgdm9pZCAwID09PSBlLmxvZ2luUmVxdWlyZWQgfHwgIWUubG9naW5SZXF1aXJlZCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgcyA9IDA7XG4gICAgICAgICAgICAgICAgICAgIGUubG9naW5SZXF1aXJlZCA9IGZ1bmN0aW9uICgpIHsgaWYgKCsrcyA+IDEwKVxuICAgICAgICAgICAgICAgICAgICAgICAgdC5sb2coXCJUb28gbWFueSBhdHRlbXBzIHRvIGxvZ2luIGZvciBteUFjY291bnRcIik7XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGUgPSB0LmdldFF1ZXJ5UGFyYW1CeU5hbWUoXCJ2ZXJpZmljYXRpb25fY29kZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBuLnBpYW5vSWQuc2hvdyh7IHZlcmlmaWNhdGlvbkNvZGU6IGUgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0gfTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgby5waWFub0lkVXJsID0gcG4ucGlhbm9JZC5nZXRJZnJhbWVVcmwoKTtcbiAgICAgICAgICAgICAgICB2YXIgdSA9IHBuLnBpYW5vSWQuZ2V0TGFuZygpO1xuICAgICAgICAgICAgICAgIHUgJiYgKG8ubGFuZyA9IHUpLCBwbi5waWFub0lkLm9uTGFuZ0NoYW5nZSgoZnVuY3Rpb24gKGUpIHsgci5zZW5kKFwibGFuZ0NoYW5nZWRcIiwgeyBsYW5nOiBlIH0sIG8uaWZyYW1lSWQpOyB9KSwgby5pZnJhbWVJZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgcG4ucGlhbm9JZExpdGUuaXNDb25maWd1cmVkKCkgJiYgKG8ucGlhbm9JZFVybCA9IHBuLnBpYW5vSWQuZ2V0SWZyYW1lVXJsKCkpO1xuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIG0gPSBbXTtcbiAgICAgICAgICAgIHBuLmdpZ3lhLnJlZ2lzdGVyQ2FsbGJhY2soXCJvbkhpZGVcIiwgKGZ1bmN0aW9uICgpIHsgYS5hY3RpdmF0ZUNvbnRhaW5lcnMobSksIHQuZG9uZUNhbGwoXCJteUFjY291bnRMb2dpblwiKTsgfSkpLCBlLmxvZ2luUmVxdWlyZWQgPSBmdW5jdGlvbiAoKSB7IHZhciBuID0gZTsgdC53YWl0Q2FsbChcInJlZnJlc2hBY2Nlc3NUb2tlbkxpc3RcIiwgKGZ1bmN0aW9uICgpIHsgdC53YWl0Q2FsbChcIm9mZmVyQ3JlYXRlXCIsIChmdW5jdGlvbiAoKSB7IHQuc3RhcnRDYWxsKFwibXlBY2NvdW50TG9naW5cIiksIG0gPSBhLmhpZGVNb2RhbENvbnRhaW5lcigpLCBwbi5naWd5YS5sb2dpbigoZnVuY3Rpb24gKHQpIHsgdmFyIHI7IGUubG9naW5TdWNjZXNzICYmIChyID0gZS5sb2dpblN1Y2Nlc3ModCkpLCAodm9pZCAwID09PSByIHx8IHIpICYmIChuLnVzZXJUb2tlbiA9IHQudXNlcl90b2tlbiwgSShuKSk7IH0pKTsgfSkpOyB9KSk7IH07XG4gICAgICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgdmFyIG0gPSBbXSwgdiA9IGU7XG4gICAgICAgIHBuLmphbnJhaW4uYWRkRXZlbnRIYW5kbGVyKFwib25Nb2RhbENsb3NlXCIsIChmdW5jdGlvbiAoKSB7IGEuYWN0aXZhdGVDb250YWluZXJzKG0pLCB0LmRvbmVDYWxsKFwibXlBY2NvdW50TG9naW5cIik7IH0pKSwgcG4uamFucmFpbi5yZWdpc3RlckNhbGxiYWNrKFwidXNlckNoYW5nZWRcIiwgKGZ1bmN0aW9uIChuKSB7IHZhciB0OyBuICYmIG4udXNlcl90b2tlbiAmJiAoZS5sb2dpblN1Y2Nlc3MgJiYgKHQgPSBlLmxvZ2luU3VjY2VzcyhuKSksICh2b2lkIDAgPT09IHQgfHwgdCkgJiYgKHYudXNlclRva2VuID0gbi51c2VyX3Rva2VuLCBJKHYpKSk7IH0pKSwgcG4uamFucmFpbi5hZGRFdmVudEhhbmRsZXIoXCJvbkNhcHR1cmVTZXNzaW9uRW5kZWRcIiwgKGZ1bmN0aW9uIChuKSB7IHZhciB0OyBlLmxvZ2luU3VjY2VzcyAmJiAodCA9IGUubG9naW5TdWNjZXNzKG4pKSwgKHZvaWQgMCA9PT0gdCB8fCB0KSAmJiAodi51c2VyVG9rZW4gPSBudWxsLCBJKHYpKTsgfSkpLCBlLmxvZ2luUmVxdWlyZWQgPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0LndhaXRDYWxsKFwicmVmcmVzaEFjY2Vzc1Rva2VuTGlzdFwiLCAoZnVuY3Rpb24gKCkgeyB0LndhaXRDYWxsKFwib2ZmZXJDcmVhdGVcIiwgKGZ1bmN0aW9uICgpIHsgdC5zdGFydENhbGwoXCJteUFjY291bnRMb2dpblwiKSwgbSA9IGEuaGlkZU1vZGFsQ29udGFpbmVyKCksIHBuLmphbnJhaW4ubG9naW4oKTsgfSkpOyB9KSksICExOyB9O1xuICAgIH0gcmV0dXJuIG5ldyBQcm9taXNlKChmdW5jdGlvbiAoYSkgeyB0LndhaXRDYWxsKFwicmVmcmVzaFVzZXJUb2tlblwiLCAoZnVuY3Rpb24gKCkgeyB2YXIgcywgdSA9IHt9OyBpZiAoXCJpbmxpbmVcIiA9PT0gZS5kaXNwbGF5TW9kZSkge1xuICAgICAgICBpZiAoIWUuY29udGFpbmVyU2VsZWN0b3IpXG4gICAgICAgICAgICByZXR1cm4gdm9pZCB0LmxvZyhcIk15IGFjY291bnQgbXVzdCBoYXZlIGEgdmFsaWQgY29udGFpbmVyU2VsZWN0b3JcIik7XG4gICAgICAgIGlmICghKHMgPSBuLnF1ZXJ5RWwoZS5jb250YWluZXJTZWxlY3RvcikpKVxuICAgICAgICAgICAgcmV0dXJuIHZvaWQgdC5sb2coXCJNeSBhY2NvdW50IG11c3QgaGF2ZSBhIHZhbGlkIGNvbnRhaW5lclNlbGVjdG9yXCIpO1xuICAgICAgICBvLndpZHRoID0gbi5nZXRXaWR0aChzKTtcbiAgICB9XG4gICAgZWxzZVxuICAgICAgICBzID0gZnVuY3Rpb24gKCkgeyB2YXIgZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7IG4uYWRkQ2xhc3MoXCJ0cC1tb2RhbFwiLCBlKTsgdmFyIHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpOyByZXR1cm4gbi5hZGRDbGFzcyhcInRwLWNsb3NlXCIsIHQpLCBuLmFwcGVuZChlLCB0KSwgbi5hcHBlbmQoZG9jdW1lbnQuYm9keSwgZSksIGU7IH0oKTsgZm9yICh2YXIgbSBpbiBvLnBhZ2VWaWV3SWQgPSBwbi5tYWluLmZldGNoUGFnZVZpZXdJZCgpLCBvLnRiYyA9IHQuZ2V0VGJjQ29va2llKCksIG8udXNlclByb3ZpZGVyID0gaS5nZXRQcm92aWRlcigpLmdldE5hbWUoKSwgZS51c2VyVG9rZW4gPyBvLnVzZXJUb2tlbiA9IGUudXNlclRva2VuIDogby51c2VyVG9rZW4gPSBpLmdldFByb3ZpZGVyKCkuZ2V0VG9rZW4oKSwgZClcbiAgICAgICAgXCJmdW5jdGlvblwiID09IHR5cGVvZiBlW21dICYmICh0LmRlYnVnKFwiUmVnaXN0ZXJpbmcgXCIgKyBtICsgXCIgY2FsbGJhY2sgZm9yIGlmcmFtZSBcIiArIG8uaWZyYW1lSWQpLCBoKG0sIGVbbV0pKTsgby5haWQgPSBwbi5haWQsIHBuLmlzU2Vuc2l0aXZlRGF0YVByb3RlY3Rpb25FbmFibGVkICYmICh1ID0geyB1c2VyVG9rZW46IG8udXNlclRva2VuLCBpZnJhbWVJZDogby5pZnJhbWVJZCB9LCBkZWxldGUgby51c2VyVG9rZW4pOyB2YXIgdiA9IHAoKSArIFwiP1wiICsgbi5wYXJhbShvKSwgdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpZnJhbWVcIiksIGIgPSB7IHNjcm9sbGluZzogXCJub1wiLCBhbGxvd3RyYW5zcGFyZW5jeTogXCJ0cnVlXCIsIG5hbWU6IG8uaWZyYW1lSWQsIGlkOiBvLmlmcmFtZUlkLCBhbGxvdzogXCJwYXltZW50XCIgfTsgcG4uaXNTZW5zaXRpdmVEYXRhUHJvdGVjdGlvbkVuYWJsZWQgfHwgKGIuc3JjID0gdiksIE9iamVjdC5rZXlzKGIpLmZvckVhY2goKGZ1bmN0aW9uIChlKSB7IG4uc2V0QXR0cihlLCBiW2VdLCB3KTsgfSkpOyB2YXIgayA9IHsgb3ZlcmZsb3c6IFwiaGlkZGVuXCIsIGJvcmRlcjogXCIwXCIsIGhlaWdodDogXCIwXCIgfTsgaWYgKFwiaW5saW5lXCIgPT09IGUuZGlzcGxheU1vZGUgPyBrLndpZHRoID0gby53aWR0aCArIFwicHhcIiA6IGsud2lkdGggPSAwLCBPYmplY3Qua2V5cyhrKS5mb3JFYWNoKChmdW5jdGlvbiAoZSkgeyB3LnN0eWxlW2VdID0ga1tlXTsgfSkpLCBsW28uaWZyYW1lSWRdID0geyBpZnJhbWVJZDogby5pZnJhbWVJZCwgY29uZmlnOiBlLCBlbGVtZW50OiB3LCBjb250YWluZXI6IHMsIGNvbnRhaW5lcldpZHRoOiBuLmdldFdpZHRoKHMpLCBjb250YWluZXJIZWlnaHQ6IG4uZ2V0SGVpZ2h0KHMpIH0sIHIuaW5pdCh7IHBvc3RNZXNzYWdlVXJsOiBwKCksIHJlY2VpdmU6IHksIGlmcmFtZTogbFtvLmlmcmFtZUlkXSB9KSwgbi5vbih3aW5kb3csIFwia2V5dXBcIiwgKGZ1bmN0aW9uIChlKSB7IH0pKSwgXCJtb2RhbFwiID09PSBlLmRpc3BsYXlNb2RlICYmIG4ub24od2luZG93LCBcInJlc2l6ZVwiLCAoZnVuY3Rpb24gKCkgeyBnKHMpOyB9KSksIFwibW9kYWxcIiA9PT0gZS5kaXNwbGF5TW9kZSA/IGcocykgOiBuLmVtcHR5KHMpLCBwbi5pc1NlbnNpdGl2ZURhdGFQcm90ZWN0aW9uRW5hYmxlZCkge1xuICAgICAgICB1LmlmcmFtZVNyYyA9IHY7XG4gICAgICAgIHZhciBfID0gQyh1KTtcbiAgICAgICAgbi5hcHBlbmQocywgdyksIG4uYXBwZW5kKHMsIF8pLCBfLnN1Ym1pdCgpO1xuICAgIH1cbiAgICBlbHNlXG4gICAgICAgIG4uYXBwZW5kKHMsIHcpOyBpZiAobi5vbih3aW5kb3csIFwicmVzaXplXCIsIChmdW5jdGlvbiAoKSB7ICFmdW5jdGlvbiAoKSB7IGZvciAodmFyIGUgaW4gbCkge1xuICAgICAgICB2YXIgdCA9IGxbZV0sIG8gPSAhMSwgaSA9IG4uZ2V0V2lkdGgodC5jb250YWluZXIpO1xuICAgICAgICBpICE9PSB0LmNvbnRhaW5lcldpZHRoICYmICh0LmVsZW1lbnQuc3R5bGUud2lkdGggPSBpICsgXCJcIiwgdC5jb250YWluZXJXaWR0aCA9IGksIG8gPSAhMCk7XG4gICAgICAgIHZhciBhID0gbi5nZXRIZWlnaHQodC5jb250YWluZXIpO1xuICAgICAgICBhICE9PSB0LmNvbnRhaW5lckhlaWdodCAmJiAodC5lbGVtZW50LnN0eWxlLmhlaWdodCA9IGEgKyBcIlwiLCB0LmNvbnRhaW5lckhlaWdodCA9IGEsIG8gPSAhMCksIG8gJiYgci5zZW5kKFwicmVzaXplXCIsIHsgd2lkdGg6IGksIGhlaWdodDogYSB9LCBlKTtcbiAgICB9IH0oKTsgfSkpLCBcImlubGluZVwiID09PSBlLmRpc3BsYXlNb2RlICYmIHdpbmRvdy5SZXNpemVPYnNlcnZlcikge1xuICAgICAgICB2YXIgSSA9IG5ldyBSZXNpemVPYnNlcnZlcigoZnVuY3Rpb24gKGUpIHsgdmFyIHQgPSBuLmdldFdpZHRoKHMpOyB0ID4gMCAmJiBmKGxbby5pZnJhbWVJZF0sIHsgd2lkdGg6IHQgfSk7IH0pKTtcbiAgICAgICAgSS5vYnNlcnZlKHMpLCBsW28uaWZyYW1lSWRdLnJlc2l6ZU9ic2VydmVyID0gSTtcbiAgICB9IHBuLm9mZmVyICYmIHBuLm9mZmVyLnJlZ2lzdGVyQ2FsbGJhY2soXCJjb21wbGV0ZVwiLCAoZnVuY3Rpb24gKCkgeyByLnNlbmQoXCJyZWZyZXNoTm93XCIsIHt9LCBvLmlmcmFtZUlkKTsgfSkpLCBhKGxbby5pZnJhbWVJZF0pLCBjLnNldFRpbWUoXCJteUFjY291bnRTaG93XCIpOyB9KSk7IH0pKTsgfSB2YXIgQyA9IGZ1bmN0aW9uIChlKSB7IHZhciB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImZvcm1cIiksIHIgPSB7IGlkOiBcImZvcm1fXCIgKyBlLmlmcmFtZUlkLCBtZXRob2Q6IFwicG9zdFwiLCBhY3Rpb246IGUuaWZyYW1lU3JjLCB0YXJnZXQ6IGUuaWZyYW1lSWQgfTsgcmV0dXJuIG4uc2V0QXR0cnMociwgdCksIFt7IG5hbWU6IFwidXNlclRva2VuXCIsIHZhbHVlOiBlLnVzZXJUb2tlbiB9XS5mb3JFYWNoKChmdW5jdGlvbiAoZSkgeyB2YXIgciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiKSwgbyA9IHsgdHlwZTogXCJoaWRkZW5cIiwgbmFtZTogZS5uYW1lIH07IG4uc2V0QXR0cnMobywgciksIHIudmFsdWUgPSBlLnZhbHVlLCBuLmFwcGVuZCh0LCByKTsgfSkpLCB0OyB9LCBJID0gZnVuY3Rpb24gKGUpIHsgdC53YWl0Q2FsbChcIm9mZmVyQ3JlYXRlXCIsIChmdW5jdGlvbiAoKSB7IHQud2FpdENhbGwoXCJyZWZyZXNoQWNjZXNzVG9rZW5MaXN0XCIsIChmdW5jdGlvbiAoKSB7IHZhciBuOyBudWxsID09PSAobiA9IF8oZSkpIHx8IHZvaWQgMCA9PT0gbiB8fCBuLnRoZW4oKGZ1bmN0aW9uIChlKSB7IGUgfHwgdC5sb2coXCJDb3VsZCBub3QgaW5pdGlhbGl6ZSBteSBhY2NvdW50OyBjaGVjayBjb25maWd1cmF0aW9uXCIpOyB9KSk7IH0pKTsgfSkpOyB9OyByZXR1cm4geyBuYW1lOiBcIm15YWNjb3VudFwiLCBzaG93OiBJLCByZWdpc3RlckNhbGxiYWNrOiBoIH07IH0oKTtcbiAgICBwbi5jb250YWluZXIucmVnaXN0ZXIoXCJteWFjY291bnRcIiwgeyB1c2VWYWx1ZTogUWUgfSksIHBuLm15YWNjb3VudCA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwibXlhY2NvdW50XCIpO1xuICAgIHZhciBYZSA9IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSBwbi5jb250YWluZXIucmVzb2x2ZShcImpxVXRpbHNcIiksIG4gPSBwbi5jb250YWluZXIucmVzb2x2ZShcInV0aWxcIiksIHQgPSBwbi5jb250YWluZXIucmVzb2x2ZShcImFwaVwiKSwgciA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwib2ZmZXJcIiksIG8gPSBwbi5jb250YWluZXIucmVzb2x2ZShcImV2ZW50VXRpbHNcIikuY3JlYXRlRXZlbnRNYW5hZ2VyKFtcIm9uQ2hlY2tvdXRTdWNjZXNzXCIsIFwib25NZXRlckV4cGlyZWRcIiwgXCJvbk1ldGVyRXJyb3JcIiwgXCJvbkFjY2Vzc0dyYW50ZWRcIiwgXCJvbk1ldGVyQWN0aXZlXCIsIFwib25NZXRlckluYWN0aXZlXCIsIFwibWV0ZXJTZWxlY3RvclwiXSksIGkgPSB7IHN0YXRlOiBcIm9rXCIsIHZpZXdzX2xlZnQ6IG51bGwsIG9mZmVyX2lkOiBcIlwiLCBjdXJ0YWluX3RlbXBsYXRlX2lkOiBcIlwiLCByZW1pbmRlcl90ZW1wbGF0ZV9pZDogXCJcIiwgY29va2llX25hbWU6IFwiXCIsIGNvb2tpZV92YWx1ZTogXCJcIiwgY29va2llX2V4cGlyZXM6IFwiXCIsIHNob3dfcmVtaW5kZXI6ICExLCBzaG93X2Nsb3NlX2J1dHRvbjogITEgfSwgYSA9IGZ1bmN0aW9uIChlLCB0KSB7IHJldHVybiBvLmZpcmUodm9pZCAwLCBlLCAhMCwgdCksICF1W2VdIHx8IFwiZnVuY3Rpb25cIiAhPSB0eXBlb2YgdVtlXSB8fCAobi5kZWJ1ZyhcIl9jdXN0b21DYWxsZXIgY2FsbGVkIHdpdGggXCIgKyBlKSwgdVtlXSh0KSk7IH0sIHMgPSBmdW5jdGlvbiAobikgeyAobiA9IG4gfHwge30pLm9mZmVySWQgfHwgKG4ub2ZmZXJJZCA9IGkub2ZmZXJfaWQpLCBuLnRlbXBsYXRlSWQgfHwgKG4udGVtcGxhdGVJZCA9IGkuY3VydGFpbl90ZW1wbGF0ZV9pZCksIG4uZGlzcGxheU1vZGUgfHwgKG4uZGlzcGxheU1vZGUgPSB1LmRpc3BsYXlNb2RlKSwgbi5jb250YWluZXJTZWxlY3RvciB8fCAobi5jb250YWluZXJTZWxlY3RvciA9IHUuY29udGFpbmVyU2VsZWN0b3IpLCBuLnNob3dDbG9zZUJ1dHRvbiB8fCAobi5zaG93Q2xvc2VCdXR0b24gPSBpLnNob3dfY2xvc2VfYnV0dG9uKSwgXCJmdW5jdGlvblwiID09PSBlLnR5cGUodS5jbG9zZSkgJiYgKG4uY2xvc2UgPSB1LmNsb3NlKSwgXCJmdW5jdGlvblwiID09PSBlLnR5cGUodS5sb2dpblJlcXVpcmVkKSAmJiAobi5sb2dpblJlcXVpcmVkID0gdS5sb2dpblJlcXVpcmVkKSwgXCJmdW5jdGlvblwiID09PSBlLnR5cGUodS5jdXN0b21FdmVudCkgJiYgKG4uY3VzdG9tRXZlbnQgPSB1LmN1c3RvbUV2ZW50KSwgXCJmdW5jdGlvblwiID09PSBlLnR5cGUodS5vbkNoZWNrb3V0U3VjY2VzcykgJiYgKG4uY29tcGxldGUgPSB1Lm9uQ2hlY2tvdXRTdWNjZXNzKSwgci5jcmVhdGVPZmZlcklmcmFtZShuKTsgfSwgYyA9IGZ1bmN0aW9uIChlKSB7IGlmIChhKFwiX19fb25Qcm9jZXNzTWV0ZXJcIiwgZSksICFlLnVzZXJfbWV0ZXIpXG4gICAgICAgIHJldHVybiBuLmxvZyhcIkNvdWxkIG5vdCBsb2FkIG1ldGVyXCIsIGUpLCB2b2lkIGEoXCJvbk1ldGVyRXJyb3JcIiwgZSk7IGlmICgoaSA9IGUudXNlcl9tZXRlcikgJiYgaS5jb29raWVfbmFtZSAmJiBpLmNvb2tpZV92YWx1ZSAmJiBpLmNvb2tpZV9leHBpcmVzKSB7XG4gICAgICAgIHZhciB0ID0geyBwYXRoOiBcIi9cIiwgZXhwaXJlczogaS5jb29raWVfZXhwaXJlcyB9O1xuICAgICAgICBpLmNvb2tpZV9kb21haW4gJiYgKHQuZG9tYWluID0gaS5jb29raWVfZG9tYWluKSwgbi5fX3Byb3RlY3RlZF9fLnNldENvb2tpZShpLmNvb2tpZV9uYW1lLCBpLmNvb2tpZV92YWx1ZSwgdCk7XG4gICAgfSBcIm9rXCIgPT09IGkuc3RhdGUgPyBmdW5jdGlvbiAoZSkgeyBuLmRlYnVnKFwiX2hhbmRsZU1ldGVyQWN0aXZlXCIsIGUpLCBlLnNob3dfcmVtaW5kZXIgJiYgZS5yZW1pbmRlcl90ZW1wbGF0ZV9pZCAmJiBlLnRyYWNrX3BhZ2VfdmlldyAmJiBhKFwib25TaG93T2ZmZXJcIiwgZSkgJiYgcyh7IHRlbXBsYXRlSWQ6IGUucmVtaW5kZXJfdGVtcGxhdGVfaWQgfSksIGEoXCJvbk1ldGVyQWN0aXZlXCIsIGUpOyB9KGkpIDogXCJhcFwiID09PSBpLnN0YXRlID8gZnVuY3Rpb24gKGUpIHsgbi5kZWJ1ZyhcIl9oYW5kbGVBY2Nlc3NHcmFudGVkXCIsIGUpLCBhKFwib25BY2Nlc3NHcmFudGVkXCIsIGUpOyB9KGkpIDogXCJpYVwiID09PSBpLnN0YXRlID8gZnVuY3Rpb24gKGUpIHsgbi5kZWJ1ZyhcIl9oYW5kbGVNZXRlckluYWN0aXZlXCIsIGUpLCBhKFwib25NZXRlckluYWN0aXZlXCIsIGUpOyB9KGkpIDogZnVuY3Rpb24gKGUpIHsgbi5kZWJ1ZyhcIl9oYW5kbGVFeHBpcmVkXCIsIGUpLCBhKFwib25NZXRlckV4cGlyZWRcIiwgZSksIGUudHJhY2tfcGFnZV92aWV3ICYmIGEoXCJvblNob3dPZmZlclwiLCBlKSAmJiBzKCk7IH0oaSk7IH0sIGwgPSBmdW5jdGlvbiAoZSwgciwgbykgeyBpZiAobnVsbCAhPT0gdS5wYXl3YWxsSWQgJiYgXCJcIiAhPT0gdS5wYXl3YWxsSWQpIHtcbiAgICAgICAgdmFyIGkgPSBkb2N1bWVudC5VUkw7XG4gICAgICAgIGUgJiYgXCJmdW5jdGlvblwiID09IHR5cGVvZiBlLmdldEF0dHJpYnV0ZSAmJiBlLmdldEF0dHJpYnV0ZShcImhyZWZcIikgPyBpID0gZS5nZXRBdHRyaWJ1dGUoXCJocmVmXCIpIDogZSAmJiBcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIGUuYXR0ciAmJiBlLmF0dHIoXCJocmVmXCIpICYmIChpID0gZS5hdHRyKFwiaHJlZlwiKSk7XG4gICAgICAgIHZhciBhID0gdS50cmFja1BhZ2V2aWV3O1xuICAgICAgICBhICYmIGRlbGV0ZSB1LnRyYWNrUGFnZXZpZXc7XG4gICAgICAgIHZhciBzID0gdS5tZXRlclNlbGVjdG9yKCk7XG4gICAgICAgIHMgfHwgKHMgPSBcIlwiKTtcbiAgICAgICAgdmFyIGwgPSB7IHBheXdhbGxfaWQ6IHUucGF5d2FsbElkLCB1cmw6IGVuY29kZVVSSShpKSwgcmVmZXJlcjogZW5jb2RlVVJJKHUucmVmZXJlciksIHRyYWNrX3BhZ2VfdmlldzogYSwgbWV0ZXJfbmFtZTogcywgcGFnZXZpZXdfaWQ6IHBuLm1haW4uZmV0Y2hQYWdlVmlld0lkKCkgfTtcbiAgICAgICAgciAmJiAobC50cmFuc2FjdGlvbl9pZCA9IHIpLCB1LnJlZmVyZXIgPSBcIlwiO1xuICAgICAgICB2YXIgZCA9IG4uX19wcm90ZWN0ZWRfXy5nZXRDb29raWUoXCJ1bWNcIik7XG4gICAgICAgIGlmIChkKVxuICAgICAgICAgICAgbC51bWMgPSBkO1xuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHZhciBwID0gbi5fX3Byb3RlY3RlZF9fLmdldENvb2tpZShcInVtY19cIiArIHUucGF5d2FsbElkKTtcbiAgICAgICAgICAgIHAgJiYgKGwudW1jID0gcCk7XG4gICAgICAgIH1cbiAgICAgICAgdC5jYWxsQXBpKFwiL2Fub24vbWV0ZXIvbG9hZFwiLCBsLCAoZnVuY3Rpb24gKGUpIHsgYyhlKSwgXCJmdW5jdGlvblwiID09IHR5cGVvZiBvICYmIG8oKTsgfSkpO1xuICAgIH1cbiAgICBlbHNlXG4gICAgICAgIG4uZGVidWcoXCJZb3UgbXVzdCBzcGVjaWZ5IGEgcGF5d2FsbElkIGluIHlvdXIgY29uZmlndXJhdGlvblwiKTsgfSwgdSA9IHsgcGF5d2FsbElkOiBudWxsLCB0cmFja1BhZ2V2aWV3OiAhMCwgdHJhY2tFeHRlcm5hbFJlZmVycmVyOiAhMCwgcmVmZXJlcjogZG9jdW1lbnQucmVmZXJyZXIsIG9mZmVyVVJMOiBcIlwiLCBkaXNwbGF5TW9kZTogXCJtb2RhbFwiLCBjb250YWluZXJTZWxlY3RvcjogXCJcIiwgb25DaGVja291dFN1Y2Nlc3M6IGZ1bmN0aW9uICgpIHsgfSwgb25NZXRlckV4cGlyZWQ6IGZ1bmN0aW9uICgpIHsgfSwgb25NZXRlckVycm9yOiBmdW5jdGlvbiAoKSB7IH0sIG9uQWNjZXNzR3JhbnRlZDogZnVuY3Rpb24gKCkgeyB9LCBvbk1ldGVyQWN0aXZlOiBmdW5jdGlvbiAoKSB7IH0sIG9uTWV0ZXJJbmFjdGl2ZTogZnVuY3Rpb24gKCkgeyB9LCBtZXRlclNlbGVjdG9yOiBmdW5jdGlvbiAoKSB7IH0gfTsgcmV0dXJuIHsgbmFtZTogXCJtZXRlclwiLCBpbml0OiBmdW5jdGlvbiAoZSkgeyBpZiAodm9pZCAwICE9PSBlKVxuICAgICAgICAgICAgaWYgKHZvaWQgMCAhPT0gZS5wYXl3YWxsSUQgfHwgdm9pZCAwICE9PSBlLnBheXdhbGxJZCkge1xuICAgICAgICAgICAgICAgIGZvciAodmFyIHQgaW4gdm9pZCAwID09PSBlLnBheXdhbGxJZCAmJiAoZS5wYXl3YWxsSWQgPSBlLnBheXdhbGxJRCksIGUpXG4gICAgICAgICAgICAgICAgICAgIHVbdF0gPSBlW3RdO1xuICAgICAgICAgICAgICAgIHUucmVmZXJlciA9IGRvY3VtZW50LnJlZmVycmVyLCBuLmRlYnVnKFwiSW5pdGlhbGl6aW5nIHBheXdhbGw6IFwiICsgdS5wYXl3YWxsSWQpLCBsKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgbi5lcnJvcihcIk11c3Qgc3BlY2lmeSBwYXl3YWxsSWQgdG8gbG9hZCBQaWFubyBwYXl3YWxsXCIpO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICBuLmVycm9yKFwiTXVzdCBzcGVjaWZ5IHBheXdhbGwgY29uZmlndXJhdGlvbiB0byBsb2FkIFBpYW5vIHBheXdhbGxcIik7IH0sIGlzRXhwaXJlZDogZnVuY3Rpb24gKCkgeyByZXR1cm4gaS5zdGF0ZSAmJiBcImV4XCIgPT09IGkuc3RhdGU7IH0sIGlzRXhwaXJlZE5leHRDbGljazogZnVuY3Rpb24gKCkgeyByZXR1cm4gdm9pZCAwICE9PSBpLnZpZXdzX2xlZnQgJiYgMCA9PT0gaS52aWV3c19sZWZ0OyB9LCBjaGVja01ldGVyOiBmdW5jdGlvbiAoZSkgeyB1LnRyYWNrUGFnZXZpZXcgPSAhMCwgbChlKTsgfSwgc2hvd0N1cnRhaW46IHMsIGxhc3Q6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGk7IH0sIHJlZ2lzdGVyQ2FsbGJhY2s6IGZ1bmN0aW9uIChlLCBuKSB7IG8uYWRkRXZlbnQoZSksIG8ucmVnaXN0ZXJDYWxsYmFjayhlLCBuKTsgfSB9OyB9KCk7XG4gICAgcG4uY29udGFpbmVyLnJlZ2lzdGVyKFwibWV0ZXJcIiwgeyB1c2VWYWx1ZTogWGUgfSksIHBuLm1ldGVyID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJtZXRlclwiKTtcbiAgICB2YXIgJGUgPSBmdW5jdGlvbiAoKSB7IHZhciBlID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJ1dGlsXCIpLCBuID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJzaGExXCIpLCB0ID0gXCJcIiwgciA9IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSBcIlwiOyByZXR1cm4gW1wiU2hvY2t3YXZlRmxhc2guU2hvY2t3YXZlRmxhc2guNlwiLCBcIlNob2Nrd2F2ZUZsYXNoLlNob2Nrd2F2ZUZsYXNoLjdcIiwgXCJTV0N0MS5TV0N0MS45XCIsIFwiU1dDdGwuU1dDdGxcIiwgXCJBZG9iZS5TVkdDdGxcIiwgXCJXTVBsYXllci5PQ1hcIiwgXCJBZ0NvbnRyb2wuQWdDb250cm9sXCIsIFwiQWNyb1BERi5QREZcIiwgXCJQREYuUGRmQ3RybFwiLCBcIlJlYWxQbGF5ZXIuUmVhbFBsYXllcih0bSkgQWN0aXZlWCBDb250cm9sICgzMi1iaXQpXCIsIFwiUmVhbFBsYXllclwiLCBcIlNreXBlLkRldGVjdGlvblwiLCBcIjNkbWx3LklFUGx1Z2luXCIsIFwiR29vZ2xlVGFsay5QbHVnaW5cIiwgXCJHb29nbGVUYWxrLlBsdWdpbi4xXCJdLm1hcCgoZnVuY3Rpb24gKG4pIHsgdHJ5IHtcbiAgICAgICAgbmV3IHdpbmRvdy5BY3RpdmVYT2JqZWN0KG4pLCBlICs9IG4gKyBcInxcIjtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHsgfSB9KSksIGU7IH0sIG8gPSBmdW5jdGlvbiAoKSB7IGlmICh0KVxuICAgICAgICByZXR1cm4gdDsgdmFyIG8gPSBmdW5jdGlvbiAoKSB7IHRyeSB7XG4gICAgICAgIHZhciBlO1xuICAgICAgICByZXR1cm4gZSA9IHdpbmRvdy5uYXZpZ2F0b3IudXNlckxhbmd1YWdlIHx8IHdpbmRvdy5uYXZpZ2F0b3IubGFuZ3VhZ2UsIChuZXcgRGF0ZSkuZ2V0VGltZXpvbmVPZmZzZXQoKSArIFwiOlwiICsgZTtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgcmV0dXJuIFwiXCI7XG4gICAgfSB9KCk7IHJldHVybiBvICs9IGZ1bmN0aW9uICgpIHsgaWYgKHdpbmRvdy5BY3RpdmVYT2JqZWN0KVxuICAgICAgICByZXR1cm4gcigpOyB0cnkge1xuICAgICAgICB2YXIgZSA9IFwiXCIsIG4gPSBuYXZpZ2F0b3IucGx1Z2lucy5sZW5ndGg7XG4gICAgICAgIGlmIChuID4gMClcbiAgICAgICAgICAgIGZvciAodmFyIHQgPSAwOyB0IDwgbjsgdCsrKVxuICAgICAgICAgICAgICAgIGUgKz0gbmF2aWdhdG9yLnBsdWdpbnNbdF0ubmFtZSArIFwifFwiO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgcmV0dXJuIFwiXCI7XG4gICAgfSB9KCksIG8gKz0gZnVuY3Rpb24gKCkgeyB0cnkge1xuICAgICAgICByZXR1cm4gc2NyZWVuLmhlaWdodCArIFwieFwiICsgc2NyZWVuLndpZHRoICsgXCIrXCIgKyBzY3JlZW4uY29sb3JEZXB0aDtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgcmV0dXJuIFwiXCI7XG4gICAgfSB9KCksIG8gKz0gbmF2aWdhdG9yLnVzZXJBZ2VudCwgbyArPSBmdW5jdGlvbiAoKSB7IHZhciBlID0gXCJcIjsgdHJ5IHtcbiAgICAgICAgZSArPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCA/IDEgOiAwLCBlICs9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlID8gMSA6IDAsIGUgKz0gc2NyZWVuLmdsb2JhbFN0b3JhZ2UgPyAxIDogMCwgZSArPSB3aW5kb3cubG9jYWxTdG9yYWdlID8gMSA6IDAsIGUgKz0gd2luZG93LnNlc3Npb25TdG9yYWdlID8gMSA6IDAsIGUgKz0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSA/IDEgOiAwLCBlICs9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IgPyAxIDogMCwgZSArPSBkb2N1bWVudC5hbGwgPyAxIDogMCwgZSArPSB3aW5kb3cuYXR0YWNoRXZlbnQgPyAxIDogMCwgZSArPSB3aW5kb3cuY3JlYXRlUG9wdXAgPyAxIDogMCwgZSArPSB3aW5kb3cuWE1MSHR0cFJlcXVlc3QgPyAxIDogMCwgZSArPSB3aW5kb3cuQWN0aXZlWE9iamVjdCA/IDEgOiAwLCBlICs9IHdpbmRvdy5YRG9tYWluUmVxdWVzdCA/IDEgOiAwLCBlICs9IHdpbmRvdy5tc1BlcmZvcm1hbmNlID8gMSA6IDAsIGUgKz0gZG9jdW1lbnQuZG9jdW1lbnRNb2RlID8gMSA6IDAsIGUgKz0gbmF2aWdhdG9yLmNwdUNsYXNzID8gMSA6IDAsIGUgKz0gbmF2aWdhdG9yLmJyb3dzZXJMYW5ndWFnZSA/IDEgOiAwLCBlICs9IHdpbmRvdy5vcGVyYSA/IDEgOiAwLCBlICs9IHdpbmRvdy5jaHJvbWUgPyAxIDogMDtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHsgfSByZXR1cm4gZTsgfSgpLCB0ID0gbi5oYXNoKG8pLCBlLmRlYnVnKFwiQ3VycmVudCBicm93c2VyIGZpbmdlcnByaW50IGlzOiBcIiArIHQpLCB0OyB9OyByZXR1cm4gbygpLCB7IG5hbWU6IFwiZmluZ2VycHJpbnRcIiwgZ2V0RmluZ2VycHJpbnQ6IG8gfTsgfSgpO1xuICAgIHBuLmNvbnRhaW5lci5yZWdpc3RlcihcImZpbmdlcnByaW50XCIsIHsgdXNlVmFsdWU6ICRlIH0pLCBwbi5maW5nZXJwcmludCA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwiZmluZ2VycHJpbnRcIik7XG4gICAgdmFyIFllID0gZnVuY3Rpb24gKCkgeyB2YXIgZSwgbiA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwianFVdGlsc1wiKSwgdCA9IDAsIHIgPSAwLCBvID0gMjAwLCBpID0gMCwgYSA9IFtdOyBuLm9uKHdpbmRvdywgXCJzY3JvbGxcIiwgKGZ1bmN0aW9uICgpIHsgYygpOyB9KSk7IHZhciBzID0gZnVuY3Rpb24gKCkgeyB2YXIgZSA9IG4uc2Nyb2xsVG9wKCk7IGUgPiBpICYmIChpID0gZSk7IH0sIGMgPSBmdW5jdGlvbiAoKSB7IHMoKSwgdSgpOyB9LCBsID0gZnVuY3Rpb24gKGUpIHsgaWYgKGUuY29uc3VtZUV2ZW50Rm4oKSlcbiAgICAgICAgcmV0dXJuIFwicGl4ZWxzXCIgPT09IGUubWVhc3VyZVR5cGUgPyBlLnBvc2l0aW9uIDw9IGkgOiBcInBlcmNlbnRhZ2VcIiA9PT0gZS5tZWFzdXJlVHlwZSA/IGkgLyAodCAtIG4ud2luU2l6ZSgpLmhlaWdodCkgPj0gZS5wb3NpdGlvbiAvIDEwMCA6IHZvaWQgMDsgfSwgdSA9IGZ1bmN0aW9uICgpIHsgZm9yICh2YXIgZSwgbiA9IFtdLCB0ID0gW10sIHIgPSAwOyByIDwgYS5sZW5ndGg7IHIrKylcbiAgICAgICAgZSA9IGFbcl0sIGwoZSkgPyBuLnB1c2goZSkgOiB0LnB1c2goZSk7IGEgPSB0OyBmb3IgKHIgPSAwOyByIDwgbi5sZW5ndGg7IHIrKylcbiAgICAgICAgbltyXS5jYWxsYmFjaygpOyB9OyByZXR1cm4geyBuYW1lOiBcInNjcm9sbERlcHRoXCIsIGluaXRpYWxpemU6IGZ1bmN0aW9uIChpKSB7IHZhciBhID0gZG9jdW1lbnQ7IGkgJiYgaSA+IDAgJiYgKG8gPSBpIHx8IG8pOyB2YXIgcyA9IGZ1bmN0aW9uICgpIHsgdmFyIGkgPSBhLmJvZHkgfHwge30sIGMgPSBhLmRvY3VtZW50RWxlbWVudCB8fCB7fSwgbCA9IE1hdGgubWF4KGkuc2Nyb2xsSGVpZ2h0LCBjLnNjcm9sbEhlaWdodCwgaS5vZmZzZXRIZWlnaHQsIGMub2Zmc2V0SGVpZ2h0LCBpLmNsaWVudEhlaWdodCwgYy5jbGllbnRIZWlnaHQpOyBsID4gdCAmJiAodCA9IGwpOyB2YXIgdSA9IG4uc2Nyb2xsVG9wKCkgKyBuLndpblNpemUoKS5oZWlnaHQ7IHUgPiByICYmIChyID0gdSkgPiB0ICYmICh0ID0gciksIGUgJiYgY2xlYXJUaW1lb3V0KGUpLCBlID0gc2V0VGltZW91dChzLCBvKTsgfTsgcygpOyB9LCBnZXRNYXhTY3JvbGxEZXB0aDogZnVuY3Rpb24gKCkgeyByZXR1cm4gcjsgfSwgZ2V0TWF4RG9jdW1lbnRIZWlnaHQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHQ7IH0sIGFkZExpc3RlbmVyOiBmdW5jdGlvbiAoZSwgbiwgdCkgeyBcImZ1bmN0aW9uXCIgIT0gdHlwZW9mIHQgJiYgKHQgPSBmdW5jdGlvbiAoKSB7IHJldHVybiAhMDsgfSksIGEucHVzaCh7IGNhbGxiYWNrOiBlLCBwb3NpdGlvbjogbi5zY3JvbGxEZXB0aCwgbWVhc3VyZVR5cGU6IG4ubWVhc3VyZVR5cGUsIHJlcGVhdDogXCJvbmNlXCIsIGNvbnN1bWVFdmVudEZuOiB0IH0pLCBzKCksIHUoKTsgfSwgcmVtb3ZlTGlzdGVuZXJzOiBmdW5jdGlvbiAoKSB7IGEgPSBbXTsgfSwgY2xlYXJNYXhTY3JvbGxlZFBvc2l0aW9uOiBmdW5jdGlvbiAoKSB7IGkgPSAwOyB9IH07IH0oKTtcbiAgICBwbi5jb250YWluZXIucmVnaXN0ZXIoXCJzY3JvbGxEZXB0aFwiLCB7IHVzZVZhbHVlOiBZZSB9KSwgcG4uc2Nyb2xsRGVwdGggPSBwbi5jb250YWluZXIucmVzb2x2ZShcInNjcm9sbERlcHRoXCIpO1xuICAgIHZhciBLZSA9IGZ1bmN0aW9uICgpIHsgdmFyIGUsIG4gPSBwbi5jb250YWluZXIucmVzb2x2ZShcInV0aWxcIiksIHQgPSBwbi5jb250YWluZXIucmVzb2x2ZShcImpxVXRpbHNcIiksIHIgPSAhMSwgbyA9IFtdOyBmdW5jdGlvbiBpKCkgeyByIHx8IChyID0gITAsIHQub24oZG9jdW1lbnQsIFwibW91c2Vtb3ZlXCIsIChmdW5jdGlvbiAoKSB7IHJldHVybiBzKCk7IH0pKSwgdC5vbihkb2N1bWVudCwgXCJrZXlwcmVzc1wiLCAoZnVuY3Rpb24gKCkgeyByZXR1cm4gcygpOyB9KSksIHQub24od2luZG93LCBcInNjcm9sbFwiLCAoZnVuY3Rpb24gKCkgeyByZXR1cm4gcygpOyB9KSkpOyB9IGZ1bmN0aW9uIGEoKSB7IG8ubGVuZ3RoICYmIGZ1bmN0aW9uICgpIHsgZm9yICh2YXIgZSwgdCwgciA9IFtdLCBpID0gW10sIGEgPSBEYXRlLm5vdygpLCBzID0gMDsgcyA8IG8ubGVuZ3RoOyBzKyspXG4gICAgICAgIHQgPSAhMSwgYSAtIChlID0gb1tzXSkuc3RhcnRUaW1lID49IGUuaWRsZVRpbWUgJiYgKGUuY29uc3VtZUV2ZW50Rm4oKSA/IHQgPSAhMCA6IGUuc3RhcnRUaW1lID0gYSksIHQgPyByLnB1c2goZSkgOiBpLnB1c2goZSk7IHIubGVuZ3RoICYmIG4uZGVidWcoXCJpZGxlOiBydW4gZmlyZVwiKTsgbyA9IGk7IGZvciAocyA9IDA7IHMgPCByLmxlbmd0aDsgcysrKVxuICAgICAgICAoZSA9IHJbc10pLmNhbGxiYWNrKCk7IH0oKSwgZSAmJiBjbGVhclRpbWVvdXQoZSksIG8ubGVuZ3RoICYmIChlID0gc2V0VGltZW91dCgoZnVuY3Rpb24gKCkgeyByZXR1cm4gYSgpOyB9KSwgMjAwKSk7IH0gZnVuY3Rpb24gcygpIHsgZm9yICh2YXIgbiA9IERhdGUubm93KCksIHQgPSAwOyB0IDwgby5sZW5ndGg7IHQrKylcbiAgICAgICAgb1t0XS5zdGFydFRpbWUgPSBuOyBjbGVhclRpbWVvdXQoZSksIG8ubGVuZ3RoICYmIChlID0gc2V0VGltZW91dCgoZnVuY3Rpb24gKCkgeyByZXR1cm4gYSgpOyB9KSwgMjAwKSk7IH0gcmV0dXJuIHsgbmFtZTogXCJpZGxlXCIsIGluaXRpYWxpemU6IGksIGFkZExpc3RlbmVyOiBmdW5jdGlvbiAobiwgdCwgcikgeyBpKCksIFwiZnVuY3Rpb25cIiAhPSB0eXBlb2YgciAmJiAociA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuICEwOyB9KSwgby5wdXNoKHsgY2FsbGJhY2s6IG4sIGlkbGVUaW1lOiAxZTMgKiB0LCBzdGFydFRpbWU6IERhdGUubm93KCksIGNvbnN1bWVFdmVudEZuOiByIH0pLCBlIHx8IChlID0gc2V0VGltZW91dCgoZnVuY3Rpb24gKCkgeyByZXR1cm4gYSgpOyB9KSwgMjAwKSk7IH0sIHJlbW92ZUxpc3RlbmVyczogZnVuY3Rpb24gKCkgeyBvID0gW107IH0gfTsgfSgpO1xuICAgIHBuLmNvbnRhaW5lci5yZWdpc3RlcihcImlkbGVcIiwgeyB1c2VWYWx1ZTogS2UgfSksIHBuLmlkbGUgPSBwbi5jb250YWluZXIucmVzb2x2ZShcImlkbGVcIik7XG4gICAgdmFyIFplID0gZnVuY3Rpb24gKCkgeyB2YXIgZSA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwidXRpbFwiKSwgbiA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwianFVdGlsc1wiKSwgdCA9IFtdOyByZXR1cm4geyBuYW1lOiBcImludGVyYWN0aW9uXCIsIGJpbmQ6IGZ1bmN0aW9uIChyLCBvLCBpKSB7IHZhciBhID0gZnVuY3Rpb24gKGUpIHsgZm9yICh2YXIgbiA9IHsgY2xpY2s6IFwiY2xpY2tcIiwgZG91YmxlQ2xpY2s6IFwiZGJsY2xpY2tcIiwgcmlnaHRDbGljazogXCJjb250ZXh0bWVudVwiLCBtb3VzZU91dDogXCJtb3VzZW91dFwiLCBtb3VzZUluOiBcIm1vdXNlb3ZlclwiIH0sIHQgPSBbXSwgciA9IDA7IHIgPCBlLmxlbmd0aDsgcisrKSB7XG4gICAgICAgICAgICB2YXIgbyA9IGVbcl07XG4gICAgICAgICAgICB0LnB1c2gobltvXSk7XG4gICAgICAgIH0gcmV0dXJuIHQ7IH07IFwiZnVuY3Rpb25cIiAhPSB0eXBlb2YgaSAmJiAoaSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuICEwOyB9KSwgZS5fX3Byb3RlY3RlZF9fLmRvY3VtZW50UmVhZHkoKGZ1bmN0aW9uICgpIHsgZm9yICh2YXIgZSA9IDA7IGUgPCBvLmxlbmd0aDsgZSsrKSB7XG4gICAgICAgICAgICB2YXIgcyA9IG9bZV0sIGMgPSBhKHMuZWxlbWVudEFjdGlvbnMpLmpvaW4oXCIgXCIpLCBsID0gcy5lbGVtZW50U2VsZWN0b3IsIHUgPSBzLnJlcGV0aXRpdmU7XG4gICAgICAgICAgICBjLnRyaW0oKS5sZW5ndGggJiYgZnVuY3Rpb24gKGUsIG8sIGEpIHsgdmFyIHMgPSBmdW5jdGlvbiAoKSB7IGkoKSAmJiAoYSB8fCBuLnVuZGVsZWdhdGUoZG9jdW1lbnQuYm9keSwgZSksIHIoKSk7IH07IG4uZGVsZWdhdGUoZG9jdW1lbnQuYm9keSwgZSwgbywgcyksIHQucHVzaCh7IGFjdGlvbjogYywgc2VsZWN0b3I6IGwsIGZ1bmM6IHMgfSk7IH0obCwgYywgdSk7XG4gICAgICAgIH0gfSkpOyB9LCB1bmJpbmRBbGw6IGZ1bmN0aW9uICgpIHsgdC5mb3JFYWNoKChmdW5jdGlvbiAoZSkgeyBuLnVuZGVsZWdhdGUoZG9jdW1lbnQuYm9keSwgZS5zZWxlY3Rvcik7IH0pKSwgdCA9IFtdOyB9IH07IH0oKTtcbiAgICBwbi5jb250YWluZXIucmVnaXN0ZXIoXCJpbnRlcmFjdGlvblwiLCB7IHVzZVZhbHVlOiBaZSB9KSwgcG4uaW50ZXJhY3Rpb24gPSBwbi5jb250YWluZXIucmVzb2x2ZShcImludGVyYWN0aW9uXCIpO1xuICAgIHZhciBlbiA9IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSBwbi5jb250YWluZXIucmVzb2x2ZShcImpxVXRpbHNcIiksIG4gPSBwbi5jb250YWluZXIucmVzb2x2ZShcInV0aWxcIiksIHQgPSBwbi5jb250YWluZXIucmVzb2x2ZShcImNvbnRhaW5lclV0aWxzXCIpLCByID0gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIFwiaW5saW5lXCIgPT09IGUuZGlzcGxheU1vZGU7IH0sIG8gPSBmdW5jdGlvbiAoZSkgeyByZXR1cm4gXCJtb2RhbFwiID09PSBlLmRpc3BsYXlNb2RlOyB9OyByZXR1cm4geyBuYW1lOiBcInJlY1dpZGdldFNlcnZpY2VcIiwgX19wcm90ZWN0ZWRfXzogeyBnZXRJbnN0YW5jZTogZnVuY3Rpb24gKCkgeyB2YXIgaSwgYSA9IFtdOyBmdW5jdGlvbiBzKG4pIHsgdmFyIHMgPSBuIHx8IHt9LCBjID0gcy53aWRnZXQgfHwge307IHIoYy5jb25maWcpID8gZS5lbXB0eShjLmNvbnRhaW5lcikgOiBvKGMuY29uZmlnKSAmJiAoIWZ1bmN0aW9uIChuKSB7IGlmICghaSlcbiAgICAgICAgICAgICAgICByZXR1cm47IHQuY2xvc2VNb2RhbChpKSwgZS5lbXB0eShpLmNvbnRhaW5lcik7IHZhciByID0gdC5fX3ByaXZhdGVfXy5tb2JpbGVNb2RhbEZpeDsgci5pc0lwaG9uZUNhcmV0Rml4ZWQgJiYgci5tb2RhbENsb3NlZCgpOyBpID0gbnVsbDsgfSgpLCBlLnJlbW92ZShjLmNvbnRhaW5lcikpLCAhcy5za2lwT25jbG9zZSAmJiBlLmlzRnVuY3Rpb24oYy5vbmNsb3NlKSAmJiBjLm9uY2xvc2UoKSwgYSA9IGEuZmlsdGVyKChmdW5jdGlvbiAoZSkgeyByZXR1cm4gZS51dWlkICE9PSBjLnV1aWQ7IH0pKTsgfSBmdW5jdGlvbiBjKGUpIHsgcmV0dXJuIGEuZmlsdGVyKChmdW5jdGlvbiAobikgeyByZXR1cm4gZSA9PT0gbi53aWRnZXRJZDsgfSkpWzBdOyB9IHJldHVybiB7IHNob3dSZWNvbW1lbmRhdGlvbjogZnVuY3Rpb24gKGwpIHsgdmFyIHUgPSBsLndpZGdldENvbmZpZyB8fCB7fSwgZCA9IGwuY3JlYXRlUGxhY2Vob2xkZXJGbiwgcCA9IHUud2lkZ2V0SWQ7IGlmICghcClcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwid2lkZ2V0SWQgc2hvdWxkIGJlIHNwZWNpZmllZFwiKTsgaWYgKGMocCkpXG4gICAgICAgICAgICAgICAgICAgIG4ubG9nKFwid2lkZ2V0IHdpdGggaWQgXCIgKyB1LndpZGdldElkICsgXCIgYWxyZWFkeSBpbml0aWFsaXplXCIpO1xuICAgICAgICAgICAgICAgIGVsc2UgaWYgKG8odSkgJiYgaSlcbiAgICAgICAgICAgICAgICAgICAgbi5sb2coXCJtb2RhbCB3aWRnZXQgYWxyZWFkeSBzaG93blwiKTtcbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGYgPSBmdW5jdGlvbiAodCkgeyB2YXIgciA9IGUucXVlcnlFbCh0LmNvbnRhaW5lclNlbGVjdG9yKSwgbyA9IFwid2lkZ2V0LWlkLVwiICsgbi5yYW5kb21TdHJpbmcoKSwgaSA9IHsgc2luZ2xlQ29udGFpbmVyOiByIHx8IHZvaWQgMCwgZGlzcGxheU1vZGU6IHQuZGlzcGxheU1vZGUgfHwgXCJtb2RhbFwiLCBzaG93Q2xvc2VCdXR0b246IHQuc2hvd0Nsb3NlQnV0dG9uLCBpZnJhbWVQYXJhbXM6IHsgaWZyYW1lSWQ6IG8sIGNvbnRhaW5lclNlbGVjdG9yOiB0LmNvbnRhaW5lclNlbGVjdG9yLCB3aWR0aDogdC53aWR0aCwgaGVpZ2h0OiB0LmhlaWdodCB9IH07IHJldHVybiB7IHV1aWQ6IG8sIHdpZGdldElkOiB0LndpZGdldElkLCBwbGFjZWhvbGRlcjogdC5wbGFjZWhvbGRlciwgdHJhY2tpbmdJZDogdC50cmFja2luZ0lkLCBjb25maWc6IGkgfTsgfSh1KSwgbSA9IGYuY29uZmlnLCBnID0gZCgpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZi5jb250YWluZXIgPSBmdW5jdGlvbiAoZSwgbikgeyB2YXIgaTsgcmV0dXJuIHIoZSkgPyBpID0gdC5pbml0SW5saW5lQ29udGFpbmVyKGUpLmNvbnRhaW5lciA6IG8oZSkgJiYgKGkgPSB0LmdldE1vZGFsQ29udGFpbmVyKGUsIChmdW5jdGlvbiAoKSB7IG4gaW5zdGFuY2VvZiBGdW5jdGlvbiAmJiBuKCk7IH0pKSksIGk7IH0obSwgKGZ1bmN0aW9uICgpIHsgcyh7IHdpZGdldDogZiB9KTsgfSkpLCBmLmNvbnRhaW5lcilcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBlLmFwcGVuZChmLmNvbnRhaW5lciwgZyksIGYuZWxlbWVudCA9IGcsIG8obSkgJiYgKGkgPSBmLCAobi5pc0lwaG9uZSgpIHx8IG4uaXNTYWZhcmlPcklPc1VpV2ViVmlldygpIHx8IG4uaXNBbmRyb2lkKCkpICYmIHQuX19wcml2YXRlX18ubW9iaWxlTW9kYWxGaXgubW9kYWxPcGVuZWQoKSksIGZ1bmN0aW9uIChuLCB0KSB7IHZvaWQgMCA9PT0gdCAmJiAodCA9IHt9KSwgT2JqZWN0LmtleXModCkuZm9yRWFjaCgoZnVuY3Rpb24gKHIpIHsgZS5pc0Z1bmN0aW9uKHRbcl0pICYmIChuW3JdID0gdFtyXShuKSk7IH0pKTsgfShmLCBsLndpZGdldENhbGxiYWNrcyksIGEucHVzaChmKSwgZjtcbiAgICAgICAgICAgICAgICAgICAgbi5sb2coJ3dpZGdldCBoYXMgaW52YWxpZCBzZWxlY3RvciBcIicgKyBtLmlmcmFtZVBhcmFtcy5jb250YWluZXJTZWxlY3RvciArICdcIicpO1xuICAgICAgICAgICAgICAgIH0gfSwgZmlyZVdpZGdldENhbGxiYWNrOiBmdW5jdGlvbiAobiwgdCwgcikgeyBhLmZvckVhY2goKGZ1bmN0aW9uIChvKSB7IGlmIChvLndpZGdldElkID09PSB0LnRvU3RyaW5nKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGkgPSBvW1wib25cIiArIG5dO1xuICAgICAgICAgICAgICAgICAgICBlLmlzRnVuY3Rpb24oaSkgJiYgaShyKTtcbiAgICAgICAgICAgICAgICB9IH0pKTsgfSwgZmluZFdpZGdldDogYywgY2xlYXJXaWRnZXRzOiBmdW5jdGlvbiAoKSB7IGEgPSBbXSwgaSA9IG51bGw7IH0sIGNsb3NlV2lkZ2V0OiBzLCBmaXhXaWRnZXRNb2RhbFdpZHRoOiBmdW5jdGlvbiAobiwgcikgeyBpZiAoIW4gfHwgbyhuLmNvbmZpZykpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGkgPSBuLmNvbnRhaW5lciwgYSA9IHIgPyBlLnF1ZXJ5RWwoXCJpZnJhbWVcIiwgaSkgOiBlLnF1ZXJ5RWwoXCIudHAtd2lkZ2V0LXBsYWNlaG9sZGVyXCIsIGkpO1xuICAgICAgICAgICAgICAgICAgICB0LmNoZWNrQmFja2Ryb3BBbmRDb250YWluZXIobiwgITAsICEwKSwgc2V0VGltZW91dCgoZnVuY3Rpb24gKCkgeyBhICYmIHQuX19wcm90ZWN0ZWRfXy5zZXRFbGVtZW50U2l6ZXMoaSwgeyB3aWR0aDogZS5nZXRXaWR0aChhKSB9KTsgfSksIDEwMCk7XG4gICAgICAgICAgICAgICAgfSB9IH07IH0sIGluc2VydFdpZGdldExpYjogZnVuY3Rpb24gKG4pIHsgdmFyIHQgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZShcInNjcmlwdFwiKVswXSwgciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzY3JpcHRcIik7IG4uaWQgJiYgci5zZXRBdHRyaWJ1dGUoXCJpZFwiLCBuLmlkKSwgZS5pc0Z1bmN0aW9uKG4ub25lcnJvcikgJiYgKHIub25lcnJvciA9IG4ub25lcnJvciksIGUuaXNGdW5jdGlvbihuLm9ubG9hZCkgJiYgKHIub25sb2FkID0gbi5vbmxvYWQpLCBuLmRlZmVyICYmIChyLmRlZmVyID0gITApLCByLnR5cGUgPSBcInRleHQvamF2YXNjcmlwdFwiLCByLnNyYyA9IG4uc3JjLCB0ICYmIHQucGFyZW50Tm9kZSAmJiB0LnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHIsIHQpOyB9IH0gfTsgfSgpO1xuICAgIHBuLmNvbnRhaW5lci5yZWdpc3RlcihcInJlY1dpZGdldFNlcnZpY2VcIiwgeyB1c2VWYWx1ZTogZW4gfSksIHBuLnJlY1dpZGdldFNlcnZpY2UgPSBwbi5jb250YWluZXIucmVzb2x2ZShcInJlY1dpZGdldFNlcnZpY2VcIik7XG4gICAgdmFyIG5uID0gZnVuY3Rpb24gKCkgeyBwbi5jb250YWluZXIucmVzb2x2ZShcInByZWRlZmluZWRPcHRpb25zXCIpOyByZXR1cm4geyB0ZXN0UGlhbm9PcHRpb246IFwiXCIgfTsgfSgpO1xuICAgIHBuLmNvbnRhaW5lci5yZWdpc3RlcihcInBpYW5vXCIsIHsgdXNlVmFsdWU6IG5uIH0pO1xuICAgIHZhciB0biA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwicGlhbm9cIik7XG4gICAgZm9yICh2YXIgcm4gaW4gdG4pXG4gICAgICAgIHBuW3JuXSA9IHRuW3JuXTtcbiAgICB2YXIgb24gPSBmdW5jdGlvbiAoZSkgeyB2b2lkIDAgPT09IGUgJiYgKGUgPSBwbi5jb250YWluZXIpOyB2YXIgbiA9IGUucmVzb2x2ZShcInV0aWxcIiksIHQgPSBlLnJlc29sdmUoXCJsb2dcIiksIHIgPSBlLnJlc29sdmUoXCJ1c2VyXCIpOyBlLnJlc29sdmUoXCJhcGlcIik7IHZhciBvLCBpID0gZS5yZXNvbHZlKFwianFVdGlsc1wiKSwgYSA9IGUucmVzb2x2ZShcInJlY1dpZGdldFNlcnZpY2VcIiksIHMgPSBcIl9fcG5tbFwiLCBjID0gXCJFWFRFUk5BTF9FVkVOVFwiLCBsID0geyBncmFudGVkOiBcIkFMTE9XRURcIiwgZGVmYXVsdDogXCJVTktOT1dOXCIsIGRlbmllZDogXCJGT1JCSURERU5cIiB9LCB1ID0gYS5fX3Byb3RlY3RlZF9fLmdldEluc3RhbmNlKCk7IGZ1bmN0aW9uIGQoKSB7IHJldHVybiBvIHx8IChvID0gbmV3IFByb21pc2UoKGZ1bmN0aW9uIChlLCB0KSB7IHZhciByID0gd2luZG93LlBpYW5vRVNQQ29uZmlnIHx8IHt9OyByLmlkID8gKE9iamVjdC5hc3NpZ24ociwgeyBvbmxvYWQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGUobnVsbCk7IH0sIHdpZGdldF9pbml0X29uX2V2ZW50OiB7IHJlYzogITAsIFwib3B0LWluXCI6ICExIH0sIG9uY2xpY2s6IGZ1bmN0aW9uIChlKSB7IHUuZmlyZVdpZGdldENhbGxiYWNrKFwiY2xpY2tcIiwgZS53aWRnZXRJZCwgZSk7IH0sIG9ud2lkZ2V0aW5pdDogZnVuY3Rpb24gKGUpIHsgdS5maXJlV2lkZ2V0Q2FsbGJhY2soXCJpbml0XCIsIGUud2lkZ2V0SWQsIGUpOyB9LCBvbnJlY3Nsb2FkZWQ6IGZ1bmN0aW9uIChlKSB7IHUuZmlyZVdpZGdldENhbGxiYWNrKFwicmVjc2xvYWRlZFwiLCBlLndpZGdldElkLCBlKTsgfSB9KSwgd2luZG93LlBpYW5vRVNQQ29uZmlnID0gciwgbi5kZWJ1ZyhcInBpYW5vRVNQOiBsb2FkaW5nIFBpYW5vRVNQIHdpdGggY29uZmlnOlwiLCB3aW5kb3cuUGlhbm9FU1BDb25maWcpLCBhLl9fcHJvdGVjdGVkX18uaW5zZXJ0V2lkZ2V0TGliKHsgaWQ6IFwicG5lc3BsdWNpZHNka3NlbFwiLCBzcmM6IHAoKSArIFwiL3B1YmxpYy9zZGsvdjA0L3Nkay5qcz92PVwiICsgKGxvY2FsU3RvcmFnZSAmJiBsb2NhbFN0b3JhZ2UubHVjaWRzZGt2ZXIgfHwgXCJ4eHhcIiksIG9uZXJyb3I6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHQoKTsgfSB9KSkgOiB0KCk7IH0pKSk7IH0gc2V0VGltZW91dCgoZnVuY3Rpb24gKCkgeyBwbi5hZGRIYW5kbGVyKFwibG9nb3V0XCIsIChmdW5jdGlvbiAoKSB7IG0oW10pOyB9KSk7IHZhciBlID0gci5nZXRQcm92aWRlcigpOyBlLnJlZ2lzdGVyQ2FsbGJhY2sgJiYgZS5yZWdpc3RlckNhbGxiYWNrKFwibG9nb3V0XCIsIChmdW5jdGlvbiAoKSB7IG0oW10pOyB9KSk7IH0pLCAzMDApOyB2YXIgcCA9IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSBcIi8vYXBpLWVzcC5waWFuby5pb1wiOyByZXR1cm4gcG4uZXNwRW5kcG9pbnQgPyBlID0gcG4uZXNwRW5kcG9pbnQgOiBwbi5pc1NhbmRib3goKSAmJiAoZSA9IFwiLy9zYW5kYm94LWFwaS1lc3AucGlhbm8uaW9cIiksIGU7IH0sIGYgPSBmdW5jdGlvbiAoZSwgcikgeyBkKCkudGhlbigoZnVuY3Rpb24gKCkgeyB3aW5kb3cuUGlhbm9FU1AuZ2V0Q3VycmVudFB1c2hTdGF0ZSgpLnRoZW4oKGZ1bmN0aW9uIChlKSB7IFwicHJvbXB0XCIgPT09IGUgJiYgdC5sb2dNaWNyb0NvbnZlcnNpb24ociwgXCJzaG93UHJvbXB0XCIpOyB9KSksIHdpbmRvdy5QaWFub0VTUC5zdWJzY3JpYmVUb1B1c2hTcXVhZHMoW2VdKS50aGVuKChmdW5jdGlvbiAobykgeyB2YXIgaSA9IG8gfHwge307ICEwID09PSBpLnJlc3VsdCA/IChuLnNldFB1c2hMaXN0c0Nvb2tpZShlKSwgbi5kZWJ1ZyhcInBpYW5vRVNQOiBQdXNoIG5vdGlmaWNhdGlvbiB3YXMgc2V0OlwiLCBpKSwgdC5sb2dNaWNyb0NvbnZlcnNpb24ociwgXCJlbnJvbGxQdXNoQ2FtcGFpZ25cIikpIDogITEgPT09IGkucmVzdWx0ICYmIChcImNsb3NlZFwiID09PSBpLnJlYXNvbiA/IHQubG9nTWljcm9Db252ZXJzaW9uKHIsIFwiY2xvc2VQcm9tcHRcIikgOiB0LmxvZ01pY3JvQ29udmVyc2lvbihyLCBcImRlY2xpbmVFbnJvbGxQdXNoQ2FtcGFpZ25cIikpOyB9KSkuY2F0Y2goKGZ1bmN0aW9uIChlKSB7IG4ubG9nKFwicGlhbm9FU1A6IFB1c2ggbm90aWZpY2F0aW9uIGVycm9yOlwiLCBlKTsgfSkpOyB9KSk7IH0sIG0gPSBmdW5jdGlvbiAoZSkgeyB0cnkge1xuICAgICAgICB2YXIgdCA9IEpTT04uc3RyaW5naWZ5KGUpO1xuICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShzLCB0KTtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgbi5kZWJ1ZyhcImNhbid0IHNhdmUgbWFpbGluZyBsaXN0cyB0byBzdG9yYWdlXCIsIGUpO1xuICAgIH0gfSwgZyA9IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSBbXTsgdHJ5IHtcbiAgICAgICAgdmFyIHQgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShzKTtcbiAgICAgICAgaWYgKCF0KVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTUFJTkxJTkdfTElTVCBzaG91bGQgYmUgYXJyYXlcIik7XG4gICAgICAgIGlmIChlID0gSlNPTi5wYXJzZSh0KSwgIUFycmF5LmlzQXJyYXkoZSkpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJNQUlOTElOR19MSVNUIHNob3VsZCBiZSBhcnJheVwiKTtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgbi5kZWJ1ZyhcImNhbid0IGxvYWQgbWFpbGluZyBsaXN0cyBmcm9tIHN0b3JhZ2VcIiwgZSk7XG4gICAgfSByZXR1cm4gZSB8fCBbXTsgfTsgdmFyIHYgPSBmdW5jdGlvbiAoZSkgeyByZXR1cm4gZnVuY3Rpb24gKCkgeyB2YXIgbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJwbmVzcHdndHBsYWNlaG9sZGVyXCIpOyByZXR1cm4gaS5zZXRBdHRyKFwiaG9sZGVybmFtZVwiLCBlLCBuKSwgbjsgfTsgfTsgZnVuY3Rpb24gaCgpIHsgcmV0dXJuIHsgb25yZWNzbG9hZGVkOiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gZnVuY3Rpb24gKHIpIHsgMCAhPT0gci5jb3VudE9mUmVjcyA/ICh1LmZpeFdpZGdldE1vZGFsV2lkdGgoZSwgITApLCB0LmxvZ0VzcE1pY3JvQ29udmVyc2lvbihlLnRyYWNraW5nSWQsIGUud2lkZ2V0SWQsIFwiaW5pdFwiLCBjKSwgbi5kZWJ1ZyhcImNyZWF0aW5nIHJlY29tbWVuZGF0aW9uIHdpZGdldDogXCIsIGUuY29uZmlnKSkgOiB1LmNsb3NlV2lkZ2V0KHsgd2lkZ2V0OiBlLCBza2lwT25jbG9zZTogITAgfSk7IH07IH0sIG9uY2xpY2s6IGZ1bmN0aW9uIChlKSB7IHJldHVybiBmdW5jdGlvbiAobikgeyB2YXIgciA9IHsgaHJlZjogbi51cmwgfTsgdC5sb2dFc3BNaWNyb0NvbnZlcnNpb24oZS50cmFja2luZ0lkLCBlLndpZGdldElkLCBcImNsaWNrXCIsIFwiRVhURVJOQUxfTElOS1wiLCByKTsgfTsgfSwgb25jbG9zZTogZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGZ1bmN0aW9uICgpIHsgdC5sb2dFc3BNaWNyb0NvbnZlcnNpb24oZS50cmFja2luZ0lkLCBlLndpZGdldElkLCBcImNsb3NlXCIsIGMsIHsgZXZlbnQ6IFwid2lkZ2V0Q2xvc2VkXCIgfSk7IH07IH0gfTsgfSByZXR1cm4geyBuYW1lOiBcInBpYW5vRXNwXCIsIF9fcHJvdGVjdGVkX186IHsgaW5pdDogZCwgc2V0VmlzaXRvcklkOiBmdW5jdGlvbiAoZSkgeyB3aW5kb3cuUGlhbm9FU1BDb25maWcgPSBPYmplY3QuYXNzaWduKHt9LCB3aW5kb3cuUGlhbm9FU1BDb25maWcsIHsgdmlzaXRvcjogZSB9KTsgfSwgc2hvd1JlY29tbWVuZGF0aW9uOiBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IGgoKTsgcmV0dXJuIHUuc2hvd1JlY29tbWVuZGF0aW9uKHsgd2lkZ2V0Q29uZmlnOiBlLCB3aWRnZXRDYWxsYmFja3M6IG4sIGNyZWF0ZVBsYWNlaG9sZGVyRm46IHYoZS5wbGFjZWhvbGRlcikgfSksIGQoKS50aGVuKChmdW5jdGlvbiAoKSB7IHdpbmRvdy5QaWFub0VTUC5pbml0V2lkZ2V0KHBhcnNlSW50KGUud2lkZ2V0SWQpKTsgfSkpOyB9LCBzaG93UHVzaFNpZ251cDogZnVuY3Rpb24gKGUpIHsgdmFyIG4gPSBlIHx8IHt9OyBuLnRlbXBsYXRlSWQgPyAodC5fX3Byb3RlY3RlZF9fLmxvZ0N1c3RvbUZvcm1JbXByZXNzaW9uKG4udHJhY2tpbmdJZCwgXCJwdXNoU2lnbnVwXCIsIFwic2hvd19mb3JtXCIpLCBwbi50ZW1wbGF0ZS5zaG93KHsgdGVtcGxhdGVJZDogbi50ZW1wbGF0ZUlkLCB0ZW1wbGF0ZVZhcmlhbnRJZDogbi50ZW1wbGF0ZVZhcmlhbnRJZCwgZGlzcGxheU1vZGU6IFwibW9kYWxcIiwgY3VzdG9tRXZlbnQ6IGZ1bmN0aW9uIChlKSB7IHN3aXRjaCAoZS5ldmVudE5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcInB1c2gtYWxsb3dcIjpcbiAgICAgICAgICAgICAgICAgICAgICAgIHQubG9nTWljcm9Db252ZXJzaW9uKG4udHJhY2tpbmdJZCwgXCJhbGxvd1NvZnRFbnJvbGxQdXNoQ2FtcGFpZ25cIiksIGYobi5wdXNoTGlzdElkLCBuLnRyYWNraW5nSWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJwdXNoLWRvbnQtYWxsb3dcIjpcbiAgICAgICAgICAgICAgICAgICAgICAgIHQubG9nTWljcm9Db252ZXJzaW9uKG4udHJhY2tpbmdJZCwgXCJkZWNsaW5lU29mdEVucm9sbFB1c2hDYW1wYWlnblwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwicHVzaC1jbG9zZVwiOiB0LmxvZ01pY3JvQ29udmVyc2lvbihuLnRyYWNraW5nSWQsIFwiY2xvc2VcIik7XG4gICAgICAgICAgICAgICAgfSB9IH0pKSA6IGYobi5wdXNoTGlzdElkLCBuLnRyYWNraW5nSWQpOyB9LCBnZXROb3RpZmljYXRpb25TdGF0dXM6IGZ1bmN0aW9uICgpIHsgaWYgKHdpbmRvdy5Ob3RpZmljYXRpb24pXG4gICAgICAgICAgICAgICAgcmV0dXJuIGxbd2luZG93Lk5vdGlmaWNhdGlvbi5wZXJtaXNzaW9uXSB8fCBsLmRlZmF1bHQ7IH0sIHNob3dOZXdzbGV0dGVyU2lnbnVwOiBmdW5jdGlvbiAoZSkgeyBpZiAoZSAmJiBlLm1haWxpbmdMaXN0SWRzKSB7XG4gICAgICAgICAgICAgICAgdmFyIHQgPSBnKCkuaW5kZXhPZihlLm1haWxpbmdMaXN0SWRzKSA+IC0xO1xuICAgICAgICAgICAgICAgIGUubm90U2hvd0lmRmlsbGVkICYmIHQgPyBuLmxvZyhcIk1haWxpbmcgbGlzdCB3aXRoIGlkcyBcIiArIGUubWFpbGluZ0xpc3RJZHMgKyBcIiBhbHJlYWR5IHNob3duXCIpIDogcG4udGVtcGxhdGUuc2hvdyhlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICBuLmxvZyhcIm1haWxpbmdMaXN0SWRzIHNob3VsZCBiZSBzcGVjaWZpZWRcIik7IH0sIG9mZmVyTWVzc2FnZVJlY2VpdmVyOiBmdW5jdGlvbiAoZSkgeyBpZiAoXCJuZXdzbGV0dGVyU2lnbnVwU3VibWlzc2lvblwiID09PSBlLmV2ZW50KSB7XG4gICAgICAgICAgICAgICAgdmFyIG4gPSBnKCk7XG4gICAgICAgICAgICAgICAgLTEgPT09IG4uaW5kZXhPZihlLnBhcmFtcy5tYWlsaW5nTGlzdElkcykgJiYgKG4ucHVzaChlLnBhcmFtcy5tYWlsaW5nTGlzdElkcyksIG0obikpO1xuICAgICAgICAgICAgfSB9LCBsb2FkQ29tcGxldGVNYWlsaW5nTGlzdHM6IGcgfSwgX19wcml2YXRlX186IHsgcmVtb3ZlV2lkZ2V0c0FuZFNkazogZnVuY3Rpb24gKCkgeyB1LmNsZWFyV2lkZ2V0cygpLCBvID0gbnVsbCwgZGVsZXRlIHdpbmRvdy5QaWFub0VTUDsgfSwgZ2V0V2lkZ2V0Q2FsbGJhY2tzOiBoLCBvbkluaXQ6IGZ1bmN0aW9uIChlKSB7IG8gJiYgXCJmdW5jdGlvblwiID09IHR5cGVvZiBlICYmIG8udGhlbihlKTsgfSB9IH07IH07XG4gICAgcG4uY29udGFpbmVyLnJlZ2lzdGVyKFwicGlhbm9Fc3BcIiwgeyB1c2VWYWx1ZTogb24oKSB9KSwgcG4ucGlhbm9Fc3AgPSBwbi5jb250YWluZXIucmVzb2x2ZShcInBpYW5vRXNwXCIpO1xuICAgIHZhciBhbiA9IGZ1bmN0aW9uICgpIHsgdmFyIGUsIG4gPSBwbi5jb250YWluZXIucmVzb2x2ZShcInBvc3RtZXNzYWdlXCIpLCB0ID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJ1c2VyXCIpLCByID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJ1dGlsXCIpLCBvID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJldmVudFV0aWxzXCIpLCBpID0gXCJleHRlcm5hbENoZWNrb3V0Q29tcGxldGVcIiwgYSA9IFwibG9naW5Qcm9tcHRcIiwgcyA9IFwiZGVmZXJyZWRBY2NvdW50Q3JlYXRpb25cIiwgYyA9IFwiYnV5XCIsIGwgPSBvLmNyZWF0ZUV2ZW50TWFuYWdlcihbaV0pLCB1ID0gITEsIGQgPSAhMTsgd2luZG93LlNXRyA9IHdpbmRvdy5TV0cgfHwgW10sIHdpbmRvdy5TV0cucHVzaCgoZnVuY3Rpb24gKG4pIHsgbi5zZXRPblBheW1lbnRSZXNwb25zZSgoZnVuY3Rpb24gKG4pIHsgZCB8fCAoci5kZWJ1ZyhcInN3Zzogb25QYXltZW50UmVzcG9uc2UgaXMgdHJpZ2dlcmVkXCIpLCBkID0gITAsIG4udGhlbigoZnVuY3Rpb24gKG4pIHsgci5kZWJ1ZyhcInN3Zzogb25QYXltZW50UmVzcG9uc2VcIiwgbiksIGUgJiYgZyhuLCBuLnB1cmNoYXNlRGF0YSwgbi51c2VyRGF0YSwgZSwgYyk7IH0pKS5jYXRjaCgoZnVuY3Rpb24gKGUpIHsgci5sb2coXCJzd2c6IG9uUGF5bWVudFJlc3BvbnNlIGZhaWxlZFwiLCBlKTsgfSkpKTsgfSkpOyB9KSksIG4uc3Vic2NyaWJlKFwic3dnQ2hlY2tvdXRTdGFydFwiLCAoZnVuY3Rpb24gKG4pIHsgdSB8fCByLmxvZyhcInN3ZzogaW5jb3JyZWN0IFN3RyBjb25maWd1cmF0aW9uLiBQbGVhc2UgbWFrZSBzdXJlIHRoYXQgRXhwZXJpZW5jZSB1c2VyIHNlZ21lbnQgaXMgY29uZmlndXJlZCBwcm9wZXJseS4gRGV0YWlscyBhdCBodHRwczovL2RvY3MucGlhbm8uaW8vc3Vic2NyaWJlLXdpdGgtZ29vZ2xlLyNTd0dzY3JpcHRcIik7IHZhciB0ID0gbi5wYXJhbXMuc2t1OyBlID0gbi5wYXJhbXMudGVybUlkLCB3aW5kb3cuU1dHLnB1c2goKGZ1bmN0aW9uIChlKSB7IGUuc3Vic2NyaWJlKHQpOyB9KSk7IH0pKTsgdmFyIHAgPSBmdW5jdGlvbiAoZSkgeyBpZiAobC5oYXNDYWxsYmFjayhpKSkge1xuICAgICAgICB2YXIgbiA9IHsgdHlwZTogXCJzd2dcIiwgZmxvdzogZSB9O1xuICAgICAgICBsLmZpcmVDYWxsYmFja3MoaSwgbiwgdm9pZCAwLCAhMCk7XG4gICAgfSB9LCBmID0gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIG5ldyBQcm9taXNlKChmdW5jdGlvbiAobiwgdCkgeyBwbi5hcGkuY2FsbEFwaShcIi9zd2cvY2hlY2tcIiwgeyBlbnRpdGxlbWVudDogSlNPTi5zdHJpbmdpZnkoZSkgfSwgKGZ1bmN0aW9uIChlKSB7IDAgIT09IGUuY29kZSAmJiAoci5sb2coXCJzd2c6IGNoZWNrIHN1YnNjcmlwdGlvbiByZXNwb25zZSAtIFwiICsgZS5tZXNzYWdlKSwgdCgpKSwgbihlLkNoZWNrU3Vic2NyaXB0aW9uUmVzcG9uc2UpOyB9KSk7IH0pKTsgfSwgbSA9IGZ1bmN0aW9uIChlKSB7IHJldHVybiBuZXcgUHJvbWlzZSgoZnVuY3Rpb24gKG4sIHQpIHsgcG4uYXBpLmNhbGxBcGkoXCIvc3dnL2NoZWNrL2V4dGVybmFsXCIsIHsgZW50aXRsZW1lbnRzOiBKU09OLnN0cmluZ2lmeShlKSB9LCAoZnVuY3Rpb24gKGUpIHsgMCAhPT0gZS5jb2RlICYmIChyLmxvZyhcInN3ZzogY2hlY2sgZXh0ZXJuYWwgZW50aXRsZW1lbnQgcmVzcG9uc2UgLSBcIiArIGUubWVzc2FnZSksIHQoKSk7IHZhciBvID0gZS5kYXRhOyBvIHx8IChyLmxvZyhcInN3ZzogY2hlY2sgZXh0ZXJuYWwgZW50aXRsZW1lbnQgZW1wdHkgcmVzcG9uc2VcIiksIHQoKSksIG4obyk7IH0pKTsgfSkpOyB9LCBnID0gZnVuY3Rpb24gKGUsIHQsIG8sIGksIGEpIHsgcG4uYXBpLmNhbGxBcGkoXCIvc3dnL3N1YnNjcmliZVwiLCB7IHRlcm1faWQ6IGksIHB1cmNoYXNlX2RhdGE6IEpTT04uc3RyaW5naWZ5KHQpLCB1c2VyX2RhdGE6IEpTT04uc3RyaW5naWZ5KG8pIH0sIChmdW5jdGlvbiAodCkgeyBpZiAoMCA9PT0gdC5jb2RlKSB7XG4gICAgICAgIHZhciBvID0gdC5kYXRhO1xuICAgICAgICB2KG8pLCBuLmJyb2FkY2FzdChcInN3Z0NoZWNrb3V0Q29tcGxldGVcIiksIGUuY29tcGxldGUoKS50aGVuKChmdW5jdGlvbiAoKSB7IHAoYSk7IH0pKS5jYXRjaCgoZnVuY3Rpb24gKGUpIHsgci5sb2coXCJzd2c6IGNvbXBsZXRlIGZhaWxlZDpcIiwgZSk7IH0pKTtcbiAgICB9XG4gICAgZWxzZVxuICAgICAgICByLmxvZyhcInN3Zzogc3Vic2NyaWJlIHJlc3BvbnNlIC0gXCIgKyB0Lm1lc3NhZ2UpOyB9KSk7IH0sIHYgPSBmdW5jdGlvbiAoZSkgeyBlICYmIHQuZ2V0UHJvdmlkZXIoKS5sb2dpbkJ5VG9rZW4gJiYgdC5nZXRQcm92aWRlcigpLmxvZ2luQnlUb2tlbihlKTsgfSwgaCA9ICExLCB3ID0gITE7IHJldHVybiB7IG5hbWU6IFwic3dnXCIsIF9fcHJvdGVjdGVkX186IHsgaW5qZWN0TWFya3VwOiBmdW5jdGlvbiAoZSkgeyB2YXIgbjsgaWYgKCFoICYmIGUpIHtcbiAgICAgICAgICAgICAgICByLmRlYnVnKFwic3dnOiByZW5kZXJpbmcgc3dnIG1hcmt1cCB3aXRoIGNvbmZpZzpcIiwgZSk7XG4gICAgICAgICAgICAgICAgdmFyIHQgPSAne1xcbiAgIFwiQGNvbnRleHRcIjogXCJodHRwOi8vc2NoZW1hLm9yZ1wiLFxcbiAgIFwiQHR5cGVcIjogXCJDcmVhdGl2ZVdvcmtcIixcXG4gICBcImlzQWNjZXNzaWJsZUZvckZyZWVcIjogJyArIGUuaXNBY2Nlc3NpYmxlRm9yRnJlZTtcbiAgICAgICAgICAgICAgICAhMSA9PT0gZS5pc0FjY2Vzc2libGVGb3JGcmVlICYmIGUucHJvZHVjdElkICYmICh0ID0gdCArICcsXFxuICAgXCJpc1BhcnRPZlwiOiB7XFxuICAgICAgIFwiQHR5cGVcIjogW1wiQ3JlYXRpdmVXb3JrXCIsIFwiUHJvZHVjdFwiXSxcXG4gICAgICAgXCJuYW1lXCIgOiBcIicgKyBlLnJlc291cmNlTmFtZSArICdcIixcXG4gICAgICAgXCJwcm9kdWN0SURcIjogXCInICsgZS5wcm9kdWN0SWQgKyAnXCJcXG4gICB9JyksIHQgKz0gXCJcXG59XCI7XG4gICAgICAgICAgICAgICAgdmFyIG8gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic2NyaXB0XCIpO1xuICAgICAgICAgICAgICAgIG8udHlwZSA9IFwiYXBwbGljYXRpb24vbGQranNvblwiLCBvLmlubmVySFRNTCA9IHQsIG51bGwgPT09IChuID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJzY3JpcHRcIilbMF0ucGFyZW50Tm9kZSkgfHwgdm9pZCAwID09PSBuIHx8IG4uYXBwZW5kQ2hpbGQobyksIGggPSAhMDtcbiAgICAgICAgICAgIH0gfSwgYWRkTGlicmFyeTogZnVuY3Rpb24gKCkgeyB2YXIgZTsgaWYgKCF3KSB7XG4gICAgICAgICAgICAgICAgci5kZWJ1ZyhcInN3ZzogYWRkaW5nIHN3Zy5qcyBsaWJyYXJ5XCIpO1xuICAgICAgICAgICAgICAgIHZhciBuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNjcmlwdFwiKTtcbiAgICAgICAgICAgICAgICBuLnR5cGUgPSBcInRleHQvamF2YXNjcmlwdFwiLCBuLnNldEF0dHJpYnV0ZShcInN1YnNjcmlwdGlvbnMtY29udHJvbFwiLCBcIm1hbnVhbFwiKSwgbi5hc3luYyA9ICEwLCBuLnNyYyA9IFwiaHR0cHM6Ly9uZXdzLmdvb2dsZS5jb20vc3dnL2pzL3YxL3N3Zy5qc1wiLCBudWxsID09PSAoZSA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwic2NyaXB0XCIpWzBdLnBhcmVudE5vZGUpIHx8IHZvaWQgMCA9PT0gZSB8fCBlLmFwcGVuZENoaWxkKG4pLCB3ID0gITA7XG4gICAgICAgICAgICB9IH0sIGluaXRTd2dGbG93OiBmdW5jdGlvbiAoKSB7IHdpbmRvdy5TV0cucHVzaCgoZnVuY3Rpb24gKGUpIHsgZS5nZXRFbnRpdGxlbWVudHMoKS50aGVuKChmdW5jdGlvbiAobikgeyBpZiAodSA9ICEwLCByLmRlYnVnKFwic3dnOiBnZXRFbnRpdGxlbWVudHNcIiwgbiksIG4uZW5hYmxlc1RoaXMoKSkge1xuICAgICAgICAgICAgICAgIHZhciBvID0gbi5nZXRFbnRpdGxlbWVudEZvclNvdXJjZShcImdvb2dsZVwiKTtcbiAgICAgICAgICAgICAgICBpZiAoIW8pIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGkgPSBuLmVudGl0bGVtZW50cztcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZvaWQgKGkgJiYgbShpKS50aGVuKChmdW5jdGlvbiAoKSB7IHIuZGVidWcoXCJzd2c6IGNoZWNrRXh0ZXJuYWxFbnRpdGxlbWVudFwiKSwgbi5hY2soKTsgfSksIChmdW5jdGlvbiAoKSB7IHIubG9nKFwic3dnOiBjaGVja0V4dGVybmFsRW50aXRsZW1lbnQgZmFpbGVkXCIpOyB9KSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBmKG8pLnRoZW4oKGZ1bmN0aW9uIChvKSB7IGlmIChkKVxuICAgICAgICAgICAgICAgICAgICByLmRlYnVnKFwic3dnOiBvblBheW1lbnRSZXNwb25zZSBpcyBhbHJlYWR5IHRyaWdnZXJlZC4gU2tpcHBpbmcgZW50aXRsZW1lbnRzIGZsb3cuXCIpO1xuICAgICAgICAgICAgICAgIGVsc2UgaWYgKG8pXG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoby50eXBlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiVVNFUl9GT1VORFwiOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0LmlzVXNlclZhbGlkKCkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2b2lkIHIuZXJyb3IoXCJzd2c6IHVzZXIgZm91bmQsIGJ1dCBub3QgdmFsaWRcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgci5kZWJ1ZyhcInN3ZzogdXNlciBmb3VuZCwgaW5pdGlhdGUgbG9naW4gcHJvbXB0XCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpID0gby51c2VyX3Rva2VuO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUuc2hvd0xvZ2luUHJvbXB0KCkudGhlbigoZnVuY3Rpb24gKCkgeyB2KGkpLCBwKGEpOyB9KSkuY2F0Y2goKGZ1bmN0aW9uIChlKSB7IHIubG9nKFwic3dnOiBzaG93TG9naW5Qcm9tcHQgZmFpbGVkXCIsIGUpOyB9KSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiVEVSTV9GT1VORFwiOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHIuZGVidWcoXCJzd2c6IHRlcm0gZm91bmQsIGluaXRpYXRlIGRlZmVycmVkIGFjY291bnQgY3JlYXRpb25cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSBvLnRlcm1faWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5jb21wbGV0ZURlZmVycmVkQWNjb3VudENyZWF0aW9uKHsgZW50aXRsZW1lbnRzOiBuLCBjb25zZW50OiAhMCB9KS50aGVuKChmdW5jdGlvbiAoZSkgeyByLmRlYnVnKFwic3dnOiBjb21wbGV0ZURlZmVycmVkQWNjb3VudENyZWF0aW9uXCIsIGUpLCBnKGUsIGUucHVyY2hhc2VEYXRhLCBlLnVzZXJEYXRhLCBjLCBzKTsgfSkpLmNhdGNoKChmdW5jdGlvbiAoZSkgeyByLmxvZyhcInN3ZzogY29tcGxldGVEZWZlcnJlZEFjY291bnRDcmVhdGlvbiBmYWlsZWRcIiwgZSk7IH0pKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6IHIuZGVidWcoXCJzd2c6IGNoZWNrIHN1YnNjcmlwdGlvbiByZXNwb25zZSB0eXBlIFwiICsgby50eXBlICsgXCIuIE5vdGhpbmcgdG8gZG9cIik7XG4gICAgICAgICAgICAgICAgICAgIH0gfSksIChmdW5jdGlvbiAoKSB7IHIubG9nKFwic3dnOiBjaGVja1N1YnNjcmlwdGlvbiBmYWlsZWRcIik7IH0pKSwgbi5hY2soKTtcbiAgICAgICAgICAgIH0gfSkpLmNhdGNoKChmdW5jdGlvbiAoZSkgeyByLmxvZyhcInN3ZzogZ2V0IGVudGl0bGVtZW50cyBmYWlsZWRcIiwgZSk7IH0pKTsgfSkpOyB9IH0sIHJlZ2lzdGVyQ2FsbGJhY2s6IGZ1bmN0aW9uIChlLCBuKSB7IGwuYWRkRXZlbnQoZSksIGwucmVnaXN0ZXJDYWxsYmFjayhlLCBuKTsgfSB9OyB9KCk7XG4gICAgcG4uY29udGFpbmVyLnJlZ2lzdGVyKFwic3dnXCIsIHsgdXNlVmFsdWU6IGFuIH0pLCBwbi5zd2cgPSBwbi5jb250YWluZXIucmVzb2x2ZShcInN3Z1wiKTtcbiAgICB2YXIgc24gPSBmdW5jdGlvbiAoKSB7IHZhciBlID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJ1dGlsXCIpLCBuID0gITEsIHQgPSBmdW5jdGlvbiAodCwgciwgbykgeyBuID8gKG8gfHwgKG8gPSB7fSksIGUubG9nKFwiZmJwaXhlbDogVHJhY2sgRmFjZWJvb2sgUGl4ZWwgZXZlbnRcIiwgciwgbyksIHdpbmRvdy5mYnEodCwgciwgbykpIDogZS5sb2coXCJmYnBpeGVsOiBTa2lwIHRyYWNraW5nIGV2ZW50IC0gRmFjZWJvb2sgUGl4ZWwgaXMgbm90IGluaXRhbGl6ZWRcIiwgciwgbyk7IH0sIHIgPSBmdW5jdGlvbiAoKSB7IHJldHVybiBuOyB9OyByZXR1cm4geyBuYW1lOiBcImZicGl4ZWxcIiwgaXNJbml0aWFsaXplZDogciwgX19wcml2YXRlX186IHsgaXNJbml0aWFsaXplZDogciB9LCBfX3Byb3RlY3RlZF9fOiB7IGluaXQ6IGZ1bmN0aW9uICgpIHsgaWYgKCFuKSB7XG4gICAgICAgICAgICAgICAgdmFyIHQsIHIsIG8sIGksIGEsIHMsIGMgPSBwbi5nZXRGYlBpeGVsSWQoKTtcbiAgICAgICAgICAgICAgICBpZiAoYylcbiAgICAgICAgICAgICAgICAgICAgZS5sb2coXCJmYnBpeGVsOiBJbml0aWFsaXplIEZhY2Vib29rIFBpeGVsIHRyYWNraW5nXCIsIGMpLCB0ID0gd2luZG93LCByID0gZG9jdW1lbnQsIG8gPSBcInNjcmlwdFwiLCB0LmZicSB8fCAoaSA9IHQuZmJxID0gZnVuY3Rpb24gKCkgeyBpLmNhbGxNZXRob2QgPyBpLmNhbGxNZXRob2QuYXBwbHkoaSwgYXJndW1lbnRzKSA6IGkucXVldWUucHVzaChhcmd1bWVudHMpOyB9LCB0Ll9mYnEgfHwgKHQuX2ZicSA9IGkpLCBpLnB1c2ggPSBpLCBpLmxvYWRlZCA9ICEwLCBpLnZlcnNpb24gPSBcIjIuMFwiLCBpLnF1ZXVlID0gW10sIChhID0gci5jcmVhdGVFbGVtZW50KG8pKS5hc3luYyA9ICEwLCBhLnNyYyA9IFwiaHR0cHM6Ly9jb25uZWN0LmZhY2Vib29rLm5ldC9lbl9VUy9mYmV2ZW50cy5qc1wiLCAocyA9IHIuZ2V0RWxlbWVudHNCeVRhZ05hbWUobylbMF0pLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGEsIHMpKSwgd2luZG93LmZicShcInNldFwiLCBcImF1dG9Db25maWdcIiwgXCJmYWxzZVwiLCBjKSwgd2luZG93LmZicShcImluaXRcIiwgYyksIG4gPSAhMDtcbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgIGUuZXJyb3IoXCJmYnBpeGVsOiBGYWNlYm9vayBQaXhlbCBJRCBpcyBub3QgZGVmaW5lZFwiKTtcbiAgICAgICAgICAgIH0gfSB9LCB0cmFja0V2ZW50OiBmdW5jdGlvbiAoZSwgbikgeyB0KFwidHJhY2tcIiwgZSwgbik7IH0sIHRyYWNrQ3VzdG9tRXZlbnQ6IGZ1bmN0aW9uIChlLCBuKSB7IHQoXCJ0cmFja0N1c3RvbVwiLCBlLCBuKTsgfSB9OyB9KCk7XG4gICAgcG4uY29udGFpbmVyLnJlZ2lzdGVyKFwiZmJwaXhlbFwiLCB7IHVzZVZhbHVlOiBzbiB9KSwgcG4uZmJwaXhlbCA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwiZmJwaXhlbFwiKTtcbiAgICB2YXIgY24gPSBmdW5jdGlvbiAoKSB7IHZhciBlID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJ1dGlsXCIpLCBuID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJmYnBpeGVsXCIpLCB0ID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJvZmZlclwiKSwgciA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwidXNlclwiKSwgbyA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwiYXBpXCIpLCBpID0gITEsIGEgPSBcIlwiLCBzID0ge30sIGMgPSB7fTsgZnVuY3Rpb24gbChuKSB7IHJldHVybiBuZXcgUHJvbWlzZSgoZnVuY3Rpb24gKHQpIHsgdmFyIGkgPSB7IGFpZDogcG4uYWlkLCByaWQ6IFwiXCIsIGFjY291bnRfbGlua2luZ190b2tlbjogZS5nZXRRdWVyeVBhcmFtQnlOYW1lKFwiYWNjb3VudF9saW5raW5nX3Rva2VuXCIpLCB1c2VyX3Rva2VuOiByLmdldFByb3ZpZGVyKCkuZ2V0VG9rZW4oKSwgdXNlcl9wcm92aWRlcjogci5nZXRQcm92aWRlcigpLmdldE5hbWUoKSB9OyBuICYmIChpLnJpZCA9IG4pLCBvLmNhbGxBcGkoXCIvZmJpYS9zdWJzY3JpcHRpb25QYXlsb2FkL2dlbmVyYXRlXCIsIGksIChmdW5jdGlvbiAoZSkgeyBlICYmIGUuZGF0YSAmJiAoYSA9IGUuZGF0YSksIHQobnVsbCk7IH0pKTsgfSkpOyB9IHZhciB1ID0gZnVuY3Rpb24gKCkgeyBsKCkudGhlbigoZnVuY3Rpb24gKCkgeyBhICYmIHAoKTsgfSkpOyB9LCBkID0gZnVuY3Rpb24gKG4pIHsgaWYgKG4pIHtcbiAgICAgICAgdmFyIHQgPSBuZXcgUHJvbWlzZSgoZnVuY3Rpb24gKGUpIHsgc2V0VGltZW91dCgoZnVuY3Rpb24gKCkgeyBlKG51bGwpOyB9KSwgMWUzICogcG4ucmVkaXJlY3RUb0ZiVGltZW91dCk7IH0pKSwgciA9IGwobik7XG4gICAgICAgIGUuX19wcm90ZWN0ZWRfXy53YWl0QWxsUHJvbWlzZXMoW3QsIHJdKS50aGVuKChmdW5jdGlvbiAoKSB7IHAoKTsgfSkpO1xuICAgIH1cbiAgICBlbHNlXG4gICAgICAgIGUuZXJyb3IoXCJmYnN1YnNjcmlwdGlvbnM6ICdyaWQnIGNvdWxkIG5vdCBiZSBlbXB0eSBvbiBnZW5lcmF0aW5nIHN1YnNjcmlwdGlvbiBwYXlsb2FkXCIpOyB9LCBwID0gZnVuY3Rpb24gKCkgeyB2YXIgbiA9IGUuZ2V0UXVlcnlQYXJhbUJ5TmFtZShcImFjY291bnRfbGlua2luZ190b2tlblwiKSwgdCA9IGUuZ2V0UXVlcnlQYXJhbUJ5TmFtZShcInJlZGlyZWN0X3VyaVwiKSArIFwiP2FjY291bnRfbGlua2luZ190b2tlbj1cIiArIGVuY29kZVVSSUNvbXBvbmVudChuKTsgYSAmJiAodCArPSBcIiZzdWJzY3JpcHRpb25fcGF5bG9hZD1cIiArIGVuY29kZVVSSUNvbXBvbmVudChhKSksIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gdDsgfSwgZiA9IGZ1bmN0aW9uIChlLCB0KSB7IHNbZV0gfHwgKHNbZV0gPSAhMCwgbi50cmFja0V2ZW50KGUsIHQpKTsgfSwgbSA9IGZ1bmN0aW9uIChlLCB0KSB7IGNbZV0gfHwgKGNbZV0gPSAhMCwgbi50cmFja0N1c3RvbUV2ZW50KGUsIHQpKTsgfSwgZyA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGk7IH07IHJldHVybiB7IG5hbWU6IFwiZmJzdWJzY3JpcHRpb25zXCIsIGNoZWNrVXNlckFjY2Vzc0FuZFJlZGlyZWN0VG9GYjogZnVuY3Rpb24gKCkgeyBsKCkudGhlbigoZnVuY3Rpb24gKCkgeyBwKCk7IH0pKTsgfSwgaXNJbml0aWFsaXplZDogZywgX19wcml2YXRlX186IHsgaXNJbml0aWFsaXplZDogZyB9LCBfX3Byb3RlY3RlZF9fOiB7IGluaXQ6IGZ1bmN0aW9uICgpIHsgaWYgKCFpKSB7XG4gICAgICAgICAgICAgICAgbi5fX3Byb3RlY3RlZF9fLmluaXQoKSwgdC5yZWdpc3RlckNhbGxiYWNrKFwibG9hZGVkXCIsIChmdW5jdGlvbiAoKSB7IHZhciBuID0gZS5nZXRRdWVyeVBhcmFtQnlOYW1lKFwic3VyZmFjZVwiKTsgXCJtZXRlcl9saW1pdF9yZWFjaGVkXCIgIT09IG4gJiYgXCJsb2NrZWRfYXJ0aWNsZVwiICE9PSBuIHx8IHBuLmluYXBwQnJvd3NlclJldHVybiB8fCBtKFwiVmlld1BheXdhbGxcIiwgeyBzdXJmYWNlOiBcIklBXCIgfSk7IH0pKTtcbiAgICAgICAgICAgICAgICBwbi5hZGRIYW5kbGVyKFwibG9naW5TdWNjZXNzXCIsIChmdW5jdGlvbiAoZSkgeyBsKCkudGhlbigoZnVuY3Rpb24gKCkgeyBlLnJlZ2lzdHJhdGlvbiA/IG0oXCJDcmVhdGVBY2NvdW50XCIpIDogbShcIkxvZ0ludG9BY2NvdW50XCIsIHsgaXNfc3Vic2NyaWJlcjogISFhIH0pLCBhICYmIHNldFRpbWVvdXQoKGZ1bmN0aW9uICgpIHsgcCgpOyB9KSwgMjAwKTsgfSkpOyB9KSksIHBuLmFkZEhhbmRsZXIoXCJleHBlcmllbmNlRXhlY3V0ZVwiLCAoZnVuY3Rpb24gKCkgeyByLmlzVXNlclZhbGlkKCkgJiYgdSgpOyB9KSksIHQucmVnaXN0ZXJDYWxsYmFjayhcImFscmVhZHlQdXJjaGFzZWRcIiwgKGZ1bmN0aW9uIChlKSB7IGQoZS5yaWQpOyB9KSksIHQucmVnaXN0ZXJDYWxsYmFjayhcInN0YXJ0Q2hlY2tvdXRcIiwgKGZ1bmN0aW9uIChlKSB7IGYoXCJJbml0aWF0ZUNoZWNrb3V0XCIsIHsgb2ZmZXJfY29kZTogZS5vZmZlcklkLCBjYW1wYWlnbl9jb2RlOiBlLnRlcm1JZCB9KTsgfSkpLCB0LnJlZ2lzdGVyQ2FsbGJhY2soXCJjb21wbGV0ZVwiLCAoZnVuY3Rpb24gKGUpIHsgZS5oYXNPd25Qcm9wZXJ0eShcImNoYXJnZUN1cnJlbmN5XCIpICYmIGUuaGFzT3duUHJvcGVydHkoXCJjaGFyZ2VBbW91bnRcIikgJiYgZihcIlB1cmNoYXNlXCIsIHsgY3VycmVuY3k6IGUuY2hhcmdlQ3VycmVuY3ksIHZhbHVlOiBlLmNoYXJnZUFtb3VudCwgb2ZmZXJfY29kZTogZS5vZmZlcklkLCBjYW1wYWlnbl9jb2RlOiBlLnRlcm1JZCB9KSwgZChlLnJpZCk7IH0pKSwgdC5yZWdpc3RlckNhbGxiYWNrKFwiY2xvc2VcIiwgKGZ1bmN0aW9uICgpIHsgcCgpOyB9KSksIGkgPSAhMDtcbiAgICAgICAgICAgIH0gfSB9IH07IH0oKTtcbiAgICBwbi5jb250YWluZXIucmVnaXN0ZXIoXCJmYnN1YnNjcmlwdGlvbnNcIiwgeyB1c2VWYWx1ZTogY24gfSksIHBuLmZic3Vic2NyaXB0aW9ucyA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwiZmJzdWJzY3JpcHRpb25zXCIpO1xuICAgIHZhciBsbiA9IGZ1bmN0aW9uIChlKSB7IHZvaWQgMCA9PT0gZSAmJiAoZSA9IHBuLmNvbnRhaW5lcik7IHZhciBuID0gZS5yZXNvbHZlKFwianFVdGlsc1wiKSwgdCA9IGUucmVzb2x2ZShcInV0aWxcIiksIHIgPSBlLnJlc29sdmUoXCJyZWNXaWRnZXRTZXJ2aWNlXCIpLl9fcHJvdGVjdGVkX18uZ2V0SW5zdGFuY2UoKSwgbyA9IFtdLCBpID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdm9pZCAwICE9PSBwbi5jeENkblVybCAmJiBcIlwiICE9PSBwbi5jeENkblVybCA/IHBuLmN4Q2RuVXJsIDogXCJodHRwczovL2Nkbi5jeGVuc2UuY29tXCI7IH0sIGEgPSBmdW5jdGlvbiAoKSB7IHJldHVybiB2b2lkIDAgIT09IHBuLmN4ZW5zZVNpdGVJZCAmJiBcIlwiICE9PSBwbi5jeGVuc2VTaXRlSWQ7IH0sIHMgPSBmdW5jdGlvbiAoZSkgeyByZXR1cm4gdm9pZCAwICE9PSB3aW5kb3cuY1ggJiYgdm9pZCAwICE9PSB3aW5kb3cuY1gubGlicmFyeSAmJiAoZSB8fCB2b2lkIDAgIT09IHdpbmRvdy5jWC5DQ0UgJiYgdm9pZCAwICE9PSB3aW5kb3cuY1guQ0NFLmxpYnJhcnkpOyB9LCBjID0gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIHZvaWQgMCAhPT0gZS5jeGVuc2VDdXN0b21lclByZWZpeCAmJiBcIlwiICE9PSBlLmN4ZW5zZUN1c3RvbWVyUHJlZml4OyB9LCBsID0gZnVuY3Rpb24gKGUpIHsgdmFyIG4sIHIsIG8gPSB3aW5kb3cuY1ggPSB3aW5kb3cuY1ggfHwge307IG8uY2FsbFF1ZXVlID0gby5jYWxsUXVldWUgfHwgW107IHZhciBpID0gXCJhbm9uXCI7IGUudWlkICYmIFwiYW5vblwiICE9PSBlLnVpZCAmJiBcIlwiICE9PSBlLnVpZCAmJiAoaSA9ICEhKG51bGwgPT09IChyID0gbnVsbCA9PT0gKG4gPSBlLmV2ZW50RXhlY3V0aW9uQ29udGV4dCkgfHwgdm9pZCAwID09PSBuID8gdm9pZCAwIDogbi5hY2Nlc3NMaXN0KSB8fCB2b2lkIDAgPT09IHIgPyB2b2lkIDAgOiByLmxlbmd0aCkgPyBcImhhc0FjdGl2ZUFjY2Vzc1wiIDogXCJyZWdpc3RlcmVkXCIsIG8uY2FsbFF1ZXVlLnB1c2goW1wiYWRkRXh0ZXJuYWxJZFwiLCB7IGlkOiBlLnVpZCwgdHlwZTogZS5jeGVuc2VDdXN0b21lclByZWZpeCB9XSksIHQuZGVidWcoXCJjMXg6IGFkZGluZyBleHRlcm5hbElkXCIsIHsgdWlkOiBlLnVpZCwgcHJlZml4OiBlLmN4ZW5zZUN1c3RvbWVyUHJlZml4IH0pKTsgby5jYWxsUXVldWUucHVzaChbXCJzZXRDdXN0b21QYXJhbWV0ZXJzXCIsIHsgdXNlclN0YXRlOiBpIH1dKSwgdC5kZWJ1ZyhcImMxeDogYWRkaW5nIEN1c3RvbVBhcmFtZXRlcnMgdXNlclN0YXRlXCIsIHsgdXNlclN0YXRlOiBpIH0pLCBkKCExLCBlLmJyb3dzZXJJZCwgZS5wYWdlVmlld0lkLCBwbi5jeGVuc2VTaXRlSWQpLCB0LmRlYnVnKFwiYzF4OiBzZW5kaW5nIHBhZ2V2aWV3IGV2ZW50XCIpLCBvLmNhbGxRdWV1ZS5wdXNoKFtcInNlbmRQYWdlVmlld0V2ZW50XCJdKTsgfSwgdSA9IGZ1bmN0aW9uIChlLCBuLCB0LCByKSB7IHQgJiYgKCEwID09PSByID8gZS5jYWxsUXVldWUudW5zaGlmdChbbiwgdF0pIDogZS5jYWxsUXVldWUucHVzaChbbiwgdF0pKTsgfSwgZCA9IGZ1bmN0aW9uIChlLCBuLCByLCBvKSB7IHZhciBpID0gd2luZG93LmNYID0gd2luZG93LmNYIHx8IHt9OyBpLmNhbGxRdWV1ZSA9IGkuY2FsbFF1ZXVlIHx8IFtdLCB1KGksIFwic2V0U2l0ZUlkXCIsIG8sIGUpLCBuICYmIHUoaSwgXCJpbnZva2VcIiwgKGZ1bmN0aW9uICgpIHsgd2luZG93LmNYTmF0aXZlID0geyBnZXRVc2VySWQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIG47IH0gfTsgfSksIGUpLCB1KGksIFwic2V0UmFuZG9tSWRcIiwgciwgZSksIHQuZGVidWcoXCJjMXg6IGluamVjdGluZyBpZHNcIiwgeyBicm93c2VySWQ6IG4sIHBhZ2VWaWV3SWQ6IHIsIHNpdGVJZDogbyB9KTsgfSwgcCA9IGZ1bmN0aW9uIChlKSB7IHZhciBuID0gbnVsbCwgdCA9IFtdOyBmdW5jdGlvbiByKCkgeyBuICYmIGNsZWFyVGltZW91dChuKSwgbiA9IG51bGwsIGUodCksIHQgPSBbXTsgfSByZXR1cm4gZnVuY3Rpb24gKGUpIHsgbiB8fCAobiA9IHNldFRpbWVvdXQociwgMTApKSwgdC5wdXNoKGUpOyB9OyB9KChmdW5jdGlvbiAoZSkgeyBpZiAoYSgpKSB7XG4gICAgICAgIGZvciAodmFyIG4gPSBbXSwgaSA9IGZ1bmN0aW9uICgpIHsgdmFyIHQgPSBlW3NdIHx8IHt9OyByLnNob3dSZWNvbW1lbmRhdGlvbih7IHdpZGdldENvbmZpZzogdCwgY3JlYXRlUGxhY2Vob2xkZXJGbjogZih0LndpZGdldElkLCB0LmRpc3BsYXlNb2RlKSB9KSAmJiBuLnB1c2goeyB3aWRnZXRQYXJhbXM6IHsgd2lkZ2V0SWQ6IHQud2lkZ2V0SWQsIHRhcmdldEVsZW1lbnRJZDogXCJjeGVuc2UtXCIgKyB0LndpZGdldElkLCBleHBlcmllbmNlSWQ6IHQuZXhwZXJpZW5jZUlkIH0sIHdpZGdldENhbGxiYWNrOiBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IGUgJiYgZS5yZXNwb25zZTsgaWYgKG4gJiYgIWUucmVzcG9uc2UuZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBcIm1vZGFsXCIgPT09IHQuZGlzcGxheU1vZGUgJiYgci5maXhXaWRnZXRNb2RhbFdpZHRoKHIuZmluZFdpZGdldCh0LndpZGdldElkKSk7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBuLml0ZW1zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBhID0gbi5pdGVtc1tpXS5pZDtcbiAgICAgICAgICAgICAgICAgICAgLTEgPT09IG8uaW5kZXhPZihhKSAmJiBvLnB1c2goYSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSB9IH0pOyB9LCBzID0gMDsgcyA8IGUubGVuZ3RoOyBzKyspXG4gICAgICAgICAgICBpKCk7XG4gICAgICAgIG0oKGZ1bmN0aW9uICgpIHsgdmFyIGU7IGUgPSBwbi5jeGVuc2VTaXRlSWQsIHQuZGVidWcoXCJjMXg6IHNldHRpbmcgc2l0ZUlkOiBcIiwgZSksIHdpbmRvdy5jWC5zZXRTaXRlSWQoZSksIHdpbmRvdy5jWC5DQ0UucnVuTXVsdGkobiwgW1wiaWRcIl0sIG8pOyB9KSk7XG4gICAgfVxuICAgIGVsc2VcbiAgICAgICAgdC5kZWJ1ZyhcImMxeDogY2FuIG5vdCBzaG93IHJlY29tbWVuZGF0aW9uIGJlY2F1c2Ugc2l0ZUlkIGlzIG5vdCBjb25maWd1cmVkIHVzaW5nIGBzZXRDeGVuc2VTaXRlSWRgXCIpOyB9KSksIGYgPSBmdW5jdGlvbiAoZSwgdCkgeyByZXR1cm4gZnVuY3Rpb24gKCkgeyB2YXIgciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7IG4uYWRkQ2xhc3MoXCJ0cC1jeGVuc2UtcGxhY2Vob2xkZXItXCIgKyB0LCByKSwgbi5hZGRDbGFzcyhcInRwLXdpZGdldC1wbGFjZWhvbGRlclwiLCByKTsgdmFyIG8gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpOyByZXR1cm4gby5pZCA9IFwiY3hlbnNlLVwiICsgZSwgci5hcHBlbmRDaGlsZChvKSwgcjsgfTsgfSwgbSA9IGZ1bmN0aW9uIChlKSB7IHdpbmRvdy5jWCA9IHdpbmRvdy5jWCB8fCB7fSwgd2luZG93LmNYLkNDRSA9IHdpbmRvdy5jWC5DQ0UgfHwge30sIHdpbmRvdy5jWC5DQ0UuY2FsbFF1ZXVlID0gd2luZG93LmNYLkNDRS5jYWxsUXVldWUgfHwgW10sIHdpbmRvdy5jWC5DQ0UuY2FsbFF1ZXVlLnB1c2goW1wiaW52b2tlXCIsIGVdKTsgfSwgZyA9IGZ1bmN0aW9uIChlKSB7IHJldHVybiBzKGUpOyB9OyByZXR1cm4geyBuYW1lOiBcImN4ZW5zZVwiLCBfX3Byb3RlY3RlZF9fOiB7IHNob3dSZWNvbW1lbmRhdGlvbjogcCwgc2VuZFBhZ2VWaWV3RXZlbnQ6IGZ1bmN0aW9uIChlKSB7IChhKCkgfHwgYyhlKSkgJiYgKGEoKSB8fCAhYyhlKSA/ICFhKCkgfHwgYyhlKSA/IGwoZSkgOiB0LmRlYnVnKFwiY3hlbnNlOiBjYW4gbm90IHNlbmQgcGFnZXZpZXcgYmVjYXVzZSBjdXN0b21lciBwcmVmaXggaXMgbm90IGNvbmZpZ3VyZWQgaW4gYXBwIHNldHRpbmdzXCIpIDogdC5kZWJ1ZyhcImN4ZW5zZTogY2FuIG5vdCBzZW5kIHBhZ2V2aWV3IGJlY2F1c2Ugc2l0ZUlkIGlzIG5vdCBjb25maWd1cmVkIHVzaW5nIGBzZXRDeGVuc2VTaXRlSWRgXCIpKTsgfSwgaXNBY3RpdmF0ZWQ6IGEsIGlzQ3VzdG9tZXJQcmVmaXhDb25maWd1cmVkOiBjLCBpc0NvbmZpZ3VyZWRQb2xsaW5nQXN5bmM6IGZ1bmN0aW9uIChlLCBuLCB0KSB7IG4gPSBuIHx8IDAsIHQgPSB0IHx8IDA7IHZhciByID0gMDsgcmV0dXJuIG5ldyBQcm9taXNlKChmdW5jdGlvbiAobywgaSkgeyB2YXIgYSA9IGZ1bmN0aW9uICgpIHsgZyhlKSA/IG8oITApIDogciA+PSB0ID8gaShlID8gXCJjMXg6IGNYIG9iamVjdCBpcyBub3QgZm91bmQgYWZ0ZXIgXCIgKyB0ICsgXCIgcmV0cmllcyB3aXRoIFwiICsgbiArIFwibXMgaW50ZXJ2YWxcIiA6IFwiYzF4OiBjWCBhbmQgY1guQ0NFIG9iamVjdHMgYXJlIG5vdCBmb3VuZCBhZnRlciBcIiArIHQgKyBcIiByZXRyaWVzIHdpdGggXCIgKyBuICsgXCJtcyBpbnRlcnZhbFwiKSA6IChyKyssIHNldFRpbWVvdXQoYSwgbikpOyB9OyBnKGUpID8gbyghMCkgOiBzZXRUaW1lb3V0KGEsIG4pOyB9KSk7IH0sIGludm9rZUN4ZW5zZUZuOiBtLCBnZXRDMVhJbnRlZ3JhdGlvblZlcnNpb246IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHZvaWQgMCAhPT0gcG4uYzFYSW50ZWdyYXRpb25WZXJzaW9uICYmIFwiXCIgIT09IHBuLmN4ZW5zZVNpdGVJZCA/IHBuLmMxWEludGVncmF0aW9uVmVyc2lvbiA6IFwiTi9BXCI7IH0sIGdldE9yR2VuZXJhdGVDeENvbXBhdGlibGVCaWQ6IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSB0Ll9fcHJvdGVjdGVkX18uZ2V0Q29va2llKFwiY1hfUFwiKSwgbiA9IG51bGw7IHRyeSB7XG4gICAgICAgICAgICAgICAgdC5fX3Byb3RlY3RlZF9fLmhhc0xvY2FsU3RvcmFnZSgpICYmIChuID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oXCJfY1hfUFwiKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZSkgeyB9IHZhciByID0gZSB8fCBuOyByZXR1cm4gciA/ICh0LmRlYnVnKFwiYzF4OiBleGlzdGluZyBjWF9QIHZhbHVlIGhhcyBiZWVuIGZvdW5kOiBcIiwgciksIHIpIDogKHQuZGVidWcoXCJjMXg6IGNhbiBub3QgZmluZCBleGlzdGluZyBjWF9QIHZhbHVlLCBnZW5lcmF0aW5nIGEgbmV3IG9uZVwiKSwgdC5fX3Byb3RlY3RlZF9fLnJhbmRvbVN0cmluZ0N4Q29tcGF0aWJsZSgpKTsgfSwgbG9hZEN4TGliSWZOZWVkZWQ6IGZ1bmN0aW9uICgpIHsgdmFyIGU7IGlmICghYSgpIHx8ICFzKCEwKSkge1xuICAgICAgICAgICAgICAgIHZhciBuID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJzY3JpcHRcIilbMF0sIHIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic2NyaXB0XCIpO1xuICAgICAgICAgICAgICAgIHIub25lcnJvciA9IGZ1bmN0aW9uIChlKSB7IHQuZGVidWcoXCJjMXg6IGVycm9yIGR1cmluZyBsb2FkIG9mIGN4LmpzLiBcIiwgZSk7IH0sIHIub25sb2FkID0gZnVuY3Rpb24gKCkgeyB0LmRlYnVnKFwiYzF4OiBjeC5qcyBoYXMgYmVlbiBzdWNjZXNzZnVsbHkgbG9hZGVkXCIpOyB9LCByLmFzeW5jID0gITAsIHIudHlwZSA9IFwidGV4dC9qYXZhc2NyaXB0XCIsIHBuLmMxWExvYWRDY2UgPyByLnNyYyA9IGkoKSArIFwiL2N4LmNjZS5qc1wiIDogci5zcmMgPSBpKCkgKyBcIi9jeC5qc1wiLCB0LmRlYnVnKFwiYzF4OiBzdGFydCBsb2FkaW5nIGN4LmpzIG9uIHRoZSBwYWdlLi4uXCIpLCBudWxsID09PSAoZSA9IG4ucGFyZW50Tm9kZSkgfHwgdm9pZCAwID09PSBlIHx8IGUuaW5zZXJ0QmVmb3JlKHIsIG4pO1xuICAgICAgICAgICAgfSB9LCBzZXRDeEJpZENvb2tpZTogZnVuY3Rpb24gKGUsIG4pIHsgdmFyIHI7IHIgPSB7IHBhdGg6IFwiL1wiLCBleHBpcmVzOiA3MzAgfSwgbiAmJiAoci5kb21haW4gPSBuLCB0Ll9fcHJvdGVjdGVkX18uZGVsZXRlVExEQ29va2llRm9yU3BlY2lmaWNEb21haW5zKFwiY1hfUFwiLCBuKSksIHQuZGVsZXRlQ29va2llKFwiY1hfUFwiKSwgdC5fX3Byb3RlY3RlZF9fLnNldENvb2tpZShcImNYX1BcIiwgZSwgcik7IH0sIHRyeVRvR2V0Q3hQYWdlVmlld0lkOiBmdW5jdGlvbiAoZSkgeyB2YXIgbiwgdCwgciA9IHdpbmRvdy5jWDsgcmV0dXJuIChudWxsID09PSAodCA9IG51bGwgPT09IChuID0gbnVsbCA9PSByID8gdm9pZCAwIDogci5nZXRQYWdlQ29udGV4dCkgfHwgdm9pZCAwID09PSBuID8gdm9pZCAwIDogbi5jYWxsKHIpKSB8fCB2b2lkIDAgPT09IHQgPyB2b2lkIDAgOiB0LnBhZ2VWaWV3UmFuZG9tKSB8fCBlOyB9LCBpbmplY3RJZHM6IGQgfSB9OyB9O1xuICAgIHBuLmNvbnRhaW5lci5yZWdpc3RlcihcImN4ZW5zZVwiLCB7IHVzZVZhbHVlOiBsbigpIH0pLCBwbi5jeGVuc2UgPSBwbi5jb250YWluZXIucmVzb2x2ZShcImN4ZW5zZVwiKTtcbiAgICB2YXIgdW4gPSBmdW5jdGlvbiAoZSkgeyB2b2lkIDAgPT09IGUgJiYgKGUgPSBwbi5jb250YWluZXIpOyB2YXIgbiwgdCwgciA9IGUucmVzb2x2ZShcImpxVXRpbHNcIiksIG8gPSBlLnJlc29sdmUoXCJ1dGlsXCIpLCBpID0gZS5yZXNvbHZlKFwiYXBpXCIpLCBhID0gZS5yZXNvbHZlKFwiZXZlbnRVdGlsc1wiKSwgcyA9IGUucmVzb2x2ZShcInNjcm9sbERlcHRoXCIpLCBjID0gZS5yZXNvbHZlKFwibG9nXCIpLCBsID0gZS5yZXNvbHZlKFwiYWpheFwiKSwgdSA9IGUucmVzb2x2ZShcInZpZXdwb3J0RXhpdFwiKSwgZCA9IGUucmVzb2x2ZShcImlkbGVcIiksIHAgPSBlLnJlc29sdmUoXCJpbnRlcmFjdGlvblwiKSwgZiA9IGUucmVzb2x2ZShcInBpYW5vRXNwXCIpLCBtID0gZS5yZXNvbHZlKFwic3dnXCIpLCBnID0gZS5yZXNvbHZlKFwiZmJzdWJzY3JpcHRpb25zXCIpLCB2ID0gZS5yZXNvbHZlKFwidXNlclwiKSwgaCA9IGUucmVzb2x2ZShcImN4ZW5zZVwiKSwgdyA9IGUucmVzb2x2ZShcImxvZ2dpbmdcIiksIHkgPSBbXSwgYiA9IHt9LCBrID0gXCJcIiwgXyA9ICExLCBDID0gXCJyZWFkZXJfaWRcIiwgSSA9ICExLCBTID0ge30sIHggPSAobiA9IHsgYXBwbHlDc3M6IHsgZm46IGZ1bmN0aW9uIChlKSB7IGUuZXZlbnRQYXJhbXMucnVsZUxpc3QuZm9yRWFjaCgoZnVuY3Rpb24gKGUpIHsgdmFyIG4sIHQgPSBlLmNsYXNzZXMsIGkgPSBlLmVsZW1lbnRzOyB0ICYmICh0ID0gdC5yZXBsYWNlKC9bLC5dL2csIFwiIFwiKS5zcGxpdChcIiBcIikuZmlsdGVyKChmdW5jdGlvbiAoZSkgeyByZXR1cm4gXCJcIiAhPT0gZTsgfSkpLCBcImFkZFwiID09PSBlLnR5cGUgJiYgKG4gPSByLnFhKGkpKSAmJiBuLmxlbmd0aCAmJiBuLmZvckVhY2goKGZ1bmN0aW9uIChlKSB7IHQuZm9yRWFjaCgoZnVuY3Rpb24gKG4pIHsgci5hZGRDbGFzcyhuLCBlKTsgfSkpOyB9KSksIFwicmVtb3ZlXCIgPT09IGUudHlwZSAmJiAobiA9IHIucWEoaSkpICYmIG4ubGVuZ3RoICYmIG4uZm9yRWFjaCgoZnVuY3Rpb24gKGUpIHsgdC5mb3JFYWNoKChmdW5jdGlvbiAobikgeyByLnJlbW92ZUNsYXNzKG4sIGUpOyB9KSk7IH0pKSk7IG8uZGVidWcoXCJleHA6IGNzcyBhcHBsaWVkIHdpdGggcnVsZTpcIiwgZSk7IH0pKTsgfSwgaXNBY3Rpb246ICEwLCBzaG91bGRGaXJlQ2FsbGJhY2s6ICEwIH0sIHJ1bkpzOiB7IGZuOiBmdW5jdGlvbiAoZSkgeyBpZiAoZS5ldmVudFBhcmFtcyAmJiBlLmV2ZW50UGFyYW1zLnNuaXBwZXQpIHtcbiAgICAgICAgICAgICAgICB2YXIgbiA9IGUuZXZlbnRQYXJhbXMuc25pcHBldDtcbiAgICAgICAgICAgICAgICBvLmRlYnVnKFwiZXhwOiBydW4ganMgd2l0aCBzbmlwcGV0OlwiLCBuKTtcbiAgICAgICAgICAgICAgICB2YXIgdCA9IGUuZXZlbnRFeGVjdXRpb25Db250ZXh0O1xuICAgICAgICAgICAgICAgIG8uZGVidWcoXCJleHA6IHNldCBwdWJsaXNoZXIncyBjb250ZXh0IGFuZCBjdXN0b206XCIsIHQpLCBmZShcInZhciBjb250ZXh0ID0gXCIgKyBKU09OLnN0cmluZ2lmeSh0KSArIFwiO1xcbnZhciBjdXN0b20gPSBcIiArIEpTT04uc3RyaW5naWZ5KHBuLmN1c3RvbVZhcmlhYmxlcykgKyBcIjtcXG5cIiArIG4pO1xuICAgICAgICAgICAgfSB9LCBpc0FjdGlvbjogITAsIHNob3VsZEZpcmVDYWxsYmFjazogITAgfSwgc2V0Q29va2llOiB7IGZuOiBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IGUuZXZlbnRQYXJhbXM7IGlmIChuICYmIHZvaWQgMCAhPT0gbi5jb29raWVOYW1lICYmIHZvaWQgMCAhPT0gbi5jb29raWVWYWx1ZSkge1xuICAgICAgICAgICAgICAgIG8uZGVidWcoXCJleHA6IHNldCBjb29raWUgd2l0aCBwYXJhbWV0ZXJzOlwiLCBuKTtcbiAgICAgICAgICAgICAgICB2YXIgdCA9IChuLmlzUmVhZGFibGVDb29raWUgPyBcIl9wY19cIiA6IFwiXCIpICsgbi5jb29raWVOYW1lLCByID0geyBkb21haW46IG4uY29va2llRG9tYWluLCBwYXRoOiBuLmNvb2tpZVBhdGggfTtcbiAgICAgICAgICAgICAgICBpZiAoIW4uaXNTZXNzaW9uQ29va2llKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBpID0gbmV3IERhdGU7XG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaCAobi5leHBpcmF0aW9uVW5pdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcInNlY29uZHNcIjpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpLnNldFNlY29uZHMoaS5nZXRTZWNvbmRzKCkgKyBuLmV4cGlyYXRpb25WYWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwibWludXRlc1wiOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkuc2V0TWludXRlcyhpLmdldE1pbnV0ZXMoKSArIG4uZXhwaXJhdGlvblZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJob3Vyc1wiOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkuc2V0SG91cnMoaS5nZXRIb3VycygpICsgbi5leHBpcmF0aW9uVmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcImRheXNcIjpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpLnNldERhdGUoaS5nZXREYXRlKCkgKyBuLmV4cGlyYXRpb25WYWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwibW9udGhzXCI6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaS5zZXRNb250aChpLmdldE1vbnRoKCkgKyBuLmV4cGlyYXRpb25WYWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwieWVhcnNcIjpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpLnNldEZ1bGxZZWFyKGkuZ2V0RnVsbFllYXIoKSArIG4uZXhwaXJhdGlvblZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6IG8ubG9nKFwiV3JvbmcgZXZlbnRQYXJhbXMuZXhwaXJhdGlvblVuaXQgOiBcIiwgbi5leHBpcmF0aW9uVW5pdCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgci5leHBpcmVzID0gaTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgby5fX3Byb3RlY3RlZF9fLnNldENvb2tpZSh0LCBuLmNvb2tpZVZhbHVlLCByKTtcbiAgICAgICAgICAgIH0gfSwgaXNBY3Rpb246ICEwLCBzaG91bGRGaXJlQ2FsbGJhY2s6ICEwIH0sIG5vblNpdGU6IHsgZm46IGZ1bmN0aW9uIChlKSB7IG8uZGVidWcoXCJleHA6IG5vbi1zaXRlIGFjdGlvbjpcIiwgZSk7IH0sIGlzQWN0aW9uOiAhMCwgc2hvdWxkRmlyZUNhbGxiYWNrOiAhMCB9LCBzaG93Rm9ybTogeyBmbjogZnVuY3Rpb24gKGUpIHsgdmFyIG4gPSBlLmV2ZW50UGFyYW1zOyBpZiAobiAmJiBuLmZvcm1OYW1lKSB7XG4gICAgICAgICAgICAgICAgdmFyIHQgPSB7IGZvcm1OYW1lOiBuLmZvcm1OYW1lLCBoaWRlSWZDb21wbGV0ZTogbi5oaWRlQ29tcGxldGVkRmllbGRzLCB0cmFja2luZ0lkOiBlLmV2ZW50RXhlY3V0aW9uQ29udGV4dC50cmFja2luZ0lkLCBkaXNwbGF5TW9kZTogbi5kaXNwbGF5TW9kZSwgY29udGFpbmVyU2VsZWN0b3I6IG4uY29udGFpbmVyU2VsZWN0b3IsIHNob3dDbG9zZUJ1dHRvbjogbi5zaG93Q2xvc2VCdXR0b24sIGFjY2Vzc1Rva2VuOiB2LmdldFByb3ZpZGVyKCkuZ2V0VG9rZW4oKSB9O1xuICAgICAgICAgICAgICAgIG4uZm9ybVdpZHRoICYmIG4uZm9ybVdpZHRoLmVuYWJsZWQgJiYgKHQgPSByLmRlZXBFeHRlbmQoe30sIHsgd2lkdGg6IG4uZm9ybVdpZHRoLndpZHRoIH0sIHQpKSwgby5kZWJ1ZyhcImV4cDogc2hvdyBmb3JtIHdpdGggcGFyYW1zOlwiLCBuKSwgcG4ucGlhbm9JZC5zaG93Rm9ybSh0KTtcbiAgICAgICAgICAgIH0gfSwgaXNBY3Rpb246ICEwLCBzaG91bGRGaXJlQ2FsbGJhY2s6ICEwIH0sIHNob3dSZWNvbW1lbmRhdGlvbnM6IHsgZm46IGZ1bmN0aW9uIChlKSB7IHJldHVybiBtZShlLCBmdW5jdGlvbiAoZSkgeyByZXR1cm4geyBFU1A6IGYuX19wcm90ZWN0ZWRfXy5zaG93UmVjb21tZW5kYXRpb24uYmluZChmKSwgQ1hFTlNFOiBoLl9fcHJvdGVjdGVkX18uc2hvd1JlY29tbWVuZGF0aW9uLmJpbmQoaCkgfVtlXSB8fCBmdW5jdGlvbiAoKSB7IH07IH0oZS5ldmVudFBhcmFtcy50eXBlKSk7IH0sIGlzQWN0aW9uOiAhMCwgc2hvdWxkRmlyZUNhbGxiYWNrOiAhMCB9LCBzaG93T2ZmZXI6IHsgZm46IGZ1bmN0aW9uIChlKSB7IHJldHVybiBtZShlLCAoZnVuY3Rpb24gKGUpIHsgcmV0dXJuIHBuLm9mZmVyLnNob3coZSk7IH0pKTsgfSwgaXNBY3Rpb246ICEwLCBzaG91bGRGaXJlQ2FsbGJhY2s6ICExIH0sIHNob3dUZW1wbGF0ZTogeyBmbjogZ2UsIGlzQWN0aW9uOiAhMCwgc2hvdWxkRmlyZUNhbGxiYWNrOiAhMSB9LCBzaG93WnVvcmFPZmZlcjogeyBmbjogZ2UsIGlzQWN0aW9uOiAhMCwgc2hvdWxkRmlyZUNhbGxiYWNrOiAhMSB9LCBzaG93TmV3c2N5Y2xlT2ZmZXI6IHsgZm46IGdlLCBpc0FjdGlvbjogITAsIHNob3VsZEZpcmVDYWxsYmFjazogITEgfSwgc2hvd05ld3NsZXR0ZXJTaWdudXA6IHsgZm46IGZ1bmN0aW9uIChlKSB7IHJldHVybiBtZShlLCAoZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGYuX19wcm90ZWN0ZWRfXy5zaG93TmV3c2xldHRlclNpZ251cChlKTsgfSkpOyB9LCBpc0FjdGlvbjogITAsIHNob3VsZEZpcmVDYWxsYmFjazogITEgfSwgc2hvd1B1c2hTaWduVXA6IHsgZm46IGZ1bmN0aW9uIChlKSB7IHJldHVybiBtZShlLCAoZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGYuX19wcm90ZWN0ZWRfXy5zaG93UHVzaFNpZ251cChlKTsgfSkpOyB9LCBpc0FjdGlvbjogITAsIHNob3VsZEZpcmVDYWxsYmFjazogITEgfSwgc2hvd0xvZ2luOiB7IGZuOiBmdW5jdGlvbiAoKSB7IHYuc2hvd0xvZ2luKHt9KTsgfSwgaXNBY3Rpb246ICEwLCBzaG91bGRGaXJlQ2FsbGJhY2s6ICEwIH0sIGNvbnRpbnVlRXhlY3V0aW9uOiB7IGZuOiBmdW5jdGlvbiAoZSwgbikgeyBvLmRlYnVnKFwiZXhwOiBjb250aW51ZSBleGVjdXRpb24gYWN0aW9uOlwiLCBlLCBcIndpdGggcmVxdWVzdFBhcmFtZXRlcnNcIiwgbik7IHZhciB0ID0gbiB8fCB7fTsgdC5leHBlcmllbmNlX2lkID0gZS5ldmVudEV4ZWN1dGlvbkNvbnRleHQuZXhwZXJpZW5jZUlkLCB0LmV4cGVyaWVuY2VfdmVyc2lvbiA9IGUuZXZlbnRFeGVjdXRpb25Db250ZXh0LmV4cGVyaWVuY2VWZXJzaW9uLCB0LmNvbnRleHRfZGF0YSA9IGUuZXZlbnRQYXJhbXMuY29udGV4dERhdGEsIFEoXCJhdXRvXCIsIHQsICEwKTsgfSwgc2hvdWxkRmlyZUNhbGxiYWNrOiAhMCB9LCBjb250aW51ZUV4ZWN1dGlvbkNvbXBsZXRlZDogeyBmbjogYmUsIHNob3VsZEZpcmVDYWxsYmFjazogITAgfSwgbWV0ZXJBY3RpdmU6IHsgZm46IGJlLCBzaG91bGRGaXJlQ2FsbGJhY2s6ICEwIH0sIG1ldGVyRXhwaXJlZDogeyBmbjogYmUsIHNob3VsZEZpcmVDYWxsYmFjazogITAgfSwgdXNlclNlZ21lbnRUcnVlOiB7IGZuOiBwZSwgc2hvdWxkRmlyZUNhbGxiYWNrOiAhMCB9LCB1c2VyU2VnbWVudEZhbHNlOiB7IGZuOiBwZSwgc2hvdWxkRmlyZUNhbGxiYWNrOiAhMCB9LCBleHBlcmllbmNlRXhlY3V0aW9uRmFpbGVkOiB7IGZuOiBiZSwgc2hvdWxkRmlyZUNhbGxiYWNrOiAhMCB9LCBsb2c6IHsgZm46IGZ1bmN0aW9uIChlKSB7IGVlKGUuZXZlbnRNb2R1bGVQYXJhbXMubW9kdWxlSWQsIGUpOyB9LCBzaG91bGRGaXJlQ2FsbGJhY2s6ICExIH0sIGV4cGVyaWVuY2VFeGVjdXRlOiB7IGZuOiBmdW5jdGlvbiAoZSwgbiwgdCkgeyBlLmV2ZW50UGFyYW1zLnJlc3VsdCA9IHQ7IH0sIHNob3VsZEZpcmVDYWxsYmFjazogITAgfSwgc2V0UmVzcG9uc2VWYXJpYWJsZTogeyBmbjogZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGUuZXZlbnRQYXJhbXM7IH0sIGlzQWN0aW9uOiAhMCwgc2hvdWxkRmlyZUNhbGxiYWNrOiAhMCB9LCBjcmVkaXRSZWRlZW1lZDogeyBmbjogZnVuY3Rpb24gKGUpIHsgby5kZWJ1ZyhcImV4cDogY3JlZGl0IHJlZGVlbWVkIGFjdGlvbjpcIiwgZSk7IH0sIGlzQWN0aW9uOiAhMCwgc2hvdWxkRmlyZUNhbGxiYWNrOiAhMCB9IH0sIHQgPSB7fSwgT2JqZWN0LmtleXMobikuZm9yRWFjaCgoZnVuY3Rpb24gKGUpIHsgaWYgKFwiZnVuY3Rpb25cIiAhPSB0eXBlb2YgbltlXS5mbilcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVW5zdXBwb3J0ZWQgY29uZmlnIGZvciBcIiArIGUgKyBcIiBoYW5kbGVyXCIpOyB0W2VdID0gZnVuY3Rpb24gKGUsIG4pIHsgcmV0dXJuIGZ1bmN0aW9uICh0LCByLCBpKSB7IGlmIChlLmlzQWN0aW9uKSB7XG4gICAgICAgIHZhciBhID0gZnVuY3Rpb24gKGUpIHsgdmFyIG4gPSBlLmV2ZW50UGFyYW1zLCB0ID0gZS5ldmVudE1vZHVsZVBhcmFtcywgciA9IGUuZXZlbnRFeGVjdXRpb25Db250ZXh0OyByZXR1cm4gby5kZWJ1ZyhcImV4cDogZmlyZSBldmVudCAnYmVmb3JlQ29tcG9zZXJBY3Rpb24nIHdpdGggZXZlbnRQYXJhbXM6XCIsIG4sIFwiLCBtb2R1bGVQYXJhbXM6XCIsIHQsIFwiLCBjb250ZXh0OlwiLCByKSwgQi5maXJlQ2FsbGJhY2tzQW5kU3RvcE9uRmlyc3RGYWxzZShcImJlZm9yZUNvbXBvc2VyQWN0aW9uXCIsIG4sIHQsIHIpOyB9KHQpO1xuICAgICAgICBpZiAoIWEpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIHZhciBzID0gcmUodCksIGMgPSB0ZSh0KTtcbiAgICAgICAgKHMgfHwgYykgJiYgZWUodC5ldmVudE1vZHVsZVBhcmFtcy5tb2R1bGVJZCwgdCk7XG4gICAgfSB2YXIgbCwgdSA9IHQuZXZlbnRNb2R1bGVQYXJhbXMubW9kdWxlSWQ7IFNbdV0gfHwgXCJOL0FcIiA9PT0gdSB8fCAoU1t1XSA9IHsgZXhwZXJpZW5jZUlkOiB0LmV2ZW50RXhlY3V0aW9uQ29udGV4dC5leHBlcmllbmNlSWQsIG1vZHVsZU5hbWU6IHQuZXZlbnRNb2R1bGVQYXJhbXMubW9kdWxlTmFtZSB9KSwgZS5mbih0LCByLCBpKSwgZS5zaG91bGRGaXJlQ2FsbGJhY2sgJiYgKGwgPSBuLCBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IGUuZXZlbnRQYXJhbXMuY2FsbGJhY2ssIHQgPSBlLmV2ZW50UGFyYW1zLCByID0gZS5ldmVudE1vZHVsZVBhcmFtcywgaSA9IGUuZXZlbnRFeGVjdXRpb25Db250ZXh0OyBvLmRlYnVnKFwiZXhwOiBmaXJlIGV2ZW50IFwiLCBsLCBcIiB3aXRoIGV2ZW50UGFyYW1zOlwiLCB0LCBcIiwgbW9kdWxlUGFyYW1zOlwiLCByLCBcIiwgY29udGV4dDpcIiwgaSksIEIuZmlyZShcImV4cGVyaWVuY2VcIiwgbCwgITAsIHQsIHIsIGkpLCBuICYmIGwgIT09IG4gJiYgKG8uZGVidWcoXCJleHA6IGV4ZWN1dGUgZXZlbnQgXCIsIGwsIFwiIHdpdGggY2FsbGJhY2s6IFwiLCBuKSwgZmUobikpOyB9KSh0KTsgfTsgfShuW2VdLCBlKTsgfSkpLCB0KSwgUCA9IHsgc2hvd09mZmVyOiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gdmUoZSwgKGZ1bmN0aW9uIChlKSB7IHJldHVybiBwbi5vZmZlci5kZWZlcnJlZFNob3coZSk7IH0pKTsgfSwgc2hvd1RlbXBsYXRlOiBoZSwgc2hvd1p1b3JhT2ZmZXI6IGhlLCBzaG93TmV3c2N5Y2xlT2ZmZXI6IGhlIH0sIEUgPSBvLnByb2ZpbGUoKGZ1bmN0aW9uIChlKSB7IFEoXCJtYW51YWxcIiwgZSwgITEpOyB9KSksIFQgPSBmdW5jdGlvbiAoZSwgbikgeyBCLmFkZEV2ZW50KGUpLCBCLnJlZ2lzdGVyQ2FsbGJhY2soZSwgbik7IH0sIEEgPSBcInhiY1wiLCBNID0ge30sIE8gPSBcIlwiLCBSID0gXCJcIiwgTCA9IFwiXCIsIE4gPSBbXSwgVSA9IFwiaGFuZGxlclwiLCBqID0gXCJldmVudENvbmRpdGlvblwiLCBEID0gXCJpbm5lckV2ZW50Q29uZGl0aW9uXCIsIEYgPSBcInByZWxvYWRcIiwgQiA9IGEuY3JlYXRlRXZlbnRNYW5hZ2VyKFtdKSwgViA9IFtcInNob3dPZmZlclwiLCBcInNob3dadW9yYU9mZmVyXCIsIFwic2hvd05ld3NjeWNsZU9mZmVyXCIsIFwic2hvd1RlbXBsYXRlXCJdOyB2YXIgcSwgeiA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHk7IH0sIEggPSBmdW5jdGlvbiAoKSB7IHkgPSBbXTsgfSwgVyA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHBuLmdldFRyYWNraW5nRW5kcG9pbnQocG4uY29tcG9zZXJIb3N0KSArIFwiL2FwaS92M1wiOyB9LCBKID0gZnVuY3Rpb24gKCkgeyBnLl9fcHJvdGVjdGVkX18uaW5pdCgpOyB9LCBHID0gZnVuY3Rpb24gKGUpIHsgdmFyIG4gPSB6KCk7IG4ubGVuZ3RoICYmIChjLmxvZ0JlYWNvblJlcXVlc3QoVygpICsgXCIvY29tcG9zZXIvbG9nRXhlY3V0aW9uU3RhdHNcIiwgeyBhaWQ6IHBuLmFpZCwgaXRlbXM6IEpTT04uc3RyaW5naWZ5KG4pLCBleGVjdXRpb25fc3RhdHNfY29udGV4dDogaywgdHM6IChuZXcgRGF0ZSkuZ2V0VGltZSgpLCBzb3VyY2U6IGUgfSksIEgoKSksIHdpbmRvdy5jbGVhclRpbWVvdXQocSksIHEgPSB3aW5kb3cuc2V0VGltZW91dCgoZnVuY3Rpb24gKCkgeyBHKFwidGltZXJcIiArIHEpOyB9KSwgMmUzKTsgfSwgUSA9IGZ1bmN0aW9uIChlLCBuLCB0KSB7IHZvaWQgMCA9PT0gcG4ubWFpbi5hcHBIYXNBcHBsZVBheSgpICYmIEIuZmlyZUNhbGxiYWNrcyhcImV4cGVyaWVuY2VGbG93XCIsIG51bGwsIFwiZXhwZXJpZW5jZVwiLCAhMCk7IHZhciBpID0gbmV3IFByb21pc2UoKGZ1bmN0aW9uIChlKSB7IHNldFRpbWVvdXQoKGZ1bmN0aW9uICgpIHsgZSh7fSk7IH0pLCAzZTQpOyB9KSk7IHJldHVybiBQcm9taXNlLnJhY2UoW3BuLm1haW4uZXh0ZXJuYWxSZXNvdXJjZXNEZWxheSgpLCBpXSkudGhlbigoZnVuY3Rpb24gKGkpIHsgaWYgKHIuaXNQbGFpbk9iamVjdChpKSB8fCAoby5lcnJvcihcImV4cDogZXJyb3IgZ2V0IGV4dGVybmFsIHJlc291cmNlcyBcIiwgaSksIGkgPSB7fSksIGguX19wcm90ZWN0ZWRfXy5pc0FjdGl2YXRlZCgpKSB7XG4gICAgICAgIG8uZGVidWcoXCJjMXg6IGludGVncmF0aW9uIGlzIGFjdGl2YXRlZFwiKSwgaC5fX3Byb3RlY3RlZF9fLmxvYWRDeExpYklmTmVlZGVkKCk7XG4gICAgICAgIHZhciBhID0gci5kZWVwRXh0ZW5kKHt9LCBuLCBpLCB7IGMxeF9pbnRlZ3JhdGlvbl92ZXJzaW9uOiBcInYyXCIsIG5ld19iaWQ6IHBuLm1haW4uZmV0Y2hDeEJyb3dzZXJJZCgpIH0pO1xuICAgICAgICBYKGUsIGEsIHQpO1xuICAgIH1cbiAgICBlbHNlXG4gICAgICAgIFgoZSwgci5kZWVwRXh0ZW5kKHt9LCBuLCBpKSwgdCk7IH0pKS5jYXRjaCgoZnVuY3Rpb24gKGUpIHsgfSkpOyB9LCBYID0gZnVuY3Rpb24gKGUsIG4sIHQpIHsgbiA9IG4gfHwge307IHZhciBhID0gci5kZWVwRXh0ZW5kKHt9LCB7IHByb3RvY29sX3ZlcnNpb246IDEgfSwgbik7ICQoYSksIFkoYSksIG8uaGFzUXVlcnlQYXJhbUJ5TmFtZShDKSAmJiAoYS5yZWFkZXJfaWQgPSBvLmdldFF1ZXJ5UGFyYW1CeU5hbWUoQykpLCBvLndhaXRDYWxsKFwicmVmcmVzaFVzZXJUb2tlblwiLCAoZnVuY3Rpb24gKCkgeyBpZiAodClcbiAgICAgICAgYS5leGVjdXRlZF9ub2RlcyA9IEpTT04uc3RyaW5naWZ5KFMpO1xuICAgIGVsc2Uge1xuICAgICAgICBwbi5tYWluLnRyYWNrUGFnZVVubG9hZElmTmVjZXNzYXJ5KCksIEsoYSksIGkuZ2V0Q2FsbFBhcmFtcyhhLCB2LmdldFByb3ZpZGVyKCkpLCBvLnJlbW92ZUFmZmlsaWF0ZVRva2VuKCk7XG4gICAgICAgIHZhciBuID0geyB1cmw6IHdpbmRvdy5sb2NhdGlvbi5ocmVmLCB0YWdzOiBwbi50YWdzLCBzdWJtaXRUeXBlOiBlIH07XG4gICAgICAgIHBuLm1haW4uYnVpbGRQYWdlVHJhY2tQYXJhbXMoYSwgbik7XG4gICAgfSBvLmRlYnVnKFwiZXhwOiBFeHBlcmllbmNlIGluaXRpYWxpemVkIHdpdGggcGFyYW1zOlwiLCBhKSwgby53YWl0Q2FsbChcInJlZnJlc2hBY2Nlc3NUb2tlbkxpc3RcIiwgKGZ1bmN0aW9uICgpIHsgby5zdGFydENhbGwoXCJleHBlcmllbmNlRXhlY3V0ZVwiKTsgdmFyIGUsIG4sIGkgPSAoby5fX3Byb3RlY3RlZF9fLmNhbWVGcm9tRmJTdWJzY3JpcHRpb25zKCkgPyAoZSA9IFwiL3hidWlsZGVyL2V4cGVyaWVuY2UvZXhlY3V0ZUZiaWFcIiwgSigpKSA6IGUgPSBcIi94YnVpbGRlci9leHBlcmllbmNlL2V4ZWN1dGVcIiwgcG4uZ2V0RXhwZXJpZW5jZUVuZHBvaW50KCExKSArIGUpOyBpZiAoLTEgIT09IG5hdmlnYXRvci5hcHBWZXJzaW9uLmluZGV4T2YoXCJNU0lFIDlcIikpXG4gICAgICAgIG4gPSB7IGRhdGFUeXBlOiBcImpzb25wXCIsIHVybDogaSArIFwiP1wiICsgci5wYXJhbShhKSB9O1xuICAgIGVsc2Uge1xuICAgICAgICB2YXIgcyA9IFwiP1wiICsgci5wYXJhbSh7IGFpZDogYS5haWQgfSk7XG4gICAgICAgIG4gPSB7IHR5cGU6IFwicG9zdFwiLCB1cmw6IGkgKyBzLCBkYXRhOiBhLCB4aHJGaWVsZHM6IHsgd2l0aENyZWRlbnRpYWxzOiAhMCB9IH07XG4gICAgfSBuLnN1Y2Nlc3MgPSBmdW5jdGlvbiAoZSkgeyBvLmRvbmVDYWxsKFwiZXhwZXJpZW5jZUV4ZWN1dGVcIik7IHZhciBuID0gci5kZWVwRXh0ZW5kKHt9LCBhKTsgdCB8fCAod2UoKSwgcG4ubWFpbi5yZWdpc3RlclRyYWNrVW5sb2FkKCkpLCBaKGUuZXJyb3JzKSwgZGUoZS5tb2RlbHMsIG4pOyB9LCBuLmVycm9yID0gZnVuY3Rpb24gKCkgeyBvLmRvbmVDYWxsKFwiZXhwZXJpZW5jZUV4ZWN1dGVcIiksIHQgfHwgd2UoKTsgdmFyIGUgPSB7IGNvZGU6IDUwMywgbWVzc2FnZTogXCJFcnJvcjogUmVjZWl2ZWQgZXJyb3Igd2hlbiByZXF1ZXN0aW5nIEFQSSByZXNwb25zZSBmcm9tIFVSTDogXCIgKyBpIH07IG8uZGVidWcoZS5tZXNzYWdlKTsgfSwgbC5yZXF1ZXN0KG4pOyB9KSk7IH0pKTsgfSwgJCA9IGZ1bmN0aW9uIChlKSB7IHZhciBuID0gby5fX3Byb3RlY3RlZF9fLmdldENvb2tpZShBKTsgbiAmJiAoZS54YmMgPSBuKTsgdmFyIHQgPSBvLmdldFRiY0Nvb2tpZSgpOyB0ICYmIHQubGVuZ3RoID4gMCAmJiAoZS50YmMgPSB0KSwgby5nZXRDYW1wYWlnbnMoZSksIGUuY3VzdG9tX2Nvb2tpZXMgPSBKU09OLnN0cmluZ2lmeShvLmdldEN1c3RvbUNvb2tpZXMoKSk7IH0sIFkgPSBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IG8uZ2V0UHVzaExpc3RzQ29va2llKCksIHQgPSBmLl9fcHJvdGVjdGVkX18uZ2V0Tm90aWZpY2F0aW9uU3RhdHVzKCk7IG4gJiYgbi5sZW5ndGggPiAwICYmIChlLnB1c2hfbGlzdF9zdWJzY3JpcHRpb25zID0gSlNPTi5zdHJpbmdpZnkobikpLCB0ICYmIChlLnB1c2hfbm90aWZpY2F0aW9uX3NldHRpbmdzID0gdCk7IH0sIEsgPSBmdW5jdGlvbiAoZSkgeyByZXR1cm4gW3sgcHJvcGVydHk6IFwiZGVidWdcIiwgcGFyYW1ldGVyOiBcImRlYnVnXCIgfSwgeyBwcm9wZXJ0eTogXCJ0cmFja1BhZ2VWaWV3XCIsIHBhcmFtZXRlcjogXCJpbmNyZW1lbnRfcGFnZXZpZXdfbWV0ZXJcIiB9XS5mb3JFYWNoKChmdW5jdGlvbiAobikgeyB2b2lkIDAgIT09IHBuW24ucHJvcGVydHldICYmIChlW24ucGFyYW1ldGVyXSA9IHBuW24ucHJvcGVydHldKTsgfSkpLCBlOyB9LCBaID0gZnVuY3Rpb24gKGUpIHsgQXJyYXkuaXNBcnJheShlKSAmJiAoZS5sZW5ndGggJiYgby5kZWJ1ZyhcImV4cDogY29tcG9zZXIgZXhlY3V0aW9uIGhhcyBiZWVuIGZhaWxlZCB3aXRoIGVycm9yc1wiKSwgZS5mb3JFYWNoKChmdW5jdGlvbiAoZSkgeyBvLmRlYnVnKFwiZXhwOiBcIiArIGUubXNnKTsgfSkpKTsgfSwgZWUgPSBmdW5jdGlvbiAoZSwgbikgeyB2YXIgdDsgdCA9IHsgbUlkOiBlLCBlSWQ6IG4uZXZlbnRFeGVjdXRpb25Db250ZXh0LmV4cGVyaWVuY2VJZCwgZVY6IG4uZXZlbnRFeGVjdXRpb25Db250ZXh0LmV4cGVyaWVuY2VWZXJzaW9uLCBlZUlkOiBuLmV2ZW50RXhlY3V0aW9uQ29udGV4dC5leGVjdXRpb25JZCB9LCB5LnB1c2godCk7IH07IGZ1bmN0aW9uIG5lKGUsIG4sIHQsIHIpIHsgcmV0dXJuIHsgdHlwZTogVSwgZXZlbnRUeXBlOiBuLmV2ZW50VHlwZSwgY2hpbGRyZW46IFtdLCBydW46IGZ1bmN0aW9uICgpIHsgZS5iaW5kKHRoaXMsIG4sIHQsIHIpKCk7IH0gfTsgfSB2YXIgdGUgPSBmdW5jdGlvbiAoZSkgeyB2YXIgbiwgdCA9IGUuZXZlbnRQYXJhbXMuZGVsYXlCeSB8fCB7fTsgcmV0dXJuIHQudmFsdWUgJiYgKFwidGltZVwiID09PSB0LnR5cGUgPyBuID0geyB0eXBlOiBcInRpbWVyXCIsIHRpbWVyOiB0LnZhbHVlIH0gOiBcInNjcm9sbFwiID09PSB0LnR5cGUgJiYgKG4gPSB7IHR5cGU6IFwic2Nyb2xsRGVwdGhcIiwgc2Nyb2xsRGVwdGg6IHQudmFsdWUsIG1lYXN1cmVUeXBlOiBcInBpeGVsc1wiIH0pKSwgbjsgfSwgcmUgPSBmdW5jdGlvbiAoZSkgeyByZXR1cm4gZS5ldmVudENvbmRpdGlvbnMgJiYgQXJyYXkuaXNBcnJheShlLmV2ZW50Q29uZGl0aW9ucykgPyBlLmV2ZW50Q29uZGl0aW9ucy5sZW5ndGggOiAwOyB9LCBvZSA9IGZ1bmN0aW9uIChlLCBuKSB7IHJldHVybiByID0gITEsIHsgdHlwZTogRiwgZXZlbnRUeXBlOiBuLmV2ZW50VHlwZSwgY2hpbGRyZW46IFtdLCBydW46IGZ1bmN0aW9uICgpIHsgITEgPT09IHIgJiYgKHQgPSBlKG4pLCByID0gITApOyB9LCBnZXRQcmVsb2FkUmVzdWx0OiBmdW5jdGlvbiAoKSB7IHJldHVybiB0OyB9IH07IHZhciB0LCByOyB9OyBmdW5jdGlvbiBpZShlLCBuKSB7IHZhciB0ID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gQi5maXJlQ2FsbGJhY2tzQW5kU3RvcE9uRmlyc3RGYWxzZShcImJlZm9yZUJyb3dzZXJFdmVudFwiLCBlKTsgfTsgc3dpdGNoIChlLnR5cGUpIHtcbiAgICAgICAgY2FzZSBcInZpZXdwb3J0RXhpdFwiOlxuICAgICAgICAgICAgdS5hZGRMaXN0ZW5lcihuLCB7IGRldGVjdEV4aXRNb2RlOiBlLmRldGVjdEV4aXRNb2RlLCBkZXRlY3RCYWNrQnV0dG9uRm9yTW9iaWxlOiBlLmRldGVjdEJhY2tCdXR0b25Gb3JNb2JpbGUsIGNsaWVudERldmljZTogZS5jbGllbnREZXZpY2UgfSwgdCk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcInNjcm9sbERlcHRoXCI6XG4gICAgICAgICAgICBzLmFkZExpc3RlbmVyKG4sIHsgc2Nyb2xsRGVwdGg6IGUuc2Nyb2xsRGVwdGgsIG1lYXN1cmVUeXBlOiBlLm1lYXN1cmVUeXBlIH0sIHQpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJ0aW1lclwiOlxuICAgICAgICAgICAgdmFyIHIgPSBzZXRUaW1lb3V0KChmdW5jdGlvbiAoKSB7IHQoKSAmJiBuKCk7IH0pLCAxZTMgKiBlLnRpbWVyKTtcbiAgICAgICAgICAgIE4ucHVzaChyKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiaW50ZXJhY3Rpb25cIjpcbiAgICAgICAgICAgIHAuYmluZChuLCBlLmludGVyYWN0aW9ucywgdCk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImlkbGVcIjogZC5hZGRMaXN0ZW5lcihuLCBlLmlkbGVUaW1lLCB0KTtcbiAgICB9IH0gdmFyIGFlID0gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGUudHlwZSA9PT0gVSAmJiAtMSA9PT0gW1wiY29udGludWVFeGVjdXRpb25cIiwgXCJtZXRlckFjdGl2ZVwiLCBcIm1ldGVyRXhwaXJlZFwiXS5pbmRleE9mKGUuZXZlbnRUeXBlKTsgfTsgZnVuY3Rpb24gc2UoZSwgbikgeyByZXR1cm4gdCA9ICExLCByID0gZnVuY3Rpb24gKCkgeyBlZShlLm1vZHVsZUlkLCBuKTsgZm9yICh2YXIgciA9IGJbZS5tb2R1bGVJZF0uY2hpbGRyZW4sIGkgPSAwOyBpIDwgci5sZW5ndGg7IGkrKykge1xuICAgICAgICB2YXIgYSA9IHJbaV0sIHMgPSBiW2FdO1xuICAgICAgICBpZiAoITEgPT09IHQgfHwgYWUocykpXG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHMucnVuKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIG8uZXJyb3IoXCJleHA6IGVycm9yIGV4ZWN1dGUgY2hhaW4gZXZlbnRcIiwgcywgZSk7XG4gICAgICAgICAgICB9XG4gICAgfSB0ID0gITAsIF8gJiYgRyhcImNoYWluXCIpOyB9LCB7IHR5cGU6IGosIGNoaWxkcmVuOiBbXSwgcnVuOiBmdW5jdGlvbiAoKSB7IGllKGUsIHIpOyB9IH07IHZhciB0LCByOyB9IGZ1bmN0aW9uIGNlKGUsIG4pIHsgcmV0dXJuIHQgPSAhMSwgciA9IGZ1bmN0aW9uICgpIHsgZm9yICh2YXIgZSA9IGJbbiArIERdLmNoaWxkcmVuLCByID0gMDsgciA8IGUubGVuZ3RoOyByKyspIHtcbiAgICAgICAgdmFyIGkgPSBlW3JdLCBhID0gYltpXTtcbiAgICAgICAgaWYgKCExID09PSB0IHx8IGFlKGEpKVxuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBhLnJ1bigpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICBvLmVycm9yKFwiZXhwOiBlcnJvciBleGVjdXRlIGNoYWluIGV2ZW50XCIsIGEsIGUpO1xuICAgICAgICAgICAgfVxuICAgIH0gdCA9ICEwOyB9LCB7IHR5cGU6IEQsIGNoaWxkcmVuOiBbbl0sIHJ1bjogZnVuY3Rpb24gKCkgeyBpZShlLCByKTsgfSB9OyB2YXIgdCwgcjsgfSB2YXIgbGUgPSBmdW5jdGlvbiAoZSkgeyB2YXIgbjsgZS5zd2dNYXJrdXBEYXRhICYmIChvLmRlYnVnKFwiZXhwOiBzd2cgbWFya3VwIGRhdGEgOlwiLCBlLnN3Z01hcmt1cERhdGEpLCBuID0gZS5zd2dNYXJrdXBEYXRhLCBtLl9fcHJvdGVjdGVkX18uaW5qZWN0TWFya3VwKG4pLCBlLnN3Z01hcmt1cERhdGEuaXNBY2Nlc3NpYmxlRm9yRnJlZSB8fCBtLl9fcHJvdGVjdGVkX18uYWRkTGlicmFyeSgpKSwgZS5zd2dFbmFibGVkICYmIG0uX19wcm90ZWN0ZWRfXy5pbml0U3dnRmxvdygpOyB9LCB1ZSA9IGZ1bmN0aW9uIChlKSB7IGlmIChlKSB7XG4gICAgICAgIGZvciAodmFyIG4gPSB7fSwgdCA9IDA7IHQgPCBlLmV2ZW50cy5sZW5ndGg7IHQrKykge1xuICAgICAgICAgICAgdmFyIGkgPSBlLmV2ZW50c1t0XTtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgXCJleHBlcmllbmNlRXhlY3V0ZVwiID09PSBpLmV2ZW50VHlwZSAmJiAoKG4gPSByLmRlZXBFeHRlbmQoe30sIGkuZXZlbnRFeGVjdXRpb25Db250ZXh0KSkucmVzdWx0ID0gci5kZWVwRXh0ZW5kKHt9LCBlKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIG8uZXJyb3IoXCJleHA6IGVycm9yIG9uIGV4ZWN1dGUgZXZlbnQ6IFwiLCBpLCBlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbjtcbiAgICB9IG8uZGVidWcoXCJleHA6IG5vIGNvbXBvc2VyIGV4ZWN1dGlvbiByZXN1bHRcIik7IH0sIGRlID0gZnVuY3Rpb24gKGUsIG4pIHsgaWYgKGUpIHtcbiAgICAgICAgdmFyIHQsIGk7XG4gICAgICAgIGlmIChvLnNldFRiY0Nvb2tpZUZyb21SZXNwb25zZShlKSwgby5zZXRUYWNDb29raWVGcm9tUmVzcG9uc2UoZSksIHQgPSBlLCBoLl9fcHJvdGVjdGVkX18uaXNBY3RpdmF0ZWQoKSAmJiBoLl9fcHJvdGVjdGVkX18uaXNDdXN0b21lclByZWZpeENvbmZpZ3VyZWQodCkgJiYgdCAmJiB0LmJpZCAmJiBoLl9fcHJvdGVjdGVkX18uc2V0Q3hCaWRDb29raWUodC5iaWQsIG51bGwgPT09IChpID0gdC50YmMpIHx8IHZvaWQgMCA9PT0gaSA/IHZvaWQgMCA6IGkuY29va2llX2RvbWFpbiksIG8uc2V0QXBwVGltZXpvbmVPZmZzZXRGcm9tUmVzcG9uc2UoZSksIG8uc2V0Q3VycmVudERvbWFpbkZyb21SZXNwb25zZShlKSwgZnVuY3Rpb24gKGUpIHsgZi5fX3Byb3RlY3RlZF9fLnNldFZpc2l0b3JJZChlLmJpZCk7IH0oZSksIGZ1bmN0aW9uIChlKSB7IGguX19wcm90ZWN0ZWRfXy5zZW5kUGFnZVZpZXdFdmVudCh7IGJyb3dzZXJJZDogZS5iaWQsIHVpZDogZS51aWQsIGN4ZW5zZUN1c3RvbWVyUHJlZml4OiBlLmN4ZW5zZUN1c3RvbWVyUHJlZml4LCBwYWdlVmlld0lkOiBwbi5tYWluLmZldGNoUGFnZVZpZXdJZCgpLCBldmVudEV4ZWN1dGlvbkNvbnRleHQ6IHVlKGUucmVzdWx0KSB9KTsgfShlKSwgZnVuY3Rpb24gKGUpIHsgTyA9IGUuYmlkOyB9KGUpLCBmdW5jdGlvbiAoZSkgeyBlLmlzcyAmJiAoUiA9IGUuaXNzKTsgfShlKSwgZnVuY3Rpb24gKGUpIHsgTCA9IGUuaXRlbUlkOyB9KGUpLCBlLnhiYyAmJiBlLnhiYy5jb29raWVfdmFsdWUpIHtcbiAgICAgICAgICAgIHZhciBhID0geyBwYXRoOiBcIi9cIiwgZXhwaXJlczogNzMwIH07XG4gICAgICAgICAgICBpZiAoZS54YmMuY29va2llX2RvbWFpbiAmJiBcImxvY2FsaG9zdFwiICE9PSBlLnhiYy5jb29raWVfZG9tYWluICYmIChhLmRvbWFpbiA9IGUueGJjLmNvb2tpZV9kb21haW4sIG8uX19wcm90ZWN0ZWRfXy5kZWxldGVUTERDb29raWVGb3JTcGVjaWZpY0RvbWFpbnMoQSwgZS54YmMuY29va2llX2RvbWFpbikpLCBwbi5jb29raWVEb21haW4gfHwgcG4uY29va2llUGF0aCkge1xuICAgICAgICAgICAgICAgIHZhciBzID0gby5nZXRQb3NzaWJsZUNvb2tpZURvbWFpbnMoKTtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBjIGluIHMpXG4gICAgICAgICAgICAgICAgICAgIG8uZGVsZXRlQ29va2llKEEsIHNbY10pO1xuICAgICAgICAgICAgICAgIGEuZG9tYWluID0gcG4uY29va2llRG9tYWluID8gcG4uY29va2llRG9tYWluIDogYS5kb21haW4sIG8uX19wcm90ZWN0ZWRfXy5kZWxldGVUTERDb29raWVGb3JTcGVjaWZpY0RvbWFpbnMoQSwgYS5kb21haW4sIGEucGF0aCksIGEucGF0aCA9IHBuLmNvb2tpZVBhdGggPyBwbi5jb29raWVQYXRoIDogYS5wYXRoLCBvLl9fcHJvdGVjdGVkX18uZGVsZXRlVExEQ29va2llRm9yU3BlY2lmaWNEb21haW5zKEEsIGEuZG9tYWluLCBhLnBhdGgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgby5kZWxldGVDb29raWUoQSksIG8uX19wcm90ZWN0ZWRfXy5zZXRDb29raWUoQSwgZS54YmMuY29va2llX3ZhbHVlLCBhKTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgbCA9IGUucmVzdWx0LCB1ID0ge307XG4gICAgICAgIGlmIChsKSB7XG4gICAgICAgICAgICBsZShsKSwgby5kZWJ1ZyhcImV4cDogcHJvY2Vzc2VkIGV4cGVyaWVuY2VzIDpcIiwgbC5leHBlcmllbmNlcyksIGsgPSBlLmV4ZWN1dGlvblN0YXRzQ29udGV4dCwgbC5kZWJ1Z01lc3NhZ2VzLmZvckVhY2goKGZ1bmN0aW9uIChlKSB7IG8uZGVidWcoXCJleHA6IGV4ZWN1dGUgOlwiLCBlKTsgfSkpO1xuICAgICAgICAgICAgZm9yICh2YXIgZCwgcCA9IGZ1bmN0aW9uIChlLCBuLCB0KSB7IGZvciAodmFyIHIgPSBlLmV2ZW50Q29uZGl0aW9ucywgaSA9IDA7IGkgPCByLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgdmFyIGEgPSByW2ldLCBzID0gYS5tb2R1bGVJZCwgYyA9IHJbaSAtIDFdLCBsID0gIXJbaSArIDFdO1xuICAgICAgICAgICAgICAgIGlmIChiW3NdIHx8IChiW3NdID0gc2UoYSwgZSkpLCBsKVxuICAgICAgICAgICAgICAgICAgICBpZiAoYltzXS5jaGlsZHJlbi5wdXNoKG4pLCAtMSAhPT0gVi5pbmRleE9mKGUuZXZlbnRUeXBlKSAmJiBcInZpZXdwb3J0RXhpdFwiID09PSBhLnR5cGUgJiYgIXRlKGUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdSA9IFBbZS5ldmVudFR5cGVdO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF1KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgby5lcnJvcihcImV4cDogbm90IGZvdW5kIHByZWxvYWQgaGFuZGxlciBmb3IgZXZlbnQ6IFwiLCBlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkID0gbiArIEY7XG4gICAgICAgICAgICAgICAgICAgICAgICBiW2RdID0gb2UodSwgZSksIGMgPyBiW2MubW9kdWxlSWRdLmNoaWxkcmVuLnB1c2goZCkgOiB0LnB1c2goZCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjICYmIC0xID09PSBiW2MubW9kdWxlSWRdLmNoaWxkcmVuLmluZGV4T2YocykgJiYgYltjLm1vZHVsZUlkXS5jaGlsZHJlbi5wdXNoKHMpO1xuICAgICAgICAgICAgfSB9LCBtID0gW10sIGcgPSAwLCB2ID0gMDsgdiA8IGwuZXZlbnRzLmxlbmd0aDsgdisrKSB7XG4gICAgICAgICAgICAgICAgdmFyIHcgPSBsLmV2ZW50c1t2XTtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgeSA9IHcuZXZlbnRUeXBlLCBDID0gdy5ldmVudE1vZHVsZVBhcmFtcyB8fCB7fTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG8uZGVidWcoXCJleHA6IHByb2Nlc3MgZXZlbnQgJ1wiICsgeSArIFwiJyAoXCIgKyBDLm1vZHVsZUlkICsgXCIpXCIpLCBcImV4cGVyaWVuY2VFeGVjdXRlXCIgPT09IHkgJiYgKCh1ID0gci5kZWVwRXh0ZW5kKHt9LCB3LmV2ZW50RXhlY3V0aW9uQ29udGV4dCkpLnJlc3VsdCA9IHIuZGVlcEV4dGVuZCh7fSwgbCkpLCAhKGQgPSBDLm1vZHVsZUlkKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgby5lcnJvcihcImV4cDogbm90IGZvdW5kIG1vZHVsZUlkIGZvciBsaW5rZWQgbm9kZSBldmVudDogXCIsIHcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdmFyIEkgPSB4W3ldO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIUkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG8uZXJyb3IoXCJleHA6IG5vdCBmb3VuZCBoYW5kbGVyIGZvciBldmVudDogXCIsIHcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYltkXSA9IG5lKEksIHcsIG4sIGwpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgUyA9IHJlKHcpLCBFID0gdGUodyk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChTIHx8IEUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBUID0gZDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChFKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIE4gPSBjZShFLCBkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiW1QgPSBkICsgRF0gPSBOO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgUyA/IC0xID09PSBtLmluZGV4T2Yody5ldmVudENvbmRpdGlvbnNbMF0ubW9kdWxlSWQpICYmIG0ucHVzaCh3LmV2ZW50Q29uZGl0aW9uc1swXS5tb2R1bGVJZCkgOiBFICYmIG0ucHVzaChUKSwgcCh3LCBULCBtKSwgZysrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgIG0ucHVzaChkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgby5lcnJvcihcImV4cDogZXJyb3Igb24gZXhlY3V0ZSBldmVudDogXCIsIHcsIGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGcgPD0gMyAmJiAoXyA9ICEwKTtcbiAgICAgICAgICAgIGZvciAodmFyIFUgPSAwOyBVIDwgbS5sZW5ndGg7IFUrKylcbiAgICAgICAgICAgICAgICBkID0gbVtVXSwgYltkXSAmJiBiW2RdLnJ1bigpO1xuICAgICAgICAgICAgd2luZG93LmNsZWFyVGltZW91dChxKSwgcSA9IHdpbmRvdy5zZXRUaW1lb3V0KChmdW5jdGlvbiAoKSB7IEcoXCJyb290VGltZXJcIiArIHEpOyB9KSwgMmUzKSwgTSA9IHU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgby5kZWJ1ZyhcImV4cDogbm8gY29tcG9zZXIgZXhlY3V0aW9uIHJlc3VsdFwiKTtcbiAgICB9IH07IGZ1bmN0aW9uIHBlKGUpIHsgcmUoZSkgJiYgZWUoZS5ldmVudE1vZHVsZVBhcmFtcy5tb2R1bGVJZCwgZSk7IH0gZnVuY3Rpb24gZmUoZSkgeyB0cnkge1xuICAgICAgICBldmFsLmNhbGwod2luZG93LCBcIihmdW5jdGlvbiAoKSB7XCIgKyBlICsgXCJcXG59KSgpO1wiKTtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgby5sb2coXCJFcnJvciBvY2N1cnJlZCBpbiBSdW5KU1xcblwiLCBlKTtcbiAgICB9IH0gZnVuY3Rpb24gbWUoZSwgbikgeyB2YXIgdCA9IGJbZS5ldmVudE1vZHVsZVBhcmFtcy5tb2R1bGVJZCArIEZdOyByZXR1cm4gdCAmJiB0LmdldFByZWxvYWRSZXN1bHQgPyB0LmdldFByZWxvYWRSZXN1bHQoKS5zaG93KCkgOiB5ZShlLCBuKTsgfSBmdW5jdGlvbiBnZShlKSB7IHJldHVybiBtZShlLCAoZnVuY3Rpb24gKGUpIHsgcmV0dXJuIHBuLnRlbXBsYXRlLnNob3coZSk7IH0pKTsgfSBmdW5jdGlvbiB2ZShlLCBuKSB7IHJldHVybiBvLmRlYnVnKFwiZXhwOiBydW4gcHJlbG9hZGluZyBmb3I6XCIsIGUpLCB5ZShlLCAoZnVuY3Rpb24gKGUpIHsgcmV0dXJuIG4oZSk7IH0pKTsgfSBmdW5jdGlvbiBoZShlKSB7IHJldHVybiB2ZShlLCAoZnVuY3Rpb24gKGUpIHsgcmV0dXJuIHBuLnRlbXBsYXRlLmRlZmVycmVkU2hvdyhlKTsgfSkpOyB9IGZ1bmN0aW9uIHdlKCkgeyBHKFwicmVzZXRcIiksIE4uZm9yRWFjaCgoZnVuY3Rpb24gKGUsIG4pIHsgY2xlYXJUaW1lb3V0KG4pOyB9KSksIE4gPSBbXSwgdS5yZW1vdmVMaXN0ZW5lcnMoKSwgZC5yZW1vdmVMaXN0ZW5lcnMoKSwgcy5yZW1vdmVMaXN0ZW5lcnMoKSwgcC51bmJpbmRBbGwoKSwgYiA9IHt9LCBTID0ge307IH0gZnVuY3Rpb24geWUoZSwgbikgeyB2YXIgdCA9IHIuZGVlcEV4dGVuZCh7fSwgZS5ldmVudFBhcmFtcyksIGkgPSBlLmV2ZW50RXhlY3V0aW9uQ29udGV4dC5zcGxpdFRlc3RzLCBhID0gZS5ldmVudEV4ZWN1dGlvbkNvbnRleHQuYWN0aXZlTWV0ZXJzLCBzID0gZS5ldmVudFBhcmFtcy5mb3JtTmFtZUJ5VGVybUlkLCBjID0gZS5ldmVudFBhcmFtcy5oaWRlQ29tcGxldGVkRmllbGRzLCBsID0gZnVuY3Rpb24gKGUpIHsgdmFyIG47IGlmICghUilcbiAgICAgICAgcmV0dXJuIG51bGw7IHZhciB0ID0gZSB8fCB7fTsgcmV0dXJuIHsgaXNzdWVySWQ6IFIsIHByZW1pdW06IHQudXNlciAmJiB0LnVzZXIucHJlbWl1bSB8fCBudWxsLCByZWRlbXB0aW9uQ2FuZGlkYXRlSXRlbUlkOiBMIHx8IG51bGwsIGNyZWRpdFN0YXRlczogdC5jcmVkaXRTdGF0ZXMgfHwgbnVsbCwgdXNlcklkOiAobnVsbCA9PT0gKG4gPSB0LnVzZXIpIHx8IHZvaWQgMCA9PT0gbiA/IHZvaWQgMCA6IG4udWlkKSB8fCBudWxsLCB0YXJnZXRHcm91cHM6IHsgbDE6IFwidGFyZ2V0XCIsIGwyOiBudWxsIH0gfTsgfShlLmV2ZW50RXhlY3V0aW9uQ29udGV4dCk7IGlmICh0LnRyYWNraW5nSWQgPSBlLmV2ZW50RXhlY3V0aW9uQ29udGV4dC50cmFja2luZ0lkLCB0LmV4cGVyaWVuY2VJZCA9IGUuZXZlbnRFeGVjdXRpb25Db250ZXh0LmV4cGVyaWVuY2VJZCwgdC5leHBlcmllbmNlRXhlY3V0aW9uSWQgPSBlLmV2ZW50RXhlY3V0aW9uQ29udGV4dC5leGVjdXRpb25JZCwgdC5leHBlcmllbmNlQWN0aW9uSWQgPSBlLmV2ZW50TW9kdWxlUGFyYW1zLm1vZHVsZUlkLCB0LmV4cGVyaWVuY2VDb25kaXRpb25zID0gZS5ldmVudENvbmRpdGlvbnMsIHQuYnJvd3NlcklkID0gTywgdC5vblN0YXJ0Q3JlZGl0UmVkZW1wdGlvbiA9IGZ1bmN0aW9uIChuKSB7IHZhciB0ID0gci5kZWVwRXh0ZW5kKHt9LCBuKSwgbyA9IFwiaHR0cHM6Ly93d3cucGlhbm8uaW9cIiA9PT0gUiwgaSA9IGUuZXZlbnRFeGVjdXRpb25Db250ZXh0LnVzZXIgJiYgXCJhbm9uXCIgIT09IGUuZXZlbnRFeGVjdXRpb25Db250ZXh0LnVpZDsgcmV0dXJuIHQudHJhY2tpbmdJZCA9IGUuZXZlbnRFeGVjdXRpb25Db250ZXh0LnRyYWNraW5nSWQgfHwgdm9pZCAwLCBvICYmIGkgJiYgKHQudWlkID0gZS5ldmVudEV4ZWN1dGlvbkNvbnRleHQudXNlci51aWQgfHwgdm9pZCAwKSwgcG4uY3JlZGl0LnJlZGVlbSh0KTsgfSwgaSAmJiBpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgdmFyIHUgPSBpLm1hcCgoZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGUudmFyaWFudElkOyB9KSk7XG4gICAgICAgIHQuc3BsaXRUZXN0SWRzID0gSlNPTi5zdHJpbmdpZnkodSk7XG4gICAgfSBpZiAodC5hZGRpdGlvbmFsUGFyYW1OYW1lcyA9IFtdLCBhICYmIGEubGVuZ3RoID4gMCAmJiAodC5hY3RpdmVNZXRlcnMgPSBKU09OLnN0cmluZ2lmeShhKSksIFwic2hvd1p1b3JhT2ZmZXJcIiA9PT0gZS5ldmVudFR5cGUpIHtcbiAgICAgICAgdmFyIGQgPSBlLmV2ZW50UGFyYW1zLnJhdGVQbGFuSWRzO1xuICAgICAgICBkICYmIGQubGVuZ3RoID4gMCAmJiAodC56dW9yYVNlbGVjdGVkUmF0ZVBsYW5JZHMgPSBKU09OLnN0cmluZ2lmeShkKSwgdC5hZGRpdGlvbmFsUGFyYW1OYW1lcy5wdXNoKFwienVvcmFTZWxlY3RlZFJhdGVQbGFuSWRzXCIpKTtcbiAgICB9IGlmIChcInNob3dOZXdzY3ljbGVPZmZlclwiID09PSBlLmV2ZW50VHlwZSkge1xuICAgICAgICB2YXIgcCA9IGUuZXZlbnRQYXJhbXMuaWRzO1xuICAgICAgICBwICYmIHAubGVuZ3RoID4gMCAmJiAodC5uZXdzY3ljbGVTZWxlY3RlZElkcyA9IEpTT04uc3RyaW5naWZ5KHApLCB0LmFkZGl0aW9uYWxQYXJhbU5hbWVzLnB1c2goXCJuZXdzY3ljbGVTZWxlY3RlZElkc1wiLCBcImNhbXBhaWduQ29kZVwiLCBcImNhbXBhaWduR3JvdXBJZFwiKSk7XG4gICAgfSBpZiAoXCJzaG93TmV3c2xldHRlclNpZ251cFwiID09PSBlLmV2ZW50VHlwZSkge1xuICAgICAgICB2YXIgZiA9IGUuZXZlbnRQYXJhbXMubWFpbGluZ0xpc3RJZHMsIG0gPSBlLmV2ZW50UGFyYW1zLnNpdGVJZDtcbiAgICAgICAgZiAmJiBmLmxlbmd0aCA+IDAgJiYgKHQubWFpbGluZ0xpc3RJZHMgPSBKU09OLnN0cmluZ2lmeShmKSwgdC5zaXRlSWQgPSBtLCB0LmFkZGl0aW9uYWxQYXJhbU5hbWVzLnB1c2goXCJtYWlsaW5nTGlzdElkc1wiLCBcInNpdGVJZFwiKSk7XG4gICAgfSByZXR1cm4gXCJzaG93UmVjb21tZW5kYXRpb25zXCIgPT09IGUuZXZlbnRUeXBlICYmICh0LndpZGdldElkID0gZS5ldmVudFBhcmFtcy53aWRnZXRJZCwgdC5wbGFjZWhvbGRlciA9IGUuZXZlbnRQYXJhbXMucGxhY2Vob2xkZXIpLCBzICYmICh0LmZvcm1OYW1lQnlUZXJtSWQgPSBKU09OLnN0cmluZ2lmeShzKSwgdC5oaWRlQ29tcGxldGVkRmllbGRzID0gYyksIGwgJiYgKHQuYWZmaWxpYXRlU3RhdGUgPSBsKSwgby5kZWJ1ZyhcImV4cDogc2hvdyB3aXRoIHBhcmFtczpcIiwgdCksIG4odCk7IH0gZnVuY3Rpb24gYmUoKSB7IHJldHVybiBmdW5jdGlvbiAoKSB7IH07IH0gcmV0dXJuIHsgbmFtZTogXCJleHBlcmllbmNlXCIsIGluaXQ6IGZ1bmN0aW9uICgpIHsgaWYgKCFJICYmICFvLl9fcHJvdGVjdGVkX18uaXNDeGVuc2VCb3QoKSkge1xuICAgICAgICAgICAgSSA9ICEwO1xuICAgICAgICAgICAgdmFyIGUgPSAhMDtcbiAgICAgICAgICAgIGlmIChwbi5jdXN0b21QcmVDaGVja3MgJiYgcG4uY3VzdG9tUHJlQ2hlY2tzLmxlbmd0aClcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBuID0gbnVsbCwgdCA9IHBuLmN1c3RvbVByZUNoZWNrcy5sZW5ndGg7IHQtLTspXG4gICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAxICE9PSAobiA9IHBuLmN1c3RvbVByZUNoZWNrc1t0XSgpKSAmJiAhMCAhPT0gbiAmJiAoZSA9ICExKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjYXRjaCAoZSkgeyB9XG4gICAgICAgICAgICBlICYmIFEoXCJhdXRvXCIpLnRoZW4oKGZ1bmN0aW9uICgpIHsgdy5zZXRUaW1lKFwiZXhwRXhlY1wiKTsgfSkpO1xuICAgICAgICB9IH0sIGV4ZWN1dGU6IEUsIF9nZXRMYXN0RXhlY3V0aW9uUmVzdWx0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBNOyB9LCByZWdpc3RlckNhbGxiYWNrOiBULCBfX3ByaXZhdGVfXzogeyBoYW5kbGVyczogeCwgZXhlY3V0ZWROb2RlczogeSwgbGlua2VkTm9kZXM6IGIsIHByb2Nlc3NSZXN1bHQ6IGRlLCBwcm9jZXNzRXJyb3JzOiBaLCBzaG93OiB5ZSwgZ2V0VHJhY2tpbmdFbmRwb2ludDogVywgaW5pdGlhbGl6ZWQ6IEksIHJlZ2lzdGVyQ2FsbGJhY2s6IFQgfSwgX19wcm90ZWN0ZWRfXzogeyBzZW5kU3RhdGlzdGljc0V4ZWN1dGVkTm9kZXM6IEcgfSB9OyB9O1xuICAgIHBuLmNvbnRhaW5lci5yZWdpc3RlcihcImV4cGVyaWVuY2VcIiwgeyB1c2VWYWx1ZTogdW4oKSB9KSwgcG4uZXhwZXJpZW5jZSA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwiZXhwZXJpZW5jZVwiKTtcbiAgICB2YXIgZG4gPSBmdW5jdGlvbiAoKSB7IHZhciBlLCBuLCB0LCByLCBvLCBpID0gMCwgYSA9IGRvY3VtZW50LCBzID0gITEsIGMgPSBcImFjdGl2ZVwiLCBsID0gNmU0LCB1ID0gKHIgPSB7fSwgdCA9IFwiX19jZUdVSURcIiwgeyBhZGQ6IGZ1bmN0aW9uIChlLCBuLCBvKSB7IHJldHVybiBlW3RdID0gdm9pZCAwLCBlW3RdIHx8IChlW3RdID0gXCJpZnZpc2libGUub2JqZWN0LmV2ZW50LmlkZW50aWZpZXJcIiksIHJbZVt0XV0gfHwgKHJbZVt0XV0gPSB7fSksIHJbZVt0XV1bbl0gfHwgKHJbZVt0XV1bbl0gPSBbXSksIHJbZVt0XV1bbl0ucHVzaChvKTsgfSwgcmVtb3ZlOiBmdW5jdGlvbiAoZSwgbiwgbykgeyB2YXIgaSwgYSwgcywgYywgbDsgaWYgKG8pIHtcbiAgICAgICAgICAgIGlmIChlW3RdICYmIHJbZVt0XV0gJiYgcltlW3RdXVtuXSlcbiAgICAgICAgICAgICAgICBmb3IgKGEgPSBzID0gMCwgYyA9IChsID0gcltlW3RdXVtuXSkubGVuZ3RoOyBzIDwgYzsgYSA9ICsrcylcbiAgICAgICAgICAgICAgICAgICAgaWYgKChpID0gbFthXSkgPT09IG8pXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcltlW3RdXVtuXS5zcGxpY2UoYSwgMSksIGk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoZVt0XSAmJiByW2VbdF1dICYmIHJbZVt0XV1bbl0pXG4gICAgICAgICAgICByZXR1cm4gZGVsZXRlIHJbZVt0XV1bbl07IH0sIGZpcmU6IGZ1bmN0aW9uIChlLCBuLCBvKSB7IHZhciBpLCBhLCBzLCBjLCBsOyBpZiAoZVt0XSAmJiByW2VbdF1dICYmIHJbZVt0XV1bbl0pIHtcbiAgICAgICAgICAgIGZvciAobCA9IFtdLCBhID0gMCwgcyA9IChjID0gcltlW3RdXVtuXSkubGVuZ3RoOyBhIDwgczsgYSsrKVxuICAgICAgICAgICAgICAgIGkgPSBjW2FdLCBsLnB1c2goaShvIHx8IHt9KSk7XG4gICAgICAgICAgICByZXR1cm4gbDtcbiAgICAgICAgfSB9IH0pLCBkID0gZnVuY3Rpb24gKGUsIG4sIHQpIHsgcmV0dXJuIG8gfHwgKG8gPSBlLmFkZEV2ZW50TGlzdGVuZXIgPyBmdW5jdGlvbiAoZSwgbiwgdCkgeyByZXR1cm4gZS5hZGRFdmVudExpc3RlbmVyKG4sIHQuYmluZChkbiksICExKTsgfSA6IGUuYXR0YWNoRXZlbnQgPyBmdW5jdGlvbiAoZSwgbiwgdCkgeyByZXR1cm4gZS5hdHRhY2hFdmVudChcIm9uXCIgKyBuLCB0LCAhMSk7IH0gOiBmdW5jdGlvbiAoZSwgbiwgdCkgeyByZXR1cm4gZVtcIm9uXCIgKyBuXSA9IHQ7IH0pLCBvKGUsIG4sIHQpOyB9LCBwID0gZnVuY3Rpb24gKCkgeyB2YXIgZSwgbiA9IGEuY3JlYXRlRWxlbWVudChcImRpdlwiKSwgdCA9IG4uZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJpXCIpLCByID0gMzsgZm9yIChlID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gbi5pbm5lckhUTUwgPSBcIlxceDNjIS0tW2lmIGd0IElFIFwiICsgKytyICsgXCJdPjxpPjwvaT48IVtlbmRpZl0tLVxceDNlXCIsIHRbMF07IH07IGUoKTspXG4gICAgICAgIDsgcmV0dXJuIHIgPiA0ID8gciA6IHZvaWQgMDsgfSgpOyBmdW5jdGlvbiBmKCkgeyB2YXIgdCwgciwgbzsgcmV0dXJuICEhcyB8fCAoZSA/IGQoYSwgbiwgKGZ1bmN0aW9uICgpIHsgcmV0dXJuIGEuaGlkZGVuID8gZygpIDogbSgpOyB9KSwgITEpIDogKHQgPSBcImJsdXJcIiwgcCAmJiBwIDwgOSAmJiAodCA9IFwiZm9jdXNvdXRcIiksIGQod2luZG93LCB0LCAoZnVuY3Rpb24gKCkgeyByZXR1cm4gZG4uYmx1cigpOyB9KSksIGQod2luZG93LCBcImZvY3VzXCIsIChmdW5jdGlvbiAoKSB7IHJldHVybiBkbi5mb2N1cygpOyB9KSkpLCBzID0gITAsIChvID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gY2xlYXJUaW1lb3V0KHIpLCBcImFjdGl2ZVwiICE9PSBjICYmIGgoKSwgaSA9ICtuZXcgRGF0ZSwgciA9IHNldFRpbWVvdXQoKGZ1bmN0aW9uICgpIHsgaWYgKFwiYWN0aXZlXCIgPT09IGMpXG4gICAgICAgIHJldHVybiB2KCk7IH0pLCBsKTsgfSkoKSwgZChhLCBcIm1vdXNlbW92ZVwiLCBvKSwgZChhLCBcIm1vdXNldXBcIiwgbyksIGQoYSwgXCJrZXl1cFwiLCBvKSwgZChhLCBcInRvdWNoc3RhcnRcIiwgbyksIGQod2luZG93LCBcInNjcm9sbFwiLCBvKSwgZCh3aW5kb3csIFwicmVzaXplXCIsIG8pLCBtKG8pLCBoKG8pKTsgfSB2b2lkIDAgIT09IGEuaGlkZGVuID8gKGUgPSBcImhpZGRlblwiLCBuID0gXCJ2aXNpYmlsaXR5Y2hhbmdlXCIpIDogdm9pZCAwICE9PSBhLm1vekhpZGRlbiA/IChlID0gXCJtb3pIaWRkZW5cIiwgbiA9IFwibW96dmlzaWJpbGl0eWNoYW5nZVwiKSA6IHZvaWQgMCAhPT0gYS5tc0hpZGRlbiA/IChlID0gXCJtc0hpZGRlblwiLCBuID0gXCJtc3Zpc2liaWxpdHljaGFuZ2VcIikgOiB2b2lkIDAgIT09IGEud2Via2l0SGlkZGVuICYmIChlID0gXCJ3ZWJraXRIaWRkZW5cIiwgbiA9IFwid2Via2l0dmlzaWJpbGl0eWNoYW5nZVwiKTsgZnVuY3Rpb24gbShlKSB7IHJldHVybiBcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIGUgPyB3KFwiZm9jdXNcIiwgKGZ1bmN0aW9uIChuKSB7IGUobik7IH0pKSA6IChjID0gXCJhY3RpdmVcIiwgdS5maXJlKGRuLCBcImZvY3VzXCIpLCB1LmZpcmUoZG4sIFwid2FrZXVwXCIpLCB1LmZpcmUoZG4sIFwic3RhdHVzQ2hhbmdlZFwiLCB7IHN0YXR1czogYyB9KSksIGRuOyB9IGZ1bmN0aW9uIGcoZSkgeyByZXR1cm4gXCJmdW5jdGlvblwiID09IHR5cGVvZiBlID8gdyhcImJsdXJcIiwgKGZ1bmN0aW9uIChuKSB7IGUobik7IH0pKSA6IChjID0gXCJoaWRkZW5cIiwgdS5maXJlKGRuLCBcImJsdXJcIiksIHUuZmlyZShkbiwgXCJpZGxlXCIpLCB1LmZpcmUoZG4sIFwic3RhdHVzQ2hhbmdlZFwiLCB7IHN0YXR1czogYyB9KSksIGRuOyB9IGZ1bmN0aW9uIHYoZSkgeyByZXR1cm4gXCJmdW5jdGlvblwiID09IHR5cGVvZiBlID8gdyhcImlkbGVcIiwgKGZ1bmN0aW9uIChuKSB7IGUobik7IH0pKSA6IChjID0gXCJpZGxlXCIsIHUuZmlyZShkbiwgXCJpZGxlXCIpLCB1LmZpcmUoZG4sIFwic3RhdHVzQ2hhbmdlZFwiLCB7IHN0YXR1czogYyB9KSksIGRuOyB9IGZ1bmN0aW9uIGgoZSkgeyByZXR1cm4gXCJmdW5jdGlvblwiID09IHR5cGVvZiBlID8gdyhcIndha2V1cFwiLCAoZnVuY3Rpb24gKG4pIHsgcmV0dXJuIGUobik7IH0pKSA6IChjID0gXCJhY3RpdmVcIiwgdS5maXJlKGRuLCBcIndha2V1cFwiKSwgdS5maXJlKGRuLCBcInN0YXR1c0NoYW5nZWRcIiwgeyBzdGF0dXM6IGMgfSkpLCBkbjsgfSBmdW5jdGlvbiB3KGUsIG4pIHsgcmV0dXJuIGYoKSwgdS5hZGQoZG4sIGUsIG4pLCBkbjsgfSByZXR1cm4geyBuYW1lOiBcImlmdmlzaWJsZVwiLCBzZXRJZGxlRHVyYXRpb246IGZ1bmN0aW9uIChlKSB7IHJldHVybiBsID0gMWUzICogZTsgfSwgZ2V0SWRsZUR1cmF0aW9uOiBmdW5jdGlvbiAoKSB7IHJldHVybiBsOyB9LCBnZXRJZGxlSW5mbzogZnVuY3Rpb24gKCkgeyB2YXIgZSwgbjsgcmV0dXJuIGUgPSArbmV3IERhdGUsIG4gPSB7fSwgXCJpZGxlXCIgPT09IGMgPyAobi5pc0lkbGUgPSAhMCwgbi5pZGxlRm9yID0gZSAtIGksIG4udGltZUxlZnQgPSAwLCBuLnRpbWVMZWZ0UGVyID0gMTAwKSA6IChuLmlzSWRsZSA9ICExLCBuLmlkbGVGb3IgPSBlIC0gaSwgbi50aW1lTGVmdCA9IGkgKyBsIC0gZSwgbi50aW1lTGVmdFBlciA9ICgxMDAgLSAxMDAgKiBuLnRpbWVMZWZ0IC8gbCkudG9GaXhlZCgyKSksIG47IH0sIHdha2V1cDogaCwgaWRsZTogdiwgZm9jdXM6IG0sIGJsdXI6IGcsIG9uOiB3LCBvZmY6IGZ1bmN0aW9uIChlLCBuKSB7IHJldHVybiBmKCksIHUucmVtb3ZlKGRuLCBlLCBuKSwgZG47IH0sIG9uRXZlcnk6IGZ1bmN0aW9uIChlLCBuKSB7IHZhciB0LCByID0gITE7IHJldHVybiBmKCksIG4gJiYgKHQgPSBzZXRJbnRlcnZhbCgoZnVuY3Rpb24gKCkgeyBpZiAoXCJhY3RpdmVcIiA9PT0gYyAmJiAhcilcbiAgICAgICAgICAgIHJldHVybiBuKCk7IH0pLCAxZTMgKiBlKSksIHsgc3RvcDogZnVuY3Rpb24gKCkgeyByZXR1cm4gY2xlYXJJbnRlcnZhbCh0KTsgfSwgcGF1c2U6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHIgPSAhMDsgfSwgcmVzdW1lOiBmdW5jdGlvbiAoKSB7IHJldHVybiByID0gITE7IH0sIGNvZGU6IHQsIGNhbGxiYWNrOiBuIH07IH0sIG5vdzogZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGYoKSwgYyA9PT0gKGUgfHwgXCJhY3RpdmVcIik7IH0gfTsgfSgpO1xuICAgIHBuLmNvbnRhaW5lci5yZWdpc3RlcihcImlmdmlzaWJsZVwiLCB7IHVzZVZhbHVlOiBkbiB9KSwgcG4uaWZ2aXNpYmxlID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJpZnZpc2libGVcIik7XG4gICAgdmFyIGZuID0gZnVuY3Rpb24gKCkgeyB2YXIgZSwgbiA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwianFVdGlsc1wiKSwgdCA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwiaWZ2aXNpYmxlXCIpLCByID0gMCwgbyA9IFtdLCBpID0gNjAsIGEgPSAhMCwgcyA9IGZ1bmN0aW9uICgpIHsgbSgpOyB2YXIgZSA9IG9bby5sZW5ndGggLSAxXTsgdm9pZCAwICE9PSBlICYmIHZvaWQgMCA9PT0gZS5zdG9wVGltZSB8fCBvLnB1c2goeyBzdGFydFRpbWU6IG5ldyBEYXRlLCBzdGFydE1pbnV0ZTogciwgc3RvcFRpbWU6IHZvaWQgMCB9KTsgfSwgYyA9IGZ1bmN0aW9uICgpIHsgaWYgKDAgIT09IG8ubGVuZ3RoICYmICFhKVxuICAgICAgICBpZiAoZCgpKVxuICAgICAgICAgICAgZigpO1xuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHZhciBlID0gb1tvLmxlbmd0aCAtIDFdO1xuICAgICAgICAgICAgdm9pZCAwID09PSBlLnN0b3BUaW1lICYmIChlLnN0b3BUaW1lID0gbmV3IERhdGUsIGUuc3RvcE1pbnV0ZSA9IHIpO1xuICAgICAgICB9IH0sIGwgPSBmdW5jdGlvbiAoZSwgbiwgdCwgcikgeyB2YXIgbyA9IE1hdGguYWJzKGUuZ2V0VGltZSgpIC0gbi5nZXRUaW1lKCkpLCBpID0gdCAtIHI7IHJldHVybiBvID4gNmU0ICogKGkgKyAxMCkgJiYgKG8gPSA2ZTQgKiBpKSwgbzsgfSwgdSA9IGZ1bmN0aW9uIChlKSB7IHZhciBuID0gcGFyc2VGbG9hdChlKTsgaWYgKGlzTmFOKG4pKVxuICAgICAgICB0aHJvdyB7IG5hbWU6IFwiSW52YWxpZER1cmF0aW9uRXhjZXB0aW9uXCIsIG1lc3NhZ2U6IFwiQW4gaW52YWxpZCBkdXJhdGlvbiB0aW1lIChcIiArIGUgKyBcIikgd2FzIHByb3ZpZGVkLlwiIH07IHQuc2V0SWRsZUR1cmF0aW9uKG4pLCBpID0gbjsgfSwgZCA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuICEhKGUgPSBuLmZpbHRlcihcInZpZGVvLGF1ZGlvXCIsIChmdW5jdGlvbiAoZSkgeyByZXR1cm4gIWUucGF1c2VkOyB9KSkpLmxlbmd0aDsgfSwgcCA9IGZ1bmN0aW9uICgpIHsgc2V0VGltZW91dCgoZnVuY3Rpb24gKCkgeyBjKCk7IH0pLCAxNWUzKTsgfSwgZiA9IGZ1bmN0aW9uICgpIHsgZSAmJiBlLmZvckVhY2goKGZ1bmN0aW9uIChlKSB7IG4ub24oZSwgXCJwYXVzZVwiLCBwKTsgfSkpOyB9LCBtID0gZnVuY3Rpb24gKCkgeyBlICYmIGUuZm9yRWFjaCgoZnVuY3Rpb24gKGUpIHsgbi5vZmYoZSwgXCJwYXVzZVwiLCBwKTsgfSkpOyB9OyByZXR1cm4geyBuYW1lOiBcImFjdGl2ZXRpbWVyXCIsIHNldElkbGVEdXJhdGlvbkluU2Vjb25kczogdSwgZ2V0QWN0aXZlVGltZUluU2Vjb25kczogZnVuY3Rpb24gKCkgeyBmb3IgKHZhciBlID0gMCwgbiA9IDA7IG4gPCBvLmxlbmd0aDsgbisrKSB7XG4gICAgICAgICAgICB2YXIgdCA9IG9bbl0uc3RhcnRUaW1lLCBpID0gb1tuXS5zdG9wVGltZSwgYSA9IG9bbl0uc3RhcnRNaW51dGUsIHMgPSBvW25dLnN0b3BNaW51dGU7XG4gICAgICAgICAgICB2b2lkIDAgPT09IGkgJiYgKGkgPSBuZXcgRGF0ZSwgcyA9IHIpLCBlICs9IGwoaSwgdCwgcywgYSk7XG4gICAgICAgIH0gcmV0dXJuIE1hdGguZmxvb3IoZSAvIDFlMyk7IH0sIGdldFRvdGFsVGltZUluU2Vjb25kczogZnVuY3Rpb24gKCkgeyB2YXIgZSA9IDAsIG4gPSBvWzBdOyBpZiAodm9pZCAwICE9PSBuKSB7XG4gICAgICAgICAgICB2YXIgdCA9IG4uc3RhcnRUaW1lLCBpID0gbi5zdGFydE1pbnV0ZSwgYSA9IG5ldyBEYXRlO1xuICAgICAgICAgICAgZSA9IGwoYSwgdCwgciwgaSk7XG4gICAgICAgIH0gcmV0dXJuIE1hdGguZmxvb3IoZSAvIDFlMyk7IH0sIHJlc2V0UmVjb3JkZWRUaW1lOiBmdW5jdGlvbiAoKSB7IG8gPSBbXSwgcygpOyB9LCBzdGFydFRpbWVyOiBzLCBzdG9wVGltZXI6IGMsIGluaXRpYWxpemU6IGZ1bmN0aW9uIChlKSB7IGUgJiYgdShlKSwgdC5vbihcImJsdXJcIiwgKGZ1bmN0aW9uICgpIHsgYSA9ICExLCBjKCk7IH0pKSwgdC5vbihcImZvY3VzXCIsIChmdW5jdGlvbiAoKSB7IGEgPSAhMCwgcygpOyB9KSksIHQub24oXCJpZGxlXCIsIChmdW5jdGlvbiAoKSB7IGkgPiAwICYmIChhID0gITEsIGMoKSk7IH0pKSwgdC5vbihcIndha2V1cFwiLCAoZnVuY3Rpb24gKCkgeyBpID4gMCAmJiAoYSA9ICEwLCBzKCkpOyB9KSksIHMoKSwgc2V0SW50ZXJ2YWwoKGZ1bmN0aW9uICgpIHsgcisrOyB9KSwgNmU0KTsgfSB9OyB9KCk7XG4gICAgcG4uY29udGFpbmVyLnJlZ2lzdGVyKFwiYWN0aXZldGltZXJcIiwgeyB1c2VWYWx1ZTogZm4gfSksIHBuLmFjdGl2ZXRpbWVyID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJhY3RpdmV0aW1lclwiKTtcbiAgICB2YXIgbW4gPSBmdW5jdGlvbiAoKSB7IHZhciBlLCBuID0ge30sIHQgPSBbXSwgciA9ICExLCBvID0gMSwgaSA9IDIsIGEgPSAzOyBmdW5jdGlvbiBzKGUpIHsgZSAmJiAodSgpLCByID0gITEpLCBmdW5jdGlvbiAoKSB7IGlmIChyKVxuICAgICAgICByZXR1cm4gITE7IHIgPSAhMDsgdHJ5IHtcbiAgICAgICAgdmFyIGUgPSB3aW5kb3cuZ29vZ2xldGFnID0gd2luZG93Lmdvb2dsZXRhZyB8fCB7fTtcbiAgICAgICAgZS5jbWQgPSBlLmNtZCB8fCBbXSwgZS5jbWQucHVzaCgoZnVuY3Rpb24gKCkgeyBlLnB1YmFkcygpLmFkZEV2ZW50TGlzdGVuZXIoXCJzbG90UmVuZGVyRW5kZWRcIiwgZiksIGUucHViYWRzKCkuYWRkRXZlbnRMaXN0ZW5lcihcImltcHJlc3Npb25WaWV3YWJsZVwiLCBtKSwgZS5jb21wYW5pb25BZHMoKS5hZGRFdmVudExpc3RlbmVyKFwic2xvdFJlbmRlckVuZGVkXCIsIGYpLCBlLmNvbXBhbmlvbkFkcygpLmFkZEV2ZW50TGlzdGVuZXIoXCJpbXByZXNzaW9uVmlld2FibGVcIiwgbSk7IH0pKSwgZS5hcGlSZWFkeSAmJiBlLmNtZC5wdXNoKChmdW5jdGlvbiAoKSB7IGQoZS5wdWJhZHMoKS5nZXRTbG90cygpKSwgZChlLmNvbXBhbmlvbkFkcygpLmdldFNsb3RzKCkpOyB9KSk7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIHJldHVybiB2KGUpLCAhMTtcbiAgICB9IH0oKTsgfSBmdW5jdGlvbiBjKG4sIHQpIHsgXCJmdW5jdGlvblwiID09IHR5cGVvZiBlICYmIGUobiwgdCk7IH0gZnVuY3Rpb24gbChlKSB7IHJldHVybiBlICYmIHZvaWQgMCAhPT0gbltlXSAmJiBudWxsICE9PSBuW2VdICYmIG4uaGFzT3duUHJvcGVydHkoZSk7IH0gZnVuY3Rpb24gdSgpIHsgbiA9IHt9LCB0ID0gW107IH0gZnVuY3Rpb24gZChlKSB7IGZvciAodmFyIG4gPSAwOyBuIDwgZS5sZW5ndGg7IG4rKykge1xuICAgICAgICB2YXIgdCA9IGVbbl07XG4gICAgICAgIGYoeyBldmVudFNvdXJjZTogYSwgc2xvdDogdCB9KTtcbiAgICB9IH0gZnVuY3Rpb24gcChlKSB7IHZhciBuOyB0cnkge1xuICAgICAgICB2YXIgdCA9IGUuc2VydmljZU5hbWUsIHIgPSBlLnNsb3Q7XG4gICAgICAgIGlmICghdCkge1xuICAgICAgICAgICAgdmFyIG8gPSBlLnNsb3QuZ2V0U2VydmljZXMoKTtcbiAgICAgICAgICAgIG8gJiYgby5sZW5ndGggJiYgKHQgPSBvWzBdLmdldE5hbWUoKSk7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGkgPSByLmdldFJlc3BvbnNlSW5mb3JtYXRpb24oKSB8fCB7fSwgYSA9IHIuZ2V0U2xvdElkID8gci5nZXRTbG90SWQoKSA6IHt9LCBzID0gci5nZXRTbG90RWxlbWVudElkID8gci5nZXRTbG90RWxlbWVudElkKCkgOiBhLmdldERvbUlkID8gYS5nZXREb21JZCgpIDogbnVsbDtcbiAgICAgICAgbiA9IHsgY29tcGFuaW9uOiAhIXQgJiYgXCJjb21wYW5pb25fYWRzXCIgPT09IHQsIGFkVW5pdDogci5nZXRBZFVuaXRQYXRoID8gci5nZXRBZFVuaXRQYXRoKCkgOiAwLCBpc0VtcHR5OiBlLmlzRW1wdHksIGVsZW1lbnRJZDogcywgYWR2ZXJ0aXNlcklkOiBlLmFkdmVydGlzZXJJZCB8fCBpLmFkdmVydGlzZXJJZCwgY2FtcGFpZ25JZDogZS5jYW1wYWlnbklkIHx8IGkuY2FtcGFpZ25JZCwgbGluZUl0ZW1JZDogZS5saW5lSXRlbUlkIHx8IGkubGluZUl0ZW1JZCwgY3JlYXRpdmVJZDogZS5jcmVhdGl2ZUlkIHx8IGkuY3JlYXRpdmVJZCwgZXZlbnRTb3VyY2U6IGUuZXZlbnRTb3VyY2UgfHwgbnVsbCwgc2l6ZTogZS5zaXplICYmIGUuc2l6ZS5zbGljZSgwLCAyKSB8fCBudWxsLCB2aWV3ZWQ6ICExLCBwb3NpdGlvbjogbnVsbCB9O1xuICAgICAgICB2YXIgYyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHMpO1xuICAgICAgICBpZiAocyAmJiBjICYmIChuLnBvc2l0aW9uID0geyB0b3A6IGMub2Zmc2V0VG9wLCBsZWZ0OiBjLm9mZnNldExlZnQgfSwgdm9pZCAwID09PSBlLmlzRW1wdHkgJiYgKG4uaXNFbXB0eSA9IGMub2Zmc2V0V2lkdGggPD0gMCAmJiBjLm9mZnNldEhlaWdodCA8PSAwLCAhbi5pc0VtcHR5ICYmICFuLnNpemUpKSkge1xuICAgICAgICAgICAgdmFyIGwgPSByLmdldFNpemVzKCk7XG4gICAgICAgICAgICBsICYmIGwubGVuZ3RoICYmIChuLnNpemUgPSBcIm9iamVjdFwiID09IHR5cGVvZiBsWzBdID8gW2xbMF0uZ2V0V2lkdGgoKSwgbFswXS5nZXRIZWlnaHQoKV0gOiBsWzBdKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgICB2KGUpO1xuICAgIH0gcmV0dXJuIG47IH0gZnVuY3Rpb24gZihlKSB7IGUuZXZlbnRTb3VyY2UgPSBlLmV2ZW50U291cmNlIHx8IG87IHZhciByID0gcChlKSwgaSA9IGcoZS5zbG90KTsgaSAmJiAobltpXSA/IHIudmlld2VkID0gbltpXS52aWV3ZWQgOiB0LnB1c2goaSksIG5baV0gPSByLCBjKHIsIGkpKTsgfSBmdW5jdGlvbiBtKGUpIHsgdmFyIHIgPSBnKGUuc2xvdCk7IGlmIChyKSB7XG4gICAgICAgIHZhciBvID0gbltyXSB8fCBwKGUpO1xuICAgICAgICBsKHIpIHx8IChuW3JdID0gbywgdC5wdXNoKHIpKSwgdm9pZCAwID09PSBvLmNvbXBhbmlvbiAmJiAoby5jb21wYW5pb24gPSBcImNvbXBhbmlvbl9hZHNcIiA9PT0gZS5zZXJ2aWNlTmFtZSksICghby5ldmVudFNvdXJjZSB8fCBvLmV2ZW50U291cmNlID4gaSkgJiYgKG8uZXZlbnRTb3VyY2UgPSBpKSwgby52aWV3ZWQgPSAhMCwgYyhvLCByKTtcbiAgICB9IH0gZnVuY3Rpb24gZyhlKSB7IHRyeSB7XG4gICAgICAgIHZhciBuID0gZS5nZXRTbG90SWQgPyBlLmdldFNsb3RJZCgpIDoge30sIHQgPSBlLmdldFNsb3RFbGVtZW50SWQgPyBlLmdldFNsb3RFbGVtZW50SWQoKSA6IG4uZ2V0RG9tSWQgPyBuLmdldERvbUlkKCkgOiBudWxsLCByID0gZS5nZXRBZFVuaXRQYXRoID8gZS5nZXRBZFVuaXRQYXRoKCkgOiAwO1xuICAgICAgICByZXR1cm4gW3QsIG4uZ2V0SWQgPyBuLmdldElkKCkgOiAwLCByXS5qb2luKFwiOlwiKTtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgdihlKTtcbiAgICB9IH0gZnVuY3Rpb24gdihlKSB7IHBuICYmIHBuLnV0aWwgJiYgcG4udXRpbC5lcnJvciAmJiBwbi51dGlsLmVycm9yKFwiREZQIG1vZHVsZSBlcnJvcjogXCIsIGUpOyB9IHJldHVybiBzKCksIHsgbmFtZTogXCJkb3VibGVDbGlja0ZvclB1Ymxpc2hlclwiLCBpbml0aWFsaXplOiBzLCBzZXRDdXN0b21IYW5kbGVyOiBmdW5jdGlvbiAobikgeyBlID0gbjsgfSwgZ2V0QWRzOiBmdW5jdGlvbiAoZSkgeyB2YXIgciwgbyA9IFtdLCBpID0gMCwgYSA9IHQubGVuZ3RoOyBlICYmIChcIm51bWJlclwiID09IHR5cGVvZiAociA9IGUpICYmIGlzRmluaXRlKHIpICYmIE1hdGguZmxvb3IocikgPT09IHIpICYmIGUgPiAwICYmIGUgPCBhICYmIChpID0gYSAtIGUpOyBmb3IgKHZhciBzID0gaTsgcyA8IGE7IHMrKykge1xuICAgICAgICAgICAgdmFyIGMgPSB0W3NdO1xuICAgICAgICAgICAgbChjKSAmJiBvLnB1c2gobltjXSk7XG4gICAgICAgIH0gcmV0dXJuIG87IH0sIHJlc2V0QWRzOiB1IH07IH0oKTtcbiAgICBwbi5jb250YWluZXIucmVnaXN0ZXIoXCJkb3VibGVDbGlja0ZvclB1Ymxpc2hlclwiLCB7IHVzZVZhbHVlOiBtbiB9KSwgcG4uZG91YmxlQ2xpY2tGb3JQdWJsaXNoZXIgPSBwbi5jb250YWluZXIucmVzb2x2ZShcImRvdWJsZUNsaWNrRm9yUHVibGlzaGVyXCIpO1xuICAgIHZhciBnbiA9IGZ1bmN0aW9uICgpIHsgdmFyIGUsIG4sIHQsIHIsIG8sIGksIGEgPSBwbi5jb250YWluZXIucmVzb2x2ZShcInBvc3RtZXNzYWdlXCIpLCBzID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJ1dGlsXCIpLCBjID0gXCJodHRwczovL2pzLmJyYWludHJlZWdhdGV3YXkuY29tL3dlYi8zLjc5LjEvanMvY2xpZW50Lm1pbi5qc1wiLCBsID0gXCJodHRwczovL2pzLmJyYWludHJlZWdhdGV3YXkuY29tL3dlYi8zLjc5LjEvanMvYXBwbGUtcGF5Lm1pbi5qc1wiLCB1ID0gXCJcIjsgYS5zdWJzY3JpYmUoXCJsb2FkZWRcIiwgKGZ1bmN0aW9uICgpIHsgZCgpOyB9KSksIGEuc3Vic2NyaWJlKFwic3RhcnRDaGVja291dFwiLCAoZnVuY3Rpb24gKCkgeyBkKCk7IH0pKSwgYS5zdWJzY3JpYmUoXCJhcHBsZVBheUJ0Q2xpZW50VG9rZW5cIiwgKGZ1bmN0aW9uIChlKSB7IGcoZS5wYXJhbXMuY2xpZW50VG9rZW4pOyB9KSksIGEuc3Vic2NyaWJlKFwiYXBwbGVQYXlCdENoZWNrb3V0Rmxvd1Byb3BlcnRpZXNcIiwgKGZ1bmN0aW9uIChlKSB7IHIgPSBlLnBhcmFtcy5yZXF1ZXN0RW1haWwsIG8gPSBlLnBhcmFtcy5yZXF1ZXN0UG9zdGFsQWRkcmVzczsgfSkpLCBhLnN1YnNjcmliZShcImFwcGx5VGF4RmFpbGVkXCIsIChmdW5jdGlvbiAobikgeyBlLmFib3J0KCk7IH0pKSwgYS5zdWJzY3JpYmUoXCJjaGVja0FwcGxlUGF5QnRJbnN0YW5jZVwiLCAoZnVuY3Rpb24gKGUpIHsgbiAmJiBhLmJyb2FkY2FzdChcImFwcGxlUGF5SW5pdFwiLCB7fSk7IH0pKSwgYS5zdWJzY3JpYmUoXCJhcHBseVRheENvbXBsZXRlZFwiLCAoZnVuY3Rpb24gKGUpIHsgbShlLnBhcmFtcy5ub25jZSk7IH0pKSwgYS5zdWJzY3JpYmUoXCJhcHBsZVBheUJ0QmVnaW5TZXNzaW9uXCIsIChmdW5jdGlvbiAoaSkgeyB2YXIgcyA9IHt9LCBjID0gaS5wYXJhbXM7IGMucmVzb3VyY2VUaXRsZSAmJiAocyA9IGMpLCBjLnRlcm1JZCAmJiAodSA9IGMudGVybUlkIHx8IFwiXCIpOyB2YXIgbCA9IHsgY3VycmVuY3lDb2RlOiBjLmN1cnJlbmN5Q29kZSwgdG90YWw6IHsgbGFiZWw6IGMucmVzb3VyY2VUaXRsZSwgYW1vdW50OiBjLmNoYXJnZUFtb3VudCB9IH07IHAobCk7IHRyeSB7XG4gICAgICAgIHQgPSBuLmNyZWF0ZVBheW1lbnRSZXF1ZXN0KGwpO1xuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgICBhLmJyb2FkY2FzdChcInBheW1lbnQtZXJyb3JcIiwgeyBlcnJvckNvZGU6IDEwMSB9KTtcbiAgICB9IChlID0gbmV3IHdpbmRvdy5BcHBsZVBheVNlc3Npb24oMiwgdCkpLm9udmFsaWRhdGVtZXJjaGFudCA9IGZ1bmN0aW9uICh0KSB7IG4ucGVyZm9ybVZhbGlkYXRpb24oeyB2YWxpZGF0aW9uVVJMOiB0LnZhbGlkYXRpb25VUkwsIGRpc3BsYXlOYW1lOiBjLnJlc291cmNlVGl0bGUgfHwgcy5yZXNvdXJjZVRpdGxlIH0sIChmdW5jdGlvbiAobiwgdCkgeyBpZiAobilcbiAgICAgICAgcmV0dXJuIGUuYWJvcnQoKSwgdm9pZCBhLmJyb2FkY2FzdChcInBheW1lbnQtZXJyb3JcIiwgeyBlcnJvckNvZGU6IDEwMiB9KTsgZS5jb21wbGV0ZU1lcmNoYW50VmFsaWRhdGlvbih0KTsgfSkpOyB9LCBlLm9ucGF5bWVudGF1dGhvcml6ZWQgPSBmdW5jdGlvbiAodCkgeyBuLnRva2VuaXplKHsgdG9rZW46IHQucGF5bWVudC50b2tlbiB9LCAoZnVuY3Rpb24gKG4sIGkpIHsgaWYgKG4pXG4gICAgICAgIHJldHVybiBhLmJyb2FkY2FzdChcInBheW1lbnQtZXJyb3JcIiwgeyBlcnJvckNvZGU6IDEwMyB9KSwgdm9pZCBlLmNvbXBsZXRlUGF5bWVudCh3aW5kb3cuQXBwbGVQYXlTZXNzaW9uLlNUQVRVU19GQUlMVVJFKTsgdmFyIHMgPSB7IG5vbmNlOiBpLm5vbmNlIH07IHIgfHwgbyA/IGYodCwgcykgOiBtKHMpOyB9KSk7IH0sIGUuYmVnaW4oKTsgfSkpOyB2YXIgZCA9IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSBzLl9fcHJvdGVjdGVkX18uaXNBcHBsZVBheUFsbG93ZWQoKTsgYS5icm9hZGNhc3QoXCJFVkVOVF9BUFBMRV9QQVlfQ0FOX01BS0VfUEFZTUVOVFNcIiwgeyBjYW5NYWtlUGF5bWVudHM6IGUgfSk7IH0sIHAgPSBmdW5jdGlvbiAoZSkgeyByICYmIChlLnJlcXVpcmVkU2hpcHBpbmdDb250YWN0RmllbGRzID0gW1wiZW1haWxcIl0pLCBvICYmIChlLnJlcXVpcmVkQmlsbGluZ0NvbnRhY3RGaWVsZHMgPSBbXCJwb3N0YWxBZGRyZXNzXCJdKTsgfSwgZiA9IGZ1bmN0aW9uIChlLCBuKSB7IGUucGF5bWVudC5zaGlwcGluZ0NvbnRhY3QgJiYgKG4udXNlciA9IHsgZW1haWw6IGUucGF5bWVudC5zaGlwcGluZ0NvbnRhY3QuZW1haWxBZGRyZXNzIH0pOyB2YXIgdCA9IGUucGF5bWVudC5iaWxsaW5nQ29udGFjdCwgciA9IHsgY291bnRyeUNvZGU6IHQuY291bnRyeUNvZGUgPyB0LmNvdW50cnlDb2RlLnRvVXBwZXJDYXNlKCkgOiB0LmNvdW50cnlDb2RlLCB6aXBDb2RlOiB0LnBvc3RhbENvZGUsIGJpbGxpbmdaaXBDb2RlOiB0LnBvc3RhbENvZGUsIG5vbmNlOiBuIH07IGEuYnJvYWRjYXN0KFwiYXBwbGVQYXlQYXltZW50QXV0aG9yaXplZFwiICsgdSwgcik7IH0sIG0gPSBmdW5jdGlvbiAobikgeyBlLmNvbXBsZXRlUGF5bWVudCh3aW5kb3cuQXBwbGVQYXlTZXNzaW9uLlNUQVRVU19TVUNDRVNTKSwgYS5icm9hZGNhc3QoXCJhcHBsZVBheU5vbmNlXCIgKyB1LCBuKTsgfSwgZyA9IGZ1bmN0aW9uIChlKSB7IGkgPSBlLCB2KCk7IH0sIHYgPSBmdW5jdGlvbiAoKSB7IHkoKSB8fCB3KGMsIChmdW5jdGlvbiAoKSB7IGgoKTsgfSkpOyB9LCBoID0gZnVuY3Rpb24gKCkgeyBiKCkgfHwgdyhsLCAoZnVuY3Rpb24gKCkgeyB3aW5kb3cuYnJhaW50cmVlLmNsaWVudC5jcmVhdGUoeyBhdXRob3JpemF0aW9uOiBpIH0pLnRoZW4oKGZ1bmN0aW9uIChlKSB7IHdpbmRvdy5icmFpbnRyZWUuYXBwbGVQYXkuY3JlYXRlKHsgY2xpZW50OiBlIH0sIChmdW5jdGlvbiAoZSwgdCkgeyBlID8gYS5icm9hZGNhc3QoXCJwYXltZW50LWVycm9yXCIsIHsgZXJyb3JDb2RlOiAxMDEgfSkgOiAobiA9IHQsIGEuYnJvYWRjYXN0KFwiYXBwbGVQYXlJbml0XCIsIHt9KSk7IH0pKTsgfSkpLmNhdGNoKChmdW5jdGlvbiAoZSkgeyBpZiAoZSlcbiAgICAgICAgcmV0dXJuIGEuYnJvYWRjYXN0KFwicGF5bWVudC1lcnJvclwiLCB7IGVycm9yQ29kZTogMTAwIH0pLCB2b2lkIHMuZXJyb3IoXCJbVFBdIENsaWVudCBlcnJvcjogXCIgKyBlLm1lc3NhZ2UpOyB9KSk7IH0pKTsgfSwgdyA9IGZ1bmN0aW9uIChlLCBuKSB7IHMuYWRkU2NyaXB0KGUsIG4pOyB9LCB5ID0gZnVuY3Rpb24gKCkgeyBmb3IgKHZhciBlID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJzY3JpcHRcIiksIG4gPSAwLCB0ID0gZS5sZW5ndGg7IG4gPCB0OyBuKyspXG4gICAgICAgIGlmIChlW25dLnNyYy5pbmRleE9mKGMpID4gLTEpXG4gICAgICAgICAgICByZXR1cm4gITA7IH0sIGIgPSBmdW5jdGlvbiAoKSB7IGZvciAodmFyIGUgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZShcInNjcmlwdFwiKSwgbiA9IDAsIHQgPSBlLmxlbmd0aDsgbiA8IHQ7IG4rKylcbiAgICAgICAgaWYgKGVbbl0uc3JjLmluZGV4T2YobCkgPiAtMSlcbiAgICAgICAgICAgIHJldHVybiAhMDsgfTsgcmV0dXJuIHsgbmFtZTogXCJhcHBsZVBheVwiIH07IH0oKTtcbiAgICBwbi5jb250YWluZXIucmVnaXN0ZXIoXCJhcHBsZVBheVwiLCB7IHVzZVZhbHVlOiBnbiB9KSwgcG4uYXBwbGVQYXkgPSBwbi5jb250YWluZXIucmVzb2x2ZShcImFwcGxlUGF5XCIpO1xuICAgIHZhciB2biA9IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSBwbi5jb250YWluZXIucmVzb2x2ZShcInBvc3RtZXNzYWdlXCIpLCBuID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJ1dGlsXCIpLCB0ID0gXCJcIiwgciA9IHsgZW52aXJvbm1lbnQ6IFwiXCIsIGJpbGxpbmdSZXF1ZXN0Rmxvd0lkOiBcIlwiIH0sIG8gPSB7IGN1c3RvbWVyOiBcIlwiLCBtYW5kYXRlOiBcIlwiLCBiYW5rX2FjY291bnRfZW5kaW5nOiBcIlwiLCBiYW5rX2FjY291bnRfaG9sZGVyOiBcIlwiLCBiYW5rX25hbWU6IFwiXCIsIGN1cnJlbmN5OiBcIlwiIH0sIGkgPSAhMSwgYSA9IFwiaHR0cHM6Ly9wYXkuZ29jYXJkbGVzcy5jb20vYmlsbGluZy9zdGF0aWMvZHJvcGluL3YyL2luaXRpYWxpc2UuanNcIjsgZS5zdWJzY3JpYmUoXCJsb2FkZWRcIiwgKGZ1bmN0aW9uIChlKSB7IHQgPSBlLnNlbmRlciwgaSB8fCBcImlubGluZVwiID09PSBlLmRpc3BsYXlNb2RlIHx8IGMoYSwgKGZ1bmN0aW9uICgpIHsgaSA9ICEwOyB9KSk7IH0pKSwgZS5zdWJzY3JpYmUoXCJMT0FEX0dPQ0FSRExFU1NfRFJPUElOXCIsIChmdW5jdGlvbiAobikgeyB0ID0gbi5zZW5kZXIsIGkgPyBlLnNlbmQoXCJHT0NBUkRMRVNTX0RST1BJTl9MT0FERURcIiwgbnVsbCwgdCkgOiBjKGEsIChmdW5jdGlvbiAoKSB7IGkgPSAhMCwgZS5zZW5kKFwiR09DQVJETEVTU19EUk9QSU5fTE9BREVEXCIsIG51bGwsIHQpOyB9KSk7IH0pKSwgZS5zdWJzY3JpYmUoXCJHT0NBUkRMRVNTX0RST1BJTl9NQU5EQVRFX0NSRUFUSU9OX0lOSVRcIiwgKGZ1bmN0aW9uIChlKSB7IHIgPSBlLnBhcmFtcywgaSAmJiBzKCk7IH0pKTsgdmFyIHMgPSBmdW5jdGlvbiAoKSB7IHdpbmRvdy5Hb0NhcmRsZXNzRHJvcGluLmNyZWF0ZSh7IGJpbGxpbmdSZXF1ZXN0Rmxvd0lEOiByLmJpbGxpbmdSZXF1ZXN0Rmxvd0lkLCBlbnZpcm9ubWVudDogci5lbnZpcm9ubWVudCwgb25TdWNjZXNzOiBmdW5jdGlvbiAobikgeyB2YXIgciA9IG4ubGlua3MsIGkgPSByLmN1c3RvbWVyLCBhID0gci5tYW5kYXRlX3JlcXVlc3RfbWFuZGF0ZSwgcyA9IG4ucmVzb3VyY2VzLmN1c3RvbWVyX2JhbmtfYWNjb3VudCwgYyA9IHMuYWNjb3VudF9udW1iZXJfZW5kaW5nLCBsID0gcy5hY2NvdW50X2hvbGRlcl9uYW1lLCB1ID0gcy5iYW5rX25hbWUsIGQgPSBuLm1hbmRhdGVfcmVxdWVzdC5jdXJyZW5jeTsgbyA9IHsgY3VzdG9tZXI6IGksIG1hbmRhdGU6IGEsIGJhbmtfYWNjb3VudF9lbmRpbmc6IGMsIGJhbmtfYWNjb3VudF9ob2xkZXI6IGwsIGJhbmtfbmFtZTogdSwgY3VycmVuY3k6IGQgfSwgZS5zZW5kKFwiR09DQVJETEVTU19EUk9QSU5fTUFOREFURV9DUkVBVElPTl9DT01QTEVURVwiLCBvLCB0KTsgfSwgb25FeGl0OiBmdW5jdGlvbiAobikgeyBuID8gZS5zZW5kKFwicGF5bWVudC1lcnJvclwiLCB7IG1lc3NhZ2U6IG4gfSwgdCkgOiBlLnNlbmQoXCJHT0NBUkRMRVNTX0RST1BJTl9FTkFCTEVfUExVR0lOXCIsIG51bGwsIHQpOyB9IH0pLm9wZW4oKTsgfSwgYyA9IGZ1bmN0aW9uIChlLCB0KSB7IG4uYWRkU2NyaXB0KGUsIHQpOyB9OyByZXR1cm4geyBuYW1lOiBcImdvQ2FyZGxlc3NEcm9waW5cIiB9OyB9KCk7XG4gICAgcG4uY29udGFpbmVyLnJlZ2lzdGVyKFwiZ29DYXJkbGVzc0Ryb3BpblwiLCB7IHVzZVZhbHVlOiB2biB9KSwgcG4uZ29DYXJkbGVzc0Ryb3BpbiA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwiZ29DYXJkbGVzc0Ryb3BpblwiKTtcbiAgICB2YXIgaG4gPSBmdW5jdGlvbiAoKSB7IHZhciBlLCBuLCB0LCByID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJwb3N0bWVzc2FnZVwiKSwgbyA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwidXRpbFwiKSwgaSA9ICExOyByZXR1cm4geyBuYW1lOiBcImFwcGxlUGF5SW50ZWdyYXRpb25TZXJ2aWNlXCIsIGluaXRpYWxpemU6IGZ1bmN0aW9uICgpIHsgdmFyIGEgPSBmdW5jdGlvbiAoKSB7IGkgPSBvLl9fcHJvdGVjdGVkX18uaXNBcHBsZVBheUFsbG93ZWQoKSwgci5icm9hZGNhc3QoXCJFVkVOVF9BUFBMRV9QQVlfQ0FOX01BS0VfUEFZTUVOVFNcIiwgeyBjYW5NYWtlUGF5bWVudHM6IGkgfSk7IH07IHIuc3Vic2NyaWJlKFwicHJvdmlkZXItY29tcG9uZW50LWluaXRpYXRlZFwiLCAoZnVuY3Rpb24gKCkgeyBpICYmIHIuYnJvYWRjYXN0KFwiYXBwbGUtcGF5LWluaXRcIiwge30pOyB9KSksIHIuc3Vic2NyaWJlKFwiaW5pdFB3QXBwbGVQYXlcIiwgKGZ1bmN0aW9uICgpIHsgYSgpOyB9KSksIHIuc3Vic2NyaWJlKFwic3RhcnRDaGVja291dFwiLCAoZnVuY3Rpb24gKCkgeyBhKCk7IH0pKSwgci5zdWJzY3JpYmUoXCJwYXktc2Vzc2lvbi1yZWNlaXZlZFwiLCAoZnVuY3Rpb24gKGUpIHsgdHJ5IHtcbiAgICAgICAgICAgIG4uY29tcGxldGVNZXJjaGFudFZhbGlkYXRpb24oZS5wYXJhbXMuYXBwbGVQYXlTZXNzaW9uKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgci5icm9hZGNhc3QoXCJwYXltZW50LWVycm9yXCIsIHsgZXJyb3JDb2RlOiAxMTEsIGVycm9yczogZSB9KTtcbiAgICAgICAgfSB9KSksIHIuc3Vic2NyaWJlKFwiYXBwbGUtcGF5LWNvbXBsZXRlLXBheW1lbnRcIiwgKGZ1bmN0aW9uIChlKSB7IHZhciByOyAociA9IGUucGFyYW1zLnRlcm1JZCwgdCAmJiB0ICE9PSByKSB8fCBuLmNvbXBsZXRlUGF5bWVudChlLnBhcmFtcy5zdGF0dXMsIGUucGFyYW1zLmVycm9ycyk7IH0pKSwgci5zdWJzY3JpYmUoXCJzdGFydC1wdXJjaGFzZVwiLCAoZnVuY3Rpb24gKG8pIHsgdCA9IG8ucGFyYW1zLnRlcm1JZCB8fCBcIlwiLCBlID0gby5wYXJhbXMucmVzb3VyY2VOYW1lLCBuID0gbmV3IHdpbmRvdy5BcHBsZVBheVNlc3Npb24oMywgZnVuY3Rpb24gKGUpIHsgcmV0dXJuIHsgY291bnRyeUNvZGU6IGUucGFyYW1zLmNvdW50cnlDb2RlLCBjdXJyZW5jeUNvZGU6IGUucGFyYW1zLmN1cnJlbmN5Q29kZSwgc3VwcG9ydGVkTmV0d29ya3M6IFtcInZpc2FcIiwgXCJtYXN0ZXJDYXJkXCIsIFwiYW1leFwiLCBcImRpc2NvdmVyXCJdLCBtZXJjaGFudENhcGFiaWxpdGllczogW1wic3VwcG9ydHMzRFNcIl0sIHJlcXVpcmVkU2hpcHBpbmdDb250YWN0RmllbGRzOiBlLnBhcmFtcy5yZXF1aXJlZFNoaXBwaW5nQ29udGFjdEZpZWxkcyB8fCBbXSwgcmVxdWlyZWRCaWxsaW5nQ29udGFjdEZpZWxkczogZS5wYXJhbXMucmVxdWlyZWRCaWxsaW5nQ29udGFjdEZpZWxkcyB8fCBbXSwgdG90YWw6IHsgbGFiZWw6IGUucGFyYW1zLnJlc291cmNlTmFtZSwgYW1vdW50OiBlLnBhcmFtcy5jaGFyZ2VBbW91bnQgfSB9OyB9KG8pKSwgbi5vbnZhbGlkYXRlbWVyY2hhbnQgPSBmdW5jdGlvbiAobikgeyB2YXIgbywgaTsgbyA9IG4udmFsaWRhdGlvblVSTCwgaSA9IHsgdmFsaWRhdGlvblVybDogbywgZGlzcGxheWVkQ2FwdGlvbjogZSwgdXNlclRva2VuOiBudWxsLCB1c2VyUHJvdmlkZXI6IG51bGwsIHVzZXJSZWY6IG51bGwsIGphbnJhaW5DYXB0dXJlVG9rZW46IG51bGwsIGRvbWFpbk5hbWU6IHdpbmRvdy5sb2NhdGlvbi5ob3N0bmFtZSwgYWlkOiBudWxsLCB0ZXJtSWQ6IHQgfSwgci5icm9hZGNhc3QoXCJhcHBsZS1wYXktcGF5LXNlc3Npb24tcmVxdWVzdFwiLCBpKTsgfSwgbi5vbnBheW1lbnRhdXRob3JpemVkID0gZnVuY3Rpb24gKGUpIHsgdHJ5IHtcbiAgICAgICAgICAgIHIuYnJvYWRjYXN0KFwiYXBwbGUtcGF5LXBheW1lbnQtYXV0aG9yaXplZFwiLCB7IHBheW1lbnREYXRhOiBlLnBheW1lbnQsIHRlcm1JZDogdCB9KTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgci5icm9hZGNhc3QoXCJwYXltZW50LWVycm9yXCIsIHsgZXJyb3JDb2RlOiAxMTAsIGVycm9yOiBlIH0pO1xuICAgICAgICB9IH07IHRyeSB7XG4gICAgICAgICAgICBuLmJlZ2luKCk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHIuYnJvYWRjYXN0KFwicGF5bWVudC1lcnJvclwiLCB7IGVycm9yQ29kZTogMTEyLCBlcnJvcjogZSwgdGVybUlkOiB0IH0pO1xuICAgICAgICB9IH0pKSwgci5zdWJzY3JpYmUoXCJhYm9ydC1hcHBsZS1wYXktc2Vzc2lvblwiLCAoZnVuY3Rpb24gKCkgeyAhZnVuY3Rpb24gKCkgeyB0cnkge1xuICAgICAgICAgICAgbi5hYm9ydCgpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICBvLmVycm9yKGUpO1xuICAgICAgICB9IH0oKTsgfSkpOyB9LCBfX3Byb3RlY3RlZF9fOiB7IGFwcGxlUGF5Q2FuTWFrZVBheW1lbnRzV2l0aEFjdGl2ZUNhcmQ6IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSB7IHRoZW46IGZ1bmN0aW9uIChlKSB7IHJldHVybiBlKG51bGwpOyB9LCBjYXRjaDogZnVuY3Rpb24gKCkgeyB9IH07IHJldHVybiBwbi5hcHBsZVBheU1lcmNoYW50SWQgJiYgby5fX3Byb3RlY3RlZF9fLmlzQXBwbGVQYXlBbGxvd2VkKCkgJiYgcG4uYXBwbGVQYXlNZXJjaGFudElkID8gd2luZG93LkFwcGxlUGF5U2Vzc2lvbi5jYW5NYWtlUGF5bWVudHNXaXRoQWN0aXZlQ2FyZChwbi5hcHBsZVBheU1lcmNoYW50SWQpIDogZTsgfSB9IH07IH0oKTtcbiAgICBwbi5jb250YWluZXIucmVnaXN0ZXIoXCJhcHBsZVBheUludGVncmF0aW9uU2VydmljZVwiLCB7IHVzZVZhbHVlOiBobiB9KSwgcG4uYXBwbGVQYXlJbnRlZ3JhdGlvblNlcnZpY2UgPSBwbi5jb250YWluZXIucmVzb2x2ZShcImFwcGxlUGF5SW50ZWdyYXRpb25TZXJ2aWNlXCIpO1xuICAgIHZhciB3biA9IGZ1bmN0aW9uICgpIHsgdmFyIGUsIG4sIHQgPSBwbi5jb250YWluZXIucmVzb2x2ZShcInBvc3RtZXNzYWdlXCIpLCByID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJ1dGlsXCIpLCBvID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJhamF4XCIpLCBpID0gXCJkYXRhdHJhbnMtYXBwbGVwYXktYnV0dG9uXCIsIGEgPSBudWxsLCBzID0gbnVsbCwgYyA9ICExLCBsID0gZnVuY3Rpb24gKG4pIHsgZSA9IG4uc2VuZGVyLCBtKCkudGhlbihnKS50aGVuKHYpOyB9LCB1ID0gZnVuY3Rpb24gKG4pIHsgdmFyIHIgPSBudWxsOyBuIHx8IChyID0geyBtZXNzYWdlOiBuIH0pLCB0LnNlbmQoXCJkYXRhdHJhbnMtYXBwbGVwYXktc2VydmljZS1lcnJvclwiLCByLCBlKTsgfSwgZCA9IGZ1bmN0aW9uIChlKSB7IG4gPSBlLnBhcmFtcywgbSgpLnRoZW4oZykudGhlbihwKS5jYXRjaCgoZnVuY3Rpb24gKCkgeyB1KFwiQXBwbGUgUGF5IGJ1dHRvbiBpbml0IGVycm9yXCIpOyB9KSk7IH0sIHAgPSBmdW5jdGlvbiAoKSB7IFBheW1lbnRCdXR0b24uaW5pdChuLmFwcGxlUGF5Q29uZmlnKTsgfSwgZiA9IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpKTsgbnVsbCAhPT0gZSAmJiBudWxsICE9PSBlLmZpcnN0RWxlbWVudENoaWxkID8gZS5maXJzdEVsZW1lbnRDaGlsZC5jbGljaygpIDogdShcIkNvdWxkIG5vdCBwcm9jZXNzIHdpdGggQXBwbGUgUGF5LiBQbGVhc2UsIHRyeSBhZ2Fpbi5cIik7IH0sIG0gPSBmdW5jdGlvbiAoKSB7IHJldHVybiBudWxsICE9PSBzID8gcyA6IHMgPSBuZXcgUHJvbWlzZSgoZnVuY3Rpb24gKGUpIHsgby5yZXF1ZXN0KHsgdXJsOiB0cC5nZXRBcGlFbmRwb2ludCgpICsgXCIvYW5vbi9kYXRhdHJhbnMvYXBwbGVwYXkvY29uZmlnXCIsIGRhdGE6IHsgYWlkOiB0cC5haWQgfSwgZGF0YVR5cGU6IFwianNvbnBcIiwganNvbnBDYWxsYmFjazogXCJqc29ucENhbGxiYWNrXCIsIHN1Y2Nlc3M6IGZ1bmN0aW9uIChuKSB7IHZhciB0ID0gbi5jb25maWc7IGUodC51cmwpOyB9IH0pOyB9KSk7IH0sIGcgPSBmdW5jdGlvbiAoZSkgeyBpZiAobnVsbCAhPT0gYSlcbiAgICAgICAgcmV0dXJuIGE7IHZhciBuID0gXCJkYXRhdHJhbnMtYXBwbGUtcGF5XCI7IGlmICghZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobikpIHtcbiAgICAgICAgdmFyIHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic2NyaXB0XCIpO1xuICAgICAgICByZXR1cm4gdC5zcmMgPSBlLCB0LmlkID0gbiwgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0KSwgYSA9IG5ldyBQcm9taXNlKChmdW5jdGlvbiAoZSkgeyB0Lm9ubG9hZCA9IGZ1bmN0aW9uICgpIHsgZShudWxsKTsgfTsgfSkpO1xuICAgIH0gfSwgdiA9IGZ1bmN0aW9uICgpIHsgYyB8fCAoUGF5bWVudEJ1dHRvbi5vbihcImluaXRcIiwgaCksIFBheW1lbnRCdXR0b24ub24oXCJjcmVhdGVcIiwgdyksIFBheW1lbnRCdXR0b24ub24oXCJ0b2tlblwiLCB5KSwgUGF5bWVudEJ1dHRvbi5vbihcImFib3J0XCIsIChmdW5jdGlvbiAoKSB7IHUobnVsbCk7IH0pKSwgUGF5bWVudEJ1dHRvbi5vbihcInVuc3VwcG9ydGVkXCIsIChmdW5jdGlvbiAoKSB7IHUoXCJObyBwYXltZW50IG1ldGhvZCBpcyBzdXBwb3J0ZWRcIik7IH0pKSwgUGF5bWVudEJ1dHRvbi5vbihcImVycm9yXCIsIChmdW5jdGlvbiAoZSkgeyBlICYmIChyLmVycm9yKFwiZGF0YXRyYW5zQXBwbGVQYXlJbnRlZ3JhdGlvblNlcnZpY2UuIGFwcGxlIHBheSBidXR0b24gZXJyb3I6IFwiICsgZSksIHUoXCJDb3VsZCBub3QgcHJvY2VzcyB3aXRoIEFwcGxlIFBheS4gUGxlYXNlLCB0cnkgYWdhaW4uXCIpKTsgfSkpLCBjID0gITApOyB9LCBoID0gZnVuY3Rpb24gKCkgeyB2YXIgZSA9IGIoKTsgUGF5bWVudEJ1dHRvbi5jcmVhdGUoZSwgbi5wYXltZW50Q29uZmlnKS5jYXRjaCgoZnVuY3Rpb24gKCkgeyB1KFwiQXBwbGUgUGF5IGJ1dHRvbiBjcmVhdGUgZXJyb3JcIik7IH0pKTsgfSwgdyA9IGZ1bmN0aW9uICgpIHsgci5sb2coXCJkYXRhdHJhbnNBcHBsZVBheUludGVncmF0aW9uU2VydmljZSBwYXltZW50QnV0dG9uT25DcmVhdGVcIiksIHQuc2VuZChcImRhdGF0cmFucy1hcHBsZXBheS1zZXJ2aWNlLXJlYWR5XCIsIG51bGwsIGUpOyB9LCB5ID0gZnVuY3Rpb24gKG4pIHsgci5sb2coXCJkYXRhdHJhbnNBcHBsZVBheUludGVncmF0aW9uU2VydmljZSBwYXltZW50QnV0dG9uT25Ub2tlblwiKSwgdC5zZW5kKFwiZGF0YXRyYW5zLWFwcGxlcGF5LXNlcnZpY2UtdG9rZW5cIiwgbi50b2tlbi5kZXRhaWxzLnRva2VuLCBlKTsgfSwgYiA9IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpKTsgcmV0dXJuIG51bGwgPT09IGUgJiYgKChlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKSkuc2V0QXR0cmlidXRlKFwiaWRcIiwgaSksIGUuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiLCBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGUpKSwgZS5pbm5lckhUTUwgPSBcIlwiLCBlOyB9OyByZXR1cm4geyBuYW1lOiBcImRhdGF0cmFuc0FwcGxlUGF5SW50ZWdyYXRpb25TZXJ2aWNlXCIsIGluaXRpYWxpemU6IGZ1bmN0aW9uICgpIHsgci5fX3Byb3RlY3RlZF9fLmlzQXBwbGVQYXlBbGxvd2VkKCkgJiYgKHQuc3Vic2NyaWJlKFwiZGF0YXRyYW5zLWFwcGxlcGF5LWxvYWRlZFwiLCBsKSwgdC5zdWJzY3JpYmUoXCJkYXRhdHJhbnMtYXBwbGVwYXktY2hlY2tvdXQtaW5pdGlhdGUtcHVyY2hhc2VcIiwgZCksIHQuc3Vic2NyaWJlKFwiZGF0YXRyYW5zLWFwcGxlcGF5LW1ha2UtcHVyY2hhc2VcIiwgZikpOyB9IH07IH0oKTtcbiAgICBwbi5jb250YWluZXIucmVnaXN0ZXIoXCJkYXRhdHJhbnNBcHBsZVBheUludGVncmF0aW9uU2VydmljZVwiLCB7IHVzZVZhbHVlOiB3biB9KSwgcG4uZGF0YXRyYW5zQXBwbGVQYXlJbnRlZ3JhdGlvblNlcnZpY2UgPSBwbi5jb250YWluZXIucmVzb2x2ZShcImRhdGF0cmFuc0FwcGxlUGF5SW50ZWdyYXRpb25TZXJ2aWNlXCIpO1xuICAgIHZhciB5biA9IGZ1bmN0aW9uICgpIHsgdmFyIGUsIG4gPSBwbi5jb250YWluZXIucmVzb2x2ZShcInBvc3RtZXNzYWdlXCIpLCB0ID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJ1dGlsXCIpLCByID0gbnVsbCwgbyA9IG51bGwsIGkgPSAhMSwgYSA9IFwiXCI7IG4uc3Vic2NyaWJlKFwic3RyaXBlLWFwcGxlcGF5LWluaXRpYWxpemVkXCIsIChmdW5jdGlvbiAoKSB7IHMoKTsgfSkpLCBuLnN1YnNjcmliZShcInN0cmlwZS1hcHBsZXBheS1pbml0aWF0ZS1wdXJjaGFzZVwiLCAoZnVuY3Rpb24gKGUpIHsgcygpLnRoZW4oKGZ1bmN0aW9uICgpIHsgdmFyIG4gPSBlLnBhcmFtcy5hcGlLZXk7IG51bGwgPT09IHIgJiYgKHIgPSB3aW5kb3cuU3RyaXBlKG4pKTsgdmFyIHQgPSBlLnBhcmFtcy5wYXltZW50UmVxdWVzdFBheWxvYWQ7IHJldHVybiByLnBheW1lbnRSZXF1ZXN0KHQpOyB9KSkudGhlbigoZnVuY3Rpb24gKGUpIHsgcmV0dXJuIG8gPSBlLCBlLmNhbk1ha2VQYXltZW50KCk7IH0pKS50aGVuKChmdW5jdGlvbiAoZSkgeyBpID0gZSAmJiBlLmFwcGxlUGF5LCBuLmJyb2FkY2FzdChcInN0cmlwZS1hcHBsZXBheS1pbml0aWF0ZS1wdXJjaGFzZS1jb21wbGV0ZVwiLCB7IGNhbk1ha2VQYXltZW50OiBpIH0pLCBpICYmIChvLm9uKFwiY2FuY2VsXCIsIChmdW5jdGlvbiAoKSB7IG4uYnJvYWRjYXN0KFwic3RyaXBlLWFwcGxlcGF5LXN0YXJ0LXB1cmNoYXNlLWNvbXBsZXRlXCIgKyBhLCB7IHN0YXR1czogXCJmYWlsXCIgfSk7IH0pKSwgby5vbihcInBheW1lbnRtZXRob2RcIiwgKGZ1bmN0aW9uIChlKSB7IHZhciB0ID0gZS5wYXltZW50TWV0aG9kLmJpbGxpbmdfZGV0YWlscy5hZGRyZXNzLCByID0geyBjb3VudHJ5Q29kZTogdC5jb3VudHJ5LCB6aXBDb2RlOiB0LnBvc3RhbF9jb2RlLCBiaWxsaW5nWmlwQ29kZTogdC5wb3N0YWxfY29kZSB9LCBvID0gZS5wYXltZW50TWV0aG9kLmlkOyBuLmJyb2FkY2FzdChcInN0cmlwZS1hcHBsZXBheS1zdGFydC1wdXJjaGFzZS1jb21wbGV0ZVwiICsgYSwgeyBzdGF0dXM6IFwic3VjY2Vzc1wiLCBwYXltZW50TWV0aG9kSWQ6IG8sIHBheWVyRW1haWw6IGUucGF5ZXJFbWFpbCwgYmlsbGluZ0FkZHJlc3M6IHIgfSksIGUuY29tcGxldGUoXCJzdWNjZXNzXCIpOyB9KSkpOyB9KSkuY2F0Y2goKGZ1bmN0aW9uIChlKSB7IHQuZXJyb3IoZSksIG4uYnJvYWRjYXN0KFwic3RyaXBlLWFwcGxlcGF5LWluaXRpYXRlLXB1cmNoYXNlLWNvbXBsZXRlXCIsIHsgY2FuTWFrZVBheW1lbnQ6ICExIH0pOyB9KSk7IH0pKSwgbi5zdWJzY3JpYmUoXCJzdHJpcGUtYXBwbGVwYXktc3RhcnQtcHVyY2hhc2VcIiwgKGZ1bmN0aW9uIChlKSB7IGEgPSBlLnBhcmFtcy50ZXJtSWQgfHwgXCJcIjsgdmFyIG4gPSBlLnBhcmFtcy5wYXltZW50UmVxdWVzdFBheWxvYWQ7IG8udXBkYXRlKG4pLCBvLnNob3coKTsgfSkpLCBuLnN1YnNjcmliZShcInN0cmlwZS1hcHBsZXBheS1hYm9ydC1yZXF1ZXN0XCIsIChmdW5jdGlvbiAoKSB7IG8gJiYgby5hYm9ydCgpLCBuLmJyb2FkY2FzdChcInN0cmlwZS1hcHBsZXBheS1yZW9wZW4tcmVxdWVzdFwiKTsgfSkpOyB2YXIgcyA9IGZ1bmN0aW9uICgpIHsgaWYgKG51bGwgIT0gZSlcbiAgICAgICAgcmV0dXJuIGU7IGlmICghZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzdHJpcGUuanNcIikpIHtcbiAgICAgICAgdmFyIG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic2NyaXB0XCIpO1xuICAgICAgICByZXR1cm4gbi5zcmMgPSBcImh0dHBzOi8vanMuc3RyaXBlLmNvbS92My9cIiwgbi5pZCA9IFwic3RyaXBlLmpzXCIsIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobiksIGUgPSBuZXcgUHJvbWlzZSgoZnVuY3Rpb24gKGUpIHsgbi5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7IGUobnVsbCk7IH07IH0pKTtcbiAgICB9IH07IHJldHVybiB7IG5hbWU6IFwic3RyaXBlQXBwbGVQYXlJbnRlZ3JhdGlvblNlcnZpY2VcIiB9OyB9KCk7XG4gICAgcG4uY29udGFpbmVyLnJlZ2lzdGVyKFwic3RyaXBlQXBwbGVQYXlJbnRlZ3JhdGlvblNlcnZpY2VcIiwgeyB1c2VWYWx1ZTogeW4gfSksIHBuLnN0cmlwZUFwcGxlUGF5SW50ZWdyYXRpb25TZXJ2aWNlID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJzdHJpcGVBcHBsZVBheUludGVncmF0aW9uU2VydmljZVwiKTtcbiAgICB2YXIgYm4gPSBmdW5jdGlvbiAoKSB7IHZhciBlID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJwb3N0bWVzc2FnZVwiKSwgbiA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwidXRpbFwiKTsgZS5zdWJzY3JpYmUoXCJvYmktaGFuZGxlLTNkcy1jaGFsbGVuZ2VcIiwgKGZ1bmN0aW9uIChlKSB7IHZhciByID0gZS5wYXJhbXM7IGlmICh3aW5kb3cub2JpY2spXG4gICAgICAgIHQocik7XG4gICAgZWxzZSB7XG4gICAgICAgIGlmICgtMSA9PT0gW1wiaHR0cHM6Ly9qc2wucWF0Lm9iaS5hb2wuY29tL29iaXBtc2VydmljZS9vYmljay51bWQuanNcIiwgXCJodHRwczovL2pzbC5wcm9kLm9iaS5hb2wuY29tL29iaXBtc2VydmljZS9vYmljay51bWQuanNcIl0uaW5kZXhPZihyLm9iaWNrVXJsKSlcbiAgICAgICAgICAgIHJldHVybiB2b2lkIG4uZXJyb3IoXCJVbnRydXN0ZWQgb2JpY2tVcmwgZGV0ZWN0ZWQ6IFwiICsgci5vYmlja1VybCk7XG4gICAgICAgIHZhciBvID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNjcmlwdFwiKTtcbiAgICAgICAgby5zcmMgPSByLm9iaWNrVXJsLCBvLmlkID0gXCJvYmljay5qc1wiLCBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKG8pLCBvLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHsgbi5sb2coby5pZCArIFwiIG9ubG9hZFwiKSwgdChyKTsgfTtcbiAgICB9IH0pKTsgdmFyIHQgPSBmdW5jdGlvbiAodCkgeyBpZiAodC5zdGVwVXBVcmwgJiYgMCAhPT0gdC5zdGVwVXBVcmwuaW5kZXhPZihcImh0dHBcIikpXG4gICAgICAgIG4uZXJyb3IoXCJUaGVyZSBpcyBubyBsaW5rIGluIHBhcmFtcy5zdGVwVXBVcmwgZm9yIE9CSVwiKTtcbiAgICBlbHNlIHtcbiAgICAgICAgdmFyIHIgPSB7IHN0ZXBVcFVybDogdC5zdGVwVXBVcmwsIGp3dDogdC5qd3QsIHRyYW5zYWN0aW9uSWQ6IHQudHJhbnNhY3Rpb25JZCwgekluZGV4OiB0LnpJbmRleCB9O1xuICAgICAgICB3aW5kb3cub2JpY2suaGFuZGxlM2RzQ2hhbGxlbmdlKHIpLnRoZW4oKGZ1bmN0aW9uICh0KSB7IG4uZGVidWcodCksIGUuYnJvYWRjYXN0KFwib2JpLTNkcy1jaGFsbGVuZ2UtY29tcGxldGVcIiwgeyB0aHJlZURTVHJhbnNhY3Rpb25JZDogdC50aHJlZURTVHJhbnNhY3Rpb25JZCwgY2hhbGxlbmdlU3RhdHVzOiB0LmNoYWxsZW5nZVN0YXR1cyB9KTsgfSkpLmNhdGNoKChmdW5jdGlvbiAodCkgeyBuLmVycm9yKHQpLCBlLmJyb2FkY2FzdChcIm9iaS0zZHMtY2hhbGxlbmdlLWNvbXBsZXRlXCIsIHsgZXJyb3I6IFwiY2hhbGxlbmdlLWVycm9yXCIsIHBheWxvYWQ6IHQgfSk7IH0pKTtcbiAgICB9IH07IHJldHVybiB7IG5hbWU6IFwib2JpM0RTQ2hhbGxlbmdlXCIgfTsgfSgpO1xuICAgIHBuLmNvbnRhaW5lci5yZWdpc3RlcihcIm9iaTNEU0NoYWxsZW5nZVwiLCB7IHVzZVZhbHVlOiBibiB9KSwgcG4ub2JpM0RTQ2hhbGxlbmdlID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJvYmkzRFNDaGFsbGVuZ2VcIik7XG4gICAgdmFyIGtuID0gZnVuY3Rpb24gKCkgeyB2YXIgZSA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwianFVdGlsc1wiKSwgbiA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwidXRpbFwiKSwgdCA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwiYXBpXCIpLCByID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJ1c2VyXCIpLCBvID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJwaWFub0lkXCIpLCBpID0geyBkaXNwbGF5TW9kZTogXCJpbmxpbmVcIiwgY29udGFpbmVyU2VsZWN0b3I6IFwiYm9keVwiLCBsb2dpblN1Y2Nlc3M6IGQgfSwgYSA9IFwicmVhZGVyX2lkXCIsIHMgPSBmdW5jdGlvbiAoKSB7IHJldHVybiBcIi9cIiArIHBuLmFpZCArIFwiL2V4ZWN1dGlvbi9hbXBcIjsgfSwgYyA9IGZ1bmN0aW9uICgpIHsgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBuLmdldFF1ZXJ5UGFyYW1CeU5hbWUoXCJyZXR1cm5cIikgKyBcIiNzdWNjZXNzPXRydWVcIjsgfTsgdmFyIGwgPSBmdW5jdGlvbiAoZSkgeyByZXR1cm4gL15cXHcrJC9pLnRlc3QoZSk7IH0sIHUgPSBmdW5jdGlvbiAoZSkgeyB2YXIgciA9IHt9OyBpZiAoci5yZWFkZXJfaWQgPSBuLmdldFF1ZXJ5UGFyYW1CeU5hbWUoYSksIHIucmVhZGVyX2lkKSB7XG4gICAgICAgIHZhciBvID0gcG4uZ2V0RXhwZXJpZW5jZUVuZHBvaW50KCExKTtcbiAgICAgICAgdC5jYWxsQXBpKHMoKSArIFwiL2xvZ291dFwiLCByLCBlLCBvLCAhMSwgITApO1xuICAgIH1cbiAgICBlbHNlXG4gICAgICAgIG4ubG9nKFwicmVhZGVyX2lkIGNhbm5vdCBiZSBlbXB0eVwiKTsgfTsgZnVuY3Rpb24gZChlLCByKSB7IHZhciBvID0gZSB8fCB7fTsgaWYgKG8ucmVhZGVyX2lkIHx8IChvLnJlYWRlcl9pZCA9IG4uZ2V0UXVlcnlQYXJhbUJ5TmFtZShhKSksIG8ucmVhZGVyX2lkKSB7XG4gICAgICAgIHZhciBpID0gcG4uZ2V0RXhwZXJpZW5jZUVuZHBvaW50KCExKTtcbiAgICAgICAgdC5jYWxsQXBpKHMoKSArIFwiL2xvZ2luXCIsIG8sIHIsIGksICExLCAhMCk7XG4gICAgfVxuICAgIGVsc2VcbiAgICAgICAgbi5sb2coXCJyZWFkZXJfaWQgY2Fubm90IGJlIGVtcHR5XCIpOyB9IHJldHVybiB7IG5hbWU6IFwiYW1wXCIsIHNob3dMb2dpbjogZnVuY3Rpb24gKHQpIHsgdCA9IHQgfHwge307IHZhciBhID0gci5nZXRQcm92aWRlcigpOyBpZiAoYS5nZXROYW1lKCkgPT09IG8uZ2V0TmFtZSgpKSB7XG4gICAgICAgICAgICB2YXIgcztcbiAgICAgICAgICAgIHMgPSB0LmxvZ2luU3VjY2VzcyAmJiBlLmlzRnVuY3Rpb24odC5sb2dpblN1Y2Nlc3MpID8gdC5sb2dpblN1Y2Nlc3MgOiBjO1xuICAgICAgICAgICAgdmFyIGwgPSBmdW5jdGlvbiAoKSB7IGQoe30sIHMpOyB9LCB1ID0gT2JqZWN0LmFzc2lnbih7fSwgaSwgdCk7XG4gICAgICAgICAgICByLmlzVXNlclZhbGlkKCkgPyBsKCkgOiAodS5sb2dpblN1Y2Nlc3MgPSBsLCBvLnNob3codSkpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIG4ubG9nKFwiQ3VycmVudCB1c2VyIHByb3ZpZGVyXCIgKyBhLm5hbWUgKyBcIiBpcyBub3QgYWxsb3dlZCBmb3IgYW1wXCIpOyB9LCBsb2dvdXQ6IGZ1bmN0aW9uIChuKSB7IG4gPSBlLmlzRnVuY3Rpb24obikgPyBuIDogYywgci5nZXRQcm92aWRlcigpLmdldE5hbWUoKSA9PT0gby5nZXROYW1lKCkgPyBvLmxvZ291dCgoZnVuY3Rpb24gKCkgeyB1KG4pOyB9KSkgOiB1KG4pOyB9LCBsb2dpbjogZnVuY3Rpb24gKHQpIHsgdmFyIGkgPSByLmdldFByb3ZpZGVyKCkuZ2V0TmFtZSgpOyBpID09PSBvLmdldE5hbWUoKSAmJiAodCA9IHQgPyBlLmRlZXBFeHRlbmQoe30sIHQsIHsgdXNlclByb3ZpZGVyOiBpIH0pIDogeyB1c2VyUHJvdmlkZXI6IGkgfSk7IHZhciBhID0geyB1c2VyX3RyYW5zaWVudDogITAsIHVzZXJfcHJvdmlkZXI6IFwicHVibGlzaGVyX3VzZXJcIiB9OyBpZiAodCAmJiB0LnJlYWRlcklkICYmIChhLnJlYWRlcl9pZCA9IHQucmVhZGVySWQpLCB0ICYmIHQudXNlclRva2VuICYmIChhLnVzZXJfdG9rZW4gPSB0LnVzZXJUb2tlbiksIHQgJiYgdC51c2VyUHJvdmlkZXIgJiYgKGEudXNlcl9wcm92aWRlciA9IHQudXNlclByb3ZpZGVyLCBhLnVzZXJfdHJhbnNpZW50ID0gITEpLCAhZnVuY3Rpb24gKHQpIHsgaWYgKHQgJiYgdC51c2VyU3RhdGUgJiYgZS5pc1BsYWluT2JqZWN0KHQudXNlclN0YXRlKSkge1xuICAgICAgICAgICAgdmFyIHIgPSBPYmplY3Qua2V5cyh0LnVzZXJTdGF0ZSk7XG4gICAgICAgICAgICBpZiAoci5maWx0ZXIobCkubGVuZ3RoICE9PSByLmxlbmd0aClcbiAgICAgICAgICAgICAgICByZXR1cm4gbi5lcnJvcihcInVzZXJfc3RhdGUgYWNjZXB0IG9ubHkgY29udGFpbiBsZXR0ZXJzLCBudW1iZXJzIGFuZCB1bmRlcnNjb3JlXCIpLCAhMTtcbiAgICAgICAgfSByZXR1cm4gITA7IH0odCkpXG4gICAgICAgICAgICByZXR1cm4gITE7IHQgJiYgdC51c2VyU3RhdGUgJiYgKGEudXNlcl9zdGF0ZSA9IEpTT04uc3RyaW5naWZ5KHQudXNlclN0YXRlKSk7IGQoYSwgKGZ1bmN0aW9uIChuKSB7IDAgPT09IG4uY29kZSA/IHQubG9naW5TdWNjZXNzICYmIGUuaXNGdW5jdGlvbih0LmxvZ2luU3VjY2VzcykgJiYgdC5sb2dpblN1Y2Nlc3MoKSA6IHQubG9naW5GYWlsICYmIGUuaXNGdW5jdGlvbih0LmxvZ2luRmFpbCkgJiYgdC5sb2dpbkZhaWwoKTsgfSkpOyB9IH07IH0oKTtcbiAgICBwbi5jb250YWluZXIucmVnaXN0ZXIoXCJhbXBcIiwgeyB1c2VWYWx1ZToga24gfSksIHBuLmFtcCA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwiYW1wXCIpO1xuICAgIHZhciBfbiA9IGZ1bmN0aW9uICgpIHsgdmFyIGUsIG4gPSBwbi5jb250YWluZXIucmVzb2x2ZShcInBvc3RtZXNzYWdlXCIpLCB0ID0gW3sgcmVzb3VyY2VSZWdFeHA6IG5ldyBSZWdFeHAoXCIvY2hlY2tvdXQvb2ZmZXIvc2hvd1wiKSwgbGFiZWw6IFwic2hvd09mZmVyXCIgfSwgeyByZXNvdXJjZVJlZ0V4cDogbmV3IFJlZ0V4cChcInRpbnlwYXNzLm1pbi5qcyRcIiksIGxhYmVsOiBcInRpbnlwYXNzTWluSlNcIiB9LCB7IHJlc291cmNlUmVnRXhwOiBuZXcgUmVnRXhwKFwiL3hidWlsZGVyL2V4cGVyaWVuY2UvZXhlY3V0ZVwiKSwgbGFiZWw6IFwiZXhwZXJpZW5jZUV4ZWN1dGVcIiB9XSwgciA9ICExLCBvID0gW107IGZ1bmN0aW9uIGkoZSkgeyBlLmZvckVhY2goKGZ1bmN0aW9uIChlKSB7ICFmdW5jdGlvbiAoZSkgeyBpZiAoIWZ1bmN0aW9uIChlKSB7IHJldHVybiB0LnNvbWUoKGZ1bmN0aW9uIChuKSB7IHJldHVybiBlLm5hbWUubWF0Y2gobi5yZXNvdXJjZVJlZ0V4cCk7IH0pKTsgfShlKSlcbiAgICAgICAgcmV0dXJuOyAhZnVuY3Rpb24gKGUpIHsgaWYgKCFhKCkpXG4gICAgICAgIHJldHVybiB2b2lkIG8ucHVzaChlKTsgby5wdXNoKGUpLCBzKCk7IH0oZSk7IH0oZSk7IH0pKTsgfSBmdW5jdGlvbiBhKCkgeyByZXR1cm4gciAmJiBlOyB9IGZ1bmN0aW9uIHMoKSB7IGEoKSAmJiAoby5mb3JFYWNoKChmdW5jdGlvbiAodCkgeyBuLnNlbmQoXCJFVkVOVF9UUF9QRVJGT1JNQU5DRV9EQVRBXCIsIHsgZW50cnk6IHQgfSwgZSk7IH0pKSwgbyA9IFtdKTsgfSByZXR1cm4gZnVuY3Rpb24gKCkgeyBpZiAod2luZG93LnBlcmZvcm1hbmNlICYmIHdpbmRvdy5QZXJmb3JtYW5jZU9ic2VydmVyICYmIFwiZnVuY3Rpb25cIiA9PSB0eXBlb2YgcGVyZm9ybWFuY2UuZ2V0RW50cmllcykge1xuICAgICAgICB2YXIgdCA9IHdpbmRvdy5QZXJmb3JtYW5jZU9ic2VydmVyLnByb3RvdHlwZS5vYnNlcnZlO1xuICAgICAgICB3aW5kb3cuUGVyZm9ybWFuY2VPYnNlcnZlci5wcm90b3R5cGUub2JzZXJ2ZSA9IGZ1bmN0aW9uICgpIHsgZm9yICh2YXIgZSA9IFtdLCBuID0gMDsgbiA8IGFyZ3VtZW50cy5sZW5ndGg7IG4rKylcbiAgICAgICAgICAgIGVbbl0gPSBhcmd1bWVudHNbbl07IHRyeSB7XG4gICAgICAgICAgICB0LmFwcGx5KHRoaXMsIGUpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7IH0gfSwgbi5zdWJzY3JpYmUoXCJFVkVOVF9MT0dHRVJfUkVBRFlcIiwgKGZ1bmN0aW9uIChuKSB7IGUgPSBuLnNlbmRlciwgciA9ICEwLCBzKCk7IH0pKSwgaShwZXJmb3JtYW5jZS5nZXRFbnRyaWVzKCkpLCBuZXcgUGVyZm9ybWFuY2VPYnNlcnZlcigoZnVuY3Rpb24gKGUpIHsgaShlLmdldEVudHJpZXMoKSk7IH0pKS5vYnNlcnZlKHsgZW50cnlUeXBlczogW1wibWVhc3VyZVwiLCBcInJlc291cmNlXCJdIH0pO1xuICAgIH0gfSgpLCB7IG5hbWU6IFwicGVyZm9ybWFuY2VNZXRyaWNzXCIgfTsgfSgpO1xuICAgIHBuLmNvbnRhaW5lci5yZWdpc3RlcihcInBlcmZvcm1hbmNlTWV0cmljc1wiLCB7IHVzZVZhbHVlOiBfbiB9KSwgcG4ucGVyZm9ybWFuY2VNZXRyaWNzID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJwZXJmb3JtYW5jZU1ldHJpY3NcIik7XG4gICAgdmFyIENuID0gZnVuY3Rpb24gKCkgeyB2YXIgZSA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwiYXBpXCIpLCBuID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJwaWFub0lkXCIpOyByZXR1cm4geyBuYW1lOiBcImRvdWJsZU9wdEluXCIsIGNoZWNrOiBmdW5jdGlvbiAoKSB7IHBuLnVzZXIuaXNVc2VyVmFsaWQoKSAmJiBuZXcgUHJvbWlzZSgoZnVuY3Rpb24gKG4pIHsgZS5jYWxsQXBpKFwiL2VtYWlsL2NvbmZpcm1hdGlvbi9jaGVja1wiLCB7fSwgKGZ1bmN0aW9uIChlKSB7IG4oZSk7IH0pKTsgfSkpLnRoZW4oKGZ1bmN0aW9uIChlKSB7IGUgJiYgITEgPT09IGUuZGF0YSAmJiBuLnNob3dFbWFpbENvbmZpcm1hdGlvblJlcXVpcmVkKCk7IH0pKTsgfSB9OyB9KCk7XG4gICAgcG4uY29udGFpbmVyLnJlZ2lzdGVyKFwiZG91YmxlT3B0SW5cIiwgeyB1c2VWYWx1ZTogQ24gfSksIHBuLmRvdWJsZU9wdEluID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJkb3VibGVPcHRJblwiKTtcbiAgICB2YXIgSW4gPSBmdW5jdGlvbiAoKSB7IHZhciBlID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJhcGlcIiksIG4gPSBwbi5jb250YWluZXIucmVzb2x2ZShcInBvc3RtZXNzYWdlXCIpLCB0ID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJ1dGlsXCIpLCByID0gdC5kZWJvdW5jZSgoZnVuY3Rpb24gKCkgeyBuZXcgUHJvbWlzZSgoZnVuY3Rpb24gKG4sIHQpIHsgdmFyIHIgPSB7IGFpZDogcG4uYWlkIH07IGUuY2FsbEFwaShvLCByLCAoZnVuY3Rpb24gKGUpIHsgZSAmJiBlLmRhdGEgJiYgbihlLmRhdGEpLCB0KGUubWVzc2FnZSk7IH0pKTsgfSkpLnRoZW4oaSwgYSk7IH0pLCAxNTAwKSwgbyA9IFwiL2V4dGVybmFsVmVyaWZpY2F0aW9uL3N5bmNocm9uaXplU3Vic2NyaXB0aW9uc1wiLCBpID0gZnVuY3Rpb24gKGUpIHsgbi5icm9hZGNhc3QoXCJORVdTQ1lDTEVfSEFTX0JFRU5fU1lOQ0hST05JWkVEX1NVQ0NFU1NcIiwgeyBkYXRhOiBlIH0pOyB9LCBhID0gZnVuY3Rpb24gKGUpIHsgdC5lcnJvcihcIm5ld3NjeWNsZSBtb2R1bGU6IHN5bmMgcmVxdWVzdCBmYWlsZWQgd2l0aCBlcnJvcjogXCIgKyBlKTsgfTsgcmV0dXJuIHsgbmFtZTogXCJuZXdzY3ljbGVcIiwgc3luY1N1YnNjcmlwdGlvbnM6IHIgfTsgfSgpO1xuICAgIHBuLmNvbnRhaW5lci5yZWdpc3RlcihcIm5ld3NjeWNsZVwiLCB7IHVzZVZhbHVlOiBJbiB9KSwgcG4ubmV3c2N5Y2xlID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJuZXdzY3ljbGVcIik7XG4gICAgdmFyIFNuID0gZnVuY3Rpb24gKCkgeyB2YXIgZSA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwiYWpheFwiKSwgbiA9IHBuLmNvbnRhaW5lci5yZXNvbHZlKFwicG9zdG1lc3NhZ2VcIiksIHQgPSBwbi5jb250YWluZXIucmVzb2x2ZShcInV0aWxcIiksIHIgPSB7IGVuYWJsZWQ6ICExLCBjYXB0Y2hhM19zaXRlX2tleTogXCJcIiwgYWlkOiBcIlwiIH0sIG8gPSBmdW5jdGlvbiAobikgeyBlLnJlcXVlc3QoeyB1cmw6IHRwLmdldEFwaUVuZHBvaW50KCkgKyBcIi9hbm9uL2NhcHRjaGEvZ2V0LmpzXCIsIGRhdGE6IHsgYWlkOiB0cC5haWQgfSwgZGF0YVR5cGU6IFwianNvbnBcIiwganNvbnBDYWxsYmFjazogXCJqc29ucENhbGxiYWNrXCIsIGNhY2hlOiAhMCwgc3VjY2VzczogZnVuY3Rpb24gKGUpIHsgIWZ1bmN0aW9uIChlLCBuKSB7IGUuY29uZmlnICYmIGUuY29uZmlnLmVuYWJsZWQgPyAociA9IGUuY29uZmlnLCBuICYmIG4oKSkgOiBlLm1lc3NhZ2UgJiYgdC5lcnJvcihlLm1lc3NhZ2UpOyB9KGUsIG4pOyB9IH0pOyB9OyBmdW5jdGlvbiBpKCkgeyB3aW5kb3cuZ3JlY2FwdGNoYS5yZWFkeShhKSwgYygpOyB9IHZhciBhID0gZnVuY3Rpb24gKCkgeyB2YXIgZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7IGUuaWQgPSBcInRwLXJlY2FwdGNoYVwiLCBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGUpLCB3aW5kb3cuZ3JlY2FwdGNoYS5yZW5kZXIoXCJ0cC1yZWNhcHRjaGFcIiwgeyBzaXRla2V5OiByLmNhcHRjaGEzX3NpdGVfa2V5LCBzaXplOiBcImludmlzaWJsZVwiLCBcImVycm9yLWNhbGxiYWNrXCI6IGZ1bmN0aW9uICgpIHsgZS5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7IH0gfSk7IH0sIHMgPSBmdW5jdGlvbiAoKSB7IHdpbmRvdy5vbkNhcHRjaGFWM0xvYWQgPSBpOyB2YXIgZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzY3JpcHRcIik7IGUuc3JjID0gXCJodHRwczovL3d3dy5nb29nbGUuY29tL3JlY2FwdGNoYS9hcGkuanM/b25sb2FkPW9uQ2FwdGNoYVYzTG9hZCZyZW5kZXI9ZXhwbGljaXRcIiwgZS50eXBlID0gXCJ0ZXh0L2phdmFzY3JpcHRcIiwgZS5hc3luYyA9ICEwLCBlLmRlZmVyID0gITAsIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQoZSk7IH0sIGMgPSBmdW5jdGlvbiAoKSB7IG4uc3Vic2NyaWJlKFwiZ2V0LWNhcHRjaGEtdjMtZW5hYmxlZFwiLCAoZnVuY3Rpb24gKCkgeyBsKCk7IH0pKSwgbi5zdWJzY3JpYmUoXCJnZXQtY2FwdGNoYS12My10b2tlblwiLCAoZnVuY3Rpb24gKGUpIHsgd2luZG93LmdyZWNhcHRjaGEucmVhZHkoKGZ1bmN0aW9uICgpIHsgcmV0dXJuIHUoZS5wYXJhbXMuYWN0aW9uKTsgfSkpOyB9KSk7IH0sIGwgPSBmdW5jdGlvbiAoKSB7IG4uYnJvYWRjYXN0KFwiY2FwdGNoYS12My1lbmFibGVkLXZhbHVlXCIsIHsgaXNFbmFibGVkOiByLmVuYWJsZWQgfSk7IH0sIHUgPSBmdW5jdGlvbiAoZSkgeyB3aW5kb3cuZ3JlY2FwdGNoYS5leGVjdXRlKHsgYWN0aW9uOiBlIH0pLnRoZW4oKGZ1bmN0aW9uIChlKSB7IG4uYnJvYWRjYXN0KFwiY2FwdGNoYS12My10b2tlblwiLCB7IHRva2VuOiBlIH0pOyB9KSkuY2F0Y2goKGZ1bmN0aW9uICgpIHsgbi5icm9hZGNhc3QoXCJjYXB0Y2hhLXYzLXRva2VuXCIsIHsgdG9rZW46IFwiXCIgfSk7IH0pKTsgfTsgcmV0dXJuIHsgbmFtZTogXCJjYXB0Y2hhVjNcIiwgYWRkQ2FwdGNoYVYzOiBmdW5jdGlvbiAoKSB7IG8ocyk7IH0gfTsgfSgpO1xuICAgIHBuLmNvbnRhaW5lci5yZWdpc3RlcihcImNhcHRjaGFWM1wiLCB7IHVzZVZhbHVlOiBTbiB9KSwgcG4uY2FwdGNoYVYzID0gcG4uY29udGFpbmVyLnJlc29sdmUoXCJjYXB0Y2hhVjNcIik7XG4gICAgdmFyIHhuID0gZnVuY3Rpb24gKGUpIHsgdm9pZCAwID09PSBlICYmIChlID0gcG4uY29udGFpbmVyKTsgdmFyIG4gPSBlLnJlc29sdmUoXCJsb2dcIiksIHQgPSBlLnJlc29sdmUoXCJwb3N0bWVzc2FnZVwiKSwgciA9IGUucmVzb2x2ZShcImFwaVwiKSwgbyA9IGUucmVzb2x2ZShcInV0aWxcIiksIGkgPSBlLnJlc29sdmUoXCJ2ZXJzaW9uU2VydmljZVwiKSwgYSA9IFwiRVZFTlRfVFBfRVJST1JfSEFORExFUlwiLCBzID0gXCJzZGtcIiwgYyA9IFtdLCBsID0gITAsIHUgPSBmdW5jdGlvbiAoZSkgeyBpZiAoaCgpICYmICFnKGMsIGUpKSB7XG4gICAgICAgIGUudGFncyB8fCAoZS50YWdzID0gW1widW5rbm93blwiXSksIGUuYWlkID0gcG4uYWlkLCBlLnYgPSBpLmdldFRpbnlwYXNzVmVyc2lvbigpO1xuICAgICAgICB2YXIgbiA9IHsgZGV0YWlsczogZSB9O1xuICAgICAgICBjLnB1c2gobik7XG4gICAgfSB9OyB2YXIgZCA9IGZ1bmN0aW9uIChlKSB7IHZhciBuID0gZS5wYXJhbXM7IEFycmF5LmlzQXJyYXkobikgJiYgbi5mb3JFYWNoKChmdW5jdGlvbiAoZSkgeyB1KGUpOyB9KSk7IH07IGZ1bmN0aW9uIHAoZSkgeyB2YXIgbiwgdDsgaWYgKGUubWVzc2FnZS50b0xvd2VyQ2FzZSgpLmluZGV4T2YoXCJzY3JpcHQgZXJyb3JcIikgPiAtMSlcbiAgICAgICAgdSh7IG1lc3NhZ2U6IFwiUHJvYmFibHkgdGhhdCBpcyBQaWFubyBlcnJvci5cIiwgdXJsOiB3aW5kb3cubG9jYXRpb24uaHJlZiwgdGFnczogW3NdIH0pO1xuICAgIGVsc2Uge1xuICAgICAgICB2YXIgciA9IG51bGwgPT0gZSA/IHZvaWQgMCA6IGUuZXJyb3I7XG4gICAgICAgIGlmICh2KG51bGwgPT0gciA/IHZvaWQgMCA6IHIuc3RhY2spKVxuICAgICAgICAgICAgcmV0dXJuICExO1xuICAgICAgICB1KHsgc3RhY2s6IG51bGwgIT09IChuID0gbnVsbCA9PSByID8gdm9pZCAwIDogci5zdGFjaykgJiYgdm9pZCAwICE9PSBuID8gbiA6IFwibi9hXCIsIG1lc3NhZ2U6IG51bGwgIT09ICh0ID0gbnVsbCA9PSByID8gdm9pZCAwIDogci5tZXNzYWdlKSAmJiB2b2lkIDAgIT09IHQgPyB0IDogXCJuL2FcIiwgdXNlckFnZW50OiBuYXZpZ2F0b3IudXNlckFnZW50LCB0YWdzOiBbc10gfSk7XG4gICAgfSByZXR1cm4gITE7IH0gdmFyIGYgPSBmdW5jdGlvbiAoKSB7IHNldEludGVydmFsKChmdW5jdGlvbiAoKSB7IG0oKSwgbCA9ICExOyB9KSwgMTVlMyk7IH0sIG0gPSBmdW5jdGlvbiAoKSB7IHZhciBlID0gYy5maWx0ZXIoKGZ1bmN0aW9uIChlKSB7IHJldHVybiAhZS5zZW5kOyB9KSk7IGlmICgwICE9PSBlLmxlbmd0aCkge1xuICAgICAgICB2YXIgdCA9IGUubWFwKChmdW5jdGlvbiAoZSkgeyByZXR1cm4gZS5kZXRhaWxzOyB9KSksIG8gPSB7IHR5cGU6IFwiY29uc29sZS1lcnJvci1tZXNzYWdlXCIsIHNyY1R5cGU6IFwidHNcIiwgbG9nX21lc3NhZ2U6IEpTT04uc3RyaW5naWZ5KHQpIH07XG4gICAgICAgIG4ubG9nQmVhY29uUmVxdWVzdChyLmdldEVuZHBvaW50KCkgKyBcIi9hbm9uL2Vycm9yL2xvZ1wiLCBvKSwgZS5mb3JFYWNoKChmdW5jdGlvbiAoZSkgeyByZXR1cm4gZS5zZW5kID0gITA7IH0pKTtcbiAgICB9IH0sIGcgPSBmdW5jdGlvbiAoZSwgbikgeyB2YXIgdCA9IGUubWFwKChmdW5jdGlvbiAoZSkgeyByZXR1cm4gSlNPTi5zdHJpbmdpZnkoZS5kZXRhaWxzKTsgfSkpLCByID0gSlNPTi5zdHJpbmdpZnkobik7IHJldHVybiAtMSAhPT0gdC5pbmRleE9mKHIpOyB9LCB2ID0gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIC0xID09PSAobnVsbCA9PSBlID8gdm9pZCAwIDogZS5pbmRleE9mKFwidGlueXBhc3NcIikpOyB9LCBoID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gISFvLl9fcHJvdGVjdGVkX18uZ2V0TG9jYWxTdG9yYWdlSXRlbShcInRpbnlwYXNzRXJyb3JIYW5kbGVyVGVzdE1vZGVcIikgfHwgMCA9PT0gdygwLCAxZTMpOyB9LCB3ID0gZnVuY3Rpb24gKGUsIG4pIHsgdmFyIHQgPSBlIC0gLjUgKyBNYXRoLnJhbmRvbSgpICogKG4gLSBlICsgMSk7IHJldHVybiBNYXRoLnJvdW5kKHQpOyB9LCB5ID0gZnVuY3Rpb24gKGUsIG4pIHsgcmV0dXJuIHZvaWQgMCA9PT0gZSAmJiAoZSA9IFtdKSwgbiA/IGUuY29uY2F0KG4pIDogZTsgfTsgcmV0dXJuIHsgbmFtZTogXCJ0aW55cGFzc0Vycm9ySGFuZGxlclwiLCBhZGRFcnJvcjogZnVuY3Rpb24gKGUsIG4pIHsgdHJ5IHtcbiAgICAgICAgICAgIHZhciB0ID0geyBwbGFjZTogbiwgdGFnczogW3NdIH07XG4gICAgICAgICAgICBlIGluc3RhbmNlb2YgRXJyb3IgPyAodC5zdGFjayA9IGUuc3RhY2ssIHQubWVzc2FnZSA9IGUubWVzc2FnZSkgOiB0LnN0YWNrID0gSlNPTi5zdHJpbmdpZnkoZSksIGwgJiYgKHQudGFncyA9IHkodC50YWdzLCBcImluaXRFcnJvclwiKSksIHUodCk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHsgfSB9LCBpbml0aWFsaXplOiBmdW5jdGlvbiAoKSB7IHRyeSB7XG4gICAgICAgICAgICBwbi5pc1NhbmRib3goKSB8fCAodC5zdWJzY3JpYmUoYSwgZCksIG51bGwgPT09IChlID0gd2luZG93LmFkZEV2ZW50TGlzdGVuZXIpIHx8IHZvaWQgMCA9PT0gZSB8fCBlLmNhbGwod2luZG93LCBcImVycm9yXCIsIHApLCBmKCkpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oXCJDYW5ub3Qgc3RhcnQgd2F0Y2hpbmcgZXJyb3JzXCIsIGUpO1xuICAgICAgICB9IHZhciBlOyB9IH07IH07XG4gICAgcG4uY29udGFpbmVyLnJlZ2lzdGVyKFwidGlueXBhc3NFcnJvckhhbmRsZXJcIiwgeyB1c2VWYWx1ZTogeG4oKSB9KSwgcG4udGlueXBhc3NFcnJvckhhbmRsZXIgPSBwbi5jb250YWluZXIucmVzb2x2ZShcInRpbnlwYXNzRXJyb3JIYW5kbGVyXCIpO1xuICAgIHZhciBQbiA9IGZ1bmN0aW9uIChlKSB7IHZvaWQgMCA9PT0gZSAmJiAoZSA9IHBuLmNvbnRhaW5lcik7IHZhciBuID0gZS5yZXNvbHZlKFwiYXBpXCIpLCB0ID0gZS5yZXNvbHZlKFwiY29va2llXCIpLCByID0gZS5yZXNvbHZlKFwibG9nXCIpLCBvID0gZS5yZXNvbHZlKFwianFVdGlsc1wiKSwgaSA9IGUucmVzb2x2ZShcInV0aWxcIiksIGEgPSBlLnJlc29sdmUoXCJsb2dnaW5nXCIpLCBzID0gZS5yZXNvbHZlKFwiZmluZ2VycHJpbnRcIiksIGMgPSBlLnJlc29sdmUoXCJ1c2VyXCIpLCBsID0gZS5yZXNvbHZlKFwic2hhMVwiKSwgdSA9IGUucmVzb2x2ZShcImFjdGl2ZXRpbWVyXCIpLCBkID0gZS5yZXNvbHZlKFwic2Nyb2xsRGVwdGhcIiksIHAgPSBlLnJlc29sdmUoXCJkb3VibGVDbGlja0ZvclB1Ymxpc2hlclwiKSwgZiA9IGUucmVzb2x2ZShcIm9mZmVyXCIpLCBtID0gZS5yZXNvbHZlKFwidmlld3BvcnRFeGl0XCIpLCBnID0gZS5yZXNvbHZlKFwiaWRsZVwiKSwgdiA9IGUucmVzb2x2ZShcImV4cGVyaWVuY2VcIiksIGggPSBlLnJlc29sdmUoXCJwaWFub0lkXCIpLCB3ID0gZS5yZXNvbHZlKFwicGlhbm9Fc3BcIiksIHkgPSBlLnJlc29sdmUoXCJhcHBsZVBheUludGVncmF0aW9uU2VydmljZVwiKSwgYiA9IGUucmVzb2x2ZShcImRhdGF0cmFuc0FwcGxlUGF5SW50ZWdyYXRpb25TZXJ2aWNlXCIpLCBrID0gZS5yZXNvbHZlKFwiY3hlbnNlXCIpOyBlLnJlc29sdmUoXCJ0aW55cGFzc0Vycm9ySGFuZGxlclwiKTsgdmFyIF8gPSBlLnJlc29sdmUoXCJjYXB0Y2hhVjNcIiksIEMgPSBwbi5jb250YWluZXIucmVzb2x2ZShcInBvc3RtZXNzYWdlXCIpLCBJID0gXCJleHJzXCIsIFMgPSBudWxsLCB4ID0gXCJ2b3VjaGVyX2NvZGVcIiwgUCA9IFwiX19wdmlcIiwgRSA9ICExLCBUID0gITEsIEEgPSB7fSwgTSA9IG51bGwsIE8gPSBrLl9fcHJvdGVjdGVkX18uZ2V0T3JHZW5lcmF0ZUN4Q29tcGF0aWJsZUJpZCgpLCBSID0geyBBUFBMRV9QQVlfQlQ6IDI1LCBBUFBMRV9QQVlfU1M6IDM4LCBBUFBMRV9QQVlfU1RSSVBFOiA0MSwgQVBQTEVfUEFZX1BXOiA0MiwgREFUQVRSQU5TX0FQUExFX1BBWTogNjEgfSwgTCA9IG5ldyBTZXQoT2JqZWN0LnZhbHVlcyhSKSksIE4gPSB2b2lkIDAsIFUgPSBbXSwgaiA9ICExLCBEID0gITEsIEYgPSBmdW5jdGlvbiAoKSB7IGlmIChcImlQXCIgPT09IG5hdmlnYXRvci5wbGF0Zm9ybS5zdWJzdHIoMCwgMikpIHtcbiAgICAgICAgdmFyIGUgPSAvY29uc3RydWN0b3IvaS50ZXN0KHdpbmRvdy5IVE1MRWxlbWVudCksIG4gPSB3aW5kb3cubmF2aWdhdG9yLCB0ID0gbi51c2VyQWdlbnQsIHIgPSAhIXdpbmRvdy5pbmRleGVkREI7XG4gICAgICAgIGlmICgtMSA9PT0gdC5pbmRleE9mKFwiU2FmYXJpXCIpIHx8IC0xID09PSB0LmluZGV4T2YoXCJWZXJzaW9uXCIpIHx8IG4uc3RhbmRhbG9uZSkge1xuICAgICAgICAgICAgaWYgKCFyICYmIGUgfHwgIXdpbmRvdy5zdGF0dXNiYXIudmlzaWJsZSlcbiAgICAgICAgICAgICAgICA7XG4gICAgICAgICAgICBlbHNlIGlmICh3aW5kb3cud2Via2l0ICYmIHdpbmRvdy53ZWJraXQubWVzc2FnZUhhbmRsZXJzIHx8ICFlIHx8IHIpXG4gICAgICAgICAgICAgICAgcmV0dXJuICEwO1xuICAgICAgICB9XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIDtcbiAgICB9IHJldHVybiAhMTsgfSgpOyB2YXIgQiwgViwgcSwgeiA9IGZ1bmN0aW9uICgpIHsgdmFyIGU7IHRyeSB7XG4gICAgICAgIGUgPSBKU09OLnBhcnNlKGkuX19wcm90ZWN0ZWRfXy5nZXRDb29raWUoUCkpO1xuICAgIH1cbiAgICBjYXRjaCAobikge1xuICAgICAgICBlID0ge307XG4gICAgfSByZXR1cm4gZTsgfSwgSCA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGkuZ2V0Q3VycmVudERvbWFpbkZyb21Db29raWUoUCk7IH0sIFcgPSBmdW5jdGlvbiAoZSwgbikgeyB2YXIgdCA9IEE7IEEgPSB7fTsgdmFyIHIgPSB7fTsgZm9yICh2YXIgbyBpbiB0KVxuICAgICAgICBpZiAodC5oYXNPd25Qcm9wZXJ0eShvKSlcbiAgICAgICAgICAgIGZvciAodmFyIGkgaW4gcltvXSA9IHJbb10gfHwgW10sIHRbb10pXG4gICAgICAgICAgICAgICAgdFtvXS5oYXNPd25Qcm9wZXJ0eShpKSAmJiByW29dLnB1c2godFtvXVtpXSk7IGJlKHIsIGUsIG4pOyB9LCBKID0gZnVuY3Rpb24gKCkgeyBpZiAodi5leGVjdXRlLmludm9rZUNvdW50ID4gMCkge1xuICAgICAgICB2YXIgZSA9IEcoKTtcbiAgICAgICAgcmV0dXJuIENlKCkgJiYgSWUocmUoKSwgZSwgcG4uY3hlbnNlU2l0ZUlkKSwgZTtcbiAgICB9IHJldHVybiBDZSgpID8gay5fX3Byb3RlY3RlZF9fLnRyeVRvR2V0Q3hQYWdlVmlld0lkKFNlKCkpIDogRygpOyB9OyBmdW5jdGlvbiBHKCkgeyBmdW5jdGlvbiBlKGUsIG4sIHQpIHsgdCA9IHQgfHwgXCIwXCI7IHZhciByID0gU3RyaW5nKGUpOyByZXR1cm4gci5sZW5ndGggPj0gbiA/IHIgOiBuZXcgQXJyYXkobiAtIHIubGVuZ3RoICsgMSkuam9pbih0KSArIHI7IH0gaWYgKENlKCkpXG4gICAgICAgIHJldHVybiBTZSgpOyB2YXIgbiA9IGkucmFuZG9tU3RyaW5nKDE2KSwgdCA9IGwuaGFzaChbcy5nZXRGaW5nZXJwcmludCgpLCB3aW5kb3cubG9jYXRpb24uaHJlZl0uam9pbihcIlwiKSksIHIgPSBuZXcgRGF0ZTsgcmV0dXJuIFtbZShyLmdldEZ1bGxZZWFyKCksIDQpLCBlKHIuZ2V0TW9udGgoKSArIDEsIDIpLCBlKHIuZ2V0RGF0ZSgpLCAyKSwgZShyLmdldEhvdXJzKCksIDIpLCBlKHIuZ2V0TWludXRlcygpLCAyKSwgZShyLmdldFNlY29uZHMoKSwgMiksIGUoci5nZXRNaWxsaXNlY29uZHMoKSwgMyldLmpvaW4oXCItXCIpLCBuLCB0XS5qb2luKFwiLVwiKTsgfSB2YXIgUSA9IGZ1bmN0aW9uIChlKSB7IHZhciBuID0geyBwYXRoOiBcIi9cIiwgZXhwaXJlczogMSwgZG9tYWluOiBWLmN1cnJlbnREb21haW4gfTsgcmV0dXJuIGUgJiYgKG4uZG9tYWluID0gZSksIG47IH0sIFggPSBmdW5jdGlvbiAoZSwgbikgeyBlLmRvbWFpbiA9IG4uZG9tYWluLCBlLnRpbWUgPSAobmV3IERhdGUpLmdldFRpbWUoKSwgaS5fX3Byb3RlY3RlZF9fLnNldENvb2tpZShQLCBKU09OLnN0cmluZ2lmeShlKSwgbik7IH0sICQgPSBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IChuZXcgRGF0ZSkuZ2V0VGltZSgpLCB0ID0gNmU0ICogaS5nZXRCcm93c2VyVGltZXpvbmVPZmZzZXQoKSwgciA9IGkuZ2V0QXBwVGltZXpvbmVPZmZzZXQoKSwgbyA9IG5ldyBEYXRlKGUudGltZSkuc2V0SG91cnMoMCwgMCwgMCwgMCkgKyA4NjRlNSAtIHQgLSByOyByZXR1cm4gZS50aW1lICsgMThlNSA8IG4gfHwgbiA+PSBvOyB9LCBZID0gZnVuY3Rpb24gKCkgeyBpZiAoaS5fX3Byb3RlY3RlZF9fLmNhbWVGcm9tRmJTdWJzY3JpcHRpb25zKCkpXG4gICAgICAgIHJldHVybiAhMTsgaWYgKCFWLmN1cnJlbnREb21haW4pXG4gICAgICAgIHJldHVybiAhMTsgdmFyIGUgPSBpLmdldFJlZmVycmVyKCk7IGlmIChNICYmIE0gPT09IGUpXG4gICAgICAgIHJldHVybiAhMTsgdmFyIG4gPSBpLmdldEhvc3RuYW1lKGUpLCB0ID0gbmV3IFJlZ0V4cChWLmN1cnJlbnREb21haW4ucmVwbGFjZSgvXFwuL2csIFwiXFxcXC5cIikucmVwbGFjZSgvXlxcXFwuLywgXCJcXFxcLj9cIikgKyBcIiRcIikudGVzdChuKTsgcmV0dXJuIEJvb2xlYW4obikgJiYgIXQ7IH0sIEsgPSBmdW5jdGlvbiAoKSB7IHZhciBlID0geigpOyAoIWUgfHwgIWUuaWQgfHwgIWUudGltZSB8fCAkKGUpIHx8IFkoKSkgJiYgKGUuaWQgPSBcInYtXCIgKyBHKCkpLCBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IFEoKTsgZS5kb21haW4gfHwgVi5jdXJyZW50RG9tYWluID8gWChlLCBuKSA6IGkud2FpdENhbGwoXCJkb21haW5Jc1JlY2VpdmVkXCIsIChmdW5jdGlvbiAodCkgeyBjZSh0KSwgbi5kb21haW4gPSB0LCBYKGUsIG4pOyB9KSk7IH0oZSksIFYudmlzaXQgPSBlOyB9LCBaID0gZnVuY3Rpb24gKGUsIG4sIHQpIHsgdmFyIHIsIGEsIGMgPSBcIm1hbnVhbFwiOyBpZiAodm9pZCAwID09PSBuKVxuICAgICAgICBuID0gd2luZG93LmxvY2F0aW9uLmhyZWY7XG4gICAgZWxzZSB7XG4gICAgICAgIGlmIChcIm9iamVjdFwiICE9IHR5cGVvZiBuKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmlyc3QgcGFyYW1ldGVyIHRvIHRyYWNrIHBhZ2UgbXVzdCBiZSBhIFVSTCBvciBhbiBvYmplY3RcIik7XG4gICAgICAgIHZhciBsID0gbjtcbiAgICAgICAgaWYgKHZvaWQgMCA9PT0gbC51cmwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJNdXN0IHN1cHBseSB1cmwgcHJvcGVydHlcIik7XG4gICAgICAgIG4gPSBsLnVybCwgdm9pZCAwICE9PSBsLnRhZ3MgJiYgKHQgPSBsLnRhZ3MpLCB2b2lkIDAgIT09IGwuc3VibWl0VHlwZSAmJiAoYyA9IGwuc3VibWl0VHlwZSk7XG4gICAgfSB0IHx8ICh0ID0gcG4udGFncyksIHBuLmN1c3RvbVBhZ2VVcmwgJiYgKGUuY3VzdG9tX3BhZ2VfdXJsID0gaS5wcmVwYXJlVXJsUGFyYW1ldGVyKHBuLmN1c3RvbVBhZ2VVcmwpKSwgdm9pZCAwICE9PSB0ID8gXCJbb2JqZWN0IEFycmF5XVwiICE9PSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodCkgJiYgXCJbb2JqZWN0IFN0cmluZ11cIiAhPT0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHQpID8gKGkubG9nKFwiVGFncyBtdXN0IGJlIGFuIGFycmF5IG9yIGEgY29tbWEtc2VwYXJhdGVkIHN0cmluZywgaWdub3Jpbmcgc3VwcGxpZWQgdGFnc1wiKSwgdCA9IFwiXCIpIDogdCBpbnN0YW5jZW9mIEFycmF5ICYmICh0ID0gdC5qb2luKFwiLFwiKSkgOiB0ID0gXCJcIiwgcS50cmFjaygpLCBlLnBhZ2Vfc2Vzc2lvbl9pZCA9IHEucGFnZVNlc3Npb25JZCwgZS50cmFja19jb3VudCA9IHEudHJhY2tDb3VudCwgd2UoZSksIHBuLmNvbnRlbnRDcmVhdGVkID8gYSA9IHBuLmNvbnRlbnRDcmVhdGVkIDogcG4uY29udGVudENyZWF0ZWRTZWxlY3RvciAmJiBvLnF1ZXJ5RWwocG4uY29udGVudENyZWF0ZWRTZWxlY3RvcikgJiYgKGEgPSBudWxsID09PSAociA9IG8ucXVlcnlFbChwbi5jb250ZW50Q3JlYXRlZFNlbGVjdG9yKSkgfHwgdm9pZCAwID09PSByID8gdm9pZCAwIDogci5pbm5lckhUTUwpLCBhICYmIChlLmNvbnRlbnRfY3JlYXRlZCA9IGEpLCBcImJvb2xlYW5cIiA9PSB0eXBlb2YgcG4uY29udGVudElzTmF0aXZlICYmIChlLmNvbnRlbnRfaXNfbmF0aXZlID0gcG4uY29udGVudElzTmF0aXZlKSwgcG4uem9uZSAmJiAoZS56b25lID0gcG4uem9uZSksIHBuLml0ZW1JZCAmJiAoZS5pdGVtX2lkID0gcG4uaXRlbUlkKTsgdmFyIHUgPSBwbi5jb250ZW50U2VjdGlvbiB8fCBzZShcInNlY3Rpb25cIik7IHUgJiYgKGUuY29udGVudF9zZWN0aW9uID0gdSk7IHZhciBkID0gcG4uY29udGVudEF1dGhvciB8fCBzZShcImF1dGhvclwiKTsgZCAmJiAoZS5jb250ZW50X2F1dGhvciA9IGQpOyB2YXIgcCA9IHBuLmNvbnRlbnRJZCB8fCBzZShcImlkXCIpOyBwICYmIChlLmNvbnRlbnRfaWQgPSBwKTsgdmFyIGYsIG0gPSBpLl9fcHJvdGVjdGVkX18uZ2V0Q29va2llKFwic2FpbHRocnVfaGlkXCIpOyBtICYmIChlLnNhaWx0aHJ1X2hpZCA9IG0pLCBNICYmIE0gPT09IGkuZ2V0UmVmZXJyZXIoKSA/IGYgPSBcIlwiIDogKGYgPSBpLmdldFJlZmVycmVyKCksIE0gPSBmKSwgZS5yZWZlcmVyID0gaS5wcmVwYXJlVXJsUGFyYW1ldGVyKGYpLCB0ICYmIChlLnRhZ3MgPSB0KSwgZS51cmwgPSBpLnByZXBhcmVVcmxQYXJhbWV0ZXIobiksIGUuZmluZ2VycHJpbnQgPSBzLmdldEZpbmdlcnByaW50KCksIGUuYWRibG9ja2VyID0gaS5nZXRBZGJsb2NrU3RhdHVzKCksIGUuYWRibG9ja2VyICE9PSBpLkFEQkxPQ0tFUl9TVEFUVVMuRU5BQkxFRF9BRlRFUl9ESVNBQkxFRCAmJiBlLmFkYmxvY2tlciAhPT0gaS5BREJMT0NLRVJfU1RBVFVTLkVOQUJMRUQgfHwgKHBuLnNldEN1c3RvbVBhcmFtKFwiX2FiclwiLCBpLmdldEFkYmxvY2tlclN0YXR1c1JlYXNvbigpLCBcInVzZXJcIiwgITApLCBwbi5zZXRDdXN0b21QYXJhbShcIl9hYnNoXCIsIGkuZ2V0QWRibG9ja2VySGlzdG9yeUNvb2tpZUluZm8oKS5jb29raWVWYWx1ZSArIFwiXCIsIFwidXNlclwiLCAhMCkpLCBlLnRpbWV6b25lX29mZnNldCA9IGkuZ2V0QnJvd3NlclRpbWV6b25lT2Zmc2V0KCksIGUuc3VibWl0X3R5cGUgPSBjOyB2YXIgZyA9IGFlKCk7IHJldHVybiBlLnZpc2l0X2lkID0gZywgZS5uZXdfdmlzaXQgPSBvZShnKSwgZS5rZXl3b3JkcyA9IG8uZ2V0QXR0cignbWV0YVtuYW1lPVwia2V5d29yZHNcIl0nLCBcImNvbnRlbnRcIikgfHwgby5nZXRBdHRyKCdtZXRhW25hbWU9XCJuZXdzX2tleXdvcmRzXCJdJywgXCJjb250ZW50XCIpIHx8IFwiXCIsIGUudGl0bGUgPSBvLmdldEF0dHIoJ21ldGFbcHJvcGVydHk9XCJvZzp0aXRsZVwiXScsIFwiY29udGVudFwiKSB8fCBcIlwiLCBlLmRlc2NyaXB0aW9uID0gby5nZXRBdHRyKCdtZXRhW3Byb3BlcnR5PVwib2c6ZGVzY3JpcHRpb25cIl0nLCBcImNvbnRlbnRcIikgfHwgXCJcIiwgZS5jb250ZW50X3R5cGUgPSBvLmdldEF0dHIoJ21ldGFbcHJvcGVydHk9XCJvZzp0eXBlXCJdJywgXCJjb250ZW50XCIpIHx8IFwiXCIsIFtcImtleXdvcmRzXCIsIFwidGl0bGVcIiwgXCJkZXNjcmlwdGlvblwiLCBcImNvbnRlbnRfdHlwZVwiXS5mb3JFYWNoKChmdW5jdGlvbiAobikgeyBlW25dID0gZVtuXS5zdWJzdHIoMCwgODE5Mik7IH0pKSwgZS5jdXN0b21fdmFyaWFibGVzID0gSlNPTi5zdHJpbmdpZnkocG4uY3VzdG9tVmFyaWFibGVzKSwgbmUoZSksIGU7IH0sIGVlID0gZnVuY3Rpb24gKCkgeyB2YXIgZSA9IHsgYWlkOiBwbi5haWQgfSwgbiA9IGkuZ2V0VGJjQ29va2llKCksIHQgPSB7IGFjdGl2ZTogdS5nZXRBY3RpdmVUaW1lSW5TZWNvbmRzKCksIHRvdGFsOiB1LmdldFRvdGFsVGltZUluU2Vjb25kcygpIH07IG4gJiYgKGUudGJjID0gbiksIHQudG90YWwgPCB0LmFjdGl2ZSAmJiAodC50b3RhbCA9IHQuYWN0aXZlKSwgZS50aW1lX3NwZW50ID0gSlNPTi5zdHJpbmdpZnkodCksIGUuc2Nyb2xsID0gSlNPTi5zdHJpbmdpZnkoeyBtYXhfcGFnZV9oZWlnaHQ6IGQuZ2V0TWF4RG9jdW1lbnRIZWlnaHQoKSwgbWF4X2RlcHRoOiBkLmdldE1heFNjcm9sbERlcHRoKCkgfSksIGUudmlld3BvcnRfZXhpdCA9IG0uZ2V0U3VtT2ZDb2Rlc0RpcmVjdGlvbigpLCBlLnVybCA9IGkucHJlcGFyZVVybFBhcmFtZXRlcih3aW5kb3cubG9jYXRpb24uaHJlZiksIHdlKGUpLCBlLnZpc2l0X2lkID0gYWUoKSwgaWUoKTsgdmFyIHIgPSB7fSwgYSA9IHAuZ2V0QWRzKDIwMCk7IHJldHVybiBhLmxlbmd0aCAmJiAoci5kZnAgPSBhKSwgby5pc0VtcHR5T2JqZWN0KHIpIHx8IChlLmFkcyA9IEpTT04uc3RyaW5naWZ5KHIpKSwgZTsgfSwgbmUgPSBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IHt9OyByZXR1cm4gcG4uY3VzdG9tUGFyYW1zICYmIChuID0gby5kZWVwRXh0ZW5kKHt9LCBwbi5jdXN0b21QYXJhbXMpKSwgby5pc0VtcHR5T2JqZWN0KG4pIHx8IChlLmN1c3RvbV9wYXJhbXMgPSBKU09OLnN0cmluZ2lmeShuKSksIGU7IH0sIHRlID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gcS5pZDsgfSwgcmUgPSBmdW5jdGlvbiAoKSB7IHJldHVybiBPOyB9LCBvZSA9IGZ1bmN0aW9uIChlKSB7IHZhciBuID0gVi5sYXN0VHJhY2tlZFZpc2l0SWQgIT09IGU7IHJldHVybiBWLmxhc3RUcmFja2VkVmlzaXRJZCA9IGUsIG47IH0sIGllID0gZnVuY3Rpb24gKCkgeyBWLmNoZWNrRm9yUmVmcmVzaCA9ICEwOyB9LCBhZSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIFYuY2hlY2tGb3JSZWZyZXNoICYmIChLKCksIFYuY2hlY2tGb3JSZWZyZXNoID0gITEpLCBWLnZpc2l0LmlkOyB9LCBzZSA9IGZ1bmN0aW9uIChlKSB7IHJldHVybiAoZG9jdW1lbnQuaGVhZC5xdWVyeVNlbGVjdG9yKFwibWV0YVtuYW1lPVwiICsgZSArIFwiXVwiKSB8fCB7fSkuY29udGVudDsgfSwgY2UgPSBmdW5jdGlvbiAoZSkgeyBWLmN1cnJlbnREb21haW4gPSBlOyB9LCBsZSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuICEocG4uZW5kcG9pbnQgJiYgcG4uZW5kcG9pbnQubWF0Y2goL3NhbmRib3gvKSk7IH0sIHVlID0gZnVuY3Rpb24gKGUsIHQsIHIsIG8pIHsgcG4uYWlkICYmIDAgIT09IHBuLmFpZC5sZW5ndGggPyBsZSgpICYmIGkud2FpdENhbGwoXCJyZWZyZXNoQWNjZXNzVG9rZW5MaXN0XCIsIChmdW5jdGlvbiAoKSB7IGkud2FpdENhbGwoXCJvZmZlckNyZWF0ZVwiLCAoZnVuY3Rpb24gKCkgeyBhLnNldFRpbWUoXCJ0cmFja1wiKSwgaS5zdGFydENhbGwoXCJwYWdlVHJhY2tcIiksIG4uY2FsbEFwaShlLCB0LCAoZnVuY3Rpb24gKGUpIHsgaS5kb25lQ2FsbChcInBhZ2VUcmFja1wiKSwgciAmJiByKGUpOyB9KSwgcG4uZ2V0VHJhY2tpbmdFbmRwb2ludCgpICsgXCIvYXBpL3YzXCIsIG8pOyB9KSk7IH0pKSA6IGkubG9nKFwiTXVzdCBzdXBwbHkgYSB2YWxpZCB0cC5haWQgYmVmb3JlIGNhbGxpbmcgdHAuaW5pdCgpXCIpOyB9LCBkZSA9IGZ1bmN0aW9uICgpIHsgRSAmJiBxLnRyYWNrQ291bnQgPiAwICYmIChwZSgpLCBoZSgpKTsgfSwgcGUgPSBmdW5jdGlvbiAoZSkgeyBpZiAobGUoKSlcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHZhciBuID0gZWUoKTtcbiAgICAgICAgICAgIG0uaXNJbml0aWFsaXplZCgpICYmIG0ucmVzZXRTdW1PZkNvZGVzRGlyZWN0aW9uVG9EZWZhdWx0KCksIHIubG9nQmVhY29uUmVxdWVzdChwbi5nZXRUcmFja2luZ0VuZHBvaW50KCkgKyBcIi9hcGkvdjMvcGFnZS91bmxvYWRcIiwgbiksIGdlKCk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGkuZXJyb3IoXCJtYWluOiBlcnJvciBvbiB0cmFja2luZyBwYWdlIHVubG9hZCBldmVudDogXCIsIGUpO1xuICAgICAgICB9IH0sIGZlID0gZnVuY3Rpb24gKCkgeyBUIHx8IChUID0gITAsIHBlKCkpOyB9LCBtZSA9IGZ1bmN0aW9uICgpIHsgRSA9ICEwOyB9LCBnZSA9IGZ1bmN0aW9uICgpIHsgRSA9ICExOyB9LCB2ZSA9IGZ1bmN0aW9uICgpIHsgRSAmJiBmZSgpLCBXKCEwLCBcImJlYWNvbl9yZXF1ZXN0XCIpLCB2Ll9fcHJvdGVjdGVkX18uc2VuZFN0YXRpc3RpY3NFeGVjdXRlZE5vZGVzKFwidW5sb2FkXCIpOyB9LCBoZSA9IGZ1bmN0aW9uICgpIHsgdS5yZXNldFJlY29yZGVkVGltZSgpOyB9LCB3ZSA9IGZ1bmN0aW9uIChlKSB7IGUgJiYgKGUucGFnZXZpZXdfaWQgPSB0ZSgpKTsgfSwgeWUgPSBmdW5jdGlvbiAoZSwgbikgeyBpZiAobGUoKSlcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGRlKCk7XG4gICAgICAgICAgICB2YXIgdCA9IFooe30sIGUsIG4pO1xuICAgICAgICAgICAgdWUoXCIvcGFnZS90cmFja1wiLCB0KSwgbWUoKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgaS5lcnJvcihcIm1haW46IGVycm9yIG9uIHBhZ2UgdHJhY2tpbmcgZXZlbnQ6IFwiLCBlKTtcbiAgICAgICAgfSB9LCBiZSA9IGZ1bmN0aW9uIChlLCBuLCB0KSB7IH0sIGtlID0gZnVuY3Rpb24gKCkgeyB2YXIgZSA9IGkuZ2V0UXVlcnlQYXJhbUJ5TmFtZSh4KTsgZSAmJiBmLnN0YXJ0UmVkZWVtVm91Y2hlcih7IHZvdWNoZXJDb2RlOiBlIH0pOyB9LCBfZSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIFMgfHwgKFMgPSBuZXcgUHJvbWlzZSgoZnVuY3Rpb24gKGUpIHsgaWYgKG51bGwgIT09IGkuX19wcm90ZWN0ZWRfXy5nZXRMb2NhbFN0b3JhZ2VJdGVtKEkpICYmIGUoeyBoYXNfYWN0aXZlX2FwcGxlX3BheV9jYXJkOiBpLl9fcHJvdGVjdGVkX18uZ2V0TG9jYWxTdG9yYWdlSXRlbShJKSB9KSwgIXBuLmFwcGxlUGF5TWVyY2hhbnRJZClcbiAgICAgICAgcmV0dXJuIGUoeyBoYXNfYWN0aXZlX2FwcGxlX3BheV9jYXJkOiBudWxsIH0pLCBTOyBQZSgpLnRoZW4oKGZ1bmN0aW9uIChuKSB7IHZhciB0ID0gZnVuY3Rpb24gKG4pIHsgZSh7IGhhc19hY3RpdmVfYXBwbGVfcGF5X2NhcmQ6IG4gfSksIGkuX19wcm90ZWN0ZWRfXy5zZXRMb2NhbFN0b3JhZ2VJdGVtKEksIG4sIDcyMDApOyB9OyBuID8geS5fX3Byb3RlY3RlZF9fLmFwcGxlUGF5Q2FuTWFrZVBheW1lbnRzV2l0aEFjdGl2ZUNhcmQoKS50aGVuKHQpIDogdChudWxsKTsgfSkpOyB9KSksIFMpOyB9OyBmdW5jdGlvbiBDZSgpIHsgcmV0dXJuIGsuX19wcm90ZWN0ZWRfXy5pc0FjdGl2YXRlZCgpOyB9IHZhciBJZSA9IGZ1bmN0aW9uIChlLCBuLCB0KSB7IHJldHVybiBrLl9fcHJvdGVjdGVkX18uaW5qZWN0SWRzKCExLCBlLCBuLCB0KTsgfSwgU2UgPSBmdW5jdGlvbiAoKSB7IHJldHVybiBpLl9fcHJvdGVjdGVkX18ucmFuZG9tU3RyaW5nQ3hDb21wYXRpYmxlKCk7IH07IGZ1bmN0aW9uIHhlKGUpIHsgcmV0dXJuIGZ1bmN0aW9uIChuKSB7IHZhciB0ID0gbi5wYXJhbXM7IHZvaWQgMCA9PT0gTiAmJiAoTiA9IGZ1bmN0aW9uIChlKSB7IGlmICghQXJyYXkuaXNBcnJheShlKSB8fCAhZS5sZW5ndGgpXG4gICAgICAgIHJldHVybiAhMTsgZm9yICh2YXIgbiA9IDAsIHQgPSBlOyBuIDwgdC5sZW5ndGg7IG4rKykge1xuICAgICAgICB2YXIgciA9IHRbbl07XG4gICAgICAgIGlmIChMLmhhcyhyKSlcbiAgICAgICAgICAgIHJldHVybiAhMDtcbiAgICB9IHJldHVybiAhMTsgfSh0KSksIFUgPSB0IHx8IFtdLCBlKE4pOyB9OyB9IGZ1bmN0aW9uIFBlKCkgeyByZXR1cm4gdm9pZCAwICE9PSBOID8gUHJvbWlzZS5yZXNvbHZlKE4pIDogRiA/IChOID0gITEsIFByb21pc2UucmVzb2x2ZSghMSkpIDogbmV3IFByb21pc2UoKGZ1bmN0aW9uIChlKSB7IHYucmVnaXN0ZXJDYWxsYmFjayhcImV4cGVyaWVuY2VGbG93XCIsIChmdW5jdGlvbiAoKSB7IE4gPSAhMCwgZSghMCk7IH0pKSwgQy5zdWJzY3JpYmUoXCJBQ1RJVkVfUEFZTUVOVF9NRVRIT0RTX0lEU19JTklUSUFMSVpFRFwiLCB4ZShlKSksIEMuc3Vic2NyaWJlKFwiTVlfQUNDT1VOVF9BQ1RJVkVfUEFZTUVOVF9NRVRIT0RTX0lEU19JTklUSUFMSVpFRFwiLCB4ZShlKSk7IH0pKTsgfSByZXR1cm4geyBuYW1lOiBcIm1haW5cIiwgZmV0Y2hWaXNpdElkOiBhZSwgdHJhY2tQYWdlVW5sb2FkSWZOZWNlc3Nhcnk6IGRlLCBleHRlcm5hbFJlc291cmNlc0RlbGF5OiBfZSwgcGFnZVRyYWNrOiB5ZSwgdHJhY2tQYWdlOiBmdW5jdGlvbiAoZSwgbikgeyByZXR1cm4geWUoZSwgbik7IH0sIGJ1aWxkUGFnZVRyYWNrUGFyYW1zOiBaLCBmZXRjaFBhZ2VWaWV3SWQ6IHRlLCBmZXRjaEN4QnJvd3NlcklkOiByZSwgdHJhY2tQYWdlVW5sb2FkOiBwZSwgcmVnaXN0ZXJUcmFja1VubG9hZDogbWUsIGlzUmVnaXN0ZXJlZFRyYWNrVW5sb2FkOiBmdW5jdGlvbiAoKSB7IHJldHVybiBFOyB9LCB1bnJlZ2lzdGVyVHJhY2tVbmxvYWQ6IGdlLCByZXNldFRpbWVyOiBoZSwgcmVzZXRBZHM6IGZ1bmN0aW9uICgpIHsgcC5yZXNldEFkcygpOyB9LCB0cmFja0FkOiBmdW5jdGlvbiAoZSwgbiwgdCkgeyBBW2VdIHx8IChBW2VdID0ge30pLCBBW2VdW25dID0gdCwgQigpOyB9LCBpbml0OiBmdW5jdGlvbiAoKSB7IGlmIChwbi5haWQgJiYgMCAhPT0gcG4uYWlkLmxlbmd0aCkge1xuICAgICAgICAgICAgdmFyIGUsIG4sIHQ7XG4gICAgICAgICAgICBCID0gaS5kZWJvdW5jZShXLCAzZTMpLCBWID0geyBjdXJyZW50RG9tYWluOiBIKCksIGxhc3RUcmFja2VkVmlzaXRJZDogeigpLmlkLCB2aXNpdDoge30sIGNoZWNrRm9yUmVmcmVzaDogITEgfSwgcSA9IHsgaWQ6IEooKSwgcGFnZVNlc3Npb25JZDogXCJzLVwiICsgRygpLCB0cmFja0NvdW50OiAwLCB0cmFja2VkOiAhMSwgdHJhY2s6IGZ1bmN0aW9uICgpIHsgcS50cmFja2VkID8gcS5pZCA9IEooKSA6IHEudHJhY2tlZCA9ICEwLCBxLnRyYWNrQ291bnQrKzsgfSB9LCBDZSgpICYmIChlID0gcmUoKSwgbiA9IHRlKCksIHQgPSBwbi5jeGVuc2VTaXRlSWQsIGsuX19wcm90ZWN0ZWRfXy5pbmplY3RJZHMoITAsIGUsIG4sIHQpKSwgSygpLCBwbi5pc01vY2tNb2RlIHx8IChvLmlzRnVuY3Rpb24ocC5pbml0aWFsaXplKSAmJiBwLmluaXRpYWxpemUoKSwgby5pc0Z1bmN0aW9uKHUuaW5pdGlhbGl6ZSkgJiYgdS5pbml0aWFsaXplKCksIG8uaXNGdW5jdGlvbihkLmluaXRpYWxpemUpICYmIGQuaW5pdGlhbGl6ZSgpKSwgby5pc0Z1bmN0aW9uKGcuaW5pdGlhbGl6ZSkgJiYgZy5pbml0aWFsaXplKCksIFBlKCkudGhlbigoZnVuY3Rpb24gKGUpIHsgZSAmJiAoIWogJiYgby5pc0Z1bmN0aW9uKHkuaW5pdGlhbGl6ZSkgJiYgKGogPSAhMCwgeS5pbml0aWFsaXplKCkpLCBEIHx8IC0xICE9PSBVLmluZGV4T2YoUi5EQVRBVFJBTlNfQVBQTEVfUEFZKSAmJiBvLmlzRnVuY3Rpb24oYi5pbml0aWFsaXplKSAmJiAoRCA9ICEwLCBiLmluaXRpYWxpemUoKSkpOyB9KSksIG8uaXNGdW5jdGlvbih3Ll9fcHJvdGVjdGVkX18uaW5pdCkgJiYgc2V0VGltZW91dCgoZnVuY3Rpb24gKCkgeyB3Ll9fcHJvdGVjdGVkX18uaW5pdCgpLmNhdGNoKChmdW5jdGlvbiAoKSB7IH0pKTsgfSksIDVlMyksIG8uaXNGdW5jdGlvbihjLnJlZnJlc2hBY2Nlc3NUb2tlbikgJiYgYy5yZWZyZXNoQWNjZXNzVG9rZW4oKSwgX2UoKTtcbiAgICAgICAgICAgIHZhciByID0gYy5nZXRQcm92aWRlcigpO1xuICAgICAgICAgICAgciAmJiBvLmlzRnVuY3Rpb24oci5leHRlbmRVc2VyVG9rZW4pICYmIHIuZXh0ZW5kVXNlclRva2VuKCksIG8ub24od2luZG93LCBcImJlZm9yZXVubG9hZFwiLCAoZnVuY3Rpb24gKCkgeyByZXR1cm4gdmUoKTsgfSkpLCBvLm9uKHdpbmRvdywgXCJ1bmxvYWRcIiwgKGZ1bmN0aW9uICgpIHsgcmV0dXJuIHZlKCk7IH0pKSwgXy5hZGRDYXB0Y2hhVjMoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICBpLmxvZyhcIk11c3Qgc3VwcGx5IGEgdmFsaWQgdHAuYWlkIGJlZm9yZSBjYWxsaW5nIHRwLmluaXQoKVwiKTsgfSwgY2hlY2tUb1J1bldpZGdldEltbWVkaWF0ZWx5OiBmdW5jdGlvbiAoKSB7IHZhciBlOyBrZSgpLCAoZSA9IGkuZ2V0UXVlcnlQYXJhbUJ5TmFtZShcInZlcmlmaWNhdGlvbl9jb2RlXCIpKSAmJiBcInBpYW5vSWRcIiA9PT0gYy5nZXRQcm92aWRlcigpLm5hbWUgJiYgaS53YWl0Q2FsbChcIm9mZmVyQ3JlYXRlXCIsIChmdW5jdGlvbiAoKSB7IGguaXNVc2VyVmFsaWQoKSA/IGguX19wcm90ZWN0ZWRfXy5zaG93RW1haWxDb25maXJtYXRpb24oeyB2ZXJpZmljYXRpb25fY29kZTogZSB9KSA6IGguc2hvdyh7IHZlcmlmaWNhdGlvbl9jb2RlOiBlIH0pOyB9KSksIGguY2hlY2tBbmRTaG93RW1haWxJc05vdENvbmZpcm1lZCgpLCBvLmlzRnVuY3Rpb24oZi5jaGVja1RocmVlRFNSZWRpcmVjdCkgJiYgZi5jaGVja1RocmVlRFNSZWRpcmVjdCgpOyB9LCB0cmFja0FkczogYmUsIGFwcEhhc0FwcGxlUGF5OiBmdW5jdGlvbiAoKSB7IHJldHVybiBOOyB9LCBfX3ByaXZhdGVfXzogeyBWSVNJVF9JRF9DT09LSUU6IFAsIFZPVUNIRVJfUVVFUlk6IHgsIGNvbGxlY3RlZEFkczogQSwgdW5sb2FkUmVnaXN0ZXJlZDogRSwgdW5sb2FkVHJpZ2dlcmVkOiBULCBnZXRQYWdlVmlldzogZnVuY3Rpb24gKCkgeyByZXR1cm4gcTsgfSwgZ2V0VmlzaXRDb250YWluZXI6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIFY7IH0sIHRyYWNrOiB1ZSwgY2hlY2tWb3VjaGVyOiBrZSwgc2V0UGFnZVZpZXdJZDogd2UsIGN1cnJlbnRFbnZpcm9ubWVudFN1cHBvcnRzUGFnZVRyYWNrOiBsZSwgYnVpbGRQYWdlVW5sb2FkUGFyYW1zOiBlZSwgaW52YWxpZGF0ZUxhc3RWaXNpdDogZnVuY3Rpb24gKCkgeyB2YXIgZSA9IFEoKTsgdC5yZW1vdmUoUCwgZSk7IH0sIGdldEN1cnJlbnREb21haW46IEgsIGxvYWRMYXN0VmlzaXQ6IHosIHNldFZpc2l0Q3VycmVudERvbWFpbjogY2UsIHNhdmVWaXNpdENvb2tpZTogWCwgZ2V0VmlzaXRDb29raWVPcHRpb25zOiBRLCBpc1RpbWVFeHBpcmVkOiAkLCByZWZyZXNoVmlzaXQ6IEssIGdlbmVyYXRlUGFnZVZpZXdJZDogRywgdHJhY2tDb2xsZWN0ZWRBZHM6IFcsIHVubG9hZEhhbmRsZXI6IHZlLCB1bmxvYWRBY3Rpb246IGZlLCBidWlsZFBhZ2VDdXN0b21QYXJhbXM6IG5lLCBoYXNFeHRlcm5hbFJlZmVycmVyOiBZIH0gfTsgfTtcbiAgICBwbi5jb250YWluZXIucmVnaXN0ZXIoXCJtYWluXCIsIHsgdXNlVmFsdWU6IFBuKCkgfSksIHBuLm1haW4gPSBwbi5jb250YWluZXIucmVzb2x2ZShcIm1haW5cIik7XG4gICAgdmFyIEVuID0geyBwcmVkZWZpbmVWYWx1ZXM6IFtdIH07XG4gICAgd2luZG93LnRwICYmIHdpbmRvdy50cC5sZW5ndGggJiYgKEVuLnByZWRlZmluZVZhbHVlcyA9IF9lKFtdLCB3aW5kb3cudHAgfHwgW10sICEwKSksIHBuLnRwUHJlZGVmaW5lZE9wdGlvbnMgPSBFbiwgcG4uY29udGFpbmVyLnJlZ2lzdGVyKFwidHBQcmVkZWZpbmVkT3B0aW9uc1wiLCB7IHVzZVZhbHVlOiBFbiB9KTtcbiAgICB2YXIgVG4gPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGUoZSwgbiwgdCwgciwgbykgeyB0aGlzLnRwUHJlZGVmaW5lZE9wdGlvbnMgPSBlLCB0aGlzLmNzcyA9IG4sIHRoaXMudGlueXBhc3NFcnJvckhhbmRsZXIgPSB0LCB0aGlzLmdhU2VydmljZSA9IHIsIHRoaXMudXRpbFNlcnZpY2UgPSBvLCB0aGlzLmZ1bGxUUFZlcnNpb24gPSAhMSwgdGhpcy5pc0luaXRpYWxpemVkID0gITEsIHRoaXMuYWlkID0gXCJcIiwgdGhpcy5pc1NlbnNpdGl2ZURhdGFQcm90ZWN0aW9uRW5hYmxlZCA9ICExLCB0aGlzLmFmZmlsaWF0ZVRva2VuTmFtZSA9IFwiYWZmaWxpYXRlVG9rZW5cIiwgdGhpcy5jeENkblVybCA9IFwiaHR0cHM6Ly9jZG4uY3hlbnNlLmNvbVwiLCB0aGlzLmMxWExvYWRDY2UgPSAhMCwgdGhpcy5jMVhJbnRlZ3JhdGlvblZlcnNpb24gPSBcInYyXCIsIHRoaXMuY3hlbnNlTGliQXdhaXRpbmdUaW1lb3V0ID0gMCwgdGhpcy5jeGVuc2VMaWJBd2FpdGluZ1JldHJ5Q291bnQgPSAwLCB0aGlzLnRyYWNrUGFnZXMgPSAhMCwgdGhpcy5kZWJ1ZyA9ICExLCB0aGlzLnVzZXJSZWYgPSBcIlwiLCB0aGlzLnVzZVBpYW5vSWRMaXRlVXNlclByb3ZpZGVyID0gITEsIHRoaXMudXNlVGlueXBhc3NBY2NvdW50cyA9ICExLCB0aGlzLnVzZUNvbmRlVXNlclByb3ZpZGVyID0gITEsIHRoaXMudXNlR2lneWFVc2VyUHJvdmlkZXIgPSAhMSwgdGhpcy51c2VQaWFub0lkVXNlclByb3ZpZGVyID0gITEsIHRoaXMudXNlQWlkU3BlY2lmaWVkQ29va2llcyA9ICExLCB0aGlzLnNhbmRib3ggPSAhMSwgdGhpcy56SW5kZXhlcyA9IHsgYmFja2Ryb3A6IDNlNSwgbW9kYWw6IDMwMDA1MCwgY2xvc2U6IDMwMDEwMCB9LCB0aGlzLmN1c3RvbVByZUNoZWNrcyA9IFtdLCB0aGlzLmN1c3RvbVBhcmFtcyA9IHt9LCB0aGlzLmV4dGVybmFsTGlicmFyaWVzID0gW10sIHRoaXMuZXh0ZXJuYWxMaWJyYXJpZXNDYWxsYmFja3MgPSBbXSwgdGhpcy5jdXN0b21WYXJpYWJsZXMgPSB7fSwgdGhpcy5sb2NhbGUgPSBcIlwiLCB0aGlzLnRyYWNrUGFnZVZpZXcgPSAhMCwgdGhpcy5yZWRpcmVjdFRvRmJUaW1lb3V0ID0gMywgdGhpcy5pc0RvdWJsZU9wdEluQ2hlY2tPbkFjY2Vzc0NoZWNrRW5hYmxlZCA9ICExLCB0aGlzLmlzTW9ja01vZGUgPSAhMSwgdGhpcy5pbmFwcEJyb3dzZXJSZXR1cm4gPSAhMSwgdGhpcy5ldmVudHMgPSBbXSwgdGhpcy5hcHBMaXN0ID0gW10sIHRoaXMuY2FjaGVhYmxlU2hvd1RlbXBsYXRlID0gITAsIHRoaXMuaW5pdENhbGxiYWNrcyA9IFtdLCB0aGlzLm1haW5Nb2R1bGVJbml0ZWQgPSAhMSwgdGhpcy5yZXN0Q2FsbGJhY2tzID0gW10sIHRoaXMuaW5pdFRyaWVzID0gMCwgdGhpcy5jYWxsYmFja3MgPSBbXSwgbi5sb2FkT2ZmZXJDc3MoKTsgfSByZXR1cm4gZS5wcm90b3R5cGUuaW5pdFRwID0gZnVuY3Rpb24gKCkgeyB2YXIgZSA9IHRoaXM7IHRyeSB7XG4gICAgICAgIHZhciBuID0gdGhpcy50cFByZWRlZmluZWRPcHRpb25zLnByZWRlZmluZVZhbHVlcztcbiAgICAgICAgaWYgKHRoaXMudHBQcmVkZWZpbmVkT3B0aW9ucy5wcmVkZWZpbmVWYWx1ZXMgPSBbXSwgbi5mb3JFYWNoKChmdW5jdGlvbiAobikgeyBcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIG5bMV0gPyBcImluaXRcIiA9PT0gblswXSA/IGUuaW5pdENhbGxiYWNrcy5wdXNoKG5bMV0pIDogZS5yZXN0Q2FsbGJhY2tzLnB1c2gobikgOiBcImluaXRcIiA9PT0gblsxXSAmJiBcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIG5bMl0gPyBlLmluaXRDYWxsYmFja3MucHVzaChuWzJdKSA6IGUucHVzaChuKTsgfSkpLCAhdGhpcy5haWQgJiYgdGhpcy5pbml0VHJpZXMgPCAxMClcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmluaXRUcmllcysrLCB2b2lkIHNldFRpbWVvdXQoKGZ1bmN0aW9uICgpIHsgcmV0dXJuIGUuaW5pdFRwKCk7IH0pLCA1MCk7XG4gICAgICAgIGlmICghdGhpcy5haWQpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGZvciAodGhpcy50aW55cGFzc0Vycm9ySGFuZGxlci5pbml0aWFsaXplKCk7IHRoaXMucmVzdENhbGxiYWNrcy5sZW5ndGg7KVxuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICB2YXIgdCA9IHRoaXMucmVzdENhbGxiYWNrcy5zaGlmdCgpO1xuICAgICAgICAgICAgICAgIHRoaXMucHVzaCh0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlKSwgcG4udGlueXBhc3NFcnJvckhhbmRsZXIuYWRkRXJyb3IoZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIHRoaXMuX2luaXQoKSwgdGhpcy5leHRlcm5hbExpYnJhcmllcy5sZW5ndGggJiYgdGhpcy5yZWFsaXplRXh0ZXJuYWxMaWJyYXJpZXMoKSwgdGhpcy5pc0luaXRpYWxpemVkID0gITAsIHdpbmRvdy5fX190cCA9IGZ1bmN0aW9uICgpIHsgfTtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgcG4udGlueXBhc3NFcnJvckhhbmRsZXIuYWRkRXJyb3IoZSwgXCJpbml0VFBcIik7XG4gICAgfSB9LCBlLnByb3RvdHlwZS5yZWFsaXplRXh0ZXJuYWxMaWJyYXJpZXMgPSBmdW5jdGlvbiAoKSB7IHZhciBlID0gdGhpcywgbiA9IFtdOyB0aGlzLmV4dGVybmFsTGlicmFyaWVzLmZvckVhY2goKGZ1bmN0aW9uICh0KSB7IHZhciByID0gZS5yZXF1aXJlSnNGaWxlKHQpOyBuLnB1c2gocik7IH0pKSwgUHJvbWlzZS5hbGwobikudGhlbigoZnVuY3Rpb24gKCkgeyBpZiAoZS5leHRlcm5hbExpYnJhcmllcyA9IFtdLCBlLmV4dGVybmFsTGlicmFyaWVzQ2FsbGJhY2tzKVxuICAgICAgICBmb3IgKHZhciBuID0gMDsgbiA8IGUuZXh0ZXJuYWxMaWJyYXJpZXNDYWxsYmFja3MubGVuZ3RoOyArK24pXG4gICAgICAgICAgICBNbi5leHRlcm5hbExpYnJhcmllc0NhbGxiYWNrc1tuXSgpOyBNbi5leHRlcm5hbExpYnJhcmllc0NhbGxiYWNrcyA9IFtdOyB9KSk7IH0sIGUucHJvdG90eXBlLnB1c2ggPSBmdW5jdGlvbiAoKSB7IGZvciAodmFyIGUsIG4sIHQsIHIgPSBbXSwgbyA9IDA7IG8gPCBhcmd1bWVudHMubGVuZ3RoOyBvKyspXG4gICAgICAgIHJbb10gPSBhcmd1bWVudHNbb107IGZvciAoZSA9IDA7IGUgPCByLmxlbmd0aDsgZSsrKVxuICAgICAgICBpZiAoXCJzdHJpbmdcIiA9PSB0eXBlb2YgKG4gPSAodCA9IHJbZV0pLnNoaWZ0KCkpIHx8IG4gaW5zdGFuY2VvZiBTdHJpbmcpIHtcbiAgICAgICAgICAgIGlmICghdGhpc1tuXSlcbiAgICAgICAgICAgICAgICByZXR1cm4gdm9pZCBjb25zb2xlLmVycm9yKFwiVW5kZWZpbmVkIG1ldGhvZCBcIiArIG4pO1xuICAgICAgICAgICAgdGhpc1tuXS5hcHBseSh0aGlzLCB0KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICBuLmFwcGx5KHRoaXMsIHQpOyB9LCBlLnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24gKGUpIHsgdGhpcy5pc0luaXRpYWxpemVkID8gKHRoaXMubWFpbk1vZHVsZUluaXRlZCB8fCAodGhpcy5tYWluTW9kdWxlSW5pdGVkID0gITAsIHRoaXMuaW5pdE1haW5Nb2R1bGVBZnRlckluaXRDYmsoKSksIGUgJiYgZSgpKSA6IChlICYmIHRoaXMudHBQcmVkZWZpbmVkT3B0aW9ucy5wcmVkZWZpbmVWYWx1ZXMucHVzaChbXCJpbml0XCIsIGVdKSwgdGhpcy5pbml0VHAoKSk7IH0sIGUucHJvdG90eXBlLl9pbml0ID0gZnVuY3Rpb24gKCkgeyBpZiAocG4udXRpbCAmJiBwbi51dGlsLmhhc1F1ZXJ5UGFyYW1CeU5hbWUgJiYgcG4udXRpbC5oYXNRdWVyeVBhcmFtQnlOYW1lKFwieHBkZWJ1Z1wiKSAmJiBwbi5zZXREZWJ1ZyghMCksIHBuLnV0aWwuc2V0VHBjY0Nvb2tpZXMoKSwgcG4udXRpbC5pc1NhZmFyaU9ySU9zVWlXZWJWaWV3KCkgJiYgIXBuLnVzZXIuaXNVc2VyVmFsaWQoKSAmJiBwbi51dGlsLmdldFF1ZXJ5UGFyYW1CeU5hbWUoXCJ1c2VyVG9rZW5cIikpIHtcbiAgICAgICAgdmFyIGUgPSBwbi51dGlsLmdldFF1ZXJ5UGFyYW1CeU5hbWUoXCJjb29raWVEb21haW5cIiksIG4gPSBwbi51dGlsLmdldFF1ZXJ5UGFyYW1CeU5hbWUoXCJ1c2VyVG9rZW5cIiksIHQgPSBwbi51dGlsLmdldFF1ZXJ5UGFyYW1CeU5hbWUoXCJ0b2tlbkxpc3RWYWx1ZVwiKTtcbiAgICAgICAgcG4udXRpbC5zZXRBY2Nlc3NUb2tlbkxpc3RDb29raWUoeyBjb29raWVfZG9tYWluOiBlLCB2YWx1ZTogdCB9LCBuKSwgcG4udXRpbC5yZW1vdmVRdWVyeVBhcmFtQnlOYW1lKFwidXNlclRva2VuXCIpLCBwbi51dGlsLnJlbW92ZVF1ZXJ5UGFyYW1CeU5hbWUoXCJjb29raWVEb21haW5cIiksIHBuLnV0aWwucmVtb3ZlUXVlcnlQYXJhbUJ5TmFtZShcInRva2VuTGlzdFZhbHVlXCIpO1xuICAgIH0gaWYgKHRoaXMubWFpbk1vZHVsZUluaXRlZCB8fCAodGhpcy5tYWluTW9kdWxlSW5pdGVkID0gITAsIHRoaXMuaW5pdE1haW5Nb2R1bGVBZnRlckluaXRDYmsoKSksICF0aGlzLmFpZCkge1xuICAgICAgICB2YXIgciA9IG5ldyBFcnJvcihcIkluY29ycmVjdCBhaWQgaW50ZWdyYXRpb246IFwiICsgTW4uYWlkICsgXCIgdXJsOiBcIiArIHdpbmRvdy5sb2NhdGlvbi5ocmVmKTtcbiAgICAgICAgdGhpcy50aW55cGFzc0Vycm9ySGFuZGxlci5hZGRFcnJvcihyKTtcbiAgICB9IHBuLmxvZ2dpbmcuc2V0VGltZShcImNvbXBsZXRlSW5pdFwiKTsgfSwgZS5wcm90b3R5cGUuaW5pdE1haW5Nb2R1bGVBZnRlckluaXRDYmsgPSBmdW5jdGlvbiAoKSB7IGZvciAocG4udXNlci5wcm92aWRlckluaXQoKSwgdGhpcy5hcHBMaXN0LmluZGV4T2YodGhpcy5haWQpIDwgMCAmJiAodGhpcy5hcHBMaXN0LnB1c2godGhpcy5haWQpLCBwbi5tYWluLmluaXQoKSk7IHRoaXMuaW5pdENhbGxiYWNrcy5sZW5ndGg7KVxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgdGhpcy5pbml0Q2FsbGJhY2tzLnNoaWZ0KCkoKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihlKSwgcG4udGlueXBhc3NFcnJvckhhbmRsZXIuYWRkRXJyb3IoZSk7XG4gICAgICAgIH0gaWYgKHBuLm1haW4uY2hlY2tUb1J1bldpZGdldEltbWVkaWF0ZWx5KCksIHRoaXMuZXZlbnRzKSB7XG4gICAgICAgIGZvciAodmFyIGUgPSAwOyBlIDwgdGhpcy5ldmVudHMubGVuZ3RoOyBlKyspXG4gICAgICAgICAgICB0aGlzLmV2ZW50c1tlXSgpO1xuICAgICAgICB0aGlzLmV2ZW50cyA9IFtdO1xuICAgIH0gfSwgZS5wcm90b3R5cGUucmVxdWlyZUpzRmlsZSA9IGZ1bmN0aW9uIChlKSB7IHJldHVybiBuZXcgUHJvbWlzZSgoZnVuY3Rpb24gKG4sIHQpIHsgdmFyIHIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic2NyaXB0XCIpOyByLm9ubG9hZCA9IG4sIHIub25lcnJvciA9IG4sIHIudHlwZSA9IFwidGV4dC9qYXZhc2NyaXB0XCIsIHIuY2hhcnNldCA9IFwidXRmLThcIiwgci5hc3luYyA9ICEwLCByLnNyYyA9IGUsIGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiaGVhZFwiKVswXS5hcHBlbmRDaGlsZChyKTsgfSkpOyB9LCBlLnByb3RvdHlwZS5zZXRBaWQgPSBmdW5jdGlvbiAoZSkgeyB0aGlzLmFpZCA9IGU7IH0sIGUucHJvdG90eXBlLmVuYWJsZVNlbnNpdGl2ZURhdGFQcm90ZWN0aW9uID0gZnVuY3Rpb24gKGUpIHsgdGhpcy5pc1NlbnNpdGl2ZURhdGFQcm90ZWN0aW9uRW5hYmxlZCA9IGU7IH0sIGUucHJvdG90eXBlLnJlbG9hZCA9IGZ1bmN0aW9uICgpIHsgbG9jYXRpb24uaHJlZiA9IHBuLnV0aWwucmVtb3ZlVm91Y2hlckNvZGVGcm9tVXJsKGxvY2F0aW9uLmhyZWYpOyB9LCBlLnByb3RvdHlwZS5yZW1vdmVTaGFyZWRBY2NvdW50Q29kZUZyb21VcmwgPSBmdW5jdGlvbiAoKSB7IGxvY2F0aW9uLmhyZWYgPSBwbi51dGlsLnJlbW92ZVNoYXJlZEFjY291bnRDb2RlRnJvbVVybChsb2NhdGlvbi5ocmVmKTsgfSwgZS5wcm90b3R5cGUuc2V0R0FDbGllbnRJZCA9IGZ1bmN0aW9uIChlKSB7IHRoaXMuZ2FDbGllbnRJZCA9IGUsIHRoaXMuZ2FTZXJ2aWNlLnJlY3JlYXRlV2l0aENsaWVudElkKGUpOyB9LCBlLnByb3RvdHlwZS5nZXRHQUNsaWVudElkID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5nYUNsaWVudElkOyB9LCBlLnByb3RvdHlwZS5lbmFibGVHQUNyb3NzRG9tYWluTGlua2luZyA9IGZ1bmN0aW9uIChlKSB7IHZhciBuID0gdGhpczsgdGhpcy5nYUNyb3NzRG9tYWluTGlua2luZyA9ICEwOyB2YXIgdCA9IERhdGUubm93KCksIHIgPSBmdW5jdGlvbiAoKSB7IHZhciBvID0gd2luZG93LmdhOyBpZiAobyAmJiBcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIG8pXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBvKChmdW5jdGlvbiAodCkgeyBpZiAodm9pZCAwICE9PSB0ICYmIHZvaWQgMCA9PT0gZSlcbiAgICAgICAgICAgICAgICBuLnNldEdBQ2xpZW50SWQodC5nZXQoXCJjbGllbnRJZFwiKSk7XG4gICAgICAgICAgICBlbHNlIGlmICh2b2lkIDAgIT09IGUpXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgciA9IG8uZ2V0QWxsKCksIGkgPSAwOyBpIDwgci5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgYSA9IHJbaV07XG4gICAgICAgICAgICAgICAgICAgIGlmIChhLmdldChcInRyYWNraW5nSWRcIikgPT09IGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG4uc2V0R0FDbGllbnRJZChhLmdldChcImNsaWVudElkXCIpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSB9KSk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHsgfVxuICAgIGVsc2VcbiAgICAgICAgRGF0ZS5ub3coKSAtIHQgPCA2ZTQgJiYgc2V0VGltZW91dChyLCA1MDApOyB9OyByKCk7IH0sIGUucHJvdG90eXBlLnNldFRhZ3MgPSBmdW5jdGlvbiAoZSkgeyB0aGlzLnRhZ3MgPSBlIGluc3RhbmNlb2YgQXJyYXkgPyBlLmpvaW4oXCIsXCIpIDogZTsgfSwgZS5wcm90b3R5cGUuc2V0Q29va2llRG9tYWluID0gZnVuY3Rpb24gKGUpIHsgXCIuXCIgIT09IGVbMF0gJiYgKGUgPSBcIi5cIiArIGUpLCB0aGlzLmNvb2tpZURvbWFpbiA9IGU7IH0sIGUucHJvdG90eXBlLnNldENvb2tpZVBhdGggPSBmdW5jdGlvbiAoZSkgeyB0aGlzLmNvb2tpZVBhdGggPSBlOyB9LCBlLnByb3RvdHlwZS5zZXREb250U2Nyb2xsVG9wTW9kYWwgPSBmdW5jdGlvbiAoZSkgeyB0aGlzLmRvbnRTY3JvbGxUb3BNb2RhbCA9IGU7IH0sIGUucHJvdG90eXBlLnNldFVzZUV4cGVyaWVuY2UgPSBmdW5jdGlvbiAoZSkgeyB0aGlzLnVzZUV4cGVyaWVuY2UgPSBlOyB9LCBlLnByb3RvdHlwZS5zZXRFeHBlcmltZW50YWxJb3NNb2RhbCA9IGZ1bmN0aW9uIChlKSB7IHRoaXMuZXhwZXJpbWVudGFsSW9zTW9kYWwgPSBlOyB9LCBlLnByb3RvdHlwZS5zZXRBcHBsZVBheU1lcmNoYW50SWQgPSBmdW5jdGlvbiAoZSkgeyB0aGlzLmFwcGxlUGF5TWVyY2hhbnRJZCA9IGU7IH0sIGUucHJvdG90eXBlLnNldENvbnRlbnRJc05hdGl2ZSA9IGZ1bmN0aW9uIChlKSB7IHRoaXMuY29udGVudElzTmF0aXZlID0gZTsgfSwgZS5wcm90b3R5cGUuc2V0Q29tcG9zZXJIb3N0ID0gZnVuY3Rpb24gKGUpIHsgdGhpcy5jb21wb3Nlckhvc3QgPSBlOyB9LCBlLnByb3RvdHlwZS5zZXRFbmRwb2ludCA9IGZ1bmN0aW9uIChlKSB7IHRoaXMuZW5kcG9pbnQgPSBlOyB9LCBlLnByb3RvdHlwZS5zZXRBZmZpbGlhdGVUb2tlbk5hbWUgPSBmdW5jdGlvbiAoZSkgeyB0aGlzLmFmZmlsaWF0ZVRva2VuTmFtZSA9IGU7IH0sIGUucHJvdG90eXBlLnNldEVzcEVuZHBvaW50ID0gZnVuY3Rpb24gKGUpIHsgdGhpcy5lc3BFbmRwb2ludCA9IGU7IH0sIGUucHJvdG90eXBlLnNldEN4Q2RuVXJsID0gZnVuY3Rpb24gKGUpIHsgdGhpcy5jeENkblVybCA9IGU7IH0sIGUucHJvdG90eXBlLnNldEMxWExvYWRDY2UgPSBmdW5jdGlvbiAoZSkgeyB0aGlzLmMxWExvYWRDY2UgPSBlOyB9LCBlLnByb3RvdHlwZS5zZXRDMVhJbnRlZ3JhdGlvblZlcnNpb24gPSBmdW5jdGlvbiAoZSkgeyB0aGlzLmMxWEludGVncmF0aW9uVmVyc2lvbiA9IGU7IH0sIGUucHJvdG90eXBlLnNldEN4ZW5zZVNpdGVJZCA9IGZ1bmN0aW9uIChlKSB7IHRoaXMuY3hlbnNlU2l0ZUlkID0gZTsgfSwgZS5wcm90b3R5cGUuc2V0Q3hlbnNlTGliQXdhaXRpbmdUaW1lb3V0ID0gZnVuY3Rpb24gKGUpIHsgdGhpcy5jeGVuc2VMaWJBd2FpdGluZ1RpbWVvdXQgPSBlOyB9LCBlLnByb3RvdHlwZS5zZXRDeGVuc2VMaWJBd2FpdGluZ1JldHJ5Q291bnQgPSBmdW5jdGlvbiAoZSkgeyB0aGlzLmN4ZW5zZUxpYkF3YWl0aW5nUmV0cnlDb3VudCA9IGU7IH0sIGUucHJvdG90eXBlLnNldENvbnRlbnRJZCA9IGZ1bmN0aW9uIChlKSB7IHRoaXMuY29udGVudElkID0gZTsgfSwgZS5wcm90b3R5cGUuc2V0VHJhY2tQYWdlcyA9IGZ1bmN0aW9uIChlKSB7IHRoaXMudHJhY2tQYWdlcyA9IGU7IH0sIGUucHJvdG90eXBlLnNldERlYnVnID0gZnVuY3Rpb24gKGUpIHsgdGhpcy5kZWJ1ZyA9IGU7IH0sIGUucHJvdG90eXBlLnNldFVzZXJSZWYgPSBmdW5jdGlvbiAoZSkgeyB0aGlzLnVzZXJSZWYgPSBlOyB9LCBlLnByb3RvdHlwZS5zZXRVc2VQaWFub0lkTGl0ZVVzZXJQcm92aWRlciA9IGZ1bmN0aW9uIChlKSB7IHRoaXMudXNlUGlhbm9JZExpdGVVc2VyUHJvdmlkZXIgPSBlOyB9LCBlLnByb3RvdHlwZS5zZXRFeHRlcm5hbEpXVCA9IGZ1bmN0aW9uIChlKSB7IHRoaXMuZXh0ZXJuYWxKV1QgPSBlOyB9LCBlLnByb3RvdHlwZS5nZXRFeHRlcm5hbEpXVCA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuZXh0ZXJuYWxKV1Q7IH0sIGUucHJvdG90eXBlLnNldFVzZVRpbnlwYXNzQWNjb3VudHMgPSBmdW5jdGlvbiAoZSkgeyB0aGlzLnVzZVRpbnlwYXNzQWNjb3VudHMgPSBlOyB9LCBlLnByb3RvdHlwZS5zZXRVc2VDb25kZVVzZXJQcm92aWRlciA9IGZ1bmN0aW9uIChlKSB7IHRoaXMudXNlQ29uZGVVc2VyUHJvdmlkZXIgPSBlOyB9LCBlLnByb3RvdHlwZS5zZXRVc2VHaWd5YVVzZXJQcm92aWRlciA9IGZ1bmN0aW9uIChlKSB7IHRoaXMudXNlR2lneWFVc2VyUHJvdmlkZXIgPSBlOyB9LCBlLnByb3RvdHlwZS5zZXRVc2VQaWFub0lkVXNlclByb3ZpZGVyID0gZnVuY3Rpb24gKGUpIHsgdGhpcy51c2VQaWFub0lkVXNlclByb3ZpZGVyID0gZTsgfSwgZS5wcm90b3R5cGUuc2V0UGlhbm9JZFVybCA9IGZ1bmN0aW9uIChlKSB7IHRoaXMucGlhbm9JZFVybCA9IGU7IH0sIGUucHJvdG90eXBlLnNldEl0ZW1JZCA9IGZ1bmN0aW9uIChlKSB7IHRoaXMuaXRlbUlkID0gZTsgfSwgZS5wcm90b3R5cGUuc2V0VXNlQWlkU3BlY2lmaWVkQ29va2llcyA9IGZ1bmN0aW9uIChlKSB7IHRoaXMudXNlQWlkU3BlY2lmaWVkQ29va2llcyA9IGU7IH0sIGUucHJvdG90eXBlLnNldFNhbmRib3ggPSBmdW5jdGlvbiAoZSkgeyB0aGlzLnNhbmRib3ggPSBlOyB9LCBlLnByb3RvdHlwZS5zZXRDb250ZW50Q3JlYXRlZFNlbGVjdG9yID0gZnVuY3Rpb24gKGUpIHsgdGhpcy5jb250ZW50Q3JlYXRlZFNlbGVjdG9yID0gZTsgfSwgZS5wcm90b3R5cGUuc2V0Q29udGVudENyZWF0ZWQgPSBmdW5jdGlvbiAoZSkgeyB0aGlzLmNvbnRlbnRDcmVhdGVkID0gZTsgfSwgZS5wcm90b3R5cGUuc2V0Q29udGVudEF1dGhvciA9IGZ1bmN0aW9uIChlKSB7IHRoaXMuY29udGVudEF1dGhvciA9IGU7IH0sIGUucHJvdG90eXBlLnNldENvbnRlbnRTZWN0aW9uID0gZnVuY3Rpb24gKGUpIHsgdGhpcy5jb250ZW50U2VjdGlvbiA9IGU7IH0sIGUucHJvdG90eXBlLnNldFpvbmUgPSBmdW5jdGlvbiAoZSkgeyB0aGlzLnpvbmUgPSBlIHx8IFwiXCI7IH0sIGUucHJvdG90eXBlLmlzTm9uUHJvZEVuZHBvaW50ID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gXCJzYW5kYm94XCIgPT09IHRoaXMuZW5kcG9pbnQgfHwgL15odHRwcz86XFwvXFwvKC4qc2FuZGJveC4qfFxcZCtcXC5kZXYpXFwuKHRpbnlwYXNzXFwuY29tfHBpYW5vXFwuaW8pL2kudGVzdCh0aGlzLmVuZHBvaW50KTsgfSwgZS5wcm90b3R5cGUuc2V0WkluZGV4ZXMgPSBmdW5jdGlvbiAoZSkgeyB0aGlzLnpJbmRleGVzID0gZTsgfSwgZS5wcm90b3R5cGUuc2V0Q3VzdG9tUHJlQ2hlY2sgPSBmdW5jdGlvbiAoZSkgeyB0aGlzLmN1c3RvbVByZUNoZWNrcy5wdXNoKGUpOyB9LCBlLnByb3RvdHlwZS5zZXRDdXN0b21QYXJhbSA9IGZ1bmN0aW9uIChlLCBuLCB0LCByKSB7IHZhciBvID0gW1wiY29udGVudFwiLCBcInVzZXJcIiwgXCJyZXF1ZXN0XCJdOyBpZiAodCB8fCAodCA9IFwiY29udGVudFwiKSwgdCA9IHQudG9Mb3dlckNhc2UoKSwgby5pbmRleE9mKHQpIDwgMClcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVW5kZWZpbmVkIHNjb3BlIFwiICsgdCArIFwiXFxuQXZhaWxhYmxlIHNjb3BlczogXCIgKyBvLmpvaW4oXCIsIFwiKSk7IHZvaWQgMCA9PT0gdGhpcy5jdXN0b21QYXJhbXNbdF0gJiYgKHRoaXMuY3VzdG9tUGFyYW1zW3RdID0ge30pLCAodm9pZCAwID09PSB0aGlzLmN1c3RvbVBhcmFtc1t0XVtlXSB8fCByKSAmJiAodGhpcy5jdXN0b21QYXJhbXNbdF1bZV0gPSBbXSk7IGZvciAodmFyIGkgPSBbXS5jb25jYXQobiksIGEgPSAwOyBhIDwgaS5sZW5ndGg7IGErKykge1xuICAgICAgICBpZiAoXCJzdHJpbmdcIiAhPSB0eXBlb2YgaVthXSlcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcInNldEN1c3RvbVBhcmFtIGFjY2VwdCBvbmx5IHN0cmluZyB2YWx1ZXMgb3IgYXJyYXkgb2Ygc3RyaW5nc1wiKTtcbiAgICAgICAgdGhpcy5jdXN0b21QYXJhbXNbdF1bZV0ucHVzaChpW2FdKTtcbiAgICB9IH0sIGUucHJvdG90eXBlLnJlc2V0Q3VzdG9tUGFyYW0gPSBmdW5jdGlvbiAoZSkgeyBlIHx8IChlID0gXCJjb250ZW50XCIpLCBkZWxldGUgdGhpcy5jdXN0b21QYXJhbXNbZV07IH0sIGUucHJvdG90eXBlLmFkZEV4dGVybmFsTGlicmFyeSA9IGZ1bmN0aW9uIChlLCBuKSB7IGlmIChcInN0cmluZ1wiID09IHR5cGVvZiBlKVxuICAgICAgICB0aGlzLmV4dGVybmFsTGlicmFyaWVzLnB1c2goZSk7XG4gICAgZWxzZVxuICAgICAgICBmb3IgKHZhciB0ID0gMDsgdCA8IGUubGVuZ3RoOyArK3QpXG4gICAgICAgICAgICB0aGlzLmV4dGVybmFsTGlicmFyaWVzLnB1c2goZVt0XSk7IG4gJiYgdGhpcy5leHRlcm5hbExpYnJhcmllc0NhbGxiYWNrcy5wdXNoKG4pLCB0aGlzLmlzSW5pdGlhbGl6ZWQgJiYgdGhpcy5yZWFsaXplRXh0ZXJuYWxMaWJyYXJpZXMoKTsgfSwgZS5wcm90b3R5cGUuc2V0Q3VzdG9tVmFyaWFibGUgPSBmdW5jdGlvbiAoZSwgbikgeyB0aGlzLmN1c3RvbVZhcmlhYmxlc1tlXSA9IG47IH0sIGUucHJvdG90eXBlLnNhdmVDdXN0b21WYXJpYWJsZXNUb0xvY2FsU3RvcmFnZSA9IGZ1bmN0aW9uIChlKSB7IGlmICh0aGlzLmN1c3RvbVZhcmlhYmxlcyAmJiBcImxvY2FsU3RvcmFnZVwiIGluIHdpbmRvdyAmJiBudWxsICE9PSB3aW5kb3cubG9jYWxTdG9yYWdlKSB7XG4gICAgICAgIHZhciBuID0gXCJfX3RwLWN1c3RvbVZhcmlhYmxlc1wiO1xuICAgICAgICB3aW5kb3cubG9jYWxTdG9yYWdlLnNldEl0ZW0obiwgSlNPTi5zdHJpbmdpZnkodGhpcy5jdXN0b21WYXJpYWJsZXMpKSwgZSAmJiB3aW5kb3cubG9jYWxTdG9yYWdlLnNldEl0ZW0obiArIFwiLWV4cGlyYXRpb25cIiwgTWF0aC5mbG9vcigobmV3IERhdGUpLmdldFRpbWUoKSAvIDFlMykgKyBlICsgXCJcIik7XG4gICAgfSB9LCBlLnByb3RvdHlwZS5yZXN0b3JlQ3VzdG9tVmFyaWJhbGVzRnJvbUxvY2Fsc3RvcmFnZSA9IGZ1bmN0aW9uICgpIHsgaWYgKFwibG9jYWxTdG9yYWdlXCIgaW4gd2luZG93ICYmIG51bGwgIT09IHdpbmRvdy5sb2NhbFN0b3JhZ2UpIHtcbiAgICAgICAgdmFyIGUgPSBNbi51dGlsLl9fcHJvdGVjdGVkX18uZ2V0TG9jYWxTdG9yYWdlSXRlbShcImN1c3RvbVZhcmlhYmxlc1wiKTtcbiAgICAgICAgaWYgKE1uLnV0aWwuX19wcm90ZWN0ZWRfXy5yZW1vdmVMb2NhbFN0b3JhZ2VJdGVtKFwiY3VzdG9tVmFyaWFibGVzXCIpLCBlKVxuICAgICAgICAgICAgZm9yICh2YXIgbiBpbiBlKVxuICAgICAgICAgICAgICAgIHRoaXMuY3VzdG9tVmFyaWFibGVzW25dID0gZVtuXTtcbiAgICB9IH0sIGUucHJvdG90eXBlLmhhbmRsZXIgPSBmdW5jdGlvbiAoZSwgbikgeyB2YXIgdCA9IHRoaXMucmVnaXN0ZXJQcmVmaXhlZEV2ZW50czsgcmV0dXJuIGZ1bmN0aW9uICgpIHsgZm9yICh2YXIgciwgbyA9IFtwbi5vZmZlciwgcG4udGVtcGxhdGUsIHBuLm1ldGVyLCBwbi5leHBlcmllbmNlLCBwbi5teWFjY291bnQsIHBuLnBpYW5vSWQsIHBuLnRpbnlwYXNzTG9naW4sIHBuLnN3ZywgcG4udXNlciwgcG4uY3JlZGl0XSwgaSA9IDA7IGkgPCBvLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHZhciBhID0gb1tpXTtcbiAgICAgICAgaWYgKGEpIHtcbiAgICAgICAgICAgIHZhciBzID0gYS5yZWdpc3RlckNhbGxiYWNrKGUsIG4pO1xuICAgICAgICAgICAgdm9pZCAwICE9PSBzICYmIChyID0gcyksIHZvaWQgMCAhPT0gKHMgPSB0KGEsIGUsIG4pKSAmJiAociA9IHMpO1xuICAgICAgICB9XG4gICAgfSByZXR1cm4gcjsgfTsgfSwgZS5wcm90b3R5cGUucmVnaXN0ZXJQcmVmaXhlZEV2ZW50cyA9IGZ1bmN0aW9uIChlLCBuLCB0KSB7IGZvciAodmFyIHIsIG8sIGksIGEgPSBbeyBtb2R1bGU6IFwib2ZmZXJcIiwgcHJlZml4OiBcImNoZWNrb3V0XCIgfSwgeyBtb2R1bGU6IFwicGlhbm9JZFwiLCBwcmVmaXg6IFwicGlhbm9JZFwiIH1dLCBzID0gMDsgcyA8IGEubGVuZ3RoOyBzKyspIHtcbiAgICAgICAgdmFyIGMgPSBhW3NdO1xuICAgICAgICBlLm5hbWUgPT09IGMubW9kdWxlICYmIG4uc3Vic3RyaW5nKDAsIGMucHJlZml4Lmxlbmd0aCkgPT09IGMucHJlZml4ICYmIChyID0gbi5zdWJzdHJpbmcoYy5wcmVmaXgubGVuZ3RoLCBjLnByZWZpeC5sZW5ndGggKyAxKS50b0xvd2VyQ2FzZSgpICsgbi5zdWJzdHJpbmcoYy5wcmVmaXgubGVuZ3RoICsgMSwgbi5sZW5ndGgpLCB2b2lkIDAgIT09IChvID0gZS5yZWdpc3RlckNhbGxiYWNrKHIsIHQpKSAmJiAoaSA9IG8pKTtcbiAgICB9IHJldHVybiBpOyB9LCBlLnByb3RvdHlwZS5hZGRIYW5kbGVyID0gZnVuY3Rpb24gKGUsIG4pIHsgdmFyIHQgPSB0aGlzLmhhbmRsZXIoZSwgbik7IHRoaXMuaXNJbml0aWFsaXplZCA/IHQoKSA6IHRoaXMuZXZlbnRzLnB1c2godCk7IH0sIGUucHJvdG90eXBlLnNldFRyYWNrUGFnZXZpZXcgPSBmdW5jdGlvbiAoZSkgeyB0aGlzLnRyYWNrUGFnZVZpZXcgPSBlOyB9LCBlLnByb3RvdHlwZS5zZXRMb2NhbGUgPSBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IHRoaXM7IHRoaXMubG9jYWxlID0gZSwgdGhpcy51dGlsU2VydmljZS5fX3Byb3RlY3RlZF9fLnNldENvb2tpZShcIkxBTkdcIiwgdGhpcy5sb2NhbGUpLCB0aGlzLmlzSW5pdGlhbGl6ZWQgPyB0aGlzLmNoYW5nZUxvY2FsZShlKSA6IHRoaXMuaW5pdENhbGxiYWNrcy5wdXNoKChmdW5jdGlvbiAoKSB7IG4uY2hhbmdlTG9jYWxlKGUpOyB9KSk7IH0sIGUucHJvdG90eXBlLnNldFBhZ2VVUkwgPSBmdW5jdGlvbiAoZSkgeyB0aGlzLmN1c3RvbVBhZ2VVcmwgPSBlOyB9LCBlLnByb3RvdHlwZS5zZXRBZGJsb2NrZXJDb29raWVOYW1lID0gZnVuY3Rpb24gKGUpIHsgdGhpcy5hZGJsb2NrZXJDb29raWVOYW1lID0gZTsgfSwgZS5wcm90b3R5cGUuc2V0TWF4Q29va2llRXhwaXJhdGlvbkluRGF5cyA9IGZ1bmN0aW9uIChlKSB7IHZhciBuID0gXCJzdHJpbmdcIiA9PSB0eXBlb2YgZSA/IHBhcnNlSW50KGUsIDEwKSA6IGU7IGlmICghKGlzRmluaXRlKG4pICYmIG4gPiAwKSlcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwibWF4Q29va2llRXhwaXJhdGlvbkluRGF5cyBtdXN0IGJlIGEgcG9zaXRpdmUgbnVtYmVyXCIpOyB0aGlzLm1heENvb2tpZUV4cGlyYXRpb25JbkRheXMgPSBuOyB9LCBlLnByb3RvdHlwZS5nZXRNYXhDb29raWVFeHBpcmF0aW9uSW5EYXlzID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5tYXhDb29raWVFeHBpcmF0aW9uSW5EYXlzOyB9LCBlLnByb3RvdHlwZS5zZXRGYlBpeGVsSWQgPSBmdW5jdGlvbiAoZSkgeyB0aGlzLmZiUGl4ZWxJZCA9IGU7IH0sIGUucHJvdG90eXBlLmdldEZiUGl4ZWxJZCA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuZmJQaXhlbElkOyB9LCBlLnByb3RvdHlwZS5zZXRSZWRpcmVjdFRvRmJUaW1lb3V0ID0gZnVuY3Rpb24gKGUpIHsgdGhpcy5yZWRpcmVjdFRvRmJUaW1lb3V0ID0gZTsgfSwgZS5wcm90b3R5cGUuZW5hYmxlRG91YmxlT3B0SW5DaGVja09uQWNjZXNzQ2hlY2sgPSBmdW5jdGlvbiAoKSB7IHRoaXMuaXNEb3VibGVPcHRJbkNoZWNrT25BY2Nlc3NDaGVja0VuYWJsZWQgPSAhMDsgfSwgZS5wcm90b3R5cGUuc2V0Q2xvdWRmbGFyZVdvcmtlclVybCA9IGZ1bmN0aW9uIChlKSB7IHRoaXMuY2xvdWRmbGFyZVdvcmtlclVybCA9IGU7IH0sIGUucHJvdG90eXBlLmdldEVuZHBvaW50ID0gZnVuY3Rpb24gKGUsIG4pIHsgcmV0dXJuIGUubGFzdEluZGV4T2YoXCIvXCIpID09PSBlLmxlbmd0aCAtIDEgJiYgKGUgPSBlLnN1YnN0cigwLCBlLmxlbmd0aCAtIDEpKSwgZS5tYXRjaCgvXFwvdjMkLykgJiYgKGUgPSBlLnN1YnN0cigwLCBlLmxhc3RJbmRleE9mKFwiL3YzXCIpKSksIGUubWF0Y2goL1xcL2FwaSQvKSAmJiAoZSA9IGUuc3Vic3RyKDAsIGUubGFzdEluZGV4T2YoXCIvYXBpXCIpKSksIGUubWF0Y2goL14oaHR0cFtzXT86KT9cXC9cXC8vKSB8fCAoZSA9IFwiLy9cIiArIGUpLCB2b2lkIDAgIT09IG4gJiYgbiAmJiAhZS5tYXRjaCgvXmh0dHBbc10/Oi8pICYmIChlID0gXCJodHRwczpcIiArIGUpLCBlOyB9LCBlLnByb3RvdHlwZS5fZ2V0RW5kcG9pbnRSb290ID0gZnVuY3Rpb24gKGUpIHsgdmFyIG4gPSBcImh0dHBzOi8vYnV5LnRpbnlwYXNzLmNvbVwiOyByZXR1cm4gITAgPT09IHRoaXMuc2FuZGJveCAmJiAodGhpcy5lbmRwb2ludCA9IFwic2FuZGJveFwiKSwgdGhpcy5lbmRwb2ludCAmJiAoXCJzYW5kYm94XCIgPT09IHRoaXMuZW5kcG9pbnQgPyBuID0gXCJodHRwczovL3NhbmRib3gudGlueXBhc3MuY29tXCIgOiBcInByb2RcIiAhPT0gdGhpcy5lbmRwb2ludCAmJiBcInByb2R1Y3Rpb25cIiAhPT0gdGhpcy5lbmRwb2ludCAmJiAobiA9IHRoaXMuZW5kcG9pbnQpKSwgdGhpcy5nZXRFbmRwb2ludChuLCBlKTsgfSwgZS5wcm90b3R5cGUuX2dldEFwaUVuZHBvaW50ID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5fZ2V0RW5kcG9pbnRSb290KCkgKyBcIi9hcGkvdjNcIjsgfSwgZS5wcm90b3R5cGUuX2dldFRyYWNraW5nRW5kcG9pbnQgPSBmdW5jdGlvbiAoZSkgeyB2b2lkIDAgPT09IGUgJiYgKGUgPSBcIlwiKTsgdmFyIG4gPSBlIHx8IHRoaXMuZW5kcG9pbnQ7IHJldHVybiAhMCA9PT0gdGhpcy5zYW5kYm94ID8gbiA9IFwiaHR0cHM6Ly9zYW5kYm94LnRpbnlwYXNzLmNvbVwiIDogKHZvaWQgMCA9PT0gdGhpcy5lbmRwb2ludCB8fCBudWxsID09PSB0aGlzLmVuZHBvaW50IHx8IFwiXCIgPT09IHRoaXMuZW5kcG9pbnQgfHwgXCJwcm9kXCIgPT09IHRoaXMuZW5kcG9pbnQgfHwgXCJwcm9kdWN0aW9uXCIgPT09IHRoaXMuZW5kcG9pbnQgfHwgdGhpcy5lbmRwb2ludC5tYXRjaCgvKGJ1eXxhcGl8YXBpLXYzKVxcLnRpbnlwYXNzXFwuY29tLykpICYmIChuID0gZSB8fCBcImh0dHBzOi8vYXBpLXYzLnRpbnlwYXNzLmNvbVwiKSwgdGhpcy5nZXRFbmRwb2ludChuLCAhMCk7IH0sIGUucHJvdG90eXBlLl9nZXRFeHBlcmllbmNlRW5kcG9pbnQgPSBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IFwiaHR0cHM6Ly9jMi5waWFuby5pb1wiOyByZXR1cm4gdGhpcy5jb21wb3Nlckhvc3QgPyBuID0gdGhpcy5jb21wb3Nlckhvc3QgOiAoITAgPT09IHRoaXMuc2FuZGJveCAmJiAodGhpcy5lbmRwb2ludCA9IFwic2FuZGJveFwiKSwgdGhpcy5lbmRwb2ludCAmJiAoXCJzYW5kYm94XCIgPT09IHRoaXMuZW5kcG9pbnQgPyBuID0gXCJodHRwczovL2MyLXNhbmRib3gucGlhbm8uaW9cIiA6IFwicHJvZFwiICE9PSB0aGlzLmVuZHBvaW50ICYmIFwicHJvZHVjdGlvblwiICE9PSB0aGlzLmVuZHBvaW50ICYmIChuID0gKG4gPSAobiA9IChuID0gKG4gPSAobiA9IChuID0gKG4gPSAobiA9IChuID0gKG4gPSAobiA9IChuID0gKG4gPSAobiA9IChuID0gKG4gPSAobiA9IHRoaXMuZW5kcG9pbnQpLnJlcGxhY2UoXCIvL2J1eS50aW55cGFzcy5jb21cIiwgXCIvL2MyLnBpYW5vLmlvXCIpKS5yZXBsYWNlKFwiLy9hcGkudGlueXBhc3MuY29tXCIsIFwiLy9jMi5waWFuby5pb1wiKSkucmVwbGFjZShcIi8vYnV5LWF1LnBpYW5vLmlvXCIsIFwiLy9jMi1hdS5waWFuby5pb1wiKSkucmVwbGFjZShcIi8vYXBpLWF1LnBpYW5vLmlvXCIsIFwiLy9jMi1hdS5waWFuby5pb1wiKSkucmVwbGFjZShcIi8vYnV5LWFwLnBpYW5vLmlvXCIsIFwiLy9jMi1hcC5waWFuby5pb1wiKSkucmVwbGFjZShcIi8vYXBpLWFwLnBpYW5vLmlvXCIsIFwiLy9jMi1hcC5waWFuby5pb1wiKSkucmVwbGFjZShcIi8vYnV5LWV1LnBpYW5vLmlvXCIsIFwiLy9jMi1ldS5waWFuby5pb1wiKSkucmVwbGFjZShcIi8vYXBpLWV1LnBpYW5vLmlvXCIsIFwiLy9jMi1ldS5waWFuby5pb1wiKSkucmVwbGFjZShcIi8vc2FuZGJveC50aW55cGFzcy5jb21cIiwgXCIvL2MyLXNhbmRib3gucGlhbm8uaW9cIikpLnJlcGxhY2UoXCIvL3NhbmRib3gucGlhbm8uaW9cIiwgXCIvL2MyLXNhbmRib3gucGlhbm8uaW9cIikpLnJlcGxhY2UoXCIvL2V4cGVyaWVuY2UtYXUucGlhbm8uaW9cIiwgXCIvL2MyLWF1LnBpYW5vLmlvXCIpKS5yZXBsYWNlKFwiLy9leHBlcmllbmNlLWV1LnBpYW5vLmlvXCIsIFwiLy9jMi1ldS5waWFuby5pb1wiKSkucmVwbGFjZShcIi8vZXhwZXJpZW5jZS1hcC5waWFuby5pb1wiLCBcIi8vYzItYXAucGlhbm8uaW9cIikpLnJlcGxhY2UoXCIvL2V4cGVyaWVuY2UudGlueXBhc3MuY29tXCIsIFwiLy9jMi5waWFuby5pb1wiKSkucmVwbGFjZShcIi8vYnV5LnBpYW5vLmlvXCIsIFwiLy9jMi5waWFuby5pb1wiKSkucmVwbGFjZShcIi8vYXBpLnBpYW5vLmlvXCIsIFwiLy9jMi5waWFuby5pb1wiKSkucmVwbGFjZShcIi8vZXhwZXJpZW5jZS5waWFuby5pb1wiLCBcIi8vYzIucGlhbm8uaW9cIikpKSksIHRoaXMuZ2V0RW5kcG9pbnQobiwgZSk7IH0sIGUucHJvdG90eXBlLl9pc1NhbmRib3ggPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLnNhbmRib3ggfHwgXCJzYW5kYm94XCIgPT09IHRoaXMuZW5kcG9pbnQgfHwgISF0aGlzLmVuZHBvaW50ICYmIC0xICE9PSB0aGlzLmVuZHBvaW50LmluZGV4T2YoXCIvL3NhbmRib3gudGlueXBhc3MuY29tXCIpOyB9LCBlLnByb3RvdHlwZS5jaGFuZ2VMb2NhbGUgPSBmdW5jdGlvbiAoZSkgeyBwbi5waWFub0lkLmlzQ29uZmlndXJlZCgpICYmIHBuLnBpYW5vSWQudXBkYXRlTGFuZyhlKSwgcG4ucG9zdG1lc3NhZ2UuYnJvYWRjYXN0KFwibGFuZ0NoYW5nZWRcIiwgeyBsYW5nOiBlIH0pOyB9LCBlLnByb3RvdHlwZS5wYWdlVHJhY2sgPSBmdW5jdGlvbiAoZSwgbikgeyBwbi5tYWluLnBhZ2VUcmFjayhlLCBuKTsgfSwgZS5wcm90b3R5cGUudHJhY2tQYWdlID0gZnVuY3Rpb24gKGUsIG4pIHsgcG4ubWFpbi5wYWdlVHJhY2soZSwgbik7IH0sIGUucHJvdG90eXBlLnRyYWNrUGFnZVVubG9hZCA9IGZ1bmN0aW9uICgpIHsgcG4ubWFpbi50cmFja1BhZ2VVbmxvYWQoKTsgfSwgZS5wcm90b3R5cGUudHJhY2tBZHMgPSBmdW5jdGlvbiAoZSkgeyBwbi5tYWluLnRyYWNrQWRzKGUpOyB9LCBlLnByb3RvdHlwZS50cmFja0FkID0gZnVuY3Rpb24gKGUsIG4sIHQpIHsgcG4ubWFpbi50cmFja0FkKGUsIG4sIHQpOyB9LCBlLnByb3RvdHlwZS5vbkxvYWQgPSBmdW5jdGlvbiAoZSkgeyB0aGlzLmNhbGxiYWNrcy5wdXNoKGUpOyB9LCBlLnByb3RvdHlwZS5nZXRFbmRwb2ludFJvb3QgPSBmdW5jdGlvbiAoZSkgeyByZXR1cm4gdGhpcy5fZ2V0RW5kcG9pbnRSb290KGUpOyB9LCBlLnByb3RvdHlwZS5nZXRFeHBlcmllbmNlRW5kcG9pbnQgPSBmdW5jdGlvbiAoZSkgeyByZXR1cm4gdGhpcy5fZ2V0RXhwZXJpZW5jZUVuZHBvaW50KGUpOyB9LCBlLnByb3RvdHlwZS5nZXRBcGlFbmRwb2ludCA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuX2dldEFwaUVuZHBvaW50KCk7IH0sIGUucHJvdG90eXBlLmdldFRyYWNraW5nRW5kcG9pbnQgPSBmdW5jdGlvbiAoZSkgeyByZXR1cm4gdm9pZCAwID09PSBlICYmIChlID0gXCJcIiksIHRoaXMuX2dldFRyYWNraW5nRW5kcG9pbnQoZSk7IH0sIGUucHJvdG90eXBlLmlzU2FuZGJveCA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuX2lzU2FuZGJveCgpOyB9LCBlLnByb3RvdHlwZS5zZXRDYWNoZWFibGVTaG93VGVtcGxhdGUgPSBmdW5jdGlvbiAoZSkgeyB0aGlzLmNhY2hlYWJsZVNob3dUZW1wbGF0ZSA9IGU7IH0sIGUucHJvdG90eXBlLmdldENhY2hlYWJsZVNob3dUZW1wbGF0ZSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuY2FjaGVhYmxlU2hvd1RlbXBsYXRlOyB9LCBlID0gZnVuY3Rpb24gKGUsIG4sIHQsIHIpIHsgdmFyIG8sIGkgPSBhcmd1bWVudHMubGVuZ3RoLCBhID0gaSA8IDMgPyBuIDogbnVsbCA9PT0gciA/IHIgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG4sIHQpIDogcjsgaWYgKFwib2JqZWN0XCIgPT0gdHlwZW9mIFJlZmxlY3QgJiYgXCJmdW5jdGlvblwiID09IHR5cGVvZiBSZWZsZWN0LmRlY29yYXRlKVxuICAgICAgICBhID0gUmVmbGVjdC5kZWNvcmF0ZShlLCBuLCB0LCByKTtcbiAgICBlbHNlXG4gICAgICAgIGZvciAodmFyIHMgPSBlLmxlbmd0aCAtIDE7IHMgPj0gMDsgcy0tKVxuICAgICAgICAgICAgKG8gPSBlW3NdKSAmJiAoYSA9IChpIDwgMyA/IG8oYSkgOiBpID4gMyA/IG8obiwgdCwgYSkgOiBvKG4sIHQpKSB8fCBhKTsgcmV0dXJuIGkgPiAzICYmIGEgJiYgT2JqZWN0LmRlZmluZVByb3BlcnR5KG4sIHQsIGEpLCBhOyB9KFtwbi5zaW5nbGV0b24oKSwgYmUoMCwgcG4uaW5qZWN0KFwidHBQcmVkZWZpbmVkT3B0aW9uc1wiKSksIGJlKDEsIHBuLmluamVjdChcImNzc1wiKSksIGJlKDIsIHBuLmluamVjdChcInRpbnlwYXNzRXJyb3JIYW5kbGVyXCIpKSwgYmUoMywgcG4uaW5qZWN0KFwiZ2FTZXJ2aWNlXCIpKSwgYmUoNCwgcG4uaW5qZWN0KFwidXRpbFwiKSksIGtlKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW09iamVjdCwgT2JqZWN0LCBPYmplY3QsIE9iamVjdCwgT2JqZWN0XSldLCBlKSwgZTsgfSgpO1xuICAgIHBuLmNvbnRhaW5lci5yZWdpc3RlclNpbmdsZXRvbihcInRpbnlwYXNzXCIsIFRuKTtcbiAgICB2YXIgQW4gPSBwbi5jb250YWluZXIucmVzb2x2ZShcInRpbnlwYXNzXCIpO1xuICAgIFt7IG46IFwicG9seWZpbGxcIiwgaE06ICExIH0sIHsgbjogXCJwcmVkZWZpbmVcIiwgaE06ICExIH0sIHsgbjogXCJwcmVkZWZpbmVUaW55cGFzc1wiLCBoTTogITEgfSwgeyBuOiBcImNoZWNrVGlueXBhc3NcIiwgaE06ICExIH0sIHsgbjogXCJjc3NcIiwgaE06ICEwIH0sIHsgbjogXCJhamF4XCIsIGhNOiAhMCB9LCB7IG46IFwianFVdGlsc1wiLCBoTTogITAgfSwgeyBuOiBcImNvb2tpZVwiLCBoTTogITAgfSwgeyBuOiBcImxvY2FsU3RvcmFnZVwiLCBoTTogITAgfSwgeyBuOiBcInZlcnNpb25TZXJ2aWNlXCIsIGhNOiAhMCB9LCB7IG46IFwiaXRwXCIsIGhNOiAhMCB9LCB7IG46IFwidXRpbFwiLCBoTTogITAgfSwgeyBuOiBcImFwaVwiLCBoTTogITAgfSwgeyBuOiBcInBvc3RtZXNzYWdlXCIsIGhNOiAhMCB9LCB7IG46IFwiZXZlbnRVdGlsc1wiLCBoTTogITAgfSwgeyBuOiBcImphbnJhaW5cIiwgaE06ICEwIH0sIHsgbjogXCJzaGExXCIsIGhNOiAhMCB9LCB7IG46IFwiY29udGFpbmVyVXRpbHNcIiwgaE06ICEwIH0sIHsgbjogXCJ0aW55cGFzc0xvZ2luXCIsIGhNOiAhMCB9LCB7IG46IFwidGlueXBhc3NBY2NvdW50c1wiLCBoTTogITAgfSwgeyBuOiBcImNvbmRlVXNlclByb3ZpZGVyXCIsIGhNOiAhMCB9LCB7IG46IFwiZ2lneWFcIiwgaE06ICEwIH0sIHsgbjogXCJqd3REZWNvZGVcIiwgaE06ICEwIH0sIHsgbjogXCJsb2dcIiwgaE06ICEwIH0sIHsgbjogXCJsb2dnaW5nXCIsIGhNOiAhMCB9LCB7IG46IFwib2JzZXJ2ZXJcIiwgaE06ICEwIH0sIHsgbjogXCJnYVNlcnZpY2VcIiwgaE06ICEwIH0sIHsgbjogXCJwaWFub0lkTGl0ZVwiLCBoTTogITAgfSwgeyBuOiBcInBpYW5vSWRcIiwgaE06ICEwIH0sIHsgbjogXCJ1c2VyXCIsIGhNOiAhMCB9LCB7IG46IFwidmlld3BvcnRFeGl0XCIsIGhNOiAhMCB9LCB7IG46IFwidGVtcGxhdGVcIiwgaE06ICEwIH0sIHsgbjogXCJvZmZlclwiLCBoTTogITAgfSwgeyBuOiBcIm15YWNjb3VudFwiLCBoTTogITAgfSwgeyBuOiBcIm1ldGVyXCIsIGhNOiAhMCB9LCB7IG46IFwiZmluZ2VycHJpbnRcIiwgaE06ICEwIH0sIHsgbjogXCJzY3JvbGxEZXB0aFwiLCBoTTogITAgfSwgeyBuOiBcImlkbGVcIiwgaE06ICEwIH0sIHsgbjogXCJpbnRlcmFjdGlvblwiLCBoTTogITAgfSwgeyBuOiBcInJlY1dpZGdldFNlcnZpY2VcIiwgaE06ICEwIH0sIHsgbjogXCJwaWFub1wiLCBoTTogITAgfSwgeyBuOiBcInBpYW5vRXNwXCIsIGhNOiAhMCB9LCB7IG46IFwic3dnXCIsIGhNOiAhMCB9LCB7IG46IFwiZmJwaXhlbFwiLCBoTTogITAgfSwgeyBuOiBcImZic3Vic2NyaXB0aW9uc1wiLCBoTTogITAgfSwgeyBuOiBcImN4ZW5zZVwiLCBoTTogITAgfSwgeyBuOiBcImV4cGVyaWVuY2VcIiwgaE06ICEwIH0sIHsgbjogXCJpZnZpc2libGVcIiwgaE06ICEwIH0sIHsgbjogXCJhY3RpdmV0aW1lclwiLCBoTTogITAgfSwgeyBuOiBcImRvdWJsZUNsaWNrRm9yUHVibGlzaGVyXCIsIGhNOiAhMCB9LCB7IG46IFwiYXBwbGVQYXlcIiwgaE06ICEwIH0sIHsgbjogXCJnb0NhcmRsZXNzRHJvcGluXCIsIGhNOiAhMCB9LCB7IG46IFwiYXBwbGVQYXlJbnRlZ3JhdGlvblNlcnZpY2VcIiwgaE06ICEwIH0sIHsgbjogXCJkYXRhdHJhbnNBcHBsZVBheUludGVncmF0aW9uU2VydmljZVwiLCBoTTogITAgfSwgeyBuOiBcInN0cmlwZUFwcGxlUGF5SW50ZWdyYXRpb25TZXJ2aWNlXCIsIGhNOiAhMCB9LCB7IG46IFwib2JpM0RTQ2hhbGxlbmdlXCIsIGhNOiAhMCB9LCB7IG46IFwiYW1wXCIsIGhNOiAhMCB9LCB7IG46IFwicGVyZm9ybWFuY2VNZXRyaWNzXCIsIGhNOiAhMCB9LCB7IG46IFwiZG91YmxlT3B0SW5cIiwgaE06ICEwIH0sIHsgbjogXCJuZXdzY3ljbGVcIiwgaE06ICEwIH0sIHsgbjogXCJjYXB0Y2hhVjNcIiwgaE06ICEwIH0sIHsgbjogXCJtYWluXCIsIGhNOiAhMCB9LCB7IG46IFwidGlueXBhc3NFcnJvckhhbmRsZXJcIiwgaE06ICEwIH0sIHsgbjogXCJ0aW55cGFzc1wiLCBoTTogITAgfSwgeyBuOiBcInBvc3RQcm9jZXNzaW5nXCIsIGhNOiAhMSB9XS5mb3JFYWNoKChmdW5jdGlvbiAoZSkgeyBlLmhNICYmICFwbi5jb250YWluZXIuaXNSZWdpc3RlcmVkKGUubikgJiYgcG4uY29udGFpbmVyLnJlc29sdmUoZS5uKTsgfSkpLCBPYmplY3QuYXNzaWduKHBuLCBBbiksIE9iamVjdC5zZXRQcm90b3R5cGVPZihwbiwgVG4ucHJvdG90eXBlKTtcbiAgICB2YXIgTW4gPSB3aW5kb3cudHAgPSBwbjtcbiAgICBwbi5pbml0VHAoKSwgY29uc29sZS5sb2coXCJQaWFubyBTREsgMi4wIGxvYWRlZC5cIik7XG4gICAgZS5jeGVuc2UgPSBsbiwgZS5leHBlcmllbmNlID0gdW4sIGUuanFVdGlscyA9IGRlLCBlLmxvZyA9IE9lLCBlLm1haW4gPSBQbiwgZS5vZmZlciA9IEdlLCBlLnBpYW5vRXNwID0gb24sIGUucGlhbm9JZCA9IHFlLCBlLnBvc3RQcm9jZXNzaW5nID0gXCJwb3N0UHJvY2Vzc2luZ1wiLCBlLnRpbnlwYXNzRXJyb3JIYW5kbGVyID0geG4sIGUudXNlciA9IEhlLCBlLnV0aWwgPSBDZSwgT2JqZWN0LmRlZmluZVByb3BlcnR5KGUsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiAhMCB9KTtcbn0oe30pO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9dGlueXBhc3MuanMubWFwIiwiLy8gVGhlIG1vZHVsZSBjYWNoZVxudmFyIF9fd2VicGFja19tb2R1bGVfY2FjaGVfXyA9IHt9O1xuXG4vLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcblx0dmFyIGNhY2hlZE1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF07XG5cdGlmIChjYWNoZWRNb2R1bGUgIT09IHVuZGVmaW5lZCkge1xuXHRcdHJldHVybiBjYWNoZWRNb2R1bGUuZXhwb3J0cztcblx0fVxuXHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuXHR2YXIgbW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXSA9IHtcblx0XHQvLyBubyBtb2R1bGUuaWQgbmVlZGVkXG5cdFx0Ly8gbm8gbW9kdWxlLmxvYWRlZCBuZWVkZWRcblx0XHRleHBvcnRzOiB7fVxuXHR9O1xuXG5cdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuXHRfX3dlYnBhY2tfbW9kdWxlc19fW21vZHVsZUlkXShtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuXHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuXHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG59XG5cbiIsIi8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSAobW9kdWxlKSA9PiB7XG5cdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuXHRcdCgpID0+IChtb2R1bGVbJ2RlZmF1bHQnXSkgOlxuXHRcdCgpID0+IChtb2R1bGUpO1xuXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCB7IGE6IGdldHRlciB9KTtcblx0cmV0dXJuIGdldHRlcjtcbn07IiwiLy8gZGVmaW5lIGdldHRlciBmdW5jdGlvbnMgZm9yIGhhcm1vbnkgZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5kID0gKGV4cG9ydHMsIGRlZmluaXRpb24pID0+IHtcblx0Zm9yKHZhciBrZXkgaW4gZGVmaW5pdGlvbikge1xuXHRcdGlmKF9fd2VicGFja19yZXF1aXJlX18ubyhkZWZpbml0aW9uLCBrZXkpICYmICFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywga2V5KSkge1xuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIGtleSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGRlZmluaXRpb25ba2V5XSB9KTtcblx0XHR9XG5cdH1cbn07IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5vID0gKG9iaiwgcHJvcCkgPT4gKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIHByb3ApKSIsIi8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uciA9IChleHBvcnRzKSA9PiB7XG5cdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuXHR9XG5cdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG59OyIsImltcG9ydCBBZFNlcnZlciBmcm9tICcuLi9kaXN0L2luZGV4JztcblxuY29uc3QgbWl4cGFuZWxQcmVzZW50ZWQgPSB7XG4gICAgc2VydmljZTogJ21peHBhbmVsJyxcbiAgICBhY3Rpb246ICdNZW1iZXJzaGlwIEJsb2NrJyxcbiAgICBzdGF0dXM6ICdQcmVzZW50ZWQnLFxufTtcbmNvbnN0IG1peHBhbmVsQWNjZXB0ZWQgPSB7XG4gICAgc2VydmljZTogJ21peHBhbmVsJyxcbiAgICBhY3Rpb246ICdNZW1iZXJzaGlwIEJsb2NrJyxcbiAgICBzdGF0dXM6ICdBY2NlcHRlZCcsXG59O1xuXG5jb25zdCBhbm9uID0gW1tcInVzZXJTZWdtZW50XCIsICdkZW1vbiddXTtcblxuY29uc3QgcGlhbm8gPSBuZXcgQWRTZXJ2ZXIoe1xuICAgIGFkU2VydmljZXI6ICdwaWFubycsXG4gICAgbWF0Y2hlcnM6IGFub24sXG4gICAgdGhpcmRQYXJ0eUNhbGxiYWNrczogW1xuICAgICAgICBtaXhwYW5lbFByZXNlbnRlZCxcbiAgICAgICAgbWl4cGFuZWxBY2NlcHRlZCxcbiAgICBdLFxuICAgIHRhZ3M6IFtbXCJ0ZXN0aW5nXCJdXSxcbn0pO1xuXG5waWFuby5kaXNwYXRjaEFkKCk7Il0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9